id,original query
1,"SELECT ""stock_name"",""sellprice""-""buyprice"" AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""sellprice"",""operation"" FROM ""Stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""a"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""buyprice"",""operation"" FROM ""Stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""b"" USING (""stock_name"")"
2,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
3,"WITH ""t1"" AS (SELECT *,RANK() OVER (PARTITION BY ""stock_name"", ""operation"" ORDER BY ""operation_day"") AS ""txn_ct"" FROM ""Stocks"") SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -""price"" WHEN ""operation""='sell' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
4,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
5,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" WHEN ""operation""='Buy' THEN -""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
6,"SELECT ""stock_name"",(SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END)) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
7,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
8,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
9,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
10,"SELECT ""b"".""stock_name"",(COALESCE(""total_sell"", 0)-COALESCE(""total_buy"", 0)) AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""total_sell"" FROM ""Stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""s"" RIGHT JOIN (SELECT ""stock_name"",SUM(""price"") AS ""total_buy"" FROM ""Stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""b"" ON ""s"".""stock_name""=""b"".""stock_name"""
11,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*-1 ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"" ORDER BY ""operation_day"",""operation"""
12,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
13,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
14,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
15,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
16,"SELECT ""s"".""stock_name"",SUM(CASE WHEN ""s"".""operation""='Sell' THEN ""s"".""price"" ELSE (-1)*""s"".""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" AS ""s"" GROUP BY ""stock_name"""
17,"WITH ""stock_table"" AS (SELECT ""stock_name"",-1*SUM(""price"") AS ""price"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"" UNION SELECT ""stock_name"",SUM(""price"") FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") SELECT ""stock_name"",SUM(""price"") AS ""capital_gain_loss"" FROM ""stock_table"" GROUP BY ""stock_name"""
18,"WITH ""gains"" AS (SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" WHEN ""operation""='Buy' THEN -1*""price"" END) AS ""gain"" FROM ""stocks"" GROUP BY ""stock_name"") SELECT ""stock_name"",""gain"" AS ""capital_gain_loss"" FROM ""gains"""
19,"SELECT ""B"".""stock_name"",""B"".""capital_gain_loss"" FROM (SELECT ""A"".""stock_name"",""A"".""operation_day"",SUM(""A"".""price"") OVER (PARTITION BY ""A"".""stock_name"" ORDER BY ""A"".""operation_day"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",""operation_day"",(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""price"" FROM ""Stocks"") AS ""A"") AS ""B"" WHERE ROW(""B"".""stock_name"",""B"".""operation_day"") IN (SELECT ""stock_name"",MAX(""operation_day"") FROM ""Stocks"" GROUP BY ""stock_name"")"
20,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" WHEN ""operation""='sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
21,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
22,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
23,"SELECT ""t1"".""stock_name"",(""t2"".""sell""-""t1"".""buy"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""buy"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY 1) AS ""t1"" LEFT JOIN (SELECT ""stock_name"",SUM(""price"") AS ""sell"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY 1) AS ""t2"" ON ""t1"".""stock_name""=""t2"".""stock_name"""
24,"SELECT ""stock_name"",SUM(""price"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END AS ""price"" FROM ""stocks"") AS ""ts"" GROUP BY ""stock_name"""
25,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
26,"SELECT ""B"".""stock_name"",""B"".""capital_gain_loss"" FROM (SELECT ""A"".""stock_name"",""A"".""operation_day"",SUM(""A"".""price"") OVER (PARTITION BY ""A"".""stock_name"" ORDER BY ""A"".""operation_day"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",""operation_day"",(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""price"" FROM ""Stocks"") AS ""A"") AS ""B"" WHERE ROW(""B"".""stock_name"",""B"".""operation_day"") IN (SELECT ""stock_name"",MAX(""operation_day"") FROM ""Stocks"" GROUP BY ""stock_name"")"
27,"WITH ""cte"" AS (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN (-1)*""price"" ELSE ""price"" END AS ""total"" FROM ""stocks"") SELECT ""stock_name"",SUM(""total"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY ""stock_name"""
28,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='SELL' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
29,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE ""price""*(-1) END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
30,"SELECT ""t1"".""stock_name"",(""t2"".""sellP""-""t1"".""buyP"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""buyP"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""t1"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""sellP"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""t2"" ON ""t1"".""stock_name""=""t2"".""stock_name"""
31,"WITH ""cte"" AS (SELECT ""stock_name"",SUM(""price"") AS ""buy"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name""), ""ctee"" AS (SELECT ""stock_name"",SUM(""price"") AS ""sell"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY 1) SELECT ""a"".""stock_name"",(""sell""-""buy"") AS ""capital_gain_loss"" FROM ""ctee"" AS ""b"" JOIN ""cte"" AS ""a"" ON ""a"".""stock_name""=""b"".""stock_name"""
32,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
33,"SELECT ""s"".""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" AS ""s"" GROUP BY ""stock_name"""
34,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE NULL END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE NULL END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
35,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
36,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
37,"SELECT ""stock_name"",SUM(""lead_action_price""-""price"") AS ""capital_gain_loss"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""row_rk"",LEAD(""price"", 1) OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""lead_action_price"" FROM ""stocks"") AS ""a"" WHERE ""row_rk""%2=1 GROUP BY ""stock_name"""
38,"SELECT ""s"".""stock_name"",COALESCE(""sell_sum""-""buy_sum"", 0) AS ""capital_gain_loss"" FROM (SELECT ""Stock_name"",SUM(""price"") AS ""buy_sum"" FROM ""Stocks"" WHERE ""operation""='Buy' GROUP BY ""Stock_name"") AS ""b"" JOIN (SELECT ""Stock_name"",SUM(""price"") AS ""sell_sum"" FROM ""Stocks"" WHERE ""operation""='Sell' GROUP BY ""Stock_name"") AS ""s"" ON ""s"".""stock_name""=""b"".""stock_name"""
39,"WITH ""CTE1"" AS (SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN ""price"" ELSE 0 END) AS ""buy"",SUM(CASE WHEN ""operation""='sell' THEN ""price"" ELSE 0 END) AS ""sell"" FROM ""Stocks"" GROUP BY ""stock_name"") SELECT ""stock_name"",""sell""-""buy"" AS ""capital_gain_loss"" FROM ""CTE1"""
40,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
41,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
42,"WITH ""cte"" AS (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN ""price""*-1 WHEN ""operation""='Sell' THEN ""price"" END AS ""signed_price"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""signed_price"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY ""stock_name"""
43,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*(-1) ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
44,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
45,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
46,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*-1 ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
47,"SELECT ""stock_name"",(""sell_price""-""buy_price"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END) AS ""sell_price"",SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""buy_price"" FROM ""Stocks"" GROUP BY ""stock_name"") AS ""t1"""
48,"SELECT ""t1"".""stock_name"",(""t2"".""sellP""-""t1"".""buyP"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""buyP"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""t1"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""sellP"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""t2"" ON ""t1"".""stock_name""=""t2"".""stock_name"""
49,"SELECT ""s"".""stock_name"",SUM(CASE WHEN ""s"".""operation""='Sell' THEN ""s"".""price"" ELSE (-1)*""s"".""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" AS ""s"" GROUP BY ""stock_name"""
50,"WITH ""temp"" AS (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""price"" FROM ""Stocks"" GROUP BY ""stock_name"",""operation"") SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""temp"" GROUP BY ""stock_name"""
51,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
52,"SELECT ""stock_name"",SUM(""price_with_sign"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END AS ""price_with_sign"" FROM ""Stocks"") AS ""a"" GROUP BY ""stock_name"""
53,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE (-1)*""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
54,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE (-1)*""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
55,"WITH ""t1"" AS (SELECT *,CASE WHEN ""operation""='Buy' THEN 0-""price"" ELSE ""price"" END AS ""c"" FROM ""stocks""), ""t2"" AS (SELECT ""stock_name"",SUM(""c"") OVER (PARTITION BY ""stock_name"") AS ""capital_gain_loss"" FROM ""t1"") SELECT * FROM ""t2"" GROUP BY 1,2"
56,"WITH ""CTE"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""stock_name"",""operation_day"" DESC) AS ""row_num"" FROM ""stocks"") SELECT ""t1"".""stock_name"",SUM(""t1"".""price""-""t2"".""price"") AS ""capital_gain_loss"" FROM ""CTE"" AS ""T1"" JOIN ""CTE"" AS ""T2"" ON ""T1"".""STOCK_NAME""=""T2"".""STOCK_NAME"" AND ""t1"".""row_num""=""t2"".""row_num""-1 WHERE ""T1"".""OPERATION""='Sell' AND ""t2"".""operation""='Buy' GROUP BY ""t1"".""stock_name"""
57,"WITH ""x"" AS (SELECT *,RANK() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""day"",CASE WHEN ""operation""='Buy' THEN ""price""*-1 ELSE ""price""*1 END AS ""p"" FROM ""stocks"") SELECT ""stock_name"",SUM(""p"") AS ""capital_gain_loss"" FROM ""x"" GROUP BY 1"
58,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
59,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
60,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE +""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
61,"WITH ""cte1"" AS (SELECT *,CEILING(ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""stock_name"",""operation_day"")/2) AS ""row_num"" FROM ""Stocks"" ORDER BY ""stock_name"",""operation_day""), ""cte2"" AS (SELECT ""stock_name"",""row_num"",MAX(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""buy_price"",MAX(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END) AS ""sell_price"" FROM ""cte1"" GROUP BY ""stock_name"",""row_num"") SELECT ""stock_name"",SUM(""sell_price""-""buy_price"") AS ""capital_gain_loss"" FROM ""cte2"" GROUP BY ""stock_name"""
62,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"" ORDER BY ""capital_gain_loss"""
63,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
64,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
65,"SELECT ""stock_name"",SUM(CASE WHEN ""rn""%2!=0 THEN 0-""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""price"",ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""rn"" FROM ""Stocks"") AS ""x"" GROUP BY 1"
66,"WITH ""temp"" AS (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN ""price""*(-1) WHEN ""operation""='SELL' THEN ""price"" END AS ""price"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""price"") AS ""capital_gain_loss"" FROM ""temp"" GROUP BY ""stock_name"""
67,"SELECT ""stock_name"",(""total_sales""-""total_purchases"") AS ""capital_gain_loss"" FROM (SELECT ""S1"".""stock_name"",SUM(""price"") AS ""total_sales"",""S2"".""total_purchases"" FROM ""Stocks"" AS ""S1"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""total_purchases"" FROM ""Stocks"" AS ""S2"" WHERE ""operation""='Buy' GROUP BY ""S2"".""stock_name"") AS ""S2"" ON ""S1"".""stock_name""=""S2"".""stock_name"" WHERE ""operation""='Sell' GROUP BY ""S1"".""stock_name"") AS ""results"""
68,"SELECT ""s"".""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" AS ""s"" GROUP BY ""stock_name"""
69,"WITH ""cte"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""rn"" FROM ""Stocks"") SELECT ""y"".""stock_name"",""sell_p""-""buy_p"" AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""sell_p"" FROM ""cte"" WHERE ""rn""%2=0 GROUP BY 1) AS ""x"" LEFT JOIN (SELECT ""stock_name"",SUM(""price"") AS ""buy_p"" FROM ""cte"" WHERE ""rn""%2!=0 GROUP BY 1) AS ""y"" ON ""x"".""stock_name""=""y"".""stock_name"""
70,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
71,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
72,"SELECT ""stock_name"",(""total_sales""-""total_purchases"") AS ""capital_gain_loss"" FROM (SELECT ""S1"".""stock_name"",SUM(""price"") AS ""total_sales"",""S2"".""total_purchases"" FROM ""Stocks"" AS ""S1"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""total_purchases"" FROM ""Stocks"" AS ""S2"" WHERE ""operation""='Buy' GROUP BY ""S2"".""stock_name"") AS ""S2"" ON ""S1"".""stock_name""=""S2"".""stock_name"" WHERE ""operation""='Sell' GROUP BY ""S1"".""stock_name"") AS ""results"""
73,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
74,"WITH ""t1"" AS (SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price"" END) AS ""Bought"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" END) AS ""sold"" FROM ""Stocks"" GROUP BY ""stock_name"") SELECT ""stock_name"",(""sold""-""Bought"") AS ""capital_gain_loss"" FROM ""t1"""
75,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
76,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
77,"SELECT ""stock_name"",SUM(""price_with_sign"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END AS ""price_with_sign"" FROM ""Stocks"") AS ""a"" GROUP BY ""stock_name"""
78,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"" ORDER BY ""capital_gain_loss"" DESC"
79,"SELECT ""stock_name"",(""sell""-""buy"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price"" END) AS ""buy"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" END) AS ""sell"" FROM ""Stocks"" GROUP BY ""stock_name"") AS ""A"""
80,"SELECT ""stock_name"",SUM(""unit_pnl"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",(CASE ""operation"" WHEN 'Buy' THEN -1*""price"" WHEN 'Sell' THEN ""price"" END) AS ""unit_pnl"" FROM ""Stocks"") AS ""t"" GROUP BY ""stock_name"""
81,"SELECT ""stock_name"",SUM(""diff"") AS ""capital_gain_loss"" FROM (SELECT *,""price""-LAG(""price"") OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""diff"" FROM ""stocks"") AS ""t"" WHERE ""operation""='Sell' GROUP BY 1 ORDER BY 2 DESC"
82,"SELECT DISTINCT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*-1 ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
83,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
84,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
85,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"" ORDER BY ""stock_name"""
86,"WITH ""b"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""buyorder"" FROM ""Stocks"" WHERE ""operation""='Buy'), ""s"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""sellorder"" FROM ""Stocks"" WHERE ""operation""='Sell') SELECT ""b"".""stock_name"",SUM(""s"".""price""-""b"".""price"") AS ""capital_gain_loss"" FROM ""b"" JOIN ""s"" ON ""b"".""stock_name""=""s"".""stock_name"" AND ""b"".""buyorder""=""s"".""sellorder"" GROUP BY 1"
87,"SELECT ""t"".""stock_name"",SUM(""t"".""next_price""-""t"".""price"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",""price"",LEAD(""price"") OVER (PARTITION BY ""stock_name"") AS ""next_price"" FROM ""Stocks"") AS ""t"" WHERE ""t"".""operation""='Buy' GROUP BY ""t"".""stock_name"""
88,"SELECT ""stock_name"",SUM((CASE ""operation"" WHEN 'Buy' THEN -""price"" WHEN 'Sell' THEN ""price"" ELSE 0 END)) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
89,"SELECT ""stock_name"",SUM(CASE ""operation"" WHEN 'Sell' THEN ""price"" ELSE ""price""*-1 END) AS ""capital_gain_loss"" FROM ""stocks"" AS ""s"" GROUP BY ""stock_name"""
90,"SELECT ""s"".""stock_name"",SUM(CASE WHEN ""s"".""operation""='Sell' THEN ""s"".""price"" WHEN ""s"".""operation""='Buy' THEN (-1)*""s"".""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" AS ""s"" GROUP BY ""stock_name"""
91,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
92,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
93,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
94,"WITH ""cte"" AS (SELECT ""stock_name"",""buyday"",MIN(""sellday""),""buyp"",""sellp"" FROM (SELECT ""s1"".""stock_name"",""s1"".""operation_day"" AS ""buyday"",""s2"".""operation_day"" AS ""sellday"",""s1"".""price"" AS ""buyp"",""s2"".""price"" AS ""sellp"",""s1"".""operation"" AS ""op1"",""s2"".""operation"" AS ""op2"" FROM ""stocks"" AS ""s1"" JOIN ""stocks"" AS ""s2"" ON ""s1"".""stock_name""=""s2"".""stock_name"" AND ""s1"".""operation_day""<""s2"".""operation_day"" AND ""s1"".""operation""='Buy') AS ""s"" WHERE (""op1""!=""op2"") AND ""buyday""<""sellday"" GROUP BY ""stock_name"",""buyday"") SELECT ""stock_name"",SUM(""sellp"")-SUM(""buyp"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY ""stock_name"""
95,"SELECT ""stock_name"",SUM(""gain_loss"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",CASE WHEN ""operation""='Sell' THEN ""price"" WHEN ""operation""='Buy' THEN ""price""*(-1) ELSE 0 END AS ""gain_loss"" FROM ""Stocks"") AS ""t"" GROUP BY ""stock_name"""
96,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
97,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
98,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
99,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
100,"SELECT ""buy"".""stock_name"",(""sell"".""sell_price""-""buy"".""buy_price"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""buy_price"" FROM ""stocks"" WHERE ""operation""='buy' GROUP BY ""stock_name"") AS ""buy"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""sell_price"" FROM ""stocks"" WHERE ""operation""='sell' GROUP BY ""stock_name"") AS ""sell"" ON ""buy"".""stock_name""=""sell"".""stock_name"""
101,"SELECT ""stock_name"",SUM(""price""*""sign"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""price"",CASE WHEN ""operation""='Buy' THEN -1 ELSE 1 END AS ""sign"" FROM ""stocks"") AS ""sub"" GROUP BY ""stock_name"""
102,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
103,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
104,"WITH ""cte"" AS (SELECT ""stock_name"",(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""cost"" FROM ""stocks"") SELECT ""stock_name"",SUM(""cost"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY ""stock_name"""
105,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
106,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
107,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
108,"SELECT ""s"".""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" AS ""s"" GROUP BY 1"
109,"WITH ""t"" AS (SELECT ""stock_name"",(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""price"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""price"") AS ""capital_gain_loss"" FROM ""t"" GROUP BY ""stock_name"""
110,"SELECT ""stock_name"",(SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE NULL END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE NULL END)) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
111,"SELECT ""stock_name"",(""total_sales""-""total_purchases"") AS ""capital_gain_loss"" FROM (SELECT ""S1"".""stock_name"",SUM(""price"") AS ""total_sales"",""S2"".""total_purchases"" FROM ""Stocks"" AS ""S1"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""total_purchases"" FROM ""Stocks"" AS ""S2"" WHERE ""operation""='Buy' GROUP BY ""S2"".""stock_name"") AS ""S2"" ON ""S1"".""stock_name""=""S2"".""stock_name"" WHERE ""operation""='Sell' GROUP BY ""S1"".""stock_name"") AS ""results"""
112,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
113,"WITH ""cte"" AS (SELECT ""stock_name"",""buyday"",MIN(""sellday""),""buyp"",""sellp"" FROM (SELECT ""s1"".""stock_name"",""s1"".""operation_day"" AS ""buyday"",""s2"".""operation_day"" AS ""sellday"",""s1"".""price"" AS ""buyp"",""s2"".""price"" AS ""sellp"",""s1"".""operation"" AS ""op1"",""s2"".""operation"" AS ""op2"" FROM ""stocks"" AS ""s1"" JOIN ""stocks"" AS ""s2"" ON ""s1"".""stock_name""=""s2"".""stock_name"" AND ""s1"".""operation_day""<""s2"".""operation_day"") AS ""s"" WHERE (""op1""!=""op2"" AND ""op1""='Buy') AND ""buyday""<""sellday"" GROUP BY ""stock_name"",""buyday"") SELECT ""stock_name"",SUM(""sellp"")-SUM(""buyp"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY ""stock_name"""
114,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE (-1)*""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
115,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
116,"WITH ""cte1"" AS (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN -""price"" WHEN ""operation""='Sell' THEN ""price"" END AS ""b_s"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""b_s"") AS ""capital_gain_loss"" FROM ""cte1"" GROUP BY ""stock_name"""
117,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
118,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
119,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
120,"SELECT ""stock_name"",SUM(CASE ""operation"" WHEN 'Buy' THEN ""price""*-1 WHEN 'sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
121,"SELECT ""s"".""stock_name"",SUM(CASE WHEN (""s"".""operation""='Buy') THEN -1*""s"".""price"" ELSE ""s"".""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" AS ""s"" GROUP BY ""s"".""stock_name"""
122,"WITH ""temp1"" AS (SELECT ""stock_name"",""operation"",""operation_day"",""price"",LAG(""price"") OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""prev_buy_price"" FROM ""Stocks""), ""sell_table"" AS (SELECT * FROM ""temp1"" WHERE ""operation""='Sell') SELECT ""stock_name"",SUM((CAST(""price"" AS INTEGER)-CAST(""prev_buy_price"" AS INTEGER))) AS ""capital_gain_loss"" FROM ""sell_table"" GROUP BY 1 ORDER BY 2"
123,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
124,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN ""price""*-1 ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
125,"WITH ""cte"" AS (SELECT *,CASE WHEN ""operation""='Buy' THEN ""price""*(-1) ELSE ""price"" END AS ""price2"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""price2"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY ""stock_name"""
126,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
127,"WITH ""CTE"" AS (SELECT ""stock_name"",""operation"",""price"",CASE WHEN ""operation""='buy' THEN ""price""*-1 ELSE ""price"" END AS ""real_price"" FROM ""stocks"") SELECT ""stock_name"",SUM(""real_price"") AS ""capital_gain_loss"" FROM ""CTE"" GROUP BY ""stock_name"""
128,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
129,"SELECT ""a"".""stock_name"",SUM(""price"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",CASE WHEN ""operation""='buy' THEN -1*""price"" ELSE ""price"" END AS ""price"" FROM ""stocks"") AS ""a"" GROUP BY ""a"".""stock_name"""
130,"SELECT ""buy"".""stock_name"",COALESCE(""sp"", 0)-""cp"" AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""cp"" FROM ""Stocks"" WHERE ""operation""='Buy' GROUP BY 1) AS ""buy"" LEFT JOIN (SELECT ""stock_name"",SUM(""price"") AS ""sp"" FROM ""Stocks"" WHERE ""operation""='Sell' GROUP BY 1) AS ""sell"" ON ""buy"".""stock_name""=""sell"".""stock_name"""
131,"SELECT ""S1"".""stock_name"",(""S2"".""total""-""S1"".""total"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""total"" FROM ""Stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""S1"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""total"" FROM ""Stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""S2"" USING (""stock_name"")"
132,"SELECT ""A"".""Stock_Name"",(""A"".""Sell""-""B"".""Buy"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""Sell"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""A"" LEFT JOIN (SELECT ""stock_name"",SUM(""price"") AS ""Buy"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""B"" ON ""A"".""stock_name""=""B"".""stock_name"""
133,"SELECT ""t1"".""stock_name"",(""t2"".""sellP""-""t1"".""buyP"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""buyP"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""t1"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""sellP"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""t2"" ON ""t1"".""stock_name""=""t2"".""stock_name"""
134,"WITH ""a"" AS (SELECT DISTINCT ""stock_name"",""operation_day"",""price"",ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""seq"" FROM ""Stocks"" WHERE ""operation""='Buy' ORDER BY 1,2), ""b"" AS (SELECT DISTINCT ""stock_name"",""operation_day"",""price"",ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""seq"" FROM ""Stocks"" WHERE ""operation""='Sell' ORDER BY 1,2) SELECT ""a"".""stock_name"",SUM(""b"".""price""-""a"".""price"") AS ""capital_gain_loss"" FROM ""a"" LEFT JOIN ""b"" ON ""a"".""stock_name""=""b"".""stock_name"" AND ""a"".""seq""=""b"".""seq"" GROUP BY 1 ORDER BY 1"
135,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
136,"WITH ""gains"" AS (SELECT ""stock_name"",""operation"",""operation_day"",""price"",LAG(""price"") OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""last_price"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""price""-""last_price"") AS ""capital_gain_loss"" FROM ""gains"" WHERE ""operation""='Sell' GROUP BY ""stock_name"""
137,"SELECT DISTINCT ""stock_name"",SUM(""capital_gain_loss"") OVER (PARTITION BY ""stock_name"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN ""price""*(-1) WHEN ""operation""='Sell' THEN ""price""*(1) END AS ""capital_gain_loss"" FROM ""Stocks"") AS ""A"""
138,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
139,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
140,"SELECT ""stock_name"",(SUM(CASE WHEN ""operation""='sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='buy' THEN ""price"" ELSE 0 END)) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
141,"WITH ""temp"" AS (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN -SUM(""price"") ELSE SUM(""price"") END AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"",""operation"") SELECT ""stock_name"",SUM(""capital_gain_loss"") AS ""capital_gain_loss"" FROM ""temp"" GROUP BY ""stock_name"""
142,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
143,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE NULL END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE NULL END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
144,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
145,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
146,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
147,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
148,"SELECT ""Stocks"".""stock_name"",""gain""+""loss"" AS ""capital_gain_loss"" FROM (""Stocks"" LEFT JOIN (SELECT ""stock_name"",-SUM(""price"") AS ""loss"" FROM ""Stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""loss_stocks"" ON ""Stocks"".""stock_name""=""loss_stocks"".""stock_name"") LEFT JOIN (SELECT ""stock_name"",SUM(""price"") AS ""gain"" FROM ""Stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""gains_stocks"" ON ""Stocks"".""stock_name""=""gains_stocks"".""stock_name"" GROUP BY ""Stocks"".""stock_name"""
149,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
150,"SELECT ""stock_name"",SUM((CASE WHEN ""operation""='Buy' THEN -1 ELSE 1 END)*""price"") AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
151,"WITH ""t1"" AS (SELECT *,CASE WHEN ""operation""='Buy' THEN ""price""*-1 ELSE ""price"" END AS ""capital"" FROM ""Stocks"") SELECT DISTINCT ""stock_name"",SUM(""capital"") AS ""capital_gain_loss"" FROM ""t1"" GROUP BY ""stock_name"""
152,"SELECT ""stock_name"",SUM(""t"".""diff"") AS ""capital_gain_loss"" FROM (SELECT *,""price""-LAG(""price"") OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""diff"" FROM ""stocks"") AS ""t"" WHERE ""t"".""operation""='Sell' GROUP BY 1 ORDER BY 2 DESC"
153,"SELECT ""stock_name"",SUM(""amount"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",(CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END) AS ""amount"" FROM ""Stocks"") AS ""temp"" GROUP BY 1"
154,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
155,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
156,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
157,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
158,"SELECT ""stock_name"",(SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END)) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
159,"SELECT ""stock_name"",SUM(""price"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",""operation_day"",CASE WHEN ""operation""='Buy' THEN (-1*""price"") ELSE ""price"" END AS ""price"" FROM ""stocks"" AS ""s"") AS ""agg"" GROUP BY 1"
160,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
161,"WITH ""temp"" AS (SELECT ""a"".""stock_name"",""a"".""operation"",""a"".""price"" AS ""buy_price"",""b"".""price"" AS ""sell_price"",""a"".""operation_day"" AS ""buy_day"",""b"".""operation_day"" AS ""sell_day"" FROM ""Stocks"" AS ""a"" JOIN ""Stocks"" AS ""b"" ON ""a"".""stock_name""=""b"".""stock_name"" AND ""a"".""operation_day""<""b"".""operation_day"" AND ""a"".""operation""!=""b"".""operation"" WHERE ""a"".""operation""='Buy' AND ""b"".""operation""='Sell') SELECT ""stock_name"",SUM(""sell_price""-""buy_price"") AS ""capital_gain_loss"" FROM ""temp"" WHERE ROW(""stock_name"",""buy_day"",""sell_day"") IN (SELECT ""stock_name"",""buy_day"",MIN(""sell_day"") AS ""sell_day"" FROM ""temp"" GROUP BY ""stock_name"",""buy_day"") GROUP BY 1"
162,"SELECT ""stock_name"",SUM(""capital_gain_loss"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",CASE WHEN ""operation""='Buy' THEN (SUM(""price"")*(-1)) ELSE SUM(""price"") END AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"",""operation"") AS ""r"" GROUP BY ""stock_name"""
163,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -1*""price"" WHEN ""operation""='sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
164,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' AND ""operation_day""<""max_day"" THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM (SELECT *,MAX(""operation_day"") OVER (PARTITION BY ""stock_name"") AS ""max_day"" FROM ""Stocks"") AS ""S1"" GROUP BY ""stock_name"""
165,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
166,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"" ORDER BY 2 DESC"
167,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
168,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
169,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
170,"SELECT ""B"".""stock_name"",""B"".""capital_gain_loss"" FROM (SELECT ""A"".""stock_name"",""A"".""operation_day"",SUM(""A"".""price"") OVER (PARTITION BY ""A"".""stock_name"" ORDER BY ""A"".""operation_day"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",""operation_day"",(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""price"" FROM ""Stocks"") AS ""A"") AS ""B"" WHERE ROW(""B"".""stock_name"",""B"".""operation_day"") IN (SELECT ""stock_name"",MAX(""operation_day"") FROM ""Stocks"" GROUP BY ""stock_name"")"
171,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
172,"SELECT ""a"".""stock_name"",SUM(""a"".""new_price"") AS ""capital_gain_loss"" FROM (SELECT *,CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END AS ""new_price"" FROM ""Stocks"") AS ""a"" GROUP BY ""a"".""stock_name"""
173,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
174,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE (-1)*""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
175,"SELECT ""a"".""stock_name"",""b"".""amount""-""a"".""amount"" AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""amount"" FROM ""stocks"" GROUP BY ""stock_name"",""operation"") AS ""a"", (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""amount"" FROM ""stocks"" GROUP BY ""stock_name"",""operation"") AS ""b"" WHERE ""a"".""stock_name""=""b"".""stock_name"" AND ""a"".""operation""='Buy' AND ""b"".""operation""='Sell'"
176,"SELECT ""t1"".""stock_name"",SUM(""t2"".""total_sell""-""t1"".""total_buy"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""total_buy"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""t1"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""total_sell"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""t2"" ON ""t1"".""stock_name""=""t2"".""stock_name"" GROUP BY ""stock_name"""
177,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*(-1) ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
178,"WITH ""a"" AS (SELECT ""stock_name"",CASE WHEN ""operation""='Sell' THEN ""price"" ELSE ""price""*(-1) END AS ""gain_loss"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""gain_loss"") AS ""capital_gain_loss"" FROM ""a"" GROUP BY ""stock_name"""
179,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
180,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
181,"SELECT ""stock_name"",SUM(""amount"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",CASE WHEN ""operation""='buy' THEN ""price""*(-1) ELSE ""price"" END AS ""amount"" FROM ""Stocks"") AS ""tmp"" GROUP BY 1"
182,"SELECT ""S"".""stock_name"",(""S"".""PS""-""B"".""PB"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""PS"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""S"" LEFT JOIN (SELECT ""stock_name"",SUM(""price"") AS ""PB"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""B"" ON ""S"".""stock_name""=""B"".""stock_name"""
183,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
184,"WITH ""temp_tab"" AS (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""price"" FROM ""stocks"" GROUP BY ""stock_name"",""operation"") SELECT ""a"".""stock_name"",(""b"".""price""-""a"".""price"") AS ""capital_gain_loss"" FROM ""temp_tab"" AS ""a"" JOIN ""temp_tab"" AS ""b"" ON ""a"".""stock_name""=""b"".""stock_name"" WHERE ""a"".""operation""='Buy' AND ""b"".""operation""='Sell' GROUP BY ""a"".""stock_name"""
185,"SELECT ""a"".""stock_name"",""total_sell""-""total_buy"" AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""total_sell"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY 1) AS ""a"" LEFT JOIN (SELECT ""stock_name"",SUM(""price"") AS ""total_buy"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY 1) AS ""b"" ON ""a"".""stock_name""=""b"".""stock_name"""
186,"WITH ""cte"" AS (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN ""price""*(-1) WHEN ""operation""='Sell' THEN ""price"" END AS ""pr"" FROM ""stocks"") SELECT ""stock_name"",SUM(""pr"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY ""stock_name"""
187,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
188,"SELECT ""stock_name"",SUM(""price1"") AS ""capital_gain_loss"" FROM (SELECT *,CASE WHEN ""operation""='Buy' THEN -1.0*""price"" WHEN ""operation""='Sell' THEN 1.0*""price"" END AS ""price1"" FROM ""Stocks"") AS ""t"" GROUP BY 1 ORDER BY 2 DESC"
189,"SELECT ""stock_name"",SUM(""t"".""diff"") AS ""capital_gain_loss"" FROM (SELECT *,""price""-LAG(""price"") OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""diff"" FROM ""stocks"") AS ""t"" WHERE ""t"".""operation""='Sell' GROUP BY 1 ORDER BY 2 DESC"
190,"SELECT ""stock_name"",SUM(""price""*CASE WHEN ""operation""='Buy' THEN -1 ELSE 1 END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
191,"SELECT ""stock_name"",SUM(""value"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END AS ""value"" FROM ""Stocks"") AS ""temp"" GROUP BY ""stock_name"""
192,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
193,"WITH ""buys"" AS (SELECT ""stock_name"",""price"",ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""rownum"" FROM ""stocks"" WHERE ""operation""='Buy'), ""sells"" AS (SELECT ""stock_name"",""price"",ROW_NUMBER() OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""rownum"" FROM ""stocks"" WHERE ""operation""='Sell'), ""joined"" AS (SELECT ""b"".""stock_name"",SUM(""s"".""price""-""b"".""price"") AS ""cap_sum"" FROM ""buys"" AS ""b"" JOIN ""sells"" AS ""s"" ON ""b"".""stock_name""=""s"".""stock_name"" AND ""b"".""rownum""=""s"".""rownum"" GROUP BY ""b"".""stock_name"") SELECT ""stock_name"",SUM(""cap_sum"") AS ""capital_gain_loss"" FROM ""joined"" GROUP BY ""stock_name"""
194,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE ""price""*(-1) END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
195,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
196,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
197,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE ""price""*(-1) END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
198,"WITH ""cte"" AS (SELECT ""stock_name"",""operation"",""operation_day"",CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END AS ""new_price"" FROM ""Stocks"" ORDER BY ""operation_day"") SELECT ""stock_name"",SUM(""new_price"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY 1"
199,"SELECT ""stock_name"",SUM(CASE WHEN ""operation"" LIKE 'B%' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
200,"SELECT DISTINCT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) OVER (PARTITION BY ""stock_name"") AS ""capital_gain_loss"" FROM ""stocks"""
201,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
202,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
203,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
204,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
205,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
206,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
207,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
208,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
209,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
210,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
211,"WITH ""cte"" AS (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""price"" FROM ""Stocks"" GROUP BY 1,2) SELECT ""a"".""stock_name"",""b"".""price""-""a"".""price"" AS ""capital_gain_loss"" FROM (""cte"" AS ""a"") JOIN ""cte"" AS ""b"" WHERE ""a"".""stock_name""=""b"".""stock_name"" AND ""a"".""operation""='Buy' AND ""b"".""operation""='Sell'"
212,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE NULL END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE NULL END) AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""price"" FROM ""stocks"" GROUP BY ""stock_name"",""operation"") AS ""a"" GROUP BY ""stock_name"""
213,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*-1 ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
214,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
215,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
216,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
217,"WITH ""t"" AS (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END AS ""price"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""price"") AS ""capital_gain_loss"" FROM ""t"" GROUP BY ""stock_name"""
218,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
219,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
220,"WITH ""cte"" AS (SELECT *,LAG(""price"") OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""lag_price"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""price""-""lag_price"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY ""stock_name"",""operation"" HAVING ""operation""='Sell'"
221,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE NULL END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE NULL END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
222,"WITH ""cte"" AS (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN -""price"" WHEN ""operation""='Sell' THEN ""price"" END AS ""price"" FROM ""Stocks"") SELECT ""stock_name"",SUM(""price"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY 1 ORDER BY 2 DESC"
223,"SELECT ""t1"".""stock_name"",""t2"".""price2""-""t1"".""price1"" AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""price1"" FROM ""stocks"" GROUP BY ""stock_name"",""operation"") AS ""t1"" JOIN (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""price2"" FROM ""stocks"" GROUP BY ""stock_name"",""operation"") AS ""t2"" ON ""t1"".""stock_name""=""t2"".""stock_name"" AND ""t1"".""operation""='Buy' AND ""t2"".""operation""='Sell'"
224,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*-1 ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
225,"SELECT ""a"".""stock_name"",(""a"".""sell""-""b"".""buy"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""sell"" FROM ""stocks"" WHERE ""operation""='sell' GROUP BY ""stock_name"") AS ""a"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""buy"" FROM ""stocks"" WHERE ""operation""='buy' GROUP BY ""stock_name"") AS ""b"" ON ""a"".""stock_name""=""b"".""stock_name"""
226,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
227,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
228,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN ""price""*-1 WHEN ""operation""='sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
229,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
230,"SELECT ""stock_name"",SUM(""price""*(""operation""='Sell'))-SUM(""price""*(""operation""='Buy')) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
231,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
232,"SELECT ""stock_name"",SUM(""abc"") AS ""capital_gain_loss"" FROM (SELECT *,CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END AS ""abc"" FROM ""stocks"") AS ""t"" GROUP BY ""stock_name"""
233,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
234,"SELECT ""stock_name"",SUM(""t"".""diff"") AS ""capital_gain_loss"" FROM (SELECT *,""price""-LAG(""price"") OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""diff"" FROM ""stocks"") AS ""t"" WHERE ""t"".""operation""='Sell' GROUP BY 1 ORDER BY 2 DESC"
235,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*(-1) ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"" ORDER BY ""stock_name"""
236,"WITH ""cte"" AS (SELECT ""s"".""stock_name"",SUM(""s"".""price"") AS ""total_buy"" FROM ""stocks"" AS ""s"" WHERE ""s"".""operation""='Buy' GROUP BY ""s"".""stock_name""), ""cte2"" AS (SELECT ""s"".""stock_name"",SUM(""s"".""price"") AS ""total_sell"" FROM ""stocks"" AS ""s"" WHERE ""s"".""operation""='Sell' GROUP BY ""s"".""stock_name"") SELECT ""cte"".""stock_name"",""total_sell""-""total_buy"" AS ""capital_gain_loss"" FROM ""cte"" JOIN ""cte2"" ON ""cte"".""stock_name""=""cte2"".""stock_name"" GROUP BY ""cte"".""stock_name"""
237,"SELECT ""B"".""STOCK_NAME"",(""S"".""PRICE_SUM""-""B"".""PRICE_SUM"") AS ""CAPITAL_GAIN_LOSS"" FROM (SELECT SUM(""PRICE"") AS ""PRICE_SUM"",""STOCK_NAME"" FROM ""STOCKS"" WHERE ""OPERATION""='Sell' GROUP BY ""STOCK_NAME"") AS ""S"", (SELECT SUM(""PRICE"") AS ""PRICE_SUM"",""STOCK_NAME"" FROM ""STOCKS"" WHERE ""OPERATION""='Buy' GROUP BY ""STOCK_NAME"") AS ""B"" WHERE ""B"".""STOCK_NAME""=""S"".""STOCK_NAME"""
238,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""Price"" ELSE -""Price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
239,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
240,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
241,"WITH ""temp"" AS (SELECT ""stock_name"",""operation"",SUM(""Price"") AS ""Price_Total"" FROM ""Stocks"" GROUP BY ""stock_name"",""operation"") SELECT ""a"".""stock_name"" AS ""stock_name"",SUM((""b"".""Price_total""-""a"".""Price_total"")) AS ""capital_gain_loss"" FROM ""temp"" AS ""a"" JOIN (SELECT ""stock_name"",""Price_Total"" FROM ""temp"" WHERE ""operation""='Sell') AS ""b"" ON ""a"".""stock_name""=""b"".""stock_name"" WHERE ""operation""='Buy' GROUP BY ""a"".""stock_name"""
242,"WITH ""cte"" AS (SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"") SELECT * FROM ""cte"""
243,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
244,"SELECT ""stock_name"",""selltotal""-""buytotal"" AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""buytotal"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END) AS ""selltotal"" FROM ""Stocks"" GROUP BY ""stock_name"") AS ""t"""
245,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*(-1) ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
246,"WITH ""temp"" AS (SELECT ""stock_name"",""operation"",SUM(""Price"") AS ""Price_Total"" FROM ""Stocks"" GROUP BY ""stock_name"",""operation"") SELECT ""a"".""stock_name"",(""b"".""Price_total""-""a"".""Price_total"") AS ""capital_gain_loss"" FROM ""temp"" AS ""a"" JOIN (SELECT ""stock_name"",""Price_Total"" FROM ""temp"" WHERE ""operation""='Sell') AS ""b"" ON ""a"".""stock_name""=""b"".""stock_name"" WHERE ""operation""='Buy'"
247,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
248,"SELECT ""s"".""stock_name"",""sell"".""sm""-""buy"".""sm"" AS ""capital_gain_loss"" FROM ((""Stocks"" AS ""s"") JOIN (SELECT ""stock_name"",SUM(""price"") AS ""sm"" FROM ""Stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""buy"") JOIN (SELECT ""stock_name"",SUM(""price"") AS ""sm"" FROM ""Stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""sell"" WHERE ""s"".""stock_name""=""buy"".""stock_name"" AND ""s"".""stock_name""=""sell"".""stock_name"" GROUP BY ""s"".""stock_name"""
249,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*-1 ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
250,"WITH ""cte"" AS (SELECT ""stock_name"",""operation"",SUM(CASE WHEN ""operation""='Buy' THEN ""price"" END) AS ""buying_price"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" END) AS ""selling_price"" FROM ""Stocks"" GROUP BY 1,2) SELECT ""stock_name"",SUM(""selling_price"")-SUM(""buying_price"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY 1 ORDER BY 1"
251,"WITH ""cte"" AS (SELECT ""stock_name"",""operation"",""operation_day"",CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END AS ""updated_price"" FROM ""stocks"") SELECT DISTINCT ""stock_name"",SUM(""updated_price"") OVER (PARTITION BY ""stock_name"") AS ""capital_gain_loss"" FROM ""cte"""
252,"SELECT ""stock_name"",SUM(""sell_price""-""price"") AS ""capital_gain_loss"" FROM (SELECT *,LEAD(""price"") OVER (PARTITION BY ""stock_name"" ORDER BY ""operation_day"") AS ""sell_price"" FROM ""Stocks"") AS ""t"" WHERE ""operation""='Buy' GROUP BY 1"
253,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1 ORDER BY 1"
254,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""Stock_name"" ORDER BY ""operation_day"""
255,"SELECT ""stock_name"",SUM(""m"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END AS ""m"" FROM ""stocks"") AS ""a"" GROUP BY ""stock_name"""
256,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE NULL END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE NULL END) AS ""capital_gain_loss"" FROM ""Stocks"" AS ""s"" GROUP BY 1"
257,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
258,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
259,"SELECT ""stock_name"",SUM(""seller_price"")-SUM(""buyer_price"") AS ""capital_gain_loss"" FROM (SELECT ""s"".*,CASE WHEN ""s"".""operation""='Buy' THEN ""price"" ELSE 0 END AS ""buyer_price"",CASE WHEN ""s"".""operation""='Sell' THEN ""price"" ELSE 0 END AS ""seller_price"" FROM ""Stocks"" AS ""s"") AS ""a"" GROUP BY 1"
260,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
261,"SELECT ""sell"".""stock_name"" AS ""stock_name"",""sell"".""cost""-""buy"".""cost"" AS ""capital_gain_loss"" FROM (SELECT SUM(""sell"".""price"") AS ""cost"",""sell"".""stock_name"" FROM ""Stocks"" AS ""sell"" WHERE ""sell"".""operation""='Sell' GROUP BY ""sell"".""stock_name"") AS ""sell"" JOIN (SELECT SUM(""buy"".""price"") AS ""cost"",""buy"".""stock_name"" FROM ""Stocks"" AS ""buy"" WHERE ""buy"".""operation""='Buy' GROUP BY ""buy"".""stock_name"") AS ""buy"" ON ""sell"".""stock_name""=""buy"".""stock_name"""
262,"SELECT * FROM (SELECT ""stock_name"",(""sale""-""purchase"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(CASE WHEN ""operation"" IN ('Sell') THEN ""price"" ELSE 0 END) AS ""sale"",SUM(CASE WHEN ""operation"" IN ('Buy') THEN ""price"" ELSE 0 END) AS ""purchase"" FROM ""Stocks"" GROUP BY 1) AS ""a"") AS ""b"" ORDER BY ""capital_gain_loss"" DESC"
263,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
264,"SELECT ""stock_name"",""capital_gain_loss"" FROM (SELECT ""stock_name"",""total""-LEAD(""total"", 1) OVER (PARTITION BY ""stock_name"" ORDER BY ""operation"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""total"" FROM ""stocks"" GROUP BY ""stock_name"",""operation"") AS ""t"") AS ""t1"" WHERE ""capital_gain_loss"" IS NOT NULL"
265,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
266,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
267,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE ""price""*-1 END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
268,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
269,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
270,"WITH ""buy"" AS (SELECT *,DENSE_RANK() OVER (ORDER BY ""stock_name"",""operation_day"") AS ""my_rank"" FROM ""stocks"" WHERE ""operation""='buy'), ""sell"" AS (SELECT *,DENSE_RANK() OVER (ORDER BY ""stock_name"",""operation_day"") AS ""my_rank"" FROM ""stocks"" WHERE ""operation""='sell') SELECT ""b"".""stock_name"",SUM(CASE WHEN ""b"".""operation_day""<""s"".""operation_day"" AND ""b"".""my_rank""=""s"".""my_rank"" THEN ""s"".""price""-""b"".""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""buy"" AS ""b"" JOIN ""sell"" AS ""s"" ON ""b"".""stock_name""=""s"".""stock_name"" GROUP BY 1"
271,"WITH ""t"" AS (SELECT ""stock_name"",""operation"",""operation_day"",CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END AS ""updated_price"" FROM ""stocks"") SELECT ""stock_name"",SUM(""updated_price"") AS ""capital_gain_loss"" FROM ""t"" GROUP BY ""stock_name"""
272,"WITH ""S0"" AS (SELECT ""stock_name"",""operation_day"",""price"" FROM ""Stocks"" WHERE ""operation""='Buy' ORDER BY ""stock_name"",""operation_day""), ""S1"" AS (SELECT ROW_NUMBER() OVER (ORDER BY ""stock_name"",""operation_day"") AS ""id"",""stock_name"",""price"" AS ""buy_price"" FROM ""S0""), ""S2"" AS (SELECT ""stock_name"",""operation_day"",""price"" FROM ""Stocks"" WHERE ""operation""='Sell' ORDER BY ""stock_name"",""operation_day""), ""S3"" AS (SELECT ROW_NUMBER() OVER (ORDER BY ""stock_name"",""operation_day"") AS ""id"",""stock_name"",""price"" AS ""sell_price"" FROM ""S2"") SELECT ""S1"".""stock_name"",SUM(""sell_price""-""buy_price"") AS ""capital_gain_loss"" FROM ""S1"" JOIN ""S3"" ON ""S1"".""id""=""S3"".""id"" GROUP BY ""S1"".""stock_name"""
273,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='BUY' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
274,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" WHEN ""operation""='Buy' THEN -""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
275,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
276,"SELECT DISTINCT (""t1"".""stock_name""),SUM(""t1"".""value"") OVER (PARTITION BY ""t1"".""stock_name"") AS ""capital_gain_loss"" FROM (SELECT *,CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE 1*""price"" END AS ""value"" FROM ""Stocks"") AS ""t1"" ORDER BY ""capital_gain_loss"""
277,"SELECT DISTINCT ""stock_name"",(SUM(CASE WHEN ""operation""='sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='buy' THEN ""price"" ELSE 0 END)) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
278,"WITH ""l"" AS (SELECT ""stock_name"",SUM(""price"") AS ""losses"" FROM ""stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name""), ""g"" AS (SELECT ""stock_name"",SUM(""price"") AS ""gains"" FROM ""stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") SELECT ""g"".""stock_name"",""g"".""gains""-""l"".""losses"" AS ""capital_gain_loss"" FROM ""g"" JOIN ""l"" ON ""g"".""stock_name""=""l"".""stock_name"""
279,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
280,"WITH ""CTE"" AS (SELECT ""stock_name"",""operation"",CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END AS ""price_new"" FROM ""stocks"") SELECT DISTINCT ""stock_name"",SUM(""price_new"") OVER (PARTITION BY ""stock_name"") AS ""capital_gain_loss"" FROM ""CTE"""
281,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
282,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1 ELSE 1 END*""price"") AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
283,"SELECT ""s"".""stock_name"",""s"".""sell""-""b"".""buy"" AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""buy"" FROM ""Stocks"" WHERE ""operation""='Buy' GROUP BY ""stock_name"") AS ""b"" JOIN (SELECT ""stock_name"",SUM(""price"") AS ""sell"" FROM ""Stocks"" WHERE ""operation""='Sell' GROUP BY ""stock_name"") AS ""s"" ON ""b"".""stock_name""=""s"".""stock_name"""
284,"WITH ""cte"" AS (SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""buy_price"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END) AS ""sell_price"" FROM ""stocks"" GROUP BY ""stock_name"") SELECT ""stock_name"",""sell_price""-""buy_price"" AS ""capital_gain_loss"" FROM ""cte"""
285,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price""*-1 ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
286,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" END)+SUM(CASE WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
287,"WITH ""StockPurchaseAmout"" AS (SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""total_buy"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END) AS ""total_sell"" FROM ""Stocks"" GROUP BY ""stock_name"") SELECT ""stock_name"",""total_sell""-""total_buy"" AS ""capital_gain_loss"" FROM ""StockPurchaseAmout"""
288,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
289,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -1*""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
290,"WITH ""cte"" AS (SELECT * FROM ""Stocks"" WHERE ""operation""='Sell' UNION ALL SELECT ""stock_name"",""operation"",""operation_day"",""price""*-1 FROM ""Stocks"" WHERE ""operation""='Buy') SELECT ""stock_name"",SUM(""price"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY 1 ORDER BY 1"
291,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
292,"SELECT ""temp1"".""stock_name"",(""temp2"".""total""-""temp1"".""total"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",SUM(""price"") AS ""total"" FROM ""stocks"" WHERE ""operation""='buy' GROUP BY ""stock_name"") AS ""temp1"" LEFT JOIN (SELECT ""stock_name"",SUM(""price"") AS ""total"" FROM ""stocks"" WHERE ""operation""='sell' GROUP BY ""stock_name"") AS ""temp2"" ON ""temp1"".""stock_name""=""temp2"".""stock_name"" GROUP BY ""stock_name"""
293,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
294,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
295,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
296,"SELECT ""stock_name"",SUM(""amount"") AS ""capital_gain_loss"" FROM (SELECT ""stock_name"",CASE WHEN ""operation""='Buy' THEN ""price""*(-1) ELSE ""price"" END AS ""amount"" FROM ""stocks"") AS ""a"" GROUP BY ""stock_name"""
297,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
298,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
299,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
300,"WITH ""total"" AS (SELECT ""stock_name"",""operation"",SUM(""price"") AS ""price"" FROM ""Stocks"" GROUP BY 1,2) SELECT DISTINCT ""s"".""stock_name"",(""t1"".""price""-""t2"".""price"") AS ""capital_gain_loss"" FROM (""Stocks"" AS ""s"" JOIN ""total"" AS ""t1"" ON (""s"".""stock_name""=""t1"".""stock_name"" AND ""t1"".""operation""='Sell')) JOIN ""total"" AS ""t2"" ON (""s"".""stock_name""=""t2"".""stock_name"" AND ""t2"".""operation""='Buy')"
301,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY 1"
302,"SELECT DISTINCT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) OVER (PARTITION BY ""stock_name"") AS ""capital_gain_loss"" FROM ""Stocks"""
303,"WITH ""cte"" AS (SELECT ""stock_name"",""operation"",""operation_day"",CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END AS ""updated_price"" FROM ""stocks"") SELECT ""stock_name"",SUM(""updated_price"") AS ""capital_gain_loss"" FROM ""cte"" GROUP BY ""stock_name"""
304,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -1*""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY ""stock_name"""
305,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1 ORDER BY 1 DESC"
306,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE -""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" AS ""a"" GROUP BY 1"
307,"SELECT ""stock_name"",SUM(CASE ""operation"" WHEN 'Sell' THEN ""price"" END)-SUM(CASE ""operation"" WHEN 'Buy' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
308,"WITH ""casea"" AS (SELECT *,(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""proce"" FROM ""stocks"") SELECT ""stock_name"",SUM(""proce"") AS ""capital_gain_loss"" FROM ""casea"" GROUP BY ""stock_name"""
309,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" WHEN ""operation""='Sell' THEN ""price"" END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
310,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Buy' THEN -""price"" ELSE ""price"" END) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
311,"SELECT ""stock_name"",SUM(CASE WHEN ""operation""='Sell' THEN ""price"" ELSE 0 END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" ELSE 0 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""stock_name"""
312,"SELECT ""Stocks"".""stock_name"",SUM(""Stocks"".""price""*CASE WHEN ""Stocks"".""operation""='Buy' THEN -1 ELSE 1 END) AS ""capital_gain_loss"" FROM ""Stocks"" GROUP BY ""Stocks"".""stock_name"""
313,"SELECT ""stock_name"",(SUM(CASE WHEN ""operation""='Sell' THEN ""price"" END)-SUM(CASE WHEN ""operation""='Buy' THEN ""price"" END)) AS ""capital_gain_loss"" FROM ""stocks"" GROUP BY 1"
314,"SELECT ""stock_name"",SUM(""new_price"") AS ""capital_gain_loss"" FROM (SELECT *,CASE WHEN ""operation""='Buy' THEN (-1*""price"") ELSE (""price"") END AS ""new_price"" FROM ""stocks"") AS ""dudu"" GROUP BY ""stock_name"" ORDER BY ""capital_gain_loss"" DESC"
