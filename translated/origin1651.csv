id,original query
1,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""ridesStat"" AS (SELECT EXTRACT(MONTH FROM ""r1"".""requested_at"") AS ""month"",SUM(""a1"".""ride_distance"") AS ""distance"",SUM(""a1"".""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""a1"" LEFT JOIN ""Rides"" AS ""r1"" ON ""r1"".""ride_id""=""a1"".""ride_id"" WHERE ""r1"".""requested_at"" LIKE '2020%' GROUP BY 1), ""ridesStat2"" AS (SELECT ""c1"".""month"",COALESCE(ROUND(SUM(""r1"".""distance"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""r1"".""duration"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""cte"" AS ""c1"" LEFT JOIN ""ridesStat"" AS ""r1"" ON ""r1"".""month""=""c1"".""month"") SELECT * FROM ""ridesStat2"" WHERE ""month""<=10"
2,"WITH RECURSIVE ""temp1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""temp1"" WHERE ""month""<12), ""temp2"" AS (SELECT ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM (SELECT ""acceptedRides"".*,EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""temp"" GROUP BY ""month"" ORDER BY ""month"") SELECT ""month"",ROUND(""total_distance""/3, 2) AS ""average_ride_distance"",ROUND(""total_duration""/3, 2) AS ""average_ride_duration"" FROM (SELECT ""temp1"".""month"",SUM(COALESCE(""distance"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""total_distance"",SUM(COALESCE(""duration"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""total_duration"" FROM ""temp1"" LEFT JOIN ""temp2"" ON ""temp1"".""month""=""temp2"".""month"") AS ""temp3"" WHERE ""temp3"".""month""<=10"
3,"WITH RECURSIVE ""cte_sub"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte_sub"" WHERE ""month""<(SELECT MAX(EXTRACT(MONTH FROM ""requested_at"")) FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020')), ""cte"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COALESCE(SUM(""a"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""a"".""ride_duration""), 0) AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT * FROM (SELECT ""b"".""month"" AS ""month"",ROUND(AVG(COALESCE(""a"".""ride_distance"", 0)) OVER (ORDER BY ""b"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""a"".""ride_duration"", 0)) OVER (ORDER BY ""b"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte_sub"" AS ""b"" LEFT JOIN ""cte"" AS ""a"" ON ""a"".""month""=""b"".""month"") AS ""sub"" WHERE ""month""<=10"
4,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""Monthly"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT ""c"".""month"",ROUND(AVG(COALESCE(""m"".""monthly_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""m"".""monthly_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""c"" LEFT JOIN ""Monthly"" AS ""m"" ON ""c"".""month""=""m"".""month"" LIMIT 10"
5,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""t"".""month"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_distance"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_duration"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""t"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"") AS ""b"" ON ""t"".""month""=""b"".""month"" ORDER BY 1 LIMIT 10"
6,"WITH RECURSIVE ""mth"" AS (SELECT 1 AS ""mth"" UNION ALL SELECT ""mth""+1 FROM ""mth"" WHERE ""mth""+1<=12), ""cte"" AS (SELECT COALESCE(SUM(""a"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""a"".""ride_duration""), 0) AS ""ride_duration"",""m"".""mth"" FROM (""mth"" AS ""m"" LEFT JOIN ""rides"" AS ""r"" ON ""m"".""mth""=EXTRACT(MONTH FROM ""r"".""requested_at"")) LEFT JOIN ""acceptedrides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY 3 ORDER BY 3), ""cte1"" AS (SELECT ""mth"",""ride_distance"",LEAD(""ride_distance"", 1, 0) OVER () AS ""dis_lag1"",LEAD(""ride_distance"", 2, 0) OVER () AS ""dis_lag2"",""ride_duration"",LEAD(""ride_duration"", 1, 0) OVER () AS ""du_lag1"",LEAD(""ride_duration"", 2, 0) OVER () AS ""du_lag2"" FROM ""cte"") SELECT ""mth"" AS ""month"",ROUND((""ride_distance""+""dis_lag1""+""dis_lag2"")/3, 2) AS ""average_ride_distance"",ROUND((""ride_duration""+""du_lag1""+""du_lag2"")/3, 2) AS ""average_ride_duration"" FROM ""cte1"" WHERE ""mth""<11"
7,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month""-2 AS ""month"",ROUND(COALESCE(SUM(""a"".""ride_distance"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""a"".""ride_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM (""Months"" AS ""m"" LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month"">=TO_CHAR(""r"".""requested_at"", '%c') AND TO_CHAR(""r"".""requested_at"", '%c')>=(""m"".""month""-2)) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""m"".""month"">2 GROUP BY 1 ORDER BY 1"
8,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""a"" AS (SELECT RIGHT(LEFT(""requested_at"", 7), 2) AS ""ride_month"",""ride_distance"",""ride_duration"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"">='2020-01-01' AND ""requested_at""<='2020-12-31' ORDER BY ""requested_at""), ""c"" AS (SELECT ""ride_month"",SUM(""ride_distance"") AS ""sum_ride"",SUM(""ride_duration"") AS ""sum_time"" FROM ""a"" GROUP BY ""ride_month"") SELECT * FROM (SELECT ""month""-2 AS ""month"",ROUND(AVG(""sum_ride"") OVER (ORDER BY ""month"" ROWS BETWEEN 2 PRECEDING AND CURRENT ROW), 2) AS ""average_ride_distance"",ROUND(AVG(""sum_time"") OVER (ORDER BY ""month"" ROWS BETWEEN 2 PRECEDING AND CURRENT ROW), 2) AS ""average_ride_duration"" FROM (SELECT ""cte"".""month"",COALESCE(""sum_ride"", 0) AS ""sum_ride"",COALESCE(""sum_time"", 0) AS ""sum_time"" FROM ""cte"" LEFT JOIN ""c"" ON ""cte"".""month""=""c"".""ride_month"") AS ""temp"") AS ""temp2"" WHERE ""month"">0"
9,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""t"".""month"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_distance"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_duration"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""t"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"") AS ""b"" ON ""t"".""month""=""b"".""month"" ORDER BY 1 LIMIT 10"
10,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""temp1"" AS (SELECT ""acceptedrides"".""ride_id"",""ride_distance"",""ride_duration"",""requested_at"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""acceptedrides"" LEFT JOIN ""rides"" ON ""acceptedrides"".""ride_id""=""rides"".""ride_id"" WHERE ""requested_at"">='2020-01-01' AND ""requested_at""<'2021-01-01'), ""temp2"" AS (SELECT ""month"",SUM(""ride_distance"") AS ""sum_ride_distance"",SUM(""ride_duration"") AS ""sum_ride_duration"",COUNT(""ride_id"") AS ""num_rides"" FROM ""temp1"" GROUP BY ""month"" ORDER BY ""month""), ""temp3"" AS (SELECT ""month"".""month"",""sum_ride_distance"",""sum_ride_duration"" FROM ""month"" LEFT JOIN ""temp2"" ON ""month"".""month""=""temp2"".""month""), ""temp4"" AS (SELECT ""month"",CASE WHEN ""sum_ride_distance"" IS NOT NULL THEN ""sum_ride_distance"" ELSE 0 END AS ""sum_ride_distance"",CASE WHEN ""sum_ride_duration"" IS NOT NULL THEN ""sum_ride_duration"" ELSE 0 END AS ""sum_ride_duration"" FROM ""temp3"") SELECT ""x"".""month"",ROUND((""x"".""sum_ride_distance""+""y"".""sum_ride_distance""+""z"".""sum_ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""x"".""sum_ride_duration""+""y"".""sum_ride_duration""+""z"".""sum_ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ((""temp4"" AS ""x"") JOIN ""temp4"" AS ""y"") JOIN ""temp4"" AS ""z"" WHERE ""x"".""month""+1=""y"".""month"" AND ""z"".""month""=""y"".""month""+1 AND ""x"".""month""<=10 AND ""y"".""month""<=11 AND ""z"".""month""<=12"
11,"WITH RECURSIVE ""month_list"" (""month"") AS (SELECT 1 UNION SELECT ""month""+1 FROM ""month_list"" WHERE ""month""<12), ""main"" AS (SELECT ""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"",""requested_at"",""ride_id"" FROM (""month_list"" LEFT JOIN ""Rides"" ON EXTRACT(YEAR FROM ""requested_at"")=2020 AND EXTRACT(MONTH FROM ""requested_at"")=""month"") LEFT JOIN ""AcceptedRides"" USING (""ride_id"")) SELECT ""month"",ROUND((AVG(SUM(""ride_distance"")) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)), 2) AS ""average_ride_distance"",ROUND((AVG(SUM(""ride_duration"")) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)), 2) AS ""average_ride_duration"" FROM ""main"" GROUP BY ""month"" ORDER BY ""month"" LIMIT 10"
12,"WITH RECURSIVE ""cte"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""cte2"" AS (SELECT ""m"".""month"",""ride_distance"",""ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""cte"" AS ""c"" ON ""m"".""month""=""c"".""month""), ""cte3"" AS (SELECT ""month"",COALESCE(ROUND((SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND((SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2), 0) AS ""average_ride_duration"" FROM ""cte2"") SELECT ""month"",""average_ride_distance"",""average_ride_duration"" FROM ""cte3"" WHERE ""month""+2<=12"
13,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""combined"" AS (SELECT TO_CHAR(""r"".""requested_at"", '%m') AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_distance"",SUM(""ar"".""ride_duration"") AS ""ride_duration"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" USING (""ride_id"") WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT * FROM (SELECT ""m"".""month"",ROUND(AVG(COALESCE(""c"".""ride_distance"", 0)) OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""c"".""ride_duration"", 0)) OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""combined"" AS ""c"" RIGHT JOIN ""months"" AS ""m"" USING (""month"")) AS ""a"" WHERE ""month""<=10"
14,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""TEMP"" AS (SELECT DISTINCT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN (SELECT * FROM ""Rides"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" GROUP BY 1), ""TEMP2"" AS (SELECT ""m"".""month"",COALESCE(""TEMP"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""TEMP"".""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""TEMP"" ON ""m"".""month""=""TEMP"".""month"" ORDER BY 1) SELECT ""month"",ROUND((SUM(""ride_distance"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3), 2) AS ""average_ride_distance"",ROUND((SUM(""ride_duration"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3), 2) AS ""average_ride_duration"" FROM ""TEMP2"" GROUP BY 1 ORDER BY 1 LIMIT 10"
15,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""m"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND(SUM(""total_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""total_druation"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",COALESCE(""total_distance"", 0) AS ""total_distance"",COALESCE(""total_druation"", 0) AS ""total_druation"" FROM ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_druation"" FROM ""acceptedrides"" JOIN ""rides"" ON ""rides"".""ride_id""=""acceptedrides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1) AS ""d"" ON ""d"".""month""=""m"".""month"") AS ""src"") AS ""final"" WHERE ""month""<11"
16,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""cte"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month""), ""month_ride"" AS (SELECT ""m"".""month"",COALESCE(""c"".""ride_duration"", 0) AS ""ride_duration"",COALESCE(""c"".""ride_distance"", 0) AS ""ride_distance"" FROM ""cte"" AS ""c"" RIGHT JOIN ""month"" AS ""m"" ON ""m"".""month""=""c"".""month"") SELECT ""m"".""month"",ROUND(AVG(""m"".""ride_distance"") OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""m"".""ride_duration"") OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""month_ride"" AS ""m"" LIMIT 10"
17,"WITH RECURSIVE ""cte_count"" (""n"") AS (SELECT 1 UNION ALL SELECT ""n""+1 FROM ""cte_count"" WHERE ""n""<12) SELECT * FROM (SELECT ""n"" AS ""month"",COALESCE(ROUND(SUM(""average_ride_distance"") OVER (ORDER BY ""N"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""average_ride_duration"") OVER (ORDER BY ""N"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""cte_count"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""Month"",SUM(""ride_distance"") AS ""average_ride_distance"",SUM(""ride_duration"") AS ""average_ride_duration"" FROM ""RIDES"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""Month_Calculation"" ON ""cte_count"".""n""=""Month_Calculation"".""Month"") AS ""fINAL"" WHERE ""month""<11 ORDER BY ""month"""
18,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""ride_tb"" AS (SELECT ""a"".""ride_id"",""a"".""driver_id"",SUM(""a"".""ride_distance"") AS ""sum_distance"",SUM(""a"".""ride_duration"") AS ""sum_duration"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month""), ""all_month"" AS (SELECT ""m"".""month"",COALESCE(""sum_distance"", 0) AS ""sum_distance"",COALESCE(""sum_duration"", 0) AS ""sum_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""ride_tb"" AS ""rt"" ON ""m"".""month""=""rt"".""month"") SELECT ""t1"".""month"",ROUND((""t1"".""sum_distance""+""t2"".""sum_distance""+""t3"".""sum_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""sum_duration""+""t2"".""sum_duration""+""t3"".""sum_duration"")/3, 2) AS ""average_ride_duration"" FROM (""all_month"" AS ""t1"" JOIN ""all_month"" AS ""t2"") JOIN ""all_month"" AS ""t3"" ON ""t1"".""month""=(""t2"".""month""-1) AND ""t2"".""month""=(""t3"".""month""-1) AND ""t1"".""month""=(""t3"".""month""-2) ORDER BY ""t1"".""month"""
19,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte1"" WHERE ""month""<12), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE LEFT(""r"".""requested_at"", 4)='2020' GROUP BY ""month""), ""cte3"" AS (SELECT ""cte1"".""month"",COALESCE(""cte2"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""cte2"".""ride_duration"", 0) AS ""ride_duration"" FROM ""cte1"" LEFT JOIN ""cte2"" ON ""cte1"".""month""=""cte2"".""month""), ""cte4"" AS (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""cte3"") SELECT * FROM ""cte4"" WHERE ""month""<11 ORDER BY ""month"""
20,"WITH RECURSIVE ""t2"" AS (SELECT 0 AS ""r_dist"",0 AS ""r_dur"",1 AS ""m"" UNION ALL SELECT 0 AS ""r_dist"",0 AS ""r_dur"",""m""+1 AS ""m"" FROM ""t2"" WHERE ""m""<12), ""t1"" AS (SELECT SUM(""ride_distance"") AS ""r_dist"",SUM(""ride_duration"") AS ""r_dur"",""m"" FROM (SELECT ""ride_distance"",""ride_duration"",EXTRACT(MONTH FROM ""requested_at"") AS ""m"" FROM ""AcceptedRides"" AS ""a"" JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""a"" GROUP BY ""m"" ORDER BY ""m""), ""t3"" AS (SELECT COALESCE(""b"".""r_dist"", 0) AS ""r_dist"",COALESCE(""b"".""r_dur"", 0) AS ""r_dur"",""a"".""m"" FROM ""t2"" AS ""a"" LEFT JOIN ""t1"" AS ""b"" ON ""a"".""m""=""b"".""m"") SELECT ""a"".""m"" AS ""month"",ROUND((""a"".""r_dist""+""b"".""r_dist""+""c"".""r_dist"")/3, 2) AS ""average_ride_distance"",ROUND((""a"".""r_dur""+""b"".""r_dur""+""c"".""r_dur"")/3, 2) AS ""average_ride_duration"" FROM (""t3"" AS ""a"" LEFT JOIN ""t3"" AS ""b"" ON ""a"".""m""=""b"".""m""-1) LEFT JOIN ""t3"" AS ""c"" ON ""a"".""m""=""c"".""m""-2 WHERE ""a"".""m""<=10"
21,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 3), ""t3"" AS (SELECT ""t1"".""month"",COALESCE(""distance"", 0) AS ""distance"",COALESCE(""duration"", 0) AS ""duration"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""month""=""t2"".""month"") SELECT ""month"",ROUND(AVG(""distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""t3"" LIMIT 10"
22,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<10), ""rides_with_month"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""requested_month"",SUM(""A"".""ride_distance"") AS ""ride_distance"",SUM(""A"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""A"" ON ""R"".""ride_id""=""A"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""requested_month""), ""joined_table"" AS (SELECT ""M"".""month"",ROUND(COALESCE(SUM(""R"".""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""R"".""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""months"" AS ""M"" LEFT JOIN ""rides_with_month"" AS ""R"" ON ""M"".""month""=""R"".""requested_month"" OR ""M"".""month""=""R"".""requested_month""-1 OR ""M"".""month""=""R"".""requested_month""-2 GROUP BY ""M"".""month"") SELECT * FROM ""joined_table"""
23,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""MONTH"" UNION SELECT ""MONTH""+1 AS ""MONTH"" FROM ""all_months"" WHERE ""MONTH""<12) SELECT ""MONTH"",ROUND(AVG(COALESCE(""MONTH_DIST"", 0)) OVER (ORDER BY ""MONTH"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""MONTH_DUR"", 0)) OVER (ORDER BY ""MONTH"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""ALL_MONTHS"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""REQUESTED_AT"") AS ""MONTH"",SUM(""RIDE_DISTANCE"") AS ""MONTH_DIST"",SUM(""RIDE_DURATION"") AS ""MONTH_DUR"" FROM ""ACCEPTEDRIDES"" AS ""A"" NATURAL JOIN ""RIDES"" AS ""R"" WHERE ""REQUESTED_AT"" BETWEEN '2020-1-1' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""REQUESTED_AT""),EXTRACT(YEAR FROM ""REQUESTED_AT"")) AS ""SUB"" USING (""MONTH"") LIMIT 10"
24,"WITH ""cte"" AS (SELECT SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"",""month"" FROM (SELECT ""a"".""ride_distance"",""a"".""ride_duration"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN DATE('2020-01-01') AND DATE('2020-12-31') UNION ALL SELECT * FROM (SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",1 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",2 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",3 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",4 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",5 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",6 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",7 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",8 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",9 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",10 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",11 AS ""month"" UNION SELECT 0 AS ""ride_distance"",0 AS ""ride_duration"",12 AS ""month"") AS ""c"") AS ""t"" GROUP BY ""month"") SELECT ""month"",ROUND((""ride_distance""+LEAD(""ride_distance"", 1) OVER (ORDER BY ""month"")+LEAD(""ride_distance"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_distance"",ROUND((""ride_duration""+LEAD(""ride_duration"", 1) OVER (ORDER BY ""month"")+LEAD(""ride_duration"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_duration"" FROM ""cte"" LIMIT 10"
25,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<10), ""monthly_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_distance"",SUM(""ar"".""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",COALESCE(ROUND(SUM(""mr"".""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""mr"".""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""monthly_rides"" AS ""mr"" ON ""mr"".""month""-""m"".""month"" BETWEEN 0 AND 2 GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
26,"WITH RECURSIVE ""cte_month"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte_month"" WHERE ""month""<12), ""cte_distance"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_dist"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1), ""cte_duration"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_duration"") AS ""ride_dura"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""cte_month"".""month"",ROUND(AVG(COALESCE(""cte_distance"".""ride_dist"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""cte_duration"".""ride_dura"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (""cte_distance"" JOIN ""cte_duration"" ON ""cte_distance"".""month""=""cte_duration"".""month"") RIGHT JOIN ""cte_month"" ON ""cte_month"".""month""=""cte_duration"".""month"" LIMIT 10"
27,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11), ""t"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE TO_CHAR(""requested_at"", 'YYYY')=2020 GROUP BY TO_CHAR(""requested_at"", '%m')) SELECT ""m"".""month"" AS ""month"",ROUND(COALESCE(SUM(""total_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""total_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_duration"" FROM ""t"" RIGHT JOIN ""m"" ON ""t"".""month""=""m"".""month"" ORDER BY ""month"" LIMIT 10"
28,"WITH ""cte1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN (SELECT * FROM ""rides"" WHERE ""requested_at"">'2019-12-31' AND ""requested_at""<'2021-1-1') AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY EXTRACT(MONTH FROM ""requested_at"") ORDER BY 1), ""cte_recur"" AS (WITH RECURSIVE ""tmp"" AS (SELECT 1 AS ""id"" UNION ALL SELECT ""id""+1 AS ""id"" FROM ""tmp"" WHERE ""id""<12) SELECT * FROM ""tmp""), ""cte2"" AS (SELECT ""id"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""cte1"" RIGHT JOIN ""cte_recur"" ON ""cte1"".""month""=""cte_recur"".""id"") SELECT * FROM (SELECT ""a"".""id"" AS ""month"",ROUND((""a"".""ride_distance""+""b"".""ride_distance""+""c"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""a"".""ride_duration""+""b"".""ride_duration""+""c"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""cte2"" AS ""a"" LEFT JOIN ""cte2"" AS ""b"" ON ""a"".""id""=""b"".""id""-1) LEFT JOIN ""cte2"" AS ""c"" ON ""a"".""id""=""c"".""id""-2) AS ""t"" WHERE ""month""<=10"
29,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""months"" WHERE ""month""<10), ""temp"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""ar"" WHERE ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",ROUND((COALESCE(""m1"".""distance"", 0)+COALESCE(""m2"".""distance"", 0)+COALESCE(""m3"".""distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""m1"".""duration"", 0)+COALESCE(""m2"".""duration"", 0)+COALESCE(""m3"".""duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ((""months"" AS ""m"" LEFT JOIN ""temp"" AS ""m1"" ON ""m"".""month""=""m1"".""month"") LEFT JOIN ""temp"" AS ""m2"" ON ""m"".""month""=""m2"".""month""-1) LEFT JOIN ""temp"" AS ""m3"" ON ""m"".""month""=""m3"".""month""-2"
30,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""base"" AS (SELECT ""a"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""months"" AS ""a"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1 ORDER BY 1) AS ""b"" ON ""a"".""month""=""b"".""month"") SELECT ""month"",ROUND((""ride_distance""+""ride_distance_1""+""ride_distance_2"")/3, 2) AS ""average_ride_distance"",ROUND((""ride_duration""+""ride_duration_1""+""ride_duration_2"")/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",""ride_distance"",LEAD(""ride_distance"", 1) OVER (ORDER BY ""month"") AS ""ride_distance_1"",LEAD(""ride_distance"", 2) OVER (ORDER BY ""month"") AS ""ride_distance_2"",""ride_duration"",LEAD(""ride_duration"", 1) OVER (ORDER BY ""month"") AS ""ride_duration_1"",LEAD(""ride_duration"", 2) OVER (ORDER BY ""month"") AS ""ride_duration_2"" FROM ""base"") AS ""a"" WHERE ""ride_distance_2"" IS NOT NULL ORDER BY 1"
31,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""monthly_data"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month"") SELECT * FROM (SELECT ""m"".""month"",ROUND(AVG(COALESCE(""md"".""ride_distance"", 0)) OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""md"".""ride_duration"", 0)) OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""monthly_data"" AS ""md"" ON ""m"".""month""=""md"".""month"") AS ""asd"" WHERE ""month""<=10"
32,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""c"".""month"",ROUND(AVG(COALESCE(""monthly_distance"", 0)) OVER (ORDER BY ""c"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""monthly_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") AS ""a"" RIGHT JOIN ""cte"" AS ""c"" ON ""a"".""month""=""c"".""month"" ORDER BY ""c"".""month"" LIMIT 10"
33,"WITH ""rec"" AS (WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12) SELECT * FROM ""seq""), ""agg"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""distance"",SUM(""a"".""ride_duration"") AS ""duration"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""r"".""month"",ROUND((AVG(COALESCE(""a"".""distance"", 0)) OVER (ORDER BY ""r"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)), 2) AS ""average_ride_distance"",ROUND((AVG(COALESCE(""a"".""duration"", 0)) OVER (ORDER BY ""r"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)), 2) AS ""average_ride_duration"" FROM ""rec"" AS ""r"" LEFT JOIN ""agg"" AS ""a"" ON ""r"".""month""=""a"".""month"" ORDER BY ""r"".""month"" LIMIT 10"
34,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"") UNION ALL SELECT ""month"",0,0 FROM ""cte"" WHERE ""month"" NOT IN (SELECT EXTRACT(MONTH FROM ""requested_at"") FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) ORDER BY ""month""), ""CTE6"" AS (SELECT ""month"",ROUND((SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_distance"",ROUND((SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_duration"" FROM ""CTE1"") SELECT * FROM ""CTE6"" WHERE ""month""<=10"
35,"WITH RECURSIVE ""M"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""M"" WHERE ""month""<12), ""S"" AS (SELECT ""c"".*,COALESCE(""d"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""d"".""ride_duration"", 0) AS ""ride_duration"" FROM ""M"" AS ""c"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""ride_distance"",SUM(""b"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"" ORDER BY ""month"") AS ""d"" ON ""c"".""month""=""d"".""month""), ""T"" AS (SELECT ""a"".*,""b"".""ride_distance"" AS ""dist1"",""b"".""ride_duration"" AS ""dura1"",""c"".""ride_distance"" AS ""dist2"",""c"".""ride_duration"" AS ""dura2"" FROM ((""S"" AS ""a"") JOIN ""S"" AS ""b"") JOIN ""S"" AS ""c"" WHERE ""a"".""month""=""b"".""month""-1 AND ""a"".""month""=""c"".""month""-2) SELECT ""month"",ROUND((""ride_distance""+""dist1""+""dist2"")/3, 2) AS ""average_ride_distance"",ROUND((""ride_duration""+""dura1""+""dura2"")/3, 2) AS ""average_ride_duration"" FROM ""T"""
36,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""request_month"",SUM(""a"".""ride_distance"") AS ""total_distance"",SUM(""a"".""ride_duration"") AS ""total_duration"" FROM (SELECT * FROM ""Rides"" WHERE TO_CHAR(""requested_at"", 'YYYY')=2020) AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY ""request_month""), ""every_month_rides"" AS (SELECT ""m"".""month"" AS ""month"",COALESCE(""mr"".""total_distance"", 0) AS ""total_distance"",COALESCE(""mr"".""total_duration"", 0) AS ""total_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ""m"".""month""=""mr"".""request_month"") SELECT ""t1"".""month"" AS ""month"",ROUND((""t1"".""total_distance""+COALESCE(""t2"".""total_distance"", 0)+COALESCE(""t3"".""total_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""total_duration""+COALESCE(""t2"".""total_duration"", 0)+COALESCE(""t3"".""total_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM (""every_month_rides"" AS ""t1"" JOIN ""every_month_rides"" AS ""t2"" ON ""t1"".""month""=""t2"".""month""-1) JOIN ""every_month_rides"" AS ""t3"" ON ""t2"".""month""=""t3"".""month""-1"
37,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""info"" AS (SELECT ""m"".""month"",COALESCE(""dis"", 0) AS ""dis"",COALESCE(""dur"", 0) AS ""dur"" FROM ""months"" AS ""m"" LEFT JOIN (SELECT SUM(""ride_distance"") AS ""dis"",SUM(""ride_duration"") AS ""dur"",TO_CHAR(""requested_at"", '%m') AS ""month"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" LIKE '2020%' GROUP BY ""month"") AS ""c"" ON ""m"".""month""=""c"".""month"") SELECT ""a"".""month"",ROUND(SUM(""dis"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""dur"")/3, 2) AS ""average_ride_duration"" FROM ""months"" AS ""a"" LEFT JOIN ""info"" AS ""b"" ON ""b"".""month"" BETWEEN ""a"".""month"" AND ""a"".""month""+2 WHERE ""a"".""month""<11 GROUP BY 1"
38,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11), ""t"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE TO_CHAR(""requested_at"", 'YYYY')=2020 GROUP BY TO_CHAR(""requested_at"", '%m')) SELECT ""m"".""month"" AS ""month"",ROUND(COALESCE(SUM(""total_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""total_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_duration"" FROM ""t"" RIGHT JOIN ""m"" ON ""t"".""month""=""m"".""month"" ORDER BY ""month"" LIMIT 10"
39,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<10), ""monthly_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_distance"",SUM(""ar"".""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",COALESCE(ROUND(SUM(""mr"".""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""mr"".""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""monthly_rides"" AS ""mr"" ON ""mr"".""month""-""m"".""month"" BETWEEN 0 AND 2 GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
40,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month""-2 AS ""month"",ROUND(COALESCE(SUM(""a"".""ride_distance"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""a"".""ride_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM (""Months"" AS ""m"" LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month"">=TO_CHAR(""r"".""requested_at"", '%c') AND TO_CHAR(""r"".""requested_at"", '%c')>=(""m"".""month""-2)) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""m"".""month"">2 GROUP BY 1 ORDER BY 1"
41,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""combined"" AS (SELECT TO_CHAR(""r"".""requested_at"", '%m') AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_distance"",SUM(""ar"".""ride_duration"") AS ""ride_duration"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" USING (""ride_id"") WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT * FROM (SELECT ""m"".""month"",ROUND(AVG(COALESCE(""c"".""ride_distance"", 0)) OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""c"".""ride_duration"", 0)) OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""combined"" AS ""c"" RIGHT JOIN ""months"" AS ""m"" USING (""month"")) AS ""a"" WHERE ""month""<=10"
42,"WITH RECURSIVE ""MonthTable"" AS (SELECT 1 AS ""MONTH"" UNION SELECT ""MONTH""+1 FROM ""MonthTable"" WHERE ""MONTH""<12), ""MonthlyTotal"" AS (SELECT EXTRACT(MONTH FROM ""T1"".""requested_at"") AS ""MONTH"",SUM(""T2"".""ride_distance"") AS ""sum_ride_distance"",SUM(""T2"".""ride_duration"") AS ""sum_ride_duration"" FROM ""Rides"" AS ""T1"" JOIN ""AcceptedRides"" AS ""T2"" ON ""T1"".""ride_id""=""T2"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""T1"".""requested_at"")) SELECT ""T1"".""MONTH"",ROUND(AVG(COALESCE(""sum_ride_distance"", 0)) OVER (ORDER BY ""T1"".""MONTH"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""sum_ride_duration"", 0)) OVER (ORDER BY ""T1"".""MONTH"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""MonthTable"" AS ""T1"" LEFT JOIN ""MonthlyTotal"" AS ""T2"" ON ""T1"".""MONTH""=""T2"".""MONTH"" ORDER BY ""T1"".""MONTH"" LIMIT 10"
43,"WITH RECURSIVE ""months_list"" AS (SELECT 1 AS ""months"",0 AS ""dist"",0 AS ""dur"" UNION ALL SELECT ""months""+1 AS ""months"",0 AS ""dist"",0 AS ""dur"" FROM ""months_list"" WHERE ""months""<12) SELECT * FROM (SELECT ""m"" AS ""month"",ROUND(SUM(""dist"") OVER (ORDER BY ""m"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""dur"") OVER (ORDER BY ""m"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""t"".""months"" AS ""m"",SUM(""dist"") AS ""dist"",SUM(""dur"") AS ""dur"" FROM (SELECT * FROM ""months_list"" UNION ALL SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""months"",SUM(""ride_distance"") AS ""dist"",SUM(""ride_duration"") AS ""dur"" FROM ""AcceptedRides"" AS ""acc"" JOIN ""Rides"" AS ""r"" ON ""acc"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""t"" GROUP BY ""t"".""months"") AS ""t2"") AS ""T3"" WHERE ""month""<11"
44,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""rides_calc"" AS (SELECT EXTRACT(YEAR FROM ""r"".""requested_at"") AS ""year"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_distance"",SUM(""ar"".""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ar"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1,2) SELECT * FROM (SELECT ""m"".""month"",ROUND(SUM(COALESCE(""rc"".""ride_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""rc"".""ride_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""rides_calc"" AS ""rc"" ON (""m"".""month""=""rc"".""month"")) AS ""a"" WHERE ""month""<=10 ORDER BY ""month"""
45,"WITH RECURSIVE ""month_structure"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_structure"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND(SUM(""distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""t1"".""month"",COALESCE(""t2"".""distance"", 0) AS ""distance"",COALESCE(""t2"".""duration"", 0) AS ""duration"" FROM ""month_structure"" AS ""t1"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""ar"" LEFT JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"">='2020-01-01' AND ""r"".""requested_at""<='2020-12-31' GROUP BY 1) AS ""t2"" ON ""t1"".""month""=""t2"".""month"") AS ""t"") AS ""t"" WHERE ""month""<11"
46,"WITH RECURSIVE ""CTE"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""d1"".""requested_at"") AS ""month"",SUM(""d2"".""ride_distance"") AS ""sum_ride_distance"",SUM(""d2"".""ride_duration"") AS ""sum_ride_duration"" FROM ""Rides"" AS ""d1"" JOIN ""AcceptedRides"" AS ""d2"" ON ""d1"".""ride_id""=""d2"".""ride_id"" WHERE ""d1"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""d1"".""requested_at"")), ""CTE3"" AS (SELECT ""d1"".""month"",COALESCE(""d2"".""sum_ride_distance"", 0) AS ""sum_ride_distance"",COALESCE(""d2"".""sum_ride_duration"", 0) AS ""sum_ride_duration"" FROM ""CTE"" AS ""d1"" LEFT JOIN ""CTE2"" AS ""d2"" ON ""d1"".""month""=""d2"".""month"") SELECT ""d1"".""month"",ROUND(SUM(""d2"".""sum_ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""d2"".""sum_ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ""CTE3"" AS ""d1"" JOIN ""CTE3"" AS ""d2"" ON ""d2"".""month"" BETWEEN ""d1"".""month"" AND ""d1"".""month""+2 WHERE ""d1"".""month""<=10 GROUP BY ""d1"".""month"""
47,"WITH RECURSIVE ""r_cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT (""month""+1) FROM ""r_cte"" WHERE ""month""<12), ""monthly_avg"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""r"".""ride_id"",SUM(""ar"".""ride_distance"") AS ""total_ride_distance"",SUM(""ar"".""ride_duration"") AS ""total_ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month"" ORDER BY ""month""), ""every_month_rides"" AS (SELECT ""m"".""month"",COALESCE(""mr"".""total_ride_distance"", 0) AS ""ride_distance"",COALESCE(""mr"".""total_ride_duration"", 0) AS ""ride_duration"" FROM ""r_cte"" AS ""m"" LEFT JOIN ""monthly_avg"" AS ""mr"" ON ""mr"".""month""=""m"".""month"") SELECT ""t1"".""month"" AS ""month"",ROUND((""t1"".""ride_distance""+""t2"".""ride_distance""+""t3"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""ride_duration""+""t2"".""ride_duration""+""t3"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""every_month_rides"" AS ""t1"" JOIN ""every_month_rides"" AS ""t2"") JOIN ""every_month_rides"" AS ""t3"" ON ""t1"".""month""=""t2"".""month""-1 AND ""t2"".""month""=""t3"".""month""-1"
48,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""seq"" WHERE ""month""<12), ""acc_ride"" AS (SELECT ""a"".""ride_id"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"",EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""a"".""month"",ROUND(AVG(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""seq"" AS ""a"" LEFT JOIN ""acc_ride"" AS ""b"" ON ""a"".""month""=""b"".""month"" LIMIT 10"
49,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte1"" WHERE ""month""<12), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""MONTH"",COUNT(DISTINCT ""a"".""ride_id"") AS ""cnt"",SUM(""ride_distance"") AS ""dist"",SUM(""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""a"".""month"",COALESCE(ROUND(SUM(""dist"")/3, 2), 0) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""duration"")/3, 0), 2) AS ""average_ride_duration"" FROM ""cte1"" AS ""a"" LEFT JOIN ""cte2"" AS ""b"" ON ""a"".""month"" BETWEEN ""b"".""month""-2 AND ""b"".""month"" WHERE ""a"".""month""<11 GROUP BY ""a"".""month"" ORDER BY ""a"".""month"""
50,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""sum_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_duration"") AS ""monthly_ride_duration"",SUM(""ride_distance"") AS ""monthly_ride_distance"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")), ""every_month_rides"" AS (SELECT ""m"".""month"",COALESCE(""monthly_ride_duration"", 0) AS ""monthly_ride_duration"",COALESCE(""monthly_ride_distance"", 0) AS ""monthly_ride_distance"" FROM ""months"" AS ""m"" LEFT JOIN ""sum_rides"" USING (""month"")) SELECT ""t1"".""month"",ROUND((""t1"".""monthly_ride_distance""+""t2"".""monthly_ride_distance""+""t3"".""monthly_ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""monthly_ride_duration""+""t2"".""monthly_ride_duration""+""t3"".""monthly_ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ((""every_month_rides"" AS ""t1"") JOIN ""every_month_rides"" AS ""t2"") JOIN ""every_month_rides"" AS ""t3"" WHERE ""t1"".""month""=""t2"".""month""-1 AND ""t2"".""month""=""t3"".""month""-1"
51,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""+1<13), ""cte2"" AS (SELECT * FROM ""cte"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month"") AS ""temp"" USING (""month"")) SELECT * FROM (SELECT ""month"",ROUND(AVG(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte2"") AS ""res"" WHERE ""month""<=10"
52,"SELECT ""t3"".""month"",ROUND(SUM(CASE WHEN ""t4"".""ride_distance"" IS NULL THEN 0 ELSE ""t4"".""ride_distance"" END)/3, 2) AS ""average_ride_distance"",ROUND(SUM(CASE WHEN ""t4"".""ride_duration"" IS NULL THEN 0 ELSE ""t4"".""ride_duration"" END)/3, 2) AS ""average_ride_duration"" FROM ((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"")) AS ""t3"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"",SUM(""t1"".""ride_distance"") AS ""ride_distance"",SUM(""t1"".""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""t1"" LEFT JOIN ""Rides"" AS ""t2"" ON ""t1"".""ride_id""=""t2"".""ride_id"" AND LEFT(""t2"".""requested_at"", 4)='2020' GROUP BY 1) AS ""t4"" ON ""t4"".""month"">=""t3"".""month"" AND ""t4"".""month""<=""t3"".""month""+2 GROUP BY 1 ORDER BY 1"
53,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""Ride2"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",""ride_id"",""user_id"" FROM ""Rides"" WHERE ""requested_at"" LIKE '%2020%') SELECT * FROM (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM (SELECT ""cte"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM (""cte"" LEFT JOIN ""Ride2"" USING (""month"")) LEFT JOIN ""AcceptedRides"" USING (""ride_id"")) AS ""t"" GROUP BY 1) AS ""y"") AS ""a"" WHERE ""month""<=10"
54,"WITH RECURSIVE ""month_tbl"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_tbl"" WHERE ""month""<12), ""ride_info"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",SUM(""A"".""ride_distance"") AS ""monthly_distance"",SUM(""A"".""ride_duration"") AS ""monthly_duration"" FROM ""AcceptedRides"" AS ""A"" LEFT JOIN ""Rides"" AS ""R"" ON ""A"".""ride_id""=""R"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""R"".""requested_at"")), ""ride_all"" AS (SELECT ""M"".""month"",CAST(COALESCE(""R"".""monthly_distance"", 0) AS FLOAT) AS ""monthly_distance"",CAST(COALESCE(""R"".""monthly_duration"", 0) AS FLOAT) AS ""monthly_duration"" FROM ""month_tbl"" AS ""M"" LEFT JOIN ""ride_info"" AS ""R"" ON ""M"".""month""=""R"".""month"") SELECT ""month"",ROUND(AVG(""monthly_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""monthly_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""ride_all"" ORDER BY ""month"" LIMIT 10"
55,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""distance_duration"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT ""month"",ROUND(AVG(""distance"") OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""duration"") OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",COALESCE(""d"".""distance"", 0) AS ""distance"",COALESCE(""d"".""duration"", 0) AS ""duration"" FROM ""months"" AS ""m"" LEFT JOIN ""distance_duration"" AS ""d"" ON ""m"".""month""=""d"".""month"") AS ""t1"" ORDER BY ""month"" LIMIT 10"
56,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""cte1"" WHERE ""n""<12), ""cte"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""cte2"" AS (SELECT ""n"" AS ""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""cte1"" LEFT JOIN ""cte"" ON ""cte1"".""n""=""cte"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte2"" ORDER BY 1 LIMIT 10"
57,"WITH RECURSIVE ""datedim"" AS (SELECT 1 AS ""num"" UNION ALL SELECT ""num""+1 FROM ""datedim"" WHERE ""num""<12), ""monthlysum"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_dis_monthly"",SUM(""ar"".""ride_duration"") AS ""ride_dur_monthly"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT * FROM (SELECT ""dd"".""num"" AS ""month"",ROUND(AVG(COALESCE(""ms"".""ride_dis_monthly"", 0)) OVER (ORDER BY ""dd"".""num"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""ms"".""ride_dur_monthly"", 0)) OVER (ORDER BY ""dd"".""num"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""datedim"" AS ""dd"" LEFT JOIN ""monthlysum"" AS ""ms"" ON ""ms"".""month""=""dd"".""num"") AS ""d"" WHERE ""month""<=10"
58,"WITH RECURSIVE ""t1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mon"",SUM(""b"".""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1 ORDER BY 1), ""t2"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""t2"" WHERE ""month""<12) SELECT * FROM (SELECT ""a"".""month"",ROUND(COALESCE(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 0), 2) AS ""average_ride_duration"" FROM ""t2"" AS ""a"" LEFT JOIN ""t1"" AS ""b"" ON ""a"".""month""=""b"".""mon"") AS ""t"" WHERE ""month""<=10 ORDER BY 1"
59,"WITH RECURSIVE ""mont_cte"" AS (SELECT 1 AS ""start_mon"" UNION ALL SELECT ""start_mon""+1 AS ""start_mon"" FROM ""mont_cte"" WHERE ""start_mon""<12), ""ride"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COALESCE(SUM(""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""ride_duration""), 0) AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""final"" AS (SELECT ""mc"".""start_mon"" AS ""month"",ROUND(SUM(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""mc"".""start_mon"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""mc"".""start_mon"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""mont_cte"" AS ""mc"" LEFT JOIN ""ride"" AS ""r"" ON ""mc"".""start_mon""=""r"".""month"") SELECT * FROM ""final"" WHERE ""month""<=10"
60,"WITH RECURSIVE ""cte"" AS (SELECT '2020-01-01' AS ""daymonth"" UNION ALL SELECT ""daymonth"" + INTERVAL '1 MONTH' AS ""daymonth"" FROM ""cte"" WHERE ""daymonth""<'2020-12-01'), ""cte1"" AS (SELECT ""a"".""ride_id"",""ride_distance"",""ride_duration"",""r"".""requested_at"",EXTRACT(MONTH FROM ""requested_at"") AS ""requested_month"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte2"" AS (SELECT ""month"",COALESCE(""monthly_distance"", 0) AS ""monthly_distance"",COALESCE(""monthly_duration"", 0) AS ""monthly_duration"" FROM (SELECT EXTRACT(MONTH FROM ""daymonth"") AS ""month"" FROM ""cte"") AS ""t"" LEFT JOIN (SELECT ""requested_month"",SUM(""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""cte1"" GROUP BY ""requested_month"") AS ""t2"" ON ""t"".""month""=""t2"".""requested_month"") SELECT * FROM (SELECT ""month"",ROUND(AVG(""monthly_distance"") OVER (ORDER BY ""month"" RANGE BETWEEN 0 FOLLOWING AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""monthly_duration"") OVER (ORDER BY ""month"" RANGE BETWEEN 0 FOLLOWING AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte2"" ORDER BY ""month"") AS ""t"" WHERE ""month""<11"
61,"WITH ""all_months"" AS (SELECT 1 AS ""month_id"" UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12), ""sum_and_counts_per_month"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month_id"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""all_months_sum_and_counts_per_month"" AS (SELECT ""a"".""month_id"",COALESCE(""total_distance"", 0) AS ""total_distance"",COALESCE(""total_duration"", 0) AS ""total_duration"" FROM ""all_months"" AS ""a"" LEFT JOIN ""sum_and_counts_per_month"" AS ""s"" ON ""a"".""month_id""=""s"".""month_id"" GROUP BY ""a"".""month_id"") SELECT ""a1"".""month_id"" AS ""month"",ROUND((""a1"".""total_distance""+""a2"".""total_distance""+""a3"".""total_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""a1"".""total_duration""+""a2"".""total_duration""+""a3"".""total_duration"")/3, 2) AS ""average_ride_duration"" FROM (""all_months_sum_and_counts_per_month"" AS ""a1"" LEFT JOIN ""all_months_sum_and_counts_per_month"" AS ""a2"" ON ""a2"".""month_id""=""a1"".""month_id""+1) LEFT JOIN ""all_months_sum_and_counts_per_month"" AS ""a3"" ON ""a3"".""month_id""=""a2"".""month_id""+1 WHERE ""a1"".""month_id"" BETWEEN 1 AND 10"
62,"WITH ""temp1"" AS (SELECT ""Rides"".""ride_id"",""ride_distance"",""ride_duration"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-10-31'), ""temp2"" AS (SELECT ""Rides"".""ride_id"",""ride_distance"",""ride_duration"",EXTRACT(MONTH FROM ""requested_at"")-1 AS ""month"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-02-01' AND '2020-11-30'), ""temp3"" AS (SELECT ""Rides"".""ride_id"",""ride_distance"",""ride_duration"",EXTRACT(MONTH FROM ""requested_at"")-2 AS ""month"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-03-01' AND '2020-12-31'), ""temp4"" AS (SELECT * FROM ""temp1"" UNION SELECT * FROM ""temp2"" UNION SELECT * FROM ""temp3""), ""temp5"" AS (SELECT ""month"",ROUND(SUM(""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ""temp4"" GROUP BY ""month"") SELECT ""t1"".""month"",COALESCE(""average_ride_distance"", 0) AS ""average_ride_distance"",COALESCE(""average_ride_duration"", 0) AS ""average_ride_duration"" FROM (SELECT 1 AS ""month"" UNION SELECT 2 AS ""month"" UNION SELECT 3 AS ""month"" UNION SELECT 4 AS ""month"" UNION SELECT 5 AS ""month"" UNION SELECT 6 AS ""month"" UNION SELECT 7 AS ""month"" UNION SELECT 8 AS ""month"" UNION SELECT 9 AS ""month"" UNION SELECT 10 AS ""month"") AS ""t1"" LEFT JOIN ""temp5"" ON ""t1"".""month""=""temp5"".""month"""
63,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""temp"" AS (SELECT ""driver_id"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE TO_CHAR(""requested_at"", 'YYYY-%m')>'2019-12' AND TO_CHAR(""requested_at"", 'YYYY-%m')<'2021-01' GROUP BY TO_CHAR(""requested_at"", 'YYYY-%m')), ""temp1"" AS (SELECT ""cte"".""month"",CASE WHEN ""distance"" IS NULL THEN 0 ELSE ""distance"" END AS ""distance"",CASE WHEN ""duration"" IS NULL THEN 0 ELSE ""duration"" END AS ""duration"" FROM ""cte"" LEFT JOIN ""temp"" ON ""cte"".""month""=""temp"".""month"") SELECT ""t"".""month"",ROUND(SUM(""u"".""distance"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""u"".""duration"")/3, 2) AS ""average_ride_duration"" FROM ""temp1"" AS ""t"" JOIN ""temp1"" AS ""u"" WHERE ""t"".""month""<=""u"".""month"" AND ""u"".""month""-""t"".""month""<3 AND ""t"".""month""<=10 GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
64,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""+1<13), ""t"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""t1"" AS (SELECT ""cte"".""month"",COALESCE(""t"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""t"".""ride_duration"", 0) AS ""ride_duration"" FROM ""t"" RIGHT JOIN ""cte"" ON ""t"".""month""=""cte"".""month""), ""t11"" AS (SELECT ""month"",""ride_distance"" AS ""rd1"",""ride_duration"" AS ""rm1"",LEAD(""ride_distance"") OVER (ORDER BY ""month"") AS ""rd2"",LEAD(""ride_duration"") OVER (ORDER BY ""month"") AS ""rm2"" FROM ""t1""), ""t12"" AS (SELECT *,LEAD(""rd2"") OVER (ORDER BY ""month"") AS ""rd3"",LEAD(""rm2"") OVER (ORDER BY ""month"") AS ""rm3"" FROM ""t11""), ""t2"" AS (SELECT ""month"",CAST((""rd1""+""rd2""+""rd3"")/3.0 AS DECIMAL(36, 2)) AS ""average_ride_distance"",CAST((""rm1""+""rm2""+""rm3"")/3.0 AS DECIMAL(36, 2)) AS ""average_ride_duration"" FROM ""t12"") SELECT * FROM ""t2"" WHERE ""average_ride_distance"" IS NOT NULL ORDER BY ""month"""
65,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT ""a"".""ride_id"",""a"".""ride_distance"",""a"".""ride_duration"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""ride_month"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at""<='2020-12-31' AND ""r"".""requested_at"">='2020-01-01'), ""CTE3"" AS (SELECT ""CTE1"".""month"",COALESCE(""temp_tb"".""total_ride_distance"", 0) AS ""total_ride_distance"" FROM ""CTE1"" LEFT JOIN (SELECT ""ride_month"",SUM(""ride_distance"") AS ""total_ride_distance"" FROM ""CTE2"" GROUP BY ""ride_month"") AS ""temp_tb"" ON ""CTE1"".""month""=""temp_tb"".""ride_month""), ""CTE4"" AS (SELECT ""CTE1"".""month"",COALESCE(""temp_tb"".""total_ride_duration"", 0) AS ""total_ride_duration"" FROM ""CTE1"" LEFT JOIN (SELECT ""ride_month"",SUM(""ride_duration"") AS ""total_ride_duration"" FROM ""CTE2"" GROUP BY ""ride_month"") AS ""temp_tb"" ON ""CTE1"".""month""=""temp_tb"".""ride_month""), ""CTE5"" AS (SELECT ""CTE3"".""month"",""CTE3"".""total_ride_distance"",""CTE4"".""total_ride_duration"" FROM ""CTE3"" JOIN ""CTE4"" ON ""CTE3"".""month""=""CTE4"".""month""), ""CTE6"" AS (SELECT ""month"",ROUND((SUM(""total_ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_distance"",ROUND((SUM(""total_ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_duration"" FROM ""CTE5"") SELECT * FROM ""CTE6"" WHERE ""month""<=10"
66,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""sum_ride_distance"",SUM(""ride_duration"") AS ""sum_ride_duration"" FROM ""Rides"" AS ""d1"" JOIN ""AcceptedRides"" AS ""d2"" ON ""d1"".""ride_id""=""d2"".""ride_id"" WHERE EXTRACT(YEAR FROM ""d1"".""requested_at"")=2020 GROUP BY 1) SELECT ""month"",ROUND(1.00*(""sum_ride_distance""+""sum_ride_distance_lead1""+""sum_ride_distance_lead2"")/3, 2) AS ""average_ride_distance"",ROUND(1.00*(""sum_ride_duration""+""sum_ride_duration_lead1""+""sum_ride_duration_lead2"")/3, 2) AS ""average_ride_duration"" FROM (SELECT ""d1"".""month"",COALESCE(""d2"".""sum_ride_distance"", 0) AS ""sum_ride_distance"",COALESCE(""d2"".""sum_ride_duration"", 0) AS ""sum_ride_duration"",LEAD(COALESCE(""d2"".""sum_ride_distance"", 0), 1) OVER (ORDER BY ""d1"".""month"") AS ""sum_ride_distance_lead1"",LEAD(COALESCE(""d2"".""sum_ride_distance"", 0), 2) OVER (ORDER BY ""d1"".""month"") AS ""sum_ride_distance_lead2"",LEAD(COALESCE(""d2"".""sum_ride_duration"", 0), 1) OVER (ORDER BY ""d1"".""month"") AS ""sum_ride_duration_lead1"",LEAD(COALESCE(""d2"".""sum_ride_duration"", 0), 2) OVER (ORDER BY ""d1"".""month"") AS ""sum_ride_duration_lead2"" FROM ""CTE1"" AS ""d1"" LEFT JOIN ""CTE2"" AS ""d2"" ON ""d1"".""month""=""d2"".""month"") AS ""sub"" WHERE ""sum_ride_distance""+""sum_ride_distance_lead1""+""sum_ride_distance_lead2"" IS NOT NULL"
67,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte1"" WHERE ""month""<10), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",SUM(""b"".""ride_id"") AS ""ride_id"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""cte3"" AS (SELECT ""cte1"".""month"",COALESCE(ROUND(SUM(""ride_distance"")/3.0, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3.0, 2), 0) AS ""average_ride_duration"" FROM ""cte1"" LEFT JOIN ""cte2"" ON ""cte1"".""month""=""cte2"".""month"" OR ""cte1"".""month""=""cte2"".""month""-1 OR ""cte1"".""month""=""cte2"".""month""-2 GROUP BY ""cte1"".""month"") SELECT * FROM ""cte3"""
68,"WITH RECURSIVE ""month_table"" AS (SELECT 1 AS ""fy_month"" UNION SELECT ""fy_month""+1 AS ""fy_month"" FROM ""month_table"" WHERE ""fy_month""<10), ""cummulative_data"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""fy_month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""SUB_AGG"".""fy_month"" AS ""month"",ROUND(""SUB_AGG"".""ride_distance""/3, 2) AS ""average_ride_distance"",ROUND(""SUB_AGG"".""ride_duration""/3, 2) AS ""average_ride_duration"" FROM (SELECT ""mt"".""fy_month"",COALESCE(SUM(""cd"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""cd"".""ride_duration""), 0) AS ""ride_duration"" FROM ""month_table"" AS ""MT"" LEFT JOIN ""cummulative_data"" AS ""CD"" ON ""MT"".""fy_month"" BETWEEN ""CD"".""fy_month""-2 AND ""CD"".""fy_month"" GROUP BY 1) AS ""SUB_AGG"""
69,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""m"" UNION ALL SELECT ""m""+1 FROM ""month"" WHERE ""m""<12), ""total"" AS (SELECT ""m"".""m"" AS ""month"",COALESCE(SUM(""a"".""ride_distance""), 0) AS ""distance"",COALESCE(SUM(""a"".""ride_duration""), 0) AS ""duration"" FROM (""month"" AS ""m"" LEFT JOIN ""rides"" AS ""r"" ON ""m"".""m""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND TO_CHAR(""requested_at"", 'YYYY')=2020) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_Id"" GROUP BY 1) SELECT * FROM (SELECT ""month"",ROUND((""distance""+LEAD(""distance"", 1) OVER (ORDER BY ""month"")+LEAD(""distance"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_distance"",ROUND((""duration""+LEAD(""duration"", 1) OVER (ORDER BY ""month"")+LEAD(""duration"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_duration"" FROM ""total"") AS ""a"" WHERE ""month""<11"
70,"WITH RECURSIVE ""A"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""A"" WHERE ""month""<12), ""monthly_stats"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY 1 ORDER BY 1), ""rolling_3_months_stats"" AS (SELECT ""a"".""month"",SUM(COALESCE(""monthly_distance"", 0)) OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""ttl_3_month_dis"",SUM(COALESCE(""monthly_duration"", 0)) OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""ttl_3_month_dur"" FROM ""A"" AS ""a"" LEFT JOIN ""monthly_stats"" AS ""b"" ON ""a"".""month""=""b"".""month"") SELECT ""month"",ROUND(""ttl_3_month_dis""*1.00/3, 2) AS ""average_ride_distance"",ROUND(""ttl_3_month_dur""*1.00/3, 2) AS ""average_ride_duration"" FROM ""rolling_3_months_stats"" WHERE ""month""<=10"
71,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""cte1"" WHERE ""month""<12), ""cte"" AS (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",COALESCE(SUM(""a"".""ride_distance""), 0) AS ""sum_distance"",COALESCE(SUM(""a"".""ride_duration""), 0) AS ""sum_duration"" FROM ""acceptedrides"" AS ""a"" RIGHT JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT ""a"".""month"",ROUND(AVG(COALESCE(""b"".""sum_distance"", 0)) OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""b"".""sum_duration"", 0)) OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte1"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""month""=""b"".""month"" ORDER BY ""month"" LIMIT 10"
72,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12) SELECT ""d"".""month"",ROUND(AVG(COALESCE(""c"".""monthly_distance"", 0)) OVER (ORDER BY ""d"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""c"".""monthly_duration"", 0)) OVER (ORDER BY ""d"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""months"" AS ""d"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""monthly_distance"",SUM(""b"".""ride_duration"") AS ""monthly_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY 1) AS ""c"" ON ""d"".""month""=""c"".""month"" ORDER BY 1 LIMIT 10"
73,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<10), ""result_table"" AS (SELECT ""m"".""month"",ROUND(SUM(""a"".""ride_distance"")/3, 2) AS ""avg_dis"",ROUND(SUM(""a"".""ride_duration"")/3, 2) AS ""avg_dur"" FROM (""all_months"" AS ""m"" JOIN ""rides"" AS ""r"" ON EXTRACT(MONTH FROM ""r"".""requested_at"") BETWEEN ""m"".""month"" AND ""m"".""month""+2) JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""m"".""month"",COALESCE(""r"".""avg_dis"", 0) AS ""average_ride_distance"",COALESCE(""r"".""avg_dur"", 0) AS ""average_ride_duration"" FROM ""all_months"" AS ""m"" LEFT JOIN ""result_table"" AS ""r"" ON ""m"".""month""=""r"".""month"""
74,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""cte1"" WHERE ""month""<12), ""cte"" AS (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""sum_distance"",SUM(""a"".""ride_duration"") AS ""sum_duration"" FROM ""acceptedrides"" AS ""a"" RIGHT JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT ""a"".""month"",ROUND(AVG(COALESCE(""b"".""sum_distance"", 0)) OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""b"".""sum_duration"", 0)) OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte1"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""month""=""b"".""month"" ORDER BY ""month"" LIMIT 10"
75,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""ride"" AS (SELECT TO_CHAR(""rides"".""requested_at"", '%c') AS ""month"",SUM(""AcceptedRides"".""ride_distance"") AS ""ride_distance"",SUM(""AcceptedRides"".""ride_duration"") AS ""ride_duration"" FROM ""rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE ""rides"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT ""cte"".""month"",ROUND(AVG(COALESCE(""ride"".""ride_distance"", 0)) OVER (ORDER BY ""cte"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""ride"".""ride_duration"", 0)) OVER (ORDER BY ""cte"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" LEFT JOIN ""ride"" USING (""month"") LIMIT 10"
76,"WITH RECURSIVE ""temp2"" AS (SELECT 1 AS ""mth"" UNION ALL SELECT ""mth""+1 FROM ""temp2"" WHERE ""mth""<12), ""temp1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""acceptedrides"" JOIN ""rides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1) SELECT ""mth"" AS ""month"",ROUND(AVG(COALESCE(""distance"", 0)) OVER (ORDER BY ""mth"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""duration"", 0)) OVER (ORDER BY ""mth"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""temp2"" LEFT JOIN ""temp1"" ON ""temp2"".""mth""=""temp1"".""month"" ORDER BY ""mth"" LIMIT 10"
77,"WITH RECURSIVE ""month_table"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_table"" WHERE ""month""<12), ""table2"" AS (SELECT ""m"".""month"",COALESCE(""A"".""distance"", 0) AS ""distance"",COALESCE(""A"".""duration"", 0) AS ""duration"" FROM (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""distance"",SUM(""a"".""ride_duration"") AS ""duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month"") AS ""A"" RIGHT JOIN ""month_table"" AS ""m"" ON ""A"".""month""=""m"".""month"") SELECT ""d1"".""month"",ROUND(AVG(""d2"".""distance""), 2) AS ""average_ride_distance"",ROUND(AVG(""d2"".""duration""), 2) AS ""average_ride_duration"" FROM ""table2"" AS ""d1"" LEFT JOIN ""table2"" AS ""d2"" ON ""d1"".""month""<=""d2"".""month"" AND ""d2"".""month""<""d1"".""month""+3 GROUP BY ""d1"".""month"" HAVING COUNT(""d1"".""month"")=3"
78,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",COALESCE(SUM(""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""ride_duration""), 0) AS ""ride_duration"" FROM (""cte"" LEFT JOIN ""rides"" AS ""r"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"") AS ""f1"") AS ""f2"" WHERE ""month""<11"
79,"WITH RECURSIVE ""A"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""A"" WHERE ""month""<12), ""monthly_stats"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1 ORDER BY 1), ""rolling_3_months_stats"" AS (SELECT ""a"".""month"",SUM(COALESCE(""monthly_distance"", 0)) OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""ttl_3_month_dis"",SUM(COALESCE(""monthly_duration"", 0)) OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""ttl_3_month_dur"" FROM ""A"" AS ""a"" LEFT JOIN ""monthly_stats"" AS ""b"" ON ""a"".""month""=""b"".""month"") SELECT ""month"",ROUND(""ttl_3_month_dis""*1.00/3, 2) AS ""average_ride_distance"",ROUND(""ttl_3_month_dur""*1.00/3, 2) AS ""average_ride_duration"" FROM ""rolling_3_months_stats"" WHERE ""month""<=10"
80,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""months"" WHERE ""month""<10), ""temp"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""ar"" WHERE ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",ROUND((COALESCE(""m1"".""distance"", 0)+COALESCE(""m2"".""distance"", 0)+COALESCE(""m3"".""distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""m1"".""duration"", 0)+COALESCE(""m2"".""duration"", 0)+COALESCE(""m3"".""duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ((""months"" AS ""m"" LEFT JOIN ""temp"" AS ""m1"" ON ""m"".""month""=""m1"".""month"") LEFT JOIN ""temp"" AS ""m2"" ON ""m"".""month""=""m2"".""month""-1) LEFT JOIN ""temp"" AS ""m3"" ON ""m"".""month""=""m3"".""month""-2"
81,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""cte"" AS (SELECT ""a"".""ride_id"",""r"".""requested_at"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""cte"" GROUP BY 1 ORDER BY 1), ""clean"" AS (SELECT ""m"".""month"",""c"".""total_distance"",""c"".""total_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""cte2"" AS ""c"" ON (""m"".""month""=""c"".""month"")) SELECT ""month"",ROUND(""total_distance""/3, 2) AS ""average_ride_distance"",ROUND(""total_duration""/3, 2) AS ""average_ride_duration"" FROM (SELECT ""c1"".""month"",(COALESCE(""c1"".""total_distance"", 0)+COALESCE(""c2"".""total_distance"", 0)+COALESCE(""c3"".""total_distance"", 0)) AS ""total_distance"",(COALESCE(""c1"".""total_duration"", 0)+COALESCE(""c2"".""total_duration"", 0)+COALESCE(""c3"".""total_duration"", 0)) AS ""total_duration"" FROM (""clean"" AS ""c1"" JOIN ""clean"" AS ""c2"" ON ""c1"".""month""=""c2"".""month""-1) JOIN ""clean"" AS ""c3"" ON ""c1"".""month""=""c3"".""month""-2 GROUP BY 1) AS ""x"" ORDER BY 1"
82,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""c"".""month"",(SELECT COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"" FROM ""acceptedrides"" AS ""ar"" LEFT JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 AND EXTRACT(MONTH FROM ""requested_at"")-""c"".""month"" BETWEEN 0 AND 2) AS ""average_ride_distance"",(SELECT COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""acceptedrides"" AS ""ar"" LEFT JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 AND EXTRACT(MONTH FROM ""requested_at"")-""c"".""month"" BETWEEN 0 AND 2) AS ""average_ride_duration"" FROM ""cte"" AS ""c"" WHERE ""c"".""month""<=10"
83,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""every_month_sum"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""sum_distance"",SUM(""ride_duration"") AS ""sum_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""t"".""month"",ROUND(AVG(COALESCE(""sum_distance"", 0)) OVER (ORDER BY ""t"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""sum_duration"", 0)) OVER (ORDER BY ""t"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""months"" AS ""t"" LEFT JOIN ""every_month_sum"" AS ""e"" USING (""month"") ORDER BY ""t"".""month"" LIMIT 10"
84,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte1"" WHERE ""month""<12), ""cte2"" AS (SELECT EXTRACT(YEAR FROM ""requested_at"") AS ""Year"",EXTRACT(MONTH FROM ""requested_at"") AS ""Month"",SUM(""ride_distance"") AS ""total_ride_distance"",SUM(""ride_duration"") AS ""total_ride_duration"" FROM ""AcceptedRides"" JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" GROUP BY ""Year"",""Month"" HAVING ""Year""=2020 ORDER BY ""Year"",""Month""), ""cte3"" AS (SELECT ""cte1"".""month"",ROUND(SUM(COALESCE(""total_ride_distance"", 0)) OVER (ORDER BY ""cte1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""total_ride_duration"", 0)) OVER (ORDER BY ""cte1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""cte1"" LEFT JOIN ""cte2"" ON ""cte1"".""month""=""cte2"".""Month"") SELECT * FROM ""cte3"" WHERE ""month""<=10"
85,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<10), ""rides_2020"" AS (SELECT EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"",""t1"".""ride_distance"",""t1"".""ride_duration"" FROM ""acceptedrides"" AS ""t1"" JOIN ""rides"" AS ""t2"" ON ""t2"".""ride_id""=""t1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""t2"".""requested_at"")=2020) SELECT ""t1"".""month"",ROUND(SUM(CASE WHEN ""t2"".""ride_distance"" IS NULL THEN 0 ELSE ""t2"".""ride_distance"" END)/3, 2) AS ""average_ride_distance"",ROUND(SUM(CASE WHEN ""t2"".""ride_duration"" IS NULL THEN 0 ELSE ""t2"".""ride_duration"" END)/3, 2) AS ""average_ride_duration"" FROM ""months"" AS ""t1"" LEFT JOIN ""rides_2020"" AS ""t2"" ON ""t2"".""month""-""t1"".""month"" BETWEEN 0 AND 2 GROUP BY ""t1"".""month"" ORDER BY ""t1"".""month"""
86,"WITH RECURSIVE ""MonthSeq"" AS (SELECT 1 AS ""MONTH_NUM"" UNION ALL SELECT ""MONTH_NUM""+1 FROM ""MonthSeq"" WHERE ""MONTH_NUM""<12), ""AcceptedRides2"" AS (SELECT ""A1"".*,EXTRACT(MONTH FROM ""R1"".""requested_at"") AS ""MONTH_NUM"" FROM ""AcceptedRides"" AS ""A1"" JOIN ""Rides"" AS ""R1"" ON ""A1"".""ride_id""=""R1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""AcceptedRides3"" AS (SELECT ""MONTH_NUM"",SUM(""ride_distance"") AS ""monthly_ride_distance"",SUM(""ride_duration"") AS ""monthly_ride_duration"" FROM ""AcceptedRides2"" GROUP BY ""MONTH_NUM"") SELECT * FROM (SELECT ""M1"".""MONTH_NUM"" AS ""month"",ROUND((SUM(COALESCE(""monthly_ride_distance"", 0)) OVER (ORDER BY ""M1"".""MONTH_NUM"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""monthly_ride_duration"", 0)) OVER (ORDER BY ""M1"".""MONTH_NUM"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""MonthSeq"" AS ""M1"" LEFT JOIN ""AcceptedRides3"" AS ""A2"" ON ""M1"".""MONTH_NUM""=""A2"".""MONTH_NUM"") AS ""T1"" WHERE ""month""<=10"
87,"WITH RECURSIVE ""t"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE TO_CHAR(""requested_at"", 'YYYY')=2020 GROUP BY TO_CHAR(""requested_at"", '%m')), ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11) SELECT ""m"".""month"" AS ""month"",ROUND(COALESCE(SUM(""total_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""total_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_duration"" FROM ""t"" RIGHT JOIN ""m"" ON ""t"".""month""=""m"".""month"" ORDER BY ""month"" LIMIT 10"
88,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""ridesStat"" AS (SELECT EXTRACT(MONTH FROM ""r1"".""requested_at"") AS ""month"",SUM(""a1"".""ride_distance"") AS ""distance"",SUM(""a1"".""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""a1"" LEFT JOIN ""Rides"" AS ""r1"" ON ""r1"".""ride_id""=""a1"".""ride_id"" WHERE ""r1"".""requested_at"" LIKE '2020%' GROUP BY 1), ""ridesStat2"" AS (SELECT ""c1"".""month"",COALESCE(ROUND(SUM(""r1"".""distance"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""r1"".""duration"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""cte"" AS ""c1"" LEFT JOIN ""ridesStat"" AS ""r1"" ON ""r1"".""month""=""c1"".""month"") SELECT * FROM ""ridesStat2"" WHERE ""month""<=10"
89,"WITH RECURSIVE ""MonthSeq"" AS (SELECT 1 AS ""MONTH_NUM"" UNION ALL SELECT ""MONTH_NUM""+1 FROM ""MonthSeq"" WHERE ""MONTH_NUM""<12), ""AcceptedRides2"" AS (SELECT ""A1"".*,EXTRACT(MONTH FROM ""R1"".""requested_at"") AS ""MONTH_NUM"" FROM ""AcceptedRides"" AS ""A1"" JOIN ""Rides"" AS ""R1"" ON ""A1"".""ride_id""=""R1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""AcceptedRides3"" AS (SELECT ""MONTH_NUM"",SUM(""ride_distance"") AS ""monthly_ride_distance"",SUM(""ride_duration"") AS ""monthly_ride_duration"" FROM ""AcceptedRides2"" GROUP BY ""MONTH_NUM"") SELECT * FROM (SELECT ""M1"".""MONTH_NUM"" AS ""month"",ROUND(AVG(COALESCE(""monthly_ride_distance"", 0)) OVER (ORDER BY ""M1"".""MONTH_NUM"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""monthly_ride_duration"", 0)) OVER (ORDER BY ""M1"".""MONTH_NUM"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""MonthSeq"" AS ""M1"" LEFT JOIN ""AcceptedRides3"" AS ""A2"" ON ""M1"".""MONTH_NUM""=""A2"".""MONTH_NUM"") AS ""T1"" WHERE ""month""<=10"
90,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""m"" WHERE ""month""<12), ""v"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""m_number"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM (""Rides"" AS ""ina"") JOIN ""AcceptedRides"" AS ""inb"" WHERE ""ina"".""ride_id""=""inb"".""ride_id"" AND ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""tmp"" AS (SELECT ""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""m"" LEFT JOIN ""v"" ON ""m"".""month""=""v"".""m_number"") SELECT ""ina"".""month"",ROUND((""ina"".""ride_distance""+""inb"".""ride_distance""+""inc"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""ina"".""ride_duration""+""inb"".""ride_duration""+""inc"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ((""tmp"" AS ""ina"") JOIN ""tmp"" AS ""inb"") JOIN ""tmp"" AS ""inc"" WHERE ""ina"".""month""+1=""inb"".""month"" AND ""inb"".""month""+1=""inc"".""month"" AND ""ina"".""month""<=10 GROUP BY ""ina"".""month"""
91,"WITH ""month"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 2 AS ""month"" UNION ALL SELECT 3 AS ""month"" UNION ALL SELECT 4 AS ""month"" UNION ALL SELECT 5 AS ""month"" UNION ALL SELECT 6 AS ""month"" UNION ALL SELECT 7 AS ""month"" UNION ALL SELECT 8 AS ""month"" UNION ALL SELECT 9 AS ""month"" UNION ALL SELECT 10 AS ""month"" UNION ALL SELECT 11 AS ""month"" UNION ALL SELECT 12 AS ""month""), ""Rides_final"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",SUM(""A"".""ride_distance"") AS ""distance"",SUM(""A"".""ride_duration"") AS ""duration"",COUNT(""A"".""ride_id"") AS ""ct"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""A"" ON ""R"".""ride_id""=""A"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020 GROUP BY ""month""), ""data_final"" AS (SELECT ""M"".""month"",COALESCE(""distance"", 0) AS ""distance"",COALESCE(""duration"", 0) AS ""duration"",COALESCE(""ct"", 0) AS ""ct"" FROM ""Month"" AS ""M"" LEFT JOIN ""Rides_final"" AS ""R"" ON ""R"".""month""=""M"".""month"") SELECT ""A"".""month"" AS ""month"",ROUND((""A"".""distance""+""B"".""distance""+""C"".""distance"")/3, 2) AS ""average_ride_distance"",ROUND((""A"".""duration""+""B"".""duration""+""C"".""duration"")/3, 2) AS ""average_ride_duration"" FROM (""data_final"" AS ""A"" JOIN ""data_final"" AS ""B"" ON ""A"".""month""+1=""B"".""month"") JOIN ""data_final"" AS ""C"" ON ""A"".""month""+2=""C"".""month"""
92,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"") UNION ALL SELECT ""month"",0,0 FROM ""cte"" WHERE ""month"" NOT IN (SELECT EXTRACT(MONTH FROM ""requested_at"") FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) ORDER BY ""month""), ""cte2"" AS (SELECT ""t1"".""month"",""t1"".""ride_distance"" AS ""t1rd"",""t1"".""ride_duration"" AS ""t1rdr"",""t2"".""ride_distance"" AS ""t2rd"",""t2"".""ride_duration"" AS ""t2rdr"",""t3"".""ride_distance"" AS ""t3rd"",""t3"".""ride_duration"" AS ""t3rdr"" FROM (""cte1"" AS ""t1"" JOIN ""cte1"" AS ""t2"") JOIN ""cte1"" AS ""t3"" ON ""t1"".""month""+1=""t2"".""month"" AND ""t2"".""month""+1=""t3"".""month"" AND ""t1"".""month""+2=""t3"".""month"") SELECT ""cte2"".""month"",ROUND((""t1rd""+""t2rd""+""t3rd"")/3, 2) AS ""average_ride_distance"",ROUND((""t1rdr""+""t2rdr""+""t3rdr"")/3, 2) AS ""average_ride_duration"" FROM ""cte2"""
93,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",COALESCE(SUM(""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""ride_duration""), 0) AS ""ride_duration"" FROM (""cte"" LEFT JOIN ""rides"" AS ""r"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"") AS ""f1"") AS ""f2"" WHERE ""month""<11"
94,"WITH RECURSIVE ""cte"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""tot_distance"",SUM(""ride_duration"") AS ""tot_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")), ""cte2"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte2"" WHERE ""month""+1<=(SELECT MAX(""month"") FROM ""cte"")) SELECT ""c2"".""month"",COALESCE(ROUND((SUM(""tot_distance"") OVER (ORDER BY ""c2"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND((SUM(""tot_duration"") OVER (ORDER BY ""c2"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2), 0) AS ""average_ride_duration"" FROM ""cte2"" AS ""c2"" LEFT JOIN ""cte"" AS ""c1"" ON ""c2"".""month""=""c1"".""month"" ORDER BY ""month"" LIMIT 10"
95,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""+1<13) SELECT * FROM (SELECT ""a"".""month"",ROUND(COALESCE(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 0), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""a"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) AS ""b"" ON ""a"".""month""=""b"".""month"") AS ""result"" WHERE ""month""<11"
96,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""valid_rides"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""AR"".""ride_distance"",""AR"".""ride_duration"" FROM ""Rides"" AS ""R"" LEFT JOIN ""AcceptedRides"" AS ""AR"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""month_rides"" AS (SELECT ""M"".""month"",COALESCE(SUM(""R"".""ride_distance""), 0) AS ""month_ride_distance"",COALESCE(SUM(""R"".""ride_duration""), 0) AS ""month_ride_duration"" FROM ""months"" AS ""M"" LEFT JOIN ""valid_rides"" AS ""R"" ON ""R"".""month""=""M"".""month"" GROUP BY ""M"".""month"") SELECT ""M1"".""month"",ROUND((""M1"".""month_ride_distance""+""M2"".""month_ride_distance""+""M3"".""month_ride_distance"")/3.0, 2) AS ""average_ride_distance"",ROUND((""M1"".""month_ride_duration""+""M2"".""month_ride_duration""+""M3"".""month_ride_duration"")/3.0, 2) AS ""average_ride_duration"" FROM (""month_rides"" AS ""M1"" JOIN ""month_rides"" AS ""M2"" ON ""M1"".""month""=""M2"".""month""-1) JOIN ""month_rides"" AS ""M3"" ON ""M1"".""month""=""M3"".""month""-2 ORDER BY ""month"""
97,"WITH ""tbl"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""total_ride_distance"",SUM(""a"".""ride_duration"") AS ""total_ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month""), ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9 UNION ALL SELECT 10 UNION ALL SELECT 11 UNION ALL SELECT 12) SELECT * FROM (SELECT ""months"".""month"",ROUND(COALESCE((SUM(""tbl"".""total_ride_distance"") OVER (ORDER BY ""months"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE((SUM(""tbl"".""total_ride_duration"") OVER (ORDER BY ""months"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 0), 2) AS ""average_ride_duration"" FROM ""months"" LEFT JOIN ""tbl"" ON ""months"".""month""=""tbl"".""month"") AS ""t1"" WHERE ""t1"".""month""<=10"
98,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY ""month""), ""t3"" AS (SELECT ""t1"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""month""=""t2"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""t3"" LIMIT 10"
99,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""+1<13) SELECT * FROM (SELECT ""a"".""month"",ROUND(COALESCE(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 0), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""a"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) AS ""b"" ON ""a"".""month""=""b"".""month"") AS ""result"" WHERE ""month""<11"
100,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""ttls"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ttl_ride_distance"",SUM(""ride_duration"") AS ""ttl_ride_duration"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""AR"".""ride_id""=""R"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020 GROUP BY 1) SELECT ""a"".""month"",ROUND((SUM(COALESCE(""ttl_ride_distance"", 0)) OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_distance"",ROUND((SUM(COALESCE(""ttl_ride_duration"", 0)) OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_duration"" FROM ""months"" AS ""a"" LEFT JOIN ""ttls"" AS ""b"" ON ""a"".""month""=""b"".""month"" ORDER BY 1 LIMIT 10"
101,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<10) SELECT ""c"".""month"",COALESCE(ROUND(SUM(""t"".""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""t"".""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""cte"" AS ""c"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""t"" ON ""c"".""month""+2>=""t"".""month"" AND ""t"".""month"">=""c"".""month"" GROUP BY 1"
102,"WITH ""months"" (""month"") AS (SELECT * FROM (VALUES ROW(1), ROW(2), ROW(3), ROW(4), ROW(5), ROW(6), ROW(7), ROW(8), ROW(9), ROW(10)) AS ""v""), ""valid_rides"" AS (SELECT ""ride_id"",""ride_distance"",""ride_duration"",""requested_at"" FROM ""AcceptedRides"" NATURAL JOIN ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""result"" AS (SELECT ""months"".""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""months"" LEFT JOIN ""valid_rides"" ON -""month""+EXTRACT(MONTH FROM ""requested_at"") BETWEEN 0 AND 2 GROUP BY ""month"") SELECT * FROM ""result"""
103,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""mon"" UNION SELECT ""mon""+1 AS ""mon"" FROM ""m"" WHERE ""mon""<12), ""t"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""rd"",SUM(""ride_duration"") AS ""rdu"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-1-1' AND '2020-12-31' GROUP BY 1) SELECT ""mon"" AS ""month"",ROUND(AVG(COALESCE(""rd"", 0)) OVER (ORDER BY ""mon"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""rdu"", 0)) OVER (ORDER BY ""mon"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""m"" LEFT JOIN ""t"" ON ""m"".""mon""=""t"".""month"" LIMIT 10"
104,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<=12), ""monthly_stats"" AS (SELECT ""m"".""month"",COALESCE(""t"".""monthly_distance"", 0) AS ""monthly_distance"",COALESCE(""t"".""monthly_duration"", 0) AS ""monthly_duration"" FROM ""months"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN CAST('2020-01-01' AS DATE) AND CAST('2020-12-31' AS DATE) GROUP BY 1) AS ""t"" ON ""m"".""month""=""t"".""month""), ""results"" AS (SELECT ""month"",ROUND(AVG(""monthly_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""monthly_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""monthly_stats"" GROUP BY 1 ORDER BY 1) SELECT * FROM ""results"" WHERE ""month""<=10"
105,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""temp1"" AS (SELECT ""cte"".""month"",COALESCE(""dis"", 0) AS ""dis"",COALESCE(""dur"", 0) AS ""dur"" FROM ""cte"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""dis"",SUM(""ride_duration"") AS ""dur"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""sub"" ON ""cte"".""month""=""sub"".""month"") SELECT ""month"",ROUND(SUM(""dis"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""dur"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""temp1"" LIMIT 10"
106,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""all_months"" WHERE ""month""<12), ""monthly_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""ride_month"",SUM(""ride_distance"") AS ""monthly_rdis"",SUM(""ride_duration"") AS ""monthly_rdur"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""ride_month"") SELECT ""month"",ROUND(AVG(COALESCE(""monthly_rdis"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""monthly_rdur"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""all_months"" AS ""am"" LEFT JOIN ""monthly_rides"" AS ""mr"" ON ""am"".""month""=""mr"".""ride_month"" LIMIT 10"
107,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month""), ""every_month_rides"" AS (SELECT ""m"".""month"",COALESCE(""mr"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""mr"".""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ""mr"".""month""=""m"".""month"") SELECT ""a"".""month"",ROUND((""a"".""ride_distance""+""b"".""ride_distance""+""c"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""a"".""ride_duration""+""b"".""ride_duration""+""c"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ((""every_month_rides"" AS ""a"") JOIN ""every_month_rides"" AS ""b"") JOIN ""every_month_rides"" AS ""c"" WHERE ""a"".""month""=""b"".""month""-1 AND ""b"".""month""=""c"".""month""-1"
108,"WITH ""months"" (""month"") AS (SELECT * FROM (VALUES ROW(1), ROW(2), ROW(3), ROW(4), ROW(5), ROW(6), ROW(7), ROW(8), ROW(9), ROW(10)) AS ""v""), ""valid_rides"" AS (SELECT ""ride_id"",""ride_distance"",""ride_duration"",""requested_at"" FROM ""AcceptedRides"" NATURAL JOIN ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""result"" AS (SELECT ""month"",ROUND(SUM(""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ""months"" JOIN ""valid_rides"" WHERE -""month""+EXTRACT(MONTH FROM ""requested_at"") BETWEEN 0 AND 2 GROUP BY ""month"") SELECT ""month"",COALESCE(""average_ride_distance"", 0.00) AS ""average_ride_distance"",COALESCE(""average_ride_duration"", 0.00) AS ""average_ride_duration"" FROM ""months"" NATURAL LEFT JOIN ""result"" ORDER BY ""month"""
109,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",SUM(""ride_distance"") AS ""sum_ride_distance"",SUM(""ride_duration"") AS ""sum_ride_duration"" FROM ""AcceptedRides"" JOIN ""Rides"" USING (""ride_id"") WHERE LEFT(""requested_at"", 4)='2020' GROUP BY 1 ORDER BY 1), ""table_m"" AS (SELECT ""month"",COALESCE(""sum_ride_distance"", 0) AS ""sum_ride_distance"",COALESCE(""sum_ride_duration"", 0) AS ""sum_ride_duration"" FROM ""month"" LEFT JOIN ""month_rides"" USING (""month"")) SELECT ""t1"".""month"",ROUND((""t1"".""sum_ride_distance""+""t2"".""sum_ride_distance""+""t3"".""sum_ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""sum_ride_duration""+""t2"".""sum_ride_duration""+""t3"".""sum_ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ((""table_m"" AS ""t1"") JOIN ""table_m"" AS ""t2"") JOIN ""table_m"" AS ""t3"" WHERE ""t1"".""month""=""t2"".""month""-1 AND ""t2"".""month""=""t3"".""month""-1"
110,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12), ""t2"" AS (SELECT DISTINCT ""t"".""month"",SUM(COALESCE(""ride_distance"", 0)) OVER (PARTITION BY ""t"".""month"") AS ""ride_distance"",SUM(COALESCE(""ride_duration"", 0)) OVER (PARTITION BY ""t"".""month"") AS ""ride_duration"" FROM (""rides"" RIGHT JOIN ""AcceptedRides"" ON ""rides"".""ride_id""=""acceptedRides"".""ride_id"") RIGHT JOIN ""t"" ON ""t"".""month""=EXTRACT(MONTH FROM ""rides"".""requested_at"") AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020) SELECT ""month"",ROUND((""ride_distance""+""next_dis""+""next_dis2"")/3, 2) AS ""average_ride_distance"",ROUND((""ride_duration""+""next_dur""+""next_dur2"")/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",""ride_distance"",LEAD(""ride_distance"", 1) OVER (ORDER BY ""month"") AS ""next_dis"",LEAD(""ride_distance"", 2) OVER (ORDER BY ""month"") AS ""next_dis2"",""ride_duration"",LEAD(""ride_duration"", 1) OVER (ORDER BY ""month"") AS ""next_dur"",LEAD(""ride_duration"", 2) OVER (ORDER BY ""month"") AS ""next_dur2"" FROM ""t2"") AS ""temp"" WHERE ""next_dis2"" IS NOT NULL"
111,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<=12), ""CTE"" AS (SELECT ""m"".""month"" AS ""mon"",COALESCE(""d"".""distance"", 0) AS ""distance"",COALESCE(""d"".""duration"", 0) AS ""duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT ""mon"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM (SELECT ""a"".*,EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""mon"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND ""requested_at"">='2020-01-01' AND ""requested_at""<='2020-12-31') AS ""c"" GROUP BY ""mon"") AS ""d"" ON ""m"".""month""=""d"".""mon"") SELECT ""a"".""mon"" AS ""month"",ROUND((""distance""+""distance_lead1""+""distance_lead2"")/3, 2) AS ""average_ride_distance"",ROUND((""duration""+""duration_lead1""+""duration_lead2"")/3, 2) AS ""average_ride_duration"" FROM (SELECT ""mon"",""distance"",""duration"",LEAD(""distance"", 1) OVER (ORDER BY ""mon"") AS ""distance_lead1"",LEAD(""distance"", 2) OVER (ORDER BY ""mon"") AS ""distance_lead2"",LEAD(""duration"", 1) OVER (ORDER BY ""mon"") AS ""duration_lead1"",LEAD(""duration"", 2) OVER (ORDER BY ""mon"") AS ""duration_lead2"" FROM ""CTE"") AS ""a"" ORDER BY ""mon"" LIMIT 10"
112,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE1"" WHERE 1+""month""<=12), ""CTE2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""CTE3"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE2"".""driver_id"") OVER (ORDER BY ""CTE1"".""month"") AS ""active_drivers"" FROM ""CTE1"" LEFT JOIN ""CTE2"" ON ""CTE1"".""month""=""CTE2"".""month""), ""CTE4"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""A"".""driver_id"",""A"".""ride_distance"",""A"".""ride_duration"" FROM (""Rides"" AS ""R"") JOIN ""AcceptedRIdes"" AS ""A"" WHERE ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE4"".""driver_id"") OVER (PARTITION BY ""CTE1"".""month"") AS ""accepted_rides"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month""), ""CTE6"" AS (SELECT ""CTE1"".""month"",COALESCE(SUM(""CTE4"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""CTE4"".""ride_duration""), 0) AS ""ride_duration"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month"" GROUP BY ""CTE1"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""CTE6"" LIMIT 10"
113,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<12), ""months_stats"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT * FROM (SELECT ""month"",ROUND(AVG(""distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""a"".""month"",COALESCE(""distance"", 0) AS ""distance"",COALESCE(""duration"", 0) AS ""duration"" FROM ""all_months"" AS ""a"" LEFT JOIN ""months_stats"" AS ""m"" ON ""a"".""month""=""m"".""month"") AS ""f"" ORDER BY 1) AS ""g"" WHERE ""month""<=10"
114,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""cte"".""month"",ROUND(SUM(COALESCE(""dis"", 0)) OVER (ORDER BY ""cte"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""dur"", 0)) OVER (ORDER BY ""cte"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mon"",SUM(""ride_distance"") AS ""dis"",SUM(""ride_duration"") AS ""dur"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""mon"") AS ""sub"" RIGHT JOIN ""cte"" ON ""sub"".""mon""=""cte"".""month"" ORDER BY ""cte"".""month"" LIMIT 10"
115,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<=11) SELECT ""c"".""month"",ROUND(COALESCE(SUM(""a"".""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""a"".""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM (""cte"" AS ""c"" LEFT JOIN ""Rides"" AS ""r"" ON (EXTRACT(MONTH FROM ""r"".""requested_at"")-""c"".""month"") BETWEEN 0 AND 2 AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""c"".""month""<=10 GROUP BY 1 ORDER BY 1"
116,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<=11) SELECT DISTINCT ""month"",ROUND(SUM(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (""cte"" LEFT JOIN ""rides"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" USING (""ride_id"") ORDER BY 1 LIMIT 10"
117,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""months"" AS (SELECT ""m"".""month"",COALESCE(""k"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""k"".""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""r"".""ride_id"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) AS ""k"" ON (""k"".""month""-""m"".""month""<=2 AND ""k"".""month""-""m"".""month"">=0)) SELECT ""month"",ROUND(SUM(""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ""months"" WHERE ""month""<=10 GROUP BY ""month"" ORDER BY ""month"""
118,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""rides_by_month"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")), ""rides_every_month"" AS (SELECT ""m"".""month"",COALESCE(SUM(""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""ride_duration""), 0) AS ""ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""rides_by_month"" AS ""r"" ON ""m"".""month""=""r"".""month"" GROUP BY ""m"".""month"") SELECT ""r1"".""month"",ROUND((""r1"".""ride_distance""+""r2"".""ride_distance""+""r3"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""r1"".""ride_duration""+""r2"".""ride_duration""+""r3"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""rides_every_month"" AS ""r1"" JOIN ""rides_every_month"" AS ""r2"") JOIN ""rides_every_month"" AS ""r3"" ON ""r1"".""month""=""r2"".""month""-1 AND ""r2"".""month""=""r3"".""month""-1"
119,"WITH RECURSIVE ""Months"" (""Month"") AS (SELECT 1 UNION ALL SELECT ""Month""+1 FROM ""Months"" WHERE ""Month""<12), ""T1"" AS (SELECT EXTRACT(MONTH FROM ""Rides"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""Rides"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""Rides"".""requested_at"")) SELECT ""month"",ROUND(COALESCE((""ride_distance""+""ride_distance_1""+""ride_distance_2"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE((""ride_duration""+""ride_duration_1""+""ride_duration_2"")/3, 0), 2) AS ""average_ride_duration"" FROM (SELECT ""Months"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"",COALESCE(LEAD(""ride_distance"", 1) OVER (ORDER BY ""Months"".""month""), 0) AS ""ride_distance_1"",COALESCE(LEAD(""ride_distance"", 2) OVER (ORDER BY ""Months"".""month""), 0) AS ""ride_distance_2"",COALESCE(LEAD(""ride_duration"", 1) OVER (ORDER BY ""Months"".""month""), 0) AS ""ride_duration_1"",COALESCE(LEAD(""ride_duration"", 2) OVER (ORDER BY ""Months"".""month""), 0) AS ""ride_duration_2"" FROM ""Months"" LEFT JOIN ""T1"" ON ""Months"".""month""=""T1"".""month"") AS ""T2"" WHERE ""month""<=10"
120,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte1"" WHERE ""month""<12), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""ride_id"",""r"".""requested_at"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020), ""cte3"" AS (SELECT ""cte1"".""month"",COALESCE(SUM(""cte2"".""ride_distance""), 0) AS ""tol_dis"",COALESCE(SUM(""cte2"".""ride_duration""), 0) AS ""tol_dur"" FROM ""cte1"" LEFT JOIN ""cte2"" ON ""cte1"".""month""=""cte2"".""month"" GROUP BY 1 ORDER BY 1), ""cte4"" AS (SELECT ""month"",ROUND(AVG(""tol_dis"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""tol_dur"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte3"") SELECT ""month"",""average_ride_distance"",""average_ride_duration"" FROM ""cte4"" WHERE ""month""<=10 ORDER BY ""month"""
121,"WITH RECURSIVE ""datedim"" AS (SELECT 1 AS ""num"" UNION ALL SELECT ""num""+1 FROM ""datedim"" WHERE ""num""<12), ""monthlysum"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_dis_monthly"",SUM(""ar"".""ride_duration"") AS ""ride_dur_monthly"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT * FROM (SELECT ""dd"".""num"" AS ""month"",ROUND(AVG(COALESCE(""ms"".""ride_dis_monthly"", 0)) OVER (ORDER BY ""dd"".""num"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""ms"".""ride_dur_monthly"", 0)) OVER (ORDER BY ""dd"".""num"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""datedim"" AS ""dd"" LEFT JOIN ""monthlysum"" AS ""ms"" ON ""ms"".""month""=""dd"".""num"") AS ""d"" WHERE ""month""<=10"
122,"WITH RECURSIVE ""all_month"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_month"" WHERE ""month""<12), ""rides_2020"" AS (SELECT ""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""request_month"" FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""t"" AS (SELECT ""month"",""request_month"",SUM(COALESCE(""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""ride_duration"", 0)) AS ""ride_duration"" FROM ""all_month"" AS ""am"" LEFT JOIN (""rides_2020"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") ON ""am"".""month""=""r"".""request_month"" GROUP BY ""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""t"" LIMIT 10"
123,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""summary_cte"" AS (SELECT ""t1"".""month"",COALESCE(SUM(""t3"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""t3"".""ride_duration""), 0) AS ""ride_duration"" FROM (""months"" AS ""t1"" LEFT JOIN ""Rides"" AS ""t2"" ON EXTRACT(YEAR FROM ""t2"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""t2"".""requested_at"")=""t1"".""month"") LEFT JOIN ""AcceptedRides"" AS ""t3"" ON ""t2"".""ride_id""=""t3"".""ride_id"" GROUP BY ""t1"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""summary_cte"" LIMIT 10"
124,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<=11) SELECT DISTINCT ""month"",ROUND(SUM(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (""cte"" LEFT JOIN ""rides"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" USING (""ride_id"") ORDER BY 1 LIMIT 10"
125,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""sum_distance"",SUM(""b"".""ride_duration"") AS ""sum_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT ""t1"".""month"",ROUND(AVG(COALESCE(""t2"".""sum_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""t2"".""sum_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""t1"" LEFT JOIN ""t2"" USING (""month"") LIMIT 10"
126,"WITH RECURSIVE ""tmp"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""tmp"" WHERE ""month""<12), ""tmp1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""tot_ride_dist"",SUM(""ride_duration"") AS ""tot_ride_dur"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"">='2020-01-01' AND ""requested_at""<'2021-01-01' GROUP BY ""month"" ORDER BY ""requested_at""), ""tmp2"" AS (SELECT ""tmp"".""month"",""tot_ride_dist"",""tot_ride_dur"",LEAD(""tot_ride_dist"", 1) OVER (ORDER BY ""month"") AS ""next_ride_dist"",LEAD(""tot_ride_dist"", 2) OVER (ORDER BY ""month"") AS ""nexttonext_ride_dist"",LEAD(""tot_ride_dur"", 1) OVER (ORDER BY ""month"") AS ""next_ride_dur"",LEAD(""tot_ride_dur"", 2) OVER (ORDER BY ""month"") AS ""nexttonext_ride_dur"" FROM ""tmp1"" RIGHT JOIN ""tmp"" ON ""tmp1"".""month""=""tmp"".""month"" ORDER BY ""tmp"".""month"") SELECT ""month"",ROUND(((COALESCE(""tot_ride_dist"", 0)+COALESCE(""next_ride_dist"", 0)+COALESCE(""nexttonext_ride_dist"", 0))/3), 2) AS ""average_ride_distance"",ROUND(((COALESCE(""tot_ride_dur"", 0)+COALESCE(""next_ride_dur"", 0)+COALESCE(""nexttonext_ride_dur"", 0))/3), 2) AS ""average_ride_duration"" FROM ""tmp2"" WHERE ""month""<=10"
127,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<10), ""rides2020"" AS (SELECT ""t1"".""ride_id"",EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"",""t1"".""ride_distance"",""t1"".""ride_duration"" FROM ""acceptedrides"" AS ""t1"" JOIN ""rides"" AS ""t2"" ON ""t2"".""ride_id""=""t1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""t2"".""requested_at"")=2020) SELECT ""t1"".""month"",ROUND(SUM(CASE WHEN ""t2"".""ride_distance"" IS NULL THEN 0 ELSE ""t2"".""ride_distance"" END)/3, 2) AS ""average_ride_distance"",ROUND(SUM(CASE WHEN ""t2"".""ride_duration"" IS NULL THEN 0 ELSE ""t2"".""ride_duration"" END)/3, 2) AS ""average_ride_duration"" FROM ""months"" AS ""t1"" LEFT JOIN ""rides2020"" AS ""t2"" ON (""t2"".""month""=""t1"".""month"" OR ""t2"".""month""=""t1"".""month""+1 OR ""t2"".""month""=""t1"".""month""+2) GROUP BY ""t1"".""month"" ORDER BY ""t1"".""month"""
128,"WITH RECURSIVE ""a"" AS (SELECT DISTINCT '2020-01-01' AS ""m_start"" FROM ""drivers"" UNION ALL SELECT ""m_start"" + INTERVAL '+1 MONTH' FROM ""a"" WHERE ""m_start""<'2020-12-01'), ""b"" AS (SELECT ""m_start"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM (SELECT ""r"".""requested_at"" - INTERVAL 'DAYOFMONTH(""r"".""requested_at"")-1 DAY' AS ""m_start"",""ar"".""ride_id"",""ar"".""ride_distance"",""ar"".""ride_duration"" FROM ""rides"" AS ""r"" RIGHT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 ORDER BY ""r"".""requested_at"") AS ""temp"" GROUP BY ""m_start""), ""c"" AS (SELECT ""a"".""m_start"",COALESCE(""b"".""total_distance"", 0) AS ""total_distance"",COALESCE(""b"".""total_duration"", 0) AS ""total_duration"" FROM ""a"" LEFT JOIN ""b"" ON ""a"".""m_start""=""b"".""m_start"") SELECT * FROM (SELECT EXTRACT(MONTH FROM ""m_start"") AS ""month"",ROUND(AVG(""total_distance"") OVER (ORDER BY ""m_start"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""total_duration"") OVER (ORDER BY ""m_start"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""c"") AS ""temp"" WHERE ""month""<=10"
129,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""tmp"" AS (SELECT ""m"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") SELECT ""t1"".""month"",ROUND((""t1"".""ride_distance""+""t2"".""ride_distance""+""t3"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""ride_duration""+""t2"".""ride_duration""+""t3"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""tmp"" AS ""t1"" LEFT JOIN ""tmp"" AS ""t2"" ON ""t1"".""month""=""t2"".""month""-1) LEFT JOIN ""tmp"" AS ""t3"" ON ""t1"".""month""=""t3"".""month""-2 WHERE ""t1"".""month""<=10"
130,"WITH RECURSIVE ""monthly_ride_stats"" AS (SELECT ""ride_month"",SUM(""dist"") AS ""monthly_distance"",SUM(""duration"") AS ""monthly_duration"" FROM (SELECT ""ride_distance"" AS ""dist"",""ride_duration"" AS ""duration"",""requested_at"" AS ""ride_date"",EXTRACT(MONTH FROM ""requested_at"") AS ""ride_month"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE ((EXTRACT(YEAR FROM ""requested_at"")>2019) AND (EXTRACT(YEAR FROM ""requested_at"")<2021)) ORDER BY EXTRACT(MONTH FROM ""requested_at"")) AS ""rides_details"" GROUP BY ""ride_month""), ""month_vals"" (""mth"") AS (SELECT 1 UNION ALL SELECT ""mth""+1 FROM ""month_vals"" WHERE ""mth""<12), ""monthly_ride_stats_12_months"" AS (SELECT ""mth"",COALESCE(""monthly_distance"", 0) AS ""dist"",COALESCE(""monthly_duration"", 0) AS ""dur"" FROM ""month_vals"" LEFT JOIN ""monthly_ride_stats"" AS ""mrs"" ON ""month_vals"".""mth""=""mrs"".""ride_month"") SELECT ""mth"" AS ""month"",ROUND(AVG(""dist"") OVER (ORDER BY ""mth"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""dur"") OVER (ORDER BY ""mth"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""monthly_ride_stats_12_months"" AS ""mrs12"" LIMIT 10"
131,"WITH RECURSIVE ""cte"" (""n"") AS (SELECT 1 AS ""mnt"" UNION ALL SELECT ""n""+1 AS ""mnt"" FROM ""cte"" WHERE ""n""<12), ""cte1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mnt"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""mnt"" ORDER BY ""mnt""), ""cte2"" AS (SELECT ""a"".""n"" AS ""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""cte"" AS ""a"" LEFT JOIN ""cte1"" AS ""b"" ON ""a"".""n""=""b"".""mnt"") SELECT ""month"",CAST((SUM(""ride_distance"") OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING))/3 AS DECIMAL(10, 2)) AS ""average_ride_distance"",CAST((SUM(""ride_duration"") OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING))/3 AS DECIMAL(10, 2)) AS ""average_ride_duration"" FROM ""cte2"" LIMIT 10"
132,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""cte1"" AS (SELECT ""a"".""requested_at"",""b"".""ride_distance"",""b"".""ride_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' ORDER BY ""a"".""requested_at""), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""ride_distance"",""ride_duration"" FROM ""cte1""), ""cte3"" AS (SELECT ""a"".""month"",SUM(COALESCE(""b"".""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""b"".""ride_duration"", 0)) AS ""ride_duration"" FROM ""months"" AS ""a"" LEFT JOIN ""cte2"" AS ""b"" ON ""a"".""month""=""b"".""month"" GROUP BY ""a"".""month""), ""cte4"" AS (SELECT ""month"",SUM(""ride_distance"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""total_distance"",SUM(""ride_duration"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""total_duration"" FROM ""cte3"") SELECT ""month"",ROUND(""total_distance""/3, 2) AS ""average_ride_distance"",ROUND(""total_duration""/3, 2) AS ""average_ride_duration"" FROM ""cte4"" WHERE ""month""<=10"
133,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE1"" WHERE 1+""month""<=12), ""CTE2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""CTE3"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE2"".""driver_id"") OVER (ORDER BY ""CTE1"".""month"") AS ""active_drivers"" FROM ""CTE1"" LEFT JOIN ""CTE2"" ON ""CTE1"".""month""=""CTE2"".""month""), ""CTE4"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""A"".""driver_id"",""A"".""ride_distance"",""A"".""ride_duration"" FROM (""Rides"" AS ""R"") JOIN ""AcceptedRIdes"" AS ""A"" WHERE ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""CTE5"" AS (SELECT ""CTE1"".""month"",COALESCE(SUM(""CTE4"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""CTE4"".""ride_duration""), 0) AS ""ride_duration"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month"" GROUP BY ""CTE1"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""CTE5"" LIMIT 10"
134,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<10) SELECT ""m"".""month"",COALESCE(""r"".""avg_dis"", 0) AS ""average_ride_distance"",COALESCE(""r"".""avg_dur"", 0) AS ""average_ride_duration"" FROM ""all_months"" AS ""m"" LEFT JOIN (SELECT ""m"".""month"",ROUND(SUM(""a"".""ride_distance"")/3, 2) AS ""avg_dis"",ROUND(SUM(""a"".""ride_duration"")/3, 2) AS ""avg_dur"" FROM ((SELECT * FROM ""all_months"") AS ""m"" JOIN ""rides"" AS ""r"" ON EXTRACT(MONTH FROM ""r"".""requested_at"") BETWEEN ""m"".""month"" AND ""m"".""month""+2) JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) AS ""r"" ON ""m"".""month""=""r"".""month"""
135,"WITH RECURSIVE ""CTE"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""CTE"" WHERE ""month""<10), ""b"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""monthly_distance"",SUM(""a"".""ride_duration"") AS ""monthly_duration"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""c"".""month"",COALESCE(ROUND(SUM(""monthly_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""monthly_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""CTE"" AS ""c"" LEFT JOIN ""b"" ON ""b"".""month""=""c"".""month"" OR ""b"".""month""=""c"".""month""+1 OR ""b"".""month""=""c"".""month""+2 GROUP BY 1 ORDER BY 1"
136,"WITH RECURSIVE ""M"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""M"" WHERE ""month""<12), ""S"" AS (SELECT ""c"".*,COALESCE(""d"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""d"".""ride_duration"", 0) AS ""ride_duration"" FROM ""M"" AS ""c"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""ride_distance"",SUM(""b"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"" ORDER BY ""month"") AS ""d"" ON ""c"".""month""=""d"".""month""), ""T"" AS (SELECT ""a"".*,""b"".""ride_distance"" AS ""dist1"",""b"".""ride_duration"" AS ""dura1"",""c"".""ride_distance"" AS ""dist2"",""c"".""ride_duration"" AS ""dura2"" FROM ((""S"" AS ""a"") JOIN ""S"" AS ""b"") JOIN ""S"" AS ""c"" WHERE ""a"".""month""=""b"".""month""-1 AND ""a"".""month""=""c"".""month""-2) SELECT ""month"",ROUND((""ride_distance""+""dist1""+""dist2"")/3, 2) AS ""average_ride_distance"",ROUND((""ride_duration""+""dura1""+""dura2"")/3, 2) AS ""average_ride_duration"" FROM ""T"" ORDER BY 1"
137,"WITH RECURSIVE ""months_in_year"" AS (SELECT 1 AS ""month_num"" UNION SELECT ""month_num""+1 FROM ""months_in_year"" WHERE ""month_num""<12) SELECT * FROM (SELECT ""ride_month"" AS ""month"",ROUND((""total_distance""+COALESCE(LEAD(""total_distance"") OVER (), 0)+COALESCE(LEAD(""total_distance"", 2) OVER (), 0))/3, 2) AS ""average_ride_distance"",ROUND((""total_duration""+COALESCE(LEAD(""total_duration"") OVER (), 0)+COALESCE(LEAD(""total_duration"", 2) OVER (), 0))/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month_num"" AS ""ride_month"",COALESCE(""total_rides"", 0) AS ""total_rides"",COALESCE(""total_distance"", 0) AS ""total_distance"",COALESCE(""total_duration"", 0) AS ""total_duration"" FROM ""months_in_year"" AS ""MIY"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""ride_month"",COUNT(""AR"".""ride_id"") AS ""total_rides"",SUM(""AR"".""ride_distance"") AS ""total_distance"",SUM(""AR"".""ride_duration"") AS ""total_duration"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""AR"".""ride_id""=""R"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""ride_month"" ORDER BY ""ride_month"") AS ""RI"" ON ""MIY"".""month_num""=""RI"".""ride_month"") AS ""all_month"") AS ""all_month_averages"" WHERE ""month""<=10"
138,"WITH RECURSIVE ""Months"" (""Month"") AS (SELECT 1 UNION ALL SELECT ""Month""+1 FROM ""Months"" WHERE ""Month""<12), ""T1"" AS (SELECT EXTRACT(MONTH FROM ""Rides"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""Rides"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""Rides"".""requested_at"")) SELECT ""month"",ROUND(COALESCE((""ride_distance""+""ride_distance_1""+""ride_distance_2"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE((""ride_duration""+""ride_duration_1""+""ride_duration_2"")/3, 0), 2) AS ""average_ride_duration"" FROM (SELECT ""Months"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"",COALESCE(LEAD(""ride_distance"", 1) OVER (ORDER BY ""Months"".""month""), 0) AS ""ride_distance_1"",COALESCE(LEAD(""ride_distance"", 2) OVER (ORDER BY ""Months"".""month""), 0) AS ""ride_distance_2"",COALESCE(LEAD(""ride_duration"", 1) OVER (ORDER BY ""Months"".""month""), 0) AS ""ride_duration_1"",COALESCE(LEAD(""ride_duration"", 2) OVER (ORDER BY ""Months"".""month""), 0) AS ""ride_duration_2"" FROM ""Months"" LEFT JOIN ""T1"" ON ""Months"".""month""=""T1"".""month"") AS ""T2"" WHERE ""month""<=10"
139,"SELECT ""temp"".""month"",ROUND(COALESCE(SUM(""t"".""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""t"".""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"")) AS ""temp"" LEFT JOIN (SELECT ""R"".""ride_id"",""R"".""requested_at"",""AR"".""ride_distance"",""AR"".""ride_duration"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""AR"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE LEFT(""R"".""requested_at"", 4)=2020) AS ""t"" ON EXTRACT(MONTH FROM ""t"".""requested_at"")>=""temp"".""month"" AND EXTRACT(MONTH FROM ""t"".""requested_at"")<=""temp"".""month""+2 GROUP BY ""temp"".""month"" ORDER BY ""temp"".""month"""
140,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""CTE1"" WHERE ""month""<10), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""tot_dist"",SUM(""a"".""ride_duration"") AS ""tot_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""c1"".""month"",ROUND(COALESCE(SUM(""c2"".""tot_dist"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""c2"".""tot_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM ""CTE1"" AS ""c1"" LEFT JOIN ""CTE2"" AS ""c2"" ON ""c2"".""month"" BETWEEN ""c1"".""month"" AND ""c1"".""month""+2 GROUP BY ""c1"".""month"""
141,"SELECT ""t2"".""month"",ROUND(COALESCE(SUM(""t1"".""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""t1"".""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""a"".""ride_id"",""a"".""ride_distance"",""a"".""ride_duration"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""r"".""requested_at"">='2020-01-01' AND ""r"".""requested_at""<='2020-12-31') AS ""t1"" RIGHT JOIN (SELECT 1 AS ""month"" UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10) AS ""t2"" ON ""t1"".""month""<=""t2"".""month""+2 AND ""t1"".""month"">=""t2"".""month"" GROUP BY ""t2"".""month"" ORDER BY ""t2"".""month"""
142,"WITH RECURSIVE ""month"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month""), ""every_month_rides"" AS (SELECT ""month"".""month"" AS ""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" LEFT JOIN ""month_rides"" ON ""month"".""month""=""month_rides"".""month"") SELECT ""t1"".""month"" AS ""month"",ROUND((""t1"".""ride_distance""+""t2"".""ride_distance""+""t3"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""ride_duration""+""t2"".""ride_duration""+""t3"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""every_month_rides"" AS ""t1"" JOIN ""every_month_rides"" AS ""t2"") JOIN ""every_month_rides"" AS ""t3"" ON ""t1"".""month""=""t2"".""month""-1 AND ""t2"".""month""=""t3"".""month""-1"
143,"WITH RECURSIVE ""mon"" (""month_num"", ""month_st"", ""month_end"") AS (SELECT 1 AS ""month_num"",CAST('2020-01-01' AS DATE) + INTERVAL '0 MONTH' AS ""month_st"",CAST('2020-01-01' AS DATE) + INTERVAL '3 MONTH' AS ""month_end"" UNION ALL SELECT ""month_num""+1 AS ""month_num"",CAST('2020-01-01' AS DATE) + INTERVAL '""month_num"" MONTH' AS ""month_st"",CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""+3 MONTH' AS ""month_end"" FROM ""mon"" WHERE ""month_num""+1<=10), ""denorm"" AS (SELECT ""requested_at"",""ride_duration"",""ride_distance"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2021-01-01') SELECT ""m"".""month_num"" AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""mon"" AS ""m"" LEFT JOIN ""denorm"" AS ""d"" ON ""requested_at"">=""month_st"" AND ""requested_at""<""month_end"" GROUP BY ""m"".""month_num"""
144,"WITH RECURSIVE ""t"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE TO_CHAR(""requested_at"", 'YYYY')=2020 GROUP BY TO_CHAR(""requested_at"", '%m')), ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11) SELECT ""m"".""month"" AS ""month"",ROUND(COALESCE(SUM(""total_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""total_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_duration"" FROM ""t"" RIGHT JOIN ""m"" ON ""t"".""month""=""m"".""month"" ORDER BY ""month"" LIMIT 10"
145,"WITH RECURSIVE ""t0"" (""m"") AS (SELECT '2020-02-01' AS ""m"" UNION ALL SELECT ""m"" + INTERVAL '1 MONTH' FROM ""t0"" WHERE ""m""<'2021-01-01'), ""t1"" AS (SELECT ""m"" - INTERVAL '1 DAY' AS ""mon"" FROM ""t0""), ""t2"" AS (SELECT ""mon"",COALESCE(SUM(""ride_distance""), 0) AS ""dis"",COALESCE(SUM(""ride_duration""), 0) AS ""dur"" FROM ""t1"" LEFT JOIN (SELECT ""a"".*,""requested_at"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"") AS ""tmp"" ON TO_CHAR(""t1"".""mon"", 'YYYY-%m')=TO_CHAR(""requested_at"", 'YYYY-%m') GROUP BY 1), ""t3"" AS (SELECT EXTRACT(MONTH FROM ""mon"")-2 AS ""month"",SUM(""dis"") OVER (ORDER BY ""mon"" ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS ""total_dis"",SUM(""dur"") OVER (ORDER BY ""mon"" ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS ""total_dur"" FROM ""t2"") SELECT ""month"",ROUND(""total_dis""/3, 2) AS ""average_ride_distance"",ROUND(""total_dur""/3, 2) AS ""average_ride_duration"" FROM ""t3"" WHERE ""month"">0"
146,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""Ride2"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",""ride_id"",""user_id"" FROM ""Rides"" WHERE ""requested_at"" LIKE '%2020%') SELECT * FROM (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM (SELECT ""cte"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM (""cte"" LEFT JOIN ""Ride2"" AS ""r"" USING (""month"")) LEFT JOIN ""AcceptedRides"" USING (""ride_id"")) AS ""t"" GROUP BY 1) AS ""y"") AS ""a"" WHERE ""month""<=10"
147,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<10), ""result_table"" AS (SELECT ""m"".""month"",ROUND(SUM(""a"".""ride_distance"")/3, 2) AS ""avg_dis"",ROUND(SUM(""a"".""ride_duration"")/3, 2) AS ""avg_dur"" FROM ((SELECT * FROM ""all_months"") AS ""m"" JOIN ""rides"" AS ""r"" ON EXTRACT(MONTH FROM ""r"".""requested_at"") BETWEEN ""m"".""month"" AND ""m"".""month""+2) JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""m"".""month"",COALESCE(""r"".""avg_dis"", 0) AS ""average_ride_distance"",COALESCE(""r"".""avg_dur"", 0) AS ""average_ride_duration"" FROM ""all_months"" AS ""m"" LEFT JOIN ""result_table"" AS ""r"" ON ""m"".""month""=""r"".""month"""
148,"WITH RECURSIVE ""func"" AS (SELECT 1 AS ""mon"" UNION ALL SELECT ""mon""+1 FROM ""func"" WHERE ""mon""<12), ""tbl1"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""mnth"",SUM(""a"".""ride_distance"") AS ""total_dist"",SUM(""a"".""ride_duration"") AS ""total_time"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")), ""tbl2"" AS (SELECT ""func"".""mon"" AS ""mnth"",COALESCE(""tbl1"".""total_dist"", 0) AS ""total_dist"",COALESCE(""tbl1"".""total_time"", 0) AS ""total_time"" FROM ""func"" LEFT JOIN ""tbl1"" ON ""func"".""mon""=""tbl1"".""mnth"") SELECT ""t1"".""mnth"" AS ""month"",ROUND((""t1"".""total_dist""+""t2"".""total_dist""+""t3"".""total_dist"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""total_time""+""t2"".""total_time""+""t3"".""total_time"")/3, 2) AS ""average_ride_duration"" FROM (""tbl2"" AS ""t1"" JOIN ""tbl2"" AS ""t2"" ON ""t1"".""mnth""+1=""t2"".""mnth"") JOIN ""tbl2"" AS ""t3"" ON ""t1"".""mnth""+2=""t3"".""mnth"""
149,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<12), ""months_stats"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT * FROM (SELECT ""month"",ROUND(AVG(""distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""a"".""month"",COALESCE(""distance"", 0) AS ""distance"",COALESCE(""duration"", 0) AS ""duration"" FROM ""all_months"" AS ""a"" LEFT JOIN ""months_stats"" AS ""m"" ON ""a"".""month""=""m"".""month"") AS ""f"" ORDER BY 1) AS ""g"" WHERE ""month""<=10"
150,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""m"" WHERE ""month""<12), ""mr"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""mr_distance"",SUM(""ride_duration"") AS ""mr_duration"" FROM ""AcceptedRides"" JOIN ""Rides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT ""m"".""month"",COALESCE(ROUND(SUM(""mr_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""mr_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""m"" LEFT JOIN ""mr"" USING (""month"") ORDER BY 1 LIMIT 10"
151,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""n"" UNION SELECT ""n""+1 FROM ""cte"" WHERE ""n""<12) SELECT ""t1"".""n"" AS ""month"",ROUND(AVG(COALESCE(""t2"".""ride_distance"", 0)) OVER (ORDER BY ""t1"".""n"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""t2"".""ride_duration"", 0)) OVER (ORDER BY ""t1"".""n"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""t1"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COALESCE(SUM(""a"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""a"".""ride_duration""), 0) AS ""ride_duration"" FROM ""rides"" AS ""r"" LEFT JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) AS ""t2"" ON ""t1"".""n""=""t2"".""month"" LIMIT 10"
152,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE1"" WHERE 1+""month""<=12), ""CTE2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""CTE3"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE2"".""driver_id"") OVER (ORDER BY ""CTE1"".""month"") AS ""active_drivers"" FROM ""CTE1"" LEFT JOIN ""CTE2"" ON ""CTE1"".""month""=""CTE2"".""month""), ""CTE4"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""A"".""driver_id"",""A"".""ride_distance"",""A"".""ride_duration"" FROM (""Rides"" AS ""R"") JOIN ""AcceptedRIdes"" AS ""A"" WHERE ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE4"".""driver_id"") OVER (PARTITION BY ""CTE1"".""month"") AS ""accepted_rides"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month""), ""CTE6"" AS (SELECT ""CTE1"".""month"",COALESCE(SUM(""CTE4"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""CTE4"".""ride_duration""), 0) AS ""ride_duration"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month"" GROUP BY ""CTE1"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""CTE6"" LIMIT 10"
153,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<=11), ""rides_avg"" AS (SELECT ""month"",SUM(""ride_distance"") AS ""total_dist"",SUM(""ride_duration"") AS ""total_time"" FROM (SELECT *,EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" GROUP BY ""month"") SELECT ""month"",COALESCE(""average_ride_distance"", 0.00) AS ""average_ride_distance"",COALESCE(""average_ride_duration"", 0.00) AS ""average_ride_duration"" FROM (SELECT ""a"".""month"",ROUND(SUM(""total_dist"") OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3.0, 2) AS ""average_ride_distance"",ROUND(SUM(""total_time"") OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3.0, 2) AS ""average_ride_duration"" FROM ""months"" AS ""a"" LEFT JOIN ""rides_avg"" AS ""b"" ON ""a"".""month""=""b"".""month"") AS ""a"" WHERE ""month""<11 ORDER BY 1"
154,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte1"" WHERE ""month""<10), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""ride_distance"",""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE TO_CHAR(""requested_at"", 'YYYY-%m') BETWEEN '2020-01' AND '2020-12') SELECT ""c1"".""month"",ROUND(COALESCE(SUM(""c2"".""ride_distance"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""c2"".""ride_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM ""cte1"" AS ""c1"" LEFT JOIN ""cte2"" AS ""c2"" ON ""c1"".""month""+2>=""c2"".""month"" AND ""c1"".""month""<=""c2"".""month"" GROUP BY 1 ORDER BY 1"
155,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_duration"") END AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final_list"" ORDER BY ""month"" LIMIT 10"
156,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND((SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN 0 PRECEDING AND 2 FOLLOWING))/3, 2) AS ""average_ride_distance"",ROUND((SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN 0 PRECEDING AND 2 FOLLOWING))/3, 2) AS ""average_ride_duration"" FROM (SELECT ""t1"".""month"",CASE WHEN ""t2"".""ride_distance"" IS NULL THEN 0 ELSE ""t2"".""ride_distance"" END AS ""ride_distance"",CASE WHEN ""t2"".""ride_duration"" IS NULL THEN 0 ELSE ""t2"".""ride_duration"" END AS ""ride_duration"" FROM ""all_months"" AS ""t1"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"",SUM(""t1"".""ride_distance"") AS ""ride_distance"",SUM(""t1"".""ride_duration"") AS ""ride_duration"" FROM ""acceptedrides"" AS ""t1"" JOIN ""rides"" AS ""t2"" ON ""t2"".""ride_id""=""t1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""t2"".""requested_at"")=2020 GROUP BY ""month"") AS ""t2"" ON ""t2"".""month""=""t1"".""month"") AS ""t"") AS ""t"" WHERE ""month""<=10"
157,"WITH RECURSIVE ""cte1"" (""month"") AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte1"" WHERE ""month""<12), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""monthly_ride_distance"",SUM(""ar"".""ride_duration"") AS ""monhtly_ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month""), ""cte3"" AS (SELECT ""cte1"".""month"",COALESCE(""monthly_ride_distance"", 0) AS ""monthly_ride_distance"",COALESCE(""monhtly_ride_duration"", 0) AS ""monhtly_ride_duration"" FROM ""cte1"" LEFT JOIN ""cte2"" USING (""month"")), ""cte4"" AS (SELECT ""month"",ROUND((""monthly_ride_distance""+LEAD(""monthly_ride_distance"", 1) OVER (ORDER BY ""month"")+LEAD(""monthly_ride_distance"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_distance"",ROUND((""monhtly_ride_duration""+LEAD(""monhtly_ride_duration"", 1) OVER (ORDER BY ""month"")+LEAD(""monhtly_ride_duration"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_duration"" FROM ""cte3"") SELECT * FROM ""cte4"" WHERE ""month""<=10"
158,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""cte"" AS (SELECT ""m"".""month"",SUM(CASE WHEN ""a"".""ride_distance"" IS NOT NULL THEN ""a"".""ride_distance"" ELSE 0 END) AS ""total_distance"",SUM(CASE WHEN ""a"".""ride_duration"" IS NOT NULL THEN ""a"".""ride_duration"" ELSE 0 END) AS ""total_duration"" FROM (""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) RIGHT JOIN ""months"" AS ""m"" ON EXTRACT(MONTH FROM ""r"".""requested_at"")=""m"".""month"" GROUP BY ""m"".""month"") SELECT ""month"",""average_ride_distance"",""average_ride_duration"" FROM (SELECT ""c1"".""month"",ROUND(AVG(""c2"".""total_distance""), 2) AS ""average_ride_distance"",ROUND(AVG(""c2"".""total_duration""), 2) AS ""average_ride_duration"" FROM (""cte"" AS ""c1"") JOIN ""cte"" AS ""c2"" WHERE ""c2"".""month"">=""c1"".""month"" AND ""c2"".""month""<=""c1"".""month""+2 GROUP BY ""c1"".""month"") AS ""t"" WHERE ""month""<=10 ORDER BY ""month"""
159,"WITH RECURSIVE ""months_2020"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""months_2020"" WHERE ""month""<10), ""rides_2020"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",ROUND(SUM(COALESCE(""ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ""months_2020"" AS ""m"" LEFT JOIN ""rides_2020"" AS ""r"" ON ""m"".""month""<=""r"".""month"" AND ""r"".""month""<""m"".""month""+3 GROUP BY ""m"".""month"""
160,"WITH RECURSIVE ""cte_mo"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte_mo"" WHERE ""month""<=9), ""CTE"" AS (SELECT ""a"".""ride_distance"",""a"".""ride_duration"",CASE WHEN EXTRACT(MONTH FROM ""r"".""requested_at"")>=3 THEN EXTRACT(MONTH FROM ""r"".""requested_at"")-2 ELSE NULL END AS ""bucket1"",CASE WHEN EXTRACT(MONTH FROM ""r"".""requested_at"")>=2 THEN EXTRACT(MONTH FROM ""r"".""requested_at"")-1 ELSE NULL END AS ""bucket2"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""bucket3"" FROM ""ACCEPTEDRIDES"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""r"".""requested_at""<='2020-12-31' AND ""r"".""requested_at"">='2020-01-01') SELECT ""c"".""month"",ROUND(COALESCE(SUM(""t"".""ride_distance"")/3, 0), 2) AS ""AVERAGE_RIDE_DISTANCE"",ROUND(COALESCE(SUM(""t"".""ride_duration"")/3, 0), 2) AS ""AVERAGE_RIDE_duration"" FROM ""cte_mo"" AS ""c"" LEFT JOIN ""CTE"" AS ""t"" ON ""c"".""month""=""t"".""bucket1"" OR ""c"".""month""=""t"".""bucket2"" OR ""c"".""month""=""t"".""bucket3"" GROUP BY ""c"".""MONTH"""
161,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""b"" AS (SELECT ""month"".""month"" AS ""month"",COALESCE(""sum_ride_distance"", 0) AS ""sum_ride_distance"",COALESCE(""sum_ride_duration"", 0) AS ""sum_ride_duration"" FROM (SELECT EXTRACT(MONTH FROM ""Rides"".""requested_at"") AS ""month"",SUM(""AcceptedRides"".""ride_distance"") AS ""sum_ride_distance"",SUM(""AcceptedRides"".""ride_duration"") AS ""sum_ride_duration"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""Rides"".""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""Rides"".""requested_at"")) AS ""t1"" RIGHT JOIN ""month"" ON ""month"".""month""=""t1"".""month"") SELECT ""b1"".""month"",ROUND((""b1"".""sum_ride_distance""+""b2"".""sum_ride_distance""+""b3"".""sum_ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""b1"".""sum_ride_duration""+""b2"".""sum_ride_duration""+""b3"".""sum_ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""b"" AS ""b1"" JOIN ""b"" AS ""b2"") JOIN ""b"" AS ""b3"" ON ""b1"".""month""=""b2"".""month""-1 AND ""b2"".""month""=""b3"".""month""-1"
162,"WITH RECURSIVE ""my_pat"" AS (SELECT 1 AS ""month"",FLOOR(1/3) AS ""quarter"" UNION ALL SELECT ""month""+1,FLOOR((""month"")/3) FROM ""my_pat"" WHERE ""month""+1<=12), ""temp1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""ride_distance"",""ride_duration"" FROM ""AcceptedRides"" AS ""A"" JOIN ""Rides"" AS ""R"" ON ""A"".""ride_id""=""R"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 ORDER BY 1), ""temp2"" AS (SELECT ""my_pat"".""month"" AS ""month"",""quarter"",SUM(COALESCE(""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""ride_duration"", 0)) AS ""ride_duration"" FROM ""my_pat"" LEFT JOIN ""temp1"" ON ""my_pat"".""month""=""temp1"".""month"" GROUP BY 1,2), ""temp3"" AS (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""quarter"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""temp2"") SELECT * FROM ""temp3"" WHERE ""month""<=10"
163,"WITH ""Date_Bin"" AS (SELECT '2020-01-01' AS ""start_date"",CAST('2020-01-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"" UNION SELECT '2020-02-01' AS ""start_date"",CAST('2020-02-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"" UNION SELECT '2020-03-01' AS ""start_date"",CAST('2020-03-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"" UNION SELECT '2020-04-01' AS ""start_date"",CAST('2020-04-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"" UNION SELECT '2020-05-01' AS ""start_date"",CAST('2020-05-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"" UNION SELECT '2020-06-01' AS ""start_date"",CAST('2020-06-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"" UNION SELECT '2020-07-01' AS ""start_date"",CAST('2020-07-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"" UNION SELECT '2020-08-01' AS ""start_date"",CAST('2020-08-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"" UNION SELECT '2020-09-01' AS ""start_date"",CAST('2020-09-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"" UNION SELECT '2020-10-01' AS ""start_date"",CAST('2020-10-01' AS DATE) + INTERVAL '3 MONTH' AS ""end_date"") SELECT EXTRACT(MONTH FROM ""c"".""start_date"") AS ""month"",ROUND(SUM(COALESCE(""b"".""ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""b"".""ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM (""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"") RIGHT JOIN ""Date_Bin"" AS ""c"" ON ""a"".""requested_at"">=""c"".""start_date"" AND ""a"".""requested_at""<""c"".""end_date"" GROUP BY EXTRACT(MONTH FROM ""c"".""start_date"")"
164,"SELECT ""t1"".""month"",ROUND(AVG(COALESCE(""t2"".""ride_distance"", 0)) OVER (ORDER BY ""t1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""t2"".""ride_duration"", 0)) OVER (ORDER BY ""t1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT 1 AS ""MONTH"" UNION SELECT 2 AS ""MONTH"" UNION SELECT 3 AS ""MONTH"" UNION SELECT 4 AS ""MONTH"" UNION SELECT 5 AS ""MONTH"" UNION SELECT 6 AS ""MONTH"" UNION SELECT 7 AS ""MONTH"" UNION SELECT 8 AS ""MONTH"" UNION SELECT 9 AS ""MONTH"" UNION SELECT 10 AS ""MONTH"" UNION SELECT 11 AS ""MONTH"" UNION SELECT 12 AS ""MONTH"") AS ""t1"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1 ORDER BY 1) AS ""t2"" ON ""t1"".""month""=""t2"".""month"" ORDER BY 1 LIMIT 10"
165,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""mon"" UNION SELECT ""mon""+1 AS ""mon"" FROM ""all_months"" WHERE ""mon""<10), ""requested"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""requested_month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""requested_month"") SELECT ""a"".""mon"" AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""all_months"" AS ""a"" LEFT JOIN ""requested"" AS ""r"" ON ""r"".""requested_month""-""a"".""mon"" BETWEEN 0 AND 2 WHERE ""a"".""mon""<=10 GROUP BY ""a"".""mon"""
166,"WITH ""sort_temp"" AS (SELECT ""new_date"",""ride_id"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"",COALESCE(""requested_at"", ""new_date"") AS ""requested_at"" FROM (SELECT 1 AS ""new_date"" UNION SELECT 2 AS ""new_date"" UNION SELECT 3 AS ""new_date"" UNION SELECT 4 AS ""new_date"" UNION SELECT 5 AS ""new_date"" UNION SELECT 6 AS ""new_date"" UNION SELECT 7 AS ""new_date"" UNION SELECT 8 AS ""new_date"" UNION SELECT 9 AS ""new_date"" UNION SELECT 10 AS ""new_date"" UNION SELECT 11 AS ""new_date"" UNION SELECT 12 AS ""new_date"") AS ""c"" LEFT JOIN (SELECT ""a"".""ride_id"",""ride_distance"",""ride_duration"",EXTRACT(MONTH FROM ""requested_at"") AS ""requested_at"" FROM ""rides"" AS ""r"" RIGHT JOIN ""Acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""b"" ON ""c"".""new_date""=""b"".""requested_at"") SELECT ""requested_at"" AS ""month"",ROUND(AVG(""d"".""sum_distance"") OVER (ORDER BY ""d"".""requested_at"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""d"".""sum_duration"") OVER (ORDER BY ""d"".""requested_at"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""new_date"",""ride_id"",SUM(""ride_distance"") AS ""sum_distance"",SUM(""ride_duration"") AS ""sum_duration"",""requested_at"" AS ""requested_at"" FROM ""sort_temp"" GROUP BY ""sort_temp"".""requested_at"") AS ""d"" ORDER BY ""d"".""requested_at"" LIMIT 10"
167,"WITH RECURSIVE ""mon"" (""month_num"", ""month_st"", ""month_end"") AS (SELECT 1 AS ""month_num"",CAST('2020-01-01' AS DATE) + INTERVAL '0 MONTH' AS ""month_st"",CAST('2020-01-01' AS DATE) + INTERVAL '3 MONTH' AS ""month_end"" UNION ALL SELECT ""month_num""+1 AS ""month_num"",CAST('2020-01-01' AS DATE) + INTERVAL '""month_num"" MONTH' AS ""month_st"",CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""+3 MONTH' AS ""month_end"" FROM ""mon"" WHERE ""month_num""+1<=10), ""denorm"" AS (SELECT ""requested_at"",""ride_duration"",""ride_distance"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") SELECT ""m"".""month_num"" AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""mon"" AS ""m"" LEFT JOIN ""denorm"" AS ""d"" ON ""requested_at"">=""month_st"" AND ""requested_at""<""month_end"" GROUP BY ""m"".""month_num"""
168,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12), ""t1"" AS (SELECT ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""t"" LEFT JOIN (SELECT ""requested_at"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""Rides"" RIGHT JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" AND EXTRACT(YEAR FROM ""Rides"".""requested_at"")=2020) AS ""Rides"" ON ""t"".""month""=EXTRACT(MONTH FROM ""Rides"".""requested_at"") GROUP BY ""month"") SELECT ""month"",COALESCE(""average_ride_distance"", 0) AS ""average_ride_distance"",COALESCE(""average_ride_duration"", 0) AS ""average_ride_duration"" FROM (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""t1"") AS ""final"" WHERE ""month""<11"
169,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<10), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month"") SELECT ""m"".""month"",COALESCE(ROUND(SUM(""mr"".""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""mr"".""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ((""mr"".""month""-""m"".""month""=0) OR (""mr"".""month""-""m"".""month""=1) OR (""mr"".""month""-""m"".""month""=2)) GROUP BY 1 ORDER BY 1"
170,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""base"" AS (SELECT ""cte"".""month"",SUM(COALESCE(""a"".""ride_distance"", 0)) AS ""dis"",SUM(COALESCE(""a"".""ride_duration"", 0)) AS ""dur"" FROM (""cte"" LEFT JOIN ""Rides"" AS ""r"" ON ""cte"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY ""cte"".""month"") SELECT ""t"".""month"",""average_ride_distance"",""average_ride_duration"" FROM (SELECT ""b"".""month"",ROUND(AVG(""b"".""dis"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""b"".""dur"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""base"" AS ""b"" ORDER BY ""b"".""month"") AS ""t"" WHERE ""t"".""month""<=10"
171,"WITH RECURSIVE ""monthtemp"" AS (SELECT '2020-01-31' AS ""month"" UNION ALL SELECT LAST_DAY(""month"" + INTERVAL '1 MONTH') AS ""month"" FROM ""monthtemp"" WHERE ""month""<'2020-12-31'), ""ride_info"" AS (SELECT LAST_DAY(""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY LAST_DAY(""requested_at"") ORDER BY LAST_DAY(""requested_at"")) SELECT EXTRACT(MONTH FROM ""a"".""month"") AS ""month"",ROUND(COALESCE(SUM(""b"".""ride_distance"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""b"".""ride_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM ""monthtemp"" AS ""a"" LEFT JOIN ""ride_info"" AS ""b"" ON EXTRACT(MONTH FROM ""b"".""month"") BETWEEN EXTRACT(MONTH FROM ""a"".""month"") AND EXTRACT(MONTH FROM ""a"".""month"")+2 WHERE EXTRACT(MONTH FROM ""a"".""month"")<=10 GROUP BY 1 ORDER BY 1"
172,"WITH ""c1"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(COALESCE(""a"".""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""a"".""ride_duration"", 0)) AS ""ride_duration"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1), ""c2"" AS (WITH RECURSIVE ""se"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""se"" WHERE ""month""<12) SELECT * FROM ""se""), ""c3"" AS (SELECT ""c2"".""month"",COALESCE(""c1"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""c1"".""ride_duration"", 0) AS ""ride_duration"" FROM ""c2"" LEFT JOIN ""c1"" ON ""c2"".""month""=""c1"".""month""), ""c4"" AS (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""c3"" ORDER BY 1) SELECT * FROM ""c4"" WHERE ""month""<=10"
173,"WITH RECURSIVE ""cte_mo"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte_mo"" WHERE ""month""+1<=12), ""cte"" AS (SELECT ""a"".""ride_id"",""a"".""driver_id"",""a"".""ride_distance"" AS ""dis"",""a"".""ride_duration"" AS ""dur"",""r"".""requested_at"" AS ""dt"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31'), ""month_agg"" AS (SELECT ""m"".""month"",SUM(CASE WHEN EXTRACT(MONTH FROM ""c"".""dt"")=""m"".""month"" THEN ""dis"" ELSE 0 END) AS ""total_dis"",SUM(CASE WHEN EXTRACT(MONTH FROM ""c"".""dt"")=""m"".""month"" THEN ""dur"" ELSE 0 END) AS ""total_dur"" FROM (""cte_mo"" AS ""m"") JOIN ""cte"" AS ""c"" GROUP BY 1), ""lead_res"" AS (SELECT ""month"",""total_dis"",COALESCE(LEAD(""total_dis"", 1) OVER (ORDER BY ""month""), 0) AS ""lead_1_mo_dis"",COALESCE(LEAD(""total_dis"", 2) OVER (ORDER BY ""month""), 0) AS ""lead_2_mo_dis"",""total_dur"",COALESCE(LEAD(""total_dur"", 1) OVER (ORDER BY ""month""), 0) AS ""lead_1_mo_dur"",COALESCE(LEAD(""total_dur"", 2) OVER (ORDER BY ""month""), 0) AS ""lead_2_mo_dur"" FROM ""month_agg"") SELECT ""month"",ROUND((""total_dis""+""lead_1_mo_dis""+""lead_2_mo_dis"")*1.0/3, 2) AS ""average_ride_distance"",ROUND((""total_dur""+""lead_1_mo_dur""+""lead_2_mo_dur"")*1.0/3, 2) AS ""average_ride_duration"" FROM ""lead_res"" WHERE ""month""<=10"
174,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""months"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND(SUM(""sum_dis"") OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""sum_dur"") OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""t3"".""month"",SUM(COALESCE(""ride_distance"", 0)) AS ""sum_dis"",SUM(COALESCE(""ride_duration"", 0)) AS ""sum_dur"" FROM (""months"" AS ""t3"" LEFT JOIN (SELECT ""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" WHERE DATE(""requested_at"") BETWEEN '2020-01-01' AND '2020-12-31') AS ""t1"" ON ""t3"".""month""=""t1"".""month"") LEFT JOIN ""AcceptedRides"" AS ""t2"" ON ""t1"".""ride_id""=""t2"".""ride_id"" GROUP BY ""t3"".""month"") AS ""t"") AS ""tt"" WHERE ""month""<=10"
175,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""+1<13), ""record"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""MONTH"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""MONTH""), ""final_record"" AS (SELECT ""month"",ROUND((""distance""+LEAD(""distance"") OVER (ORDER BY ""month"")+LEAD(""distance"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_distance"",ROUND((""duration""+LEAD(""duration"") OVER (ORDER BY ""month"")+LEAD(""duration"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_duration"" FROM (SELECT ""Months"".""Month"" AS ""month"",COALESCE(""distance"", 0) AS ""DISTANCE"",COALESCE(""duration"", 0) AS ""duration"" FROM ""Months"" LEFT JOIN ""record"" ON ""Months"".""Month""=""record"".""Month"") AS ""mth_record"") SELECT * FROM ""final_record"" WHERE ""month""<11"
176,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""orders"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""orders_all"" AS (SELECT ""m"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""orders"" AS ""o"" ON ""m"".""month""=""o"".""month"") SELECT ""o1"".""month"" AS ""month"",ROUND(SUM(""o2"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""o2"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ""orders_all"" AS ""o1"" LEFT JOIN ""orders_all"" AS ""o2"" ON ""o1"".""month""=""o2"".""month"" OR ""o1"".""month""=""o2"".""month""-1 OR ""o1"".""month""=""o2"".""month""-2 GROUP BY ""o1"".""month"" ORDER BY ""o1"".""month"" LIMIT 10"
177,"WITH RECURSIVE ""MonthSeq"" AS (SELECT 1 AS ""MONTH_NUM"" UNION ALL SELECT ""MONTH_NUM""+1 FROM ""MonthSeq"" WHERE ""MONTH_NUM""<12), ""AcceptedRides2"" AS (SELECT ""A1"".*,EXTRACT(MONTH FROM ""R1"".""requested_at"") AS ""MONTH_NUM"" FROM ""AcceptedRides"" AS ""A1"" JOIN ""Rides"" AS ""R1"" ON ""A1"".""ride_id""=""R1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""AcceptedRides3"" AS (SELECT ""MONTH_NUM"",SUM(""ride_distance"") AS ""monthly_ride_distance"",SUM(""ride_duration"") AS ""monthly_ride_duration"" FROM ""AcceptedRides2"" GROUP BY ""MONTH_NUM"") SELECT * FROM (SELECT ""M1"".""MONTH_NUM"" AS ""month"",ROUND(SUM(COALESCE(""monthly_ride_distance"", 0)) OVER (ORDER BY ""M1"".""MONTH_NUM"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""monthly_ride_duration"", 0)) OVER (ORDER BY ""M1"".""MONTH_NUM"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""MonthSeq"" AS ""M1"" LEFT JOIN ""AcceptedRides3"" AS ""A2"" ON ""M1"".""MONTH_NUM""=""A2"".""MONTH_NUM"") AS ""T1"" WHERE ""month""<=10"
178,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""m"" WHERE ""month""<12), ""v"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""m_number"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM (""Rides"" AS ""ina"") JOIN ""AcceptedRides"" AS ""inb"" WHERE ""ina"".""ride_id""=""inb"".""ride_id"" AND ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""tmp"" AS (SELECT ""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""m"" LEFT JOIN ""v"" ON ""m"".""month""=""v"".""m_number"") SELECT ""ina"".""month"",ROUND((""ina"".""ride_distance""+""inb"".""ride_distance""+""inc"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""ina"".""ride_duration""+""inb"".""ride_duration""+""inc"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ((""tmp"" AS ""ina"") JOIN ""tmp"" AS ""inb"") JOIN ""tmp"" AS ""inc"" WHERE ""ina"".""month""+1=""inb"".""month"" AND ""inb"".""month""+1=""inc"".""month"" AND ""ina"".""month""<=10 GROUP BY ""ina"".""month"""
179,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""n"" UNION ALL SELECT ""n""+1 AS ""n"" FROM ""month"" WHERE ""n""<12), ""sumride"" AS (SELECT ""month"".""n"" AS ""month"",COALESCE(""m"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""m"".""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" AS ""month"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""b"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""b"".""requested_at"") ORDER BY 1) AS ""m"" ON ""month"".""n""=""m"".""month"") SELECT ""t1"".""month"",ROUND(SUM(""t1"".""ride_distance""+""t2"".""ride_distance""+""t3"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""t1"".""ride_duration""+""t2"".""ride_duration""+""t3"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""sumride"" AS ""t1"" JOIN ""sumride"" AS ""t2"") JOIN ""sumride"" AS ""t3"" ON ""t1"".""month""=""t2"".""month""-1 AND ""t2"".""month""=""t3"".""month""-1 GROUP BY ""t1"".""month"""
180,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month""), ""every_month_rides"" AS (SELECT ""m"".""month"",COALESCE(""mr"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""mr"".""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ""mr"".""month""=""m"".""month"") SELECT ""t1"".""month"" AS ""month"",ROUND((""t1"".""ride_distance""+""t2"".""ride_distance""+""t3"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""ride_duration""+""t2"".""ride_duration""+""t3"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM ((""every_month_rides"" AS ""t1"") JOIN ""every_month_rides"" AS ""t2"") JOIN ""every_month_rides"" AS ""t3"" WHERE ""t1"".""month""=""t2"".""month""-1 AND ""t1"".""month""=""t3"".""month""-2"
181,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""cte0"" AS (SELECT ""a"".""ride_id"",""a"".""ride_distance"",""a"".""ride_duration"",""r"".""requested_at"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020), ""cte2"" AS (SELECT ""rt"".""month"",COALESCE(""total_distance"", 0) AS ""total_distance"",COALESCE(""total_duration"", 0) AS ""total_duration"" FROM ""cte"" AS ""rt"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""cte0"" GROUP BY ""month"") AS ""t"" ON ""rt"".""month""=""t"".""month"") SELECT * FROM (SELECT ""month"",ROUND(AVG(""total_distance"") OVER (ORDER BY ""month"" RANGE BETWEEN 0 FOLLOWING AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""total_duration"") OVER (ORDER BY ""month"" RANGE BETWEEN 0 FOLLOWING AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte2"" ORDER BY 1) AS ""t"" WHERE ""month""<11"
182,"SELECT ""temp"".""month"",ROUND(COALESCE(SUM(""t"".""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""t"".""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"")) AS ""temp"" LEFT JOIN (SELECT ""R"".""ride_id"",""R"".""requested_at"",""AR"".""ride_distance"",""AR"".""ride_duration"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""AR"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE LEFT(""R"".""requested_at"", 4)=2020) AS ""t"" ON EXTRACT(MONTH FROM ""t"".""requested_at"")>=""temp"".""month"" AND EXTRACT(MONTH FROM ""t"".""requested_at"")<=""temp"".""month""+2 GROUP BY ""temp"".""month"" ORDER BY ""temp"".""month"""
183,"WITH RECURSIVE ""t"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12) SELECT DISTINCT ""t"".""month"",COALESCE(ROUND(SUM(""ride_distance"") OVER (ORDER BY ""t"".""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"") OVER (ORDER BY ""t"".""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""t"" LEFT JOIN (SELECT ""r"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""ride_distance"",""ride_duration"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""requested_at"" - CAST('2020-01-01' AS DATE)>=0 AND ""requested_at"" - CAST('2020-12-31' AS DATE)<=0 AND ""ride_distance"" IS NOT NULL) AS ""f"" ON ""t"".""month""=""f"".""month"" ORDER BY 1 LIMIT 10"
184,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""AcceptedRide_2020"" AS (SELECT ""a"".*,EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" LIKE '2020%'), ""months_rides"" AS (SELECT ""m"".""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""AcceptedRide_2020"" AS ""a"" ON ""m"".""month""=""a"".""month"" GROUP BY ""m"".""month""), ""all_months"" AS (SELECT ""month"",ROUND(AVG(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""months_rides"") SELECT * FROM ""all_months"" WHERE ""month""<=10"
185,"WITH RECURSIVE ""cte2"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte2"" WHERE ""month""<=9), ""cte"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(COALESCE(""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""ride_duration"", 0)) AS ""ride_duration"" FROM ""Rides"" AS ""a"" LEFT JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"">='2020-01-01' AND ""requested_at""<'2021-01-01' GROUP BY 1) SELECT ""a"".""month"",ROUND(SUM(COALESCE(""b"".""ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""b"".""ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ""cte2"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON (""b"".""month"" BETWEEN ""a"".""month"" AND ""a"".""month""+2) GROUP BY 1 ORDER BY 1"
186,"WITH RECURSIVE ""mon"" (""month_num"", ""month_st"", ""month_end"") AS (SELECT 1 AS ""month_num"",CAST('2020-01-01' AS DATE) + INTERVAL '0 MONTH' AS ""month_st"",CAST('2020-01-01' AS DATE) + INTERVAL '3 MONTH' AS ""month_end"" UNION ALL SELECT ""month_num""+1 AS ""month_num"",CAST('2020-01-01' AS DATE) + INTERVAL '""month_num"" MONTH' AS ""month_st"",CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""+3 MONTH' AS ""month_end"" FROM ""mon"" WHERE ""month_num""+1<=10), ""denorm"" AS (SELECT ""requested_at"",""ride_duration"",""ride_distance"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") SELECT ""m"".""month_num"" AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""mon"" AS ""m"" LEFT JOIN ""denorm"" AS ""d"" ON ""requested_at"">=""month_st"" AND ""requested_at""<""month_end"" GROUP BY ""m"".""month_num"""
187,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",COALESCE(SUM(""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""ride_duration""), 0) AS ""ride_duration"" FROM (""cte"" LEFT JOIN ""rides"" AS ""r"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"") AS ""f1"") AS ""f2"" WHERE ""month""<11"
188,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""temp"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020), ""temp2"" AS (SELECT ""cte"".""month"",CASE WHEN ""temp"".""month"" IS NULL THEN 0 ELSE SUM(""temp"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""temp"".""month"" IS NULL THEN 0 ELSE SUM(""temp"".""ride_duration"") END AS ""ride_duration"" FROM ""cte"" LEFT JOIN ""temp"" USING (""month"") GROUP BY ""month"") SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""temp2"" ORDER BY ""month"" LIMIT 10"
189,"WITH RECURSIVE ""mon"" AS (SELECT 1 AS ""month_num"" UNION ALL SELECT ""month_num""+1 AS ""month_num"" FROM ""mon"" WHERE ""month_num""+1<=10), ""denorm"" AS (SELECT ""requested_at"",""ride_duration"",""ride_distance"" FROM (""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") LEFT JOIN ""Drivers"" AS ""d"" ON ""d"".""driver_id""=""ar"".""driver_id"") SELECT ""m"".""month_num"" AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""mon"" AS ""m"" LEFT JOIN ""denorm"" AS ""d"" ON ""requested_at"">=CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""-1 MONTH' AND ""requested_at""<CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""+2 MONTH' GROUP BY ""m"".""month_num"""
190,"WITH RECURSIVE ""t"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE TO_CHAR(""requested_at"", 'YYYY')=2020 GROUP BY TO_CHAR(""requested_at"", '%m')), ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11) SELECT ""m"".""month"" AS ""month"",ROUND(COALESCE(SUM(""total_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""total_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 0)/3, 2) AS ""average_ride_duration"" FROM ""t"" RIGHT JOIN ""m"" ON ""t"".""month""=""m"".""month"" ORDER BY ""month"" LIMIT 10"
191,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_duration"") END AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final_list"" ORDER BY ""month"" LIMIT 10"
192,"WITH RECURSIVE ""full_year"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""full_year"" WHERE ""month""<12), ""CTE_1"" AS (SELECT ""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""Month"",EXTRACT(YEAR FROM ""requested_at"") AS ""Year"" FROM ""Rides""), ""CTE_2"" AS (SELECT ""CTE_1"".""ride_id"",""CTE_1"".""Year"",""CTE_1"".""Month"",""ride_distance"",""ride_duration"" FROM ""AcceptedRides"" LEFT JOIN ""CTE_1"" ON ""AcceptedRides"".""ride_id""=""CTE_1"".""ride_id"" WHERE ""CTE_1"".""Year""=2020), ""CTE_3"" AS (SELECT ""ride_id"",""Year"",""full_year"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""CTE_2"" RIGHT JOIN ""full_year"" ON ""full_year"".""month""=""CTE_2"".""Month"" ORDER BY ""full_year"".""month""), ""CTE_4"" AS (SELECT ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""CTE_3"" GROUP BY ""month""), ""CTE_5"" AS (SELECT ""month"",AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""ride_distance"",AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""ride_duration"" FROM ""CTE_4"") SELECT ""month"",ROUND(""ride_distance"", 2) AS ""average_ride_distance"",ROUND(""ride_duration"", 2) AS ""average_ride_duration"" FROM ""CTE_5"" WHERE ""month""<=10"
193,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<10) SELECT ""m"".""month"",COALESCE(""r"".""avg_dis"", 0) AS ""average_ride_distance"",COALESCE(""r"".""avg_dur"", 0) AS ""average_ride_duration"" FROM ""all_months"" AS ""m"" LEFT JOIN (SELECT ""m"".""month"",ROUND(SUM(""a"".""ride_distance"")/3, 2) AS ""avg_dis"",ROUND(SUM(""a"".""ride_duration"")/3, 2) AS ""avg_dur"" FROM ((SELECT * FROM ""all_months"") AS ""m"" JOIN ""rides"" AS ""r"" ON EXTRACT(MONTH FROM ""r"".""requested_at"") BETWEEN ""m"".""month"" AND ""m"".""month""+2) JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020.01.01' AND '2020.12.31' GROUP BY 1) AS ""r"" ON ""m"".""month""=""r"".""month"""
194,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""ridesStat"" AS (SELECT EXTRACT(MONTH FROM ""r1"".""requested_at"") AS ""month"",SUM(""a1"".""ride_distance"") AS ""distance"",SUM(""a1"".""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""a1"" LEFT JOIN ""Rides"" AS ""r1"" ON ""r1"".""ride_id""=""a1"".""ride_id"" WHERE ""r1"".""requested_at"" LIKE '2020%' GROUP BY 1), ""ridesStat2"" AS (SELECT ""c1"".""month"",COALESCE(ROUND(SUM(""r1"".""distance"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""r1"".""duration"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""cte"" AS ""c1"" LEFT JOIN ""ridesStat"" AS ""r1"" ON ""r1"".""month""=""c1"".""month"") SELECT * FROM ""ridesStat2"" WHERE ""month""<=10"
195,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_duration"") END AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final_list"" ORDER BY ""month"" LIMIT 10"
196,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""m"" WHERE ""month""<12), ""cte1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""dist"",SUM(""ride_duration"") AS ""dur"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""cte2"" AS (SELECT ""a"".""month"",COALESCE(""dist"", 0) AS ""dist"",COALESCE(""dur"", 0) AS ""dur"" FROM ""m"" AS ""a"" LEFT JOIN ""cte1"" AS ""b"" ON ""a"".""month""=""b"".""month"") SELECT ""a"".""month"",ROUND((""a"".""dist""+""b"".""dist""+""c"".""dist"")/3, 2) AS ""average_ride_distance"",ROUND((""a"".""dur""+""b"".""dur""+""c"".""dur"")/3, 2) AS ""average_ride_duration"" FROM (""cte2"" AS ""a"" JOIN ""cte2"" AS ""b"" ON ""a"".""month""=""b"".""month""-1) JOIN ""cte2"" AS ""c"" ON ""a"".""month""=""c"".""month""-2 ORDER BY ""a"".""month"""
197,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<12), ""t"" AS (SELECT ""m"".""month"",COALESCE(SUM(""ride_distance""), 0) AS ""t_d"",COALESCE(SUM(""ride_duration""), 0) AS ""dur"" FROM (""m"" LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY ""m"".""month"") SELECT ""month"",ROUND(AVG(""t_d"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""dur"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""t"" LIMIT 10"
198,"WITH ""tbl"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""total_ride_distance"",SUM(""a"".""ride_duration"") AS ""total_ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month""), ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9 UNION ALL SELECT 10) SELECT ""months"".""month"",ROUND((COALESCE(""t1"".""total_ride_distance"", 0)+COALESCE(""t2"".""total_ride_distance"", 0)+COALESCE(""t3"".""total_ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""t1"".""total_ride_duration"", 0)+COALESCE(""t2"".""total_ride_duration"", 0)+COALESCE(""t3"".""total_ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ((""months"" LEFT JOIN ""tbl"" AS ""t1"" ON ""months"".""month""=""t1"".""month"") LEFT JOIN ""tbl"" AS ""t2"" ON ""months"".""month""+1=""t2"".""month"") LEFT JOIN ""tbl"" AS ""t3"" ON ""months"".""month""+2=""t3"".""month"""
199,"WITH RECURSIVE ""full_year"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""full_year"" WHERE ""month""<12), ""cte1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""requested_at"">='2020-01-01' AND ""requested_at""<'2021-01-01' GROUP BY ""month"" ORDER BY ""requested_at""), ""cte2"" AS (SELECT ""full_year"".""month"",""ride_distance"",""ride_duration"",LEAD(""ride_distance"", 1) OVER (ORDER BY ""full_year"".""month"") AS ""ride_distance_next"",LEAD(""ride_distance"", 2) OVER (ORDER BY ""full_year"".""month"") AS ""ride_distance_next_next"",LEAD(""ride_duration"", 1) OVER (ORDER BY ""full_year"".""month"") AS ""ride_duration_next"",LEAD(""ride_duration"", 2) OVER (ORDER BY ""full_year"".""month"") AS ""ride_duration_next_next"" FROM ""full_year"" LEFT JOIN ""cte1"" ON ""full_year"".""month""=""cte1"".""month"" ORDER BY ""full_year"".""month"") SELECT ""month"",ROUND((COALESCE(""ride_distance"", 0)+COALESCE(""ride_distance_next"", 0)+COALESCE(""ride_distance_next_next"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""ride_duration"", 0)+COALESCE(""ride_duration_next"", 0)+COALESCE(""ride_duration_next_next"", 0))/3, 2) AS ""average_ride_duration"" FROM ""cte2"" WHERE ""month""<=10"
200,"WITH RECURSIVE ""datedim"" AS (SELECT 1 AS ""num"" UNION ALL SELECT ""num""+1 FROM ""datedim"" WHERE ""num""<12), ""monthlysum"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_dis_monthly"",SUM(""ar"".""ride_duration"") AS ""ride_dur_monthly"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT * FROM (SELECT ""dd"".""num"" AS ""month"",ROUND(AVG(COALESCE(""ms"".""ride_dis_monthly"", 0)) OVER (ORDER BY ""dd"".""num"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""ms"".""ride_dur_monthly"", 0)) OVER (ORDER BY ""dd"".""num"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""datedim"" AS ""dd"" LEFT JOIN ""monthlysum"" AS ""ms"" ON ""ms"".""month""=""dd"".""num"") AS ""d"" WHERE ""month""<=10"
201,"WITH RECURSIVE ""tmp"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""tmp"" WHERE ""month""<10), ""tmp1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month"") SELECT ""a"".""month"",COALESCE(ROUND((COALESCE(""b"".""distance"", 0)+COALESCE(""c"".""distance"", 0)+COALESCE(""d"".""distance"", 0))/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND((COALESCE(""b"".""duration"", 0)+COALESCE(""c"".""duration"", 0)+COALESCE(""d"".""duration"", 0))/3, 2), 0) AS ""average_ride_duration"" FROM ((""tmp"" AS ""a"" LEFT JOIN ""tmp1"" AS ""b"" ON ""a"".""month""=""b"".""month"") LEFT JOIN ""tmp1"" AS ""c"" ON ""a"".""month""+1=""c"".""month"") LEFT JOIN ""tmp1"" AS ""d"" ON ""a"".""month""+2=""d"".""month"" ORDER BY ""month"""
202,"WITH RECURSIVE ""cte_count"" (""n"") AS (SELECT 1 UNION ALL SELECT ""n""+1 FROM ""cte_count"" WHERE ""n""<12) SELECT * FROM (SELECT ""n"" AS ""month"",COALESCE(ROUND(SUM(""average_ride_distance"") OVER (ORDER BY ""N"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""average_ride_duration"") OVER (ORDER BY ""N"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""cte_count"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""Month"",SUM(""ride_distance"") AS ""average_ride_distance"",SUM(""ride_duration"") AS ""average_ride_duration"" FROM ""RIDES"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""Month_Calculation"" ON ""cte_count"".""n""=""Month_Calculation"".""Month"") AS ""fINAL"" WHERE ""month""<11 ORDER BY ""month"""
203,"WITH RECURSIVE ""month_2020"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_2020"" WHERE ""month""<10), ""sum_by_month"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""m"".""month"",ROUND(SUM(COALESCE(""distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ""month_2020"" AS ""m"" LEFT JOIN ""sum_by_month"" AS ""s"" ON ""s"".""month"">=""m"".""month"" AND ""s"".""month""<(""m"".""month""+3) GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
204,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""info"" AS (SELECT ""m"".""month"",COALESCE(""dis"", 0) AS ""dis"",COALESCE(""dur"", 0) AS ""dur"" FROM ""months"" AS ""m"" LEFT JOIN (SELECT SUM(""ride_distance"") AS ""dis"",SUM(""ride_duration"") AS ""dur"",TO_CHAR(""requested_at"", '%m') AS ""month"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" LIKE '2020%' GROUP BY ""month"") AS ""c"" ON ""m"".""month""=""c"".""month"") SELECT ""month"",ROUND((""dis""+""led1""+""led2"")/3, 2) AS ""average_ride_distance"",ROUND((""dur""+""ledt1""+""ledt2"")/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",""dis"",LEAD(""dis"") OVER (ORDER BY ""month"") AS ""led1"",LEAD(""dis"", 2, 0) OVER (ORDER BY ""month"") AS ""led2"",""dur"",LEAD(""dur"") OVER (ORDER BY ""month"") AS ""ledt1"",LEAD(""dur"", 2, 0) OVER (ORDER BY ""month"") AS ""ledt2"" FROM ""info"") AS ""c"" WHERE ""month""<11 GROUP BY ""month"""
205,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND(AVG(""tot_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""tot_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""M"".""month"",COALESCE(""tot_distance"", 0) AS ""tot_distance"",COALESCE(""tot_duration"", 0) AS ""tot_duration"" FROM ""month"" AS ""M"" LEFT JOIN (SELECT ""A"".""ride_id"",""driver_id"",SUM(""ride_distance"") AS ""tot_distance"",SUM(""ride_duration"") AS ""tot_duration"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""A"" LEFT JOIN ""Rides"" AS ""R"" ON ""A"".""ride_id""=""R"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""temp"" ON ""M"".""month""=""temp"".""month"") AS ""temp1"") AS ""temp2"" WHERE ""month""<=10"
206,"SELECT ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (SELECT ""months"".""month"",""ride_id"" FROM ""Rides"" RIGHT JOIN (SELECT '2020-1-1' AS ""start"",'2020-3-31' AS ""last"",1 AS ""month"" UNION SELECT '2020-2-1','2020-4-30',2 UNION SELECT '2020-3-1','2020-5-31',3 UNION SELECT '2020-4-1','2020-6-30',4 UNION SELECT '2020-5-1','2020-7-31',5 UNION SELECT '2020-6-1','2020-8-31',6 UNION SELECT '2020-7-1','2020-9-30',7 UNION SELECT '2020-8-1','2020-10-31',8 UNION SELECT '2020-9-1','2020-11-30',9 UNION SELECT '2020-10-1','2020-12-31',10) AS ""months"" ON ""months"".""start""<=""requested_at"" AND ""months"".""last"">=""requested_at"") AS ""total"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""total"".""ride_id""=""a"".""ride_id"" GROUP BY ""month"" ORDER BY ""month"""
207,"WITH ""tbl"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""total_ride_distance"",SUM(""a"".""ride_duration"") AS ""total_ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month""), ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9 UNION ALL SELECT 10) SELECT ""months"".""month"",ROUND((COALESCE(""t1"".""total_ride_distance"", 0)+COALESCE(""t2"".""total_ride_distance"", 0)+COALESCE(""t3"".""total_ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""t1"".""total_ride_duration"", 0)+COALESCE(""t2"".""total_ride_duration"", 0)+COALESCE(""t3"".""total_ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ((""months"" LEFT JOIN ""tbl"" AS ""t1"" ON ""months"".""month""=""t1"".""month"") LEFT JOIN ""tbl"" AS ""t2"" ON ""months"".""month""+1=""t2"".""month"") LEFT JOIN ""tbl"" AS ""t3"" ON ""months"".""month""+2=""t3"".""month"""
208,"WITH RECURSIVE ""dummy"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""dummy"" WHERE ""month""+1<=12), ""total"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distT"",SUM(""ride_duration"") AS ""durationT"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""combined"" AS (SELECT ""dummy"".""month"",COALESCE(""distT"", 0) AS ""distT"",COALESCE(""durationT"", 0) AS ""durationT"" FROM ""dummy"" LEFT JOIN ""total"" ON ""dummy"".""month""=""total"".""month"") SELECT ""c1"".""month"",ROUND(SUM(""c2"".""distT"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""c2"".""durationT"")/3, 2) AS ""average_ride_duration"" FROM ""combined"" AS ""c1"" JOIN ""combined"" AS ""c2"" WHERE ""c2"".""month""-""c1"".""month"">=0 AND ""c2"".""month""-""c1"".""month""<=2 AND ""c1"".""month""<=10 GROUP BY ""c1"".""month"" ORDER BY 1"
209,"WITH RECURSIVE ""a"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""a"" WHERE ""month""<12), ""b"" AS (SELECT CASE WHEN SUBSTRING(""requested_at"", 6, 2) LIKE '0%' THEN SUBSTRING(""requested_at"", 7, 1) ELSE SUBSTRING(""requested_at"", 6, 2) END AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE TO_CHAR(""requested_at"", 'YYYY')=2020 GROUP BY 1), ""c"" AS (SELECT ""a"".""month"",COALESCE(""ride_distance"", 0) AS ""distance"",COALESCE(""ride_duration"", 0) AS ""duration"" FROM ""a"" LEFT JOIN ""b"" USING (""month"")) SELECT ""month"",ROUND(SUM(""distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""c"" LIMIT 10"
210,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",COALESCE(SUM(""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""ride_duration""), 0) AS ""ride_duration"" FROM (""cte"" LEFT JOIN ""rides"" AS ""r"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"") AS ""f1"") AS ""f2"" WHERE ""month""<11"
211,"WITH RECURSIVE ""months_in_year"" AS (SELECT 1 AS ""month_num"" UNION SELECT ""month_num""+1 FROM ""months_in_year"" WHERE ""month_num""<12) SELECT * FROM (SELECT ""ride_month"" AS ""month"",ROUND((""total_distance""+COALESCE(LEAD(""total_distance"") OVER (), 0)+COALESCE(LEAD(""total_distance"", 2) OVER (), 0))/3, 2) AS ""average_ride_distance"",ROUND((""total_duration""+COALESCE(LEAD(""total_duration"") OVER (), 0)+COALESCE(LEAD(""total_duration"", 2) OVER (), 0))/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month_num"" AS ""ride_month"",COALESCE(""total_distance"", 0) AS ""total_distance"",COALESCE(""total_duration"", 0) AS ""total_duration"" FROM ""months_in_year"" AS ""MIY"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""ride_month"",SUM(""AR"".""ride_distance"") AS ""total_distance"",SUM(""AR"".""ride_duration"") AS ""total_duration"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""AR"".""ride_id""=""R"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""ride_month"" ORDER BY ""ride_month"") AS ""RI"" ON ""MIY"".""month_num""=""RI"".""ride_month"") AS ""all_month"") AS ""all_month_averages"" WHERE ""month""<=10"
212,"WITH RECURSIVE ""M"" AS (SELECT 1 AS ""MONTH"" UNION SELECT ""MONTH""+1 FROM ""M"" WHERE ""MONTH""<12), ""TEMP"" AS (SELECT ""M"".""MONTH"",SUM(COALESCE(""AR"".""RIDE_DISTANCE"", 0)) AS ""DISTANCE_SUM"",SUM(COALESCE(""AR"".""RIDE_DURATION"", 0)) AS ""DURATION_SUM"" FROM (""M"" LEFT JOIN ""RIDES"" AS ""R"" ON ""M"".""MONTH""=EXTRACT(MONTH FROM ""R"".""REQUESTED_AT"") AND EXTRACT(YEAR FROM ""R"".""REQUESTED_AT"")=2020) LEFT JOIN ""ACCEPTEDRIDES"" AS ""AR"" ON ""R"".""RIDE_ID""=""AR"".""RIDE_ID"" GROUP BY ""M"".""MONTH""), ""TEMP2"" AS (SELECT ""MONTH"",AVG(""DISTANCE_SUM"") OVER (ORDER BY ""MONTH"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""AVERAGE_RIDE_DISTANCE"",AVG(""DURATION_SUM"") OVER (ORDER BY ""MONTH"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""AVERAGE_RIDE_DURATION"" FROM ""TEMP"") SELECT ""MONTH"",ROUND(COALESCE(""AVERAGE_RIDE_DISTANCE"", 0), 2) AS ""AVERAGE_RIDE_DISTANCE"",ROUND(COALESCE(""AVERAGE_RIDE_DURATION"", 0), 2) AS ""AVERAGE_RIDE_DURATION"" FROM ""TEMP2"" WHERE ""MONTH""<=10 ORDER BY 1"
213,"WITH RECURSIVE ""cte_month_spine"" AS (SELECT 1 AS ""n"" UNION ALL SELECT ""n""+1 AS ""n"" FROM ""cte_month_spine"" WHERE ""n""<12), ""cte_rides"" AS (SELECT ""ms"".""n"" AS ""month"",COALESCE(SUM(""ar"".""ride_distance""), 0) AS ""monthly_ride_distance"",COALESCE(SUM(""ar"".""ride_duration""), 0) AS ""monthly_ride_duration"" FROM (""cte_month_spine"" AS ""ms"" LEFT JOIN ""Rides"" AS ""r"" ON ""r"".""requested_at"" BETWEEN CONCAT('2020-', ""ms"".""n"", '-01') AND LAST_DAY(CONCAT('2020-', ""ms"".""n"", '-01'))) LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY 1), ""cte_final"" AS (SELECT ""r"".""month"",ROUND(AVG(""monthly_ride_distance"") OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""monthly_ride_duration"") OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte_rides"" AS ""r"" ORDER BY 1) SELECT * FROM ""cte_final"" WHERE ""month""<=10"
214,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<10) SELECT ""m"".""month"",COALESCE(""r"".""avg_dis"", 0) AS ""average_ride_distance"",COALESCE(""r"".""avg_dur"", 0) AS ""average_ride_duration"" FROM ""all_months"" AS ""m"" LEFT JOIN (SELECT ""m"".""month"",ROUND(SUM(""a"".""ride_distance"")/3, 2) AS ""avg_dis"",ROUND(SUM(""a"".""ride_duration"")/3, 2) AS ""avg_dur"" FROM ((SELECT * FROM ""all_months"") AS ""m"" JOIN ""rides"" AS ""r"" ON EXTRACT(MONTH FROM ""r"".""requested_at"") BETWEEN ""m"".""month"" AND ""m"".""month""+2) JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020.01.01' AND '2020.12.31' GROUP BY 1) AS ""r"" ON ""m"".""month""=""r"".""month"""
215,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""t1"" WHERE ""month""<10), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""t1"".""month"",ROUND(COALESCE(SUM(""ride_distance"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""month""=""t2"".""month"" OR ""t1"".""month""=""t2"".""month""-1 OR ""t1"".""month""=""t2"".""month""-2 GROUP BY ""month"" ORDER BY ""month"""
216,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""+1<13), ""record"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""MONTH"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""MONTH""), ""final_record"" AS (SELECT ""month"",ROUND((""distance""+LEAD(""distance"") OVER (ORDER BY ""month"")+LEAD(""distance"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_distance"",ROUND((""duration""+LEAD(""duration"") OVER (ORDER BY ""month"")+LEAD(""duration"", 2) OVER (ORDER BY ""month""))/3, 2) AS ""average_ride_duration"" FROM (SELECT ""Months"".""Month"" AS ""month"",COALESCE(""distance"", 0) AS ""DISTANCE"",COALESCE(""duration"", 0) AS ""duration"" FROM ""Months"" LEFT JOIN ""record"" ON ""Months"".""Month""=""record"".""Month"") AS ""mth_record"") SELECT * FROM ""final_record"" WHERE ""month""<11"
217,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<10) SELECT ""m"".""month"",COALESCE(""r"".""avg_dis"", 0) AS ""average_ride_distance"",COALESCE(""r"".""avg_dur"", 0) AS ""average_ride_duration"" FROM ""all_months"" AS ""m"" LEFT JOIN (SELECT ""m"".""month"",ROUND(SUM(""a"".""ride_distance"")/3, 2) AS ""avg_dis"",ROUND(SUM(""a"".""ride_duration"")/3, 2) AS ""avg_dur"" FROM ((SELECT * FROM ""all_months"") AS ""m"" LEFT JOIN ""rides"" AS ""r"" ON EXTRACT(MONTH FROM ""r"".""requested_at"") BETWEEN ""m"".""month"" AND ""m"".""month""+2) LEFT JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020.01.01' AND '2020.12.31' GROUP BY 1) AS ""r"" ON ""m"".""month""=""r"".""month"""
218,"WITH RECURSIVE ""CTE1"" (""MONTH"") AS (SELECT 1 AS ""MONTH"" UNION ALL SELECT ""MONTH""+1 FROM ""CTE1"" WHERE ""MONTH""<12), ""CTE2"" AS (SELECT ""RIDE_DISTANCE"",""RIDE_DURATION"",EXTRACT(MONTH FROM ""REQUESTED_AT"") AS ""MONTH"" FROM ""ACCEPTEDRIDES"" AS ""A"" JOIN ""RIDES"" AS ""R"" USING (""RIDE_ID"") WHERE EXTRACT(YEAR FROM ""REQUESTED_AT"")=2020), ""CTE3"" AS (SELECT ""CTE1"".""MONTH"",SUM(COALESCE(""RIDE_DISTANCE"", 0)) AS ""RIDE_DISTANCE"",SUM(COALESCE(""RIDE_DURATION"", 0)) AS ""RIDE_DURATION"" FROM ""CTE1"" LEFT JOIN ""CTE2"" USING (""MONTH"") GROUP BY ""CTE1"".""MONTH""), ""CTE4"" AS (SELECT ""MONTH"",ROUND((""RIDE_DISTANCE""+LEAD(""RIDE_DISTANCE"", 1) OVER (ORDER BY ""MONTH"")+LEAD(""RIDE_DISTANCE"", 2) OVER (ORDER BY ""MONTH""))/3, 2) AS ""average_ride_distance"",ROUND((""RIDE_DURATION""+LEAD(""RIDE_DURATION"", 1) OVER (ORDER BY ""MONTH"")+LEAD(""RIDE_DURATION"", 2) OVER (ORDER BY ""MONTH""))/3, 2) AS ""average_ride_duration"" FROM ""CTE3"") SELECT * FROM ""CTE4"" WHERE ""MONTH""<11"
219,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""m"".""month"",COALESCE(ROUND(SUM(""ride_distance"") OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"") OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN (SELECT ""a"".""ride_id"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""requested_at"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""a"" ON ""m"".""month""=""a"".""month"" GROUP BY ""m"".""month"" ORDER BY ""month"" LIMIT 10"
220,"WITH RECURSIVE ""mon"" AS (SELECT 1 AS ""month_num"" UNION ALL SELECT ""month_num""+1 AS ""month_num"" FROM ""mon"" WHERE ""month_num""+1<=10), ""denorm"" AS (SELECT ""requested_at"",""ride_duration"",""ride_distance"" FROM (""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") LEFT JOIN ""Drivers"" AS ""d"" ON ""d"".""driver_id""=""ar"".""driver_id"") SELECT ""m"".""month_num"" AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""mon"" AS ""m"" LEFT JOIN ""denorm"" AS ""d"" ON ""requested_at"">=CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""-1 MONTH' AND ""requested_at""<CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""+2 MONTH' GROUP BY ""m"".""month_num"""
221,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY ""month""), ""t3"" AS (SELECT ""t1"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""month""=""t2"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""t3"" LIMIT 10"
222,"WITH ""cte"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""dist"",SUM(""ride_duration"") AS ""dur"" FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""cte2"" AS (WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<=11) SELECT * FROM ""cte"") SELECT ""month"",ROUND(""sum_dist""/3, 2) AS ""average_ride_distance"",ROUND(""sum_dur""/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",SUM(""dist"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""sum_dist"",SUM(""dur"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""sum_dur"" FROM (SELECT ""x"".""month"",COALESCE(""dist"", 0) AS ""dist"",COALESCE(""dur"", 0) AS ""dur"" FROM ""cte2"" AS ""x"" LEFT JOIN ""cte"" AS ""y"" ON ""x"".""month""=""y"".""month"") AS ""a"") AS ""b"" WHERE ""month"" BETWEEN 1 AND 10"
223,"WITH RECURSIVE ""month_list"" AS (SELECT 1 AS ""month"",'2020-04-01' AS ""next_month"" UNION ALL SELECT ""month""+1 AS ""month"",CASE WHEN ""month""<9 THEN CONCAT('2020-', ""month""+4, '-01') ELSE '2021-01-01' END AS ""next_month"" FROM ""month_list"" WHERE ""month""<10) SELECT ""month"",ROUND(SUM(COALESCE(""ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ""month_list"" LEFT JOIN (SELECT ""r"".""ride_id"",""r"".""requested_at"",""ride_distance"",""ride_duration"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"") AS ""rs"" ON ""rs"".""requested_at"" + INTERVAL '3 MONTH'>=""next_month"" AND ""rs"".""requested_at""<""next_month"" GROUP BY ""month"""
224,"WITH RECURSIVE ""full_year"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""full_year"" WHERE ""month""<10), ""tb"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""s_dist"",SUM(""ar"".""ride_duration"") AS ""s_dur"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""full_year"".""month"",ROUND((COALESCE(""t1"".""s_dist"", 0)+COALESCE(""t2"".""s_dist"", 0)+COALESCE(""t3"".""s_dist"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""t1"".""s_dur"", 0)+COALESCE(""t2"".""s_dur"", 0)+COALESCE(""t3"".""s_dur"", 0))/3, 2) AS ""average_ride_duration"" FROM ((""full_year"" LEFT JOIN ""tb"" AS ""t1"" ON ""full_year"".""month""=""t1"".""month"") LEFT JOIN ""tb"" AS ""t2"" ON ""full_year"".""month""=""t2"".""month""-1) LEFT JOIN ""tb"" AS ""t3"" ON ""full_year"".""month""=""t3"".""month""-2"
225,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<10), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month"") SELECT ""m"".""month"",COALESCE(ROUND(SUM(""mr"".""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""mr"".""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ((""mr"".""month""-""m"".""month""=0) OR (""mr"".""month""-""m"".""month""=1) OR (""mr"".""month""-""m"".""month""=2)) GROUP BY 1 ORDER BY 1"
226,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND((COALESCE(SUM(""ride_distance""), 0)+COALESCE(LEAD(SUM(""ride_distance"")) OVER (ORDER BY ""month""), 0)+COALESCE(LEAD(SUM(""ride_distance""), 2) OVER (ORDER BY ""month""), 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(SUM(""ride_duration""), 0)+COALESCE(LEAD(SUM(""ride_duration"")) OVER (ORDER BY ""month""), 0)+COALESCE(LEAD(SUM(""ride_duration""), 2) OVER (ORDER BY ""month""), 0))/3, 2) AS ""average_ride_duration"" FROM (""months"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""ride_month"",""ride_id"" FROM ""Rides"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""r"" ON ""month""=""ride_month"") LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"") AS ""a"" WHERE ""month""<=10"
227,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<=9), ""a"" AS (SELECT ""ar"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""ride_month"",""ride_distance"",""ride_duration"" FROM ""AcceptedRides"" AS ""ar"" LEFT JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020), ""b"" AS (SELECT ""t"".""month"",ROUND(SUM(""a"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""a"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""t"") JOIN ""a"" WHERE ""a"".""ride_month""-""t"".""month""<3 AND ""a"".""ride_month"">=""t"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"") SELECT ""t"".""month"",COALESCE(""average_ride_distance"", 0.00) AS ""average_ride_distance"",COALESCE(""average_ride_duration"", 0.00) AS ""average_ride_duration"" FROM ""t"" LEFT JOIN ""b"" ON ""t"".""month""=""b"".""month"""
228,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""month"" WHERE ""month""<12) SELECT DISTINCT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT DISTINCT ""month"".""month"",COALESCE(SUM(""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""ride_duration""), 0) AS ""ride_duration"" FROM (""month"" LEFT JOIN ""rides"" AS ""r"" ON ""month"".""month""=EXTRACT(MONTH FROM ""requested_at"")) LEFT JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1) AS ""t"" LIMIT 10"
229,"WITH RECURSIVE ""calendar"" AS (SELECT 1 AS ""m"" UNION ALL SELECT ""m""+1 AS ""m"" FROM ""calendar"" WHERE ""m""<10), ""total"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""m"",SUM(""a"".""ride_distance"") AS ""dist"",SUM(""a"".""ride_duration"") AS ""dur"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1 ORDER BY 1) SELECT ""c"".""m"" AS ""month"",ROUND((COALESCE(""t1"".""dist"", 0)+COALESCE(""t2"".""dist"", 0)+COALESCE(""t3"".""dist"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""t1"".""dur"", 0)+COALESCE(""t2"".""dur"", 0)+COALESCE(""t3"".""dur"", 0))/3, 2) AS ""average_ride_duration"" FROM ((""calendar"" AS ""c"" LEFT JOIN ""total"" AS ""t1"" ON ""c"".""m""=""t1"".""m"") LEFT JOIN ""total"" AS ""t2"" ON ""c"".""m""=""t2"".""m""-1) LEFT JOIN ""total"" AS ""t3"" ON ""c"".""m""=""t3"".""m""-2"
230,"WITH RECURSIVE ""all_month"" (""month_number"") AS (SELECT 1 UNION ALL SELECT ""month_number""+1 FROM ""all_month"" WHERE ""month_number""<12) SELECT ""month_number"" AS ""month"",ROUND((COALESCE(LEAD(""sum_distance"", 1) OVER (), 0)+COALESCE(LEAD(""sum_distance"", 2) OVER (), 0)+""sum_distance"")/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(LEAD(""sum_duration"", 1) OVER (), 0)+COALESCE(LEAD(""sum_duration"", 2) OVER (), 0)+""sum_duration"")/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month_number"",COALESCE(""sum_distance"", 0) AS ""sum_distance"",COALESCE(""sum_duration"", 0) AS ""sum_duration"" FROM ""all_month"" AS ""a"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""ride_month"",SUM(""ride_distance"") AS ""sum_distance"",SUM(""ride_duration"") AS ""sum_duration"" FROM ""AcceptedRides"" AS ""accept"" JOIN ""Rides"" AS ""ride"" ON ""accept"".""ride_id""=""ride"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""ride_month"") AS ""rides"" ON ""a"".""month_number""=""rides"".""ride_month"" ORDER BY ""month_number"") AS ""final_sum"" GROUP BY ""month"" ORDER BY ""month"" LIMIT 10"
231,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""monthly_average"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT ""t"".""month"",ROUND(AVG(CAST(COALESCE(""m"".""total_distance"", 0) AS FLOAT)) OVER (ORDER BY ""t"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(CAST(COALESCE(""m"".""total_duration"", 0) AS FLOAT)) OVER (ORDER BY ""t"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""months"" AS ""t"" LEFT JOIN ""monthly_average"" AS ""m"" ON ""t"".""month""=""m"".""month"" LIMIT 10"
232,"WITH RECURSIVE ""cte_month"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte_month"" WHERE ""month""<12) SELECT ""month"",CAST(COALESCE(""average_ride_distance"", 0) AS DECIMAL(15, 2)) AS ""average_ride_distance"",CAST(COALESCE(""average_ride_duration"", 0) AS DECIMAL(15, 2)) AS ""average_ride_duration"" FROM (SELECT ""a"".""month"" AS ""month"",SUM(CAST(""ride_distance""/3.0 AS FLOAT)) OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""average_ride_distance"",SUM(CAST(""ride_duration""/3.0 AS FLOAT)) OVER (ORDER BY ""a"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""average_ride_duration"" FROM ""cte_month"" AS ""a"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) AS ""p"" ON ""a"".""month""=""p"".""month"" LIMIT 10) AS ""q"" ORDER BY 1"
233,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""ridesStat"" AS (SELECT EXTRACT(MONTH FROM ""r1"".""requested_at"") AS ""month"",SUM(""a1"".""ride_distance"") AS ""distance"",SUM(""a1"".""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""a1"" LEFT JOIN ""Rides"" AS ""r1"" ON ""r1"".""ride_id""=""a1"".""ride_id"" WHERE ""r1"".""requested_at"" LIKE '2020%' GROUP BY 1), ""ridesStat2"" AS (SELECT ""c1"".""month"",COALESCE(ROUND(SUM(""r1"".""distance"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""r1"".""duration"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""cte"" AS ""c1"" LEFT JOIN ""ridesStat"" AS ""r1"" ON ""r1"".""month""=""c1"".""month"") SELECT * FROM ""ridesStat2"" WHERE ""month""<=10"
234,"WITH RECURSIVE ""2020_m"" (""m"") AS (SELECT 1 UNION SELECT ""m""+1 FROM ""2020_m"" WHERE ""m""<10) SELECT ""m"".""m"" AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""2020_m"" AS ""m"" LEFT JOIN (SELECT ""requested_at"",""ride_distance"",""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""acc"" USING (""ride_id"") WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""apt"" ON EXTRACT(MONTH FROM ""apt"".""requested_at"")-""m"".""m""<3 AND EXTRACT(MONTH FROM ""apt"".""requested_at"")-""m"".""m"">=0 GROUP BY 1 ORDER BY 1"
235,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month""), ""every_month_rides"" AS (SELECT ""m"".""month"",COALESCE(""mr"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""mr"".""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ""mr"".""month""=""m"".""month"") SELECT ""t1"".""month"" AS ""month"",ROUND((""t1"".""ride_distance""+""t2"".""ride_distance""+""t3"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""ride_duration""+""t2"".""ride_duration""+""t3"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""every_month_rides"" AS ""t1"" JOIN ""every_month_rides"" AS ""t2"") JOIN ""every_month_rides"" AS ""t3"" ON ""t1"".""month""=""t2"".""month""-1 AND ""t2"".""month""=""t3"".""month""-1"
236,"WITH RECURSIVE ""month_tbl"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month_tbl"" WHERE ""month""<12), ""temp1"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(COALESCE(""ride_distance"", 0)) AS ""ride_distance_total"",SUM(COALESCE(""ride_duration"", 0)) AS ""ride_duration_total"" FROM ""rides"" AS ""r"" LEFT JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY 1), ""temp2"" AS (SELECT ""m"".""month"",COALESCE(""ride_distance_total"", 0) AS ""ride_distance_total"",COALESCE(""ride_duration_total"", 0) AS ""ride_duration_total"" FROM ""month_tbl"" AS ""m"" LEFT JOIN ""temp1"" ON ""m"".""month""=""temp1"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance_total"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration_total"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""temp2"" ORDER BY 1 LIMIT 10"
237,"WITH RECURSIVE ""CTE"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE"" WHERE ""month""<12) SELECT ""t"".""month"",ROUND(AVG(COALESCE(""b"".""monthly_distance"", 0.00)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""b"".""monthly_duration"", 0.00)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""CTE"" AS ""t"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""monthly_distance"",SUM(""b"".""ride_duration"") AS ""monthly_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"") AS ""b"" ON ""t"".""month""=""b"".""month"" ORDER BY 1 LIMIT 10"
238,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_duration"") END AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final_list"" ORDER BY ""month"" LIMIT 10"
239,"WITH RECURSIVE ""full_year"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""full_year"" WHERE ""month""<12), ""cte1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""requested_at"">='2020-01-01' AND ""requested_at""<'2021-01-01' GROUP BY ""month"" ORDER BY ""requested_at""), ""cte2"" AS (SELECT ""full_year"".""month"",""ride_distance"",""ride_duration"",LEAD(""ride_distance"", 1) OVER (ORDER BY ""full_year"".""month"") AS ""ride_distance_next"",LEAD(""ride_distance"", 2) OVER (ORDER BY ""full_year"".""month"") AS ""ride_distance_next_next"",LEAD(""ride_duration"", 1) OVER (ORDER BY ""full_year"".""month"") AS ""ride_duration_next"",LEAD(""ride_duration"", 2) OVER (ORDER BY ""full_year"".""month"") AS ""ride_duration_next_next"" FROM ""full_year"" LEFT JOIN ""cte1"" ON ""full_year"".""month""=""cte1"".""month"" ORDER BY ""full_year"".""month"") SELECT ""month"",ROUND((COALESCE(""ride_distance"", 0)+COALESCE(""ride_distance_next"", 0)+COALESCE(""ride_distance_next_next"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""ride_duration"", 0)+COALESCE(""ride_duration_next"", 0)+COALESCE(""ride_duration_next_next"", 0))/3, 2) AS ""average_ride_duration"" FROM ""cte2"" WHERE ""month""<=10"
240,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte1"" WHERE ""month""<10), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""ride_distance"",""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') SELECT ""c1"".""month"",ROUND(COALESCE(SUM(""c2"".""ride_distance"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""c2"".""ride_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM ""cte1"" AS ""c1"" LEFT JOIN ""cte2"" AS ""c2"" ON ""c1"".""month""+2>=""c2"".""month"" AND ""c1"".""month""<=""c2"".""month"" GROUP BY 1 ORDER BY 1"
241,"WITH RECURSIVE ""cte"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""cte2"" AS (SELECT ""m"".""month"",""ride_distance"",""ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""cte"" AS ""c"" ON ""m"".""month""=""c"".""month""), ""cte3"" AS (SELECT ""month"",COALESCE(ROUND((SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND((SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2), 0) AS ""average_ride_duration"" FROM ""cte2"") SELECT ""month"",""average_ride_distance"",""average_ride_duration"" FROM ""cte3"" WHERE ""month""<11"
242,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""total_distance"",SUM(""ride_duration"") AS ""total_duration"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY ""month""), ""monthly_rides"" AS (SELECT ""m"".""month"",COALESCE(""total_distance"", 0) AS ""monthly_distance"",COALESCE(""total_duration"", 0) AS ""monthly_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ""m"".""month""=""mr"".""month"") SELECT ""m1"".""month"",ROUND((""m1"".""monthly_distance""+""m2"".""monthly_distance""+""m3"".""monthly_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""m1"".""monthly_duration""+""m2"".""monthly_duration""+""m3"".""monthly_duration"")/3, 2) AS ""average_ride_duration"" FROM (""monthly_rides"" AS ""m1"" JOIN ""monthly_rides"" AS ""m2"") JOIN ""monthly_rides"" AS ""m3"" ON ""m1"".""month""=""m2"".""month""-1 AND ""m1"".""month""=""m3"".""month""-2 ORDER BY ""m1"".""month"""
243,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE1"" WHERE 1+""month""<=12), ""CTE2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""CTE3"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE2"".""driver_id"") OVER (ORDER BY ""CTE1"".""month"") AS ""active_drivers"" FROM ""CTE1"" LEFT JOIN ""CTE2"" ON ""CTE1"".""month""=""CTE2"".""month""), ""CTE4"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""A"".""driver_id"",""A"".""ride_distance"",""A"".""ride_duration"" FROM (""Rides"" AS ""R"") JOIN ""AcceptedRIdes"" AS ""A"" WHERE ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE4"".""driver_id"") OVER (PARTITION BY ""CTE1"".""month"") AS ""accepted_rides"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month""), ""CTE6"" AS (SELECT ""CTE1"".""month"",COALESCE(SUM(""CTE4"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""CTE4"".""ride_duration""), 0) AS ""ride_duration"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month"" GROUP BY ""CTE1"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""CTE6"" LIMIT 10"
244,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""sliding"" AS (SELECT ""a"".""month"" AS ""month1"",""b"".""month"" AS ""month2"" FROM ""cte"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""b"".""month"" BETWEEN ""a"".""month"" AND (""a"".""month""+2) WHERE ""a"".""month""<=10 ORDER BY ""month1"",""month2""), ""ride"" AS (SELECT ""x"".""ride_id"",EXTRACT(MONTH FROM ""x"".""requested_at"") AS ""month"",""y"".""ride_distance"",""y"".""ride_duration"" FROM ""rides"" AS ""x"" JOIN ""AcceptedRides"" AS ""y"" ON ""x"".""ride_id""=""y"".""ride_id"" WHERE EXTRACT(YEAR FROM ""x"".""requested_at"")=2020) SELECT ""c"".""month1"" AS ""month"",CASE WHEN SUM(""d"".""ride_distance"")/3 IS NULL THEN 0.00 ELSE ROUND(SUM(""d"".""ride_distance"")/3, 2) END AS ""average_ride_distance"",CASE WHEN SUM(""d"".""ride_duration"")/3 IS NULL THEN 0.00 ELSE ROUND(SUM(""d"".""ride_duration"")/3, 2) END AS ""average_ride_duration"" FROM ""sliding"" AS ""c"" LEFT JOIN ""ride"" AS ""d"" ON ""c"".""month2""=""d"".""month"" GROUP BY ""c"".""month1"" ORDER BY ""c"".""month1"""
245,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12), ""b"" AS (SELECT ""r"".""requested_at"",COALESCE(""a"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""a"".""ride_duration"", 0) AS ""ride_duration"" FROM ""rides"" AS ""r"" RIGHT JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020), ""c"" AS (SELECT ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""t"" LEFT JOIN ""b"" ON ""t"".""month""=EXTRACT(MONTH FROM ""b"".""requested_at"") GROUP BY 1) SELECT ""month"",COALESCE(""average_ride_distance"", 0) AS ""average_ride_distance"",COALESCE(""average_ride_duration"", 0) AS ""average_ride_duration"" FROM (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""c"") AS ""t1"" WHERE ""month""<11 ORDER BY 1"
246,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT SUM(""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""m"".""month"",COALESCE(ROUND(SUM(""monthly_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""monthly_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""t1"" ON ((""t1"".""month""-""m"".""month""=0) OR (""t1"".""month""-""m"".""month""=1) OR (""t1"".""month""-""m"".""month""=2)) GROUP BY 1 ORDER BY 1 LIMIT 10"
247,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12), ""RideAverages"" AS (SELECT ""M"".""month"",ROUND(AVG(COALESCE(SUM(""ride_distance""), 0.0)) OVER ""W"", 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(SUM(""ride_duration""), 0.0)) OVER ""W"", 2) AS ""average_ride_duration"" FROM (""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""A"" ON ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020) RIGHT JOIN ""Months"" AS ""M"" ON ""M"".""month""=EXTRACT(MONTH FROM ""R"".""requested_at"") GROUP BY ""M"".""month"" WINDOW ""W"" AS (ORDER BY ""M"".""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)) SELECT * FROM ""RideAverages"" ORDER BY ""month"" LIMIT 10"
248,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""m"" UNION SELECT ""m""+1 FROM ""month"" WHERE ""m""<12), ""ar"" AS (SELECT ""month"".""m"" AS ""m"",COALESCE(SUM(""ride_distance""), 0) AS ""rd"",COALESCE(SUM(""ride_duration""), 0) AS ""rdr"" FROM (""month"" LEFT JOIN ""Rides"" AS ""r"" ON ""month"".""m""=EXTRACT(MONTH FROM ""r"".""requested_at"")) LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1) SELECT * FROM (SELECT ""m"" AS ""month"",ROUND(AVG(COALESCE(""rd"", 0)) OVER (ORDER BY ""m"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""rdr"", 0)) OVER (ORDER BY ""m"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""ar"" ORDER BY 1) AS ""tmp"" WHERE ""tmp"".""month""<=10"
249,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""val"" UNION ALL SELECT ""val""+1 FROM ""t"" WHERE ""val""+1<=12), ""rides_2020"" AS (SELECT ""t"".""val"" AS ""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(COALESCE(""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""ride_duration"", 0)) AS ""ride_duration"" FROM ""Rides"" LEFT JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-1-1' AND '2020-12-31' GROUP BY 1) AS ""t1"" RIGHT JOIN ""t"" ON ""t1"".""month""=""t"".""val"") SELECT * FROM (SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""rides_2020"" ORDER BY ""month"") AS ""x"" WHERE ""month""<=10"
250,"WITH RECURSIVE ""rm"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""rm"" WHERE ""month""<12), ""monthly"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month""), ""every_month"" AS (SELECT ""r"".""month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""rm"" AS ""r"" LEFT JOIN ""monthly"" AS ""m"" ON ""r"".""month""=""m"".""month"") SELECT ""t"".""month"",ROUND((""t"".""ride_distance""+""n1"".""ride_distance""+""n2"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t"".""ride_duration""+""n1"".""ride_duration""+""n2"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""every_month"" AS ""t"" JOIN ""every_month"" AS ""n1"" ON ""t"".""month""=""n1"".""month""-1) JOIN ""every_month"" AS ""n2"" ON ""t"".""month""=""n2"".""month""-2 ORDER BY 1"
251,"WITH RECURSIVE ""r"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""r"" WHERE ""month""<12), ""a"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""rides"" JOIN ""acceptedrides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1) SELECT DISTINCT ""r"".""month"",COALESCE(ROUND(SUM(""distance"") OVER (ORDER BY ""r"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""duration"") OVER (ORDER BY ""r"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""r"" LEFT JOIN ""a"" USING (""month"") LIMIT 10"
252,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""seq"" WHERE ""month""<10), ""month_record"" AS (SELECT CONVERT(SUBSTRING(""r"".""requested_at"", 6, 2), INTEGER) AS ""month"",SUM(""a"".""ride_distance"") AS ""total_distance"",SUM(""a"".""ride_duration"") AS ""total_duration"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT ""seq"".""month"",ROUND(SUM(COALESCE(""m"".""total_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""m"".""total_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ""seq"" LEFT JOIN ""month_record"" AS ""m"" ON ""m"".""month"" BETWEEN ""seq"".""month"" AND ""seq"".""month""+2 GROUP BY 1"
253,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COALESCE(SUM(""a"".""ride_distance""), 0) AS ""monthly_distance"",COALESCE(SUM(""a"".""ride_duration""), 0) AS ""monthly_duration"" FROM ""rides"" AS ""r"" LEFT JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month""), ""every_month_rides"" AS (SELECT ""m"".""month"" AS ""month"",COALESCE(""mr"".""monthly_distance"", 0) AS ""monthly_distance"",COALESCE(""mr"".""monthly_duration"", 0) AS ""monthly_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ""m"".""month""=""mr"".""month"") SELECT ""t1"".""month"" AS ""month"",ROUND((""t1"".""monthly_distance""+""t2"".""monthly_distance""+""t3"".""monthly_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""monthly_duration""+""t2"".""monthly_duration""+""t3"".""monthly_duration"")/3, 2) AS ""average_ride_duration"" FROM (""every_month_rides"" AS ""t1"" JOIN ""every_month_rides"" AS ""t2"") JOIN ""every_month_rides"" AS ""t3"" ON ""t1"".""month""=""t2"".""month""-1 AND ""t1"".""month""=""t3"".""month""-2"
254,"WITH RECURSIVE ""mon"" (""month_num"", ""month_st"", ""month_end"") AS (SELECT 1 AS ""month_num"",CAST('2020-01-01' AS DATE) + INTERVAL '0 MONTH' AS ""month_st"",CAST('2020-01-01' AS DATE) + INTERVAL '3 MONTH' AS ""month_end"" UNION ALL SELECT ""month_num""+1 AS ""month_num"",CAST('2020-01-01' AS DATE) + INTERVAL '""month_num"" MONTH' AS ""month_st"",CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""+3 MONTH' AS ""month_end"" FROM ""mon"" WHERE ""month_num""+1<=10), ""denorm"" AS (SELECT ""requested_at"",""ride_duration"",""ride_distance"" FROM (""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") LEFT JOIN ""Drivers"" AS ""d"" ON ""d"".""driver_id""=""ar"".""driver_id"") SELECT ""m"".""month_num"" AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""mon"" AS ""m"" LEFT JOIN ""denorm"" AS ""d"" ON ""requested_at"">=""month_st"" AND ""requested_at""<""month_end"" GROUP BY ""m"".""month_num"""
255,"WITH RECURSIVE ""MONTH"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""MONTH"" WHERE ""month""<12), ""T1"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",SUM(COALESCE(""A"".""ride_distance"", 0)) AS ""distance"",SUM(COALESCE(""A"".""ride_duration"", 0)) AS ""duration"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""A"" ON ""R"".""ride_id""=""A"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020 GROUP BY ""month""), ""T2"" AS (SELECT ""M"".""month"",AVG(COALESCE(""T1"".""distance"", 0)) OVER (ORDER BY ""M"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""average_ride_distance"",AVG(COALESCE(""T1"".""duration"", 0)) OVER (ORDER BY ""M"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""average_ride_duration"" FROM ""MONTH"" AS ""M"" LEFT JOIN ""T1"" ON ""M"".""month""=""T1"".""month"") SELECT ""month"",ROUND(""average_ride_distance"", 2) AS ""average_ride_distance"",ROUND(""average_ride_duration"", 2) AS ""average_ride_duration"" FROM ""T2"" WHERE ""month""<=10"
256,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""MONTH"" UNION SELECT ""MONTH""+1 AS ""MONTH"" FROM ""all_months"" WHERE ""MONTH""<12) SELECT ""MONTH"",ROUND(AVG(COALESCE(""MONTH_DIST"", 0)) OVER (ORDER BY ""MONTH"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""MONTH_DUR"", 0)) OVER (ORDER BY ""MONTH"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""ALL_MONTHS"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""REQUESTED_AT"") AS ""MONTH"",SUM(""RIDE_DISTANCE"") AS ""MONTH_DIST"",SUM(""RIDE_DURATION"") AS ""MONTH_DUR"" FROM ""ACCEPTEDRIDES"" AS ""A"" NATURAL JOIN ""RIDES"" AS ""R"" WHERE ""REQUESTED_AT"" BETWEEN '2020-1-1' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""REQUESTED_AT""),EXTRACT(YEAR FROM ""REQUESTED_AT"")) AS ""SUB"" USING (""MONTH"") LIMIT 10"
257,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<=11) SELECT DISTINCT ""month"",ROUND(SUM(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (""cte"" LEFT JOIN ""rides"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""acceptedRides"" USING (""ride_id"") ORDER BY 1 LIMIT 10"
258,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""ride_tbl"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT ""c"".""month"",ROUND(AVG(COALESCE(""distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""c"" LEFT JOIN ""ride_tbl"" AS ""r"" ON ""c"".""month""=""r"".""month"" LIMIT 10"
259,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<10), ""cte_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""ride_distance"",""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) SELECT ""cte"".""month"",ROUND(COALESCE(SUM(""ride_distance"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM ""cte"" LEFT JOIN ""cte_rides"" ON ""cte_rides"".""month""-""cte"".""month"" BETWEEN 0 AND 2 GROUP BY 1 ORDER BY 1"
260,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",COALESCE(SUM(""b"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""b"".""ride_duration""), 0) AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final_list"" ORDER BY ""month"" LIMIT 10"
261,"WITH RECURSIVE ""full_year"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""full_year"" WHERE ""month""<12), ""temp"" AS (SELECT SUM(""ride_distance"") AS ""total_dis"",SUM(""ride_duration"") AS ""total_dur"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""temp2"" AS (SELECT ""full_year"".""month"",COALESCE(""total_dur"", 0) AS ""total_dur"",COALESCE(""total_dis"", 0) AS ""total_dis"" FROM ""temp"" RIGHT JOIN ""full_year"" ON ""full_year"".""month""=""temp"".""month""), ""temp3"" AS (SELECT *,LEAD(""temp2"".""total_dur"", 1, NULL) OVER (ORDER BY ""month"") AS ""lead2_total_dur"",LEAD(""temp2"".""total_dur"", 2, NULL) OVER (ORDER BY ""month"") AS ""lead3_total_dur"",LEAD(""temp2"".""total_dis"", 1, NULL) OVER (ORDER BY ""month"") AS ""lead2_total_dis"",LEAD(""temp2"".""total_dis"", 2, NULL) OVER (ORDER BY ""month"") AS ""lead3_total_dis"" FROM ""temp2"") SELECT ""temp3"".""month"",ROUND((""total_dis""+""lead2_total_dis""+""lead3_total_dis"")/3, 2) AS ""average_ride_distance"",ROUND((""total_dur""+""lead2_total_dur""+""lead3_total_dur"")/3, 2) AS ""average_ride_duration"" FROM ""temp3"" WHERE ""temp3"".""month""<=10"
262,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<10), ""rides2020"" AS (SELECT ""t1"".""ride_id"",EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"",""t1"".""ride_distance"",""t1"".""ride_duration"" FROM ""acceptedrides"" AS ""t1"" JOIN ""rides"" AS ""t2"" ON ""t2"".""ride_id""=""t1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""t2"".""requested_at"")=2020) SELECT ""t1"".""month"",ROUND(SUM(CASE WHEN ""t2"".""ride_distance"" IS NULL THEN 0 ELSE ""t2"".""ride_distance"" END)/3, 2) AS ""average_ride_distance"",ROUND(SUM(CASE WHEN ""t2"".""ride_duration"" IS NULL THEN 0 ELSE ""t2"".""ride_duration"" END)/3, 2) AS ""average_ride_duration"" FROM ""months"" AS ""t1"" LEFT JOIN ""rides2020"" AS ""t2"" ON ""t2"".""month"">=""t1"".""month"" AND ""t2"".""month""<=""t1"".""month""+2 GROUP BY ""t1"".""month"" ORDER BY ""t1"".""month"""
263,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""cte1"" AS (SELECT ""a"".""requested_at"",""b"".""ride_distance"",""b"".""ride_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' ORDER BY ""a"".""requested_at""), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""ride_distance"",""ride_duration"" FROM ""cte1""), ""cte3"" AS (SELECT ""a"".""month"",SUM(COALESCE(""b"".""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""b"".""ride_duration"", 0)) AS ""ride_duration"" FROM ""months"" AS ""a"" LEFT JOIN ""cte2"" AS ""b"" ON ""a"".""month""=""b"".""month"" GROUP BY ""a"".""month""), ""cte4"" AS (SELECT ""month"",SUM(""ride_distance"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""total_distance"",SUM(""ride_duration"") OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""total_duration"" FROM ""cte3"") SELECT ""month"",ROUND(""total_distance""/3, 2) AS ""average_ride_distance"",ROUND(""total_duration""/3, 2) AS ""average_ride_duration"" FROM ""cte4"" WHERE ""month""<=10"
264,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""t"".""month"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_distance"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_duration"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""t"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"") AS ""b"" ON ""t"".""month""=""b"".""month"" ORDER BY 1 LIMIT 10"
265,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12) SELECT DISTINCT ""month"",ROUND(SUM(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (""cte"" LEFT JOIN ""Rides"" AS ""r"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" ORDER BY ""month"" LIMIT 10"
266,"WITH ""calc_per_window"" AS (SELECT SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (1,2,3) THEN ""ride_distance"" END), 0))/3 AS ""Jan_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (2,3,4) THEN ""ride_distance"" END), 0))/3 AS ""Feb_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (3,4,5) THEN ""ride_distance"" END), 0))/3 AS ""Mar_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (4,5,6) THEN ""ride_distance"" END), 0))/3 AS ""Apr_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (5,6,7) THEN ""ride_distance"" END), 0))/3 AS ""May_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (6,7,8) THEN ""ride_distance"" END), 0))/3 AS ""Jun_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (7,8,9) THEN ""ride_distance"" END), 0))/3 AS ""Jul_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (8,9,10) THEN ""ride_distance"" END), 0))/3 AS ""Aug_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (9,10,11) THEN ""ride_distance"" END), 0))/3 AS ""Sep_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (10,11,12) THEN ""ride_distance"" END), 0))/3 AS ""Oct_dist"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (1,2,3) THEN ""ride_duration"" END), 0))/3 AS ""Jan_dur"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (2,3,4) THEN ""ride_duration"" END), 0))/3 AS ""Feb_dur"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (3,4,5) THEN ""ride_duration"" END), 0))/3 AS ""Mar_dur"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (4,5,6) THEN ""ride_duration"" END), 0))/3 AS ""Apr_dur"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (5,6,7) THEN ""ride_duration"" END), 0))/3 AS ""May_dur"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (6,7,8) THEN ""ride_duration"" END), 0))/3 AS ""Jun_dur"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (7,8,9) THEN ""ride_duration"" END), 0))/3 AS ""Jul_dur"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (8,9,10) THEN ""ride_duration"" END), 0))/3 AS ""Aug_dur"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (9,10,11) THEN ""ride_duration"" END), 0))/3 AS ""Sep_dur"",SUM(COALESCE((CASE WHEN EXTRACT(MONTH FROM ""requested_at"") IN (10,11,12) THEN ""ride_duration"" END), 0))/3 AS ""Oct_dur"" FROM ""rides"" AS ""r"" LEFT JOIN ""acceptedrides"" AS ""ac"" ON ""r"".""ride_id""=""ac"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT 1 AS ""month"",ROUND(""Jan_dist"", 2) AS ""average_ride_distance"",ROUND(""Jan_dur"", 2) AS ""average_ride_duration"" FROM ""calc_per_window"" UNION ALL SELECT 2 AS ""month"",ROUND(""Feb_dist"", 2),ROUND(""Feb_dur"", 2) FROM ""calc_per_window"" UNION ALL SELECT 3 AS ""month"",ROUND(""Mar_dist"", 2),ROUND(""Mar_dur"", 2) FROM ""calc_per_window"" UNION ALL SELECT 4 AS ""month"",ROUND(""Apr_dist"", 2),ROUND(""Apr_dur"", 2) FROM ""calc_per_window"" UNION ALL SELECT 5 AS ""month"",ROUND(""May_dist"", 2),ROUND(""May_dur"", 2) FROM ""calc_per_window"" UNION ALL SELECT 6 AS ""month"",ROUND(""Jun_dist"", 2),ROUND(""Jun_dur"", 2) FROM ""calc_per_window"" UNION ALL SELECT 7 AS ""month"",ROUND(""Jul_dist"", 2),ROUND(""Jul_dur"", 2) FROM ""calc_per_window"" UNION ALL SELECT 8 AS ""month"",ROUND(""Aug_dist"", 2),ROUND(""Aug_dur"", 2) FROM ""calc_per_window"" UNION ALL SELECT 9 AS ""month"",ROUND(""Sep_dist"", 2),ROUND(""Sep_dur"", 2) FROM ""calc_per_window"" UNION ALL SELECT 10 AS ""month"",ROUND(""Oct_dist"", 2),ROUND(""Oct_dur"", 2) FROM ""calc_per_window"""
267,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""valid_rides"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""AR"".""ride_distance"",""AR"".""ride_duration"" FROM ""Rides"" AS ""R"" LEFT JOIN ""AcceptedRides"" AS ""AR"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""month_rides"" AS (SELECT ""M"".""month"",COALESCE(SUM(""R"".""ride_distance""), 0) AS ""month_ride_distance"",COALESCE(SUM(""R"".""ride_duration""), 0) AS ""month_ride_duration"" FROM ""months"" AS ""M"" LEFT JOIN ""valid_rides"" AS ""R"" ON ""R"".""month""=""M"".""month"" GROUP BY ""M"".""month"") SELECT ""M1"".""month"",ROUND((COALESCE(""M1"".""month_ride_distance"", 0)+COALESCE(""M2"".""month_ride_distance"", 0)+COALESCE(""M3"".""month_ride_distance"", 0))/3.0, 2) AS ""average_ride_distance"",ROUND((COALESCE(""M1"".""month_ride_duration"", 0)+COALESCE(""M2"".""month_ride_duration"", 0)+COALESCE(""M3"".""month_ride_duration"", 0))/3.0, 2) AS ""average_ride_duration"" FROM (""month_rides"" AS ""M1"" JOIN ""month_rides"" AS ""M2"" ON ""M1"".""month""=""M2"".""month""-1) JOIN ""month_rides"" AS ""M3"" ON ""M1"".""month""=""M3"".""month""-2 ORDER BY ""month"""
268,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12), ""t2"" AS (SELECT SUM(""a"".""ride_distance"") AS ""sum_distance"",SUM(""a"".""ride_duration"") AS ""sum_duration"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT ""t"".""month"",ROUND(AVG(COALESCE(""t2"".""sum_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""t2"".""sum_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""t"" LEFT JOIN ""t2"" ON ""t"".""month""=""t2"".""month"" LIMIT 10"
269,"WITH RECURSIVE ""months"" AS (SELECT @""item"":=1 AS ""month"" UNION ALL SELECT @""item"":=@""item""+1 FROM ""months"" WHERE @""item""<12), ""summary_cte"" AS (SELECT ""t1"".""month"",COALESCE(SUM(""t3"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""t3"".""ride_duration""), 0) AS ""ride_duration"" FROM (""months"" AS ""t1"" LEFT JOIN ""Rides"" AS ""t2"" ON EXTRACT(YEAR FROM ""t2"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""t2"".""requested_at"")=""t1"".""month"") LEFT JOIN ""AcceptedRides"" AS ""t3"" ON ""t2"".""ride_id""=""t3"".""ride_id"" GROUP BY ""t1"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""summary_cte"" LIMIT 10"
270,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""temp"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1 ORDER BY 1) SELECT * FROM (SELECT ""m"".""month"",ROUND(AVG(COALESCE(""t"".""ride_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""t"".""ride_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""temp"" AS ""t"" ON ""m"".""month""=""t"".""month"" GROUP BY 1) AS ""a"" WHERE ""month""<11"
271,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<12), ""all_table"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-1-1' AND '2020-12-31' GROUP BY 1 ORDER BY 1) SELECT ""a2"".""month"",ROUND((COALESCE(""ride_distance"", 0)+COALESCE(LEAD(""ride_distance"", 1) OVER (), 0)+COALESCE(LEAD(""ride_distance"", 2) OVER (), 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""ride_duration"", 0)+COALESCE(LEAD(""ride_duration"", 1) OVER (), 0)+COALESCE(LEAD(""ride_duration"", 2) OVER (), 0))/3, 2) AS ""average_ride_duration"" FROM ""all_table"" AS ""a1"" RIGHT JOIN ""all_months"" AS ""a2"" ON ""a1"".""month""=""a2"".""month"" LIMIT 10"
272,"WITH RECURSIVE ""temp1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""temp1"" WHERE ""month""<12), ""temp2"" AS (SELECT ""a"".""month"",COALESCE(SUM(""c"".""ride_distance""), 0) AS ""distance"",COALESCE(SUM(""c"".""ride_duration""), 0) AS ""duration"" FROM (""temp1"" AS ""a"" LEFT JOIN ""Rides"" AS ""b"" ON ""a"".""month""=EXTRACT(MONTH FROM ""b"".""requested_at"") AND EXTRACT(YEAR FROM ""b"".""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" AS ""c"" ON ""b"".""ride_id""=""c"".""ride_id"" GROUP BY 1 ORDER BY 1) SELECT ""a"".""month"",ROUND((""a"".""distance""+""b"".""distance""+""c"".""distance"")/3, 2) AS ""average_ride_distance"",ROUND((""a"".""duration""+""b"".""duration""+""c"".""duration"")/3, 2) AS ""average_ride_duration"" FROM (""temp2"" AS ""a"" LEFT JOIN ""temp2"" AS ""b"" ON ""a"".""month""=""b"".""month""-1) LEFT JOIN ""temp2"" AS ""c"" ON ""a"".""month""=""c"".""month""-2 WHERE ""a"".""month""<=10"
273,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte1"" AS (SELECT ""cte"".""month"",COALESCE(""rd"", 0) AS ""rd"",COALESCE(""rdu"", 0) AS ""rdu"" FROM ""cte"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""rd"",SUM(""ride_duration"") AS ""rdu"" FROM (SELECT * FROM ""rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""r"" JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"") AS ""t1"" USING (""month"")) SELECT ""a"".""month"",ROUND((""a"".""rd""+""b"".""rd""+""c"".""rd"")/3, 2) AS ""average_ride_distance"",ROUND((""a"".""rdu""+""b"".""rdu""+""c"".""rdu"")/3, 2) AS ""average_ride_duration"" FROM (""cte1"" AS ""a"" JOIN ""cte1"" AS ""b"" ON ""a"".""month""=""b"".""month""-1) JOIN ""cte1"" AS ""c"" ON ""b"".""month""=""c"".""month""-1 ORDER BY ""a"".""month"""
274,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month""), ""every_month_rides"" AS (SELECT ""m"".""month"",COALESCE(""mr"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""mr"".""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ""mr"".""month""=""m"".""month"") SELECT ""t1"".""month"" AS ""month"",ROUND((""t1"".""ride_distance""+""t2"".""ride_distance""+""t3"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""ride_duration""+""t2"".""ride_duration""+""t3"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""every_month_rides"" AS ""t1"" JOIN ""every_month_rides"" AS ""t2"") JOIN ""every_month_rides"" AS ""t3"" ON ""t1"".""month""=""t2"".""month""-1 AND ""t2"".""month""=""t3"".""month""-1"
275,"WITH ""cte_monthly_total"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""tot_ride_distance"",SUM(""ride_duration"") AS ""tot_ride_duration"" FROM ""rides"" JOIN ""acceptedRides"" ON (""rides"".""ride_id""=""acceptedRides"".""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"") ORDER BY EXTRACT(MONTH FROM ""requested_at"")), ""cte_spine"" AS (WITH RECURSIVE ""mo"" AS (SELECT 1 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""mo"" WHERE ""n""<12) SELECT * FROM ""mo""), ""cte_join"" AS (SELECT ""n"" AS ""month"",ROUND((SUM(COALESCE(""tot_ride_distance"", 0)) OVER (ORDER BY ""n"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_distance"",ROUND((SUM(COALESCE(""tot_ride_duration"", 0)) OVER (ORDER BY ""n"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_duration"" FROM ""cte_spine"" LEFT JOIN ""cte_monthly_total"" ON (""cte_spine"".""n""=""cte_monthly_total"".""month"")) SELECT ""month"",""average_ride_distance"",""average_ride_duration"" FROM ""cte_join"" WHERE ""month""<=10"
276,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12), ""t"" AS (SELECT ""month"",ROUND(SUM(""di"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""dU"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""month"",SUM(COALESCE(""ride_distance"", 0)) AS ""di"",SUM(COALESCE(""ride_duration"", 0)) AS ""du"" FROM (""monthcount"" AS ""m"" LEFT JOIN ""Rides"" AS ""r"" ON (""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020)) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY 1) AS ""a"") SELECT * FROM ""t"" WHERE ""t"".""month""<=10"
277,"WITH RECURSIVE ""cte"" (""day"") AS (SELECT STR_TO_DATE('2020-1-1', '%Y-%m-%d') UNION ALL SELECT ""day"" + INTERVAL '1 MONTH' FROM ""cte"" WHERE ""day""<'2020-10-1'), ""cte2"" AS (SELECT ""requested_at"",""ride_distance"",""ride_duration"" FROM ""AcceptedRides"" NATURAL JOIN ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT EXTRACT(MONTH FROM ""day"") AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""cte"" LEFT JOIN ""cte2"" ON ""requested_at"" BETWEEN ""day"" AND LAST_DAY(""day"" + INTERVAL '2 MONTH') GROUP BY ""month"" ORDER BY 1"
278,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<10), ""monthly_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_distance"",SUM(""ar"".""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",COALESCE(ROUND(SUM(""mr"".""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""mr"".""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""monthly_rides"" AS ""mr"" ON ""mr"".""month""-""m"".""month"" BETWEEN 0 AND 2 GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
279,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month""-2 AS ""month"",ROUND(COALESCE(SUM(""a"".""ride_distance"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""a"".""ride_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM (""Months"" AS ""m"" LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month"">=TO_CHAR(""r"".""requested_at"", '%c') AND TO_CHAR(""r"".""requested_at"", '%c')>=(""m"".""month""-2)) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""m"".""month"">2 GROUP BY 1 ORDER BY 1"
280,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""m"" WHERE ""month""<12), ""total"" AS (SELECT ""m"".""month"",COALESCE(""total_ride_distance"", 0) AS ""total_ride_distance"",COALESCE(""total_ride_duration"", 0) AS ""total_ride_duration"" FROM ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""total_ride_distance"",SUM(""ride_duration"") AS ""total_ride_duration"" FROM (SELECT ""AcceptedRides"".""ride_id"",""ride_distance"",""ride_duration"",""requested_at"" FROM ""AcceptedRides"" JOIN ""rides"" ON ""AcceptedRides"".""ride_id""=""rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""src"" GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""s"" ON ""m"".""month""=""s"".""month"") SELECT ""month"",ROUND(AVG(""total_ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""total_ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""total"" ORDER BY ""month"" LIMIT 10"
281,"WITH RECURSIVE ""CET1"" AS (SELECT 1 AS ""Month"" UNION SELECT 1+""Month"" FROM ""CET1"" WHERE ""Month""+1<=12), ""CET2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""Month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-1-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""CET3"" AS (SELECT ""CET1"".""Month"",COALESCE(""ride_distance"", 0) AS ""ride_distance"",COALESCE(""ride_duration"", 0) AS ""ride_duration"" FROM ""CET2"" RIGHT JOIN ""CET1"" ON ""CET1"".""Month""=""CET2"".""Month"") SELECT * FROM (SELECT ""month"",ROUND((AVG(""ride_distance"") OVER (ORDER BY ""Month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)), 2) AS ""average_ride_distance"",ROUND((AVG(""ride_duration"") OVER (ORDER BY ""Month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)), 2) AS ""average_ride_duration"" FROM ""CET3"") AS ""p"" WHERE ""Month""<=10"
282,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<=11), ""cte2"" AS (SELECT ""cte"".""month"",SUM(""ride_distance"") AS ""r_dist"",SUM(""ride_duration"") AS ""r_dur"" FROM (""cte"" LEFT JOIN (SELECT * FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020') AS ""r"" ON ""cte"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"")) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY ""cte"".""month"") SELECT ""cte2"".""month"",CASE WHEN ROUND(SUM(""cte3"".""r_dist"")/3, 2) IS NULL THEN 0.00 ELSE ROUND(SUM(""cte3"".""r_dist"")/3, 2) END AS ""average_ride_distance"",CASE WHEN ROUND(SUM(""cte3"".""r_dur"")/3, 2) IS NULL THEN 0.00 ELSE ROUND(SUM(""cte3"".""r_dur"")/3, 2) END AS ""average_ride_duration"" FROM ""cte2"" JOIN ""cte2"" AS ""cte3"" ON ""cte2"".""month"">=(""cte3"".""month""-2) AND ""cte2"".""month""<=""cte3"".""month"" WHERE ""cte2"".""month""<=10 GROUP BY ""cte2"".""month"" ORDER BY ""cte2"".""month"""
283,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""rides_2020"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""ride_distance"",SUM(""ar"".""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT * FROM (SELECT ""m"".""month"",ROUND(AVG(COALESCE(""r"".""ride_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""r"".""ride_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""rides_2020"" AS ""r"" ON ""m"".""month""=""r"".""month"" ORDER BY ""month"") AS ""x"" WHERE ""month""<=10"
284,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""t"".""month"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_distance"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_duration"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""t"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"") AS ""b"" ON ""t"".""month""=""b"".""month"" LIMIT 10"
285,"WITH RECURSIVE ""CTE1"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 AS ""month"" FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT ""ride_distance"",""ride_duration"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""A"" LEFT JOIN ""Rides"" AS ""B"" ON ""A"".""ride_id""=""B"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""CTE3"" AS (SELECT ""A"".""month"",SUM(COALESCE(""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""ride_duration"", 0)) AS ""ride_duration"" FROM ""CTE1"" AS ""A"" LEFT JOIN ""CTE2"" AS ""B"" ON ""A"".""month""=""B"".""month"" GROUP BY ""A"".""month"") SELECT * FROM (SELECT ""month"",ROUND(AVG(""ride_distance"") OVER ""three_month_period"", 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER ""three_month_period"", 2) AS ""average_ride_duration"" FROM ""CTE3"" WINDOW ""three_month_period"" AS (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)) AS ""T"" WHERE ""month""<=10"
286,"WITH RECURSIVE ""tmp"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""tmp"" WHERE ""month""<12), ""tmp2"" AS (SELECT ""requested_at"",""ride_distance"",""ride_duration"" FROM ""rides"" NATURAL JOIN ""acceptedrides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""tmp3"" AS (SELECT ""month"",COALESCE(ROUND(SUM(SUM(""ride_distance"")) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(SUM(""ride_duration"")) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""tmp"" LEFT JOIN ""tmp2"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") GROUP BY 1 ORDER BY 1) SELECT * FROM ""tmp3"" WHERE ""month""<=10"
287,"WITH RECURSIVE ""M"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""M"" WHERE ""month""<12), ""S"" AS (SELECT ""c"".*,COALESCE(""d"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""d"".""ride_duration"", 0) AS ""ride_duration"" FROM ""M"" AS ""c"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""ride_distance"",SUM(""b"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"" ORDER BY ""month"") AS ""d"" ON ""c"".""month""=""d"".""month""), ""T"" AS (SELECT ""a"".*,""b"".""ride_distance"" AS ""dist1"",""b"".""ride_duration"" AS ""dura1"",""c"".""ride_distance"" AS ""dist2"",""c"".""ride_duration"" AS ""dura2"" FROM ((""S"" AS ""a"") JOIN ""S"" AS ""b"") JOIN ""S"" AS ""c"" WHERE ""a"".""month""=""b"".""month""-1 AND ""a"".""month""=""c"".""month""-2) SELECT ""month"",ROUND((""ride_distance""+""dist1""+""dist2"")/3, 2) AS ""average_ride_distance"",ROUND((""ride_duration""+""dura1""+""dura2"")/3, 2) AS ""average_ride_duration"" FROM ""T"" ORDER BY 1"
288,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""t"".""month"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_distance"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_duration"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""t"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"") AS ""b"" ON ""t"".""month""=""b"".""month"" ORDER BY 1 LIMIT 10"
289,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""pseudomonth"" UNION ALL SELECT ""pseudomonth""+1 FROM ""months"" WHERE ""pseudomonth""<12), ""trips"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT * FROM (SELECT ""pseudomonth"" AS ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""pseudomonth"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""pseudomonth"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""pseudomonth"",COALESCE(""t"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""t"".""ride_duration"", 0) AS ""ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""trips"" AS ""t"" ON ""t"".""month""=""m"".""pseudomonth"") AS ""iq"") AS ""oq"" WHERE ""month""<=10"
290,"WITH RECURSIVE ""mon"" AS (SELECT 1 AS ""month_num"" UNION ALL SELECT ""month_num""+1 AS ""month_num"" FROM ""mon"" WHERE ""month_num""+1<=10), ""denorm"" AS (SELECT ""requested_at"",""ride_duration"",""ride_distance"" FROM (""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") LEFT JOIN ""Drivers"" AS ""d"" ON ""d"".""driver_id""=""ar"".""driver_id"") SELECT ""m"".""month_num"" AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""mon"" AS ""m"" LEFT JOIN ""denorm"" AS ""d"" ON ""requested_at"">=CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""-1 MONTH' AND ""requested_at""<CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""+2 MONTH' GROUP BY ""m"".""month_num"""
291,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte2"" AS (SELECT ""R"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""m"",""ride_distance"",""ride_duration"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""A"" ON ""R"".""ride_id""=""A"".""ride_id"" WHERE ""requested_at"">='2020-01-01' AND ""requested_at""<='2020-12-31'), ""cte3"" AS (SELECT ""r"".""month"" AS ""month"",COALESCE(SUM(""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""ride_duration""), 0) AS ""ride_duration"" FROM ""cte"" AS ""r"" LEFT JOIN ""cte2"" AS ""c"" ON ""r"".""month""=""c"".""m"" GROUP BY ""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte3"" LIMIT 10"
292,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<10) SELECT ""months"".""month"",ROUND(COALESCE(SUM(""ride_distance"")/3, 0.00), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration"")/3, 0.00), 2) AS ""average_ride_duration"" FROM ""months"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) AS ""avg_data"" ON ""months"".""month""=""avg_data"".""month"" OR ""months"".""month""=""avg_data"".""month""-1 OR ""months"".""month""=""avg_data"".""month""-2 GROUP BY ""months"".""month"""
293,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""monthly_list"" AS (SELECT ""m"".""month"",COALESCE(SUM(""b"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""b"".""ride_duration""), 0) AS ""ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""monthly_list"" ORDER BY ""month"" LIMIT 10"
294,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<=9) SELECT ""cte"".""month"",ROUND(SUM(COALESCE(""ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ""cte"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" RIGHT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""t"" ON ""cte"".""month""<=""t"".""month"" AND ""t"".""month""<=""cte"".""month""+2 GROUP BY ""cte"".""month"" ORDER BY ""cte"".""month"""
295,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""months"" UNION ALL SELECT ""months""+1 FROM ""m"" WHERE ""months""<=11), ""distance"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""mo"",SUM(""ar"".""ride_distance"") AS ""sum_distance"",SUM(""ar"".""ride_duration"") AS ""sum_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1), ""mo_distance"" AS (SELECT ""months"",COALESCE(""sum_distance"", 0) AS ""sum_distance"",COALESCE(""sum_duration"", 0) AS ""sum_duration"" FROM ""m"" LEFT JOIN ""distance"" ON ""m"".""months""=""distance"".""mo"") SELECT * FROM (SELECT ""months"" AS ""month"",ROUND(AVG(""sum_distance"") OVER (ORDER BY ""months"" ROWS BETWEEN 0 PRECEDING AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""sum_duration"") OVER (ORDER BY ""months"" ROWS BETWEEN 0 PRECEDING AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""mo_distance"" ORDER BY 1) AS ""t"" WHERE ""month""<=10 ORDER BY 1"
296,"WITH RECURSIVE ""spine"" AS (SELECT 1 AS ""m"" UNION SELECT ""m""+1 FROM ""spine"" WHERE ""m""<12), ""monthly"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""m"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""m""), ""tmp"" AS (SELECT ""spine"".""m"" AS ""month"",ROUND(AVG(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""spine"".""m"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""spine"".""m"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""spine"" LEFT JOIN ""monthly"" ON ""spine"".""m""=""monthly"".""m"") SELECT * FROM ""tmp"" WHERE ""month""<=10"
297,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte1"" WHERE ""month""<12), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""ride_id"",""r"".""requested_at"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020), ""cte3"" AS (SELECT ""cte1"".""month"",COALESCE(SUM(""cte2"".""ride_distance""), 0) AS ""tol_dis"",COALESCE(SUM(""cte2"".""ride_duration""), 0) AS ""tol_dur"" FROM ""cte1"" LEFT JOIN ""cte2"" ON ""cte1"".""month""=""cte2"".""month"" GROUP BY 1 ORDER BY 1), ""cte4"" AS (SELECT ""month"",ROUND(AVG(""tol_dis"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""tol_dur"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte3"") SELECT ""month"",""average_ride_distance"",""average_ride_duration"" FROM ""cte4"" WHERE ""month""<=10 ORDER BY ""month"""
298,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<=11), ""cte2"" AS (SELECT ""cte"".""month"",SUM(""ride_distance"") AS ""r_dist"",SUM(""ride_duration"") AS ""r_dur"" FROM (""cte"" LEFT JOIN (SELECT * FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020') AS ""r"" ON ""cte"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"")) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY ""cte"".""month"") SELECT ""cte2"".""month"",CASE WHEN ROUND(SUM(""cte3"".""r_dist"")/3, 2) IS NULL THEN 0.00 ELSE ROUND(SUM(""cte3"".""r_dist"")/3, 2) END AS ""average_ride_distance"",CASE WHEN ROUND(SUM(""cte3"".""r_dur"")/3, 2) IS NULL THEN 0.00 ELSE ROUND(SUM(""cte3"".""r_dur"")/3, 2) END AS ""average_ride_duration"" FROM ""cte2"" JOIN ""cte2"" AS ""cte3"" ON ""cte2"".""month"">=(""cte3"".""month""-2) AND ""cte2"".""month""<=""cte3"".""month"" WHERE ""cte2"".""month""<=10 GROUP BY ""cte2"".""month"" ORDER BY ""cte2"".""month"""
299,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""temp"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1 ORDER BY 1) SELECT * FROM (SELECT ""m"".""month"",ROUND(SUM(COALESCE(""t"".""ride_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""t"".""ride_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""temp"" AS ""t"" ON ""m"".""month""=""t"".""month"" GROUP BY 1) AS ""a"" WHERE ""month""<11"
300,"WITH RECURSIVE ""A1"" AS (SELECT 1 AS ""MON"" UNION ALL SELECT ""MON""+1 FROM ""A1"" WHERE ""MON""<12), ""CET"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""MON"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""AcceptedRides"" AS ""A"" JOIN ""Rides"" AS ""R"" ON ""R"".""ride_id""=""A"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT ""A1"".""MON"" AS ""month"",ROUND((COALESCE(""T1"".""ride_distance"", 0)+COALESCE(""T2"".""ride_distance"", 0)+COALESCE(""T3"".""ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""T1"".""ride_duration"", 0)+COALESCE(""T2"".""ride_duration"", 0)+COALESCE(""T3"".""ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ((""A1"" LEFT JOIN ""CET"" AS ""T1"" ON ""A1"".""MON""=""T1"".""MON"") LEFT JOIN ""CET"" AS ""T2"" ON ""A1"".""MON""=""T2"".""MON""-1) LEFT JOIN ""CET"" AS ""T3"" ON ""A1"".""MON""=""T3"".""MON""-2 WHERE ""A1"".""MON""<=10"
301,"WITH RECURSIVE ""t1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mon"",SUM(""b"".""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1 ORDER BY 1), ""t2"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""t2"" WHERE ""month""<12) SELECT * FROM (SELECT ""a"".""month"",ROUND(SUM(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""t2"" AS ""a"" LEFT JOIN ""t1"" AS ""b"" ON ""a"".""month""=""b"".""mon"") AS ""t"" WHERE ""month""<=10 ORDER BY 1"
302,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<=11) SELECT DISTINCT ""month"",ROUND(SUM(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (""cte"" LEFT JOIN ""rides"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" USING (""ride_id"") ORDER BY 1 LIMIT 10"
303,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""all_months"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND((SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN 0 PRECEDING AND 2 FOLLOWING))/3, 2) AS ""average_ride_distance"",ROUND((SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN 0 PRECEDING AND 2 FOLLOWING))/3, 2) AS ""average_ride_duration"" FROM (SELECT ""t1"".""month"",CASE WHEN ""t2"".""ride_distance"" IS NULL THEN 0 ELSE ""t2"".""ride_distance"" END AS ""ride_distance"",CASE WHEN ""t2"".""ride_duration"" IS NULL THEN 0 ELSE ""t2"".""ride_duration"" END AS ""ride_duration"" FROM ""all_months"" AS ""t1"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"",SUM(""t1"".""ride_distance"") AS ""ride_distance"",SUM(""t1"".""ride_duration"") AS ""ride_duration"" FROM ""acceptedrides"" AS ""t1"" JOIN ""rides"" AS ""t2"" ON ""t2"".""ride_id""=""t1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""t2"".""requested_at"")=2020 GROUP BY ""month"") AS ""t2"" ON ""t2"".""month""=""t1"".""month"") AS ""t"") AS ""t"" WHERE ""month""<=10"
304,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""monthly_rides"" AS (SELECT ""mo"".""month"",COALESCE(SUM(""ar"".""ride_distance""), 0) AS ""total_distance"",COALESCE(SUM(""ar"".""ride_duration""), 0) AS ""total_duration"" FROM ""months"" AS ""mo"" LEFT JOIN (""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) ON ""mo"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") GROUP BY ""mo"".""month"") SELECT ""mo"".""month"",ROUND(AVG(""mr"".""total_distance""), 2) AS ""average_ride_distance"",ROUND(AVG(""mr"".""total_duration""), 2) AS ""average_ride_duration"" FROM ""monthly_rides"" AS ""mr"" JOIN ""months"" AS ""mo"" ON ""mr"".""month"" BETWEEN ""mo"".""month"" AND ""mo"".""month""+2 WHERE ""mo"".""month""<11 GROUP BY ""mo"".""month"""
305,"SELECT 1 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (1,2,3) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 UNION SELECT 2 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (2,3,4) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 UNION SELECT 3 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (3,4,5) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 UNION SELECT 4 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (4,5,6) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 UNION SELECT 5 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (5,6,7) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 UNION SELECT 6 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (6,7,8) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 UNION SELECT 7 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (7,8,9) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 UNION SELECT 8 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (8,9,10) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 UNION SELECT 9 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (9,10,11) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 UNION SELECT 10 AS ""month"",COALESCE(ROUND(SUM(""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM (""rides"") JOIN ""acceptedrides"" WHERE ""rides"".""ride_id""=""acceptedrides"".""ride_id"" AND EXTRACT(MONTH FROM ""rides"".""requested_at"") IN (10,11,12) AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020"
306,"WITH RECURSIVE ""CTE1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""CTE2"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE2"" WHERE ""month""<12), ""CTE3"" AS (SELECT ""CTE2"".""month"",COALESCE(""ride_distance"", 0) AS ""distance"",COALESCE(""ride_duration"", 0) AS ""duration"" FROM ""CTE2"" LEFT JOIN ""CTE1"" ON ""CTE2"".""month""=""CTE1"".""month"") SELECT ""A"".""month"",ROUND((""A"".""distance""+""B"".""distance""+""C"".""distance"")/3, 2) AS ""average_ride_distance"",ROUND((""A"".""duration""+""B"".""duration""+""C"".""duration"")/3, 2) AS ""average_ride_duration"" FROM ((""CTE3"" AS ""A"") JOIN ""CTE3"" AS ""B"") JOIN ""CTE3"" AS ""C"" WHERE ""C"".""month""=""A"".""month""+2 AND ""B"".""month""=""A"".""month""+1 ORDER BY ""month"""
307,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"") UNION ALL SELECT ""month"",0,0 FROM ""cte"" WHERE ""month"" NOT IN (SELECT EXTRACT(MONTH FROM ""requested_at"") FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) ORDER BY ""month""), ""CTE6"" AS (SELECT ""month"",ROUND((SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_distance"",ROUND((SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING))/3, 2) AS ""average_ride_duration"" FROM ""CTE1"") SELECT * FROM ""CTE6"" WHERE ""month""<=10"
308,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<12), ""cte"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""dist"",SUM(""ride_duration"") AS ""dur"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT ""month"",ROUND(""average_ride_distance"", 2) AS ""average_ride_distance"",ROUND(""average_ride_duration"", 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",AVG(COALESCE(""dist"", 0)) OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""average_ride_distance"",AVG(COALESCE(""dur"", 0)) OVER (ORDER BY ""m"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS ""average_ride_duration"" FROM ""m"" LEFT JOIN ""cte"" AS ""c"" ON ""m"".""month""=""c"".""month"") AS ""t"" WHERE ""month""<=10"
309,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""months"" WHERE ""month""<10), ""temp"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""ar"".""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""ar"" WHERE ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",ROUND((COALESCE(""m1"".""distance"", 0)+COALESCE(""m2"".""distance"", 0)+COALESCE(""m3"".""distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""m1"".""duration"", 0)+COALESCE(""m2"".""duration"", 0)+COALESCE(""m3"".""duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ((""months"" AS ""m"" LEFT JOIN ""temp"" AS ""m1"" ON ""m"".""month""=""m1"".""month"") LEFT JOIN ""temp"" AS ""m2"" ON ""m"".""month""=""m2"".""month""-1) LEFT JOIN ""temp"" AS ""m3"" ON ""m"".""month""=""m3"".""month""-2"
310,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""+1<13), ""record"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""MONTH"",SUM(""ride_distance"") AS ""distance"",SUM(""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""MONTH""), ""final_record"" AS (SELECT ""month"",ROUND(AVG(""distance"") OVER (ORDER BY ""MONTH"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""duration"") OVER (ORDER BY ""MONTH"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""Months"".""Month"" AS ""month"",COALESCE(""distance"", 0) AS ""distance"",COALESCE(""duration"", 0) AS ""duration"" FROM ""Months"" LEFT JOIN ""record"" ON ""Months"".""Month""=""record"".""Month"") AS ""mth_record"") SELECT * FROM ""final_record"" WHERE ""month""<11"
311,"WITH RECURSIVE ""t1"" AS (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""dis"",SUM(""ride_duration"") AS ""dur"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""t2"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""t2"" WHERE ""month""<12) SELECT * FROM (SELECT ""t2"".""month"",ROUND(SUM(COALESCE(""dis"", 0)) OVER (ORDER BY ""t2"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""dur"", 0)) OVER (ORDER BY ""t2"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t2"".""month""=""t1"".""month"") AS ""t"" WHERE ""month""<=10 ORDER BY 1"
312,"SELECT ""temp"".""month"",ROUND(COALESCE(SUM(""t"".""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""t"".""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"")) AS ""temp"" LEFT JOIN (SELECT ""R"".""ride_id"",""R"".""requested_at"",""AR"".""ride_distance"",""AR"".""ride_duration"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""AR"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE LEFT(""R"".""requested_at"", 4)=2020) AS ""t"" ON EXTRACT(MONTH FROM ""t"".""requested_at"")>=""temp"".""month"" AND EXTRACT(MONTH FROM ""t"".""requested_at"")<=""temp"".""month""+2 GROUP BY ""temp"".""month"" ORDER BY ""temp"".""month"""
313,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""mon"" UNION ALL SELECT ""mon""+1 FROM ""month"" WHERE ""mon""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mon"",SUM(""ride_distance"") AS ""sd"",SUM(""ride_duration"") AS ""st"" FROM ""acceptedRides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""t2"" AS (SELECT ""m"".""mon"",COALESCE(""sd"", 0) AS ""sd"",COALESCE(""st"", 0) AS ""st"" FROM ""month"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""mon""=""t1"".""mon"") SELECT ""t2"".""mon"" AS ""month"",ROUND(SUM(""tt2"".""sd"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""tt2"".""st"")/3, 2) AS ""average_ride_duration"" FROM ""t2"" JOIN ""t2"" AS ""tt2"" ON (""tt2"".""mon""-""t2"".""mon"") BETWEEN 0 AND 2 GROUP BY ""t2"".""mon"" HAVING ""t2"".""mon""<=10"
314,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""mon"" UNION ALL SELECT ""mon""+1 FROM ""month"" WHERE ""mon""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mon"",SUM(""ride_distance"") AS ""sd"",SUM(""ride_duration"") AS ""st"" FROM ""acceptedRides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""t2"" AS (SELECT ""m"".""mon"",COALESCE(""sd"", 0) AS ""sd"",COALESCE(""st"", 0) AS ""st"" FROM ""month"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""mon""=""t1"".""mon"") SELECT ""t2"".""mon"" AS ""month"",ROUND(SUM(""tt2"".""sd"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""tt2"".""st"")/3, 2) AS ""average_ride_duration"" FROM ""t2"" JOIN ""t2"" AS ""tt2"" ON (""tt2"".""mon""-""t2"".""mon"") BETWEEN 0 AND 2 GROUP BY ""t2"".""mon"" HAVING ""t2"".""mon""<=10"
315,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_duration"") END AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final"" ORDER BY ""month"" LIMIT 10"
316,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte1"" AS (SELECT ""cte"".""month"",COALESCE(""rd"", 0) AS ""rd"",COALESCE(""rdu"", 0) AS ""rdu"" FROM ""cte"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""rd"",SUM(""ride_duration"") AS ""rdu"" FROM (SELECT * FROM ""rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""r"" JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"") AS ""t1"" USING (""month"")) SELECT ""a"".""month"",ROUND(AVG(""b"".""rd""), 2) AS ""average_ride_distance"",ROUND(AVG(""b"".""rdu""), 2) AS ""average_ride_duration"" FROM ""cte1"" AS ""a"" JOIN ""cte1"" AS ""b"" ON ""b"".""month""-""a"".""month"" BETWEEN 0 AND 2 GROUP BY ""a"".""month"" HAVING COUNT(""b"".""rd"")=3 ORDER BY ""a"".""month"""
317,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT * FROM (SELECT ""month"",ROUND((LEAD(COALESCE(""ride_distance"", 0), 1) OVER (ORDER BY ""month"")+LEAD(COALESCE(""ride_distance"", 0), 2) OVER (ORDER BY ""month"")+COALESCE(""ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(LEAD(COALESCE(""ride_duration"", 0), 1) OVER (ORDER BY ""month""), 0)+COALESCE(LEAD(COALESCE(""ride_duration"", 0), 2) OVER (ORDER BY ""month""), 0)+COALESCE(""ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ""cte"" LEFT JOIN (SELECT ""requested_at"",SUM(COALESCE(""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""ride_duration"", 0)) AS ""ride_duration"" FROM (""acceptedrides"" AS ""a"") JOIN ""rides"" AS ""r"" WHERE ""a"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""tt"" ON EXTRACT(MONTH FROM ""tt"".""requested_at"")=""cte"".""month"") AS ""x"" WHERE ""month""<=10"
318,"WITH RECURSIVE ""cte2"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte2"" WHERE ""month""<=9), ""cte"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(COALESCE(""ride_distance"", 0)) AS ""ride_distance"",SUM(COALESCE(""ride_duration"", 0)) AS ""ride_duration"" FROM ""Rides"" AS ""a"" LEFT JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT ""a"".""month"",ROUND(SUM(COALESCE(""b"".""ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""b"".""ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ""cte2"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON (""b"".""month"">=""a"".""month"" AND ""b"".""month""<=""a"".""month""+2) GROUP BY 1 ORDER BY 1"
319,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""ridesStat"" AS (SELECT EXTRACT(MONTH FROM ""r1"".""requested_at"") AS ""month"",SUM(""a1"".""ride_distance"") AS ""distance"",SUM(""a1"".""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""a1"" LEFT JOIN ""Rides"" AS ""r1"" ON ""r1"".""ride_id""=""a1"".""ride_id"" WHERE ""r1"".""requested_at"" LIKE '2020%' GROUP BY 1), ""ridesStat2"" AS (SELECT ""c1"".""month"",COALESCE(ROUND(SUM(""r1"".""distance"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""r1"".""duration"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""cte"" AS ""c1"" LEFT JOIN ""ridesStat"" AS ""r1"" ON ""r1"".""month""=""c1"".""month"") SELECT * FROM ""ridesStat2"" WHERE ""month""<=10"
320,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_duration"") END AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final_list"" ORDER BY ""month"" LIMIT 10"
321,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""month_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""ride_distance"",SUM(""a"".""ride_duration"") AS ""ride_duration"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY ""month""), ""every_month_rides"" AS (SELECT ""m"".""month"",COALESCE(""mr"".""ride_distance"", 0) AS ""ride_distance"",COALESCE(""mr"".""ride_duration"", 0) AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN ""month_rides"" AS ""mr"" ON ""mr"".""month""=""m"".""month"") SELECT ""t1"".""month"" AS ""month"",ROUND((""t1"".""ride_distance""+""t2"".""ride_distance""+""t3"".""ride_distance"")/3, 2) AS ""average_ride_distance"",ROUND((""t1"".""ride_duration""+""t2"".""ride_duration""+""t3"".""ride_duration"")/3, 2) AS ""average_ride_duration"" FROM (""every_month_rides"" AS ""t1"" JOIN ""every_month_rides"" AS ""t2"") JOIN ""every_month_rides"" AS ""t3"" ON ""t1"".""month""=""t2"".""month""-1 AND ""t2"".""month""=""t3"".""month""-1"
322,"WITH RECURSIVE ""cte_mo"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte_mo"" WHERE ""month""<=9), ""CTE"" AS (SELECT ""a"".""ride_distance"",""a"".""ride_duration"",CASE WHEN EXTRACT(MONTH FROM ""r"".""requested_at"")>=3 THEN EXTRACT(MONTH FROM ""r"".""requested_at"")-2 ELSE NULL END AS ""bucket1"",CASE WHEN EXTRACT(MONTH FROM ""r"".""requested_at"")>=2 THEN EXTRACT(MONTH FROM ""r"".""requested_at"")-1 ELSE NULL END AS ""bucket2"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""bucket3"" FROM ""ACCEPTEDRIDES"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""r"".""requested_at""<='2020-12-31' AND ""r"".""requested_at"">='2020-01-01') SELECT ""month"",ROUND(COALESCE(SUM(""ride_distance"")/3, 0), 2) AS ""AVERAGE_RIDE_DISTANCE"",ROUND(COALESCE(SUM(""ride_duration"")/3, 0), 2) AS ""AVERAGE_RIDE_duration"" FROM (SELECT ""c"".""month"",""t"".""ride_distance"",""t"".""ride_duration"" FROM ""cte_mo"" AS ""c"" LEFT JOIN ""CTE"" AS ""t"" ON ""c"".""month""=""t"".""bucket1"" OR ""c"".""month""=""t"".""bucket2"" OR ""c"".""month""=""t"".""bucket3"") AS ""t2"" GROUP BY ""MONTH"""
323,"WITH RECURSIVE ""cte"" (""day"") AS (SELECT STR_TO_DATE('2020-1-1', '%Y-%m-%d') UNION ALL SELECT ""day"" + INTERVAL '1 MONTH' FROM ""cte"" WHERE ""day""<'2020-10-1'), ""cte2"" AS (SELECT ""requested_at"",""ride_distance"",""ride_duration"" FROM ""AcceptedRides"" NATURAL JOIN ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT EXTRACT(MONTH FROM ""day"") AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""cte"" LEFT JOIN ""cte2"" ON ""requested_at"" BETWEEN ""day"" AND LAST_DAY(""day"" + INTERVAL '2 MONTH') GROUP BY ""month"" ORDER BY 1"
324,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_duration"") END AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final_list"" ORDER BY ""month"" LIMIT 10"
325,"WITH ""tbl"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",SUM(""a"".""ride_distance"") AS ""total_ride_distance"",SUM(""a"".""ride_duration"") AS ""total_ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month""), ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9 UNION ALL SELECT 10) SELECT ""months"".""month"",ROUND((COALESCE(""t1"".""total_ride_distance"", 0)+COALESCE(""t2"".""total_ride_distance"", 0)+COALESCE(""t3"".""total_ride_distance"", 0))/3, 2) AS ""average_ride_distance"",ROUND((COALESCE(""t1"".""total_ride_duration"", 0)+COALESCE(""t2"".""total_ride_duration"", 0)+COALESCE(""t3"".""total_ride_duration"", 0))/3, 2) AS ""average_ride_duration"" FROM ((""months"" LEFT JOIN ""tbl"" AS ""t1"" ON ""months"".""month""=""t1"".""month"") LEFT JOIN ""tbl"" AS ""t2"" ON ""months"".""month""+1=""t2"".""month"") LEFT JOIN ""tbl"" AS ""t3"" ON ""months"".""month""+2=""t3"".""month"""
326,"WITH RECURSIVE ""months"" AS (SELECT @""item"":=1 AS ""month"" UNION ALL SELECT @""item"":=@""item""+1 FROM ""months"" WHERE @""item""<12), ""summary_cte"" AS (SELECT ""t1"".""month"",COALESCE(SUM(""t3"".""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""t3"".""ride_duration""), 0) AS ""ride_duration"" FROM (""months"" AS ""t1"" LEFT JOIN ""Rides"" AS ""t2"" ON EXTRACT(YEAR FROM ""t2"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""t2"".""requested_at"")=""t1"".""month"") LEFT JOIN ""AcceptedRides"" AS ""t3"" ON ""t2"".""ride_id""=""t3"".""ride_id"" GROUP BY ""t1"".""month"") SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""summary_cte"" LIMIT 10"
327,"WITH RECURSIVE ""Tab"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Tab"" WHERE ""month""<=11), ""TOT"" AS (SELECT ""t"".""month"",COALESCE(SUM(""ride_distance""), 0) AS ""dist"",COALESCE(SUM(""ride_duration""), 0) AS ""dur"" FROM (""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")=2020) RIGHT JOIN ""Tab"" AS ""t"" ON EXTRACT(MONTH FROM ""r"".""requested_at"")=""t"".""month"" GROUP BY 1 ORDER BY 1) SELECT ""a"".""month"",ROUND((""a"".""dist""+""b"".""dist""+""c"".""dist"")/3, 2) AS ""average_ride_distance"",ROUND((""a"".""dur""+""b"".""dur""+""c"".""dur"")/3, 2) AS ""average_ride_duration"" FROM (""TOT"" AS ""a"" JOIN ""TOT"" AS ""b"" ON ""a"".""month""=""b"".""month""-1) JOIN ""TOT"" AS ""c"" ON ""a"".""month""=""c"".""month""-2 GROUP BY 1 ORDER BY 1"
328,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""t"".""month"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_distance"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(CAST(COALESCE(""b"".""monthly_duration"", 0) AS FLOAT)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""cte"" AS ""t"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",SUM(""b"".""ride_distance"") AS ""monthly_distance"",SUM(""ride_duration"") AS ""monthly_duration"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"") AS ""b"" ON ""t"".""month""=""b"".""month"" ORDER BY 1 LIMIT 10"
329,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""mon"" UNION ALL SELECT ""mon""+1 FROM ""month"" WHERE ""mon""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mon"",SUM(""ride_distance"") AS ""sd"",SUM(""ride_duration"") AS ""st"" FROM ""acceptedRides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""t2"" AS (SELECT ""m"".""mon"",COALESCE(""sd"", 0) AS ""sd"",COALESCE(""st"", 0) AS ""st"" FROM ""month"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""mon""=""t1"".""mon"") SELECT ""t2"".""mon"" AS ""month"",ROUND(SUM(""tt2"".""sd"")/3, 2) AS ""average_ride_distance"",ROUND(SUM(""tt2"".""st"")/3, 2) AS ""average_ride_duration"" FROM ""t2"" JOIN ""t2"" AS ""tt2"" ON (""tt2"".""mon""-""t2"".""mon"") BETWEEN 0 AND 2 GROUP BY ""t2"".""mon"" HAVING ""t2"".""mon""<=10"
330,"SELECT ""mon"" AS ""month"",ROUND(AVG(""tt_dis"") OVER (ORDER BY ""mon"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""tt_du"") OVER (ORDER BY ""mon"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""t1"".""mon"",SUM(COALESCE(""ride_distance"", 0)) AS ""tt_dis"",SUM(COALESCE(""ride_duration"", 0)) AS ""tt_du"" FROM (SELECT 1 AS ""mon"" FROM ""Rides"" UNION SELECT 2 AS ""mon"" FROM ""Rides"" UNION SELECT 3 AS ""mon"" FROM ""Rides"" UNION SELECT 4 AS ""mon"" FROM ""Rides"" UNION SELECT 5 AS ""mon"" FROM ""Rides"" UNION SELECT 6 AS ""mon"" FROM ""Rides"" UNION SELECT 7 AS ""mon"" FROM ""Rides"" UNION SELECT 8 AS ""mon"" FROM ""Rides"" UNION SELECT 9 AS ""mon"" FROM ""Rides"" UNION SELECT 10 AS ""mon"" FROM ""Rides"" UNION SELECT 11 AS ""mon"" FROM ""Rides"" UNION SELECT 12 AS ""mon"" FROM ""Rides"") AS ""t1"" LEFT JOIN (SELECT ""ride_id"",""ride_distance"",""ride_duration"",EXTRACT(YEAR FROM ""requested_at"") AS ""yr"",EXTRACT(MONTH FROM ""requested_at"") AS ""mon"" FROM ""Rides"" NATURAL JOIN ""AcceptedRides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 ORDER BY ""mon"") AS ""t2"" ON (""t1"".""mon""=""t2"".""mon"") GROUP BY ""mon"") AS ""t3"" LIMIT 10"
331,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""temp"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ride_distance"",SUM(""ride_duration"") AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1 ORDER BY 1) SELECT * FROM (SELECT ""m"".""month"",ROUND(AVG(COALESCE(""t"".""ride_distance"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(COALESCE(""t"".""ride_duration"", 0)) OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""temp"" AS ""t"" ON ""m"".""month""=""t"".""month"" GROUP BY 1) AS ""a"" WHERE ""month""<11"
332,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_duration"") END AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final_list"" ORDER BY ""month"" LIMIT 10"
333,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""ridesStat"" AS (SELECT EXTRACT(MONTH FROM ""r1"".""requested_at"") AS ""month"",SUM(""a1"".""ride_distance"") AS ""distance"",SUM(""a1"".""ride_duration"") AS ""duration"" FROM ""AcceptedRides"" AS ""a1"" LEFT JOIN ""Rides"" AS ""r1"" ON ""r1"".""ride_id""=""a1"".""ride_id"" WHERE ""r1"".""requested_at"" LIKE '2020%' GROUP BY 1), ""ridesStat2"" AS (SELECT ""c1"".""month"",COALESCE(ROUND(SUM(""r1"".""distance"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""r1"".""duration"") OVER (ORDER BY ""c1"".""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2), 0) AS ""average_ride_duration"" FROM ""cte"" AS ""c1"" LEFT JOIN ""ridesStat"" AS ""r1"" ON ""r1"".""month""=""c1"".""month"") SELECT * FROM ""ridesStat2"" WHERE ""month""<=10"
334,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM (SELECT ""m"".""month"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_distance"") END AS ""ride_distance"",CASE WHEN ""b"".""month"" IS NULL THEN 0 ELSE SUM(""b"".""ride_duration"") END AS ""ride_duration"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")='2020') AS ""b"" ON ""m"".""month""=""b"".""month"" GROUP BY ""m"".""month"") AS ""final_list"" ORDER BY ""month"" LIMIT 10"
335,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<10) SELECT ""c"".""month"",COALESCE(ROUND(SUM(""t"".""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""t"".""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""cte"" AS ""c"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""t"" ON ""c"".""month""+2>=""t"".""month"" AND ""t"".""month"">=""c"".""month"" GROUP BY 1"
336,"WITH ""month"" AS (SELECT 1 AS ""month"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=1 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=1 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 2,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=2 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=2 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 3,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=3 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=3 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 4,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=4 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=4 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 5,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=5 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=5 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 6,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=6 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=6 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 7,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=7 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=7 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 8,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=8 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=8 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 9,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=9 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=9 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 10,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=10 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=10 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 11,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=11 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=11 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 UNION ALL SELECT 12,SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=12 THEN ""ride_distance"" ELSE 0 END) AS ""ride_distance"",SUM(CASE WHEN EXTRACT(MONTH FROM ""requested_at"")=12 THEN ""ride_duration"" ELSE 0 END) AS ""ride_duration"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT ""month"",ROUND(AVG(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""month"" LIMIT 10"
337,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<10) SELECT ""c"".""month"",COALESCE(ROUND(SUM(""t"".""ride_distance"")/3, 2), 0) AS ""average_ride_distance"",COALESCE(ROUND(SUM(""t"".""ride_duration"")/3, 2), 0) AS ""average_ride_duration"" FROM ""cte"" AS ""c"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""ride_distance"",""a"".""ride_duration"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""t"" ON ""c"".""month""+2>=""t"".""month"" AND ""t"".""month"">=""c"".""month"" GROUP BY 1"
338,"WITH RECURSIVE ""mon"" AS (SELECT 1 AS ""month_num"" UNION ALL SELECT ""month_num""+1 AS ""month_num"" FROM ""mon"" WHERE ""month_num""+1<=10), ""denorm"" AS (SELECT ""requested_at"",""ride_duration"",""ride_distance"" FROM (""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") LEFT JOIN ""Drivers"" AS ""d"" ON ""d"".""driver_id""=""ar"".""driver_id"") SELECT ""m"".""month_num"" AS ""month"",ROUND(COALESCE(SUM(""ride_distance""), 0)/3, 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""ride_duration""), 0)/3, 2) AS ""average_ride_duration"" FROM ""mon"" AS ""m"" LEFT JOIN ""denorm"" AS ""d"" ON ""requested_at"">=CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""-1 MONTH' AND ""requested_at""<CAST('2020-01-01' AS DATE) + INTERVAL '""month_num""+2 MONTH' GROUP BY ""m"".""month_num"""
339,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""ct2"" AS (SELECT ""month"",COALESCE(SUM(""ride_distance""), 0) AS ""ride_distance"",COALESCE(SUM(""ride_duration""), 0) AS ""ride_duration"" FROM (""cte"" LEFT JOIN ""Rides"" AS ""r"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"") SELECT * FROM (SELECT ""month"",ROUND(SUM(""ride_distance"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(""ride_duration"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM ""ct2"") AS ""f2"" WHERE ""month""<11"
340,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<10), ""t1"" AS (SELECT ""ar"".""ride_id"",""r"".""requested_at"",""ride_distance"",""ride_duration"" FROM (""AcceptedRides"" AS ""ar"") JOIN ""Rides"" AS ""r"" WHERE ""ar"".""ride_id""=""r"".""ride_id"") SELECT ""m"".""month"",ROUND(COALESCE(SUM(""t1"".""ride_distance"")/3, 0), 2) AS ""average_ride_distance"",ROUND(COALESCE(SUM(""t1"".""ride_duration"")/3, 0), 2) AS ""average_ride_duration"" FROM ""months"" AS ""m"" LEFT JOIN ""t1"" ON ""t1"".""requested_at"">=CONCAT('2020-', ""m"".""month"", '-01') AND ""t1"".""requested_at""<CONCAT('2020-', ""m"".""month"", '-01') + INTERVAL '3 MONTH' GROUP BY ""m"".""month"" ORDER BY 1"
341,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""groupbymonth"" AS (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(""ride_distance"") AS ""ts"",SUM(""ride_duration"") AS ""td"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""t"" AS (SELECT ""cte"".""month"",COALESCE(""ts"", 0) AS ""ts0"",COALESCE(""td"", 0) AS ""td0"" FROM ""cte"" LEFT JOIN ""groupbymonth"" ON ""cte"".""month""=""groupbymonth"".""month"") SELECT ""month"",ROUND(AVG(""ts0"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_distance"",ROUND(AVG(""td0"") OVER (ORDER BY ""month"" ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING), 2) AS ""average_ride_duration"" FROM ""t"" ORDER BY 1 LIMIT 10"
342,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<=11) SELECT DISTINCT ""month"",ROUND(SUM(COALESCE(""ride_distance"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_distance"",ROUND(SUM(COALESCE(""ride_duration"", 0)) OVER (ORDER BY ""month"" RANGE BETWEEN CURRENT ROW AND 2 FOLLOWING)/3, 2) AS ""average_ride_duration"" FROM (""cte"" LEFT JOIN ""rides"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") AND EXTRACT(YEAR FROM ""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" USING (""ride_id"") ORDER BY 1 LIMIT 10"
