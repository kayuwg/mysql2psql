id,original query
1,"SELECT ""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='NO') AND ""Driver_Id"" IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='NO') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
2,"SELECT ""t1"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t1"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t1"" LEFT JOIN ""Users"" AS ""u"" ON ""t1"".""client_Id""=""u"".""Users_Id"" WHERE ""u"".""Banned""='No' AND (""t1"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY ""t1"".""Request_at"""
3,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""Status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"") JOIN ""Users"" AS ""s"" ON ""t"".""Driver_Id""=""s"".""Users_Id"" WHERE ""u"".""Banned""='NO' AND ""s"".""Banned""='NO' GROUP BY 1 HAVING ""Day"" BETWEEN '2013-10-01' AND '2013-10-03' ORDER BY 1"
4,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""Status""='cancelled_by_driver' THEN 1 ELSE 0 END)+SUM(CASE WHEN ""Status""='cancelled_by_client' THEN 1 ELSE 0 END))/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""t"".""Client_Id""=""c"".""Users_Id"") JOIN ""Users"" AS ""d"" ON ""t"".""Driver_Id""=""d"".""Users_Id"" WHERE ""c"".""Banned""='No' AND ""d"".""Banned""='No' AND DATE(""Request_at"")>=DATE '2013-10-01' AND DATE(""Request_at"")<=DATE '2013-10-03' GROUP BY ""t"".""Request_at"""
5,"WITH ""banned_users"" AS (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""banned_users"") AND ""driver_id"" NOT IN (SELECT ""users_id"" FROM ""banned_users"") AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
6,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status""='cancelled_by_driver' THEN 1 WHEN ""status""='cancelled_by_client' THEN 1 ELSE 0 END)/(COUNT(1)), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""users"" AS ""u1"" ON ""t"".""client_id""=""u1"".""users_id"" AND ""u1"".""banned""='No') JOIN ""users"" AS ""u2"" ON ""u2"".""users_id""=""t"".""driver_id"" AND ""u2"".""banned""='No' WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"" ORDER BY ""request_at"""
7,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t1"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t1"" LEFT JOIN ""Users"" AS ""u"" ON ""t1"".""Client_Id""=""u"".""Users_Id"" WHERE ""u"".""Banned""='NO' AND (""t1"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY ""t1"".""Request_at"""
8,"SELECT ""Request_at"" AS ""day"",ROUND(COUNT(DISTINCT CASE WHEN LEFT(""Status"", 6)='cancel' THEN ""Id"" END)/COUNT(DISTINCT ""id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
9,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""client"" ON ""t"".""client_id""=""client"".""users_id"" AND ""client"".""banned""='No') JOIN ""users"" AS ""driver"" ON ""driver"".""users_id""=""t"".""driver_id"" AND ""driver"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""request_at"" ORDER BY 1"
10,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status""='completed' THEN 0 ELSE 1 END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""role""='client' AND ""banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""role""='driver' AND ""banned""='No') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
11,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""can_count""/""T"".""tot_count"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE ""t"".""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""can_count"",COUNT(1) AS ""tot_count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""T"""
12,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""t"".""Status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""t"".""Client_ID""=""c"".""Users_ID"" AND ""c"".""Banned""='No') JOIN ""Users"" AS ""d"" ON ""t"".""Driver_ID""=""d"".""Users_ID"" AND ""d"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
13,"WITH ""ct1"" AS (SELECT ""Request_at"",CASE WHEN ""status""='completed' THEN 0 ELSE 1 END AS ""can"",COUNT(1) OVER (PARTITION BY ""Request_at"") AS ""tot"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""U1"" ON ""t"".""Client_id""=""U1"".""users_id"" AND ""U1"".""banned""='No') JOIN ""Users"" AS ""U2"" ON ""t"".""Driver_Id""=""U2"".""users_id"" AND ""U2"".""banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""can"")/AVG(""tot""), 2) AS ""Cancellation Rate"" FROM ""ct1"" GROUP BY ""Request_at"" HAVING ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
14,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(""cancelled"")/COUNT(1), 2) AS ""Cancellation Rate"" FROM (SELECT ""request_at"",CASE WHEN ""c"".""banned""='No' AND ""d"".""banned""='No' THEN 1 ELSE 0 END AS ""valid_row"",CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END AS ""cancelled"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""t"".""client_id""=""c"".""users_id"") JOIN ""Users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"") AS ""temp"" WHERE ""valid_row""=1 AND ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' GROUP BY ""request_at"" ORDER BY ""request_at"""
15,"WITH ""cte"" AS (SELECT * FROM ""Trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""status""!='completed' THEN ""cte"".""id"" ELSE NULL END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""cte"" GROUP BY ""Request_at"""
16,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
17,"WITH ""cte1"" AS (SELECT ""t"".""Client_Id"",""t"".""Driver_Id"",""u1"".""Banned"" AS ""BannedClient"",""u2"".""Banned"" AS ""BannedDriver"",""t"".""Status"",""t"".""Request_at"" AS ""Day"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_ID""=""u2"".""Users_Id"") SELECT ""Day"",ROUND(COUNT(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE NULL END)/COUNT(""Status""), 2) AS ""Cancellation Rate"" FROM ""cte1"" WHERE (""BannedClient""='No' AND ""BannedDriver""='No') AND (""Day"" BETWEEN CAST('2013-10-01' AS DATE) AND CAST('2013-10-03' AS DATE)) GROUP BY ""Day"""
18,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
19,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
20,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""Canceled_Count""/""T"".""Trip_Count"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE ""t"".""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""Canceled_Count"",COUNT(1) AS ""Trip_Count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at""<='2013-10-03' AND ""t"".""Request_at"">='2013-10-01') AS ""T"""
21,"WITH ""cte"" AS (SELECT ""request_at"" AS ""Day"",COUNT(CASE ""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""ride_ct"",COUNT(1) AS ""total"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON (""u"".""users_id""=""t"".""client_id"" AND ""u"".""banned""='No')) JOIN ""users"" AS ""u2"" ON (""u2"".""users_id""=""t"".""driver_id"" AND ""u2"".""banned""='No') GROUP BY ""day"" HAVING ""day""<='2013-10-03' AND ""day"">='2013-10-01') SELECT ""Day"",ROUND(""ride_ct""/""total"", 2) AS ""Cancellation rate"" FROM ""cte"" GROUP BY ""day"""
22,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""Canceled_Count""/""T"".""Trip_Count"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE ""t"".""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""Canceled_Count"",COUNT(1) AS ""Trip_Count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at""<='2013-10-03' AND ""t"".""Request_at"">='2013-10-01') AS ""T"""
23,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
24,"SELECT ""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
25,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Trips"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" JOIN ""users"" AS ""cust"" ON (""cust"".""Users_Id""=""Trips"".""Client_Id"")) JOIN ""users"" AS ""driver"" ON (""driver"".""Users_Id""=""Trips"".""Driver_Id"") WHERE ""cust"".""Banned""='No' AND ""driver"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
26,"SELECT ""request_at"" AS ""day"",ROUND(COUNT(CASE WHEN ""status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""cancellation rate"" FROM ""trips"" WHERE (""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='yes') GROUP BY ""request_at"""
27,"WITH ""ACTIVE_USERS"" AS (SELECT ""USERS_ID"" FROM ""USERS"" WHERE ""BANNED""='No'), ""ACTIVE_TRIPS"" AS (SELECT ""STATUS"",""REQUEST_AT"" FROM ""TRIPS"" WHERE ""CLIENT_ID"" IN (SELECT ""USERS_ID"" FROM ""ACTIVE_USERS"") AND ""DRIVER_ID"" IN (SELECT ""USERS_ID"" FROM ""ACTIVE_USERS"") AND ""REQUEST_AT"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""REQUEST_AT"" AS ""DAY"",ROUND(SUM(1-CASE WHEN ""STATUS""='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""ACTIVE_TRIPS"" GROUP BY 1 ORDER BY 1"
28,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""cancelled"")/COUNT(""Request_at""), 2) AS ""Cancellation Rate"" FROM (SELECT ""t"".""Request_at"",CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END AS ""cancelled"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""c"" ON ""c"".""users_id""=""t"".""client_id"" AND ""c"".""banned""='No') JOIN ""users"" AS ""d"" ON ""d"".""users_id""=""t"".""driver_id"" AND ""d"".""banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""a"" GROUP BY ""Request_at"""
29,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""cancelled_count""/""T"".""total_count"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE ""t"".""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""cancelled_count"",COUNT(1) AS ""total_count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at"">='2013-10-01' AND ""t"".""Request_at""<='2013-10-03') AS ""T"""
30,"SELECT ""request_at"" AS ""day"",ROUND(SUM(""status"" LIKE '%cancelled%')/COUNT(1), 2) AS ""cancellation rate"" FROM ""trips"" AS ""t"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') GROUP BY 1 ORDER BY 1"
31,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(SUM(""T"".""Status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""T"" JOIN ""Users"" AS ""U1"" ON ""T"".""Client_Id""=""U1"".""Users_Id"" AND ""U1"".""Banned""='No') JOIN ""Users"" AS ""U2"" ON ""T"".""Driver_Id""=""U2"".""Users_Id"" AND ""U2"".""Banned""='No' WHERE ""T"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""T"".""Request_at"""
32,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""Banned""='No' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
33,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
34,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY ""Request_at"""
35,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(SUM(""t"".""status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" AND ""u"".""banned""='No') JOIN ""users"" AS ""u1"" ON ""t"".""driver_id""=""u1"".""users_id"" AND ""u1"".""banned""='No' WHERE ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""request_at"""
36,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(""status""!='completed')/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
37,"WITH ""validusers"" (""user_id"") AS (SELECT ""users_id"" FROM ""Users"" WHERE ""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(""status""), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_id"" IN (SELECT ""user_id"" FROM ""validusers"") AND ""Driver_Id"" IN (SELECT ""user_id"" FROM ""validusers"") AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
38,"SELECT DISTINCT ""t"".""request_at"" AS ""Day"",CAST(SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END) OVER (PARTITION BY ""request_at"")/CAST(COUNT(""request_at"") OVER (PARTITION BY ""request_at"") AS DECIMAL(10, 2)) AS DECIMAL(10, 2)) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""c"" ON ""t"".""client_id""=""c"".""users_id"") LEFT JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"" WHERE (""c"".""Banned""='No' AND ""d"".""banned""='No') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
39,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(DISTINCT ""id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""d1"" JOIN ""Users"" AS ""d2"" ON ""d1"".""client_id""=""d2"".""Users_id"" AND ""d2"".""Role""='client') JOIN ""Users"" AS ""d3"" ON ""d1"".""Driver_id""=""d3"".""Users_id"" AND ""d3"".""Role""='driver' WHERE ""d2"".""Banned""='No' AND ""d3"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
40,"WITH ""unbanned"" AS (SELECT ""Users_id"",""Role"" FROM ""Users"" WHERE ""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND EXISTS (SELECT TRUE FROM ""unbanned"" AS ""u"" WHERE ""t"".""Client_Id""=""u"".""Users_Id"") AND EXISTS (SELECT TRUE FROM ""unbanned"" AS ""u"" WHERE ""t"".""Driver_Id""=""u"".""Users_ID"") GROUP BY ""Request_at"""
41,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE '%cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""u"".""Users_Id""=""t"".""Client_Id"" AND ""u"".""Role""='client') LEFT JOIN ""Users"" AS ""s"" ON ""s"".""Users_Id""=""t"".""Driver_Id"" AND ""s"".""role""='driver' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""u"".""Banned""='No' AND ""s"".""Banned""='No' GROUP BY 1 ORDER BY 1"
42,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(""status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE (""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') GROUP BY ""request_at"""
43,"SELECT ""t"".""request_at"" AS ""day"",ROUND(""tmp"".""cancel_ct""/""tmp"".""total_ct"", 2) AS ""Cancellation Rate"" FROM (SELECT ""t"".""Status"",""t"".""Request_at"",COUNT(1) AS ""total_ct"",COUNT(CASE ""t"".""status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""cancel_ct"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u1"" ON ""t"".""client_id""=""u1"".""users_id"" AND ""u1"".""role""='client' AND ""u1"".""banned""='No') JOIN ""users"" AS ""u2"" ON ""t"".""driver_id""=""u2"".""users_id"" AND ""u2"".""role""='driver' AND ""u2"".""banned""='No' WHERE ""t"".""Request_at"">='2013-10-01' AND ""t"".""Request_at""<='2013-10-03' GROUP BY ""t"".""request_at"") AS ""tmp"" JOIN ""trips"" AS ""t"" ON ""t"".""request_at""=""tmp"".""request_at"" GROUP BY ""t"".""request_at"""
44,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""Canceled_Count""/""T"".""Trip_Count"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE ""t"".""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""Canceled_Count"",COUNT(1) AS ""Trip_Count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at""<='2013-10-03' AND ""t"".""Request_at"">='2013-10-01') AS ""T"""
45,"WITH ""t"" AS (SELECT *,CASE WHEN ""status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END AS ""cancel"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" WHERE (""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND (""banned""='No')) SELECT ""Request_at"" AS ""Day"",ROUND(AVG(""cancel""), 2) AS ""Cancellation Rate"" FROM ""t"" GROUP BY ""Request_at"" ORDER BY ""Request_at"""
46,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""client"" ON ""client"".""Users_id""=""t"".""Client_id"" AND ""client"".""banned""='No') JOIN ""Users"" AS ""driver"" ON ""driver"".""Users_id""=""t"".""Driver_id"" AND ""driver"".""banned""='No' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
47,"WITH ""cte1"" AS (SELECT ""Id"",""Client_Id"",""Driver_Id"",""Status"",""Request_at"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"") LEFT JOIN ""Users"" AS ""v"" ON ""t"".""Driver_Id""=""v"".""Users_Id"" WHERE ""u"".""Banned""!='Yes' AND ""v"".""Banned""!='Yes') SELECT ""Day"",ROUND(""cancel""/""total_ride"", 2) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"" AS ""Day"",SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END) AS ""cancel"",COUNT(""Id"") AS ""total_ride"" FROM ""cte1"" GROUP BY ""Day"") AS ""v"" WHERE ""Day"" BETWEEN '2013-10-01' AND '2013-10-03' ORDER BY ""Day"""
48,"WITH ""nb"" AS (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No'), ""tr"" AS (SELECT * FROM ""trips"" WHERE ""client_id"" IN (SELECT * FROM ""nb"") AND ""driver_id"" IN (SELECT * FROM ""nb"") AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""day"",ROUND(COUNT(CASE WHEN ""status"" LIKE 'cancelled_by_%' THEN 1 ELSE NULL END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""tr"" GROUP BY ""Request_at"""
49,"WITH ""unbanned"" AS (SELECT * FROM ""Users"" WHERE ""Banned""='No'), ""unbanned_status"" AS (SELECT ""Status"",""Request_at"" FROM ""Trips"" WHERE ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""unbanned"" WHERE ""Role""='driver') AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""unbanned"" WHERE ""Role""='client') AND (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03')) SELECT ""Request_at"" AS ""Day"",ROUND(""Canceled""/""Total"", 2) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"",COUNT(""Status"") AS ""Total"",(SELECT COUNT(""Status"") FROM ""unbanned_status"" AS ""p2"" WHERE ""p2"".""Request_at""=""p1"".""Request_at"" AND ""Status"" LIKE '%cancelled%') AS ""Canceled"" FROM ""unbanned_status"" AS ""p1"" GROUP BY ""Request_at"") AS ""sub"""
50,"SELECT ""Request_at"" AS ""Day"",ROUND(1-(SUM(CASE WHEN ""Status""='completed' THEN 1 ELSE 0 END)/COUNT(""Id"")), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN (SELECT ""Users_Id"" AS ""c_id"" FROM ""Users"" WHERE ""Role""='client' AND ""Banned""='No') AS ""c"" ON ""t"".""Client_Id""=""c"".""c_id"") LEFT JOIN (SELECT ""Users_Id"" AS ""d_id"" FROM ""Users"" WHERE ""Role""='driver' AND ""Banned""='No') AS ""d"" ON ""t"".""Driver_Id""=""d"".""d_id"" WHERE ""c_id"" IS NOT NULL AND ""d_id"" IS NOT NULL AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
51,"SELECT ""Day"",ROUND(SUM(""is_cancelled"")/COUNT(""is_cancelled""), 2) AS ""Cancellation Rate"" FROM (SELECT ""Client_Id"",""Driver_Id"",""status"",""Request_at"" AS ""Day"",CASE WHEN ""status"" LIKE '%cancelled%' THEN 1 ELSE 0 END AS ""is_cancelled"" FROM ""Trips"" AS ""t"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes')) AS ""sub"" GROUP BY ""Day"" ORDER BY ""Day"""
52,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""t"".""Driver_Id""=""u1"".""Users_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""t"".""Client_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY ""Request_at"" ORDER BY ""Request_at"""
53,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"" ORDER BY ""request_at"""
54,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 WHEN ""Status"" IN ('completed') THEN 0 END)/COUNT(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 WHEN ""Status"" IN ('completed') THEN 0 END), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_ID"" IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Driver_ID"" IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='No') AND ""Request_at""<'2013-10-04' GROUP BY ""Request_at"""
55,"SELECT DISTINCT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN LOWER(""Status"") LIKE '%cancel%' THEN 1 ELSE NULL END)/COUNT(""Status""), 2) AS ""Cancellation Rate"" FROM (""trips"" LEFT JOIN ""users"" ON ""Client_Id""=""Users_Id"" AND ""Role""='client') LEFT JOIN ""users"" AS ""u2"" ON ""Driver_Id""=""u2"".""Users_Id"" AND ""u2"".""Role""='driver' WHERE ""users"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
56,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
57,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 WHEN ""Status"" IN ('completed') THEN 0 END)/COUNT(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 WHEN ""Status"" IN ('completed') THEN 0 END), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_ID"" IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Driver_ID"" IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='No') AND ""Request_at""<'2013-10-04' GROUP BY ""Request_at"""
58,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
59,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""t"".""Status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""t"".""Client_ID""=""c"".""Users_ID"" AND ""c"".""Banned""='No') JOIN ""Users"" AS ""d"" ON ""t"".""Driver_ID""=""d"".""Users_ID"" AND ""d"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
60,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Trips"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" JOIN ""users"" AS ""cust"" ON (""cust"".""Users_Id""=""Trips"".""Client_Id"")) JOIN ""users"" AS ""driver"" ON (""driver"".""Users_Id""=""Trips"".""Driver_Id"") WHERE ""cust"".""Banned""='No' AND ""driver"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
61,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""t"".""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END), 2) AS ""Cancellation Rate"" FROM ""trips"" AS ""t"" WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""t"".""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') GROUP BY 1"
62,"SELECT ""t1"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN ""Id"" END)*1.0/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t1"" JOIN ""Users"" AS ""t2"" ON ""t1"".""Client_Id""=""t2"".""Users_Id"" AND ""t2"".""Banned""='No') JOIN ""Users"" AS ""t3"" ON ""t1"".""Driver_Id""=""t3"".""Users_Id"" AND ""t3"".""Banned""='No' WHERE ""t1"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t1"".""Request_at"""
63,"WITH ""cte"" AS (SELECT ""id"",""Status"",""Request_at"" FROM ""trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" NOT IN (SELECT DISTINCT ""Users_Id"" FROM ""users"" WHERE ""banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT DISTINCT ""Users_Id"" FROM ""users"" WHERE ""banned""='Yes')) SELECT ""c"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""c"".""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""cte"" AS ""c"" GROUP BY ""c"".""Request_at"""
64,"WITH ""total_users"" AS (SELECT ""request_at"",(CASE WHEN COUNT(1) IS NULL THEN 0 ELSE COUNT(1) END) AS ""total_trips"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes' AND ""Role""='client') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes' AND ""Role""='driver') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at""), ""total_cancelled"" AS (SELECT ""t1"".""request_at"",SUM(CASE WHEN ""t1"".""status""!='completed' THEN 1 ELSE 0 END) AS ""total_can"" FROM ""Trips"" AS ""t1"" WHERE ""t1"".""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes' AND ""Role""='client') AND ""t1"".""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes' AND ""Role""='driver') AND ""t1"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t1"".""request_at"") SELECT ""tu"".""request_at"" AS ""Day"",(CASE WHEN ""total_trips""=0 THEN 0.00 ELSE ROUND(""total_can""/""total_trips"", 2) END) AS ""Cancellation Rate"" FROM (""total_users"" AS ""tu"") CROSS JOIN ""total_cancelled"" AS ""tc"" WHERE ""tu"".""request_at""=""tc"".""request_at"" GROUP BY ""tu"".""request_at"" ORDER BY ""tu"".""request_at"""
65,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""Canceled_Count""/""T"".""Trip_Count"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE ""t"".""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""Canceled_Count"",COUNT(1) AS ""Trip_Count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at""<='2013-10-03' AND ""t"".""Request_at"">='2013-10-01') AS ""T"""
66,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u_client"" ON ""t"".""Client_Id""=""u_client"".""Users_Id"" AND ""u_client"".""Banned""='No') JOIN ""Users"" AS ""u_driver"" ON ""t"".""Driver_Id""=""u_driver"".""Users_Id"" AND ""u_client"".""Banned""='No' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY (""t"".""Request_at"") ORDER BY ""Day"""
67,"WITH ""filter"" AS (SELECT * FROM ""Trips"" WHERE ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""f"".""Request_at"" AS ""Day"",ROUND(COALESCE(""cancel_count"", 0)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""filter"" AS ""f"" LEFT JOIN (SELECT ""Request_at"",COUNT(1) AS ""cancel_count"" FROM ""filter"" WHERE ""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client' GROUP BY ""Request_at"") AS ""t"" ON ""f"".""Request_at""=""t"".""Request_at"" GROUP BY ""f"".""Request_at"""
68,"SELECT ""tt"".""Request_at"" AS ""Day"",COALESCE(ROUND((""cx"".""cancelled""/""tt"".""total""), 2), 0) AS ""Cancellation Rate"" FROM (SELECT COUNT(""t"".""Id"") AS ""total"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""t"".""Driver_Id""=""u"".""Users_id"") LEFT JOIN ""Users"" AS ""u2"" ON ""t"".""Client_Id""=""u2"".""Users_id"" WHERE ""u"".""Banned""!='Yes' AND ""u2"".""Banned""!='Yes' AND ""t"".""Request_at"">='2013-10-01' AND ""t"".""Request_at""<='2013-10-03' GROUP BY ""t"".""Request_at"") AS ""tt"" LEFT JOIN (SELECT COUNT(""t"".""Id"") AS ""cancelled"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""t"".""Driver_Id""=""u"".""Users_id"") LEFT JOIN ""Users"" AS ""u2"" ON ""t"".""Client_Id""=""u2"".""Users_id"" WHERE (""u"".""Banned""!='Yes' AND ""u2"".""Banned""!='Yes') AND (""t"".""Status""='cancelled_by_driver' OR ""t"".""Status""='cancelled_by_client') AND ""t"".""Request_at"">='2013-10-01' AND ""t"".""Request_at""<='2013-10-03' GROUP BY ""t"".""Request_at"") AS ""cx"" ON ""tt"".""Request_at""=""cx"".""Request_at"""
69,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""status""='cancelled_by_driver' OR ""t"".""status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" LEFT JOIN ""users"" AS ""u"" ON ""u"".""users_id""=""t"".""client_id"") LEFT JOIN ""users"" AS ""uu"" ON ""uu"".""users_id""=""t"".""driver_id"" WHERE ""u"".""Banned""!='Yes' AND ""uu"".""Banned""!='Yes' AND ""t"".""request_at"" BETWEEN '2013-09-30 23:59:59' AND '2013-10-03 23:59:59' GROUP BY ""t"".""request_at"""
70,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE '%cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""u"".""Users_Id""=""t"".""Client_Id"" AND ""u"".""Role""='client') LEFT JOIN ""Users"" AS ""s"" ON ""s"".""Users_Id""=""t"".""Driver_Id"" AND ""s"".""role""='driver' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""u"".""Banned""='No' AND ""s"".""Banned""='No' GROUP BY 1 ORDER BY 1"
71,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
72,"WITH ""u"" AS (SELECT * FROM ""users"" WHERE ""banned""='No') SELECT ""t"".""request_at"" AS ""Day"",CAST(SUM(CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END)/COUNT(1) AS DECIMAL(6, 2)) AS ""Cancellation Rate"" FROM ""trips"" AS ""t"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND EXISTS (SELECT 1 FROM ""u"" WHERE ""users_id""=""client_id"") AND EXISTS (SELECT 1 FROM ""u"" WHERE ""users_id""=""driver_id"") GROUP BY ""t"".""request_at"""
73,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
74,"SELECT ""RequestSum"".""Request_at"" AS ""Day"",ROUND((""RequestSum"".""Request""-""CompleteSum"".""Complete"")/""RequestSum"".""Request"", 2) AS ""Cancellation Rate"" FROM (SELECT ""Trips"".""Request_at"",COUNT(1) AS ""Request"" FROM ((""Trips"") CROSS JOIN ""Users"" AS ""Client"") CROSS JOIN ""Users"" AS ""Driver"" WHERE ""Trips"".""Client_Id""=""Client"".""Users_Id"" AND ""Trips"".""Client_Id""=""Driver"".""Users_Id"" AND ""Client"".""Banned""='No' AND ""Driver"".""Banned""='No' GROUP BY ""Trips"".""Request_at"") AS ""RequestSum"" CROSS, (SELECT ""Days"".""Request_at"",COALESCE(""Complete"", 0) AS ""Complete"" FROM (SELECT ""Request_at"" FROM ""Trips"" GROUP BY ""Request_at"") AS ""Days"" LEFT JOIN (SELECT ""Trips"".""Request_at"",COUNT(1) AS ""Complete"" FROM ((""Trips"") CROSS JOIN ""Users"" AS ""Client"") CROSS JOIN ""Users"" AS ""Driver"" WHERE ""Trips"".""Client_Id""=""Client"".""Users_Id"" AND ""Trips"".""Client_Id""=""Driver"".""Users_Id"" AND ""Client"".""Banned""='No' AND ""Driver"".""Banned""='No' AND ""Trips"".""Status""='completed' GROUP BY ""Trips"".""Request_at"") AS ""CompCnt"" ON ""Days"".""Request_at""=""CompCnt"".""Request_at"") AS ""CompleteSum"" WHERE ""RequestSum"".""Request_at""=""CompleteSum"".""Request_at"" AND ""RequestSum"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
75,"SELECT ""request_at"" AS ""Day"",ROUND(""cancel""/""total"", 2) AS ""Cancellation Rate"" FROM (SELECT ""request_at"",COUNT(1) AS ""total"",SUM(CASE WHEN ""status""='completed' THEN 0 ELSE 1 END) AS ""cancel"" FROM (""trips"" JOIN ""users"" AS ""u1"" ON ""client_id""=""u1"".""users_id"") JOIN ""users"" AS ""u2"" ON ""driver_id""=""u2"".""users_id"" WHERE ""u1"".""banned""='No' AND ""u2"".""banned""='No' GROUP BY ""request_at"") AS ""sub"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
76,"WITH ""temp"" AS (SELECT ""t"".* FROM (""Trips"" AS ""t"" JOIN (SELECT * FROM ""Users"" WHERE ""Role""='client') AS ""c"" ON ""c"".""Users_Id""=""t"".""Client_ID"") JOIN (SELECT * FROM ""Users"" WHERE ""Role""='driver') AS ""d"" ON ""t"".""Driver_Id""=""d"".""Users_id"" WHERE ""c"".""Banned""='NO' AND ""d"".""Banned""='No'), ""temp2"" AS (SELECT ""t"".*,CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 WHEN ""Status"" IN ('completed') THEN 0 END AS ""is_cancelled"" FROM ""temp"" AS ""t"") SELECT ""Request_at"" AS ""day"",ROUND(SUM(""is_cancelled"")/COUNT(""is_cancelled""), 2) AS ""Cancellation Rate"" FROM ""temp2"" WHERE ""Request_at"">=DATE('2013-10-01') AND ""Request_at""<=DATE('2013-10-03') GROUP BY ""Request_at"""
77,"SELECT ""T"".""Request_at"" AS ""Day"",(ROUND(SUM(CASE WHEN ""T"".""Status""='completed' THEN 0 ELSE 1 END)/COUNT(1), 2)) AS ""Cancellation Rate"" FROM ""Trips"" AS ""T"" JOIN ""Users"" AS ""U"" ON (""T"".""Client_Id""=""U"".""Users_Id"") WHERE ""T"".""Request_at"">='2013-10-01' AND ""T"".""Request_at""<='2013-10-03' AND ""U"".""Banned""='No' GROUP BY ""T"".""Request_at"""
78,"WITH ""CTE_unbanned_users"" AS (SELECT * FROM ""USERS"" WHERE ""BANNED"" LIKE 'NO'), ""CTE_CANCELLED_client"" AS (SELECT * FROM ""TRIPS"" WHERE ""STATUS"" LIKE '%cancelled%') SELECT ""t1"".""Request_at"" AS ""Day"",ROUND(COUNT(CAST(""T4"".""STATUS"" AS DECIMAL(9, 2)))/COUNT(CAST(""T1"".""STATUS"" AS DECIMAL(9, 2))), 2) AS ""Cancellation Rate"" FROM ((""TRIPS"" AS ""T1"" LEFT JOIN ""CTE_UNBANNED_USERS"" AS ""t2"" ON ""t1"".""client_id""=""t2"".""users_id"") LEFT JOIN ""CTE_UNBANNED_USERS"" AS ""T3"" ON ""T1"".""DRIVER_ID""=""T3"".""users_id"") LEFT JOIN ""CTE_CANCELLED_client"" AS ""t4"" ON ""t4"".""Id""=""t1"".""ID"" WHERE ""T2"".""BANNED"" LIKE 'NO' AND ""T1"".""REQUEST_AT"">='2013-10-01' AND ""t1"".""request_at""<='2013-10-03' AND ""t3"".""banned"" LIKE 'NO' GROUP BY ""t1"".""request_at"""
79,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
80,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""c"".""Users_Id""=""t"".""Client_Id"" AND ""c"".""Banned""='No') JOIN ""Users"" AS ""d"" ON ""d"".""Users_Id""=""t"".""Driver_Id"" AND ""d"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Day"""
81,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
82,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(""t"".""cancel""/""t"".""total"", 2) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"",COUNT(1) AS ""total"",SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END) AS ""cancel"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"") AS ""t"""
83,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_Id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Driver_Id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
84,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
85,"SELECT ""Day"",ROUND(COUNT(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (SELECT ""t"".""id"",""t"".""request_at"" AS ""Day"",""t"".""status"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""dataset"" GROUP BY ""DAY"" ORDER BY ""DAY"""
86,"WITH ""cte1"" AS (SELECT ""T"".""Id"",""Client_id"",""Driver_Id"",""City_Id"",""Status"",""Request_at"",""Banned"" FROM ""Trips"" AS ""T"" JOIN ""Users"" AS ""U"" ON ""T"".""Client_Id""=""U"".""Users_Id""), ""cte2"" AS (SELECT ""T"".""Id"",""Client_id"",""Driver_Id"",""City_Id"",""Status"",""Request_at"",""Banned"" FROM ""Trips"" AS ""T"" JOIN ""Users"" AS ""U"" ON ""T"".""Driver_Id""=""U"".""Users_Id""), ""cte3"" AS (SELECT * FROM (SELECT ""cte1"".""Id"",""cte1"".""Client_id"",""cte1"".""Driver_Id"",""cte1"".""Status"",""cte1"".""Request_at"",""cte1"".""Banned"" AS ""Client_banned"",""cte2"".""Banned"" AS ""Driver_banned"" FROM ""cte1"" JOIN ""cte2"" ON ""cte1"".""id""=""cte2"".""id"") AS ""x"" WHERE ""Client_banned""='No' AND ""Driver_banned""='No'), ""cte4"" AS (SELECT DISTINCT ""Request_at"",COUNT(""Id"") OVER (PARTITION BY ""Request_at"") AS ""tot"" FROM ""cte3""), ""cte5"" AS (SELECT DISTINCT ""Request_at"",COUNT(""Id"") OVER (PARTITION BY ""Request_at"") AS ""cancelled"" FROM (SELECT ""Id"",""Status"",""Request_at"" FROM ""cte3"" WHERE ""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client') AS ""z"") SELECT ""Request_at"" AS ""Day"",ROUND(""cancelled""/""tot"", 2) AS ""Cancellation Rate"" FROM (SELECT ""cte4"".""Request_at"",COALESCE(""cancelled"", 0) AS ""cancelled"",""tot"" FROM ""cte4"" LEFT JOIN ""cte5"" ON ""cte4"".""Request_at""=""cte5"".""Request_at"") AS ""z"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
87,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Trips"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" JOIN ""users"" AS ""cust"" ON (""cust"".""Users_Id""=""Trips"".""Client_Id"")) JOIN ""users"" AS ""driver"" ON (""driver"".""Users_Id""=""Trips"".""Driver_Id"") WHERE ""cust"".""Banned""='No' AND ""driver"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
88,"WITH ""t"" AS (SELECT ""id"",""request_at"",""banned"",""status"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""u"".""users_id""=""t"".""client_id"" AND ""banned""='No' WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03'), ""t1"" AS (SELECT ""id"",""request_at"",""banned"",""status"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""u"".""users_id""=""t"".""driver_id"" AND ""banned""='No' WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Day"",CAST(""canceled""/""all_reqs"" AS DECIMAL(6, 2)) AS ""Cancellation Rate"" FROM (SELECT ""t"".""request_at"" AS ""Day"",COUNT(1) AS ""all_reqs"",SUM(CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END) AS ""canceled"" FROM ""t"" JOIN ""t1"" ON ""t"".""id""=""t1"".""id"" GROUP BY ""t"".""request_at"") AS ""a"""
89,"WITH ""banned"" AS (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client ' THEN 1 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""banned"")) AND (""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""banned"")) AND ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' GROUP BY ""Request_at"""
90,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""Canceled_Count""/""T"".""Trip_Count"", 2) AS ""Cancellation Rate"" FROM (SELECT SUM(CASE ""t"".""Status"" WHEN 'completed' THEN 0 ELSE 1 END) AS ""Canceled_Count"",COUNT(1) AS ""Trip_Count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at""<='2013-10-03' AND ""t"".""Request_at"">='2013-10-01') AS ""T"""
91,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (SELECT ""t"".* FROM (""Users"" AS ""u1"" RIGHT JOIN ""Trips"" AS ""t"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03') AS ""unbanned_t"" GROUP BY ""Request_at"""
92,"SELECT ""Day"",CAST(FORMAT(""canceled_count""*1.0/""total"", 2) AS DECIMAL(10, 2)) AS ""Cancellation Rate"" FROM (SELECT ""a"".""Request_at"" AS ""Day"",SUM(1) AS ""total"",SUM(CASE WHEN ""a"".""Status""='completed' THEN 0 ELSE 1 END) AS ""canceled_count"" FROM (""Trips"" AS ""a"" LEFT JOIN ""Users"" AS ""b"" ON ""a"".""Client_Id""=""b"".""Users_Id"") LEFT JOIN ""Users"" AS ""c"" ON ""a"".""Driver_Id""=""c"".""Users_id"" WHERE ""b"".""Banned""='No' AND ""c"".""Banned""='No' AND ""a"".""Request_at"">='2013-10-01' AND ""a"".""Request_at""<='2013-10-03' GROUP BY ""a"".""Request_at"") AS ""tmp"""
93,"SELECT ""request_at"" AS ""day"",ROUND(COUNT(CASE WHEN ""status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""cancellation rate"" FROM ""trips"" WHERE (""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='no') GROUP BY ""request_at"""
94,"SELECT ""t"".""request_at"" AS ""Day"",CAST(SUM(CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END)/COUNT(1) AS DECIMAL(6, 2)) AS ""Cancellation Rate"" FROM ""trips"" AS ""t"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND EXISTS (SELECT 1 FROM ""users"" WHERE ""users_id""=""client_id"" AND ""banned""='No') AND EXISTS (SELECT 1 FROM ""users"" WHERE ""users_id""=""driver_id"" AND ""banned""='No') GROUP BY ""t"".""request_at"""
95,"WITH ""validTrips"" AS (SELECT ""Trips"".""id"",""status"",""request_at"" FROM (""Trips"" LEFT JOIN ""users"" AS ""driver"" ON ""driver"".""users_id""=""Trips"".""driver_id"") LEFT JOIN ""users"" AS ""client"" ON ""client"".""users_id""=""Trips"".""client_id"" WHERE ""client"".""banned""='No' AND ""driver"".""banned""='No') SELECT ""t"".""request_at"" AS ""Day"",ROUND(CASE WHEN ""c"".""count""/""t"".""count"" IS NULL THEN 0 ELSE ""c"".""count""/""t"".""count"" END, 2) AS ""Cancellation Rate"" FROM (SELECT ""request_at"",COUNT(1) AS ""count"" FROM ""validTrips"" GROUP BY ""request_at"") AS ""t"" LEFT JOIN (SELECT ""request_at"",COUNT(1) AS ""count"" FROM ""validTrips"" WHERE ""status""!='completed' GROUP BY ""request_at"") AS ""c"" ON ""t"".""request_at""=""c"".""request_at"" WHERE ""t"".""request_at""<='2013-10-03' AND ""t"".""request_at"">='2013-10-01'"
96,"WITH ""stg1"" AS (SELECT ""t"".*,""u1"".""banned"" AS ""client_banned"",""u2"".""banned"" AS ""driver_banned"" FROM (""trips"" AS ""t"" LEFT JOIN ""users"" AS ""u1"" ON (""t"".""client_id""=""u1"".""users_id"" AND ""u1"".""role""='client')) LEFT JOIN ""users"" AS ""u2"" ON (""t"".""driver_id""=""u2"".""users_id"" AND ""u2"".""role""='driver') WHERE ""u1"".""banned""='No' AND ""u2"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""request_at"" AS ""Day"",ROUND(CAST(SUM(CASE WHEN ""status""!='completed' THEN 1 ELSE 0 END) AS FLOAT)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""stg1"" GROUP BY ""request_at"" ORDER BY ""request_at"""
97,"SELECT ""t1"".""Request_at"" AS ""Day"",ROUND(COUNT(DISTINCT CASE WHEN ""t1"".""Status""!='completed' THEN ""t1"".""Id"" ELSE NULL END)/COUNT(DISTINCT ""t1"".""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t1"" JOIN (SELECT * FROM ""Users"" WHERE ""Banned""='No' AND ""role""='client') AS ""t2"" ON ""t1"".""client_id""=""t2"".""Users_Id"") JOIN (SELECT * FROM ""Users"" WHERE ""Banned""='No' AND ""role""='driver') AS ""t3"" ON ""t1"".""driver_id""=""t3"".""Users_Id"" AND ""t1"".""Request_at"">='2013-10-01' AND ""t1"".""Request_at""<='2013-10-03' GROUP BY 1 ORDER BY 1"
98,"SELECT ""Request_at"" AS ""DAY"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(""Status""), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
99,"SELECT DISTINCT ""t"".""request_at"" AS ""Day"",CAST(COUNT(CASE WHEN ""status"" LIKE 'cancelled%' THEN ""status"" ELSE NULL END) OVER (PARTITION BY ""request_at"")/CAST(COUNT(""request_at"") OVER (PARTITION BY ""request_at"") AS DECIMAL(10, 2)) AS DECIMAL(10, 2)) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""c"" ON ""t"".""client_id""=""c"".""users_id"") LEFT JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"" WHERE (""c"".""Banned""='No' AND ""d"".""banned""='No') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
100,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""u"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u"".""Users_id"" AND ""t"".""Driver_Id""=""u1"".""Users_id"" WHERE ""u"".""Banned""='No' AND ""u1"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Day"" ORDER BY ""Day"""
101,"SELECT DATE(""Request_at"") AS ""Day"",ROUND(COUNT(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN ""Id"" ELSE NULL END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM (SELECT ""t"".""Id"",""t"".""Client_Id"",""t"".""Driver_Id"",""t"".""Status"",""t"".""Request_at"",""u1"".""Banned"" AS ""Client_Banned"",""u2"".""Banned"" AS ""Driver_Banned"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""u1"".""Users_Id""=""t"".""Client_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""u2"".""Users_Id""=""Driver_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""tripData"" GROUP BY 1 ORDER BY 1"
102,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (SELECT * FROM ""Trips"" AS ""t"" WHERE ""t"".""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""Banned""='Yes' AND ""Role""='client') AND ""t"".""Driver_Id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""Banned""='Yes' AND ""Role""='driver') AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""newT"" GROUP BY ""request_at"""
103,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""status""='completed' THEN 0 ELSE 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u1"" ON (""u1"".""users_id""=""t"".""client_id"" AND ""u1"".""role""='client' AND ""u1"".""banned""='No')) JOIN ""users"" AS ""u2"" ON (""u2"".""users_id""=""t"".""driver_id"" AND ""u2"".""role""='driver' AND ""u2"".""banned""='No') GROUP BY 1 HAVING ""t"".""Request_at""<='2013-10-03' AND ""t"".""Request_at"">='2013-10-01'"
104,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
105,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
106,"WITH ""CTE_unbanned_users"" AS (SELECT * FROM ""USERS"" WHERE ""BANNED"" LIKE 'NO'), ""CTE_CANCELLED_client"" AS (SELECT * FROM ""TRIPS"" WHERE ""STATUS"" LIKE '%cancelled%') SELECT ""t1"".""Request_at"" AS ""Day"",ROUND(COUNT(CAST(""T4"".""STATUS"" AS DECIMAL(9, 2)))/COUNT(CAST(""T1"".""STATUS"" AS DECIMAL(9, 2))), 2) AS ""Cancellation Rate"" FROM ((""TRIPS"" AS ""T1"" LEFT JOIN ""CTE_UNBANNED_USERS"" AS ""t2"" ON ""t1"".""client_id""=""t2"".""users_id"") LEFT JOIN ""CTE_UNBANNED_USERS"" AS ""T3"" ON ""T1"".""DRIVER_ID""=""T3"".""users_id"") LEFT JOIN ""CTE_CANCELLED_client"" AS ""t4"" ON ""t4"".""Id""=""t1"".""ID"" WHERE ""T2"".""BANNED"" LIKE 'NO' AND ""T1"".""REQUEST_AT"">='2013-10-01' AND ""t1"".""request_at""<='2013-10-03' AND ""t3"".""banned"" LIKE 'NO' GROUP BY ""t1"".""request_at"""
107,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
108,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
109,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"") JOIN ""users"" AS ""x"" ON ""t"".""Driver_Id""=""x"".""Users_Id"" WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""u"".""banned""='No' AND ""x"".""banned""='No' GROUP BY ""t"".""Request_at"""
110,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""Canceled_Count""/""T"".""Trip_Count"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE ""t"".""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""Canceled_Count"",COUNT(1) AS ""Trip_Count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at""<='2013-10-03' AND ""t"".""Request_at"">='2013-10-01') AS ""T"""
111,"SELECT ""trips"".""request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""trips"".""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END), 2) AS ""Cancellation Rate"" FROM (""trips"" JOIN ""users"" AS ""driver_table"" ON ""trips"".""driver_id""=""driver_table"".""users_id"") JOIN ""users"" AS ""client_table"" ON ""trips"".""client_id""=""client_table"".""users_id"" WHERE ""driver_table"".""banned""='No' AND ""client_table"".""banned""='No' AND ""trips"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""trips"".""request_at"""
112,"WITH ""temp"" AS (SELECT ""a"".*,""b"".""Banned"" AS ""driver_banned"" FROM (SELECT ""t"".*,""u"".""Banned"" AS ""user_banned"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_id"") AS ""a"" JOIN ""Users"" AS ""b"" ON ""a"".""Driver_ID""=""b"".""Users_ID""), ""filtered"" AS (SELECT ""ID"",""Client_id"",""Driver_Id"",""City_Id"",""Status"",""Request_at"" AS ""Day"",""user_banned"",""driver_banned"" FROM ""temp"" WHERE ""user_banned""='No' AND ""driver_banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Day"",ROUND(SUM(CASE WHEN ""Status""='completed' THEN 0 ELSE 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""filtered"" GROUP BY ""Day"""
113,"WITH ""unbanned_users"" AS (SELECT ""a"".* FROM (""Trips"" AS ""a"" LEFT JOIN ""Users"" AS ""b"" ON ""a"".""Client_Id""=""b"".""Users_Id"" AND ""b"".""role""='Client') LEFT JOIN ""Users"" AS ""c"" ON ""a"".""Driver_Id""=""c"".""Users_Id"" AND ""c"".""role""='Driver' WHERE ""b"".""banned""='No' AND ""c"".""banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""unbanned_users"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
114,"SELECT ""request_at"" AS ""Day"",ROUND(1-COUNT(CASE WHEN ""status""='completed' THEN 1 ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='yes') AND ""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='yes') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
115,"SELECT ""Request_at"" AS ""day"",ROUND(SUM(CASE WHEN ""status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
116,"WITH ""merged"" AS (SELECT ""t"".* FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""Banned""='No'), ""not_banned"" AS (SELECT ""t"".* FROM ""merged"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Driver_Id""=""u"".""Users_Id"" AND ""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""not_banned"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
117,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END)/COUNT(""t"".""status""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""t"".""client_id""=""u1"".""users_id"") JOIN ""Users"" AS ""u2"" ON ""t"".""driver_id""=""u2"".""users_id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND (""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY 1"
118,"WITH ""cte"" AS (SELECT * FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE '%cancelled%' THEN 1 ELSE 0 END)/COUNT(""client_id""), 2) AS ""cancellation rate"" FROM ""cte"" GROUP BY ""request_at"""
119,"WITH ""cte"" AS (SELECT * FROM ""Trips"" WHERE ""Client_id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No' AND ""Role""='client') AND ""Driver_Id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No' AND ""Role""='driver') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""day"",ROUND(1-(SUM(CASE WHEN ""Status""='completed' THEN 1 ELSE 0 END)/COUNT(""Status"")), 2) AS ""Cancellation Rate"" FROM ""cte"" GROUP BY ""Request_at"""
120,"WITH ""base"" AS (SELECT ""a"".* FROM (""Trips"" AS ""a"" JOIN (SELECT * FROM ""Users"" WHERE ""Role""='client' AND ""Banned""='No') AS ""b"" ON ""a"".""Client_id""=""b"".""Users_id"") JOIN (SELECT * FROM ""Users"" WHERE ""Role""='driver' AND ""Banned""='No') AS ""c"" ON ""a"".""Driver_Id""=""c"".""Users_Id"") SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/SUM(1), 2) AS ""Cancellation Rate"" FROM ""base"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1 ORDER BY 1"
121,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (SELECT * FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes')) AS ""t2"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
122,"SELECT ""Day"",CAST(ROUND(SUM(""is_cancelled"")*1.0/COUNT(""is_cancelled""), 2) AS FLOAT) AS ""Cancellation Rate"" FROM (SELECT ""Client_Id"",""Driver_Id"",""status"",""Request_at"" AS ""Day"",CASE WHEN ""status"" LIKE '%cancelled%' THEN 1 ELSE 0 END AS ""is_cancelled"" FROM ""Trips"" AS ""t"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes')) AS ""sub"" GROUP BY ""Day"" ORDER BY ""Day"""
123,"SELECT ""a"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""a"".""Status""='completed' THEN 0 ELSE 1 END)/COUNT(""a"".""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""a"" JOIN ""Users"" AS ""b"" ON ""a"".""Client_Id""=""b"".""Users_Id"" AND ""b"".""Banned""='No') JOIN ""Users"" AS ""c"" ON ""a"".""Driver_Id""=""c"".""Users_Id"" AND ""c"".""Banned""='No' WHERE ""a"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""a"".""Request_at"""
124,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""id"" IN (SELECT ""t"".""id"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""c"" ON ""t"".""client_id""=""c"".""users_id"") JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""c"".""banned""='No' AND ""d"".""banned""='No') GROUP BY 1"
125,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""Banned""='No' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
126,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
127,"SELECT ""BIGN"".""request_at"" AS ""Day"",CASE WHEN ""n""/""bign"" IS NULL THEN 0.00 ELSE ROUND(""n""/""bign"", 2) END AS ""Cancellation Rate"" FROM (SELECT COUNT(DISTINCT ""id"") AS ""n"",""request_at"" FROM (SELECT ""cl"".* FROM (SELECT ""a"".* FROM ""trips"" AS ""a"" JOIN ""users"" AS ""b"" ON ""a"".""client_id""=""b"".""users_id"" WHERE ""b"".""banned""='No' AND ""b"".""role""='client') AS ""cl"" JOIN ""users"" AS ""d"" ON ""cl"".""driver_id""=""d"".""users_id"" WHERE ""d"".""banned""='No' AND ""d"".""role""='driver') AS ""allr"" WHERE ""Status""!='completed' GROUP BY ""request_at"") AS ""cancel"" RIGHT JOIN (SELECT COUNT(DISTINCT ""id"") AS ""bign"",""request_at"" FROM (SELECT ""cl"".* FROM (SELECT ""a"".* FROM ""trips"" AS ""a"" JOIN ""users"" AS ""b"" ON ""a"".""client_id""=""b"".""users_id"" WHERE ""b"".""banned""='No' AND ""b"".""role""='client') AS ""cl"" JOIN ""users"" AS ""d"" ON ""cl"".""driver_id""=""d"".""users_id"" WHERE ""d"".""banned""='No' AND ""d"".""role""='driver' AND ""cl"".""request_at"" IN ('2013-10-01','2013-10-02','2013-10-03')) AS ""allr"" GROUP BY ""request_at"") AS ""bign"" ON ""cancel"".""request_at""=""bign"".""request_at"""
128,"SELECT ""T2"".""Request_at"" AS ""Day"",ROUND(COUNT(""T1"".""Id"")/COUNT(""T2"".""Id""), 2) AS ""Cancellation Rate"" FROM (SELECT * FROM ""Users"" JOIN ""Trips"" ON ""Users"".""Users_Id""=""Trips"".""Client_Id"" WHERE ""Banned""='No' AND ""Status"" LIKE 'cancelled%' AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03') AS ""T1"" RIGHT JOIN (SELECT * FROM ""Users"" JOIN ""Trips"" ON ""Users"".""Users_Id""=""Trips"".""Client_Id"" WHERE ""Banned""='No' AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03') AS ""T2"" ON ""T1"".""Id""=""T2"".""Id"" GROUP BY ""T2"".""Request_at"""
129,"WITH ""users"" AS (SELECT DISTINCT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes'), ""sai"" AS (SELECT ""Request_at"",COUNT(CASE WHEN (""Client_Id"" NOT IN (SELECT ""Users_id"" FROM ""Users"")) AND (""driver_id"" NOT IN (SELECT ""Users_id"" FROM ""Users"")) THEN 1 END) AS ""count_unbanned_rides"",COUNT(CASE WHEN (""Client_Id"" NOT IN (SELECT ""Users_id"" FROM ""Users"")) AND (""driver_id"" NOT IN (SELECT ""Users_id"" FROM ""Users"")) AND (""Trips"".""Status"" LIKE '%cancelled%') THEN 1 END) AS ""cancelled_trips"" FROM ""Trips"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"") SELECT ""Request_at"" AS ""Day"",ROUND(""cancelled_trips""/""count_unbanned_rides"", 2) AS ""Cancellation Rate"" FROM ""sai"""
130,"SELECT ""Request_at"" AS ""Day"",ROUND(CASE COUNT(""Id"") WHEN 0 THEN 0 ELSE SUM(""Status""!='completed')/COUNT(""Id"") END, 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03' GROUP BY ""Request_at"""
131,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""c"".""Users_Id""=""t"".""Client_Id"" AND ""c"".""Banned""='No') JOIN ""Users"" AS ""d"" ON ""d"".""Users_Id""=""t"".""Driver_Id"" AND ""d"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Day"""
132,"SELECT ""Day"",ROUND(""s"", 2) AS ""Cancellation Rate"" FROM (SELECT ""request_at"" AS ""Day"",COUNT(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 END) OVER (PARTITION BY ""request_at"")/COUNT(1) OVER (PARTITION BY ""request_at"") AS ""s"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" AND ""u"".""banned""='No') JOIN ""users"" AS ""s"" ON ""t"".""driver_id""=""s"".""users_id"" AND ""s"".""banned""='No' WHERE ""request_at""<='2013-10-03') AS ""a"" GROUP BY 1"
133,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client' THEN 1 ELSE 0 END), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""a"" ON ""t"".""Client_Id""=""a"".""Users_Id"") LEFT JOIN ""Users"" AS ""b"" ON ""t"".""Driver_Id""=""b"".""Users_Id"" WHERE ""a"".""Banned""='No' AND ""b"".""Banned""='No' AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03' GROUP BY ""t"".""Request_at"""
134,"SELECT ""Request_at"" AS ""Day"",COALESCE(ROUND(SUM(CASE WHEN ""Status""='completed' THEN 0 ELSE 1 END)/COUNT(1), 2), 0) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"" ORDER BY ""Request_at"""
135,"SELECT ""tb1"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""tb1"".""Status""='completed' THEN 0 ELSE 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""tb1"" JOIN ""Users"" AS ""tb2"" ON ""tb1"".""Client_Id""=""tb2"".""Users_Id"" AND ""tb2"".""Banned""='No') JOIN ""Users"" AS ""tb3"" ON ""tb1"".""Driver_Id""=""tb3"".""Users_Id"" AND ""tb3"".""Banned""='No' WHERE ""tb1"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""tb1"".""Request_at"" ORDER BY ""Day"""
136,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""='completed' THEN 0 ELSE 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""Banned""='No' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
137,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" LEFT JOIN ""Users"" AS ""U1"" ON ""Trips"".""Client_Id""=""U1"".""Users_Id"") LEFT JOIN ""Users"" AS ""U2"" ON ""Trips"".""Driver_Id""=""U2"".""Users_Id"" WHERE ""U1"".""Banned""='No' AND ""U2"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"" ORDER BY ""Request_at"""
138,"WITH ""stats"" AS (SELECT ""Request_at"",""T"".""Status""!='completed' AS ""IsCancelled"" FROM (""Trips"" AS ""T"" JOIN ""Users"" AS ""C"" ON (""Client_Id""=""C"".""Users_Id"" AND ""C"".""Banned""='No')) JOIN ""Users"" AS ""D"" ON (""Driver_Id""=""D"".""Users_Id"" AND ""D"".""Banned""='No') WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",ROUND(CAST(SUM(""IsCancelled"") AS DOUBLE)/CAST(COUNT(1) AS DOUBLE), 2) AS ""Cancellation Rate"" FROM ""stats"" GROUP BY ""Request_at"""
139,"WITH ""nb"" AS (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No'), ""tr"" AS (SELECT * FROM ""trips"" WHERE ""client_id"" IN (SELECT * FROM ""nb"") AND ""driver_id"" IN (SELECT * FROM ""nb"") AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""day"",ROUND(COUNT(CASE WHEN ""status"" LIKE 'cancelled_by_%' THEN 1 ELSE NULL END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""tr"" GROUP BY ""Request_at"""
140,"SELECT ""Request_at"" AS ""Day"",CAST((SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1)) AS DECIMAL(10, 2)) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""banned""='Yes') GROUP BY ""Request_at"""
141,"WITH ""total_non_banned"" AS (SELECT ""t"".""id"",""t"".""Status"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"") JOIN ""users"" AS ""c"" ON ""t"".""client_id""=""c"".""users_id"" WHERE ""d"".""banned""='No' AND ""c"".""banned""='No') SELECT ""t2"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t2"".""status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 END)/COUNT(""t2"".""id""), 2) AS ""Cancellation Rate"" FROM ""total_non_banned"" AS ""t2"" WHERE ""t2"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t2"".""Request_at"""
142,"WITH ""requests_counts"" AS (SELECT ""t"".""Request_at"",""t"".""Status"",COUNT(1) AS ""counts"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""ut"" ON ""t"".""Client_id""=""ut"".""Users_id"" AND ""ut"".""Banned""='No') JOIN ""Users"" AS ""ut2"" ON ""t"".""Driver_id""=""ut2"".""Users_Id"" AND ""ut2"".""Banned""='No' GROUP BY ""t"".""Request_at"",""t"".""Status"") SELECT ""Request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN ""counts"" ELSE 0 END)/SUM(""counts"")), 2) AS ""Cancellation Rate"" FROM ""requests_counts"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Day"" ORDER BY ""Day"""
143,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""t"".""Status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""t"".""Client_ID""=""c"".""Users_ID"" AND ""c"".""Banned""='No') JOIN ""Users"" AS ""d"" ON ""t"".""Driver_ID""=""d"".""Users_ID"" AND ""d"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
144,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""='completed' THEN 0 ELSE 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""Banned""='No' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
145,"SELECT DISTINCT ""t"".""request_at"" AS ""Day"",CAST(CAST(SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END) OVER (PARTITION BY ""request_at"") AS DECIMAL(10, 2))/CAST(COUNT(""request_at"") OVER (PARTITION BY ""request_at"") AS DECIMAL(10, 2)) AS DECIMAL(10, 2)) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""c"" ON ""t"".""client_id""=""c"".""users_id"") LEFT JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"" WHERE (""c"".""Banned""='No' AND ""d"".""banned""='No') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
146,"SELECT ""Request_at"" AS ""day"",ROUND(SUM(CASE WHEN ""T"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""T"".""id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""T"" JOIN ""Users"" AS ""U1"" ON ""T"".""Client_Id""=""U1"".""Users_Id"") JOIN ""Users"" AS ""U2"" ON ""T"".""Driver_Id""=""U2"".""Users_Id"" WHERE ""U1"".""Banned""='No' AND ""U2"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
147,"SELECT ""a"".""request_at"" AS ""Day"",ROUND(COUNT(DISTINCT (CASE WHEN ""a"".""Status""!='completed' THEN ""a"".""id"" ELSE NULL END))/COUNT(DISTINCT ""a"".""id""), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""a"" JOIN (SELECT * FROM ""users"" WHERE ""banned""='No' AND ""Role"" IN ('client')) AS ""b"" ON ""a"".""client_id""=""b"".""users_id"") JOIN (SELECT * FROM ""users"" WHERE ""banned""='No' AND ""Role"" IN ('driver')) AS ""c"" ON ""a"".""driver_id""=""c"".""users_id"" WHERE ""a"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
148,"SELECT ""request_at"" AS ""day"",ROUND(COUNT(CASE WHEN ""status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""cancellation rate"" FROM ""trips"" WHERE (""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='yes') GROUP BY ""request_at"""
149,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""Status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') GROUP BY ""Request_at"""
150,"SELECT ""Day"",ROUND(SUM(""is_cancelled"")/COUNT(""is_cancelled""), 2) AS ""Cancellation Rate"" FROM (SELECT ""Client_Id"",""Driver_Id"",""status"",""Request_at"" AS ""Day"",CASE WHEN ""status"" LIKE '%cancelled%' THEN 1 ELSE 0 END AS ""is_cancelled"" FROM ""Trips"" AS ""t"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes')) AS ""sub"" GROUP BY ""Day"" ORDER BY ""Day"""
151,"WITH ""active_users"" AS (SELECT ""Users_Id"",""Role"" FROM ""Users"" WHERE ""Banned""='NO'), ""active_clients"" AS (SELECT ""Users_Id"" FROM ""active_users"" WHERE ""Role""='client'), ""active_drivers"" AS (SELECT ""Users_id"" FROM ""active_users"" WHERE ""Role""='driver') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""active_clients"" AS ""ac"" ON ""t"".""Client_Id""=""ac"".""Users_Id"") JOIN ""active_drivers"" AS ""ad"" ON ""t"".""Driver_Id""=""ad"".""Users_Id"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
152,"SELECT ""sub"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""sub"".""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(""Request_at""), 2) AS ""Cancellation Rate"" FROM (SELECT * FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes')) AS ""sub"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
153,"SELECT ""request_at"" AS ""day"",ROUND(SUM(""status"" LIKE '%cancelled%')/COUNT(1), 2) AS ""cancellation rate"" FROM ""trips"" AS ""t"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') GROUP BY 1 ORDER BY 1"
154,"WITH ""users"" AS (SELECT DISTINCT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes'), ""cancellations"" AS (SELECT ""Request_at"",COUNT(CASE WHEN ((""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""users"")) AND (""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""users""))) THEN 1 END) AS ""count_unbanned_rides"",COUNT(CASE WHEN (""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""users"")) AND (""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""users"")) AND ""Status"" LIKE '%cancelled%' THEN 1 END) AS ""cancelled_trips"" FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"") SELECT ""Request_at"" AS ""Day"",ROUND(""cancelled_trips""/""count_unbanned_rides"", 2) AS ""Cancellation Rate"" FROM ""cancellations"""
155,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""Banned""='No' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
156,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""a"" JOIN ""Users"" AS ""b"" ON ""a"".""Client_Id""=""b"".""Users_Id"" AND ""b"".""Banned""='No') JOIN ""Users"" AS ""c"" ON ""a"".""Driver_Id""=""c"".""Users_Id"" AND ""c"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
157,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(""status""!='completed')/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""day"" ORDER BY ""day"""
158,"WITH ""cte"" AS (SELECT *,DENSE_RANK() OVER (PARTITION BY ""t"".""Request_at"", ""t"".""status"" ORDER BY ""t"".""Request_at"") AS ""rank_num"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_id""=""u"".""Users_id"" WHERE ""t"".""Request_at"">='2013-10-01' AND ""t"".""Request_at""<='2013-10-03' AND ""u"".""Banned""='No') SELECT ""c1"".""Request_at"" AS ""Day"",ROUND((SELECT COUNT(1) FROM ""cte"" AS ""c2"" WHERE ""c2"".""Status""!='completed' AND ""c1"".""Request_at""=""c2"".""Request_at"")/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""cte"" AS ""c1"" GROUP BY ""c1"".""Request_at"""
159,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""t"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(1)), 2) AS ""Cancellation Rate"" FROM (SELECT ""t1"".""Client_Id"",""t1"".""Status"",""t1"".""Request_at"",""u1"".""Banned"" FROM ""Trips"" AS ""t1"" JOIN ""Users"" AS ""u1"" ON ""u1"".""Users_Id""=""t1"".""Client_Id"") AS ""t"" WHERE ""t"".""banned""!='Yes' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
160,"WITH ""base"" AS (SELECT * FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""Status"" LIKE '%cancelled%' THEN 1 ELSE 0 END)/SUM(1)), 2) AS ""Cancellation Rate"" FROM ""base"" GROUP BY 1"
161,"WITH ""c"" AS (SELECT ""Id"",""Client_Id"",""Driver_Id"",""City_Id"",""Status"",""Request_at"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes' AND ""Role""='client') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes' AND ""Role""='driver') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",COALESCE(ROUND(ROUND(""can"", 2)/""total"", 2), 0) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"",SUM(CASE WHEN ""status""='cancelled_by_driver' OR ""status""='cancelled_by_client' THEN 1 ELSE 0 END) AS ""can"",COUNT(1) AS ""total"" FROM ""c"" GROUP BY ""Request_at"") AS ""d"""
162,"WITH ""nb"" AS (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No'), ""tr"" AS (SELECT * FROM ""trips"" WHERE ""client_id"" IN (SELECT * FROM ""nb"") AND ""driver_id"" IN (SELECT * FROM ""nb"") AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""day"",ROUND(COUNT(CASE WHEN ""status"" LIKE 'cancelled_by_%' THEN 1 ELSE NULL END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""tr"" GROUP BY ""Request_at"""
163,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""Canceled_Count""/""T"".""Trip_Count"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE ""t"".""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""Canceled_Count"",COUNT(1) AS ""Trip_Count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at""<='2013-10-03' AND ""t"".""Request_at"">='2013-10-01') AS ""T"""
164,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""cancellation_flag"")/COUNT(""cancellation_flag""), 2) AS ""Cancellation Rate"" FROM (SELECT ""Client_Id"",""Driver_Id"",""t"".""Request_at"",CASE WHEN ""t"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END AS ""cancellation_flag"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""u1"".""Users_Id""=""t"".""Client_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""u2"".""Users_Id""=""t"".""Driver_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""u1"".""Role"" IN ('client','driver')) AS ""a"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
165,"WITH ""users"" AS (SELECT ""users_id"",""role"" FROM ""users"" WHERE ""banned""='No'), ""trips"" AS (SELECT ""id"",""request_at"",""status"",""client_id"",""driver_id"" FROM ""trips"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03'), ""completed_trips"" AS (SELECT ""id"",""status"",""request_at"" FROM (""trips"" LEFT JOIN ""users"" AS ""clients"" ON ""trips"".""client_id""=""clients"".""users_id"" AND ""clients"".""role""='client') LEFT JOIN ""users"" AS ""drivers"" ON ""trips"".""driver_id""=""drivers"".""users_id"" AND ""drivers"".""role""='driver' WHERE ""clients"".""users_id"" IS NOT NULL AND ""drivers"".""users_id"" IS NOT NULL), ""cancelled_trips"" AS (SELECT ""request_at"" AS ""day"",COUNT(DISTINCT CASE WHEN ""status"" IN ('cancelled_by_driver','cancelled_by_client') THEN ""id"" END) AS ""cancelled_trips"",COUNT(DISTINCT ""id"") AS ""all_trips"" FROM ""completed_trips"" GROUP BY 1) SELECT ""day"",ROUND(""cancelled_trips""/""all_trips"", 2) AS ""Cancellation Rate"" FROM ""cancelled_trips"" GROUP BY 1"
166,"SELECT ""total"".""Request_at"" AS ""Day"",COALESCE(CAST(""canceled""/""total"" AS DECIMAL(10, 2)), 0.00) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"",COUNT(""Id"") AS ""canceled"" FROM ""Trips"" WHERE ""Client_id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Status"" IN ('cancelled_by_driver','cancelled_by_client') GROUP BY ""Request_at"") AS ""canceled"" RIGHT JOIN (SELECT ""Request_at"",COUNT(""Id"") AS ""total"" FROM ""Trips"" WHERE ""Client_id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"") AS ""total"" ON ""canceled"".""Request_at""=""total"".""Request_at"" WHERE ""total"".""Request_at"">='2013-10-01' AND ""total"".""Request_at""<='2013-10-03'"
167,"SELECT ""request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""status""='cancelled_by_driver' AND ""u2"".""banned""='No' AND ""u1"".""banned""='No' THEN 1 WHEN ""status""='cancelled_by_client' AND ""u1"".""banned""='No' AND ""u2"".""banned""='No' THEN 1 ELSE 0 END)/(SUM(CASE WHEN ""u1"".""banned""='Yes' OR ""u2"".""banned""='Yes' THEN 0 ELSE 1 END))), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""users"" AS ""u1"" ON ""t"".""client_id""=""u1"".""users_id"") JOIN ""users"" AS ""u2"" ON ""u2"".""users_id""=""t"".""driver_id"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"" ORDER BY ""request_at"""
168,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(1-SUM(CASE WHEN ""t"".""Status""='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (SELECT * FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""t"" JOIN (SELECT * FROM ""Users"" WHERE ""Banned""='No') AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" GROUP BY ""t"".""Request_at"" ORDER BY ""t"".""Request_at"""
169,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""t"".""Client_ID"" NOT IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY 1"
170,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
171,"WITH ""unbanned"" AS (SELECT CASE WHEN ""t"".""Status"" LIKE '%cancelled%' THEN 1 ELSE 0 END AS ""status"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""t"".""Client_Id""=""c"".""Users_Id"") JOIN ""Users"" AS ""d"" ON ""t"".""Driver_Id""=""d"".""Users_Id"" WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""c"".""Banned""='No' AND ""d"".""Banned""='No') SELECT DATE(""Request_at"") AS ""Day"",ROUND(AVG(""status""), 2) AS ""Cancellation Rate"" FROM ""unbanned"" GROUP BY 1"
172,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Trips"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" JOIN ""users"" AS ""cust"" ON (""cust"".""Users_Id""=""Trips"".""Client_Id"")) JOIN ""users"" AS ""driver"" ON (""driver"".""Users_Id""=""Trips"".""Driver_Id"") WHERE ""cust"".""Banned""='No' AND ""driver"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
173,"SELECT ""t1"".""Request_at"" AS ""Day"",ROUND(COALESCE((""t2"".""canceled""/""t1"".""total""), 0), 2) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"",COUNT(1) AS ""total"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""d"" ON ""d"".""Users_Id""=""t"".""Driver_Id"") JOIN ""Users"" AS ""c"" ON ""c"".""Users_Id""=""t"".""Client_Id"" WHERE ""d"".""Banned""='No' AND ""c"".""Banned""='No' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"") AS ""t1"" LEFT JOIN (SELECT ""Request_at"",COUNT(1) AS ""canceled"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""d"" ON ""d"".""Users_Id""=""t"".""Driver_Id"") JOIN ""Users"" AS ""c"" ON ""c"".""Users_Id""=""t"".""Client_Id"" WHERE ""d"".""Banned""='No' AND ""c"".""Banned""='No' AND ""Status""!='completed' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"") AS ""t2"" ON ""t1"".""Request_at""=""t2"".""Request_at"""
174,"SELECT ""t1"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" NOT LIKE 'completed' THEN 1 ELSE 0 END)*1.0/COUNT(""t1"".""id""), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t1"") CROSS JOIN ""users"" AS ""t2"" WHERE ""t1"".""client_id""=""t2"".""users_id"" AND ""banned"" LIKE 'No' AND ""t1"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1 ORDER BY 1"
175,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COALESCE(SUM(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(""t"".""id""), 0), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" LEFT JOIN ""users"" AS ""u1"" ON ""t"".""client_id""=""u1"".""users_id"") LEFT JOIN ""users"" AS ""u2"" ON ""t"".""driver_id""=""u2"".""users_id"" WHERE ""u1"".""banned""='No' AND ""u2"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""request_at"""
176,"WITH ""unbanned"" AS (SELECT DISTINCT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(DISTINCT CASE WHEN ""Status""!='completed' THEN ""ID"" ELSE NULL END)/COUNT(DISTINCT ""ID""), 2) AS ""cancellation rate"" FROM ""TRIPS"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Driver_ID"" IN (SELECT ""Users_id"" FROM ""unbanned"") AND ""Client_ID"" IN (SELECT ""USERS_ID"" FROM ""unbanned"") GROUP BY ""Request_At"""
177,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE '%cancelled%' THEN 1 ELSE 0 END)/(COUNT(1)*1.0), 2) AS ""Cancellation Rate"" FROM ""trips"" AS ""tr"" LEFT JOIN ""users"" AS ""u"" ON ""tr"".""client_id""=""u"".""users_id"" WHERE ""banned""='No' AND ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' GROUP BY ""request_at"""
178,"WITH ""c"" AS (SELECT DISTINCT ""users_id"" FROM ""users"" WHERE ""banned""='Yes'), ""b"" AS (SELECT ""Request_at"" AS ""Day"",CASE WHEN ""Status"" LIKE 'cancelled_%' THEN 1 ELSE 0 END AS ""n_cancelled"" FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT * FROM ""c"")) SELECT ""Day"",ROUND(SUM(""n_cancelled"")/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""b"" WHERE ""Day"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Day"""
179,"WITH ""new"" AS (SELECT ""id"",""status"",""request_at"" FROM ""trips"" AS ""t"" LEFT JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" WHERE ""u"".""banned""='No'), ""rate"" AS (SELECT ""request_at"",COUNT(CASE WHEN ""status""='cancelled_by_driver' OR ""status""='cancelled_by_client' THEN 1 ELSE NULL END) AS ""cancelled"",COUNT(""new"".""id"") AS ""total"" FROM ""new"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"") SELECT ""rate"".""request_at"" AS ""Day"",ROUND(""cancelled""/""total"", 2) AS ""Cancellation Rate"" FROM ""rate"""
180,"SELECT ""request_at"" AS ""day"",ROUND(SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""request_at"" BETWEEN CAST('2013-10-01' AS DATE) AND CAST('2013-10-03' AS DATE) AND ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No' AND ""role""='client') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No' AND ""role""='driver') GROUP BY 1"
181,"SELECT ""tp"".""Request_at"" AS ""Day"",ROUND(((COUNT(CASE WHEN ""status""='cancelled_by_driver' OR ""status""='cancelled_by_client' THEN 1 ELSE NULL END))/(COUNT(""tp"".""Id""))), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""tp"" WHERE NOT EXISTS (SELECT 1 FROM ""Users"" AS ""us"" WHERE (""us"".""Banned""='Yes' AND ""us"".""Users_Id""=""tp"".""Client_Id"") OR (""us"".""Banned""='Yes' AND ""us"".""Users_Id""=""tp"".""Driver_Id"")) AND DATE(""tp"".""Request_at"") BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""tp"".""Request_at"""
182,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status""!='Completed' THEN 1 ELSE NULL END)/COUNT(""t"".""id""), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"") CROSS JOIN ""users"" AS ""u"" WHERE ""t"".""client_id""=""u"".""Users_id"" AND ""u"".""banned""='No' GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
183,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status""!='completed' THEN CASE WHEN ""ID"" IS NULL THEN 0 ELSE 1 END ELSE 0 END)/COUNT(""ID""), 2) AS ""Cancellation Rate"" FROM ""Trips"" LEFT JOIN ""Users"" ON ""Client_ID""=""Users_Id"" AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' WHERE ""Banned""='No' GROUP BY 1"
184,"SELECT ""request_at"" AS ""day"",ROUND((SUM(CASE WHEN ""status""='completed' THEN 0 ELSE 1 END)/COUNT(""status"")), 2) AS ""cancellation rate"" FROM (""trips"" JOIN ""users"" AS ""a"" ON ""client_id""=""a"".""users_id"" AND ""a"".""banned""='No') JOIN ""users"" AS ""b"" ON ""driver_id""=""b"".""users_id"" AND ""b"".""banned""='No' WHERE ""request_at"" BETWEEN DATE('2013-10-01') AND DATE('2013-10-03') GROUP BY ""request_at"""
185,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""T"".""Status""='cancelled_by_driver' OR ""T"".""Status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(""T"".""Status""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""T"" JOIN ""Users"" AS ""C"" ON ""T"".""Client_Id""=""C"".""Users_Id"") JOIN ""Users"" AS ""D"" ON ""T"".""Driver_ID""=""D"".""Users_Id"" WHERE ""C"".""Banned""='No' AND ""D"".""Banned""='No' AND ""T"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1 ORDER BY 1"
186,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND((COUNT(CASE WHEN ""t"".""status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1)), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
187,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"") JOIN ""Users"" AS ""d"" ON ""t"".""Driver_Id""=""d"".""Users_Id"" WHERE ""u"".""Banned""='No' AND ""d"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
188,"WITH ""unbanned"" AS (SELECT * FROM ""Users"" WHERE ""Banned""='No'), ""spes_date"" AS (SELECT * FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'), ""unbanned_status"" AS (SELECT ""Status"",""Request_at"" FROM ""spes_date"" WHERE ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""unbanned"" WHERE ""Role""='driver') AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""unbanned"" WHERE ""Role""='client')) SELECT ""Request_at"" AS ""Day"",ROUND(""Canceled""/""Total"", 2) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"",COUNT(""Status"") AS ""Total"",(SELECT COUNT(""Status"") FROM ""unbanned_status"" AS ""p2"" WHERE ""p2"".""Request_at""=""p1"".""Request_at"" AND ""Status"" LIKE '%cancelled%') AS ""Canceled"" FROM ""unbanned_status"" AS ""p1"" GROUP BY ""Request_at"") AS ""sub"""
189,"WITH ""cancelled_trip"" AS (SELECT ""Request_at"",COUNT(""id"") AS ""cancel_count"" FROM ""trips"" WHERE ""status"" IN ('cancelled_by_driver','cancelled_by_client') AND ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' AND ""driver_id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""role""='driver') AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""role""='client') GROUP BY 1), ""total_trips"" AS (SELECT ""Request_at"",COUNT(""id"") AS ""complete_count"" FROM ""trips"" WHERE ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' AND ""driver_id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""role""='driver') AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""role""='client') GROUP BY 1) SELECT ""a"".""Request_at"" AS ""Day"",ROUND(COALESCE(""cancel_count"", 0)/COALESCE(""complete_count"", 1), 2) AS ""Cancellation Rate"" FROM ""total_trips"" AS ""a"" LEFT JOIN ""cancelled_trip"" AS ""b"" ON ""a"".""Request_at""=""b"".""Request_at"""
190,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""T"".""status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""T"" WHERE ""T"".""Client_ID"" IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='No') AND ""T"".""Driver_Id"" IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='No') AND ""T"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""T"".""Request_at"""
191,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
192,"SELECT ""request_at"" AS ""day"",ROUND(COUNT(CASE WHEN ""status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""cancellation rate"" FROM ""trips"" WHERE (""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='yes') GROUP BY ""request_at"""
193,"WITH RECURSIVE ""valid_day"" AS (SELECT '2013-10-01' AS ""day"" UNION SELECT ""day"" + INTERVAL '1 DAY' FROM ""valid_day"" WHERE ""day""<'2013-10-03'), ""unbanned_client"" AS (SELECT ""id"",""status"",""request_at"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""users_id"" WHERE ""u"".""role""='client' AND ""u"".""banned""='no'), ""unbanned_driver"" AS (SELECT ""id"",""status"",""request_at"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""driver_Id""=""u"".""users_id"" WHERE ""u"".""role""='driver' AND ""u"".""banned""='no'), ""unbanned_id"" AS (SELECT ""uc"".""id"",""uc"".""status"",""uc"".""request_at"" FROM ""unbanned_client"" AS ""uc"" JOIN ""unbanned_driver"" AS ""ud"" ON ""uc"".""id""=""ud"".""id"" WHERE ""uc"".""request_at""<='2013-10-03' AND ""uc"".""request_at"">='2013-10-01') SELECT ""request_at"" AS ""day"",ROUND(SUM(CASE WHEN ""status""='cancelled_by_driver' OR ""status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""unbanned_id"" GROUP BY 1"
194,"WITH ""newTrips"" AS (SELECT * FROM ""Trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""banned""='Yes')) SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(""Request_at""), 2) AS ""Cancellation Rate"" FROM ""newTrips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
195,"SELECT ""a"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""a"".""status""!='completed' THEN ""a"".""id"" END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""a"" JOIN ""Users"" AS ""b"" ON ""a"".""Client_Id""=""b"".""Users_Id"") JOIN ""Users"" AS ""c"" ON ""a"".""Driver_id""=""c"".""Users_id"" WHERE ""a"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""b"".""Banned""='No' AND ""c"".""Banned""='No' GROUP BY ""a"".""Request_at"""
196,"WITH ""ubClient"" AS (SELECT ""Users_Id"" AS ""Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""Role""='client'), ""ubDriver"" AS (SELECT ""Users_Id"" AS ""Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""Role""='driver'), ""ubTrips"" AS (SELECT ""Trips"".""Status"" AS ""Status"",""Trips"".""Request_at"" AS ""Request_at"",COUNT(1) AS ""Count"" FROM (""Trips"" JOIN ""ubClient"" ON ""Trips"".""Client_Id""=""ubClient"".""Id"") JOIN ""ubDriver"" ON ""Trips"".""Driver_Id""=""ubDriver"".""Id"" GROUP BY ""Trips"".""Status"",""Trips"".""Request_at""), ""TotalubTrips"" AS (SELECT ""Request_at"" AS ""Request_at"",SUM(""Count"") AS ""TotalTrips"" FROM ""ubTrips"" GROUP BY ""Request_at""), ""CompleteubTrips"" AS (SELECT ""Request_at"" AS ""Request_at"",""Count"" AS ""CompleteTrips"" FROM ""ubTrips"" WHERE ""status""!='completed') SELECT ""TotalubTrips"".""Request_at"" AS ""Day"",ROUND(COALESCE(""CompleteTrips"", 0)/""TotalTrips"", 2) AS ""Cancellation Rate"" FROM ""TotalubTrips"" LEFT JOIN ""CompleteubTrips"" ON ""TotalubTrips"".""Request_at""=""CompleteubTrips"".""Request_at"" WHERE ""TotalubTrips"".""Request_at"">=CAST('2013-10-01' AS DATE) AND ""TotalubTrips"".""Request_at""<=CAST('2013-10-03' AS DATE)"
197,"SELECT ""Day"",ROUND(""count_of_cancel""/""count_of_total"", 2) AS ""Cancellation Rate"" FROM (SELECT ""t"".""Request_at"" AS ""Day"",COUNT(CASE WHEN ""t"".""Status""='cancelled_by_driver' OR ""t"".""Status""='cancelled_by_client' THEN 1 END) AS ""count_of_cancel"",COUNT(CASE WHEN ""t"".""Status""='cancelled_by_driver' OR ""t"".""Status""='cancelled_by_client' OR ""t"".""Status""='completed' THEN 1 END) AS ""count_of_total"" FROM ((""Trips"" AS ""t"") CROSS JOIN ""Users"" AS ""uc"") CROSS JOIN ""Users"" AS ""ud"" WHERE ""t"".""Client_Id""=""uc"".""Users_Id"" AND ""t"".""Driver_Id""=""ud"".""Users_Id"" AND ""uc"".""Banned""='No' AND ""ud"".""Banned""='No' AND ""uc"".""Role""='client' AND ""ud"".""Role""='driver' GROUP BY 1) AS ""sub"" WHERE ""Day"" IN ('2013-10-01','2013-10-02','2013-10-03')"
198,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON (""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""banned""='No')) JOIN ""users"" AS ""x"" ON (""t"".""Driver_Id""=""x"".""Users_Id"" AND ""x"".""banned""='No') WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
199,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""a"" JOIN ""Users"" AS ""b"" ON ""a"".""Client_Id""=""b"".""Users_id"" AND ""b"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
200,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE ('cancelled%') THEN 1 ELSE 0 END)/COUNT(""t"".""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u_c"" ON ""t"".""Client_Id""=""u_c"".""Users_Id"") LEFT JOIN ""Users"" AS ""u_d"" ON ""t"".""Driver_Id""=""u_d"".""Users_Id"" WHERE ""u_c"".""Banned""='No' AND ""u_d"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
201,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_Id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Driver_Id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
202,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') GROUP BY ""Request_at"""
203,"SELECT DISTINCT ""t"".""request_at"" AS ""Day"",CAST(SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END) OVER (PARTITION BY ""request_at"")/CAST(COUNT(""request_at"") OVER (PARTITION BY ""request_at"") AS DECIMAL(10, 2)) AS DECIMAL(10, 2)) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""c"" ON ""t"".""client_id""=""c"".""users_id"") LEFT JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"" WHERE (""c"".""Banned""='No' AND ""d"".""banned""='No') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
204,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status""='cancelled_by_driver' OR ""status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') GROUP BY 1"
205,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN LOWER(""status"") LIKE 'can%' THEN 1.00 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""Banned""='No') JOIN ""Users"" AS ""d"" ON ""t"".""Driver_Id""=""d"".""Users_Id"" AND ""d"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
206,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""Status""!='completed' THEN ""t"".""Id"" END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND (""u1"".""Banned""='No' AND ""u2"".""Banned""='No') GROUP BY ""Request_at"" ORDER BY ""Day"""
207,"WITH ""A"" AS (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No'), ""B"" AS (SELECT * FROM ""trips"" WHERE ""client_id"" IN (SELECT * FROM ""A"") AND ""driver_id"" IN (SELECT * FROM ""A"")), ""C"" AS (SELECT ""request_at"" AS ""request_at1"",COUNT(""request_at"") AS ""cnt1"" FROM ""B"" WHERE ""status""='cancelled_by_driver' OR ""status""='cancelled_by_client' GROUP BY ""request_at""), ""D"" AS (SELECT ""request_at"",COUNT(1) AS ""cnt"" FROM ""B"" GROUP BY ""request_at"") SELECT ""D"".""request_at"" AS ""Day"",ROUND(COALESCE(""C"".""cnt1""/""D"".""cnt"", 0), 2) AS ""cancellation rate"" FROM ""D"" LEFT JOIN ""C"" ON ""D"".""request_at""=""C"".""request_at1"" WHERE ""D"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
208,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""status""!='completed' THEN TRUE ELSE NULL END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03' GROUP BY ""Request_at"""
209,"SELECT ""Request_at"" AS ""Day"",ROUND((COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1)), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03' AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Role""='client' AND ""Banned""='No') AND ""Driver_Id"" IN (SELECT ""Driver_Id"" FROM ""Users"" WHERE ""Role""='driver' AND ""Banned""='No') GROUP BY ""Day"""
210,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""status""='completed' THEN 0 ELSE 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ((""Trips"" AS ""t"") CROSS JOIN ""Users"" AS ""u1"") CROSS JOIN ""Users"" AS ""u2"" WHERE ""t"".""Client_Id""=""u1"".""Users_id"" AND ""t"".""Driver_Id""=""u2"".""Users_id"" AND ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"" ORDER BY ""Request_at"""
211,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""Cancelled"")/COUNT(1), 2) AS ""Cancellation Rate"" FROM (SELECT ""t"".*,CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END AS ""Cancelled"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""t"".""Request_at"" IN ('2013-10-01','2013-10-02','2013-10-03')) AS ""unbanned_trips"" GROUP BY ""Day"""
212,"SELECT ""trips"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE 'cancelled_%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""trips"" JOIN ""users"" ON ""trips"".""client_id""=""users"".""users_id"" WHERE ""users"".""Banned""='No' AND (""trips"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY ""Request_at"""
213,"SELECT ""a"".""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""a"".""status""='cancelled_by_client' OR ""a"".""status""='cancelled_by_driver' THEN 1 ELSE 0 END)/COUNT(DISTINCT ""a"".""id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""a"" JOIN ""Users"" AS ""b"" ON ""a"".""Client_Id""=""b"".""Users_id"" AND ""b"".""Role""='client' AND ""b"".""Banned""='No') JOIN ""Users"" AS ""c"" ON ""a"".""Driver_Id""=""c"".""Users_Id"" AND ""c"".""Role""='driver' AND ""c"".""Banned""='No' WHERE ""a"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
214,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" LEFT JOIN ""Users"" AS ""U1"" ON ""Trips"".""Client_Id""=""U1"".""Users_Id"") LEFT JOIN ""Users"" AS ""U2"" ON ""Trips"".""Driver_Id""=""U2"".""Users_Id"" WHERE ""U1"".""Banned""='No' AND ""U2"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"" ORDER BY ""Request_at"""
215,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Trips"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" JOIN ""users"" AS ""cust"" ON (""cust"".""Users_Id""=""Trips"".""Client_Id"")) JOIN ""users"" AS ""driver"" ON (""driver"".""Users_Id""=""Trips"".""Driver_Id"") WHERE ""cust"".""Banned""='No' AND ""driver"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
216,"WITH ""TripsUnbanned"" AS (SELECT * FROM (SELECT * FROM (SELECT ""Id"",""Status"",""Client_Id"",""Driver_Id"",""Request_at"",""Client_Banned"" FROM ""Trips"" AS ""t1"" LEFT JOIN (SELECT ""Users_id"",""Banned"" AS ""Client_Banned"" FROM ""Users"" WHERE ""Role""='client') AS ""u1"" ON ""t1"".""Client_Id""=""u1"".""Users_id"") AS ""t2"" LEFT JOIN (SELECT ""Users_id"",""Banned"" AS ""Driver_Banned"" FROM ""Users"" WHERE ""Role""='driver') AS ""u2"" ON ""t2"".""Driver_Id""=""u2"".""Users_id"") AS ""t3"" WHERE ""Client_Banned""!='Yes' AND ""Driver_Banned""!='Yes'), ""totalcnt"" AS (SELECT ""Request_at"" AS ""Day"",COUNT(DISTINCT ""Id"") AS ""totalcnt"" FROM ""TripsUnbanned"" GROUP BY ""Request_at""), ""cancelcnt"" AS (SELECT ""Request_at"" AS ""Day"",COUNT(DISTINCT ""Id"") AS ""cancelcnt"" FROM ""TripsUnbanned"" WHERE ""Status""!='completed' GROUP BY ""Request_at"") SELECT ""t"".""Day"",COALESCE(ROUND(""cancelcnt""/""totalcnt"", 2), 0) AS ""Cancellation Rate"" FROM ""totalcnt"" AS ""t"" LEFT JOIN ""cancelcnt"" AS ""c"" ON ""t"".""Day""=""c"".""Day"" WHERE ""t"".""Day"">='2013-10-01' AND ""t"".""Day""<='2013-10-03'"
217,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (SELECT *,(CASE WHEN ""Driver_Id"" IN (SELECT DISTINCT (""Users_Id"") FROM ""Users"" WHERE ""Banned""='Yes') THEN 1 WHEN ""Client_Id"" IN (SELECT DISTINCT (""Users_Id"") FROM ""Users"" WHERE ""Banned""='Yes') THEN 1 ELSE 0 END) AS ""i_exclude"" FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""main_table"" WHERE ""i_exclude""=0 GROUP BY 1 ORDER BY 1"
218,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status"" LIKE 'cancelled_%' THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""users"" AS ""cu"" ON ""t"".""Client_id""=""cu"".""Users_id"" AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""cu"".""Banned""='No') JOIN ""users"" AS ""du"" ON ""t"".""Driver_id""=""du"".""Users_id"" AND ""du"".""Banned""='No' GROUP BY ""Request_at"" ORDER BY ""Request_at"""
219,"WITH ""client"" AS (SELECT ""users_id"" AS ""client_id"" FROM ""users"" WHERE ""role""='client' AND ""Banned""='No'), ""driver"" AS (SELECT ""users_id"" AS ""driver_id"" FROM ""users"" WHERE ""role""='driver' AND ""Banned""='No') SELECT ""request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""status""!='completed' THEN 1 ELSE 0 END)/COUNT(1)), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" JOIN ""client"" AS ""c"" ON ""c"".""client_id""=""t"".""client_id"") JOIN ""driver"" AS ""d"" ON ""d"".""driver_id""=""t"".""driver_id"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
220,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_Id"" IN (SELECT ""u"".""Users_Id"" FROM ""Users"" AS ""u"" WHERE ""u"".""Banned""='No') AND ""t"".""Driver_id"" IN (SELECT ""u"".""Users_Id"" FROM ""Users"" AS ""u"" WHERE ""u"".""Banned""='No') AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
221,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
222,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""='completed' THEN 0 ELSE 1 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""TRIPS"" WHERE ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""USERS"" WHERE ""Banned""='No') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""USERS"" WHERE ""Banned""='No') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
223,"SELECT ""request_at"" AS ""day"",ROUND(SUM(CASE WHEN ""status"" LIKE 'cancel%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""cancellation rate"" FROM (SELECT ""id"",""status"",""request_at"" FROM (""trips"" AS ""t"" LEFT JOIN ""users"" AS ""a"" ON ""t"".""client_id""=""a"".""users_id"") LEFT JOIN ""users"" AS ""b"" ON ""t"".""driver_id""=""b"".""users_id"" WHERE ""a"".""banned""='No' AND ""b"".""banned""='No' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""sub1"" GROUP BY 1"
224,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status""!='completed' THEN CASE WHEN ""ID"" IS NULL THEN 0 ELSE 1 END ELSE 0 END)/SUM(CASE WHEN ""ID"" IS NULL THEN 0 ELSE 1 END), 2) AS ""Cancellation Rate"" FROM ""Trips"" LEFT JOIN ""Users"" ON ""Client_ID""=""Users_Id"" WHERE ""Banned""='No' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
225,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status""!='completed' THEN 1 ELSE 0 END)*1.0/SUM(1), 2) AS ""Cancellation Rate"" FROM ""trips"" AS ""t"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""t"".""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes' AND ""role""='client') AND ""t"".""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes' AND ""role""='driver') GROUP BY ""request_at"""
226,"SELECT ""t1"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t1"".""Status"" LIKE 'cancelled%' THEN 1 ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t1"" JOIN ""Users"" AS ""u1"" ON ""u1"".""Users_Id""=""t1"".""Client_Id"") JOIN ""Users"" AS ""u2"" ON ""u2"".""Users_Id""=""t1"".""Driver_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""t1"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t1"".""Request_at"""
227,"WITH ""tot"" AS (SELECT ""Request_At"" AS ""Day"",CASE WHEN ""Status""='completed' THEN 0 ELSE 1 END AS ""cancelled"",COUNT(1) OVER (PARTITION BY ""Request_At"") AS ""total"" FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Role""='client' AND ""Banned""='No') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Role""='driver' AND ""Banned""='No')) SELECT ""Day"",ROUND(SUM(""cancelled"")/""total"", 2) AS ""cancellation rate"" FROM ""tot"" GROUP BY ""day"""
228,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(""t"".""status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""t"".""Client_id""=""c"".""Users_Id"" AND ""c"".""Banned""='No') JOIN ""Users"" AS ""d"" ON ""t"".""Client_id""=""d"".""Users_Id"" AND ""d"".""Banned""='No' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"" ORDER BY ""t"".""Request_at"""
229,"WITH ""cte"" AS (SELECT DISTINCT ""t"".""id"",""t"".""status"",""t"".""Request_at"" FROM ""trips"" AS ""t"" WHERE ""t"".""Client_Id"" IN (SELECT ""Users_Id"" FROM ""users"" WHERE ""banned""='No') AND ""t"".""Driver_id"" IN (SELECT ""Users_Id"" FROM ""users"" WHERE ""banned""='No') ORDER BY ""id"") SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""cte"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Day"""
230,"SELECT ""ina"".""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""Status""='completed' THEN 0 ELSE 1 END), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""ina"" LEFT JOIN ""Users"" AS ""inb"" ON ""ina"".""Client_Id""=""inb"".""Users_Id"") LEFT JOIN ""Users"" AS ""inc"" ON ""ina"".""Driver_ID""=""inc"".""Users_id"" WHERE ""inb"".""Banned""='No' AND ""inc"".""Banned""='No' AND ""ina"".""Request_at"">='2013-10-01' AND ""ina"".""Request_at""<='2013-10-03' GROUP BY ""request_at"""
231,"WITH ""merged"" AS (SELECT ""t"".* FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""Banned""='No'), ""not_banned"" AS (SELECT ""t"".* FROM ""merged"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Driver_Id""=""u"".""Users_Id"" AND ""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""not_banned"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
232,"SELECT ""anon_3"".""request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""anon_3"".""status""='completed' THEN 0 ELSE ""anon_3"".""trip_cnt"" END)/SUM(""anon_3"".""trip_cnt"")), 2) AS ""Cancellation Rate"" FROM (SELECT ""anon_2"".""status"",""anon_2"".""request_at"",COUNT(1) AS ""trip_cnt"" FROM (SELECT ""anon_1"".""status"",""anon_1"".""request_at"" FROM (SELECT ""t"".""id"",""t"".""status"",""t"".""request_at"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" WHERE ""t"".""request_at"" BETWEEN CAST('2013-10-01' AS DATE) AND CAST('2013-10-03' AS DATE) AND ""u"".""banned""='No' UNION ALL SELECT ""t"".""id"",""t"".""status"",""t"".""request_at"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""driver_id""=""u"".""users_id"" WHERE ""t"".""request_at"" BETWEEN CAST('2013-10-01' AS DATE) AND CAST('2013-10-03' AS DATE) AND ""u"".""banned""='No') AS ""anon_1"" GROUP BY ""anon_1"".""id"",""anon_1"".""status"",""anon_1"".""request_at"" HAVING COUNT(1)>1) AS ""anon_2"" GROUP BY ""anon_2"".""status"",""anon_2"".""request_at"") AS ""anon_3"" GROUP BY ""anon_3"".""request_at"""
233,"SELECT DISTINCT ""a"".""request_at"" AS ""day"",ROUND(SUM(""a"".""canc"") OVER (PARTITION BY ""a"".""request_at"")/COUNT(1) OVER (PARTITION BY ""a"".""request_at""), 2) AS ""cancellation rate"" FROM (SELECT ""request_at"",CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END AS ""canc"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" AND ""u"".""banned""!='Yes' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"" AND ""d"".""banned""!='Yes' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""a"" ORDER BY 1"
234,"WITH ""total"" AS (SELECT COUNT(1) AS ""cnt"",""Request_at"" AS ""Day"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""uc"" ON ""uc"".""Users_id""=""t"".""Client_id"") JOIN ""Users"" AS ""ud"" ON ""ud"".""Users_id""=""t"".""Driver_Id"" WHERE ""uc"".""Banned""='No' AND ""ud"".""Banned""='No' AND ""Request_at""<'2013-10-04' AND ""Request_at"">='2013-10-01' GROUP BY ""Request_at""), ""canceled"" AS (SELECT ""Request_at"" AS ""Day"",COUNT(1) AS ""cnt"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""uc"" ON ""uc"".""Users_id""=""t"".""Client_id"") JOIN ""Users"" AS ""ud"" ON ""ud"".""Users_id""=""t"".""Driver_Id"" WHERE ""uc"".""Banned""='No' AND ""ud"".""Banned""='No' AND ""t"".""Status"" LIKE 'cancelled_by_%' AND ""Request_at""<'2013-10-04' AND ""Request_at"">='2013-10-01' GROUP BY ""Request_at"") SELECT ""t"".""Day"",ROUND(COALESCE(""c"".""cnt"", 0)/""t"".""cnt"", 2) AS ""Cancellation Rate"" FROM ""total"" AS ""t"" LEFT JOIN ""canceled"" AS ""c"" ON ""t"".""Day""=""c"".""Day"""
235,"WITH ""CTE1"" AS (SELECT ""CLIENT_ID"",""DRIVER_ID"",(CASE WHEN ""STATUS"" LIKE '%cancelled%' THEN 1 ELSE 0 END) AS ""STATUS"",""REQUEST_AT"" FROM ""TRIPS"" WHERE ""CLIENT_ID"" NOT IN (SELECT ""USERS_ID"" FROM ""USERS"" WHERE ""BANNED""='Yes' AND ""ROLE""='client') AND ""DRIVER_ID"" NOT IN (SELECT ""USERS_ID"" FROM ""USERS"" WHERE ""BANNED""='Yes' AND ""ROLE""='role') AND ""REQUEST_AT"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""REQUEST_AT"" AS ""DAY"",ROUND(SUM(""STATUS"")/COUNT(""STATUS""), 2) AS ""CANCELLATION RATE"" FROM ""CTE1"" GROUP BY ""DAY"""
236,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t1"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t1"" LEFT JOIN ""Users"" AS ""u"" ON ""t1"".""Client_Id""=""u"".""Users_Id"" WHERE ""u"".""Banned""='No' AND ""t1"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
237,"SELECT ""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""Status""='completed' THEN 0 ELSE 1 END), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1 ORDER BY 1"
238,"WITH ""cte_staging"" AS (SELECT ""t"".*,CASE WHEN ""Status"" LIKE '%cancelled%' AND (""d"".""Banned""='No' AND ""c"".""Banned""='No') THEN 1 ELSE 0 END AS ""cancellation"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""d"" ON ""t"".""Driver_Id""=""d"".""Users_Id"" AND ""d"".""Banned""='No') JOIN ""Users"" AS ""c"" ON ""t"".""Client_Id""=""c"".""Users_Id"" AND ""c"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""cancellation"")/COUNT(""Status""), 2) AS ""Cancellation Rate"" FROM ""cte_staging"" GROUP BY ""Request_at"""
239,"SELECT ""request_at"" AS ""Day"",ROUND(COUNT(DISTINCT CASE WHEN ""status"" IN ('cancelled_by_driver','cancelled_by_client') THEN ""id"" ELSE NULL END)/COUNT(DISTINCT ""id""), 2) AS ""Cancellation Rate"" FROM (""trips"" LEFT JOIN (SELECT ""users_id"" AS ""client_id"",""banned"" AS ""client_banned"" FROM ""users"" WHERE ""role""='client') AS ""client"" USING (""client_id"")) LEFT JOIN (SELECT ""users_id"" AS ""driver_id"",""banned"" AS ""driver_banned"" FROM ""users"" WHERE ""role""='driver') AS ""driver"" USING (""driver_id"") WHERE ""client_banned""='No' AND ""driver_banned""='No' AND ""request_at"">=DATE('2013-10-01') AND ""request_at""<=DATE('2013-10-03') GROUP BY 1 ORDER BY 1"
240,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(1-(SUM(""t"".""Status""='completed')/COUNT(""t"".""Status"")), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
241,"WITH ""temp_table"" AS (SELECT ""Request_at"",""STATUS"",""Client_Id"",""Driver_Id"" FROM (""TRIPS"" AS ""t"" JOIN ""USERS"" AS ""d"" ON ""t"".""Driver_Id""=""d"".""Users_Id"") JOIN ""USERS"" AS ""r"" ON ""t"".""Client_Id""=""r"".""Users_Id"" WHERE ""d"".""Banned""='No' AND ""r"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",ROUND(""Cancel_cnt""/""total_rides"", 2) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"",COUNT(1) AS ""total_rides"",SUM(CASE WHEN ""STATUS""!='completed' THEN 1 ELSE 0 END) AS ""Cancel_cnt"" FROM ""TEMP_TABLE"" GROUP BY ""Request_at"") AS ""t"""
242,"WITH ""temp"" AS (SELECT * FROM ""Trips"" JOIN ""Users"" AS ""a"" ON ""Trips"".""Client_id""=""a"".""Users_id"" WHERE ""a"".""Banned""='No' AND ""a"".""Role""='client'), ""temp2"" AS (SELECT ""temp"".""Request_at"",""temp"".""Status"" FROM ""temp"" JOIN ""Users"" AS ""b"" ON ""temp"".""Driver_id""=""b"".""Users_ID"" WHERE ""b"".""Banned""='No' AND ""b"".""Role""='driver'), ""temp3"" AS (SELECT ""temp2"".""Request_at"",CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END AS ""flag_cancelled"" FROM ""temp2"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""temp3"".""Request_at"" AS ""Day"",COALESCE(ROUND(SUM(""flag_cancelled"")/COUNT(1), 2), 0.00) AS ""Cancellation Rate"" FROM ""temp3"" GROUP BY ""temp3"".""Request_at"""
243,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""T"".""Status"" LIKE 'Cancelled%' THEN 1 ELSE 0 END)/COUNT(""T"".""Status""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""T"") CROSS JOIN ""Users"" AS ""U"" WHERE (""T"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""T"".""Client_Id""=""U"".""Users_Id"" AND ""U"".""Banned""='No' GROUP BY ""T"".""Request_at"""
244,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""Status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='NO' AND ""Role""='client') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='NO' AND ""Role""='driver') GROUP BY ""Request_at"""
245,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(DISTINCT ""Id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""d1"" JOIN ""Users"" AS ""d2"" ON ""d1"".""Client_Id""=""d2"".""Users_Id"" WHERE ""Banned""!='Yes' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"" ORDER BY ""Request_at"""
246,"WITH ""cte"" AS (SELECT ""t"".""request_at"" AS ""day"",CASE WHEN ""t"".""status""!='Completed' THEN 1 ELSE 0 END AS ""Cancelled"" FROM ""trips"" AS ""t"" WHERE ""t"".""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""t"".""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""day"",ROUND(SUM(""cancelled"")/COUNT(""day""), 2) AS ""cancellation rate"" FROM ""cte"" GROUP BY ""day"""
247,"WITH ""temp"" AS (SELECT DISTINCT ""t"".""Client_Id"",""t"".""Driver_Id"",""t"".""Status"",""u"".""Banned"",""u"".""Role"",""t"".""Request_at"",""t"".""Id"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND (""u"".""Banned""='No') WHERE ""t"".""Request_at"">='2013-10-01' AND ""t"".""Request_at""<='2013-10-03') SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status"" LIKE 'cancelled_by%' THEN 1 ELSE 0 END)/COUNT(""t"".""Id""), 2) AS ""Cancellation Rate"" FROM ""temp"" AS ""t"" GROUP BY ""t"".""Request_at"""
248,"SELECT ""t1"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t1"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t1"" LEFT JOIN ""Users"" AS ""u"" ON ""t1"".""Client_id""=""u"".""Users_Id"" WHERE ""u"".""Banned""='No' AND (""t1"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY ""t1"".""Request_at"""
249,"SELECT ""Request_at"" AS ""Day"",CAST(ROUND(SUM(CASE WHEN ""Status""='cancelled_by_driver' THEN 1 WHEN ""Status""='cancelled_by_client' THEN 1 ELSE 0 END)*1.0/COUNT(""Status""), 2) AS FLOAT) AS ""cancellation rate"" FROM ""Trips"" AS ""t"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""Banned""='Yes') AND ""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"" ORDER BY ""Request_at"""
250,"SELECT ""p"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""p"".""Status""='completed' THEN 0 ELSE 1 END)/SUM(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""p"" LEFT JOIN ""Users"" AS ""u"" ON ""p"".""Client_Id""=""u"".""Users_Id"") LEFT JOIN ""Users"" AS ""d"" ON ""p"".""Driver_Id""=""d"".""Users_id"" WHERE ""u"".""Banned""='No' AND ""d"".""Banned""='No' AND ""p"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""p"".""Request_at"""
251,"SELECT ""trips"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""trips"".""status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" LEFT JOIN ""Users"" AS ""a"" ON ""Trips"".""Client_Id""=""a"".""Users_ID"") LEFT JOIN ""Users"" AS ""b"" ON ""Trips"".""Driver_Id""=""b"".""Users_ID"" WHERE ""a"".""Banned""!='Yes' AND ""b"".""Banned""!='Yes' AND ""trips"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""trips"".""Request_at"" ORDER BY ""trips"".""Request_at"""
252,"WITH ""merged"" AS (SELECT ""t"".* FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""Banned""='No'), ""not_banned"" AS (SELECT ""t"".* FROM ""merged"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Driver_Id""=""u"".""Users_Id"" AND ""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""not_banned"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
253,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(""T"".""Canceled_Count""/""T"".""Trip_Count"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE ""t"".""Status"" WHEN 'completed' THEN NULL ELSE 1 END) AS ""Canceled_Count"",COUNT(1) AS ""Trip_Count"",""t"".""Request_at"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON (""t"".""Client_Id""=""u1"".""Users_Id"") AND (""u1"".""Banned""='No')) JOIN ""Users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""Users_Id"") AND (""u2"".""Banned""='No') GROUP BY ""t"".""Request_at"" HAVING ""t"".""Request_at""<='2013-10-03' AND ""t"".""Request_at"">='2013-10-01') AS ""T"""
254,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(""Status""!='completed' OR NULL)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""Client_Id""=""u"".""Users_Id"" WHERE ""banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
255,"SELECT ""DAY"",CAST((""CNCLD_CNT""/""TOTAL_CNT"") AS DECIMAL(3, 2)) AS ""CANCELLATION RATE"" FROM (SELECT ""REQUEST_AT"" AS ""DAY"",COUNT(1) AS ""TOTAL_CNT"",SUM(CASE WHEN ""STATUS""!='completed' THEN 1 ELSE 0 END) AS ""CNCLD_CNT"" FROM ""TRIPS"" WHERE ""CLIENT_ID"" IN (SELECT ""USERS_ID"" FROM ""USERS"" WHERE ""ROLE"" IN ('client') AND ""BANNED""='No') AND ""DRIVER_ID"" IN (SELECT ""USERS_ID"" FROM ""USERS"" WHERE ""ROLE"" IN ('driver') AND ""BANNED""='No') AND ""REQUEST_AT"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""REQUEST_AT"") AS ""A"""
256,"SELECT ""T"".""request_at"" AS ""Day"",COALESCE(ROUND(COUNT(CASE WHEN ""t"".""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2), 0.00) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"") JOIN ""users"" AS ""u1"" ON ""t"".""driver_id""=""u1"".""users_id"" WHERE ""u"".""banned""='No' AND ""u1"".""banned""='No' GROUP BY ""request_at"" HAVING ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
257,"SELECT ""a"".""request_at"" AS ""Day"",ROUND(""a"".""zozo""/""b"".""total"", 2) AS ""Cancellation Rate"" FROM (SELECT ""request_at"",SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END) AS ""zozo"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"") JOIN ""users"" AS ""us"" ON ""t"".""driver_id""=""us"".""users_id"" WHERE ""u"".""banned""='NO' AND ""us"".""banned""='NO' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"") AS ""a"" JOIN (SELECT ""request_at"",COUNT(""request_at"") AS ""total"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"") JOIN ""users"" AS ""us"" ON ""t"".""driver_id""=""us"".""users_id"" WHERE ""u"".""banned""='NO' AND ""us"".""banned""='NO' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"") AS ""b"" ON ""a"".""request_at""=""b"".""request_at"""
258,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND((COUNT(CASE WHEN ""t"".""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1)), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""client"" ON ""t"".""Client_Id""=""client"".""Users_Id"" AND ""client"".""Role""='client' AND ""client"".""Banned""='No') JOIN ""Users"" AS ""driver"" ON ""t"".""Driver_Id""=""driver"".""Users_Id"" AND ""driver"".""Role""='driver' AND ""driver"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
259,"SELECT ""Trips"".""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""Trips"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Trips"".""Client_Id"" NOT IN (SELECT ""Users"".""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Trips"".""Driver_Id"" NOT IN (SELECT ""Users"".""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Trips"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Trips"".""Request_at"""
260,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE 'cancel%' THEN 1 ELSE 0 END)/SUM(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" LEFT JOIN ""Users"" AS ""client"" ON ""Trips"".""Client_Id""=""client"".""Users_Id"") LEFT JOIN ""Users"" AS ""driver"" ON ""Trips"".""Driver_Id""=""driver"".""Users_Id"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""client"".""Banned""='No' AND ""driver"".""Banned""='No' GROUP BY 1 ORDER BY 1"
261,"SELECT ""REQUEST_AT"" AS ""DAY"",ROUND(COUNT(CASE WHEN ""Status""!='Completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""cancellation rate"" FROM ""Trips"" WHERE ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""Banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""Banned""='No') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
262,"SELECT ""a"".""request_at"" AS ""Day"",ROUND(COALESCE(""b"".""cancelled_trips"", 0)/""a"".""all_trips"", 2) AS ""Cancellation Rate"" FROM (SELECT ""request_at"",COUNT(1) AS ""all_trips"" FROM ""trips"" WHERE ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' GROUP BY ""request_at"") AS ""a"" LEFT JOIN (SELECT ""request_at"",COUNT(1) AS ""cancelled_trips"" FROM ""trips"" WHERE ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""status"" IN ('cancelled_by_driver','cancelled_by_client') GROUP BY ""request_at"") AS ""b"" ON ""a"".""request_at""=""b"".""request_at"""
263,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE NULL END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""client"" ON ""t"".""client_id""=""client"".""users_id"" AND ""client"".""banned""='No') JOIN ""users"" AS ""driver"" ON ""driver"".""users_id""=""t"".""driver_id"" AND ""driver"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""request_at"""
264,"SELECT ""Request_at"" AS ""Day"",ROUND(""cancel"", 2) AS ""Cancellation Rate"" FROM (SELECT ""t"".""Status"",""t"".""Request_at"",""u1"".""Banned"" AS ""b1"",""u2"".""Banned"" AS ""b2"",AVG(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END) AS ""cancel"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""u1"".""Users_Id""=""t"".""Client_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""u2"".""Users_Id""=""t"".""Driver_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"") AS ""t1"""
265,"SELECT ""request_at"" AS ""day"",ROUND(SUM(CASE WHEN ""status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""request_at"" BETWEEN '2013-10-01 ' AND '2013-10-03' AND ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') GROUP BY 1"
266,"WITH ""valid_trips"" AS (SELECT ""status""='completed' AS ""completed"",""request_at"" AS ""Day"" FROM (""trips"" JOIN ""users"" AS ""clients"" ON (""trips"".""client_id""=""clients"".""users_id"")) JOIN ""users"" AS ""drivers"" ON (""trips"".""driver_id""=""drivers"".""users_id"") WHERE (""clients"".""banned""='No' AND ""drivers"".""banned""='No' AND ""trips"".""request_at"">='2013-10-01' AND ""trips"".""request_at""<='2013-10-03')) SELECT ""Day"",ROUND(1-AVG(""completed""), 2) AS ""Cancellation Rate"" FROM ""valid_trips"" GROUP BY ""Day"""
267,"WITH ""a"" AS (SELECT ""client_id"",""driver_id"",""status"",""request_at"",""banned"" AS ""banned_driver"" FROM ""Trips"" LEFT JOIN ""Users"" ON ""Trips"".""driver_id""=""Users"".""users_id""), ""b"" AS (SELECT ""client_id"",""driver_id"",""status"",""request_at"",""banned"" AS ""banned_client"",""banned_driver"" FROM ""a"" LEFT JOIN ""Users"" ON ""a"".""client_id""=""Users"".""users_id""), ""c"" AS (SELECT * FROM ""b"" WHERE ""banned_client""='No' AND ""banned_driver""='No' AND ""request_at"" - CAST('2013-10-01' AS DATE)>=0 AND ""request_at"" - CAST('2013-10-03' AS DATE)<=0), ""d"" AS (SELECT ""request_at"",COUNT(1) AS ""ct"" FROM ""c"" WHERE ""status"" IN ('cancelled_by_driver','cancelled_by_client') GROUP BY ""request_at""), ""e"" AS (SELECT ""request_at"",COUNT(1) AS ""ct"" FROM ""c"" GROUP BY ""request_at"") SELECT ""e"".""request_at"" AS ""day"",ROUND(COALESCE(""d"".""ct"", 0)/""e"".""ct"", 2) AS ""Cancellation Rate"" FROM ""e"" LEFT JOIN ""d"" ON ""e"".""request_at""=""d"".""request_at"""
268,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
269,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client' THEN 1 ELSE 0 END), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""a"" ON ""t"".""Client_Id""=""a"".""Users_Id"") LEFT JOIN ""Users"" AS ""b"" ON ""t"".""Driver_Id""=""b"".""Users_Id"" WHERE ""a"".""Banned""='No' AND ""b"".""Banned""='No' AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03' GROUP BY ""t"".""Request_at"""
270,"SELECT ""t"".""request_at"" AS ""Day"",CAST(SUM(CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END)/COUNT(1) AS DECIMAL(6, 2)) AS ""Cancellation Rate"" FROM ""trips"" AS ""t"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND EXISTS (SELECT 1 FROM ""users"" WHERE ""users_id""=""client_id"" AND ""banned""='No') AND EXISTS (SELECT 1 FROM ""users"" WHERE ""users_id""=""driver_id"" AND ""banned""='No') GROUP BY ""t"".""request_at"""
271,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
272,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""a"" LEFT JOIN ""Users"" AS ""b"" ON ""a"".""Client_Id""=""b"".""Users_Id"" AND ""b"".""role""='Client') LEFT JOIN ""Users"" AS ""c"" ON ""a"".""Driver_Id""=""c"".""Users_Id"" AND ""c"".""role""='Driver' WHERE ""b"".""banned""='No' AND ""c"".""banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
273,"WITH ""filtered"" AS (SELECT ""Status"",""Request_at"" FROM ""Trips"" WHERE ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""!='Yes') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""!='Yes') AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03'), ""orders"" AS (SELECT COUNT(1) AS ""sum"",""Request_at"" FROM ""filtered"" GROUP BY ""Request_at""), ""canceled"" AS (SELECT COUNT(1) AS ""sum"",""Request_at"" FROM ""filtered"" WHERE ""Status""!='completed' GROUP BY ""Request_at"") SELECT ""orders"".""Request_at"" AS ""Day"",COALESCE(ROUND(""canceled"".""sum""/""orders"".""sum"", 2), 0.00) AS ""Cancellation Rate"" FROM ""orders"" LEFT JOIN ""canceled"" ON ""orders"".""Request_at""=""canceled"".""Request_at"""
274,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned"" IN ('Yes')) AND ""Driver_id"" NOT IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned"" IN ('Yes')) AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
275,"SELECT ""FT"".""R"" AS ""Day"",ROUND(SUM(""FT"".""CS"")/COUNT(""FT"".""R""), 2) AS ""Cancellation Rate"" FROM (SELECT ""T"".""Request_at"" AS ""R"",CASE WHEN ""T"".""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END AS ""CS"" FROM (""Trips"" AS ""T"" JOIN ""Users"" AS ""U"" ON ""T"".""Client_Id""=""U"".""Users_Id"") JOIN ""Users"" AS ""U2"" ON ""T"".""Client_Id""=""U2"".""Users_Id"" WHERE ""U"".""Banned""!='Yes' OR ""U2"".""Banned""!='Yes') AS ""FT"" WHERE ""FT"".""R"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""FT"".""R"""
276,"SELECT ""t1"".""request_at"" AS ""Day"",ROUND(COALESCE(""t2"".""c2"", 0)/""t1"".""c1"", 2) AS ""Cancellation Rate"" FROM (SELECT ""request_at"",COUNT(1) AS ""c1"" FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' GROUP BY ""request_at"") AS ""t1"" LEFT JOIN (SELECT ""request_at"",COUNT(1) AS ""c2"" FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' AND ""status"" LIKE 'cancelled_by_%' GROUP BY ""request_at"") AS ""t2"" ON ""t1"".""request_at""=""t2"".""request_at"" ORDER BY ""t1"".""request_at"""
277,"WITH ""A"" AS (SELECT ""request_at"" AS ""Day"",COUNT(""t"".""status"") AS ""total_trips"",SUM(CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END) AS ""cancelled_trips"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" AND ""u"".""banned""!='Yes' WHERE ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""request_at"" ORDER BY ""t"".""request_at"") SELECT ""Day"",ROUND((""cancelled_trips""/""total_trips""), 2) AS ""Cancellation Rate"" FROM ""A"""
278,"SELECT ""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""status""='cancelled_by_driver' OR ""status""='cancelled_by_client' THEN 1 ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""T"" JOIN ""Users"" AS ""C"" ON ""T"".""client_id""=""C"".""Users_Id"") JOIN ""Users"" AS ""D"" ON ""T"".""driver_id""=""D"".""Users_Id"" WHERE ""C"".""Banned""!='Yes' AND ""D"".""Banned""!='Yes' AND ""T"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"" ORDER BY ""request_at"""
279,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""isCanceled"")/COUNT(""isCanceled""), 2) AS ""Cancellation Rate"" FROM (SELECT *,CASE WHEN ""Status"" LIKE 'cancelled_%' THEN 1 ELSE 0 END AS ""isCanceled"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""T1"" GROUP BY ""Request_at"""
280,"WITH ""CTE"" AS (SELECT ""A"".*,CASE WHEN ""A"".""Status""!='completed' THEN ""1"" ELSE 0 END AS ""IS_Cancelled"" FROM (""Trips"" AS ""A"" JOIN ""Users"" AS ""B"" ON ""A"".""Client_Id""=""B"".""Users_Id"") JOIN ""Users"" AS ""C"" ON ""A"".""Driver_Id""=""C"".""Users_Id"" WHERE ""B"".""Banned""!='Yes' AND ""C"".""Banned""!='Yes' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Cancelled_Trips"".""Request_at"" AS ""Day"",ROUND(""Cancelled_Trips"".""CancelledTrips""/""Cancelled_Trips"".""TT"", 2) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"",SUM(""IS_Cancelled"") AS ""CancelledTrips"",COUNT(1) AS ""TT"" FROM ""CTE"" GROUP BY ""Request_at"") AS ""Cancelled_Trips"" ORDER BY ""Cancelled_Trips"".""Request_at"""
281,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN 1 ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') GROUP BY ""Request_at"""
282,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE 'CANCELLED%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (SELECT * FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""t"".""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""newT"" GROUP BY ""Request_at"""
283,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE ""t"".""Status"" WHEN 'cancelled_by_driver' THEN 1 WHEN 'cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE '2013-10-01'<=""t"".""Request_at"" AND ""t"".""Request_at""<='2013-10-03' AND ""t"".""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" AS ""u"" WHERE ""Banned""='No') AND ""t"".""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" AS ""u"" WHERE ""Banned""='No') GROUP BY ""T"".""Request_at"""
284,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""='completed' THEN 0 ELSE 1 END)/COUNT(""t"".""Status""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""t"".""Client_Id""=""u2"".""Users_Id"" WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' GROUP BY 1"
285,"WITH ""ban_status_cte"" AS (SELECT ""T"".""id"",""T"".""Status"",""T"".""Request_at"",""C"".""Banned"" AS ""Client_Banned"",""D"".""Banned"" AS ""Driver_Banned"" FROM (""Trips"" AS ""T"" JOIN ""Users"" AS ""C"" ON ""T"".""Client_Id""=""C"".""Users_Id"") JOIN ""Users"" AS ""D"" ON ""T"".""Driver_Id""=""D"".""Users_Id"" WHERE ""C"".""Banned""='No' AND ""C"".""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(COALESCE(SUM(CASE WHEN ""Status""='cancelled_by_driver' THEN 1 WHEN ""Status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(""Status""), 0), 2) AS ""Cancellation Rate"" FROM ""ban_status_cte"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"" ORDER BY ""Request_at"""
286,"WITH ""a"" AS (SELECT ""Status"",""Request_at"" AS ""Day"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes')), ""b"" AS (SELECT ""Day"",COUNT(""Status"") AS ""denominator"" FROM ""a"" GROUP BY (""Day"")), ""c"" AS (SELECT ""Day"",COUNT(1) AS ""numerator"" FROM (SELECT ""Day"",""Status"" FROM ""a"" WHERE ""Status""!='completed') AS ""temp"" GROUP BY (""Day"")), ""t"" AS (SELECT ""b"".""Day"",COALESCE(""c"".""Numerator"", 0) AS ""Numerator"",""b"".""denominator"" FROM ""b"" LEFT JOIN ""c"" ON ""b"".""day""=""c"".""day"") SELECT ""Day"",ROUND(""Numerator""/""denominator"", 2) AS ""Cancellation Rate"" FROM ""t"" WHERE ""Day"" BETWEEN '2013-10-01' AND '2013-10-03'"
287,"SELECT CAST(""Request_at"" AS DATE) AS ""Day"",ROUND(CAST(COUNT(CASE WHEN ""t"".""status""!='Completed' THEN ""id"" ELSE NULL END) AS DECIMAL(2))/COUNT(""ID""), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""Users_Id"" AND ""d"".""banned""='No') JOIN ""users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""banned""='No' WHERE CAST(""Request_at"" AS DATE) BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY CAST(""request_at"" AS DATE)"
288,"WITH ""T1"" AS (SELECT * FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" WHERE ""Banned""='No' AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03'), ""T2"" AS (SELECT * FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Driver_Id""=""u"".""Users_Id"" WHERE ""Banned""='No' AND ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03') SELECT ""a"".""Request_at"" AS ""Day"",COALESCE(ROUND((""total_count""-""completed_count"")/""total_count"", 2), 0.00) AS ""Cancellation Rate"" FROM (SELECT ""T1"".""Request_at"",COUNT(""T1"".""Id"") AS ""total_count"",SUM(CASE WHEN ""T1"".""Status""='completed' THEN 1 ELSE 0 END) AS ""completed_count"" FROM ""T1"" JOIN ""T2"" ON ""T1"".""Id""=""T2"".""Id"" GROUP BY ""T1"".""Request_at"") AS ""a"""
289,"WITH ""result"" AS (SELECT ""t"".* FROM (""trips"" AS ""t"" LEFT JOIN ""users"" AS ""r"" ON ""t"".""client_id""=""r"".""users_id"") LEFT JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"" WHERE ""r"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""result"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""result"" GROUP BY 1"
290,"WITH ""all_trips_no_banned_users"" AS (SELECT ""t"".* FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u"".""Banned""='No' AND ""u2"".""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""all_trips_no_banned_users"" WHERE ""Request_at""<='2013-10-03' GROUP BY 1 ORDER BY 1"
291,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
292,"SELECT ""request_at"" AS ""day"",ROUND(SUM(CASE WHEN ""status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""id""), 2) AS ""cancellation rate"" FROM (SELECT ""id"",""client_id"",""driver_id"",""status"",""request_at"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" WHERE ""u"".""banned"" LIKE 'No' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""ts"" GROUP BY 1"
293,"SELECT ""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ((""trips"" AS ""a"") CROSS JOIN ""Users"" AS ""b"") CROSS JOIN ""users"" AS ""c"" WHERE ""a"".""client_id""=""b"".""users_id"" AND ""a"".""driver_id""=""c"".""users_id"" AND ""b"".""banned""='NO' AND ""C"".""banned""='NO' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
294,"WITH ""nb"" AS (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No'), ""tr"" AS (SELECT * FROM ""trips"" WHERE ""client_id"" IN (SELECT * FROM ""nb"") AND ""driver_id"" IN (SELECT * FROM ""nb"") AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""request_at"" AS ""day"",ROUND(COUNT(CASE WHEN ""status"" LIKE 'cancelled_by_%' THEN 1 ELSE NULL END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""tr"" GROUP BY ""Request_at"""
295,"SELECT ""Day"",ROUND((""cancelled_trips""/""total_trips""), 2) AS ""Cancellation Rate"" FROM (SELECT ""request_at"" AS ""Day"",COUNT(""t"".""status"") AS ""total_trips"",SUM(CASE WHEN ""t"".""status""!='completed' THEN 1 ELSE 0 END) AS ""cancelled_trips"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" AND ""u"".""role""='client' AND ""u"".""banned""!='Yes') JOIN ""users"" AS ""u2"" ON ""t"".""driver_id""=""u2"".""users_id"" AND ""u2"".""role""='driver' AND ""u2"".""banned""!='Yes' WHERE ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""request_at"" ORDER BY ""t"".""request_at"") AS ""tmp"""
296,"WITH ""cte1"" AS (SELECT ""t"".""Client_Id"",""t"".""Driver_Id"",""u1"".""Banned"" AS ""BannedClient"",""u2"".""Banned"" AS ""BannedDriver"",""t"".""Status"",""t"".""Request_at"" AS ""Day"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_ID""=""u2"".""Users_Id"") SELECT ""Day"",ROUND(COUNT(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE NULL END)/COUNT(""Status""), 2) AS ""Cancellation Rate"" FROM ""cte1"" WHERE (""BannedClient""='No' AND ""BannedDriver""='No') AND (""Day"" BETWEEN CAST('2013-10-01' AS DATE) AND CAST('2013-10-03' AS DATE)) GROUP BY ""Day"""
297,"WITH ""cte"" AS (SELECT ""Users_Id"" AS ""Id"" FROM ""Users"" WHERE ""Role"" IN (1,2) AND ""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE '%cancelled%' THEN 1 ELSE 0 END)/COUNT(""t1"".""ID""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t1"" JOIN ""cte"" AS ""t2"" ON ""t1"".""Driver_ID""=""t2"".""id"") JOIN ""cte"" AS ""t3"" ON ""t1"".""Client_ID""=""t3"".""id"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
298,"SELECT ""Request_at"" AS ""day"",ROUND(SUM(CASE WHEN ""t"".""Status""='completed' THEN 0 ELSE 1 END)/COUNT(""t"".""Status""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""users"" AS ""u1"" ON ""u1"".""Users_Id""=""t"".""Client_Id"" AND ""u1"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') JOIN ""users"" AS ""u2"" ON ""u2"".""Users_Id""=""t"".""Driver_Id"" AND ""u2"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
299,"WITH ""tipcte"" AS (SELECT ""T"".* FROM (""Trips"" AS ""T"" LEFT JOIN ""Users"" AS ""U1"" ON ""T"".""Client_Id""=""U1"".""Users_id"") LEFT JOIN ""Users"" AS ""U2"" ON ""T"".""Client_Id""=""U2"".""Users_id"" WHERE ""U1"".""Banned""='No' AND ""u2"".""Banned""='No') SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""status""!='completed' THEN ""id"" END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""tipcte"" GROUP BY ""request_at"" HAVING ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
300,"SELECT ""request_at"" AS ""Day"",ROUND(((SUM(CASE WHEN LOWER(""Status"") LIKE 'cancelled%' THEN 1.000 ELSE 0 END))/COUNT(""id"")), 2) AS ""Cancellation Rate"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" AND ""u"".""banned""='No' WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
301,"WITH ""filtered_trips"" AS (SELECT * FROM ""Trips"" WHERE ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""Role""='client') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""Role""='driver') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""Status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""filtered_trips"" GROUP BY ""Request_at"""
302,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
303,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" IN ('cancelled_by_driver','cancelled_by_client') THEN ""t"".""id"" END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""c"" ON ""t"".""client_id""=""c"".""users_id"") LEFT JOIN ""Users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""Banned""='No' AND ""d"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1 ORDER BY 1"
304,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""Status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE (""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AND ""Client_id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
305,"ERROR: mysql parse error: line 1 column 87 near ""9.2)) as decimal(9,2)) as ""Cancellation Rate"" from ( select request_at, sum(case when status = 'completed' then 0 else 1 end) as canceled, count(*) as total from trips inner join users client on trips.client_id = client.users_id inner join users driver on trips.driver_id = driver.users_id where client.banned = 'No' and driver.banned = 'No' and request_at between '2013-10-01' and '2013-10-03' group by 1) a"" "
306,"WITH ""Sub"" AS (SELECT * FROM ""Trips"" WHERE ""Client_id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No') AND ""Driver_id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Sub"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Sub"".""Status"" LIKE '%cancelled%' THEN 1.0 ELSE 0.0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Sub"" GROUP BY ""Sub"".""Request_at"""
307,"WITH ""unbanned_users"" AS (SELECT ""Users_Id"" AS ""id"" FROM ""Users"" WHERE ""Banned""='Yes') SELECT ""Day"",ROUND(SUM(""completed"")/COUNT(""completed""), 2) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"" AS ""Day"",CASE WHEN ""Status""='completed' THEN 0 ELSE 1 END AS ""completed"" FROM ""Trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""Client_Id"" NOT IN (SELECT ""id"" FROM ""unbanned_users"") AND ""Driver_id"" NOT IN (SELECT ""id"" FROM ""unbanned_users"")) AS ""t"" GROUP BY 1 ORDER BY 1"
308,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Request_at"">='2013-10-01' AND ""Request_at""<='2013-10-03' AND ""Client_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""Request_at"""
309,"WITH ""cancelled"" AS (SELECT COUNT(DISTINCT ""id"") AS ""cancelled_trips"",""Request_at"" FROM ""Trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Status"" IN ('cancelled_by_driver','cancelled_by_client') GROUP BY 2), ""total_trips"" AS (SELECT COUNT(DISTINCT ""id"") AS ""total_trips"",""Request_at"" FROM ""Trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY 2) SELECT ""t"".""Request_at"" AS ""Day"",COALESCE(ROUND(""c"".""cancelled_trips""/""t"".""total_trips"", 2), 0) AS ""Cancellation Rate"" FROM ""total_trips"" AS ""t"" LEFT JOIN ""cancelled"" AS ""c"" ON ""t"".""Request_at""=""c"".""Request_at"" WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
310,"SELECT ""T_tot"".""Day"" AS ""Day"",ROUND(COALESCE(""T_can"".""cancel_num"", 0)/""T_tot"".""tot"", 2) AS ""Cancellation Rate"" FROM (SELECT ""Day"",COUNT(1) AS ""tot"" FROM (SELECT ""Request_at"" AS ""Day"",""T1"".""banned"" AS ""ban_1"",""T2"".""banned"" AS ""ban_2"" FROM ((""Trips"") CROSS JOIN ""Users"" AS ""T1"") CROSS JOIN ""Users"" AS ""T2"" WHERE ""Trips"".""Client_Id""=""T1"".""Users_Id"" AND ""Trips"".""Driver_Id""=""T2"".""Users_Id"") AS ""T"" WHERE ""ban_1""='No' AND ""ban_2""='No' GROUP BY ""Day"") AS ""T_tot"" LEFT JOIN (SELECT ""Day"",COUNT(""Id"") AS ""cancel_num"" FROM (SELECT ""Trips"".""Id"" AS ""Id"",""T1"".""banned"" AS ""ban_1"",""T2"".""banned"" AS ""ban_2"",""Request_at"" AS ""Day"" FROM ((""Trips"") CROSS JOIN ""Users"" AS ""T1"") CROSS JOIN ""Users"" AS ""T2"" WHERE ""Trips"".""Client_Id""=""T1"".""Users_Id"" AND ""Trips"".""Driver_Id""=""T2"".""Users_Id"" AND ""Trips"".""Status"" LIKE 'cancelled%') AS ""T"" WHERE ""ban_1""='No' AND ""ban_2""='No' GROUP BY ""Day"") AS ""T_can"" ON ""T_tot"".""DAY""=""T_can"".""DAY"" WHERE CAST('2013-10-03' AS DATE) - ""T_tot"".""Day""<3 AND ""T_tot"".""Day"" - CAST('2013-10-01' AS DATE)<3"
311,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status""='completed' THEN 0 ELSE 1 END)/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') GROUP BY ""Request_at"""
312,"WITH ""T1"" AS (SELECT ""Request_at"",""Client_Id"",""Driver_Id"",""Status"",CASE WHEN ""Client_Id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""Banned""='Yes') THEN 0 WHEN ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""Banned""='Yes') THEN 0 ELSE 1 END AS ""ban_flg"" FROM ""Trips"" WHERE ""Request_at"" IN ('2013-10-01','2013-10-02','2013-10-03')), ""T2"" AS (SELECT ""Request_at"",SUM(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1) AS ""rat"" FROM ""T1"" WHERE ""ban_flg""=1 GROUP BY ""Request_at"") SELECT ""Request_at"" AS ""Day"",ROUND(""rat"", 2) AS ""Cancellation Rate"" FROM ""T2"""
313,"SELECT ""Request_at"" AS ""Day"",ROUND(COALESCE((SUM(CASE WHEN ""Status""='completed' THEN 0 ELSE 1 END)/COUNT(1)), 0), 2) AS ""Cancellation Rate"" FROM (""trips"" AS ""a"" LEFT JOIN ""users"" AS ""b"" ON ""a"".""client_id""=""b"".""users_id"") LEFT JOIN ""users"" AS ""c"" ON ""a"".""driver_id""=""c"".""users_id"" WHERE ""b"".""banned""!='Yes' AND ""c"".""banned""!='Yes' AND ""Request_at"" BETWEEN DATE '2013-10-01' AND DATE '2013-10-03' GROUP BY 1 ORDER BY 1"
314,"SELECT ""b"".""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""users"" AS ""a"") CROSS JOIN ""trips"" AS ""b"" WHERE ""a"".""banned""='No' AND ""a"".""users_id""=""b"".""client_id"" AND ""b"".""request_at"">='2013-10-01' AND ""b"".""request_at""<='2013-10-03' GROUP BY ""b"".""request_at"""
315,"WITH ""Unbanned"" AS (SELECT ""Trips"".* FROM (""Trips"" JOIN ""Users"" AS ""u1"" ON ""Trips"".""Client_id""=""u1"".""Users_Id"") JOIN ""Users"" AS ""u2"" ON ""Trips"".""Client_id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""Trips"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",ROUND(1.0*COUNT(CASE WHEN ""Status""!='completed' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Unbanned"" GROUP BY ""Request_at"""
316,"WITH ""temp_table"" AS (SELECT ""id"",""Client_id"",""Driver_Id"",""u"".""Banned"" AS ""UserBanned"",""Status"",""Request_at"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" WHERE ""role""='client' AND ""Banned""='No' UNION SELECT ""id"",""Client_id"",""Driver_Id"",""u"".""Banned"" AS ""UserBanned"",""Status"",""Request_at"" FROM ""Trips"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" WHERE ""role""='driver' AND ""Banned""='No') SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""temp_table"" WHERE ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' GROUP BY ""request_at"""
317,"WITH ""intermediate"" AS (SELECT ""t"".""Request_at"",COUNT(1) AS ""total_trips"",SUM(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END) AS ""total_cancels"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1) SELECT ""Request_at"" AS ""Day"",ROUND(""total_cancels""/""total_trips"", 2) AS ""Cancellation Rate"" FROM ""intermediate"" ORDER BY 1"
318,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""u1"".""Users_Id""=""t"".""Client_Id"" AND ""u1"".""Role""='client' AND ""u1"".""Banned""!='Yes') JOIN ""Users"" AS ""u2"" ON ""u2"".""Users_Id""=""t"".""Driver_Id"" AND ""u2"".""Role""='driver' AND ""u2"".""Banned""!='Yes' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
319,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""='completed' THEN 0 ELSE 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
320,"SELECT ""t"".""Request_at"" AS ""Day"",COALESCE(ROUND(SUM(CASE WHEN ""status"" LIKE 'Cancel%' THEN 1 ELSE 0 END)/COUNT(""ID""), 2)) AS ""Cancellation Rate"" FROM (""trips"" AS ""t"" LEFT JOIN ""users"" AS ""c"" ON ""t"".""client_iD""=""c"".""users_id"" AND ""c"".""role""='client') LEFT JOIN ""users"" AS ""d"" ON ""t"".""driver_id""=""d"".""users_id"" AND ""d"".""role""='driver' WHERE ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""c"".""banned""='No' AND ""d"".""banned""='No' GROUP BY ""t"".""request_at"" ORDER BY ""t"".""request_at"""
321,"WITH ""CTE"" AS (SELECT * FROM ""Users"" WHERE ""Banned""='No') SELECT ""t"".""Request_at"" AS ""Day"",ROUND((COUNT(CASE WHEN ""t"".""status""!='completed' THEN TRUE ELSE NULL END)/COUNT(1)), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""CTE"" ON ""t"".""Client_Id""=""CTE"".""Users_Id"") JOIN (SELECT * FROM ""Users"" WHERE ""Banned""='No') AS ""u2"" ON ""t"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
322,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(""t"".""Status""), 2) AS ""Cancellation Rate"" FROM (SELECT * FROM ""Trips"" WHERE ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""Role""='client') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No' AND ""Role""='driver') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""t"" GROUP BY ""Day"""
323,"SELECT ""A"".""Day"",ROUND(""A"".""canceled_number""/""A"".""total_number"", 2) AS ""Cancellation Rate"" FROM (SELECT COUNT(CASE WHEN (""Users"".""Banned""='No') THEN ""Users"".""Users_Id"" ELSE NULL END) AS ""total_number"",COUNT(CASE WHEN (""Trips"".""Status"" IN ('cancelled_by_driver','cancelled_by_client')) AND (""Users"".""Banned""='No') THEN ""Trips"".""Client_Id"" ELSE NULL END) AS ""canceled_number"",""Trips"".""Request_at"" AS ""Day"" FROM ""Trips"" JOIN ""Users"" ON ""Trips"".""Client_Id""=""Users"".""Users_Id"" WHERE ""Trips"".""Request_at"" BETWEEN DATE('2013-10-01') AND DATE('2013-10-03') GROUP BY ""Trips"".""Request_at"") AS ""A"""
324,"SELECT ""t"".""request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Users"" AS ""c"" CROSS JOIN ""Trips"" AS ""t"") JOIN ""Users"" AS ""d"" ON ""c"".""users_id""=""t"".""client_id"" AND ""t"".""driver_id""=""d"".""users_id"" WHERE ""c"".""banned""='No' AND ""d"".""banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""DAY"" ORDER BY ""DAY"""
325,"SELECT ""request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""status""!='completed' THEN 1 ELSE 0 END)/COUNT(1)), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""request_at"">='2013-10-01' AND ""request_at""<='2013-10-03' GROUP BY ""request_at"""
326,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(""cancelled"")/COUNT(""id""), 2) AS ""Cancellation Rate"" FROM (SELECT (CASE WHEN ""status""='completed' THEN 0 ELSE 1 END) AS ""cancelled"",""id"",""request_at"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u1"" ON ""t"".""client_id""=""u1"".""users_id"") JOIN ""users"" AS ""u2"" ON ""t"".""driver_id""=""u2"".""users_id"" WHERE ""u1"".""banned""='No' AND ""u2"".""banned""='No' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""t0"" GROUP BY ""Day"" ORDER BY ""Day"""
327,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""count_can"")/COUNT(DISTINCT ""Id""), 2) AS ""Cancellation Rate"" FROM (SELECT DISTINCT ""Id"",""Trips"".""Request_at"",CASE WHEN ""Trips"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END AS ""count_can"" FROM (""Trips"" JOIN ""Users"" ON ""Trips"".""Client_Id""=""Users"".""Users_Id"") JOIN ""Users"" AS ""u2"" ON ""Trips"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""Users"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""Trips"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') AS ""total"" GROUP BY ""Request_at"""
328,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(""Id""), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_Id"" IN (SELECT ""u"".""Users_Id"" FROM ""Users"" AS ""u"" WHERE ""u"".""Banned""='No') AND ""t"".""Driver_id"" IN (SELECT ""u"".""Users_Id"" FROM ""Users"" AS ""u"" WHERE ""u"".""Banned""='No') AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
329,"SELECT ""request_at"" AS ""Day"",ROUND(1-SUM(CASE WHEN ""status""='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""trips"" AS ""t1"" WHERE ""t1"".""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""role""='client' AND ""banned""='No') AND ""t1"".""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""role""='driver' AND ""banned""='No') AND ""request_at"" BETWEEN DATE('2013-10-01') AND DATE('2013-10-03') GROUP BY ""request_at"" ORDER BY DATE(""request_at"")"
330,"WITH ""cte"" AS (SELECT ""Request_at"",""client_id"",""driver_id"",""role"",""status"",""banned"" FROM ""trips"" AS ""t"" JOIN ""users"" AS ""u"" ON ""t"".""client_id""=""u"".""users_id"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" IN ('cancelled_by_driver','cancelled_by_client') AND ""role""='client' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""cte"" WHERE ""banned""='No' GROUP BY ""Request_at"" ORDER BY ""request_at"""
331,"WITH ""trips_m"" AS (SELECT ""t"".*,""c"".""banned"" AS ""c_banned"",""d"".""banned"" AS ""d_banned"" FROM ((""trips"" AS ""t"") CROSS JOIN ""users"" AS ""c"") CROSS JOIN ""users"" AS ""d"" WHERE ""t"".""client_id""=""c"".""users_id"" AND ""c"".""role""='client' AND ""t"".""driver_id""=""d"".""users_id"" AND ""d"".""role""='driver' ORDER BY ""id"") SELECT ""Request_at"" AS ""Day"",ROUND(SUM(""cancelled"")/SUM(""total_t""), 2) AS ""Cancellation Rate"" FROM (SELECT ""Request_at"",CASE WHEN (""status"" LIKE '%cancelled%' AND (""c_banned""='No' AND ""d_banned""='No')) THEN 1 ELSE 0 END AS ""cancelled"",CASE WHEN (""c_banned""='No' AND ""d_banned""='No') THEN 1 ELSE 0 END AS ""total_t"" FROM ""trips_m"") AS ""a"" GROUP BY ""Request_at"" HAVING ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' ORDER BY ""Request_at"""
332,"SELECT ""request_at"" AS ""day"",ROUND(SUM(CASE WHEN ""status""!='completed' THEN 1 ELSE 0 END)/COUNT(""Status""), 2) AS ""cancellation rate"" FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='Yes') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
333,"WITH ""tbWhole"" AS (SELECT ""t"".*,""u1"".""banned"" AS ""client_banned"",""u2"".""banned"" AS ""driver_banned"" FROM (""trips"" AS ""t"" JOIN ""users"" AS ""u1"" ON (""t"".""client_id""=""u1"".""users_id"" AND ""u1"".""role""='client')) JOIN ""users"" AS ""u2"" ON (""t"".""Driver_Id""=""u2"".""users_id"" AND ""u2"".""role""='driver') WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'), ""tbTotal"" AS (SELECT ""Request_at"",COUNT(1) AS ""total_cnt"" FROM ""tbWhole"" WHERE ""client_banned""='No' AND ""driver_banned""='No' GROUP BY ""Request_at""), ""tbCnt"" AS (SELECT ""Request_at"",COUNT(1) AS ""cnt"" FROM ""tbWhole"" WHERE ""client_banned""='No' AND ""driver_banned""='No' AND LEFT(""tbWhole"".""Status"", 9)='cancelled' GROUP BY ""Request_at"") SELECT ""tbTotal"".""Request_at"" AS ""Day"",ROUND(COALESCE(""cnt""/""total_cnt"", 0), 2) AS ""Cancellation Rate"" FROM ""tbTotal"" LEFT JOIN ""tbCnt"" ON ""tbTotal"".""Request_at""=""tbCnt"".""Request_at"""
334,"SELECT ""t"".""request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""status""!='completed' THEN 1 ELSE 0 END)/COUNT(1)), 2) AS ""Cancellation Rate"" FROM ""trips"" AS ""t"" WHERE ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""client_Id"" NOT IN (SELECT ""users_id"" FROM ""Users"" WHERE ""Banned""='Yes') GROUP BY ""request_at"" ORDER BY ""request_at"""
335,"SELECT DATE(""t"".""Request_at"") AS ""Day"",ROUND(COUNT(CASE WHEN ""t"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') THEN ""t"".""Id"" ELSE NULL END)/COUNT(""t"".""Id""), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""u1"".""Users_Id""=""t"".""Client_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""u2"".""Users_Id""=""Driver_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1 ORDER BY 1"
336,"WITH ""cte1"" AS (SELECT ""Request_at"" AS ""Day"",COUNT(1) AS ""day_count"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""t"".""Client_Id""=""c"".""Users_id"" AND ""c"".""Role""='Client' AND ""c"".""Banned""='No') JOIN ""Users"" AS ""d"" ON ""t"".""Driver_Id""=""d"".""Users_id"" AND ""d"".""Role""='Driver' AND ""d"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1), ""cte2"" AS (SELECT ""Request_at"" AS ""Day"",COUNT(1) AS ""day_count"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""c"" ON ""t"".""Client_Id""=""c"".""Users_id"" AND ""c"".""Role""='Client' AND ""c"".""Banned""='No') JOIN ""Users"" AS ""d"" ON ""t"".""Driver_Id""=""d"".""Users_id"" AND ""d"".""Role""='Driver' AND ""d"".""Banned""='No' WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' AND ""t"".""Status"" IN ('cancelled_by_driver','cancelled_by_client') GROUP BY 1) SELECT ""t"".""Request_at"" AS ""Day"",COALESCE(ROUND(""cte2"".""day_count""/""cte1"".""day_count"", 2), 0) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" LEFT JOIN ""cte1"" ON ""t"".""Request_at""=""cte1"".""Day"") LEFT JOIN ""cte2"" ON ""t"".""Request_at""=""cte2"".""Day"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
337,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(""t"".""Status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""u1"" ON ""u1"".""Users_Id""=""t"".""Client_Id"" AND ""u1"".""Banned""='No') JOIN ""Users"" AS ""u2"" ON ""u2"".""Users_Id""=""t"".""Driver_Id"" AND ""u2"".""Banned""='No' WHERE ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY (""t"".""Request_at"")"
338,"SELECT ""trip"".""Request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""trip"".""Status""='cancelled_by_driver' OR ""trip"".""Status""='cancelled_by_client' THEN 1 ELSE 0 END))/COUNT(""trip"".""Request_at""), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""trip"" WHERE ""trip"".""Request_at"">='2013-10-01' AND ""trip"".""Request_at""<='2013-10-03' AND ""trip"".""Client_Id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No') AND ""trip"".""Driver_Id"" IN (SELECT ""Users_id"" FROM ""Users"" WHERE ""Banned""='No') GROUP BY ""trip"".""Request_at"""
339,"SELECT ""Request_at"" AS ""Day"",ROUND(((SELECT COUNT(""Id"") FROM (""Trips"" AS ""t1"" JOIN ""Users"" AS ""u1"" ON (""t1"".""Client_Id""=""u1"".""Users_Id"")) JOIN ""Users"" AS ""u2"" ON (""t1"".""Driver_Id""=""u2"".""Users_Id"") WHERE ((""t1"".""Status""!='completed') AND (""u1"".""Banned""='No') AND (""u2"".""Banned""='No') AND (""t1"".""Request_at""=""t2"".""Request_at"")))/COUNT(""Id"")), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t2"" JOIN ""Users"" AS ""u3"" ON (""t2"".""Client_Id""=""u3"".""Users_Id"")) JOIN ""Users"" AS ""u4"" ON (""t2"".""Driver_Id""=""u4"".""Users_Id"") WHERE ((""t2"".""Request_at"">='2013-10-01') AND (""t2"".""Request_at""<='2013-10-03') AND (""u3"".""Banned""='No') AND (""u4"".""Banned""='No')) GROUP BY ""t2"".""Request_at"" ORDER BY ""t2"".""Request_at"""
340,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE ""status"" WHEN 'completed' THEN 0 ELSE 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" LEFT JOIN ""Users"" AS ""u1"" ON ""Trips"".""Client_Id""=""u1"".""Users_Id"") LEFT JOIN ""Users"" AS ""u2"" ON ""Trips"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Day"" ORDER BY ""Day"""
341,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""status"" LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""trips"" AS ""t"" WHERE ""client_id"" IN (SELECT ""users_id"" FROM ""Users"" WHERE ""banned""='No' AND ""role""='client' GROUP BY 1) AND ""Driver_Id"" IN (SELECT ""users_id"" FROM ""Users"" WHERE ""banned""='No' AND ""role""='driver' GROUP BY 1) AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1"
342,"SELECT ""REQUEST_AT"" AS ""DAY"",ROUND(COUNT(CASE WHEN ""STATUS""!='completed' THEN 1 END)/COUNT(1), 2) AS ""CANCELLATION RATE"" FROM (""TRIPS"" JOIN (SELECT ""USERS_ID"",""BANNED"" FROM ""USERS"" WHERE ""BANNED""='NO' AND ""ROLE""='CLIENT') AS ""C"" ON ""TRIPS"".""CLIENT_ID""=""C"".""USERS_ID"") JOIN (SELECT ""USERS_ID"",""BANNED"" FROM ""USERS"" WHERE ""BANNED""='NO' AND ""ROLE""='DRIVER') AS ""D"" ON ""TRIPS"".""DRIVER_ID""=""D"".""USERS_ID"" GROUP BY ""DAY"" HAVING ""DAY"" BETWEEN '2013-10-01' AND '2013-10-03'"
343,"SELECT ""Request_at"" AS ""DAY"",ROUND(COUNT(CASE WHEN ""status""!='completed' THEN 1 ELSE NULL END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""TRIPS"" WHERE ""CLIENT_ID"" IN (SELECT ""USERS_ID"" FROM ""USERS"" WHERE UPPER(""Banned"")!='YES') AND ""Driver_Id"" IN (SELECT ""USERS_ID"" FROM ""USERS"" WHERE UPPER(""Banned"")!='YES') AND ""Request_at"" BETWEEN CAST('2013-10-01' AS DATE) AND CAST('2013-10-03' AS DATE) GROUP BY 1"
344,"SELECT ""REQUEST_AT"" AS ""DAY"",ROUND(COUNT(CASE WHEN ""STATUS"" LIKE 'CANCELLED%' THEN 1 END)/COUNT(1), 2) AS ""CANCELLATION RATE"" FROM (""TRIPS"" JOIN ""USERS"" AS ""C"" ON ""TRIPS"".""CLIENT_ID""=""C"".""USERS_ID"") JOIN ""USERS"" AS ""D"" ON ""TRIPS"".""DRIVER_ID""=""D"".""USERS_ID"" WHERE ""C"".""BANNED""='No' AND ""D"".""BANNED""='No' AND ""REQUEST_AT"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""REQUEST_AT"""
345,"WITH ""a"" AS (SELECT ""t"".""request_at"" AS ""Day"",AVG(CASE WHEN ""status""='completed' THEN 0 ELSE 1 END) AS ""n"" FROM (""trips"" AS ""t"") CROSS JOIN ""users"" AS ""u"" WHERE ""t"".""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""t"".""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""u"".""banned""!='Yes' AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""request_at"" ORDER BY ""t"".""request_at"") SELECT ""Day"",COALESCE(ROUND(""n"", 2), 0) AS ""Cancellation Rate"" FROM ""a"""
346,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
347,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(""status""!='completed')/COUNT(1), 2) AS ""Cancellation Rate"" FROM ""trips"" WHERE ""client_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""driver_id"" IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='No') AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
348,"SELECT ""Trips"".""Request_at"" AS ""Day"",CASE WHEN ""cancellation_count"" IS NULL THEN 0.00 ELSE ROUND(""cancellation_count""/COUNT(1), 2) END AS ""Cancellation Rate"" FROM ((""Trips"" JOIN ""Users"" AS ""u3"" ON ""Trips"".""Driver_Id""=""u3"".""Users_Id"" AND ""u3"".""Role""='driver' AND ""u3"".""Banned""='No') JOIN ""Users"" AS ""u4"" ON ""Trips"".""Client_Id""=""u4"".""Users_Id"" AND ""u4"".""Role""='client' AND ""u4"".""Banned""='No') LEFT JOIN (SELECT ""Trips"".""Request_at"",COUNT(1) AS ""cancellation_count"" FROM (""Trips"" JOIN ""Users"" AS ""u1"" ON ""Trips"".""Driver_Id""=""u1"".""Users_Id"" AND ""u1"".""Role""='driver' AND ""u1"".""Banned""='No') JOIN ""Users"" AS ""u2"" ON ""Trips"".""Client_Id""=""u2"".""Users_Id"" AND ""u2"".""Role""='client' AND ""u2"".""Banned""='No' WHERE ""Status"" IN ('cancelled_by_driver','cancelled_by_client') GROUP BY ""Trips"".""Request_at"") AS ""cancelled_requests"" ON ""Trips"".""Request_at""=""cancelled_requests"".""Request_at"" WHERE ""Trips"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Trips"".""Request_at"""
349,"WITH ""new_table"" AS (SELECT ""t"".*,""u1"".""Banned"" AS ""Banned_Client"",""u2"".""Banned"" AS ""Banned_Driver"" FROM (""trips"" AS ""t"" LEFT JOIN ""users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") LEFT JOIN ""users"" AS ""u2"" ON ""t"".""Driver_ID""=""u2"".""Users_Id"") SELECT ""s"".""Request_at"" AS ""Day"",ROUND((SUM(CASE WHEN ""s"".""Banned_Client""='No' AND ""s"".""Banned_Driver""='No' AND ""s"".""Status""!='completed' THEN 1 ELSE 0 END)/SUM(CASE WHEN ""s"".""Banned_Client""='No' AND ""s"".""Banned_Driver""='No' THEN 1 ELSE NULL END)), 2) AS ""Cancellation Rate"" FROM (SELECT ""t"".*,""u1"".""Banned"" AS ""Banned_Client"",""u2"".""Banned"" AS ""Banned_Driver"" FROM (""trips"" AS ""t"" LEFT JOIN ""users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"") LEFT JOIN ""users"" AS ""u2"" ON ""t"".""Driver_ID""=""u2"".""Users_Id"") AS ""s"" GROUP BY ""s"".""Request_at"" HAVING ""s"".""Request_at"">='2013-10-01' AND ""s"".""Request_at""<='2013-10-03' ORDER BY ""Day"""
350,"WITH ""t1"" AS (SELECT * FROM ""Trips"" WHERE ""Client_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No') AND ""Driver_Id"" IN (SELECT ""Users_Id"" FROM ""Users"" WHERE ""Banned""='No')), ""t2"" AS (SELECT ""Request_at"" AS ""Day"",SUM(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END) AS ""canceled_request_unban"",COUNT(1) AS ""total_request_unban"" FROM ""t1"" WHERE ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"") SELECT ""Day"",ROUND((""canceled_request_unban""/""total_request_unban""), 2) AS ""Cancellation Rate"" FROM ""t2"""
351,"SELECT ""request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""trips"".""status""!='completed' THEN 1 ELSE 0 END)/COUNT(""trips"".""id""), 2) AS ""Cancellation Rate"" FROM ((""trips"") CROSS JOIN ""users"" AS ""driver"") CROSS JOIN ""users"" AS ""client"" WHERE ""driver"".""users_id""=""trips"".""driver_id"" AND ""client"".""users_id""=""trips"".""client_id"" AND ""driver"".""banned""='No' AND ""client"".""banned""='No' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
352,"SELECT ""Request_at"" AS ""Day"",ROUND(COUNT(CASE WHEN ""STATUS""!='completed' THEN 1 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" JOIN ""Users"" AS ""u1"" ON (""Client_Id""=""u1"".""Users_Id"")) JOIN ""Users"" AS ""u2"" ON (""Driver_Id""=""u2"".""Users_Id"") WHERE ""u1"".""Banned""='No' AND ""u2"".""Banned""='No' GROUP BY 1 HAVING ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'"
353,"SELECT ""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
354,"SELECT ""request_at"" AS ""day"",ROUND((SUM(CASE WHEN LEFT(""Status"", 9)='cancelled' THEN 1 ELSE 0 END)/COUNT(1)), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"" JOIN ""Users"" AS ""client"" ON ""client"".""users_id""=""t"".""Client_id"" AND ""client"".""banned""='No') JOIN ""Users"" AS ""driver"" ON ""driver"".""users_id""=""t"".""driver_id"" AND ""driver"".""banned""='No' WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"" ORDER BY ""request_at"""
355,"SELECT ""Request_at"" AS ""Day"",ROUND(AVG(CASE WHEN ""Status""!='completed' THEN 1 ELSE 0 END), 2) AS ""Cancellation Rate"" FROM ""Trips"" WHERE ""Client_Id"" NOT IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Driver_Id"" NOT IN (SELECT ""Users_ID"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"""
356,"WITH ""a"" AS (SELECT ""Id"",""Client_Id"",""Driver_Id"",""City_Id"",""Status"",""Request_at"",""Role"" FROM ""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u1"" ON ""t"".""Client_Id""=""u1"".""Users_Id"" WHERE ""u1"".""Banned""='No'), ""b"" AS (SELECT ""Id"",""Client_Id"",""Driver_Id"",""City_Id"",""Status"",""Request_at"",""a"".""Role"" FROM ""a"" LEFT JOIN ""Users"" AS ""u2"" ON ""a"".""Driver_Id""=""u2"".""Users_Id"" WHERE ""u2"".""Banned""='No'), ""c"" AS (SELECT ""Request_at"",COUNT(1) AS ""cnt"" FROM ""b"" WHERE ""Status""!='completed' AND ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at""), ""d"" AS (SELECT ""Request_at"",COUNT(1) AS ""cnt"" FROM ""b"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Request_at"") SELECT ""d"".""Request_at"" AS ""Day"",ROUND(COALESCE(""c"".""cnt"", 0)/""d"".""cnt"", 2) AS ""Cancellation Rate"" FROM ""c"" RIGHT JOIN ""d"" ON ""c"".""Request_at""=""d"".""Request_at"""
357,"WITH ""cte"" AS (SELECT * FROM ""trips"" WHERE ""client_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='yes') AND ""driver_id"" NOT IN (SELECT ""users_id"" FROM ""users"" WHERE ""banned""='yes')) SELECT ""request_at"" AS ""day"",ROUND(AVG(CASE WHEN ""status""='cancelled_by_driver' OR ""status""='cancelled_by_client' THEN 1 ELSE 0 END), 2) AS ""cancellation rate"" FROM ""cte"" WHERE ""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""request_at"""
358,"WITH ""tmp1"" AS (SELECT * FROM ""Trips"" WHERE ""Driver_Id"" NOT IN (SELECT ""users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Client_Id"" NOT IN (SELECT ""users_Id"" FROM ""Users"" WHERE ""Banned""='Yes') AND ""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03'), ""tmp2"" AS (SELECT ""Request_at"" AS ""Day"",SUM(CASE WHEN ""Status""='cancelled_by_driver' THEN 1 WHEN ""Status""='cancelled_by_client' THEN 1 ELSE 0 END) AS ""can_rt"",COUNT(""id"") AS ""tot_ride"" FROM ""tmp1"" GROUP BY ""Request_at"") SELECT ""Day"",ROUND(""can_rt""/""tot_ride"", 2) AS ""Cancellation Rate"" FROM ""tmp2"" ORDER BY ""Day"""
359,"WITH ""cte"" AS (SELECT ""t"".""Id"",""t"".""Client_Id"",""t"".""Driver_Id"",""t"".""City_Id"",""t"".""Status"",""t"".""Request_at"" FROM ""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""t"".""Client_Id""=""u"".""Users_Id"" WHERE (""u"".""Role""='client' AND ""u"".""Banned""='Yes') OR (""t"".""Request_at"" NOT BETWEEN '2013-10-01' AND '2013-10-03') UNION SELECT ""t"".""Id"",""t"".""Client_Id"",""t"".""Driver_Id"",""t"".""City_Id"",""t"".""Status"",""t"".""Request_at"" FROM ""Trips"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""t"".""Driver_Id""=""u"".""Users_Id"" WHERE (""u"".""Role""='driver' AND ""u"".""Banned""='Yes') OR (""t"".""Request_at"" NOT BETWEEN '2013-10-01' AND '2013-10-03')), ""cte2"" AS (SELECT * FROM ""Trips"" WHERE ""Id"" NOT IN (SELECT ""Id"" FROM ""cte"")) SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""Status""='cancelled_by_driver' OR ""Status""='cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(""Status""), 2) AS ""Cancellation Rate"" FROM ""cte2"" GROUP BY ""Request_at"""
360,"SELECT ""request_at"" AS ""Day"",CAST(SUM(""no_of_cancelled_trips"")/SUM(""no_of_non_cancelled_trips"") AS DECIMAL(10, 2)) AS ""Cancellation Rate"" FROM (SELECT CASE WHEN ""trips"".""status"" IN ('cancelled_by_client','cancelled_by_driver') THEN COUNT(""trips"".""status"") ELSE 0 END AS ""no_of_cancelled_trips"",COUNT(""status"") AS ""no_of_non_cancelled_trips"",""trips"".""request_at"" FROM (""trips"" JOIN ""users"" AS ""u_c"" ON ""trips"".""client_id""=""u_c"".""users_id"") JOIN ""users"" AS ""u_d"" ON ""trips"".""driver_id""=""u_d"".""users_id"" WHERE ""u_c"".""banned""='no' AND ""u_d"".""banned""='no' AND ""trips"".""request_at"">='2013-10-01' AND ""trips"".""request_at""<='2013-10-03' GROUP BY ""status"",""request_at"" ORDER BY ""trips"".""request_at"") AS ""SubQuery1"" GROUP BY ""SubQuery1"".""request_at"""
361,"SELECT ""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""t"".""Status""!='completed' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""t"") CROSS JOIN ""Users"" AS ""u"" WHERE ""t"".""Client_Id""=""u"".""Users_Id"" AND ""u"".""Banned""='No' AND (""t"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY ""t"".""Request_at"" ORDER BY ""t"".""Request_at"""
362,"SELECT ""t"".""Request_at"" AS ""Day"",ROUND(SUM((CASE WHEN ""t"".""status"" REGEXP 'cancelled' THEN 1 ELSE 0 END))/SUM(1), 2) AS ""Cancellation Rate"" FROM ""Trips"" AS ""t"" WHERE ""t"".""Client_Id"" NOT IN (SELECT ""u"".""Users_Id"" FROM ""Users"" AS ""u"" WHERE ""u"".""Banned""='Yes') AND ""t"".""Driver_Id"" NOT IN (SELECT ""u"".""Users_Id"" FROM ""Users"" AS ""u"" WHERE ""u"".""Banned""='Yes') AND ""t"".""request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""t"".""Request_at"""
363,"SELECT ""T"".""Request_at"" AS ""Day"",ROUND(SUM(CASE WHEN ""T"".""Status"" LIKE 'cancelled_%' THEN 1 ELSE 0 END)/COUNT(1), 2) AS ""Cancellation Rate"" FROM (""Trips"" AS ""T"" JOIN (SELECT * FROM ""Users"" WHERE ""Role""='client' AND ""Banned""='No') AS ""C"" ON ""T"".""Client_Id""=""C"".""Users_Id"") JOIN (SELECT * FROM ""Users"" WHERE ""Role""='driver' AND ""Banned""='No') AS ""D"" ON ""T"".""Driver_Id""=""D"".""Users_Id"" WHERE ""T"".""Request_at""<='2013-10-03' AND ""T"".""Request_at"">='2013-10-01' GROUP BY ""T"".""Request_at"""
364,"SELECT ""Trips_table"".""Request_at"" AS ""Day"",COALESCE(ROUND(""cancel_table"".""cancel_tl""/COUNT(""Trips_table"".""Id""), 2), 0) AS ""Cancellation Rate"" FROM (SELECT ""Trips"".""Id"",""Trips"".""Request_at"" FROM ""Trips"" JOIN ""Users"" ON ""Trips"".""Client_Id""=""Users"".""Users_Id"" WHERE ""Users"".""Banned""='No') AS ""Trips_table"" LEFT JOIN (SELECT ""Trips"".""Request_at"",COUNT(""Trips"".""Id"") AS ""cancel_tl"" FROM ""Trips"" JOIN ""Users"" ON ""Trips"".""Client_Id""=""Users"".""Users_Id"" WHERE ""Trips"".""Status""!='completed' AND ""Users"".""Banned""='No' GROUP BY ""Trips"".""Request_at"") AS ""cancel_table"" ON ""Trips_table"".""Request_at""=""cancel_table"".""Request_at"" WHERE ""Trips_table"".""Request_at"" BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY ""Trips_table"".""Request_at"""
365,"WITH ""cte"" AS (SELECT ""Status"",""Request_at"" AS ""Day"",COUNT(""Status"") OVER (PARTITION BY ""Request_at"") AS ""no_of_order"",SUM(CASE WHEN ""Status""='completed' THEN 0 ELSE 1 END) OVER (PARTITION BY ""Request_at"") AS ""no_of_cancel"" FROM (""Trips"") CROSS JOIN ""Users"" WHERE ""Client_Id""=""Users_Id"" AND ""Banned""='No') SELECT DISTINCT ""Day"",ROUND(""no_of_cancel""/""no_of_order"", 2) AS ""Cancellation Rate"" FROM ""cte"" WHERE ""Day"" BETWEEN '2013-10-01' AND '2013-10-03'"
