id,original query
1,"SELECT ""user_id"",""user_name"",SUM(CASE WHEN ""user_id""=""paid_by"" THEN -1*""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" ELSE 0 END)+""credit"" AS ""credit"",(CASE WHEN SUM(CASE WHEN ""user_id""=""paid_by"" THEN -1*""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" ELSE 0 END)+""credit"">0 THEN 'No' WHEN SUM(CASE WHEN ""user_id""=""paid_by"" THEN -1*""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" ELSE 0 END)+""credit""<0 THEN 'Yes' END) AS ""credit_limit_breached"" FROM ""users"" LEFT JOIN ""transactions"" ON ""users"".""user_id""=""transactions"".""paid_by"" OR ""users"".""user_id""=""transactions"".""paid_to"" GROUP BY ""user_id"""
2,"WITH ""t1"" AS (SELECT ""user_id"",""user_name"",SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" ELSE 0 END)+""credit"" AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""pb"" ON ""u"".""user_id""=""pb"".""paid_by"" OR ""u"".""user_id""=""pb"".""paid_to"" GROUP BY 1) SELECT *,CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""t1"""
3,"SELECT ""a"".""user_id"",""a"".""user_name"",SUM(""a"".""credit"") AS ""credit"",CASE WHEN SUM(""a"".""credit"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (SELECT * FROM ""Users"" UNION ALL SELECT ""u"".""user_id"",""user_name"",0-""amount"" AS ""credit"" FROM ""Transactions"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""t"".""paid_by""=""u"".""user_id"" UNION ALL SELECT ""t"".""paid_to"" AS ""user_id"",""user_name"",""amount"" AS ""credit"" FROM ""Transactions"" AS ""t"" LEFT JOIN ""Users"" AS ""u"" ON ""t"".""paid_to""=""u"".""user_id"") AS ""a"" GROUP BY ""a"".""user_id"""
4,"WITH ""cte"" AS (SELECT ""id"",SUM(""amount"") AS ""credit"" FROM (SELECT ""paid_by"" AS ""id"",SUM(-""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1 UNION ALL SELECT ""paid_to"" AS ""id"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""a"" GROUP BY 1) SELECT ""a"".""user_id"",""a"".""user_name"",COALESCE((""a"".""credit""+""b"".""credit""), ""a"".""credit"") AS ""credit"",CASE WHEN (COALESCE((""a"".""credit""+""b"".""credit""), ""a"".""credit""))>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""user_id""=""b"".""id"""
5,"WITH ""u"" AS (SELECT * FROM ""users""), ""t"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_by""), ""k"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_to"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""-COALESCE(""t"".""amount"", 0)+COALESCE(""k"".""amount"", 0) AS ""credit"",CASE WHEN ""u"".""credit""-COALESCE(""t"".""amount"", 0)+COALESCE(""k"".""amount"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (""u"" LEFT JOIN ""t"" ON ""u"".""user_id""=""t"".""user_id"") LEFT JOIN ""k"" ON ""u"".""user_id""=""k"".""user_id"" ORDER BY ""u"".""user_id"""
6,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""p_id"",""trans_id"",-(""amount"") AS ""amt"" FROM ""Transactions"" UNION SELECT ""paid_to"" AS ""p_id"",""trans_id"",""amount"" AS ""amt"" FROM ""Transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",MAX(""u"".""credit"")+COALESCE(SUM(""amt""), 0) AS ""credit"",CASE WHEN MAX(""u"".""credit"")+COALESCE(SUM(""amt""), 0)>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" AS ""t"" ON ""u"".""user_id""=""t"".""p_id"" GROUP BY ""user_id"""
7,"WITH ""CTE"" AS (SELECT ""user_id"",""user_name"",COALESCE(SUM(CASE WHEN ""user_id""=""paid_by"" THEN -1*""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" END), 0)+AVG(""credit"") AS ""credit"" FROM ""Users"" LEFT JOIN ""Transactions"" ON ""user_id""=""paid_by"" OR ""user_id""=""paid_to"" GROUP BY 1,2) SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""CTE"""
8,"SELECT *,(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+SUM(CASE WHEN ""t"".""paid_by""=""u"".""user_id"" THEN -""t"".""amount"" WHEN ""t"".""paid_to""=""u"".""user_id"" THEN ""t"".""amount"" ELSE 0 END)) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY 1) AS ""tmp"""
9,"WITH ""payment_cte"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"") SELECT ""user_id"",""user_name"",""credit""+COALESCE(SUM(""payment_cte"".""amount""), 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(SUM(""payment_cte"".""amount""), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" LEFT JOIN ""payment_cte"" USING (""user_id"") GROUP BY ""user_id"""
10,"SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""id"" AS ""user_id"",""user_name"",SUM(""a"".""credit"") AS ""credit"" FROM (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""credit"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""credit"" FROM ""transactions"" UNION ALL SELECT ""user_id"" AS ""id"",""credit"" AS ""credit"" FROM ""users"") AS ""a"" LEFT JOIN ""users"" ON ""users"".""user_id""=""a"".""id"" GROUP BY ""a"".""id"") AS ""b"""
11,"SELECT ""u"".""user_id"",""u"".""user_name"",(""credit""-COALESCE(""paid_amount"", 0)+COALESCE(""received_amount"", 0)) AS ""credit"",(CASE WHEN (""credit""-COALESCE(""paid_amount"", 0)+COALESCE(""received_amount"", 0))<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""paid_amount"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""received_amount"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"""
12,"ERROR: mysql parse error: line 1 column 456 near ""UNION (SELECT paid_to FROM Transactions))"" "
13,"SELECT DISTINCT ""m"".""user_id"",""m"".""user_name"",COALESCE(""m"".""credit""-""m"".""minus""+""a"".""totaladd"", ""m"".""credit"") AS ""credit"",CASE WHEN ""m"".""credit""-""m"".""minus""+""a"".""totaladd""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"") JOIN ((SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"",COALESCE(SUM(""amount""), 0) AS ""minus"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" GROUP BY ""u"".""user_id"") AS ""m"" JOIN (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"",COALESCE(SUM(""amount""), 0) AS ""totaladd"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"") AS ""a"" ON ""m"".""user_id""=""a"".""user_id"")"
14,"ERROR: mysql parse error: line 1 column 4 near ""from (select paid_by, sum(amount) as amt_paid from Transactions t group by paid_by ) a right join users u on a.paid_by = u.user_id ), after_receive_credit as (select apc.user_id, (apc.credit_left+coalesce(b.amt_received, 0)) as credit_left from (select paid_to, sum(amount) as amt_received from Transactions t group by paid_to ) b right join after_pay_credit apc on b.paid_to = apc.user_id ) select u.user_id, u.user_name, ifnull(arc.credit_left, u.credit) as credit, case when credit_left < 0 then 'Yes' else 'No' end as credit_limit_breached from after_receive_credit as arc right join users u on arc.user_id = u.user_id "" "
15,"SELECT ""a"".""user_id"",(SELECT ""user_name"" FROM ""Users"" WHERE ""Users"".""user_id""=""a"".""user_id"") AS ""user_name"",SUM(""credit"") AS ""credit"",(CASE WHEN SUM(""credit"")>=0 THEN 'No' ELSE 'Yes' END) AS ""credit_limit_breached"" FROM (SELECT ""paid_by"" AS ""user_id"",0-""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""Users"") AS ""a"" GROUP BY ""user_id"" ORDER BY ""user_id"""
16,"SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""n"".""net_amount"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""n"".""net_amount"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""user_id"",SUM(""amount"") AS ""net_amount"" FROM (SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""Transactions"") AS ""t"" GROUP BY ""user_id"") AS ""n"" ON ""u"".""user_id""=""n"".""user_id"""
17,"WITH ""updated_credit"" AS (SELECT ""user_id"",""credit""+SUM(CASE WHEN ""paid_by""=""user_id"" THEN -""amount"" ELSE 0 END)+SUM(CASE WHEN ""paid_to""=""user_id"" THEN ""amount"" ELSE 0 END) AS ""updated_credit"" FROM (""Users"") JOIN ""Transactions"" GROUP BY ""user_id"",""credit"") SELECT ""user_id"",""user_name"",""updated_credit"" AS ""credit"",CASE WHEN ""updated_credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" NATURAL LEFT JOIN ""updated_credit"""
18,"WITH ""cte_credit"" AS (SELECT ""user_id"",""user_name"",COALESCE(SUM(""amount""), 0) AS ""total_credit"" FROM ""Users"" LEFT JOIN ""Transactions"" ON ""user_id""=""paid_by"" GROUP BY 1,2), ""cte_debit"" AS (SELECT ""user_id"",""user_name"",COALESCE(SUM(""amount""), 0) AS ""total_debit"" FROM ""Users"" LEFT JOIN ""Transactions"" ON ""user_id""=""paid_to"" GROUP BY 1,2) SELECT ""tbl"".*,CASE WHEN ""tbl"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",((""u"".""credit""+""cd"".""total_debit"")-""cc"".""total_credit"") AS ""credit"" FROM (""Users"" AS ""u"" JOIN ""cte_credit"" AS ""cc"" ON ""cc"".""user_id""=""u"".""user_id"") JOIN ""cte_debit"" AS ""cd"" ON ""cd"".""user_id""=""u"".""user_id"") AS ""tbl"""
19,"WITH ""trans"" AS (SELECT ""trans_id"",""paid_by"",""paid_to"",(CASE WHEN ""paid_by"" THEN (-""amount"") END) AS ""paid"",(CASE WHEN ""paid_to"" THEN ""amount"" END) AS ""recived"" FROM ""Transactions""), ""full_trans"" AS (SELECT ""paid_by"" AS ""user_id"",""paid"" AS ""amount"" FROM ""trans"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""recived"" AS ""amount"" FROM ""trans"" UNION ALL SELECT ""user_id"" AS ""user_id"",""credit"" AS ""amount"" FROM ""Users"") SELECT ""U"".""user_id"",""U"".""user_name"",SUM(""full_trans"".""amount"") AS ""credit"",(CASE WHEN SUM(""full_trans"".""amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""U"" LEFT JOIN ""full_trans"" ON ""U"".""user_id""=""full_trans"".""user_id"" GROUP BY 1"
20,"SELECT ""U"".""user_id"" AS ""USER_ID"",""user_name"" AS ""USER_NAME"",COALESCE(SUM(""x"".""money""), 0)+""U"".""CREDIT"" AS ""CREDIT"",CASE WHEN COALESCE(SUM(""x"".""money""), 0)+""U"".""CREDIT"">0 THEN 'No' ELSE 'Yes' END AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""money"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""money"" FROM ""Transactions"") AS ""x"" RIGHT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""x"".""id"" GROUP BY 1"
21,"SELECT ""user_id"",""user_name"",(""credit""+COALESCE(SUM(CASE WHEN ""USER_ID""=""PAID_BY"" THEN -""amount"" ELSE ""amount"" END), 0)) AS ""credit"",CASE WHEN (""credit""+COALESCE(SUM(CASE WHEN ""USER_ID""=""PAID_BY"" THEN -""amount"" ELSE ""amount"" END), 0))>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""user_id"",""user_name"""
22,"WITH ""a"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""cash_out"" FROM ""transactions"" GROUP BY 1), ""b"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""cash_in"" FROM ""transactions"" GROUP BY 1) SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""-COALESCE(""a"".""cash_out"", 0)+COALESCE(""b"".""cash_in"", 0) AS ""credit"",CASE WHEN ""u"".""credit""-COALESCE(""a"".""cash_out"", 0)+COALESCE(""b"".""cash_in"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (""users"" AS ""u"" LEFT JOIN ""a"" ON ""u"".""user_id""=""a"".""paid_by"") LEFT JOIN ""b"" ON ""u"".""user_id""=""b"".""paid_to"""
23,"WITH ""agg"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"",SUM(COALESCE(""t1"".""amount"", 0)) AS ""to_sub"",0 AS ""to_add"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"" GROUP BY 1,2,3 UNION ALL SELECT ""u"".""user_id"",""u"".""user_name"",0,0 AS ""to_sub"",SUM(COALESCE(""t2"".""amount"", 0)) AS ""to_add"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"" GROUP BY 1,2,3) SELECT ""user_id"",""user_name"",SUM(""credit""-""to_sub""+""to_add"") AS ""credit"",CASE WHEN SUM(""credit""-""to_sub""+""to_add"")<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""agg"" GROUP BY 1,2"
24,"WITH ""b"" AS (SELECT DISTINCT ""userid"",SUM(""am"") AS ""amo"" FROM (SELECT ""paid_by"" AS ""userid"",-""amount"" AS ""am"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""userid"",""amount"" AS ""am"" FROM ""Transactions"") AS ""a"" GROUP BY ""a"".""userid"") SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+COALESCE(""b"".""amo"", 0)) AS ""credit"",(CASE WHEN (""u"".""credit""+COALESCE(""b"".""amo"", 0))<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""b"" ON ""b"".""userid""=""u"".""user_id"""
25,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE((""credit""+SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" END)), ""credit"") AS ""credit"",CASE WHEN ""credit""+SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" END)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id"" IN (""t"".""paid_by"",""t"".""paid_to"") GROUP BY 1"
26,"WITH ""CTE"" AS (SELECT ""id"",SUM(""amounts"") AS ""amount"" FROM (SELECT ""paid_by"" AS ""id"",SUM(-""amount"") AS ""amounts"" FROM ""Transactions"" GROUP BY ""paid_by"" UNION ALL SELECT ""paid_to"" AS ""id"",SUM(""amount"") AS ""amounts"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""xx"" GROUP BY ""id"") SELECT ""user_id"",""user_name"",CASE WHEN ""amount"" IS NULL THEN ""credit"" ELSE ""credit""+""amount"" END AS ""credit"",CASE WHEN ""amount"" IS NULL THEN 'No' WHEN ""credit""+""amount"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" LEFT JOIN ""CTE"" AS ""c"" ON ""c"".""id""=""user_id"""
27,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",'debt' AS ""type"",SUM(""amount"") AS ""amt"" FROM ""Transactions"" GROUP BY 1 UNION ALL SELECT ""paid_to"",'credit' AS ""type"",SUM(""amount"") AS ""amt"" FROM ""Transactions"" GROUP BY 1) SELECT ""Users"".""User_id"",""Users"".""user_name"",""users"".""credit""-(COALESCE(""a"".""amt"", 0)-COALESCE(""b"".""amt"", 0)) AS ""credit"",CASE WHEN (COALESCE(""a"".""amt"", 0)-COALESCE(""b"".""amt"", 0))>""Users"".""credit"" THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" LEFT JOIN ""cte"" AS ""a"" ON ""Users"".""user_id""=""a"".""user_id"" AND ""a"".""type""='debt') LEFT JOIN ""cte"" AS ""b"" ON ""Users"".""user_id""=""b"".""user_id"" AND ""b"".""type""='credit'"
28,"WITH ""cte"" AS (SELECT ""id"",SUM(""amount"") AS ""total"" FROM ((SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amount"",""transacted_on"" FROM ""Transactions"" ORDER BY ""paid_by"") UNION ALL (SELECT ""paid_to"" AS ""id"",""amount"",""transacted_on"" FROM ""Transactions"" ORDER BY ""paid_to"")) AS ""temp"" GROUP BY ""id"") SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+COALESCE(""cte"".""total"", 0)) AS ""CREDIT"",CASE WHEN ""u"".""credit""+""cte"".""total""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""id"""
29,"WITH ""cte"" AS ((SELECT ""paid_by"",SUM(""amount""*(-1)) AS ""s"" FROM ""Transactions"" AS ""t"" GROUP BY ""paid_by"") UNION ALL (SELECT ""paid_to"",SUM(""amount"") FROM ""Transactions"" AS ""t1"" GROUP BY ""paid_to"") UNION ALL (SELECT ""user_id"",SUM(""credit"") FROM ""Users"" GROUP BY ""user_id"")) SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""c"".""s"") AS ""credit"",(CASE WHEN (SUM(""c"".""s""))<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""CTE"" AS ""c"" ON ""u"".""user_id""=""c"".""paid_by"" GROUP BY ""c"".""paid_by"""
30,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",(-1)*""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"" UNION ALL SELECT ""user_id"",""credit"" AS ""amount"" FROM ""users"") SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""amount"") AS ""credit"",CASE WHEN SUM(""amount"")>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""cte"" JOIN ""users"" AS ""u"" ON ""cte"".""user_id""=""u"".""user_id"" GROUP BY ""u"".""user_id"""
31,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""u"".""credit"" AS ""credit"",(CASE WHEN COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""u"".""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"""
32,"SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""-COALESCE(""c"".""charge"", 0)+COALESCE(""g"".""gain"", 0)) AS ""credit"",CASE WHEN (""u"".""credit""-COALESCE(""c"".""charge"", 0)+COALESCE(""g"".""gain"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""charge"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""c"" ON ""u"".""user_id""=""c"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""gain"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""g"" ON ""g"".""paid_to""=""u"".""user_id"""
33,"WITH ""trans"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amt"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""amt"" FROM ""Transactions""), ""trans1"" AS (SELECT ""user_id"",SUM(""amt"") OVER (PARTITION BY ""user_id"") AS ""amt1"" FROM ""trans"") SELECT DISTINCT ""Users"".""user_id"" AS ""USER_ID"",""user_name"" AS ""USER_NAME"",""credit""+COALESCE(""amt1"", 0) AS ""CREDIT"",CASE WHEN ""credit""+COALESCE(""amt1"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""Users"" LEFT JOIN ""trans1"" ON ""Users"".""user_id""=""trans1"".""user_id"""
34,"WITH ""cte"" AS (SELECT ""user_id"",""credit"" FROM ""Users"" UNION ALL SELECT ""paid_by"" AS ""user_id"",-1*""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",1*""amount"" FROM ""transactions"") SELECT ""a"".""user_id"",""b"".""user_name"",SUM(""a"".""credit"") AS ""credit"",CASE WHEN SUM(""a"".""credit"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""cte"" AS ""a"" JOIN ""users"" AS ""b"" USING (""user_id"") GROUP BY ""user_id"""
35,"SELECT ""user_id"",""user_name"",""credit""+""final"" AS ""credit"",CASE WHEN ""credit""+""final""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""b"".*,COALESCE(""a"".""amount"", 0) AS ""final"" FROM ""Users"" AS ""b"" LEFT JOIN (SELECT ""user_id"",SUM(""amount"") AS ""amount"" FROM (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""amount"" FROM ""Transactions"") AS ""a"" GROUP BY ""user_id"") AS ""a"" ON ""b"".""user_id""=""a"".""user_id"") AS ""c"""
36,"SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""t"".""amount"" WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""t"".""amount"" ELSE 0 END)) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY 1) AS ""tmp"""
37,"WITH ""a"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_to""), ""b"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_by"") SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""-COALESCE(""b"".""amount"", 0)+COALESCE(""a"".""amount"", 0)) AS ""credit"",CASE WHEN (""u"".""credit""-COALESCE(""b"".""amount"", 0)+COALESCE(""a"".""amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN ""a"" ON ""u"".""user_id""=""a"".""paid_to"") LEFT JOIN ""b"" ON ""u"".""user_id""=""b"".""paid_by"""
38,"SELECT ""U"".""user_id"" AS ""user_id"",""U"".""user_name"",COALESCE(SUM(""T"".""amount"")+""U"".""credit"", ""U"".""credit"") AS ""credit"",CASE WHEN SUM(""T"".""amount"")+""U"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""U"" LEFT JOIN (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amount"",""transacted_on"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"",""transacted_on"" FROM ""Transactions"") AS ""T"" ON ""U"".""user_id""=""T"".""id"" GROUP BY 1"
39,"WITH ""temp"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""credit"" FROM ""transactions"" GROUP BY ""paid_to""), ""temp2"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""debit"" FROM ""transactions"" GROUP BY ""paid_by"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""t"".""credit"", 0)-COALESCE(""t2"".""debit"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""t"".""credit"", 0)-COALESCE(""t2"".""debit"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""users"" AS ""u"" LEFT JOIN ""temp"" AS ""t"" ON ""u"".""user_id""=""t"".""user_id"") LEFT JOIN ""temp2"" AS ""t2"" ON ""u"".""user_id""=""t2"".""user_id"""
40,"SELECT ""c"".""user_id"",""c"".""user_name"",""c"".""credit"",CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""a"".""user_id"",""a"".""user_name"",(""a"".""credit""+SUM(CASE WHEN ""b"".""paid_by""=""a"".""user_id"" THEN -""amount"" WHEN ""b"".""paid_to""=""a"".""user_id"" THEN ""amount"" ELSE 0 END)) AS ""credit"" FROM ""users"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" OR ""a"".""user_id""=""b"".""paid_to"" GROUP BY 1) AS ""c"""
41,"WITH ""draft_tb"" AS (SELECT ""user_id"",""credit"" AS ""amount"",'credit' AS ""status"" FROM ""Users"" UNION ALL SELECT ""paid_by"" AS ""user_id"",""amount"",'paid_by' AS ""status"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"",'paid_to' AS ""status"" FROM ""Transactions"") SELECT DISTINCT ""dt"".""user_id"",""u"".""user_name"",SUM(CASE WHEN ""status""='credit' THEN ""amount"" ELSE 0 END)+SUM(CASE WHEN ""status""='paid_by' THEN -""amount"" ELSE 0 END)+SUM(CASE WHEN ""status""='paid_to' THEN ""amount"" ELSE 0 END) AS ""credit"",CASE WHEN SUM(CASE WHEN ""status""='credit' THEN ""amount"" ELSE 0 END)+SUM(CASE WHEN ""status""='paid_by' THEN -""amount"" ELSE 0 END)+SUM(CASE WHEN ""status""='paid_to' THEN ""amount"" ELSE 0 END)>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""draft_tb"" AS ""dt"" JOIN ""Users"" AS ""u"" ON ""dt"".""user_id""=""u"".""user_id"" GROUP BY 1,2"
42,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",(""amount""*(-1)) AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""users"") SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""c"".""credit"") AS ""credit"",(CASE WHEN SUM(""c"".""credit"")>0 THEN 'No' ELSE 'Yes' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""user_id"" GROUP BY ""u"".""user_id"""
43,"WITH ""trans"" AS ((SELECT DISTINCT (""paid_by"") AS ""user_id"",SUM(-""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_by"") UNION ALL (SELECT DISTINCT (""paid_to"") AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_to"")), ""net"" AS (SELECT ""user_id"",SUM(""amount"") AS ""net"" FROM ""trans"" GROUP BY ""user_id"") SELECT ""users"".""user_id"",""user_name"",COALESCE((""credit""+""net""), ""credit"") AS ""credit"",CASE WHEN COALESCE((""credit""+""net""), ""credit"")>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" LEFT JOIN ""net"" ON ""users"".""user_id""=""net"".""user_id"""
44,"WITH ""trans"" AS (SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""amount"" FROM ""transactions""), ""tot"" AS (SELECT ""user_id"",SUM(""amount"") AS ""amount"" FROM ""trans"" GROUP BY ""user_id""), ""final"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(""t"".""amount""+""u"".""credit"", ""u"".""credit"") AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""tot"" AS ""t"" ON ""t"".""user_id""=""u"".""user_id"" GROUP BY ""u"".""user_id"") SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""final"" ORDER BY ""user_id"""
45,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""total_amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""Transactions"") SELECT ""user_id"",""user_name"",(COALESCE(SUM(""total_amount""), 0)+""credit"") AS ""credit"",CASE WHEN (COALESCE(SUM(""total_amount""), 0)+""credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte"" RIGHT JOIN ""Users"" AS ""u"" ON ""cte"".""id""=""u"".""user_id"" GROUP BY ""id"",""user_name"""
46,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(""amount""+""credit"", ""credit"") AS ""credit"",CASE WHEN (""credit""+""amount"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""user_id"",SUM(""amount"") AS ""amount"" FROM (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""Transactions"") AS ""a"" GROUP BY ""user_id"") AS ""a"" ON ""a"".""user_id""=""u"".""user_id"""
47,"WITH ""cte"" AS (SELECT ""user_id"",""user_name"",""credit""+SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" ELSE 0 END) AS ""credit"" FROM ""users"" JOIN ""transactions"" GROUP BY 1) SELECT ""user_id"",""user_name"",""credit"",(CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END) AS ""credit_limit_breached"" FROM ""cte"""
48,"WITH ""t"" AS (SELECT ""paid_to"" AS ""user_id"",""user_name"",""amount"" AS ""credit"" FROM ""Transactions"" JOIN ""Users"" ON ""user_id""=""paid_to"" UNION ALL SELECT ""paid_by"" AS ""user_id"",""user_name"",-""amount"" AS ""credit"" FROM ""Transactions"" JOIN ""Users"" ON ""user_id""=""paid_by""), ""t2"" AS (SELECT * FROM ""t"" UNION ALL SELECT * FROM ""Users"") SELECT ""user_id"",""user_name"",SUM(""credit"") AS ""credit"",CASE WHEN SUM(""credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""t2"" GROUP BY 1,2 ORDER BY 1,2"
49,"WITH ""paid_to_table"" AS (SELECT SUM(""amount"") AS ""credit"",""paid_to"" AS ""user_id"" FROM ""transactions"" GROUP BY ""paid_to""), ""paid_by_table"" AS (SELECT -SUM(""amount"") AS ""credit"",""paid_by"" AS ""user_id"" FROM ""transactions"" GROUP BY ""paid_by""), ""credit_table"" AS (SELECT ""credit"",""user_id"" FROM ""users"" GROUP BY ""user_id"") SELECT ""user_id"",""user_name"",SUM(""temp"".""credit"") AS ""credit"",CASE WHEN SUM(""temp"".""credit"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ((SELECT * FROM ""paid_to_table"") UNION ALL (SELECT * FROM ""paid_by_table"") UNION ALL (SELECT * FROM ""credit_table"")) AS ""temp"" JOIN ""users"" USING (""user_id"") GROUP BY ""user_id"" ORDER BY ""user_id"""
50,"SELECT ""user_id"",""user_name"",(""credit""-COALESCE(""out_cash"", 0)+COALESCE(""in_cash"", 0)) AS ""credit"",CASE WHEN (""credit""-COALESCE(""out_cash"", 0)+COALESCE(""in_cash"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""U"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""out_cash"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""out_tmp"" ON ""U"".""user_id""=""out_tmp"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""in_cash"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""in_tmp"" ON ""U"".""user_id""=""in_tmp"".""paid_to"""
51,"WITH ""ctea"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"",COALESCE(SUM(""amount""), 0) AS ""sent"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" GROUP BY ""u"".""user_id""), ""cteB"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""sent"",COALESCE(SUM(""amount""), 0) AS ""received"",""u"".""credit"" FROM ""cteA"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"") SELECT ""user_id"",""user_name"",""credit_rem"" AS ""credit"",CASE WHEN ""credit_rem""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit"",(""credit""-""sent""+""received"") AS ""credit_rem"" FROM ""cteB"") AS ""t"" ORDER BY ""user_id"""
52,"SELECT *,(CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END) AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""u"".""credit""+SUM(CASE WHEN ""user_id""=""t"".""paid_by"" THEN -""amount"" WHEN ""user_id""=""t"".""paid_to"" THEN ""amount"" ELSE 0 END) AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""t"".""paid_by""=""u"".""user_id"" OR ""t"".""paid_to""=""u"".""user_id"" GROUP BY ""user_id"") AS ""T"""
53,"SELECT DISTINCT ""USER_ID"",""USER_NAME"",""credit""-COALESCE(""a1"", 0)+COALESCE(""a2"", 0) AS ""CREDIT"",CASE WHEN ""credit""-COALESCE(""a1"", 0)+COALESCE(""a2"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT DISTINCT ""USER_ID"",""USER_NAME"",""CREDIT"",""A1"",SUM(""t2"".""amount"") AS ""a2"" FROM (SELECT DISTINCT ""USER_ID"",""USER_NAME"",""CREDIT"",SUM(""t1"".""amount"") AS ""a1"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"" GROUP BY ""user_id"") AS ""x"" LEFT JOIN ""transactions"" AS ""t2"" ON ""x"".""user_id""=""t2"".""paid_to"" GROUP BY ""user_id"") AS ""x1"""
54,"WITH ""out_table"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""total_out"" FROM ""Transactions"" GROUP BY ""paid_by""), ""in_table"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""total_in"" FROM ""Transactions"" GROUP BY ""paid_to"") SELECT ""t1"".*,CASE WHEN ""t1"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",CASE WHEN ""t1"".""total_out"" IS NULL AND ""t2"".""total_in"" IS NULL THEN ""u"".""credit"" WHEN ""t1"".""total_out"" IS NULL THEN ""u"".""credit""+""t2"".""total_in"" WHEN ""t2"".""total_in"" IS NULL THEN ""u"".""credit""-""t1"".""total_out"" ELSE ""u"".""credit""-""t1"".""total_out""+""t2"".""total_in"" END AS ""credit"" FROM (""Users"" AS ""u"" LEFT JOIN ""out_table"" AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"") LEFT JOIN ""in_table"" AS ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"") AS ""t1"""
55,"SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit""+SUM(CASE WHEN ""user_id""=""b"".""paid_by"" THEN -""amount"" WHEN ""user_id""=""b"".""paid_to"" THEN ""amount"" ELSE 0 END) AS ""credit"" FROM ""users"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" OR ""a"".""user_id""=""b"".""paid_to"" GROUP BY ""user_id"",""user_name"",""a"".""credit"") AS ""t"" ORDER BY 1"
56,"WITH ""CTE1"" AS (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""amount"" FROM ""Transactions""), ""CTE2"" AS (SELECT ""id"",SUM(""amount"") AS ""current_amt"" FROM ""CTE1"" GROUP BY ""id"") SELECT ""user_id"",""user_name"",""credit""+COALESCE(""current_amt"", 0) AS ""credit"",(CASE WHEN ""credit"">=-COALESCE(""current_amt"", 0) THEN 'No' ELSE 'Yes' END) AS ""credit_limit_breached"" FROM ""Users"" LEFT JOIN ""CTE2"" ON ""Users"".""user_id""=""CTE2"".""id"""
57,"SELECT ""user_id"",""user_name"",MAX(""credit"")+SUM(""tran"") AS ""credit"",CASE WHEN MAX(""credit"")+SUM(""tran"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT *,CASE ""u"".""user_id"" WHEN ""t"".""paid_by"" THEN -""amount"" WHEN ""t"".""paid_to"" THEN ""amount"" ELSE 0 END AS ""tran"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"") AS ""tr"" GROUP BY ""user_id"""
58,"WITH ""paid"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1), ""received"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1), ""settled"" AS (SELECT ""p"".""user_id"",COALESCE(""r"".""amount"", 0)-COALESCE(""p"".""amount"", 0) AS ""net_transactions"" FROM ""paid"" AS ""p"" LEFT JOIN ""received"" AS ""r"" ON ""p"".""user_id""=""r"".""user_id"" UNION SELECT ""r"".""user_id"",COALESCE(""r"".""amount"", 0)-COALESCE(""p"".""amount"", 0) AS ""net_transactions"" FROM ""paid"" AS ""p"" RIGHT JOIN ""received"" AS ""r"" ON ""p"".""user_id""=""r"".""user_id"") SELECT ""u"".""user_id"" AS ""USER_ID"",""user_name"" AS ""USER_NAME"",""credit""+COALESCE(""net_transactions"", 0) AS ""CREDIT"",CASE WHEN ""credit""+COALESCE(""net_transactions"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""users"" AS ""u"" LEFT JOIN ""settled"" AS ""s"" ON ""s"".""user_id""=""u"".""user_id"""
59,"SELECT ""a"".""user_id"",""a"".""user_name"",SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN ""amount""*-1 WHEN ""a"".""user_id""=""b"".""paid_to"" THEN ""amount"" ELSE 0 END)+""a"".""credit"" AS ""credit"",CASE WHEN (SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN ""amount""*-1 WHEN ""a"".""user_id""=""b"".""paid_to"" THEN ""amount"" ELSE 0 END)+""a"".""credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" OR ""a"".""user_id""=""b"".""paid_to"" GROUP BY ""a"".""user_id"""
60,"WITH ""spent"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""spent"" FROM ""Transactions"" GROUP BY ""paid_by""), ""received"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""received"" FROM ""Transactions"" GROUP BY ""paid_to"") SELECT ""Users"".""user_id"",""Users"".""user_name"",""Users"".""credit""+COALESCE(""received"", 0)-COALESCE(""spent"", 0) AS ""credit"",CASE WHEN (""Users"".""credit""+COALESCE(""received"", 0)-COALESCE(""spent"", 0)<0) THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" LEFT JOIN ""spent"" USING (""user_id"")) LEFT JOIN ""received"" USING (""user_id"") ORDER BY ""user_id"""
61,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""Users"") SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""c"".""amount"") AS ""credit"",(CASE WHEN SUM(""c"".""amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""id"" GROUP BY ""u"".""user_id"",""u"".""user_name"""
62,"WITH ""main"" AS (SELECT ""user_id"",""user_name"",""credit"",SUM((CASE WHEN ""user_id""=""paid_by"" THEN (-1)*""amount"" ELSE ""amount"" END)) AS ""change_amount"" FROM ""Users"" AS ""U"" LEFT JOIN ""Transactions"" AS ""T"" ON ""user_id""=""paid_by"" OR ""user_id""=""paid_to"" GROUP BY ""user_id"") SELECT ""user_id"",""user_name"",""credit""+COALESCE(""change_amount"", 0) AS ""credit"",(CASE WHEN ""credit""+COALESCE(""change_amount"", 0)>=0 THEN 'No' ELSE 'Yes' END) AS ""credit_limit_breached"" FROM ""main"""
63,"SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+""temp"".""diff"") AS ""credit"",CASE WHEN (""u"".""credit""+""temp"".""diff"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" JOIN (SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t1"".""paid_by"" THEN -""t1"".""amount"" ELSE ""t1"".""amount"" END), 0) AS ""diff"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t1"" ON ""t1"".""paid_by""=""u"".""user_id"" OR ""t1"".""paid_to""=""u"".""user_id"" GROUP BY 1,2) AS ""temp"" ON ""u"".""user_id""=""temp"".""user_id"""
64,"SELECT ""a"".""user_id"",""a"".""user_name"",SUM(""amount"") AS ""credit"",CASE WHEN SUM(""amount"")<=0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit"",COALESCE(-""b"".""amount"", 0) AS ""amount"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" UNION ALL SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit"",COALESCE(""b"".""amount"", 0) AS ""amount"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_to"" UNION ALL SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit"",""a"".""credit"" AS ""amount"" FROM ""Users"" AS ""a"") AS ""a"" GROUP BY ""a"".""user_id"""
65,"WITH ""tmp"" AS (SELECT ""paid_by"" AS ""user_id"",""amount""*-1 AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" AS ""amount"" FROM ""Users"") SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""amount"") AS ""credit"",CASE WHEN SUM(""amount"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" JOIN ""tmp"" AS ""t"" ON ""u"".""user_id""=""t"".""user_id"" GROUP BY ""u"".""user_id"",""u"".""user_name"""
66,"SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""t2"".""amount"", 0)+COALESCE(""t1"".""amount"", 0) AS ""credit"",CASE WHEN (""u"".""credit""+COALESCE(""t2"".""amount"", 0)+COALESCE(""t1"".""amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""t"".""paid_by"",-1*SUM(""amount"") AS ""amount"" FROM ""Transactions"" AS ""t"" GROUP BY ""t"".""paid_by"") AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"") LEFT JOIN (SELECT ""t"".""paid_to"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" AS ""t"" GROUP BY ""t"".""paid_to"") AS ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"""
67,"SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit""+COALESCE(SUM(""ch""), 0) AS ""credit"" FROM (SELECT ""user_id"",""user_name"",""credit"",""paid_by"",""paid_to"",""amount"",(CASE WHEN ""user_id""=""paid_by"" THEN ""amount""*-1 ELSE ""amount"" END) AS ""ch"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t"" ON ""u"".""user_id"" IN (""t"".""paid_by"",""t"".""paid_to"")) AS ""a"" GROUP BY ""user_id"",""user_name"") AS ""b"""
68,"SELECT *,(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",""credit""+COALESCE(SUM((CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""t"".""amount"" ELSE ""t"".""amount"" END)), 0) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"",""u"".""user_name"") AS ""t"""
69,"SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+SUM(COALESCE(""received_amount"", 0))-SUM(COALESCE(""paid_amount"", 0)) AS ""credit"",CASE WHEN ""u"".""credit""+SUM(COALESCE(""received_amount"", 0))-SUM(COALESCE(""paid_amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""paid_amount"",0 AS ""received_amount"" FROM ""Transactions"" GROUP BY ""paid_by"" UNION ALL SELECT ""paid_to"" AS ""user_id"",0 AS ""paid_amount"",SUM(""amount"") AS ""received_amount"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""temp"" ON ""u"".""user_id""=""temp"".""user_id"" GROUP BY ""temp"".""user_id"",""u"".""user_name"""
70,"WITH ""t"" AS (SELECT ""id"",SUM(""amount"") AS ""amt"" FROM (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""amount"" FROM ""Transactions"") AS ""a"" GROUP BY 1) SELECT ""user_id"",""user_name"",""credit""+COALESCE(""amt"", 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(""amt"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""t"" ON ""u"".""user_id""=""t"".""id"" GROUP BY 1"
71,"WITH ""cte"" AS ((SELECT ""paid_by"",SUM(""amount""*(-1)) AS ""s"" FROM ""Transactions"" AS ""t"" GROUP BY ""paid_by"") UNION ALL (SELECT ""paid_to"",SUM(""amount"") FROM ""Transactions"" AS ""t1"" GROUP BY ""paid_to"") UNION ALL (SELECT ""user_id"",SUM(""credit"") FROM ""Users"" GROUP BY ""user_id"")) SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""c"".""s"") AS ""credit"",(CASE WHEN (SUM(""c"".""s""))<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""CTE"" AS ""c"" ON ""u"".""user_id""=""c"".""paid_by"" GROUP BY ""c"".""paid_by"""
72,"SELECT ""user_id"",""user_name"",COALESCE(SUM(""t2"".""amount""), 0)+""p"".""credit""+COALESCE(""p"".""paid_amount"", 0) AS ""credit"",CASE WHEN COALESCE(SUM(""t2"".""amount""), 0)+""p"".""credit""+COALESCE(""p"".""paid_amount"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit"",-SUM(""amount"") AS ""paid_amount"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" GROUP BY ""u"".""user_id"") AS ""p"" LEFT JOIN ""Transactions"" AS ""t2"" ON ""p"".""user_id""=""t2"".""paid_to"" GROUP BY ""p"".""user_id"""
73,"WITH ""t1"" AS (SELECT ""user_id"",""user_name"",SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" ELSE 0 END)+""credit"" AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""pb"" ON ""u"".""user_id""=""pb"".""paid_by"" OR ""u"".""user_id""=""pb"".""paid_to"" GROUP BY 1) SELECT *,CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""t1"""
74,"SELECT ""user_id"",""user_name"",(""credit""-COALESCE(""out_cash"", 0)+COALESCE(""in_cash"", 0)) AS ""credit"",CASE WHEN (""credit""-COALESCE(""out_cash"", 0)+COALESCE(""in_cash"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""out_cash"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""outc"" ON ""u"".""user_id""=""outc"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""in_cash"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""inc"" ON ""u"".""user_id""=""inc"".""paid_to"""
75,"SELECT ""b"".""user_id"",""b"".""user_name"",(""b"".""credit""-COALESCE(""c"".""credit_2"", 0)) AS ""credit"",(CASE WHEN (""b"".""credit""<""c"".""credit_2"") THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""users"" AS ""b"" LEFT JOIN (SELECT ""a"".""person"",SUM(""a"".""pay_1"") AS ""credit_2"" FROM (SELECT ""paid_by"" AS ""person"",SUM(""amount"") AS ""pay_1"" FROM ""transactions"" GROUP BY 1 UNION ALL SELECT ""paid_to"",-SUM(""amount"") AS ""pay_2"" FROM ""transactions"" GROUP BY 1) AS ""a"" GROUP BY 1) AS ""c"" ON ""b"".""user_id""=""c"".""person"""
76,"WITH ""cte"" AS (SELECT ""users"",SUM(""amt"") AS ""amt"" FROM (SELECT ""paid_by"" AS ""users"",(-1)*""amount"" AS ""amt"" FROM ""transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""transactions"") AS ""t"" GROUP BY ""users"") SELECT ""user_id"",""user_name"",""credit"",(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",(CASE WHEN (""credit""+""amt"") IS NOT NULL THEN (""credit""+""amt"") ELSE ""users"".""credit"" END) AS ""credit"" FROM ""users"" LEFT JOIN ""cte"" ON ""users"".""user_id""=""cte"".""users"") AS ""r"""
77,"SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"""
78,"WITH ""History"" AS (SELECT ""paid_by"" AS ""people"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""people"",""amount"" AS ""amount"" FROM ""Transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(SUM(""h"".""amount""), 0) AS ""credit"",(CASE WHEN ""u"".""credit""+COALESCE(SUM(""h"".""amount""), 0)<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""History"" AS ""h"" ON ""u"".""user_id""=""h"".""people"" GROUP BY ""people"""
79,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""Users""), ""cte2"" AS (SELECT ""user_id"",SUM(""credit"") AS ""credit"" FROM ""cte"" GROUP BY ""user_id"") SELECT ""cte2"".""user_id"",""u"".""user_name"",""cte2"".""credit"",(CASE WHEN ""cte2"".""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""cte2"" JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""cte2"".""user_id"""
80,"WITH ""t1"" AS (SELECT ""p"".""paid_by"",SUM(""p"".""amount"") AS ""tot_paid"" FROM ""transactions"" AS ""p"" GROUP BY ""p"".""paid_by"" ORDER BY ""p"".""paid_by""), ""t2"" AS (SELECT ""r"".""paid_to"",SUM(""r"".""amount"") AS ""tot_rec"" FROM ""transactions"" AS ""r"" GROUP BY ""r"".""paid_to"" ORDER BY ""r"".""paid_to"") SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""-COALESCE(""t1"".""tot_paid"", 0)+COALESCE(""t2"".""tot_rec"", 0)) AS ""credit"",CASE WHEN (""u"".""credit""-COALESCE(""t1"".""tot_paid"", 0)+COALESCE(""t2"".""tot_rec"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""users"" AS ""u"" LEFT JOIN ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"") LEFT JOIN ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"""
81,"SELECT ""user_id"",""user_name"",SUM(""credit""+COALESCE(""amt"", 0)) AS ""credit"",CASE WHEN SUM(""credit""+COALESCE(""amt"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""id"",SUM(""amt"") AS ""amt"" FROM (SELECT ""paid_by"" AS ""id"",SUM(-""amount"") AS ""amt"" FROM ""transactions"" GROUP BY ""paid_by"" UNION ALL SELECT ""paid_to"" AS ""id"",SUM(""amount"") AS ""amt"" FROM ""transactions"" GROUP BY ""paid_to"") AS ""s"" GROUP BY ""id"") AS ""a"" ON ""u"".""user_id""=""a"".""id"" GROUP BY 1,2"
82,"WITH ""net"" (""user_id"", ""amount"") AS (SELECT ""paid_by"",-""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""Transactions""), ""t1"" AS (SELECT ""user_id"",""user_name"",COALESCE(SUM(""net"".""amount""), 0)+""credit"" AS ""credit"" FROM ""Users"" LEFT JOIN ""net"" USING (""user_id"") GROUP BY 1) SELECT *,CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""t1"""
83,"SELECT ""user_id"",""user_name"",COALESCE(""sm""+""credit"", ""credit"") AS ""credit"",(CASE WHEN COALESCE(""sm""+""credit"", ""credit"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""id"",SUM(""amount"") AS ""sm"" FROM (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" FROM ""Transactions"") AS ""a"" GROUP BY 1) AS ""b"" RIGHT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""b"".""id"""
84,"SELECT ""user_id"",""user_name"",COALESCE(SUM(CASE WHEN ""paid_by""=""user_id"" THEN -1*""amount"" ELSE ""amount"" END), 0)+""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""paid_by""=""user_id"" THEN -1*""amount"" ELSE ""amount"" END), 0)+""credit"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""user_id"" IN (""paid_by"",""paid_to"") GROUP BY ""user_id"",""user_name"""
85,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"" UNION ALL SELECT ""user_id"",""credit"" AS ""amount"" FROM ""users"") SELECT ""user_id"",""user_name"",""credit_final"" AS ""credit"",(CASE WHEN ""credit_final"">=0 THEN 'No' ELSE 'Yes' END) AS ""credit_limit_breached"" FROM (SELECT ""user_id"",SUM(""amount"") AS ""credit_final"" FROM ""cte"" GROUP BY ""user_id"") AS ""r1"" NATURAL JOIN ""users"""
86,"SELECT ""user_id"",""user_name"",(""U"".""credit""+SUM(CASE WHEN ""U"".""user_id""=""T"".""paid_by"" THEN -""amount"" WHEN ""U"".""user_id""=""T"".""paid_to"" THEN ""amount"" ELSE 0 END)) AS ""credit"",CASE WHEN (""U"".""credit""+SUM(CASE WHEN ""U"".""user_id""=""T"".""paid_by"" THEN -""amount"" WHEN ""U"".""user_id""=""T"".""paid_to"" THEN ""amount"" ELSE 0 END))>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""U"" LEFT JOIN ""Transactions"" AS ""T"" ON ""U"".""user_id""=""T"".""paid_by"" OR ""U"".""user_id""=""T"".""paid_to"" GROUP BY ""user_id"",""user_name"""
87,"WITH ""T1"" AS (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""crdt"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""crdt"" FROM ""transactions"") SELECT ""user_id"",""user_name"",SUM(""u"".""credit""+COALESCE(""T2"".""credit"", 0)) AS ""credit"",CASE WHEN SUM(""u"".""credit""+COALESCE(""T2"".""credit"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""id"",SUM(""crdt"") AS ""credit"" FROM ""T1"" GROUP BY 1) AS ""T2"" ON ""T2"".""id""=""u"".""user_id"" GROUP BY 1,2"
88,"SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""t2"".""trans_amount"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""t2"".""trans_amount"", 0)<0 THEN 'Yes' WHEN ""u"".""credit""+COALESCE(""t2"".""trans_amount"", 0)>=0 THEN 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""user_id"",SUM(""amount"") AS ""trans_amount"" FROM ((SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""transactions"") UNION ALL (SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"")) AS ""t1"" GROUP BY ""user_id"") AS ""t2"" ON ""u"".""user_id""=""t2"".""user_id"""
89,"SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",SUM(CASE WHEN ""t"".""paid_by""=""u"".""user_id"" THEN -""t"".""amount"" ELSE 0 END)+SUM(CASE WHEN ""t"".""paid_to""=""u"".""user_id"" THEN ""t"".""amount"" ELSE 0 END)+""u"".""credit"" AS ""credit"" FROM (""Users"" AS ""u"") JOIN ""Transactions"" AS ""t"" GROUP BY ""u"".""user_id"") AS ""current_credits"""
90,"WITH ""cred_info"" AS (SELECT ""user_id"" AS ""id"",""credit"" FROM ""Users"" UNION ALL SELECT ""paid_by"" AS ""id"",""amount""*(-1) AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""credit"" FROM ""Transactions"") SELECT ""c"".""id"" AS ""user_id"",""u"".""user_name"",SUM(""c"".""credit"") AS ""credit"",CASE WHEN SUM(""c"".""credit"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""cred_info"" AS ""c"" ON ""u"".""user_id""=""c"".""id"" GROUP BY 1"
91,"SELECT ""u"".""user_id"",""u"".""user_name"",""b"".""credit"",CASE WHEN ""b"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" JOIN (SELECT ""user_id"",SUM(""amt"") AS ""credit"" FROM (SELECT ""user_id"",""credit"" AS ""amt"" FROM ""Users"" UNION ALL SELECT ""paid_by"" AS ""user_id"",""amount""*-1 AS ""amt"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount""*1 AS ""amt"" FROM ""Transactions"") AS ""a"" GROUP BY ""user_id"") AS ""b"" ON ""b"".""user_id""=""u"".""user_id"""
92,"WITH ""CTE"" AS (SELECT ""paid_by"",""paid_to"",-1*""amount"" AS ""sended"" FROM ""transactions"" UNION ALL SELECT ""paid_to"",""paid_by"",""amount"" FROM ""transactions""), ""CTE2"" AS (SELECT ""user_id"",""user_name"",""credit"",""credit""+COALESCE(SUM(""sended""), 0) AS ""balance"" FROM ""users"" AS ""a"" LEFT JOIN ""CTE"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" GROUP BY ""paid_by"") SELECT ""USER_ID"",""USER_NAME"",""balance"" AS ""CREDIT"",CASE WHEN ""balance""<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""CTE2"""
93,"SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""-COALESCE(""cashout"".""outamount"", 0)+COALESCE(""cashin"".""inamount"", 0) AS ""credit"",(CASE WHEN ""u"".""credit""-COALESCE(""cashout"".""outamount"", 0)+COALESCE(""cashin"".""inamount"", 0)<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""outamount"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""cashout"" ON ""u"".""user_id""=""cashout"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""inamount"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""cashin"" ON ""u"".""user_id""=""cashin"".""paid_to"""
94,"SELECT ""c"".""user_id"",""c"".""user_name"",(""c"".""credit""-COALESCE(""a"".""pay_amount"", 0)+COALESCE(""b"".""get_amount"", 0)) AS ""credit"",CASE WHEN (""c"".""credit""-COALESCE(""a"".""pay_amount"", 0)+COALESCE(""b"".""get_amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""c"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""pay_amount"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""a"" ON ""c"".""user_id""=""a"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""get_amount"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""b"" ON ""c"".""user_id""=""b"".""paid_to"""
95,"WITH ""CTE_1"" AS (SELECT ""USER_ID"",""USER_NAME"",""CREDIT"",SUM(COALESCE(""AMOUNT"", 0)) AS ""DDEBIT"" FROM ""USERS"" AS ""U"" LEFT JOIN ""TRANSACTIONS"" AS ""T"" ON ""U"".""USER_ID""=""T"".""PAID_BY"" GROUP BY ""USER_ID"",""USER_NAME"",""CREDIT""), ""CTE_2"" AS (SELECT ""USER_ID"",""USER_NAME"",SUM(COALESCE(""AMOUNT"", 0)) AS ""CCREDIT"" FROM ""USERS"" AS ""U"" LEFT JOIN ""TRANSACTIONS"" AS ""T"" ON ""U"".""USER_ID""=""T"".""PAID_TO"" GROUP BY ""USER_ID"",""USER_NAME"") SELECT ""USER_ID"",""USER_NAME"",""CREDIT"",CASE WHEN ""CREDIT""<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT ""C1"".""USER_ID"",""C1"".""USER_NAME"",""C2"".""CCREDIT""-""C1"".""DDEBIT""+""C1"".""CREDIT"" AS ""CREDIT"" FROM (""CTE_1"" AS ""C1"") JOIN ""CTE_2"" AS ""C2"" WHERE ""C1"".""USER_ID""=""C2"".""USER_ID"" GROUP BY ""C1"".""USER_ID"",""C1"".""USER_NAME"") AS ""X"""
96,"WITH ""t1"" AS (SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions""), ""t2"" AS (SELECT ""user_id"",SUM(""amount"") AS ""changes"" FROM ""t1"" GROUP BY 1) SELECT ""a"".""user_id"",""user_name"",""credit""+COALESCE(""changes"", 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(""changes"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""a"" LEFT JOIN ""t2"" ON ""a"".""user_id""=""t2"".""user_id"""
97,"WITH ""spent"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""spent"" FROM ""Transactions"" GROUP BY ""paid_by""), ""received"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""received"" FROM ""Transactions"" GROUP BY ""paid_to"") SELECT ""Users"".""user_id"",""Users"".""user_name"",""Users"".""credit""+COALESCE(""received"", 0)-COALESCE(""spent"", 0) AS ""credit"",CASE WHEN (""Users"".""credit""+COALESCE(""received"", 0)-COALESCE(""spent"", 0)<0) THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" LEFT JOIN ""spent"" USING (""user_id"")) LEFT JOIN ""received"" USING (""user_id"") ORDER BY ""user_id"""
98,"WITH ""final"" AS (SELECT ""user"",SUM(""amount"") AS ""amount"" FROM (SELECT ""paid_by"" AS ""user"",-(""amount"") AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user"",""amount"" FROM ""transactions"") AS ""asd"" GROUP BY ""user"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""t"".""amount"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""t"".""amount"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""final"" AS ""t"" ON ""u"".""user_id""=""t"".""user"""
99,"WITH ""CTE"" AS (SELECT ""paid_id"",SUM(""amount"") AS ""amount"" FROM (SELECT ""trans_id"",""paid_by"" AS ""paid_id"",""amount"" FROM ""Transactions"" UNION ALL SELECT ""trans_id"",""paid_to"" AS ""paid_id"",-1*""amount"" FROM ""Transactions"") AS ""t"" GROUP BY ""paid_id"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""-COALESCE(""CTE"".""amount"", 0) AS ""credit"",CASE WHEN ""u"".""credit""-COALESCE(""CTE"".""amount"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""CTE"" ON ""u"".""user_id""=""CTE"".""paid_id"""
100,"WITH ""t"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_by""), ""t1"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_to""), ""cte"" AS (SELECT ""user_id"",""user_name"",""credit""-COALESCE(""amount"", 0) AS ""credit"" FROM ""users"" LEFT JOIN ""t"" ON ""user_id""=""paid_by""), ""cte1"" AS (SELECT ""user_id"",""user_name"",""credit""+COALESCE(""amount"", 0) AS ""credit"" FROM ""cte"" LEFT JOIN ""t1"" ON ""user_id""=""paid_to"") SELECT ""user_id"",""user_name"",SUM(""credit"") AS ""credit"",(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""cte1"" GROUP BY ""user_id"""
101,"WITH ""cte_paid_by"" AS (SELECT ""paid_by"" AS ""user_id"",-SUM(""amount"") AS ""tot_sum"" FROM ""transactions"" GROUP BY ""paid_by""), ""cte_paid_to"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""tot_sum"" FROM ""transactions"" GROUP BY ""paid_to""), ""cte_paid_amount"" AS (SELECT ""user_id"",SUM(""tot_sum"") AS ""tot_sum"" FROM (SELECT * FROM ""cte_paid_by"" UNION ALL SELECT * FROM ""cte_paid_to"") AS ""t"" GROUP BY ""user_id"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""tot_sum"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""tot_sum"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""cte_paid_amount"" ON ""u"".""user_id""=""cte_paid_amount"".""user_id"""
102,"WITH ""cte"" AS (SELECT ""paid_by"",SUM(-""amount"") AS ""deducted"" FROM ""transactions"" GROUP BY ""paid_by"" UNION ALL SELECT ""paid_to"",SUM(""amount"") AS ""Incr"" FROM ""transactions"" GROUP BY ""paid_to""), ""cte1"" AS (SELECT ""paid_by"",SUM(""deducted"") AS ""amount"" FROM ""cte"" GROUP BY ""paid_by"") SELECT ""user_id"",""user_name"",""credit""+COALESCE(""amount"", 0) AS ""credit"",(CASE WHEN (""credit""+""amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""users"" AS ""a"" LEFT JOIN ""cte1"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"""
103,"WITH ""cte_credit"" AS (SELECT ""user_id"",""user_name"",COALESCE(SUM(""amount""), 0) AS ""total_credit"" FROM ""Users"" LEFT JOIN ""Transactions"" ON ""user_id""=""paid_by"" GROUP BY 1,2), ""cte_debit"" AS (SELECT ""user_id"",""user_name"",COALESCE(SUM(""amount""), 0) AS ""total_debit"" FROM ""Users"" LEFT JOIN ""Transactions"" ON ""user_id""=""paid_to"" GROUP BY 1,2) SELECT ""tbl"".*,CASE WHEN ""tbl"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",((""u"".""credit""+""cd"".""total_debit"")-""cc"".""total_credit"") AS ""credit"" FROM (""Users"" AS ""u"" JOIN ""cte_credit"" AS ""cc"" ON ""cc"".""user_id""=""u"".""user_id"") JOIN ""cte_debit"" AS ""cd"" ON ""cd"".""user_id""=""u"".""user_id"") AS ""tbl"""
104,"WITH ""t1"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_by""), ""t2"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_to""), ""t3"" AS (SELECT ""user_id"",""user_name"",""credit"",COALESCE(""t1"".""amount"", 0) AS ""paid_amount"",COALESCE(""t2"".""amount"", 0) AS ""received_amount"" FROM (""Users"" AS ""u"" LEFT JOIN ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"") LEFT JOIN ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"") SELECT ""user_id"",""user_name"",(""credit""-""paid_amount""+""received_amount"") AS ""credit"",(CASE WHEN (""credit""-""paid_amount""+""received_amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""t3"""
105,"WITH ""cte"" AS (SELECT ""temp"".""id"",SUM(""amount"") AS ""trans_amount"" FROM (SELECT ""t"".""paid_by"" AS ""id"",-""t"".""amount"" AS ""amount"" FROM ""transactions"" AS ""t"" UNION ALL SELECT ""t1"".""paid_to"" AS ""id"",""t1"".""amount"" AS ""amount"" FROM ""transactions"" AS ""t1"") AS ""temp"" GROUP BY 1) SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""c"".""trans_amount"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""c"".""trans_amount"", 0)>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""id"""
106,"SELECT ""user_id"",""user_name"",""credit""+""trans"" AS ""credit"",CASE WHEN ""credit""+""trans""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""U"".""user_id"",""U"".""user_name"",""U"".""credit"",COALESCE(SUM(CASE WHEN ""U"".""user_id""=""T"".""paid_by"" THEN -""amount"" WHEN ""U"".""user_id""=""T"".""paid_to"" THEN +""amount"" ELSE 0 END), 0) AS ""trans"" FROM ""Users"" AS ""U"" LEFT JOIN ""Transactions"" AS ""T"" ON ""U"".""user_id""=""T"".""paid_by"" OR ""U"".""user_id""=""T"".""paid_to"" GROUP BY ""U"".""user_id"",""U"".""user_name"",""U"".""credit"") AS ""TMP"""
107,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amt"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""amt"" FROM ""transactions"" UNION ALL SELECT ""user_id"",""credit"" AS ""amt"" FROM ""users"") SELECT ""cte"".""user_id"",""user_name"",SUM(""amt"") AS ""credit"",CASE WHEN SUM(""amt"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""cte"" JOIN ""users"" AS ""u"" USING (""user_id"") GROUP BY ""cte"".""user_id"",""user_name"""
108,"WITH ""paid"" (""user_id"", ""amount"") AS (SELECT ""paid_by"",SUM(""amount"") FROM ""Transactions"" GROUP BY 1), ""recieved"" (""user_id"", ""amount"") AS (SELECT ""paid_to"",SUM(""amount"") FROM ""Transactions"" GROUP BY 1), ""t1"" AS (SELECT ""user_id"",""user_name"",COALESCE(""recieved"".""amount"", 0)-COALESCE(""paid"".""amount"", 0)+""credit"" AS ""credit"" FROM (""Users"" LEFT JOIN ""paid"" USING (""user_id"")) LEFT JOIN ""recieved"" USING (""user_id"")) SELECT *,CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""t1"""
109,"WITH ""amount"" AS (SELECT ""trans_id"",""paid_by"" AS ""user_id"",CASE WHEN ""paid_by"" THEN -1*""amount"" ELSE 0 END AS ""bamount"",""transacted_on"" FROM ""transactions"" UNION ALL SELECT ""trans_id"",""paid_to"" AS ""user_id"",CASE WHEN ""paid_to"" THEN 1*""amount"" ELSE 0 END AS ""bamount"",""transacted_on"" FROM ""transactions"") SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""user_name"",""credit""+COALESCE(SUM(""bamount""), 0) AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""amount"" AS ""a"" ON ""u"".""user_id""=""a"".""user_id"" GROUP BY ""user_id"") AS ""sub"""
110,"WITH ""t1"" AS (SELECT ""user_id"",""user_name"",SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" ELSE 0 END)+""credit"" AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""pb"" ON ""u"".""user_id""=""pb"".""paid_by"" OR ""u"".""user_id""=""pb"".""paid_to"" GROUP BY 1,2,""credit"") SELECT *,CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""t1"""
111,"WITH ""a"" AS (SELECT ""all_trans"".""user_id"",SUM(""all_trans"".""credit"") AS ""credit"" FROM (SELECT ""paid_by"" AS ""user_id"",""amount""*(-1) AS ""credit"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""users"") AS ""all_trans"" GROUP BY ""all_trans"".""user_id"") SELECT ""u"".""user_id"" AS ""user_id"",""u"".""user_name"" AS ""user_name"",""a"".""credit"",CASE WHEN ""a"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""a"" ON ""u"".""user_id""=""a"".""user_id"""
112,"SELECT ""user_id"",""user_name"",COALESCE(SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""credit"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"" OR ""u"".""user_id""=""t"".""paid_by"" GROUP BY ""u"".""user_id"""
113,"WITH ""payment"" AS (SELECT ""paid_by"",-1*""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""Transactions""), ""payment_sum"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""transactions"" FROM ""payment"" GROUP BY 1) SELECT ""u"".""user_id"",""user_name"",CASE WHEN ""ps"".""transactions"" IS NOT NULL THEN ""credit""+""transactions"" ELSE ""credit"" END AS ""credit"",CASE WHEN (CASE WHEN ""ps"".""transactions"" IS NOT NULL THEN ""credit""+""transactions"" ELSE ""credit"" END)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""payment_sum"" AS ""ps"" ON ""u"".""user_id""=""ps"".""user_id"""
114,"WITH ""t"" AS (SELECT ""paid_to"" AS ""user_id"",""user_name"",""amount"" AS ""credit"" FROM ""Transactions"" JOIN ""Users"" ON ""user_id""=""paid_to"" UNION ALL SELECT ""paid_by"" AS ""user_id"",""user_name"",-""amount"" AS ""credit"" FROM ""Transactions"" JOIN ""Users"" ON ""user_id""=""paid_by""), ""t2"" AS (SELECT * FROM ""t"" UNION ALL SELECT * FROM ""Users"") SELECT ""user_id"",""user_name"",SUM(""credit"") AS ""credit"",CASE WHEN SUM(""credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""t2"" GROUP BY 1,2 ORDER BY 1,2"
115,"WITH ""paid_by"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_by""), ""paid_to"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_to"") SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit""-COALESCE(""a"".""amount"", 0)+COALESCE(""b"".""amount"", 0) AS ""credit"" FROM (""users"" AS ""u"" LEFT JOIN ""paid_by"" AS ""a"" ON ""u"".""user_id""=""a"".""paid_by"") LEFT JOIN ""paid_to"" AS ""b"" ON ""u"".""user_id""=""b"".""paid_to"") AS ""c"""
116,"SELECT ""u"".""user_id"",""user_name"",""credit""+COALESCE(SUM(""trans""), 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(SUM(""trans""), 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"" AS ""user_id"",""amount""*(-1) AS ""trans"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""trans"" FROM ""Transactions"") AS ""a"" ON ""a"".""user_id""=""u"".""user_id"" GROUP BY ""user_id"" ORDER BY 1,3"
117,"WITH ""overlimit"" AS (SELECT ""u"".""user_id"" FROM ""Users"" AS ""u"" JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" WHERE ""t"".""amount"">""u"".""credit"" GROUP BY ""u"".""user_id""), ""totalbalance"" AS (SELECT ""f"".""user_id"",(""f"".""credit""+""f"".""paidby""+""f"".""paidto"") AS ""credit"" FROM (SELECT ""u"".""user_id"",""u"".""credit"",-SUM(COALESCE(""t"".""amount"", 0)) AS ""paidby"",SUM(COALESCE(""t2"".""amount"", 0)) AS ""paidto"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""t"".""paid_by"",SUM(""t"".""amount"") AS ""amount"" FROM ""Transactions"" AS ""t"" GROUP BY ""t"".""paid_by"") AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"") LEFT JOIN (SELECT ""t2"".""paid_to"",SUM(""t2"".""amount"") AS ""amount"" FROM ""Transactions"" AS ""t2"" GROUP BY ""t2"".""paid_to"") AS ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"" GROUP BY ""u"".""user_id"",""u"".""credit"") AS ""f"") SELECT ""u"".""user_id"",""u"".""user_name"",""totalbalance"".""credit"",CASE WHEN ""totalbalance"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN ""overlimit"" ON ""u"".""user_id""=""overlimit"".""user_id"") LEFT JOIN ""totalbalance"" ON ""u"".""user_id""=""totalbalance"".""user_id"""
118,"WITH ""cte"" AS (SELECT ""t"".""paid_by"" AS ""user_id"",""t"".""amount""*-1 AS ""amount"" FROM ""Transactions"" AS ""t"" UNION ALL SELECT ""t"".""paid_to"" AS ""user_id"",""t"".""amount"" AS ""amount"" FROM ""Transactions"" AS ""t"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(SUM(""cte"".""amount""), 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(SUM(""cte"".""amount""), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" ON ""cte"".""user_id""=""u"".""user_id"" GROUP BY 1"
119,"SELECT ""users"".""user_id"",""users"".""user_name"",""users"".""credit""+COALESCE(""sum_user_amt"".""sum_amt"", 0) AS ""credit"",CASE WHEN ""users"".""credit""+COALESCE(""sum_user_amt"".""sum_amt"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""users"" LEFT JOIN (SELECT ""user_id"",SUM(""amount"") AS ""sum_amt"" FROM ((SELECT ""paid_by"" AS ""user_id"",""amount""*(-1) AS ""amount"" FROM ""Transactions"") UNION ALL (SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""amount"" FROM ""Transactions"")) AS ""sum_amt"" GROUP BY ""user_id"") AS ""sum_user_amt"" ON ""users"".""user_id""=""sum_user_amt"".""user_id"""
120,"SELECT ""user_id"",""user_name"",""credit""+COALESCE(""amt"", 0) AS ""credit"",CASE WHEN ""credit""+""amt""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""id"",SUM(""amt"") AS ""amt"" FROM (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amt"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""amt"" FROM ""Transactions"") AS ""sub1"" GROUP BY ""id"") AS ""sub2"" ON ""u"".""user_id""=""sub2"".""id"" GROUP BY ""user_id"",""user_name"""
121,"WITH ""trans"" AS (SELECT ""user_id"",SUM(""amount"") AS ""net_amount"" FROM (SELECT ""paid_by"" AS ""user_id"",""amount""*-1 AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""transactions"") AS ""tmp"" GROUP BY 1) SELECT ""Users"".""user_id"" AS ""USER_ID"",""Users"".""user_name"" AS ""USER_NAME"",""Users"".""credit""+COALESCE(""trans"".""net_amount"", 0) AS ""CREDIT"",CASE WHEN ""Users"".""credit""+""trans"".""net_amount""<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""Users"" LEFT JOIN ""trans"" ON ""Users"".""user_id""=""trans"".""user_id"""
122,"SELECT ""temp"".*,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit""+SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" ELSE 0 END) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""user_id""=""paid_to"" OR ""user_id""=""paid_by"" GROUP BY 1) AS ""temp"""
123,"WITH ""trans"" AS (SELECT ""trans_id"",""paid_by"",""paid_to"",(CASE WHEN ""paid_by"" THEN (-""amount"") END) AS ""paid"",(CASE WHEN ""paid_to"" THEN ""amount"" END) AS ""recived"" FROM ""Transactions""), ""full_trans"" AS (SELECT ""paid_by"" AS ""user_id"",""paid"" AS ""amount"" FROM ""trans"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""recived"" AS ""amount"" FROM ""trans"" UNION ALL SELECT ""user_id"" AS ""user_id"",""credit"" AS ""amount"" FROM ""Users"") SELECT ""U"".""user_id"",""U"".""user_name"",SUM(""full_trans"".""amount"") AS ""credit"",(CASE WHEN SUM(""full_trans"".""amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""U"" LEFT JOIN ""full_trans"" ON ""U"".""user_id""=""full_trans"".""user_id"" GROUP BY 1"
124,"SELECT ""USER_ID"",""user_name"",""credit""+COALESCE(SUM(CASE WHEN ""A"".""user_id""=""B"".""paid_by"" THEN -""amount"" WHEN ""A"".""user_id""=""B"".""paid_to"" THEN ""amount"" END), 0) AS ""credit"",CASE WHEN (""credit""+COALESCE(SUM(CASE WHEN ""A"".""user_id""=""B"".""paid_by"" THEN -""amount"" WHEN ""A"".""user_id""=""B"".""paid_to"" THEN ""amount"" END), 0))>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""USERS"" AS ""A"" LEFT JOIN ""TRANSACTIONS"" AS ""B"" ON ""A"".""user_id""=""B"".""paid_by"" OR ""A"".""user_id""=""B"".""paid_to"" GROUP BY ""USER_ID"""
125,"WITH ""ctea"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"",COALESCE(SUM(""amount""), 0) AS ""sent"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" GROUP BY ""u"".""user_id""), ""cteB"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""sent"",COALESCE(SUM(""amount""), 0) AS ""received"",""u"".""credit"" FROM ""cteA"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"") SELECT ""user_id"",""user_name"",""credit_rem"" AS ""credit"",CASE WHEN ""credit_rem""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit"",(""credit""-""sent""+""received"") AS ""credit_rem"" FROM ""cteB"") AS ""t"" ORDER BY ""user_id"""
126,"WITH ""a"" AS (SELECT ""paid_by"",COALESCE(SUM(""amount""), 0) AS ""amt_paid"" FROM ""transactions"" GROUP BY ""paid_by""), ""b"" AS (SELECT ""paid_to"",COALESCE(SUM(""amount""), 0) AS ""amt_received"" FROM ""transactions"" GROUP BY ""paid_to"") SELECT ""user_id"",""user_name"",""credit""-COALESCE(""amt_paid"", 0)+COALESCE(""amt_received"", 0) AS ""credit"",CASE WHEN ""credit""-COALESCE(""amt_paid"", 0)+COALESCE(""amt_received"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""users"" AS ""u"" LEFT JOIN ""a"" AS ""a"" ON ""a"".""paid_by""=""u"".""user_id"") LEFT JOIN ""b"" AS ""b"" ON ""b"".""paid_to""=""u"".""user_id"""
127,"WITH ""cte"" AS (WITH ""cte"" AS (WITH ""cte"" AS (WITH ""cte"" AS (WITH ""cte"" AS (SELECT ""u"".*,COALESCE(""t"".""amount"", 0) AS ""given"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"") SELECT ""user_id"",""user_name"",""credit"",SUM(""given"") AS ""given_final"" FROM ""cte"" GROUP BY ""user_id"") SELECT ""c1"".*,COALESCE(""t1"".""amount"", 0) AS ""received"" FROM ""cte"" AS ""c1"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""c1"".""user_id""=""t1"".""paid_to"") SELECT ""user_id"",""user_name"",""credit"",""given_final"",SUM(""received"") AS ""received_final"" FROM ""cte"" GROUP BY ""user_id"") SELECT ""user_id"",""user_name"",""credit""-""given_final""+""received_final"" AS ""credit"" FROM ""cte"") SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte"""
128,"WITH ""t"" AS (SELECT ""paid_by"" AS ""user_id"",""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""transactions"") SELECT ""u"".""user_id"",""user_name"",""credit""-SUM(COALESCE(""amount"", 0)) AS ""credit"",CASE WHEN ""credit""-SUM(COALESCE(""amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""t"" ON ""t"".""user_id""=""u"".""user_id"" GROUP BY 1"
129,"SELECT ""Users"".""user_id"",""user_name"",(""credit""+COALESCE(""number"", 0)) AS ""credit"",(CASE WHEN (""credit""+COALESCE(""number"", 0))>=0 THEN 'No' ELSE 'Yes' END) AS ""credit_limit_breached"" FROM ""Users"" LEFT JOIN (SELECT ""user_id"",SUM(""amt"") AS ""number"" FROM (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amt"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""Transactions"") AS ""temp"" GROUP BY 1) AS ""temp1"" ON ""Users"".""user_id""=""temp1"".""user_id"""
130,"WITH ""cte"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""t"".""amount"" WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""t"".""amount"" ELSE 0 END), 0)) AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""user_id""=""t"".""paid_to"" GROUP BY 1,2) SELECT ""user_id"",""user_name"",""credit"",(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""cte"""
131,"SELECT ""user_id"",""user_name"",""u"".""credit""+SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN +""amount"" ELSE 0 END) AS ""credit"",CASE WHEN ""u"".""credit""+SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN +""amount"" ELSE 0 END)<=0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""user_id""=""paid_by"" OR ""user_id""=""paid_to"" GROUP BY ""user_id"""
132,"WITH ""t1"" AS (SELECT ""user_id"",COALESCE(SUM(""amount""), 0) AS ""sent"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" GROUP BY 1), ""t2"" AS (SELECT ""user_id"",COALESCE(SUM(""amount""), 0) AS ""received"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"" GROUP BY 1) SELECT DISTINCT ""u"".""user_id"",""user_name"",(""credit""+""received""-""sent"") AS ""credit"",CASE WHEN (""credit""+""received""-""sent"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ((""users"" AS ""u"") JOIN ""t1"") JOIN ""t2"" WHERE ""u"".""user_id""=""t1"".""user_id"" AND ""u"".""user_id""=""t2"".""user_id"""
133,"WITH ""etc"" AS (SELECT ""paid_by"" AS ""id"",SUM(-""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""id"" UNION SELECT ""paid_to"" AS ""id"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""id"") SELECT ""u"".""user_id"",""user_name"",COALESCE(SUM(""amount""), 0)+""u"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(""amount""), 0)+""u"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""etc"" RIGHT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""etc"".""id"" GROUP BY ""id"""
134,"WITH ""sum_trans"" AS (SELECT ""user_id"",SUM(""amount"") AS ""credit"" FROM (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"") AS ""a"" GROUP BY ""user_id"") SELECT ""a"".""user_id"",""a"".""user_name"",COALESCE(""a"".""credit"", 0)+COALESCE(""b"".""credit"", 0) AS ""credit"",CASE WHEN COALESCE(""a"".""credit"", 0)+COALESCE(""b"".""credit"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""a"" LEFT JOIN ""sum_trans"" AS ""b"" USING (""user_id"")"
135,"WITH ""credits"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""Users""), ""total_credits"" AS (SELECT ""user_id"",SUM(""credit"") AS ""credit"" FROM ""credits"" GROUP BY ""user_id"") SELECT ""u"".""user_id"",""u"".""user_name"",""t"".""credit"",CASE WHEN ""t"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""total_credits"" AS ""t"" JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""t"".""user_id"""
136,"SELECT ""a"".""user_id"",""a"".""user_name"",COALESCE((""a"".""new_credit""+SUM(""t2"".""amount"")), ""a"".""new_credit"") AS ""credit"",CASE WHEN COALESCE((""a"".""new_credit""+SUM(""t2"".""amount"")), ""a"".""new_credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(""u"".""credit""-SUM(""t"".""amount""), ""u"".""credit"") AS ""new_credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" GROUP BY ""t"".""paid_by"") AS ""a"" LEFT JOIN ""Transactions"" AS ""t2"" ON ""a"".""user_id""=""t2"".""paid_to"" GROUP BY ""t2"".""paid_to"""
137,"WITH ""cte_paid_by"" AS (SELECT ""paid_by"" AS ""user_id"",-SUM(""amount"") AS ""tot_sum"" FROM ""transactions"" GROUP BY ""paid_by""), ""cte_paid_to"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""tot_sum"" FROM ""transactions"" GROUP BY ""paid_to""), ""cte_paid_amount"" AS (SELECT ""user_id"",SUM(""tot_sum"") AS ""tot_sum"" FROM (SELECT * FROM ""cte_paid_by"" UNION ALL SELECT * FROM ""cte_paid_to"") AS ""t"" GROUP BY ""user_id"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""cte_paid_amount"".""tot_sum"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""cte_paid_amount"".""tot_sum"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""cte_paid_amount"" ON ""u"".""user_id""=""cte_paid_amount"".""user_id"""
138,"WITH ""exp1"" AS (SELECT ""paid_by"" AS ""u1"",SUM(""amount"") AS ""spent"" FROM ""transactions"" GROUP BY ""paid_by""), ""exp2"" AS (SELECT ""paid_to"" AS ""u2"",SUM(""amount"") AS ""received"" FROM ""transactions"" GROUP BY ""paid_to""), ""f"" AS (SELECT ""users"".""user_id"",""users"".""user_name"",""users"".""credit"",COALESCE(""exp1"".""spent"", 0) AS ""spent"",COALESCE(""exp2"".""received"", 0) AS ""received"",(""users"".""credit""+COALESCE(""exp2"".""received"", 0))-COALESCE(""exp1"".""spent"", 0) AS ""amounts"" FROM (""users"" LEFT JOIN ""exp1"" ON ""users"".""user_id""=""exp1"".""u1"") LEFT JOIN ""exp2"" ON ""users"".""user_id""=""exp2"".""u2"") SELECT ""user_id"",""user_name"",""f"".""amounts"" AS ""credit"",CASE WHEN ""f"".""amounts"">=0 THEN 'No' ELSE 'Yes' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""f"""
139,"WITH ""tmp"" AS (SELECT ""paid_by"" AS ""user_id"",""amount""*-1 AS ""credit"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""users"") SELECT ""a"".""user_id"",""a"".""user_name"",SUM(""b"".""credit"") AS ""credit"",CASE WHEN SUM(""b"".""credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""a"" LEFT JOIN ""tmp"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" GROUP BY 1,2"
140,"SELECT ""user_id"",""user_name"",""credit""+""total_amount"" AS ""credit"",CASE WHEN ""credit""+""total_amount""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit"",SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" WHEN ""a"".""user_id""=""b"".""paid_to"" THEN ""amount"" ELSE 0 END) AS ""total_amount"" FROM ""users"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" OR ""a"".""user_id""=""b"".""paid_to"" GROUP BY 1,2,3) AS ""t"""
141,"WITH ""t"" AS (SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit"",-""b"".""amount"" AS ""tran_amount"",""b"".""transacted_on"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" UNION ALL SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit"",""b"".""amount"" AS ""tran_amount"",""b"".""transacted_on"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_to"") SELECT ""user_id"",""user_name"",MAX(""credit"")+COALESCE(SUM(""tran_amount""), 0) AS ""credit"",CASE WHEN (MAX(""credit"")+COALESCE(SUM(""tran_amount""), 0))>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""t"" GROUP BY 1,2"
142,"SELECT ""u"".""user_id"",""user_name"",""u"".""credit""+COALESCE(""temp"".""credit"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""temp"".""credit"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""user_id"",SUM(""credit"") AS ""credit"" FROM (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions"") AS ""a"" GROUP BY ""user_id"") AS ""temp"" ON ""u"".""user_id""=""temp"".""user_id"" GROUP BY ""u"".""user_id"""
143,"WITH ""tab"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",-""t"".""amount"" AS ""credit"" FROM ""users"" AS ""u"" JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" UNION ALL SELECT ""u"".""user_id"",""u"".""user_name"",""t"".""amount"" AS ""credit"" FROM ""users"" AS ""u"" JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"" UNION ALL SELECT * FROM ""users""), ""tab2"" AS (SELECT ""user_id"",""user_name"",SUM(""credit"") AS ""credit"" FROM ""tab"" GROUP BY ""user_id"") SELECT *,CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""tab2"""
144,"WITH ""draft_tb"" AS (SELECT ""user_id"",""credit"" AS ""amount"",'credit' AS ""status"" FROM ""Users"" UNION ALL SELECT ""paid_by"" AS ""user_id"",""amount"",'paid_by' AS ""status"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"",'paid_to' AS ""status"" FROM ""Transactions"") SELECT DISTINCT ""dt"".""user_id"",""u"".""user_name"",SUM(CASE WHEN ""status""='credit' THEN ""amount"" ELSE 0 END)+SUM(CASE WHEN ""status""='paid_by' THEN -""amount"" ELSE 0 END)+SUM(CASE WHEN ""status""='paid_to' THEN ""amount"" ELSE 0 END) AS ""credit"",CASE WHEN SUM(CASE WHEN ""status""='credit' THEN ""amount"" ELSE 0 END)+SUM(CASE WHEN ""status""='paid_by' THEN -""amount"" ELSE 0 END)+SUM(CASE WHEN ""status""='paid_to' THEN ""amount"" ELSE 0 END)>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""draft_tb"" AS ""dt"" JOIN ""Users"" AS ""u"" ON ""dt"".""user_id""=""u"".""user_id"" GROUP BY 1,2"
145,"WITH ""cte"" AS (SELECT ""user_id"",""user_name"",""credit"",COALESCE(SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" END), 0) AS ""charge"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""user_id"",""user_name"") SELECT ""user_id"",""user_name"",""credit""+""charge"" AS ""credit"",CASE WHEN (""credit""+""charge"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte"""
146,"SELECT ""u"".""user_id"",""user_name"",COALESCE((SUM(""amount"")+""credit""), ""credit"") AS ""credit"",CASE WHEN COALESCE((SUM(""amount"")+""credit""), ""credit"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (SELECT ""paid_by"" AS ""payment_id"",-1*""amount"" AS ""amount"",""transacted_on"" FROM ""Transactions"" AS ""t1"" UNION ALL SELECT ""paid_to"",""amount"",""transacted_on"" FROM ""Transactions"" AS ""t2"") AS ""temp"" RIGHT JOIN ""Users"" AS ""u"" ON ""temp"".""payment_id""=""u"".""user_id"" GROUP BY 1 ORDER BY 1"
147,"SELECT ""user_id"",""user_name"",""credit""+COALESCE(""trans_amount"", 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(""trans_amount"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (SELECT ""U"".""user_id"",""U"".""user_name"",""U"".""credit"",SUM(CASE WHEN ""U"".""user_id""=""T"".""paid_by"" THEN -""amount"" ELSE ""amount"" END) AS ""trans_amount"" FROM ""Users"" AS ""U"" LEFT JOIN ""Transactions"" AS ""T"" ON ""U"".""user_id""=""T"".""paid_by"" OR ""U"".""user_id""=""T"".""paid_to"" GROUP BY 1,2,3) AS ""tbl"""
148,"SELECT ""user_id"",""user_name"",(""credit""-COALESCE(""credit_x"", 0)+COALESCE(""credit_y"", 0)) AS ""credit"",CASE WHEN (""credit""-COALESCE(""credit_x"", 0)+COALESCE(""credit_y"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""t"".""amount"") AS ""credit_x"" FROM ""transactions"" AS ""t"" GROUP BY ""t"".""paid_by"") AS ""x"" ON ""u"".""user_id""=""x"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""y"".""amount"") AS ""credit_y"" FROM ""transactions"" AS ""y"" GROUP BY ""y"".""paid_to"") AS ""a"" ON ""u"".""user_id""=""a"".""paid_to"""
149,"WITH ""cte2"" AS (SELECT ""u"".""user_id"",""user_name"",COALESCE(SUM(""amount"")+""credit"", ""credit"") AS ""credit"" FROM (SELECT ""paid_by"" AS ""user_id"",-SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY 1 UNION SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY 1) AS ""cte"" RIGHT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""cte"".""user_id"" GROUP BY 1) SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte2"""
150,"WITH ""amount"" AS (SELECT ""trans_id"",""paid_by"" AS ""user_id"",CASE WHEN ""paid_by"" THEN -1*""amount"" ELSE 0 END AS ""bamount"",""transacted_on"" FROM ""transactions"" UNION ALL SELECT ""trans_id"",""paid_to"" AS ""user_id"",CASE WHEN ""paid_to"" THEN 1*""amount"" ELSE 0 END AS ""bamount"",""transacted_on"" FROM ""transactions"") SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""user_name"",""credit""+COALESCE(SUM(""bamount""), 0) AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""amount"" AS ""a"" ON ""u"".""user_id""=""a"".""user_id"" GROUP BY ""user_id"") AS ""sub"""
151,"WITH ""net_balance"" AS (SELECT ""user"",SUM(""amt"") AS ""net_amount"" FROM (SELECT ""paid_by"" AS ""user"",-SUM(""amount"") AS ""amt"" FROM ""Transactions"" GROUP BY 1 UNION ALL SELECT ""paid_to"",SUM(""amount"") FROM ""Transactions"" GROUP BY 1) AS ""t"" GROUP BY 1) SELECT ""u"".""user_id"" AS ""USER_ID"",""u"".""user_name"" AS ""USER_NAME"",""credit""+COALESCE(""net_amount"", 0) AS ""CREDIT"",CASE WHEN ""credit""+COALESCE(""net_amount"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""Users"" AS ""u"" LEFT JOIN ""net_balance"" AS ""n"" ON ""u"".""user_id""=""n"".""user"""
152,"SELECT *,(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",""credit""+COALESCE(SUM((CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""t"".""amount"" ELSE ""t"".""amount"" END)), 0) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"",""u"".""user_name"") AS ""t"""
153,"WITH ""temp"" AS (SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"",""transacted_on"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"",""transacted_on"" FROM ""transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(""u"".""credit""+""t"".""am"", ""u"".""credit"") AS ""credit"",CASE WHEN COALESCE(""u"".""credit""+""t"".""am"", ""u"".""credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""user_id"",SUM(""amount"") AS ""am"" FROM ""temp"" GROUP BY ""user_id"") AS ""t"" ON ""u"".""user_id""=""t"".""user_id"""
154,"WITH ""paying"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""paid_amt"" FROM ""Transactions"" GROUP BY 1), ""get_paid"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""paid_amt"" FROM ""Transactions"" GROUP BY 1) SELECT ""a"".""user_id"",""a"".""user_name"",""credit""+COALESCE(""c"".""paid_amt"", 0)-COALESCE(""b"".""paid_amt"", 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(""c"".""paid_amt"", 0)-COALESCE(""b"".""paid_amt"", 0)>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (""Users"" AS ""a"" LEFT JOIN ""paying"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"") LEFT JOIN ""get_paid"" AS ""c"" ON ""a"".""user_id""=""c"".""paid_to"""
155,"WITH ""trans"" AS (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amt"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""amt"" FROM ""transactions""), ""curr_total"" AS (SELECT ""id"",SUM(""amt"") AS ""trans_total"" FROM ""trans"" GROUP BY ""id"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""ct"".""trans_total"", 0) AS ""credit"",CASE WHEN (""u"".""credit""+""ct"".""trans_total"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""curr_total"" AS ""ct"" ON ""u"".""user_id""=""ct"".""id"""
156,"SELECT ""user_id"" AS ""USER_ID"",""user_name"" AS ""USER_NAME"",(""credit""+COALESCE(""amount"", 0)) AS ""CREDIT"",CASE WHEN (""credit""+COALESCE(""amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""userid"",SUM(""amount"") AS ""amount"" FROM (SELECT ""paid_by"" AS ""userid"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""userid"",""amount"" AS ""amount"" FROM ""Transactions"") AS ""tab"" GROUP BY ""userid"") AS ""tab"" ON ""u"".""user_id""=""tab"".""userid"" GROUP BY ""u"".""user_id"""
157,"WITH ""temp"" AS (SELECT ""us"".""user_id"",""us"".""user_name"",""credit""+SUM(CASE WHEN ""user_id""=""tr"".""paid_by"" THEN (-1)*""amount"" WHEN ""us"".""user_id""=""tr"".""paid_to"" THEN (1)*""amount"" ELSE 0 END) AS ""credit"" FROM ""Users"" AS ""us"" LEFT JOIN ""Transactions"" AS ""tr"" ON (""us"".""user_id""=""tr"".""paid_by"") OR (""us"".""user_id""=""tr"".""paid_to"") GROUP BY ""us"".""user_id"",""us"".""user_name"") SELECT *,(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""temp"""
158,"WITH ""T1"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""Transactions""), ""T2"" AS (SELECT ""user_id"",SUM(""amount"") AS ""net_trans"" FROM ""T1"" GROUP BY ""user_id"") SELECT ""U"".""user_id"",""U"".""user_name"",""U"".""credit""+COALESCE(""T2"".""net_trans"", 0) AS ""credit"",CASE WHEN ""U"".""credit""+COALESCE(""T2"".""net_trans"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""U"" LEFT JOIN ""T2"" ON ""U"".""user_id""=""T2"".""user_id"""
159,"WITH ""cte"" AS (SELECT ""user_id"",SUM(""amount"") AS ""amount"" FROM (SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"") AS ""a"" GROUP BY ""user_id"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""c"".""amount"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""c"".""amount"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""user_id"""
160,"SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -1*""amount"" WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""amount"" ELSE 0 END) AS ""credit"",CASE WHEN ""u"".""credit""+SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -1*""amount"" WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""amount"" ELSE 0 END)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"",""u"".""user_name"",""u"".""credit"""
161,"WITH ""trans"" AS (SELECT ""a"".""user_id"",""b"".""transacted_on"",COALESCE(-""b"".""amount"", 0) AS ""trans"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" UNION ALL SELECT ""a"".""user_id"",""b"".""transacted_on"",COALESCE(""b"".""amount"", 0) AS ""trans"" FROM ""Users"" AS ""a"" JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_to"") SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit""+SUM(""t"".""trans"") AS ""credit"",CASE WHEN ""a"".""credit""+SUM(""t"".""trans"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""a"" LEFT JOIN ""trans"" AS ""t"" USING (""user_id"") GROUP BY 1,2"
162,"WITH ""paid"" (""user_id"", ""amount"") AS (SELECT ""paid_by"",SUM(""amount"") FROM ""Transactions"" GROUP BY 1), ""recieved"" (""user_id"", ""amount"") AS (SELECT ""paid_to"",SUM(""amount"") FROM ""Transactions"" GROUP BY 1), ""t1"" AS (SELECT ""user_id"",""user_name"",COALESCE(""recieved"".""amount"", 0)-COALESCE(""paid"".""amount"", 0)+""credit"" AS ""credit"" FROM (""Users"" LEFT JOIN ""paid"" USING (""user_id"")) LEFT JOIN ""recieved"" USING (""user_id"")) SELECT *,CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""t1"""
163,"SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",""credit""+COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""t"".""amount"" ELSE ""t"".""amount"" END), 0) AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"",""u"".""user_name"") AS ""t"""
164,"WITH ""t1"" AS (SELECT ""user_id"",SUM(""transac"") AS ""transac"" FROM (SELECT ""paid_by"" AS ""user_id"",(-1)*""amount"" AS ""transac"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""transac"" FROM ""Transactions"") AS ""a"" GROUP BY ""user_id"") SELECT ""a"".""user_id"" AS ""USER_ID"",""a"".""user_name"" AS ""USER_NAME"",""a"".""credit""+COALESCE(""b"".""transac"", 0) AS ""CREDIT"",CASE WHEN ""a"".""credit""+COALESCE(""b"".""transac"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""Users"" AS ""a"" LEFT JOIN ""t1"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"""
165,"WITH ""all_tr"" AS (SELECT ""paid_by"" AS ""user_id"",""amount""*-1 AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""Transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(""a"".""amount""), 0)+""u"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(""a"".""amount""), 0)+""u"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""all_tr"" AS ""a"" RIGHT JOIN ""Users"" AS ""u"" ON ""a"".""user_id""=""u"".""user_id"" GROUP BY 1,2"
166,"SELECT ""user_id"",""user_name"",COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""a"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)>=-""a"".""credit"" THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" OR ""a"".""user_id""=""b"".""paid_to"" GROUP BY ""a"".""user_id"""
167,"WITH ""cte"" AS (SELECT ""user_id"",""user_name"",""credit"",SUM(CASE WHEN ""paid_by""=""user_id"" THEN -""amount"" ELSE 0 END) AS ""paid"",SUM(CASE WHEN ""paid_to""=""user_id"" THEN ""amount"" ELSE 0 END) AS ""recieved"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""user_id"",""user_name"") SELECT ""user_id"",""user_name"",SUM(""paid""+""recieved""+""credit"") AS ""credit"",(CASE WHEN ""paid""+""credit""+""recieved""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""cte"" GROUP BY ""user_id"""
168,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",""amount""*-1 AS ""credit"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""users""), ""cte2"" AS (SELECT ""user_id"",SUM(""credit"") AS ""credit"" FROM ""cte"" GROUP BY ""user_id"") SELECT ""u"".""user_id"",""u"".""user_name"",""cte2"".""credit"",CASE WHEN ""cte2"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte2"" RIGHT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""cte2"".""user_id"""
169,"WITH ""joined"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"" AS ""de"",COALESCE(-""t1"".""amount"", 0) AS ""given"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""t1"".""paid_by""=""u"".""user_id"" UNION ALL SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"" AS ""de"",COALESCE(""t1"".""amount"", 0) AS ""given"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""t1"".""paid_to""=""u"".""user_id""), ""cte2"" AS (SELECT ""user_id"",""user_name"",""de"",SUM(""given"") AS ""give"" FROM ""joined"" GROUP BY ""user_id"",""user_name"",""de"") SELECT ""user_id"",""user_name"",""de""+""give"" AS ""credit"",CASE WHEN ""de""+""give""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte2"""
170,"SELECT ""user_id"",""user_name"",""credit""+SUM(CASE WHEN ""paid_by""=""user_id"" THEN -""amount"" ELSE 0 END)+SUM(CASE WHEN ""paid_to""=""user_id"" THEN ""amount"" ELSE 0 END) AS ""credit"",CASE WHEN ""credit""+SUM(CASE WHEN ""paid_by""=""user_id"" THEN -""amount"" ELSE 0 END)+SUM(CASE WHEN ""paid_to""=""user_id"" THEN ""amount"" ELSE 0 END)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Transactions"" AS ""t"") JOIN ""Users"" AS ""u"" GROUP BY ""user_id"""
171,"WITH ""minus"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""pay_amount"" FROM ""transactions"" GROUP BY 1), ""plus"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""income"" FROM ""transactions"" GROUP BY 1), ""numbers"" AS (SELECT ""users"".""user_id"",""users"".""user_name"",COALESCE(""users"".""credit""+COALESCE(""plus"".""income"", 0)-COALESCE(""minus"".""pay_amount"", 0), ""credit"") AS ""credit"" FROM (""users"" LEFT JOIN ""minus"" ON ""users"".""user_id""=""minus"".""user_id"") LEFT JOIN ""plus"" ON ""users"".""user_id""=""plus"".""user_id"" GROUP BY ""user_id"") SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""numbers"""
172,"SELECT ""U"".""user_id"",""user_name"",(""credit""-""out_cash""+""in_cash"") AS ""credit"",CASE WHEN (""credit""-""out_cash""+""in_cash"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""U"" JOIN (SELECT ""U1"".""user_id"",COALESCE(SUM(""amount""), 0) AS ""out_cash"" FROM ""Users"" AS ""U1"" LEFT JOIN ""Transactions"" AS ""T1"" ON ""U1"".""user_id""=""T1"".""paid_by"" GROUP BY ""user_id"") AS ""out_tmp"" ON ""U"".""user_id""=""out_tmp"".""user_id"") JOIN (SELECT ""U2"".""user_id"",COALESCE(SUM(""amount""), 0) AS ""in_cash"" FROM ""Users"" AS ""U2"" LEFT JOIN ""Transactions"" AS ""T2"" ON ""U2"".""user_id""=""T2"".""paid_to"" GROUP BY ""user_id"") AS ""in_tmp"" ON ""U"".""user_id""=""in_tmp"".""user_id"""
173,"WITH ""temp"" AS (SELECT ""paid_by"" AS ""id"",""amount""*-1 AS ""bal"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""bal"" FROM ""transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",MAX(""u"".""credit"")+SUM(COALESCE(""bal"", 0)) AS ""credit"",CASE WHEN (MAX(""u"".""credit"")+SUM(COALESCE(""bal"", 0)))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""temp"" AS ""t"" ON ""t"".""id""=""u"".""user_id"" GROUP BY ""u"".""user_id"",""u"".""user_name"""
174,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(""c"".""amount"")+""u"".""credit"", ""u"".""credit"") AS ""credit"",(CASE WHEN COALESCE(SUM(""c"".""amount"")+""u"".""credit"", ""u"".""credit"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""user_id"" GROUP BY ""u"".""user_id"""
175,"WITH ""t1"" AS (SELECT ""u"".""user_id"",COALESCE(SUM(""t"".""amount""), 0) AS ""total_loss"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" GROUP BY ""u"".""user_id""), ""t2"" AS (SELECT ""u"".""user_id"",COALESCE(SUM(""t"".""amount""), 0) AS ""total_gain"" FROM ""users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"") SELECT ""u"".""user_id"",""u"".""user_name"",""credit""-""total_loss""+""total_gain"" AS ""credit"",CASE WHEN ""credit""-""total_loss""+""total_gain"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (""t1"" JOIN ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"") JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""t1"".""user_id"""
176,"SELECT ""c"".""user_id"",""c"".""user_name"",(""c"".""credit""-COALESCE(""a"".""pay_amount"", 0)+COALESCE(""b"".""get_amount"", 0)) AS ""credit"",CASE WHEN (""c"".""credit""-COALESCE(""a"".""pay_amount"", 0)+COALESCE(""b"".""get_amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""c"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""pay_amount"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""a"" ON ""c"".""user_id""=""a"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""get_amount"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""b"" ON ""c"".""user_id""=""b"".""paid_to"""
177,"WITH ""net"" (""user_id"", ""amount"") AS (SELECT ""paid_by"",-""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""Transactions""), ""t1"" AS (SELECT ""user_id"",""user_name"",COALESCE(SUM(""net"".""amount""), 0)+""credit"" AS ""credit"" FROM ""Users"" LEFT JOIN ""net"" USING (""user_id"") GROUP BY 1) SELECT *,CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""t1"""
178,"SELECT DISTINCT ""n"" AS ""USER_ID"",""user_name"" AS ""USER_NAME"",SUM(""entry"") OVER (PARTITION BY ""n"") AS ""CREDIT"",CASE WHEN SUM(""entry"") OVER (PARTITION BY ""n"")<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT ""user_id"" AS ""n"",""credit"" AS ""entry"" FROM ""Users"" UNION ALL SELECT ""paid_by"" AS ""n"",-1*""amount"" AS ""entry"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""n"",""amount"" AS ""entry"" FROM ""Transactions"") AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""n""=""u"".""user_id"""
179,"SELECT ""users"".""user_id"" AS ""user_id"",""users"".""user_name"" AS ""user_name"",""users"".""credit""+COALESCE(SUM(CASE WHEN ""users"".""user_id""=""trans"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0) AS ""credit"",CASE WHEN ""users"".""credit""+COALESCE(SUM(CASE WHEN ""users"".""user_id""=""trans"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""users"" LEFT JOIN ""Transactions"" AS ""trans"" ON ""users"".""user_id""=""trans"".""paid_by"" OR ""users"".""user_id""=""trans"".""paid_to"" GROUP BY ""users"".""user_id"""
180,"SELECT ""user_id"",""user_name"",COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""a"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)>=-""a"".""credit"" THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" OR ""a"".""user_id""=""b"".""paid_to"" GROUP BY ""a"".""user_id"""
181,"SELECT ""user_id"",""user_name"",COALESCE(SUM(""amount""), 0)+""credit"" AS ""credit"",CASE WHEN (COALESCE(SUM(""amount""), 0)+""credit"")>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",""credit"",CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE CASE WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""amount"" ELSE 0 END END AS ""amount"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"") AS ""temp"" GROUP BY 1,2"
182,"SELECT ""a"".""user_id"",""a"".""user_name"",(""a"".""credit""+""a"".""total"") AS ""credit"",(CASE WHEN ""a"".""credit""+""a"".""total""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"",SUM(COALESCE((CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""t"".""amount"" WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""t"".""amount"" ELSE 0 END), 0)) AS ""total"" FROM ""users"" AS ""u"" JOIN ""transactions"" AS ""t"" GROUP BY ""u"".""user_id"") AS ""a"""
183,"SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit""+COALESCE(SUM(CASE WHEN ""paid_by""=""user_id"" THEN -""amount"" WHEN ""paid_to""=""user_id"" THEN ""amount"" END), 0) AS ""credit"" FROM ""Users"" LEFT JOIN ""Transactions"" ON ""Users"".""user_id""=""Transactions"".""paid_by"" OR ""Users"".""user_id""=""Transactions"".""paid_to"" GROUP BY ""user_id"",""user_name"",""credit"") AS ""tmp"""
184,"SELECT *,(CASE WHEN ""b"".""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT ""u"".""user_id"" AS ""USER_ID"",""u"".""user_name"" AS ""USER_NAME"",(""u"".""credit""+""a"".""credit"") AS ""CREDIT"" FROM ""Users"" AS ""u"" JOIN (SELECT ""u"".""user_name"" AS ""user"",SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""amount"" ELSE 0 END) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""paid_to"" GROUP BY 1) AS ""a"" ON ""u"".""user_name""=""a"".""user"") AS ""b"""
185,"SELECT ""u"".""user_id"",""user_name"",""u"".""credit""+COALESCE(SUM(""amount""), 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(SUM(""amount""), 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"" AS ""user_Id"",-""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"") AS ""tran"" ON ""u"".""user_id""=""tran"".""user_id"" GROUP BY ""u"".""user_id"""
186,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(""amount""), 0)+""u"".""credit"" AS ""credit"",CASE WHEN SUM(""amount"") IS NOT NULL AND ""u"".""credit""+SUM(""amount"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"" AS ""user"",-""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user"",""amount"" AS ""amount"" FROM ""transactions"") AS ""t"" ON ""t"".""user""=""u"".""user_id"" GROUP BY ""u"".""user_id"",""u"".""user_name"",""u"".""credit"""
187,"SELECT ""temp"".*,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit""+SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" WHEN ""user_id""=""paid_to"" THEN ""amount"" ELSE 0 END) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""user_id""=""paid_to"" OR ""user_id""=""paid_by"" GROUP BY 1) AS ""temp"""
188,"WITH ""trans"" AS ((SELECT DISTINCT (""paid_by"") AS ""user_id"",SUM(-""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_by"") UNION ALL (SELECT DISTINCT (""paid_to"") AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_to"")), ""net"" AS (SELECT ""user_id"",SUM(""amount"") AS ""net"" FROM ""trans"" GROUP BY ""user_id"") SELECT ""users"".""user_id"",""user_name"",COALESCE((""credit""+""net""), ""credit"") AS ""credit"",CASE WHEN COALESCE((""credit""+""net""), ""credit"")>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" LEFT JOIN ""net"" ON ""users"".""user_id""=""net"".""user_id"""
189,"WITH ""cte"" AS (SELECT ""id"",SUM(""amt"") AS ""amt"" FROM (SELECT ""paid_by"" AS ""id"",0-""amount"" AS ""amt"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""amt"" FROM ""Transactions"") AS ""a"" GROUP BY 1) SELECT ""user_id"",""user_name"",""credit""+COALESCE(""amt"", 0) AS ""credit"",CASE WHEN ""credit""+""amt""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""x"" LEFT JOIN ""cte"" AS ""y"" ON ""x"".""user_id""=""y"".""id"""
190,"WITH ""cte_paid_by"" AS (SELECT ""paid_by"" AS ""user_id"",-SUM(""amount"") AS ""tot_sum"" FROM ""transactions"" GROUP BY ""paid_by""), ""cte_paid_to"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""tot_sum"" FROM ""transactions"" GROUP BY ""paid_to""), ""cte_paid_amount"" AS (SELECT ""user_id"",SUM(""tot_sum"") AS ""tot_sum"" FROM (SELECT * FROM ""cte_paid_by"" UNION ALL SELECT * FROM ""cte_paid_to"") AS ""t"" GROUP BY ""user_id"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""tot_sum"", 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(""tot_sum"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""cte_paid_amount"" ON ""u"".""user_id""=""cte_paid_amount"".""user_id"""
191,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""u"".""credit"" AS ""credit"",(CASE WHEN COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""u"".""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"""
192,"SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""-COALESCE(""t1"".""amount"", 0)+COALESCE(""t2"".""amount"", 0) AS ""credit"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"") AS ""a"""
193,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(""t"".""amount""), 0)+""u"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(""t"".""amount""), 0)+""u"".""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"") AS ""t"" RIGHT JOIN ""users"" AS ""u"" USING (""user_id"") GROUP BY ""u"".""user_id"""
194,"WITH ""paid"" AS (SELECT ""user_id"" AS ""paid_by"",SUM(COALESCE(""amount"", 0)*-1) AS ""deductable"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""t"" ON ""a"".""user_id""=""t"".""paid_by"" GROUP BY 1), ""recieved"" AS (SELECT ""user_id"" AS ""paid_to"",SUM(COALESCE(""amount"", 0)) AS ""addition"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""t"" ON ""a"".""user_id""=""t"".""paid_to"" GROUP BY 1), ""balances"" AS (SELECT ""a"".""paid_by"",COALESCE(""addition"", 0)+COALESCE(""deductable"", 0) AS ""balance"" FROM ""paid"" AS ""a"" LEFT JOIN ""recieved"" AS ""b"" ON ""paid_by""=""paid_to"" UNION SELECT ""a"".""paid_by"",COALESCE(""addition"", 0)+COALESCE(""deductable"", 0) AS ""balance"" FROM ""paid"" AS ""a"" RIGHT JOIN ""recieved"" AS ""b"" ON ""paid_by""=""paid_to"") SELECT ""user_id"",""user_name"",""credit""+COALESCE(""balance"", 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(""balance"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" JOIN ""balances"" AS ""b"" ON ""u"".""user_id""=""paid_by"""
195,"WITH ""cte"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""u"".""credit"") AS ""credit"",SUM(COALESCE(""t"".""amount"", 0)) AS ""paid"",SUM(COALESCE(""t1"".""amount"", 0)) AS ""received"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_by"") AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_to"") AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_to"" GROUP BY ""u"".""user_id"",""u"".""user_name"") SELECT ""user_id"",""user_name"",(""credit""-""paid""+""received"") AS ""credit"",CASE WHEN (""credit""-""paid""+""received"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte"""
196,"WITH ""trans_amount"" AS (SELECT ""user_id"",SUM(""amount"") AS ""total_amnt"" FROM (SELECT ""trans_id"",""paid_by"" AS ""user_id"",""amount""*(-1) AS ""amount"" FROM ""Transactions"" UNION SELECT ""trans_id"",""paid_to"" AS ""user_id"",""amount"" AS ""amount"" FROM ""Transactions"") AS ""t"" GROUP BY ""user_id"") SELECT ""u"".""user_id"" AS ""USER_ID"",""u"".""user_name"" AS ""USER_NAME"",(""u"".""credit""+COALESCE(""t"".""total_amnt"", 0)) AS ""CREDIT"",CASE WHEN (""u"".""credit""+COALESCE(""t"".""total_amnt"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""Users"" AS ""u"" LEFT JOIN ""trans_amount"" AS ""t"" ON ""u"".""user_id""=""t"".""user_id"""
197,"WITH ""temp"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions""), ""temp2"" AS (SELECT ""user_id"",SUM(""amount"") AS ""amount"" FROM ""temp"" GROUP BY ""user_id"") SELECT ""u"".""user_id"",""user_name"",""credit""+COALESCE(""amount"", 0) AS ""credit"",CASE WHEN ""credit""+""amount""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""temp2"" ON ""u"".""user_id""=""temp2"".""user_id"""
198,"WITH ""with_paid_by"" AS (SELECT ""paid_by"" AS ""paid_Id"",SUM(""amount"") AS ""paid_amount"" FROM ""Transactions"" GROUP BY ""paid_by""), ""recieved_by"" AS (SELECT ""paid_to"" AS ""recevied_Id"",SUM(""amount"") AS ""received_amount"" FROM ""Transactions"" GROUP BY ""paid_to"") SELECT ""user_id"" AS ""USER_ID"",""user_name"" AS ""USER_NAME"",""credit"" AS ""CREDIT"",CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT ""user_id"",""user_name"",COALESCE(""credit""-COALESCE(""paid_amount"", 0)+COALESCE(""received_amount"", 0), ""credit"") AS ""credit"" FROM (""Users"" AS ""u"" LEFT JOIN ""with_paid_by"" AS ""pb"" ON ""u"".""user_id""=""pb"".""paid_Id"") LEFT JOIN ""recieved_by"" AS ""rb"" ON ""u"".""user_id""=""rb"".""recevied_Id"" GROUP BY ""u"".""user_id"") AS ""t"""
199,"SELECT *,(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+SUM(CASE WHEN ""t"".""paid_by""=""u"".""user_id"" THEN -""t"".""amount"" WHEN ""t"".""paid_to""=""u"".""user_id"" THEN ""t"".""amount"" ELSE 0 END)) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY 1) AS ""tmp"""
200,"WITH ""CTE"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"")*-1 AS ""cost"" FROM ""Transactions"" GROUP BY 1 UNION ALL SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""cost"" FROM ""Transactions"" GROUP BY 1) SELECT ""CTE"".""user_id"",""u"".""user_name"",""u"".""credit""+SUM(""cte"".""cost"") AS ""credit"",CASE WHEN ""u"".""credit""+SUM(""cte"".""cost"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" JOIN ""CTE"" ON ""u"".""user_id""=""cte"".""user_id"" GROUP BY 1 UNION SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""crdit_limit_breanched"" FROM ""Users"" WHERE ""user_id"" NOT IN (SELECT ""user_id"" FROM ""CTE"")"
201,"SELECT ""user_id"",""user_name"",SUM(""credit"") AS ""credit"",CASE WHEN SUM(""credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit"" FROM ""Users"" AS ""u"" UNION SELECT ""user_id"",""user_name"",-1*SUM(""amount"") AS ""credit"" FROM ""users"" AS ""u"" JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" GROUP BY 1,2 UNION ALL SELECT ""user_id"",""user_name"",SUM(""amount"") AS ""credit"" FROM ""users"" AS ""u"" JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"" GROUP BY 1,2) AS ""x"" GROUP BY 1,2"
202,"WITH ""CTE"" AS (SELECT ""user_id"",""user_name"",COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""amount"" END), 0)+AVG(""u"".""credit"") AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"") SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""CTE"""
203,"SELECT ""tt1"".""user_id"",""user_name"",""credit""+COALESCE(""amount"", 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(""amount"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""tt1"" LEFT JOIN (SELECT ""user_id"",SUM(""amount"") AS ""amount"" FROM (SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""Transactions"") AS ""t"" GROUP BY ""user_id"") AS ""tt2"" ON ""tt1"".""user_id""=""tt2"".""user_id"""
204,"WITH ""temp"" AS (SELECT ""id"" AS ""user_id"",SUM(""amount"") AS ""credit"" FROM (SELECT ""paid_by"" AS ""id"",CASE WHEN ""paid_by"" THEN ""amount""*(-1) END AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",CASE WHEN ""paid_to"" THEN ""amount"" END AS ""amount"" FROM ""Transactions"") AS ""a"" GROUP BY ""id"") SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(""t"".""credit"", 0)+""u"".""credit"" AS ""credit"",CASE WHEN COALESCE(""t"".""credit"", 0)+""u"".""credit""<0 THEN 'Yes' WHEN COALESCE(""t"".""credit"", 0)+""u"".""credit"">0 THEN 'No' END AS ""credit_limit_breached"" FROM ""temp"" AS ""t"" RIGHT JOIN ""Users"" AS ""u"" ON ""t"".""user_id""=""u"".""user_id"""
205,"SELECT ""u"".""user_id"",""u"".""user_name"",""credit""+COALESCE(SUM(""amount""), 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(SUM(""amount""), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""amount"" FROM ""Transactions"") AS ""a"" USING (""user_id"") GROUP BY ""u"".""user_id"""
206,"SELECT ""USER_ID"",""USER_NAME"",""CREDIT"",CASE WHEN ""CREDIT""<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT ""u"".""user_id"" AS ""USER_ID"",""u"".""user_name"" AS ""USER_NAME"",""u"".""credit""-COALESCE(SUM(CASE WHEN ""t"".""paid_by""=""u"".""user_id"" THEN ""amount"" ELSE -""amount"" END), 0) AS ""CREDIT"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY 1,2) AS ""tab1"" ORDER BY 1,2"
207,"WITH ""Temp"" AS (SELECT ""paid_by"" AS ""user_id"",""amount""*-1 AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""Transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(""t"".""credit""), 0)+""u"".""credit"" AS ""credit"",CASE WHEN SUM(""t"".""credit"")+""u"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Temp"" AS ""t"" RIGHT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""t"".""user_id"" GROUP BY ""u"".""user_id"""
208,"SELECT ""c"".""user_id"",""c"".""user_name"",(""c"".""credit""-COALESCE(""a"".""pay_amount"", 0)+COALESCE(""b"".""get_amount"", 0)) AS ""credit"",CASE WHEN (""c"".""credit""-COALESCE(""a"".""pay_amount"", 0)+COALESCE(""b"".""get_amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""users"" AS ""c"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""pay_amount"" FROM ""transactions"" GROUP BY ""paid_by"") AS ""a"" ON ""c"".""user_id""=""a"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""get_amount"" FROM ""transactions"" GROUP BY ""paid_to"") AS ""b"" ON ""c"".""user_id""=""b"".""paid_to"""
209,"WITH ""cte"" AS (SELECT ""paid_by"",-""amount"" AS ""money"" FROM ""transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""transactions""), ""cte_1"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""money"") AS ""spend"" FROM ""cte"" GROUP BY ""paid_by"") SELECT ""user_id"",""user_name"",""credit""+COALESCE(""spend"", 0) AS ""credit"",CASE WHEN ""credit""+""spend""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" LEFT JOIN ""cte_1"" USING (""user_id"")"
210,"WITH ""spent_money"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""AMOUNT"") AS ""money_out"" FROM ""Transactions"" GROUP BY ""paid_by""), ""received_money"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""AMOUNT"") AS ""money_in"" FROM ""Transactions"" GROUP BY ""paid_to"") SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""-COALESCE(""s"".""money_out"", 0)+COALESCE(""r"".""money_in"", 0) AS ""credit"" FROM (""Users"" AS ""u"" LEFT JOIN ""spent_money"" AS ""s"" ON ""s"".""user_id""=""u"".""user_id"") LEFT JOIN ""received_money"" AS ""r"" ON ""u"".""user_id""=""r"".""user_id"") AS ""temp"""
211,"WITH ""t1"" AS (SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit"",SUM(COALESCE(""b"".""amount"", 0)) AS ""pay"" FROM ""users"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" GROUP BY 1,2,3), ""t2"" AS (SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit"",SUM(COALESCE(""c"".""amount"", 0)) AS ""receive"" FROM ""users"" AS ""a"" LEFT JOIN ""transactions"" AS ""c"" ON ""a"".""user_id""=""c"".""paid_to"" GROUP BY 1,2,3) SELECT ""t1"".""user_id"",""t1"".""user_name"",(""t1"".""credit""-""t1"".""pay""+""t2"".""receive"") AS ""credit"",CASE WHEN (""t1"".""credit""-""t1"".""pay""+""t2"".""receive"")>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""t1"" JOIN ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"""
212,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""User_id"",-""amount"" AS ""balance"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""User_id"",""amount"" AS ""balance"" FROM ""Transactions""), ""cte2"" AS (SELECT ""User_id"",SUM(""balance"") AS ""balance"" FROM ""cte"" GROUP BY ""User_id"") SELECT ""u"".""User_id"",""user_name"",(COALESCE(""balance"", 0)+""u"".""credit"") AS ""credit"",(CASE WHEN (COALESCE(""balance"", 0)+""u"".""credit"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""cte2"" RIGHT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""cte2"".""User_id"""
213,"WITH ""cte_credits"" AS (SELECT ""u"".""user_id"",""user_name"",SUM(COALESCE(""t_in"".""amount"", 0))+ANY_VALUE(COALESCE(""u"".""credit"", 0)) AS ""credits"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t_in"" ON ""u"".""user_id""=""t_in"".""paid_to"" GROUP BY 1,2), ""cte_debits"" AS (SELECT ""u"".""user_id"",""user_name"",SUM(COALESCE(""t_out"".""amount"", 0)) AS ""debits"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t_out"" ON ""u"".""user_id""=""t_out"".""paid_by"" GROUP BY 1,2), ""cte_assemble"" AS (SELECT ""c"".""user_id"",""c"".""user_name"",""c"".""credits""-""d"".""debits"" AS ""credit"",CASE WHEN ""c"".""credits""-""d"".""debits""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte_credits"" AS ""c"" JOIN ""cte_debits"" AS ""d"" ON ""c"".""user_id""=""d"".""user_id"") SELECT * FROM ""cte_assemble"""
214,"SELECT ""user_id"",""user_name"",(""credit""-COALESCE(""out_cash"", 0)+COALESCE(""in_cash"", 0)) AS ""credit"",CASE WHEN (""credit""-COALESCE(""out_cash"", 0)+COALESCE(""in_cash"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""U"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""out_cash"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""out_tmp"" ON ""U"".""user_id""=""out_tmp"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""in_cash"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""in_tmp"" ON ""U"".""user_id""=""in_tmp"".""paid_to"""
215,"SELECT ""user_id"",""user_name"",(""u"".""credit""-COALESCE(""t1"".""pay_amount"", 0)+COALESCE(""t2"".""get_amount"", 0)) AS ""credit"",CASE WHEN (""u"".""credit""-COALESCE(""t1"".""pay_amount"", 0)+COALESCE(""t2"".""get_amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""pay_amount"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""get_amount"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"""
216,"SELECT ""user_id"",""user_name"",COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""a"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)>=-""a"".""credit"" THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" OR ""a"".""user_id""=""b"".""paid_to"" GROUP BY ""a"".""user_id"""
217,"SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit""+(CASE WHEN ""b"".""paid_by"" IS NOT NULL THEN -""b"".""amount"" ELSE 0 END)+(CASE WHEN ""c"".""paid_to"" IS NOT NULL THEN ""c"".""amount"" ELSE 0 END) AS ""credit"" FROM (""users"" AS ""a"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""c"" ON ""a"".""user_id""=""c"".""paid_to"" GROUP BY ""user_id"",""user_name"",""a"".""credit"") AS ""t"" ORDER BY 1"
218,"WITH ""tab_trans"" AS (SELECT ""paid_by"" AS ""user_id"",""amount""*-1 AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",MAX(""u"".""credit"")+SUM(COALESCE(""t"".""credit"", 0)) AS ""credit"",CASE WHEN MAX(""u"".""credit"")+SUM(COALESCE(""t"".""credit"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""tab_trans"" AS ""t"" ON ""u"".""user_id""=""t"".""user_id"" GROUP BY ""u"".""user_id"""
219,"WITH ""agg_transactions"" AS (SELECT ""trans_id"",""paid_by"" AS ""user_id"",-""amount"" AS ""amount"",""transacted_on"" FROM ""transactions"" AS ""t"" UNION ALL SELECT ""trans_id"",""paid_to"" AS ""user_id"",""amount"",""transacted_on"" FROM ""transactions"" AS ""t""), ""user_total_trans"" AS (SELECT ""user_id"",SUM(""amount"") AS ""net_amount"" FROM ""agg_transactions"" AS ""a"" GROUP BY 1) SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(""ut"".""net_amount"", 0) AS ""credit"",CASE WHEN (""u"".""credit""+COALESCE(""ut"".""net_amount"", 0))>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""user_total_trans"" AS ""ut"" ON ""ut"".""user_id""=""u"".""user_id"""
220,"WITH ""transfer_out"" AS (SELECT ""paid_by"",SUM(""amount"")*(-1) AS ""out_amt"" FROM ""Transactions"" GROUP BY ""paid_by""), ""transfer_in"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""in_amt"" FROM ""Transactions"" GROUP BY ""paid_to""), ""user_transfer"" AS (SELECT ""paid_by"" AS ""user_id"",""out_amt"" AS ""amt"" FROM ""transfer_out"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""in_amt"" AS ""amt"" FROM ""transfer_in""), ""smry"" AS (SELECT ""user_id"",SUM(""amt"") AS ""credit_diff"" FROM ""user_transfer"" GROUP BY ""user_id"") SELECT ""Users"".""user_id"",""Users"".""user_name"",""Users"".""credit""+COALESCE(""smry"".""credit_diff"", 0) AS ""credit"",CASE WHEN ""Users"".""credit""+COALESCE(""smry"".""credit_diff"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" LEFT JOIN ""smry"" ON ""Users"".""user_id""=""smry"".""user_id"""
221,"SELECT ""c"".""user_id"",""user_name"",(""credit""-COALESCE(""d"".""sum"", 0)) AS ""credit"",CASE WHEN (""credit""-COALESCE(""d"".""sum"", 0))>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""c"" LEFT JOIN (SELECT ""a"".""user_id"",SUM(COALESCE(""a"".""amount"", 0)-COALESCE(""b"".""amount"", 0)) AS ""sum"" FROM (SELECT ""user_id"",""paid_by"",""amount"" FROM ""users"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_by"") AS ""z"" ON ""user_id""=""z"".""paid_by"") AS ""a"" JOIN (SELECT ""user_id"",""paid_to"",""amount"" FROM ""users"" LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_to"") AS ""x"" ON ""user_id""=""x"".""paid_to"") AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" GROUP BY ""a"".""paid_by"") AS ""d"" ON ""c"".""user_id""=""d"".""user_id"""
222,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"" UNION ALL SELECT ""user_id"",""credit"" AS ""amount"" FROM ""users"") SELECT ""a"".""user_id"",""u"".""user_name"",""a"".""credit"",CASE WHEN ""a"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",SUM(""amount"") AS ""credit"" FROM ""cte"" GROUP BY 1) AS ""a"" JOIN ""users"" AS ""u"" ON ""a"".""user_id""=""u"".""user_id"""
223,"SELECT *,(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",(""credit""+COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""t"".""amount"" ELSE ""t"".""amount"" END), 0)) AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"",""u"".""user_name"") AS ""t"""
224,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""id"",-SUM(""amount"") AS ""amount"" FROM ""Transactions"" AS ""t"" GROUP BY 1 UNION SELECT ""paid_to"" AS ""id"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" AS ""t"" GROUP BY 1) SELECT ""u"".""user_id"",""u"".""user_name"",""credit""+COALESCE(SUM(""amount""), 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(SUM(""amount""), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""id"" GROUP BY 1,2"
225,"WITH ""CTE"" AS (SELECT ""paid_by"",(-1*""amount"") AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""transactions""), ""total"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""total_amount"" FROM ""CTE"" GROUP BY ""paid_by"") SELECT ""u"".""user_id"",""user_name"",COALESCE((""credit""+""total_amount""), ""credit"") AS ""credit"",CASE WHEN ""credit""+""total_amount""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""total"" AS ""t"" ON ""u"".""user_id""=""t"".""user_id"""
226,"SELECT ""c"".""user_id"",""c"".""user_name"",(""c"".""credit""-COALESCE(""a"".""pay_amount"", 0)+COALESCE(""b"".""get_amount"", 0)) AS ""credit"",CASE WHEN (""c"".""credit""-COALESCE(""a"".""pay_amount"", 0)+COALESCE(""b"".""get_amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""c"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""pay_amount"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""a"" ON ""c"".""user_id""=""a"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""get_amount"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""b"" ON ""c"".""user_id""=""b"".""paid_to"""
227,"WITH ""cte"" AS (SELECT ""paid_to"" AS ""user_id"",""amount""*1 AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_by"" AS ""user_id"",""amount""*(-1) AS ""amount"" FROM ""Transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""+COALESCE(SUM(""c"".""amount""), 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(SUM(""c"".""amount""), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""user_id"" GROUP BY 1,2"
228,"WITH ""CET"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""credit1"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit1"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" AS ""credit1"" FROM ""Users"") SELECT DISTINCT ""Users"".""user_id"",""user_name"",SUM(""credit1"") OVER (PARTITION BY ""Users"".""user_id"") AS ""credit"",CASE WHEN SUM(""credit1"") OVER (PARTITION BY ""Users"".""user_id"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""CET"" RIGHT JOIN ""Users"" ON ""Users"".""user_id""=""CET"".""user_id"""
229,"WITH ""t1"" AS (SELECT ""user_id"",""credit"" FROM ""Users"" UNION ALL SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions""), ""t2"" AS (SELECT ""user_id"",SUM(""credit"") AS ""credit"" FROM ""t1"" GROUP BY ""user_id"") SELECT ""u"".""user_id"",""u"".""user_name"",""t2"".""credit"" AS ""credit"",CASE WHEN ""t2"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""USERS"" AS ""u"" LEFT JOIN ""t2"" ON ""u"".""user_id""=""t2"".""user_id"""
230,"SELECT ""a"".""user_id"",""a"".""user_name"",""a"".""credit""-COALESCE(""b"".""amount"", 0)+COALESCE(""c"".""amount"", 0) AS ""credit"",CASE WHEN ""a"".""credit""-COALESCE(""b"".""amount"", 0)+COALESCE(""c"".""amount"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""users"" AS ""a"" LEFT JOIN (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""b"" ON ""a"".""user_id""=""b"".""user_id"") LEFT JOIN (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""c"" ON ""a"".""user_id""=""c"".""user_id"""
231,"WITH ""CTE"" AS (SELECT ""paid_by"" AS ""id"",""amount""*-1 AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" FROM ""Transactions"") SELECT ""user_id"",""user_name"",MAX(""u"".""credit"")+COALESCE(SUM(""amount""), 0) AS ""credit"",CASE WHEN MAX(""u"".""credit"")+COALESCE(SUM(""amount""), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""CTE"" AS ""c"" ON ""u"".""user_id""=""c"".""id"" GROUP BY ""user_id"""
232,"SELECT ""user_id"",""user_name"",SUM(""change_in_bal"")+""credit"" AS ""credit"",CASE WHEN SUM(""change_in_bal"")+""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""U"".""user_id"",""U"".""user_name"",""U"".""credit"",CASE WHEN ""U"".""user_id""=""T"".""paid_by"" THEN -""T"".""amount"" WHEN ""U"".""user_id""=""T"".""paid_to"" THEN +""T"".""amount"" ELSE 0 END AS ""change_in_bal"" FROM ""Users"" AS ""U"" LEFT JOIN ""Transactions"" AS ""T"" ON (""U"".""user_id""=""T"".""paid_by"" OR ""U"".""user_id""=""T"".""paid_to"")) AS ""T"" GROUP BY ""user_id"""
233,"SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""-COALESCE(""c2"".""spend"", 0) AS ""credit"",CASE WHEN ""u"".""credit""-COALESCE(""c2"".""spend"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""c1"".""user_id"",SUM(""c1"".""amount"") AS ""spend"" FROM (SELECT ""paid_by"" AS ""user_id"",""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""transactions"") AS ""c1"" GROUP BY ""c1"".""user_id"") AS ""c2"" ON ""u"".""user_id""=""c2"".""user_id"""
234,"SELECT ""u"".""user_id"" AS ""USER_ID"",""u"".""user_name"" AS ""USER_NAME"",""u"".""credit""+COALESCE(SUM(""x"".""amounts""), 0) AS ""CREDIT"",CASE WHEN ""u"".""credit""+COALESCE(SUM(""x"".""amounts""), 0)>0 THEN 'No' ELSE 'Yes' END AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amounts"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""amounts"" FROM ""transactions"") AS ""x"" RIGHT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""x"".""id"" GROUP BY 1"
235,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t1"".""paid_by"" THEN -1*""amount"" ELSE ""amount"" END), 0)+""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t1"".""paid_by"" THEN -1*""amount"" ELSE ""amount"" END), 0)+""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"" OR ""u"".""user_id""=""t1"".""paid_to"" GROUP BY ""u"".""user_id"""
236,"WITH ""all_trans"" AS (SELECT ""paid_by"" AS ""user_"",-1*SUM(""amount"") AS ""bamount"" FROM ""Transactions"" GROUP BY ""paid_by"" UNION SELECT ""paid_to"" AS ""user_"",SUM(""amount"") AS ""bamount"" FROM ""Transactions"" GROUP BY ""paid_to"") SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""user_id"",""user_name"",""credit""+COALESCE(SUM(""bamount""), 0) AS ""credit"" FROM ""users"" AS ""u"" LEFT JOIN ""all_trans"" AS ""a"" ON ""u"".""user_id""=""a"".""user_"" GROUP BY ""user_"") AS ""t"""
237,"WITH ""temp"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""pay"" FROM ""transactions"" GROUP BY ""paid_by""), ""temp2"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""receive"" FROM ""transactions"" GROUP BY ""paid_to"") SELECT ""u"".""user_id"",""u"".""user_name"",""credit""-COALESCE(""temp"".""pay"", 0)+COALESCE(""temp2"".""receive"", 0) AS ""credit"",CASE WHEN ""credit""-COALESCE(""temp"".""pay"", 0)+COALESCE(""temp2"".""receive"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN ""temp"" ON ""u"".""user_id""=""temp"".""paid_by"") LEFT JOIN ""temp2"" ON ""u"".""user_id""=""temp2"".""paid_to"""
238,"SELECT ""user_id"",""user_name"",""credit""+COALESCE((0-""t1"".""amount""), 0)+COALESCE((""t2"".""amount""), 0) AS ""credit"",CASE WHEN ""credit""+COALESCE((0-""t1"".""amount""), 0)+COALESCE((""t2"".""amount""), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""t2"" ON ""u"".""user_id""=""t2"".""paid_to"" GROUP BY 1,2"
239,"WITH ""trans"" AS (SELECT ""user_id"",SUM(""money"") AS ""money"" FROM (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""money"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""money"" FROM ""transactions"") AS ""a"" GROUP BY 1) SELECT ""u"".""user_id"",MAX(""u"".""user_name"") AS ""user_name"",SUM(""u"".""credit""+COALESCE(""t"".""money"", 0)) AS ""credit"",CASE WHEN SUM(""u"".""credit""+COALESCE(""t"".""money"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""trans"" AS ""t"" ON ""t"".""user_id""=""u"".""user_id"" GROUP BY 1"
240,"WITH ""addmoney"" AS (SELECT ""paid_to"" AS ""ptid"",SUM(""amount"") AS ""addamount"" FROM ""Transactions"" GROUP BY ""ptid""), ""minusmoney"" AS (SELECT ""paid_by"" AS ""mid"",0-SUM(""amount"") AS ""minusamount"" FROM ""Transactions"" GROUP BY ""mid"") SELECT ""Users"".""user_id"" AS ""USER_ID"",""Users"".""user_name"" AS ""USER_NAME"",""a"".""amountfinal"" AS ""CREDIT"",CASE WHEN ""a"".""amountfinal""<0 THEN 'Yes' ELSE 'No' END AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT ""Users"".""user_id"" AS ""id"",COALESCE(""Users"".""credit"", 0)+COALESCE(""addmoney"".""addamount"", 0)+COALESCE(""minusmoney"".""minusamount"", 0) AS ""amountfinal"" FROM (""Users"" LEFT JOIN ""addmoney"" ON ""Users"".""user_id""=""addmoney"".""ptid"") LEFT JOIN ""minusmoney"" ON ""Users"".""user_id""=""mid"" GROUP BY ""Users"".""user_id"") AS ""a"" LEFT JOIN ""Users"" ON ""a"".""id""=""Users"".""user_id"""
241,"SELECT ""user_id"",""user_name"",""credit"",(CASE WHEN ""credit"">=0 THEN 'No' ELSE 'Yes' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""s"".""credit"") AS ""credit"" FROM (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""Users"") AS ""s"" RIGHT JOIN ""Users"" AS ""u"" ON ""s"".""user_id""=""u"".""user_id"" GROUP BY 1,2) AS ""sub2"""
242,"SELECT *,(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+SUM((CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""t"".""amount"" WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""t"".""amount"" ELSE 0 END))) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"") AS ""tmp"""
243,"WITH ""tmp"" AS (SELECT ""paid_by"" AS ""id"",""amount""*-1 AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" FROM ""transactions"" UNION ALL SELECT ""user_id"" AS ""id"",""credit"" AS ""amount"" FROM ""users"") SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(""tmp"".""amount""), 0) AS ""credit"",CASE WHEN COALESCE(SUM(""tmp"".""amount""), 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""tmp"" ON ""u"".""user_id""=""tmp"".""id"" GROUP BY ""u"".""user_id"""
244,"WITH ""all_transactions"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""Users""), ""agg_transactions"" AS (SELECT ""user_id"",SUM(""credit"") AS ""credit"" FROM ""all_transactions"" GROUP BY ""user_id"") SELECT ""user_id"",""user_name"",""a"".""credit"",CASE WHEN ""a"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""agg_transactions"" AS ""a"" JOIN ""Users"" AS ""u"" USING (""user_id"")"
245,"SELECT DISTINCT ""users"".""user_id"",""users"".""user_name"",(""users"".""credit""-COALESCE(""pay"".""amount"", 0)+COALESCE(""receive"".""amount"", 0)) AS ""credit"",CASE WHEN (""users"".""credit""-COALESCE(""pay"".""amount"", 0)+COALESCE(""receive"".""amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ((SELECT DISTINCT ""a"".""user_id"",""a"".""user_name"",""a"".""credit"" FROM ""users"" AS ""a"") AS ""users"" LEFT JOIN (SELECT DISTINCT ""a"".""paid_by"",SUM(""a"".""amount"") AS ""amount"" FROM ""transactions"" AS ""a"" GROUP BY ""a"".""paid_by"") AS ""pay"" ON ""users"".""user_id""=""pay"".""paid_by"") LEFT JOIN (SELECT DISTINCT ""a"".""paid_to"",SUM(""a"".""amount"") AS ""amount"" FROM ""transactions"" AS ""a"" GROUP BY ""a"".""paid_to"") AS ""receive"" ON ""users"".""user_id""=""receive"".""paid_to"""
246,"WITH ""CTE"" AS (SELECT ""id"",SUM(""amounts"") AS ""amount"" FROM (SELECT ""paid_by"" AS ""id"",SUM(-""amount"") AS ""amounts"" FROM ""Transactions"" GROUP BY ""paid_by"" UNION ALL SELECT ""paid_to"" AS ""id"",SUM(""amount"") AS ""amounts"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""xx"" GROUP BY ""id"") SELECT ""user_id"",""user_name"",CASE WHEN ""amount"" IS NULL THEN ""credit"" ELSE ""credit""+""amount"" END AS ""credit"",CASE WHEN ""amount"" IS NULL THEN 'No' WHEN ""credit""+""amount"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" LEFT JOIN ""CTE"" AS ""c"" ON ""c"".""id""=""user_id"""
247,"SELECT ""u"".""user_id"",""user_name"",""u"".""credit""-COALESCE(""out_cash"", 0)+COALESCE(""in_cash"", 0) AS ""credit"",CASE WHEN ""u"".""credit""-COALESCE(""out_cash"", 0)+COALESCE(""in_cash"", 0)>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""out_cash"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""out_tmp"" ON ""U"".""user_id""=""out_tmp"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""in_cash"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""in_tmp"" ON ""U"".""user_id""=""in_tmp"".""paid_to"""
248,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""balance"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""balance"" FROM ""transactions"" UNION ALL SELECT ""user_id"",""credit"" AS ""balance"" FROM ""Users"") SELECT ""cte"".""user_id"" AS ""USER_ID"",""users"".""user_name"",SUM(""balance"") AS ""CREDIT"",(CASE WHEN SUM(""balance"")<0 THEN 'Yes' ELSE 'No' END) AS ""CREDIT_LIMIT_BREACHED"" FROM ""cte"" LEFT JOIN ""users"" ON ""cte"".""user_id""=""users"".""user_id"" GROUP BY ""user_id"" ORDER BY ""user_id"""
249,"WITH ""t"" AS (SELECT ""paid_by"" AS ""user_id"",(-""amount"") AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"" UNION ALL SELECT ""user_id"",""credit"" FROM ""users"") SELECT ""USER_ID"",""USER_NAME"",SUM(""amount"") AS ""CREDIT"",CASE WHEN SUM(""amount"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" JOIN ""t"" USING (""user_id"") GROUP BY ""user_id"""
250,"SELECT ""user_id"",""user_name"",COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""a"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""a"".""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" OR ""a"".""user_id""=""b"".""paid_to"" GROUP BY ""a"".""user_id"""
251,"SELECT ""user_id"",""user_name"",""credit""-COALESCE(""loss"".""amt"", 0)+COALESCE(""gain"".""amt"", 0) AS ""credit"",CASE WHEN ""credit""-COALESCE(""loss"".""amt"", 0)+COALESCE(""gain"".""amt"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""amt"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""loss"" ON ""u"".""user_id""=""loss"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""amt"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""gain"" ON ""u"".""user_id""=""gain"".""paid_to"""
252,"SELECT *,(CASE WHEN ""b"".""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""CREDIT_LIMIT_BREACHED"" FROM (SELECT ""u"".""user_id"" AS ""USER_ID"",""u"".""user_name"" AS ""USER_NAME"",(""u"".""credit""+""a"".""credit"") AS ""CREDIT"" FROM ""Users"" AS ""u"" JOIN (SELECT ""u"".""user_name"" AS ""user"",SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" WHEN ""u"".""user_id""=""t"".""paid_to"" THEN ""amount"" ELSE 0 END) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY 1) AS ""a"" ON ""u"".""user_name""=""a"".""user"") AS ""b"""
253,"WITH ""temp"" AS (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""amount"" FROM ""Transactions""), ""temp2"" AS (SELECT ""id"",SUM(""amount"") AS ""amount"" FROM ""temp"" GROUP BY ""id"") SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE((""u"".""credit""+""t"".""amount""), ""u"".""credit"") AS ""credit"",(CASE WHEN (""u"".""credit""+""t"".""amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""temp2"" AS ""t"" RIGHT JOIN ""Users"" AS ""u"" ON ""t"".""id""=""u"".""user_id"""
254,"WITH ""CTE"" AS (SELECT ""U"".""user_id"",""U"".""user_name"",""U"".""credit""-COALESCE(""T1"".""amount"", 0)+COALESCE(""T2"".""amount"", 0) AS ""credit"" FROM (""Users"" AS ""U"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""T1"" ON ""U"".""user_id""=""T1"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""T2"" ON ""U"".""user_id""=""T2"".""paid_to"" GROUP BY ""U"".""user_id"",""U"".""user_name"") SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""CTE"""
255,"WITH ""base"" AS (SELECT ""paid_by"",-""amount"" AS ""paid_amount"",""paid_to"",""amount"" AS ""gained_amount"" FROM ""transactions"") SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""user_name"",""credit""+COALESCE(SUM(""amount""), 0) AS ""credit"" FROM (SELECT ""paid_by"" AS ""user_id"",""paid_amount"" AS ""amount"" FROM ""base"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""gained_amount"" AS ""amount"" FROM ""base"") AS ""t"" RIGHT JOIN ""users"" AS ""u"" ON ""t"".""user_id""=""u"".""user_id"" GROUP BY 1) AS ""sub"""
256,"WITH ""c"" AS (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""credits"" FROM ""transactions"" AS ""t"" GROUP BY 1), ""d"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"") AS ""debits"" FROM ""transactions"" AS ""t"" GROUP BY 1) SELECT ""u"".""user_id"" AS ""USER_ID"",""u"".""user_name"" AS ""USER_NAME"",(""u"".""credit""+COALESCE(""credits"", 0)-COALESCE(""debits"", 0)) AS ""CREDIT"",CASE WHEN (""u"".""credit""+COALESCE(""credits"", 0)-COALESCE(""debits"", 0))>0 THEN 'No' ELSE 'Yes' END AS ""CREDIT_LIMIT_BREACHED"" FROM (""users"" AS ""u"" LEFT JOIN ""c"" ON ""c"".""user_id""=""u"".""user_id"") LEFT JOIN ""d"" ON ""d"".""user_id""=""u"".""user_id"""
257,"WITH ""AllTxns"" AS (SELECT ""user_id"",""credit"" AS ""amount"" FROM ""Users"" UNION ALL SELECT ""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""Transactions""), ""TxnSummary"" AS (SELECT ""user_id"",SUM(""amount"") AS ""credit"" FROM ""AllTxns"" GROUP BY ""user_id"") SELECT ""TS"".""user_id"",""U"".""user_name"",""TS"".""credit"",CASE WHEN ""TS"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""TxnSummary"" AS ""TS"" JOIN ""Users"" AS ""U"" ON ""U"".""user_id""=""TS"".""user_id"""
258,"WITH ""cte"" AS (SELECT ""id"",SUM(""amount"") AS ""credit"" FROM (SELECT ""paid_by"" AS ""id"",SUM(-""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1 UNION ALL SELECT ""paid_to"" AS ""id"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) AS ""a"" GROUP BY 1) SELECT ""a"".""user_id"",""a"".""user_name"",COALESCE((""a"".""credit""+""b"".""credit""), ""a"".""credit"") AS ""credit"",CASE WHEN (COALESCE((""a"".""credit""+""b"".""credit""), ""a"".""credit""))>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""user_id""=""b"".""id"""
259,"WITH ""cte"" AS (SELECT ""user_id"",""credit"" FROM ""Users"" UNION ALL SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""credit"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit"" FROM ""Transactions"") SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""a"".""credit"") AS ""credit"",CASE WHEN SUM(""a"".""credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte"" AS ""a"" JOIN ""Users"" AS ""u"" ON ""a"".""user_id""=""u"".""user_id"" GROUP BY ""u"".""user_id"""
260,"WITH ""paid"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""paid_amount"" FROM ""transactions"" GROUP BY ""paid_by""), ""rec"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""received_amount"" FROM ""transactions"" GROUP BY ""paid_to"") SELECT ""user_id"",""user_name"",(COALESCE(""credit"", 0)-COALESCE(""paid_amount"", 0)+COALESCE(""received_amount"", 0)) AS ""credit"",CASE WHEN (COALESCE(""credit"", 0)-COALESCE(""paid_amount"", 0)+COALESCE(""received_amount"", 0))>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (""users"" AS ""u"" LEFT JOIN ""paid"" AS ""p"" ON ""u"".""user_id""=""p"".""paid_by"") LEFT JOIN ""rec"" AS ""r"" ON ""u"".""user_id""=""r"".""paid_to"""
261,"SELECT ""user_id"",""user_name"",""credit"",(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""user_name"",(COALESCE(SUM(""cmbd"".""amt""), 0)+""credit"") AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ((SELECT ""paid_by"" AS ""user_id"",-SUM(""amount"") AS ""amt"" FROM ""Transactions"" GROUP BY 1) UNION (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""amt"" FROM ""Transactions"" GROUP BY 1)) AS ""cmbd"" ON ""u"".""user_id""=""cmbd"".""user_id"" GROUP BY ""u"".""user_id"") AS ""final"""
262,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""u"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)>=-""u"".""credit"" THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""Paid_to"" GROUP BY ""u"".""user_id"""
263,"WITH ""trans"" AS (SELECT ""trans_id"",""paid_by"",""paid_to"",(CASE WHEN ""paid_by"" THEN (-""amount"") END) AS ""paid"",(CASE WHEN ""paid_to"" THEN ""amount"" END) AS ""recived"" FROM ""Transactions""), ""full_trans"" AS (SELECT ""paid_by"" AS ""user_id"",""paid"" AS ""amount"" FROM ""trans"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""recived"" AS ""amount"" FROM ""trans"" UNION ALL SELECT ""user_id"" AS ""user_id"",""credit"" AS ""amount"" FROM ""Users"") SELECT ""U"".""user_id"",""U"".""user_name"",SUM(""full_trans"".""amount"") AS ""credit"",(CASE WHEN SUM(""full_trans"".""amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""Users"" AS ""U"" LEFT JOIN ""full_trans"" ON ""U"".""user_id""=""full_trans"".""user_id"" GROUP BY 1"
264,"WITH ""AllTxns"" AS (SELECT ""user_id"",""credit"" FROM ""Users"" UNION ALL SELECT ""paid_by"",-1*""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""Transactions""), ""FinalBalances"" AS (SELECT ""user_id"",SUM(""credit"") AS ""credit"" FROM ""AllTxns"" GROUP BY ""user_id"") SELECT ""U"".""user_id"",""U"".""user_name"",""FB"".""credit"",CASE WHEN ""FB"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""U"" JOIN ""FinalBalances"" AS ""FB"" ON ""FB"".""user_id""=""U"".""user_id"""
265,"WITH ""P1"" AS (SELECT ""U"".""user_id"",SUM(CASE WHEN ""T"".""amount"" IS NULL THEN 0 ELSE ""T"".""amount"" END) AS ""amt"" FROM ""Users"" AS ""U"" LEFT JOIN ""Transactions"" AS ""T"" ON ""U"".""user_id""=""T"".""paid_by"" GROUP BY ""U"".""user_id""), ""P2"" AS (SELECT ""U"".""user_id"",SUM(CASE WHEN ""T"".""amount"" IS NULL THEN 0 ELSE ""T"".""amount"" END) AS ""amt"" FROM ""Users"" AS ""U"" LEFT JOIN ""Transactions"" AS ""T"" ON ""U"".""user_id""=""T"".""paid_to"" GROUP BY ""U"".""user_id""), ""R"" AS (SELECT ""U"".""user_id"",""U"".""user_name"",SUM(""U"".""credit""-""P1"".""amt""+""P2"".""amt"") AS ""credit"" FROM (""Users"" AS ""U"" JOIN ""P1"" ON ""U"".""user_id""=""P1"".""user_id"") JOIN ""P2"" ON ""U"".""user_id""=""P2"".""user_id"" GROUP BY ""U"".""user_id"",""U"".""user_name"") SELECT ""R"".""user_id"",""R"".""user_name"",""R"".""credit"",(CASE WHEN ""R"".""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""R"""
266,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(""amount""), 0)+""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(""amount""), 0)+""credit"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"",""amount"" FROM ""transactions"") AS ""t"" RIGHT JOIN ""users"" AS ""u"" USING (""user_id"") GROUP BY 1,2"
267,"WITH ""usertx"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"",COALESCE(-""t"".""amount"", 0) AS ""amount"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" UNION ALL SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"",COALESCE(""t"".""amount"", 0) AS ""amount"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"") SELECT ""user_id"",""user_name"",""credit""+SUM(""amount"") AS ""credit"",(CASE WHEN ""credit""+SUM(""amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""usertx"" GROUP BY ""user_id"""
268,"WITH ""payments"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""outgoing"" FROM ""transactions"" GROUP BY 1), ""income"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""incoming"" FROM ""transactions"" GROUP BY 1) SELECT ""u"".""user_id"",""user_name"",""credit""-COALESCE(""outgoing"", 0)+COALESCE(""incoming"", 0) AS ""credit"",CASE WHEN ""credit""-COALESCE(""outgoing"", 0)+COALESCE(""incoming"", 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""users"" AS ""u"" LEFT JOIN ""payments"" AS ""p"" ON ""p"".""paid_by""=""u"".""user_id"") LEFT JOIN ""income"" AS ""i"" ON ""i"".""paid_to""=""u"".""user_id"""
269,"WITH ""CTE"" AS ((SELECT ""paid_by"",""paid_to"",-""amount"" AS ""amount"" FROM ""Transactions"") UNION ALL (SELECT ""paid_to"",""paid_by"",""amount"" FROM ""Transactions"")), ""CTE1"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""CTE"" GROUP BY 1) SELECT ""a"".""user_id"",""a"".""user_name"",COALESCE((""credit""+""amount""), ""credit"") AS ""credit"",CASE WHEN (""credit""+""amount"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""a"" LEFT JOIN ""CTE1"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" GROUP BY 1,2"
270,"WITH ""cte_pay"" AS (SELECT ""trans_id"",""paid_by"" AS ""user_id"",-1*""amount"" AS ""amount"",""transacted_on"" FROM ""Transactions"" UNION SELECT ""trans_id"",""paid_to"" AS ""user_id"",""amount"",""transacted_on"" FROM ""Transactions"") SELECT ""u"".""user_id"" AS ""USER_ID"",""user_name"" AS ""USER_NAME"",COALESCE(""total_amount"", 0)+""credit"" AS ""CREDIT"",CASE WHEN COALESCE(""total_amount"", 0)+""credit"">=0 THEN 'No' ELSE 'Yes' END AS ""CREDIT_LIMIT_BREACHED"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""user_id"",SUM(""amount"") AS ""total_amount"" FROM ""cte_pay"" GROUP BY ""user_id"") AS ""a"" ON ""a"".""user_id""=""u"".""user_id"" ORDER BY ""u"".""user_id"""
271,"WITH ""CET"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""credit1"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""credit1"" FROM ""Transactions"" UNION ALL SELECT ""user_id"",""credit"" AS ""credit1"" FROM ""Users"") SELECT DISTINCT ""Users"".""user_id"",""user_name"",SUM(""credit1"") OVER (PARTITION BY ""Users"".""user_id"") AS ""credit"",CASE WHEN SUM(""credit1"") OVER (PARTITION BY ""Users"".""user_id"")>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""CET"" RIGHT JOIN ""Users"" ON ""Users"".""user_id""=""CET"".""user_id"""
272,"WITH ""net_trans"" AS (SELECT ""paid_by"" AS ""user_id"",-1*SUM(""amount"") AS ""total_amt"" FROM ""transactions"" GROUP BY 1 UNION SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""total_amt"" FROM ""transactions"" GROUP BY 1) SELECT ""u"".""user_id"" AS ""user_id"",""u"".""user_name"" AS ""user_name"",""u"".""credit""+COALESCE(SUM(""t"".""total_amt""), 0) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(SUM(""t"".""total_amt""), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""net_trans"" AS ""t"" ON ""t"".""user_id""=""u"".""user_id"" GROUP BY 1"
273,"WITH ""tmp"" AS (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"") SELECT ""a"".""user_id"",""a"".""user_name"",CASE WHEN ""amount"" IS NULL THEN ""credit"" ELSE ""credit""+""amount"" END AS ""credit"",CASE WHEN ""credit""<-""amount"" THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT ""user_id"",SUM(""amount"") AS ""amount"" FROM ""tmp"" GROUP BY 1) AS ""b"" USING (""user_id"")"
274,"SELECT ""user_id"",""user_name"",SUM(""change_in_bal"")+""credit"" AS ""credit"",CASE WHEN SUM(""change_in_bal"")+""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""U"".""user_id"",""U"".""user_name"",""U"".""credit"",CASE WHEN ""U"".""user_id""=""T"".""paid_by"" THEN -""T"".""amount"" WHEN ""U"".""user_id""=""T"".""paid_to"" THEN +""T"".""amount"" ELSE 0 END AS ""change_in_bal"" FROM ""Users"" AS ""U"" LEFT JOIN ""Transactions"" AS ""T"" ON (""U"".""user_id""=""T"".""paid_by"" OR ""U"".""user_id""=""T"".""paid_to"")) AS ""T"" GROUP BY ""user_id"""
275,"WITH ""a"" AS (SELECT ""user_id"",SUM(""Am"") AS ""diff"" FROM (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""Am"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""Am"" FROM ""Transactions"") AS ""t"" GROUP BY ""user_id"") SELECT ""U"".""user_id"" AS ""USER_ID"",""user_name"" AS ""USER_NAME"",""credit""+COALESCE(""diff"", 0) AS ""CREDIT"",(CASE WHEN ""credit""+COALESCE(""diff"", 0)<0 THEN 'Yes' ELSE 'No' END) AS ""CREDIT_LIMIT_BREACHED"" FROM ""Users"" AS ""U"" LEFT JOIN ""a"" ON ""U"".""user_id""=""a"".""user_id"""
276,"WITH ""cte"" AS (SELECT ""id"",SUM(""amt"") AS ""amount"" FROM (SELECT ""paid_by"" AS ""id"",""amount""*-1 AS ""amt"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""amt"" FROM ""Transactions"") AS ""tmp"" GROUP BY ""id""), ""credit_tbl"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",CASE WHEN ""c"".""amount"" IS NULL THEN ""u"".""credit"" ELSE ""u"".""credit""+""c"".""amount"" END AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""id"") SELECT ""user_id"",""user_name"",""credit"",CASE WHEN ""credit"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""credit_tbl"""
277,"WITH ""cte"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""u"".""credit"") AS ""credit"",SUM(COALESCE(""t"".""amount"", 0)) AS ""paid"",SUM(COALESCE(""t1"".""amount"", 0)) AS ""received"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_by"") AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY ""paid_to"") AS ""t1"" ON ""u"".""user_id""=""t1"".""paid_to"" GROUP BY ""u"".""user_id"",""u"".""user_name"") SELECT ""user_id"",""user_name"",(""credit""-""paid""+""received"") AS ""credit"",CASE WHEN (""credit""-""paid""+""received"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte"""
278,"WITH ""tmp"" AS (SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit"",""amount"" FROM ""users"" AS ""u"" JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_to"" UNION ALL SELECT ""u"".""user_id"",""u"".""credit"",""u"".""credit"",""amount""*(-1) FROM ""users"" AS ""u"" JOIN ""transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by""), ""tmp2"" AS (SELECT ""user_id"",SUM(""amount"") AS ""total"" FROM ""tmp"" GROUP BY ""user_id"") SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+COALESCE(""tmp2"".""total"", 0)) AS ""credit"",CASE WHEN (""u"".""credit""+COALESCE(""tmp2"".""total"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""tmp2"" RIGHT JOIN ""users"" AS ""u"" ON ""tmp2"".""user_id""=""u"".""user_id"""
279,"WITH ""trans"" AS (SELECT ""paid_by"",""paid_to"",(CASE WHEN ""paid_by"" THEN -""amount"" END) AS ""paid"",(CASE WHEN ""paid_to"" THEN +""amount"" END) AS ""recieved"" FROM ""transactions""), ""total"" AS (SELECT ""paid_by"" AS ""user_id"",""paid"" AS ""amount"" FROM ""trans"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""recieved"" AS ""amount"" FROM ""trans"" UNION ALL SELECT ""user_id"",""credit"" AS ""amount"" FROM ""users"") SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""t"".""amount"") AS ""credit"",(CASE WHEN SUM(""t"".""amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""users"" AS ""u"" JOIN ""total"" AS ""t"" ON ""u"".""user_id""=""t"".""user_id"" GROUP BY ""u"".""user_id"""
280,"SELECT *,(CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM (SELECT ""u"".""user_id"",""u"".""user_name"",""credit""+COALESCE(SUM(CASE WHEN ""u"".""user_id""=""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0) AS ""credit"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""paid_by"" OR ""u"".""user_id""=""paid_to"" GROUP BY ""u"".""user_id"") AS ""temp"""
281,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""person"",""amount""*-1 AS ""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_to"" AS ""person"",""amount"" FROM ""transactions"") SELECT ""user_id"",""user_name"",COALESCE(SUM(""amount"")+MAX(""credit""), MAX(""credit"")) AS ""credit"",(CASE WHEN (SUM(""amount"")+MAX(""credit""))<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""person"" GROUP BY 1,2"
282,"SELECT ""user_id"",""user_name"",""credit""+COALESCE(SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(SUM(CASE WHEN ""user_id""=""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" LEFT JOIN ""Transactions"" ON (""user_id""=""paid_by"" OR ""user_id""=""paid_to"") GROUP BY ""user_id"""
283,"SELECT ""u"".""user_id"",""u"".""user_name"",(""u"".""credit""+COALESCE(SUM(""diff""), 0)) AS ""credit"",CASE WHEN ""u"".""credit""+COALESCE(SUM(""temp"".""diff""), 0)>0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""paid_by"" AS ""user_id"",-""amount"" AS ""diff"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" AS ""diff"" FROM ""Transactions"") AS ""temp"" ON ""u"".""user_id""=""temp"".""user_id"" GROUP BY 1,2"
284,"SELECT ""user_id"",""user_name"",COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""a"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""a"".""user_id""=""b"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)>=-""a"".""credit"" THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" OR ""a"".""user_id""=""b"".""paid_to"" GROUP BY ""a"".""user_id"""
285,"SELECT ""a"".""user_id"",""a"".""user_name"",(""a"".""credit""-COALESCE(""b"".""amount"", 0)+COALESCE(""c"".""amount"", 0)) AS ""credit"",CASE WHEN (""a"".""credit""-COALESCE(""b"".""amount"", 0)+COALESCE(""c"".""amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (""Users"" AS ""a"" LEFT JOIN (SELECT ""paid_by"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_by"") AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"") LEFT JOIN (SELECT ""paid_to"",SUM(""amount"") AS ""amount"" FROM ""Transactions"" GROUP BY ""paid_to"") AS ""c"" ON ""a"".""user_id""=""c"".""paid_to"""
286,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(CASE WHEN ""t"".""paid_by""=""u"".""user_id"" THEN -""t"".""amount"" ELSE ""t"".""amount"" END), 0)+MAX(""u"".""credit"") AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""t"".""paid_by""=""u"".""user_id"" THEN -""t"".""amount"" ELSE ""t"".""amount"" END), 0)+MAX(""u"".""credit"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""t"".""paid_by""=""u"".""user_id"" OR ""t"".""paid_to""=""u"".""user_id"" GROUP BY ""u"".""user_id"""
287,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""user_id"",SUM(""amount"")*-1 AS ""cash_out"" FROM ""transactions"" GROUP BY 1 UNION ALL SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""cash_in"" FROM ""transactions"" GROUP BY 1 UNION ALL SELECT ""user_id"",""credit"" FROM ""users"") SELECT ""cte"".""user_id"",""users"".""user_name"",SUM(""cash_out"") AS ""credit"",CASE WHEN SUM(""cash_out"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte"" LEFT JOIN ""users"" USING (""user_id"") GROUP BY 1,2 ORDER BY 1"
288,"WITH ""cte"" AS (SELECT ""paid_by"" AS ""id"",(-SUM(""amount"")) AS ""bal"" FROM ""Transactions"" GROUP BY 1 UNION ALL SELECT ""paid_to"" AS ""id"",SUM(""amount"") AS ""bal"" FROM ""Transactions"" GROUP BY 1 UNION ALL SELECT ""user_id"" AS ""id"",SUM(""credit"") AS ""bal"" FROM ""Users"" GROUP BY 1), ""cte2"" AS (SELECT ""id"",SUM(""bal"") AS ""credit"" FROM ""cte"" GROUP BY 1) SELECT ""tab2"".""user_id"",""tab2"".""user_name"",""tab1"".""credit"",CASE WHEN ""tab1"".""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""cte2"" AS ""tab1"" LEFT JOIN ""Users"" AS ""tab2"" ON ""tab1"".""id""=""tab2"".""user_id"""
289,"SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""u"".""credit"" AS ""credit"",CASE WHEN COALESCE(SUM(CASE WHEN ""u"".""user_id""=""t"".""paid_by"" THEN -""amount"" ELSE ""amount"" END), 0)+""u"".""credit"">0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""Transactions"" AS ""t"" ON ""u"".""user_id""=""t"".""paid_by"" OR ""u"".""user_id""=""t"".""paid_to"" GROUP BY ""u"".""user_id"""
290,"SELECT ""u"".""user_id"",""u"".""user_name"",""credit""+COALESCE(SUM(""amount""), 0) AS ""credit"",CASE WHEN ""credit""+COALESCE(SUM(""amount""), 0)<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" AS ""u"" LEFT JOIN ((SELECT ""paid_by"" AS ""user_id"",-SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1) UNION ALL (SELECT ""paid_to"" AS ""user_id"",SUM(""amount"") AS ""amount"" FROM ""transactions"" GROUP BY 1)) AS ""a"" ON ""u"".""user_id""=""a"".""user_id"" GROUP BY 1,2"
291,"WITH ""t"" AS (SELECT ""user_id"",""user_name"",""credit""+SUM(CASE WHEN ""paid_by""=""user_id"" THEN -1*""amount"" WHEN ""paid_to""=""user_id"" THEN ""amount"" ELSE 0 END) AS ""credit"" FROM ""users"" LEFT JOIN ""Transactions"" ON ""users"".""user_id""=""Transactions"".""paid_by"" OR ""users"".""user_id""=""Transactions"".""paid_to"" GROUP BY ""user_id"") SELECT *,CASE WHEN ""credit""<100 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""t"""
292,"SELECT ""user_id"",""user_name"",""credit""+COALESCE(SUM(""amount""), 0) AS ""credit"",CASE WHEN ""credit""+SUM(""amount"")<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""users"" LEFT JOIN (SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""transactions"" UNION ALL SELECT ""paid_by"",-""amount"" FROM ""transactions"") AS ""t"" USING (""user_id"") GROUP BY 1,2"
293,"WITH ""cte"" AS (SELECT ""user_id"",SUM(""amount"") AS ""amount"" FROM (SELECT ""paid_by"" AS ""user_id"",""amount""*-1 AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""user_id"",""amount"" FROM ""Transactions"") AS ""tmp"" GROUP BY 1) SELECT ""u"".""user_id"",""u"".""user_name"",SUM(""u"".""credit""+COALESCE(""c"".""amount"", 0)) AS ""credit"",CASE WHEN SUM(""u"".""credit""+COALESCE(""c"".""amount"", 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""user_id"" GROUP BY 1,2"
294,"WITH ""a"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""cash_out"" FROM ""transactions"" GROUP BY ""paid_by""), ""b"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""cash_in"" FROM ""transactions"" GROUP BY ""paid_to"") SELECT ""u"".""user_id"",""u"".""user_name"",""u"".""credit""-COALESCE(""a"".""cash_out"", 0)+COALESCE(""b"".""cash_in"", 0) AS ""credit"",CASE WHEN ""u"".""credit""-COALESCE(""a"".""cash_out"", 0)+COALESCE(""b"".""cash_in"", 0)>=0 THEN 'No' ELSE 'Yes' END AS ""credit_limit_breached"" FROM (""users"" AS ""u"" LEFT JOIN ""a"" ON ""u"".""user_id""=""a"".""paid_by"") LEFT JOIN ""b"" ON ""u"".""user_id""=""b"".""paid_to"""
295,"SELECT ""c"".""user_id"",""c"".""user_name"",(""c"".""credit""+COALESCE(SUM(""d"".""amount""), 0)) AS ""credit"",CASE WHEN (""c"".""credit""+COALESCE(SUM(""d"".""amount""), 0))<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM (SELECT ""a"".""user_id"",""a"".""user_name"",(""a"".""credit""-COALESCE(SUM(""b"".""amount""), 0)) AS ""credit"" FROM ""Users"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""paid_by"" GROUP BY 1,2) AS ""c"" LEFT JOIN ""Transactions"" AS ""d"" ON ""c"".""user_id""=""d"".""paid_to"" GROUP BY 1,2"
296,"WITH ""temp"" AS (SELECT ""paid_by"" AS ""id"",-""amount"" AS ""amount"" FROM ""Transactions"" UNION ALL SELECT ""paid_to"" AS ""id"",""amount"" AS ""amount"" FROM ""Transactions""), ""temp2"" AS (SELECT ""id"",SUM(""amount"") AS ""amount"" FROM ""temp"" GROUP BY ""id"") SELECT ""u"".""user_id"",""u"".""user_name"",COALESCE((""u"".""credit""+""t"".""amount""), ""u"".""credit"") AS ""credit"",(CASE WHEN (""u"".""credit""+""t"".""amount"")<0 THEN 'Yes' ELSE 'No' END) AS ""credit_limit_breached"" FROM ""temp2"" AS ""t"" RIGHT JOIN ""Users"" AS ""u"" ON ""t"".""id""=""u"".""user_id"""
297,"WITH ""x"" AS (SELECT ""paid_by"",SUM(""amount"") AS ""given"" FROM ""transactions"" GROUP BY 1), ""y"" AS (SELECT ""paid_to"",SUM(""amount"") AS ""taken"" FROM ""transactions"" GROUP BY 1), ""z"" AS (SELECT ""user_id"",""user_name"",CASE WHEN ""given"" IS NULL AND ""taken"" IS NULL THEN ""credit"" WHEN ""given"" IS NULL AND ""taken"" IS NOT NULL THEN ""credit""+""taken"" WHEN ""taken"" IS NULL AND ""given"" IS NOT NULL THEN ""credit""-""given"" ELSE ""credit""+""taken""-""given"" END AS ""credit"" FROM (""users"" LEFT JOIN ""x"" ON ""users"".""user_id""=""x"".""paid_by"") LEFT JOIN ""y"" ON ""users"".""user_id""=""y"".""paid_to"") SELECT *,CASE WHEN ""credit""<0 THEN 'Yes' ELSE 'No' END AS ""credit_limit_breached"" FROM ""z"""
