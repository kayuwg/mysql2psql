id,original query
1,"WITH ""cte"" AS (SELECT ""department_id"",AVG(""amount"") AS ""amt"",""pay_date"" FROM (SELECT ""department_id"",""amount"",SUBSTR(""pay_date"", 1, 7) AS ""pay_date"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"") AS ""t1"" GROUP BY ""pay_date"",""department_id""), ""cte1"" AS (SELECT ""cte"".""department_id"",""cte"".""pay_date"",""cte"".""amt"",""gamt"" FROM ""cte"" JOIN (SELECT AVG(""amount"") AS ""gamt"",SUBSTR(""pay_date"", 1, 7) AS ""pay_date"" FROM ""salary"" GROUP BY SUBSTR(""pay_date"", 1, 7)) AS ""t1"" ON ""t1"".""pay_date""=""cte"".""pay_date"") SELECT ""pay_date"" AS ""pay_month"",""department_id"",CASE WHEN ""amt"">""gamt"" THEN 'higher' WHEN ""amt""=""gamt"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""cte1"""
2,"WITH ""deptavg"" AS (SELECT ""e"".""department_id"",AVG(""amount"") AS ""totalmonthlydeptamount"",(""pay_date"") AS ""month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""department_id"",EXTRACT(MONTH FROM ""pay_date"")), ""totavg"" AS (SELECT AVG(""amount"") AS ""totalmonthlyamount"",MAX(""e"".""employee_id"") AS ""employee_id"",MAX(""pay_date"") AS ""month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY EXTRACT(MONTH FROM ""pay_date"")) SELECT TO_CHAR(""d"".""month"", 'YYYY-%m') AS ""pay_month"",""d"".""department_id"" AS ""department_id"",(CASE WHEN ""d"".""totalmonthlydeptamount"">""t"".""totalmonthlyamount"" THEN 'higher' WHEN ""d"".""totalmonthlydeptamount""<""t"".""totalmonthlyamount"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""deptavg"" AS ""d"" LEFT JOIN ""totavg"" AS ""t"" ON ""d"".""month""=""t"".""month"" ORDER BY ""pay_month"" DESC,""department_id"""
3,"WITH ""cte1"" AS (SELECT ""s"".""id"",""s"".""employee_id"",""s"".""amount"",""s"".""pay_date"",""e"".""department_id"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""avg_department"">""avg_company"" THEN 'higher' WHEN ""avg_department""=""avg_company"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""avg_company"",""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""avg_department"" FROM ""cte1"") AS ""cte2"" ORDER BY ""pay_month"" DESC"
4,"SELECT ""pay_month"",""department_id"",CASE WHEN ""CompanyAverage""=""departmentAverage"" THEN 'same' WHEN ""CompanyAverage""<""departmentAverage"" THEN 'higher' ELSE 'lower' END AS ""comparison"" FROM (SELECT DISTINCT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""CompanyAverage"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m'), ""department_id"") AS ""departmentAverage"" FROM ""EMPLOYEE"" AS ""E"" LEFT JOIN ""SALARY"" AS ""S"" ON ""E"".""employee_id""=""S"".""employee_id"") AS ""MonthlyDeptCompAvg"""
5,"WITH ""T"" AS (SELECT ""a"".*,LEFT(""a"".""pay_date"", 7) AS ""pay_month"",""b"".""department_id"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""company_avg"" THEN 'higher' WHEN ""dept_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT DISTINCT ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""company_avg"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""dept_avg"" FROM ""T"" ORDER BY ""pay_month"" DESC,""department_id"") AS ""a"""
6,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
7,"SELECT ""pay_month"",""department_id"",(CASE WHEN ""dep_avg"">""company_avg"" THEN 'higher' WHEN ""dep_avg""<""company_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dep_avg"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""department_id"") AS ""t1"", (SELECT AVG(""amount"") AS ""company_avg"",LEFT(""pay_date"", 7) AS ""month"" FROM ""salary"" GROUP BY ""month"") AS ""t2"" WHERE ""t1"".""pay_month""=""t2"".""month"""
8,"ERROR: mysql parse error: line 1 column 423 near ""temp1 left join (select month, avg(amount) as company from zte group by 1)temp2 on temp1.pay_month = temp2.month) "" "
9,"WITH ""cte"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") AS ""avg_dep"" FROM ""salary"" JOIN ""employee"" USING (""employee_id"") GROUP BY 1,2), ""cte_1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""avg_month"" FROM ""salary"" GROUP BY 1) SELECT ""pay_month"",""department_id"",CASE WHEN ""avg_dep"">""avg_month"" THEN 'higher' WHEN ""avg_dep""=""avg_month"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""cte"" JOIN ""cte_1"" USING (""pay_month"")"
10,"WITH ""cte"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""E"".""department_id"",AVG(""amount"") AS ""avg_dept_salary"" FROM ""employee"" AS ""E"" LEFT JOIN ""salary"" AS ""S"" ON ""S"".""employee_id""=""E"".""employee_id"" GROUP BY ""pay_month"",""department_id""), ""cte1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""avg_monthly_salary"" FROM ""salary"" GROUP BY ""pay_month"") SELECT ""C"".""pay_month"",""C"".""department_id"",CASE WHEN ""avg_dept_salary"">""avg_monthly_salary"" THEN 'higher' WHEN ""avg_dept_salary""<""avg_monthly_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte"" AS ""C"" JOIN ""cte1"" AS ""C1"" ON ""C"".""pay_month""=""C1"".""pay_month"""
11,"WITH ""dept"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""PAY_MONTH"",""department_id"",AVG(""amount"") AS ""dept_amount"" FROM ""salary"" JOIN ""employee"" USING (""employee_id"") GROUP BY 1,2), ""comp"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""PAY_MONTH"",AVG(""amount"") AS ""comp_amount"" FROM ""salary"" JOIN ""employee"" USING (""employee_id"") GROUP BY 1) SELECT ""PAY_MONTH"" AS ""pay_month"",""department_id"",CASE WHEN ""dept_amount"">(SELECT ""comp_amount"" FROM ""comp"" WHERE ""comp"".""PAY_MONTH""=""dept"".""PAY_MONTH"") THEN 'higher' WHEN ""dept_amount""=(SELECT ""comp_amount"" FROM ""comp"" WHERE ""comp"".""PAY_MONTH""=""dept"".""PAY_MONTH"") THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""dept"""
12,"WITH ""company_average"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""amount"" FROM ""salary"" GROUP BY ""pay_month"") SELECT ""sub"".""pay_month"",""sub"".""department_id"",CASE WHEN ""sub"".""department_average"">""ca"".""amount"" THEN 'higher' WHEN ""sub"".""department_average""<""ca"".""amount"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""department_average"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id"") AS ""sub"" JOIN ""company_average"" AS ""ca"" ON ""sub"".""pay_month""=""ca"".""pay_month"""
13,"WITH ""t1"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""com_avg"" FROM ""salary"" GROUP BY 1), ""t2"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""dep_avg"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2) SELECT ""t2"".""pay_month"",""t2"".""department_id"",CASE WHEN ""t2"".""dep_avg"">""t1"".""com_avg"" THEN 'higher' WHEN ""t2"".""dep_avg""<""t1"".""com_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""t1"" RIGHT JOIN ""t2"" ON ""t1"".""pay_month""=""t2"".""pay_month"""
14,"WITH ""sal_dep"" AS (SELECT TO_CHAR(""S"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""E"".""department_id"",SUM(""S"".""amount"") AS ""department_salary"",COUNT(""S"".""amount"") AS ""department_count"" FROM ""salary"" AS ""S"" JOIN ""employee"" AS ""E"" ON ""S"".""employee_id""=""E"".""employee_id"" GROUP BY ""pay_month"",""E"".""department_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""A"".""pay_month"",""B"".""department_id"",""A"".""company_avg"",""B"".""department_avg"" FROM (SELECT ""pay_month"",SUM(""department_salary"")/SUM(""department_count"") AS ""company_avg"" FROM ""sal_dep"" GROUP BY ""pay_month"") AS ""A"" RIGHT JOIN (SELECT ""pay_month"",""department_id"",SUM(""department_salary"")/SUM(""department_count"") AS ""department_avg"" FROM ""sal_dep"" GROUP BY ""pay_month"",""department_id"") AS ""B"" ON ""A"".""pay_month""=""B"".""pay_month"") AS ""Z"""
15,"WITH ""dep"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dep_avg"" FROM ""salary"" JOIN ""employee"" USING (""employee_id"") GROUP BY SUBSTRING(""pay_date"", 1, 7),""department_id""), ""com"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""company_avg"" FROM ""salary"" GROUP BY SUBSTRING(""pay_date"", 1, 7)) SELECT ""pay_month"",""department_id"",(CASE WHEN ""dep_avg"">""company_avg"" THEN 'higher' WHEN ""dep_avg""=""company_avg"" THEN 'same' WHEN ""dep_avg""<""company_avg"" THEN 'lower' END) AS ""comparison"" FROM ""dep"" JOIN ""com"" USING (""pay_month"")"
16,"WITH ""A"" AS (SELECT LEFT(""S1"".""PAY_DATE"", 7) AS ""MONTH"",""E1"".""DEPARTMENT_ID"",AVG(""S1"".""AMOUNT"") AS ""SAL"" FROM ""EMPLOYEE"" AS ""E1"" JOIN ""SALARY"" AS ""S1"" ON ""E1"".""EMPLOYEE_ID""=""S1"".""EMPLOYEE_ID"" GROUP BY ""MONTH"",""E1"".""DEPARTMENT_ID""), ""C"" AS (SELECT LEFT(""S2"".""PAY_DATE"", 7) AS ""M"",AVG(""S2"".""AMOUNT"") AS ""CAL"" FROM ""SALARY"" AS ""S2"" GROUP BY ""M"") SELECT ""A"".""MONTH"" AS ""PAY_MONTH"",""A"".""DEPARTMENT_ID"",CASE WHEN ""SAL"">""CAL"" THEN 'higher' WHEN ""SAL""<""CAL"" THEN 'lower' ELSE 'same' END AS ""COMPARISON"" FROM ""A"" JOIN ""C"" ON ""A"".""MONTH""=""C"".""M"""
17,"WITH ""t1"" AS (SELECT ""salary"".*,""employee"".""department_id"" FROM ""salary"" LEFT JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id""), ""t2"" AS (SELECT ""department_id"",SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""money"" FROM ""t1"" GROUP BY ""department_id"",SUBSTRING(""pay_date"", 1, 7)), ""t3"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""money"" FROM ""t1"" GROUP BY SUBSTRING(""pay_date"", 1, 7)) SELECT ""t2"".""pay_month"",""t2"".""department_id"",CASE WHEN ""t2"".""money"">""t3"".""money"" THEN 'higher' WHEN ""t2"".""money""<""t3"".""money"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""t2"" LEFT JOIN ""t3"" ON ""t2"".""pay_month""=""t3"".""pay_month"""
18,"WITH ""company"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",SUM(""amount"")/COUNT(1) AS ""company_average"" FROM ""salary"" GROUP BY ""pay_month""), ""department"" AS (SELECT ""t2"".""department_id"",TO_CHAR(""t1"".""pay_date"", 'YYYY-%m') AS ""pay_month"",SUM(""t1"".""amount"")/COUNT(1) AS ""department_average"" FROM ""salary"" AS ""t1"" JOIN ""employee"" AS ""t2"" ON ""t2"".""employee_id""=""t1"".""employee_id"" GROUP BY ""t2"".""department_id"",""pay_month"") SELECT ""t1"".""pay_month"",""t1"".""department_id"",CASE WHEN ""t1"".""department_average"">""t2"".""company_average"" THEN 'higher' WHEN ""t1"".""department_average""<""t2"".""company_average"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""department"" AS ""t1"" JOIN ""company"" AS ""t2"" ON ""t2"".""pay_month""=""t1"".""pay_month"" ORDER BY ""t1"".""pay_month"" DESC,""t1"".""department_id"""
19,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
20,"WITH ""cte"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""comp_avg"" FROM ""salary"" GROUP BY 1), ""cte1"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dep_avg"" FROM ""salary"" AS ""x"" JOIN ""employee"" AS ""y"" ON ""x"".""employee_id""=""y"".""employee_id"" GROUP BY 1,2) SELECT ""a"".""pay_month"",""b"".""department_id"",CASE WHEN ""b"".""dep_avg""<""a"".""comp_avg"" THEN 'lower' WHEN ""b"".""dep_avg""=""a"".""comp_avg"" THEN 'same' ELSE 'higher' END AS ""comparison"" FROM ""cte"" AS ""a"" LEFT JOIN ""cte1"" AS ""b"" ON ""a"".""pay_month""=""b"".""pay_month"""
21,"WITH ""t"" AS (SELECT DISTINCT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""com"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m'), ""department_id"") AS ""dept"" FROM ""salary"" JOIN ""employee"" USING (""employee_id"")) SELECT ""pay_month"",""department_id"",CASE WHEN ""dept"">""com"" THEN 'higher' WHEN ""dept""<""com"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""t"""
22,"WITH ""temp"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""department_avg"" FROM ""salary"" LEFT JOIN ""employee"" ON ""employee"".""employee_id""=""salary"".""employee_id"" GROUP BY ""department_id"",""pay_month"") SELECT ""temp"".""pay_month"",""temp"".""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""temp"" LEFT JOIN (SELECT AVG(""amount"") AS ""company_avg"",LEFT(""pay_date"", 7) AS ""pay_month"" FROM ""salary"" GROUP BY ""pay_month"") AS ""temp1"" ON ""temp"".""pay_month""=""temp1"".""pay_month"""
23,"SELECT ""pay_month"",""department_id"",CASE WHEN ""average_dept_month"">""average_month"" THEN 'higher' WHEN ""average_dept_month""<""average_month"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT DISTINCT ""e"".""department_id"",LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""e"".""department_id"") AS ""average_dept_month"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""average_month"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""ASD"" ORDER BY ""pay_month"" DESC"
24,"WITH ""avg_by_dept"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",""e"".""department_id"",SUM(""s"".""amount"")/COUNT(1) AS ""dept_avg_per_mon"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2), ""avg_by_company"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",SUM(""amount"")/COUNT(1) AS ""cmpy_avg_per_mon"" FROM ""salary"" GROUP BY 1) SELECT ""d"".""pay_month"",""d"".""department_id"",CASE WHEN ""d"".""dept_avg_per_mon"">""c"".""cmpy_avg_per_mon"" THEN 'higher' WHEN ""d"".""dept_avg_per_mon""<""c"".""cmpy_avg_per_mon"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""avg_by_dept"" AS ""d"" JOIN ""avg_by_company"" AS ""c"" ON ""d"".""pay_month""=""c"".""pay_month"""
25,"SELECT ""t"".""pay_month"",""t"".""department_id"",CASE WHEN ""d_avg"">""c_avg"" THEN 'higher' WHEN ""d_avg""=""c_avg"" THEN 'same' WHEN ""d_avg""<""c_avg"" THEN 'lower' END AS ""comparison"" FROM (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""d_avg"" FROM (SELECT ""s"".*,TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""d"".""department_id"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""d"" ON ""s"".""employee_id""=""d"".""employee_id"") AS ""e"" GROUP BY ""pay_month"",""department_id"") AS ""t"" JOIN (SELECT ""pay_month"",AVG(""amount"") AS ""c_avg"" FROM (SELECT ""sal"".*,TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""dep"".""department_id"" FROM ""salary"" AS ""sal"" JOIN ""employee"" AS ""dep"" ON ""sal"".""employee_id""=""dep"".""employee_id"") AS ""emp"" GROUP BY ""pay_month"") AS ""l"" ON ""t"".""pay_month""=""l"".""pay_month"""
26,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
27,"WITH ""a"" AS (SELECT AVG(""amount"") AS ""tot_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""b"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""dept_avg"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m'),""e"".""department_id"") SELECT ""a"".""pay_month"",""b"".""department_id"",CASE WHEN ""b"".""dept_avg"">""a"".""tot_avg"" THEN 'higher' WHEN ""b"".""dept_avg""<""a"".""tot_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""a"" JOIN ""b"" ON ""a"".""pay_month""=""b"".""pay_month"""
28,"WITH ""company_avg_monthly"" AS (SELECT EXTRACT(YEAR FROM ""pay_date"") AS ""yr"",EXTRACT(MONTH FROM ""pay_date"") AS ""mth"",AVG(""AMOUNT"") AS ""avg_comp_salary"" FROM ""salary"" GROUP BY EXTRACT(MONTH FROM ""pay_date"") ORDER BY 1), ""dep_avg_monthly"" AS (SELECT EXTRACT(YEAR FROM ""pay_date"") AS ""yr"",LPAD(EXTRACT(MONTH FROM ""pay_date""), 2, 0) AS ""mth"",""employee"".""department_id"",AVG(""amount"") AS ""avg_dep_salary"" FROM ""salary"" LEFT JOIN ""employee"" ON ""employee"".""employee_id""=""salary"".""employee_id"" GROUP BY EXTRACT(MONTH FROM ""pay_date""),""employee"".""department_id"" ORDER BY 1,2), ""combined"" AS (SELECT CAST(""dam"".""yr"" AS CHAR) AS ""yr"",CAST(""dam"".""mth"" AS CHAR) AS ""mth"",""dam"".""department_id"",""dam"".""avg_dep_salary"",""cam"".""avg_comp_salary"" FROM ""dep_avg_monthly"" AS ""dam"" JOIN ""company_avg_monthly"" AS ""cam"" ON (""dam"".""yr""=""cam"".""yr"") AND (""dam"".""mth""=""cam"".""mth"")) SELECT CONCAT(""yr"", '-', ""mth"") AS ""pay_month"",""department_id"",CASE WHEN ""avg_dep_salary"">""avg_comp_salary"" THEN 'higher' WHEN ""avg_dep_salary""<""avg_comp_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""combined"""
29,"WITH ""dept"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""b"".""department_id"",AVG(""a"".""amount"") AS ""avg_salary_dep"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"" GROUP BY 1,2), ""comp"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""avg_salary_comp"" FROM ""salary"" GROUP BY SUBSTRING(""pay_date"", 1, 7)) SELECT ""a"".""pay_month"",""a"".""department_id"",CASE WHEN ""a"".""avg_salary_dep"">""b"".""avg_salary_comp"" THEN 'higher' WHEN ""a"".""avg_salary_dep""<""b"".""avg_salary_comp"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""dept"" AS ""a"" LEFT JOIN ""comp"" AS ""b"" ON ""a"".""pay_month""=""b"".""pay_month"""
30,"SELECT ""s1"".""pay_month"",""s2"".""department_id"",CASE WHEN ""s2"".""avg_department_salary"">""s1"".""avg_company_salary"" THEN 'higher' WHEN ""s2"".""avg_department_salary""=""s1"".""avg_company_salary"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""avg_company_salary"" FROM ""salary"" GROUP BY ""pay_month"") AS ""s1"" JOIN (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""avg_department_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""department_id"") AS ""s2"" ON ""s1"".""pay_month""=""s2"".""pay_month"""
31,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
32,"SELECT ""result"".""pay_month"",""result"".""department_id"",CASE WHEN ""dept_avg"">""comp_avg"" THEN 'higher' WHEN ""dept_avg""<""comp_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""dept_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""result"" JOIN (SELECT AVG(""amount"") AS ""comp_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY ""pay_month"") AS ""comp"" ON ""result"".""pay_month""=""comp"".""pay_month"""
33,"WITH ""ac"" AS (SELECT LEFT(""pay_date"", 7) AS ""cpay_month"",AVG(""amount"") AS ""avg_com"" FROM ""salary"" GROUP BY LEFT(""pay_date"", 7)), ""ae"" AS (SELECT LEFT(""s"".""pay_date"", 7) AS ""epay_month"",""d"".""department_id"",AVG(""s"".""amount"") AS ""avg_emp"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""d"" ON ""s"".""employee_id""=""d"".""employee_id"" GROUP BY LEFT(""s"".""pay_date"", 7),""d"".""department_id"") SELECT ""ae"".""epay_month"" AS ""pay_month"",""ae"".""department_id"",(CASE WHEN ""avg_emp"">""avg_com"" THEN 'higher' WHEN ""avg_emp""<""avg_com"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""ae"" JOIN ""ac"" ON ""ae"".""epay_month""=""ac"".""cpay_month"""
34,"WITH ""t1"" AS (SELECT ""t2"".""employee_id"",""amount"",""pay_date"",""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY ""t2"".""pay_date"") AS ""company_avg_salary"",AVG(""amount"") OVER (PARTITION BY ""t2"".""pay_date"", ""t3"".""department_id"") AS ""department_avg_salary"" FROM ""salary"" AS ""t2"" JOIN ""employee"" AS ""t3"" ON ""t2"".""employee_id""=""t3"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""department_avg_salary"">""company_avg_salary"" THEN 'higher' WHEN ""department_avg_salary""<""company_avg_salary"" THEN 'lower' WHEN ""department_avg_salary""=""company_avg_salary"" THEN 'same' END) AS ""comparison"" FROM ""t1"""
35,"SELECT ""A"".""pay_month"",""department_id"",(CASE WHEN ""depart_avg"">""comp_avg"" THEN 'higher' WHEN ""depart_avg""=""comp_avg"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""depart_avg"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY SUBSTRING(""pay_date"", 1, 7),""department_id"") AS ""A"" JOIN (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""comp_avg"" FROM ""salary"" GROUP BY SUBSTRING(""pay_date"", 1, 7)) AS ""B"" ON ""A"".""pay_month""=""B"".""pay_month"""
36,"WITH ""COMPANY_AVG"" AS (SELECT TO_CHAR(""PAY_DATE"", 'YYYY-%m') AS ""pay_month"",AVG(""AMOUNT"") AS ""pay_avg"" FROM ""SALARY"" GROUP BY 1), ""DEPARTMENT_AVG"" AS (SELECT ""E"".""DEPARTMENT_ID"",TO_CHAR(""PAY_DATE"", 'YYYY-%m') AS ""pay_month"",AVG(""AMOUNT"") AS ""dept_avg"" FROM ""SALARY"" AS ""S"" JOIN ""EMPLOYEE"" AS ""E"" ON ""S"".""EMPLOYEE_ID""=""E"".""EMPLOYEE_ID"" GROUP BY 1,2) SELECT ""CA"".""PAY_MONTH"" AS ""pay_month"",""DA"".""DEPARTMENT_ID"" AS ""department_id"",CASE WHEN ""DEPT_AVG"">""PAY_AVG"" THEN 'higher' WHEN ""DEPT_AVG""<""PAY_AVG"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""COMPANY_AVG"" AS ""CA"" JOIN ""DEPARTMENT_AVG"" AS ""DA"" ON ""CA"".""PAY_MONTH""=""DA"".""PAY_MONTH"""
37,"WITH ""tmp"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""company_avg"" FROM ""salary"" GROUP BY 1) SELECT ""t"".""pay_month"",""t"".""department_id"",CASE WHEN ""dept_avg"">""company_avg"" THEN 'higher' WHEN ""dept_avg""=""company_avg"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dept_avg"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" USING (""employee_id"") GROUP BY 1,2) AS ""t"" JOIN ""tmp"" AS ""b"" ON ""t"".""pay_month""=""b"".""pay_month"""
38,"WITH ""A"" AS (SELECT LEFT(""S1"".""PAY_DATE"", 7) AS ""MONTH"",""E1"".""DEPARTMENT_ID"",AVG(""S1"".""AMOUNT"") AS ""ES"" FROM ""EMPLOYEE"" AS ""E1"" JOIN ""SALARY"" AS ""S1"" ON ""E1"".""EMPLOYEE_ID""=""S1"".""EMPLOYEE_ID"" GROUP BY ""MONTH"",""E1"".""DEPARTMENT_ID""), ""C"" AS (SELECT LEFT(""S2"".""PAY_DATE"", 7) AS ""M"",AVG(""S2"".""AMOUNT"") AS ""CS"" FROM ""SALARY"" AS ""S2"" GROUP BY ""M"") SELECT ""A"".""MONTH"" AS ""PAY_MONTH"",""A"".""DEPARTMENT_ID"",CASE WHEN ""ES"">""CS"" THEN 'higher' WHEN ""ES""<""CS"" THEN 'lower' ELSE 'same' END AS ""COMPARISON"" FROM ""A"" JOIN ""C"" ON ""A"".""MONTH""=""C"".""M"""
39,"WITH ""cte_office"" AS (SELECT CONCAT(EXTRACT(YEAR FROM ""pay_date""), '-', CASE WHEN LENGTH(EXTRACT(MONTH FROM ""pay_date""))<2 THEN CONCAT('0', EXTRACT(MONTH FROM ""pay_date"")) ELSE EXTRACT(MONTH FROM ""pay_date"") END) AS ""pay_month"",ROUND(AVG(""amount""), 2) AS ""office_salary"" FROM ""salary"" GROUP BY CONCAT(EXTRACT(YEAR FROM ""pay_date""), '-', CASE WHEN LENGTH(EXTRACT(MONTH FROM ""pay_date""))<2 THEN CONCAT('0', EXTRACT(MONTH FROM ""pay_date"")) ELSE EXTRACT(MONTH FROM ""pay_date"") END)), ""cte_department"" AS (SELECT CONCAT(EXTRACT(YEAR FROM ""pay_date""), '-', CASE WHEN LENGTH(EXTRACT(MONTH FROM ""pay_date""))<2 THEN CONCAT('0', EXTRACT(MONTH FROM ""pay_date"")) ELSE EXTRACT(MONTH FROM ""pay_date"") END) AS ""pay_month"",""E"".""department_id"",ROUND(AVG(""amount""), 2) AS ""dept_salary"" FROM ""salary"" AS ""S"" LEFT JOIN ""employee"" AS ""E"" ON ""S"".""employee_id""=""E"".""employee_id"" GROUP BY ""E"".""department_id"",CONCAT(EXTRACT(YEAR FROM ""pay_date""), '-', CASE WHEN LENGTH(EXTRACT(MONTH FROM ""pay_date""))<2 THEN CONCAT('0', EXTRACT(MONTH FROM ""pay_date"")) ELSE EXTRACT(MONTH FROM ""pay_date"") END)) SELECT ""A"".""pay_month"",""A"".""department_id"",CASE WHEN ""A"".""dept_salary"">""B"".""office_salary"" THEN 'higher' WHEN ""A"".""dept_salary""<""B"".""office_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte_department"" AS ""A"" RIGHT JOIN ""cte_office"" AS ""B"" ON ""A"".""pay_month""=""B"".""pay_month"" WHERE ""A"".""department_id"" IS NOT NULL ORDER BY ""A"".""pay_month"" DESC,""A"".""department_id"""
40,"SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""s"".*,""e"".""department_id"",LEFT(""s"".""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY LEFT(""s"".""pay_date"", 7)) AS ""company_avg"",AVG(""amount"") OVER (PARTITION BY LEFT(""s"".""pay_date"", 7), ""e"".""department_id"") AS ""department_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_Id"") AS ""tmp"" ORDER BY ""pay_month"" DESC,""department_id"""
41,"WITH ""tmp"" AS (SELECT ""t1"".""employee_id"",""t1"".""amount"",TO_CHAR(""t1"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""t2"".""department_id"" FROM ""salary"" AS ""t1"" LEFT JOIN ""employee"" AS ""t2"" ON ""t1"".""employee_id""=""t2"".""employee_id""), ""tmp2"" AS (SELECT ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""depart_avg"",AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""company_avg"" FROM ""tmp"") SELECT ""pay_month"",""department_id"",CASE WHEN ""depart_avg"">""company_avg"" THEN 'higher' WHEN ""depart_avg""<""company_avg"" THEN 'lower' WHEN ""depart_avg""=""company_avg"" THEN 'same' END AS ""comparison"" FROM ""tmp2"" GROUP BY 1,2,3 ORDER BY ""pay_month"" DESC,""department_id"""
42,"SELECT ""pay_month"",""department_id"",(CASE WHEN ""dep_avg"">""company_avg"" THEN 'higher' WHEN ""dep_avg""=""company_avg"" THEN 'same' WHEN ""dep_avg""<""company_avg"" THEN 'lower' END) AS ""comparison"" FROM (SELECT DISTINCT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY SUBSTRING(""pay_date"", 1, 7), ""department_id"") AS ""dep_avg"",AVG(""amount"") OVER (PARTITION BY SUBSTRING(""pay_date"", 1, 7)) AS ""company_avg"" FROM ""salary"" JOIN ""employee"" AS ""comparison"" USING (""employee_id"")) AS ""temp"""
43,"SELECT SUBSTRING(""a"".""pay_date"", 1, 7) AS ""pay_month"",""b"".""department_id"",CASE WHEN ROUND(SUM(""a"".""amount"")/""c"".""employee_count"", 2)>""d"".""company_avg"" THEN 'higher' WHEN ROUND(SUM(""a"".""amount"")/""c"".""employee_count"", 2)<""d"".""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ((""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") LEFT JOIN (SELECT ""department_id"",COUNT(DISTINCT ""employee_id"") AS ""employee_count"" FROM ""employee"" GROUP BY ""department_id"") AS ""c"" ON ""b"".""department_id""=""c"".""department_id"") LEFT JOIN (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_date"",ROUND(AVG(""amount""), 2) AS ""company_avg"" FROM ""salary"" GROUP BY SUBSTRING(""pay_date"", 1, 7)) AS ""d"" ON SUBSTRING(""a"".""pay_date"", 1, 7)=SUBSTRING(""d"".""pay_date"", 1, 7) GROUP BY ""b"".""department_id"",SUBSTRING(""a"".""pay_date"", 1, 7)"
44,"WITH ""total"" AS (SELECT ""s"".""employee_id"",""s"".""amount"",SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",""e"".""department_id"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""department_avg"" AS (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""depart_avg_amount"" FROM ""total"" GROUP BY ""pay_month"",""department_id""), ""company_avg"" AS (SELECT ""pay_month"",AVG(""amount"") AS ""comp_avg_amount"" FROM ""total"" GROUP BY ""pay_month"") SELECT ""D"".""pay_month"",""D"".""department_id"",(CASE WHEN ""D"".""depart_avg_amount"">""C"".""comp_avg_amount"" THEN 'higher' WHEN ""D"".""depart_avg_amount""=""C"".""comp_avg_amount"" THEN 'same' WHEN ""D"".""depart_avg_amount""<""C"".""comp_avg_amount"" THEN 'lower' END) AS ""comparison"" FROM ""department_avg"" AS ""D"" LEFT JOIN ""company_avg"" AS ""C"" ON ""D"".""pay_month""=""C"".""pay_month"""
45,"SELECT ""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""comp_avg"" THEN 'higher' WHEN ""dept_avg""<""comp_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT TO_CHAR(""b"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""a"".""department_id"",AVG(""b"".""amount"") AS ""dept_avg"",""d"".""comp_avg"" FROM (""employee"" AS ""a"" JOIN ""salary"" AS ""b"" ON (""a"".""employee_id""=""b"".""employee_id"")) JOIN (SELECT TO_CHAR(""c"".""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""c"".""amount"") AS ""comp_avg"" FROM ""salary"" AS ""c"" GROUP BY TO_CHAR(""c"".""pay_date"", 'YYYY-%m')) AS ""d"" ON (TO_CHAR(""b"".""pay_date"", 'YYYY-%m')=""d"".""pay_month"") GROUP BY TO_CHAR(""b"".""pay_date"", 'YYYY-%m'),""department_id"",""d"".""comp_avg"") AS ""final"""
46,"WITH ""dep_salary"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""avg_dep"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id""), ""company"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""avg_com"" FROM ""salary"" GROUP BY ""pay_month"") SELECT ""d"".""pay_month"",""d"".""department_id"",CASE WHEN ""avg_dep"">""avg_com"" THEN 'higher' WHEN ""avg_dep""<""avg_com"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""dep_salary"" AS ""d"" JOIN ""company"" AS ""c"" ON ""d"".""pay_month""=""c"".""pay_month"""
47,"WITH ""a"" AS (SELECT AVG(""amount"") AS ""tot_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""b"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""dept_avg"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m'),""e"".""department_id"") SELECT ""a"".""pay_month"",""b"".""department_id"",CASE WHEN ""b"".""dept_avg"">""a"".""tot_avg"" THEN 'higher' WHEN ""b"".""dept_avg""<""a"".""tot_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""a"" JOIN ""b"" ON ""a"".""pay_month""=""b"".""pay_month"""
48,"WITH ""combined"" AS (SELECT ""department_id"",""salary"".""employee_id"",""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id""), ""department_average"" AS (SELECT AVG(""amount"") AS ""department_mean"",""department_id"",""pay_month"" FROM ""combined"" GROUP BY ""department_id"",""pay_month""), ""company_average"" AS (SELECT AVG(""amount"") AS ""company_mean"",""pay_month"" FROM ""combined"" GROUP BY ""pay_month"") SELECT ""department_average"".""pay_month"",""department_average"".""department_id"",CASE WHEN ""department_average"".""department_mean"">""company_average"".""company_mean"" THEN 'higher' WHEN ""department_average"".""department_mean""<""company_average"".""company_mean"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""department_average"" JOIN ""company_average"" WHERE ""department_average"".""pay_month""=""company_average"".""pay_month"""
49,"SELECT ""month"" AS ""pay_month"",""department_id"",CASE WHEN ""avg_d"">""avg_o"" THEN 'higher' WHEN ""avg_d""<""avg_o"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""s"".""employee_id"",""department_id"",LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") OVER (PARTITION BY ""department_id"", LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_d"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_o"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"") AS ""temp"" GROUP BY 1,2"
50,"WITH ""t1"" AS (SELECT ""department_id"",""a"".""employee_id"",""amount"",LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""com_avg"" FROM ""salary"" AS ""a"" RIGHT JOIN ""employee"" USING (""employee_id"") GROUP BY 4), ""t2"" AS (SELECT ""department_id"",""a"".""employee_id"",""amount"",LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""dep_avg"" FROM ""salary"" AS ""a"" RIGHT JOIN ""employee"" USING (""employee_id"") GROUP BY 1,4) SELECT ""t2"".""pay_month"",""t2"".""department_id"",CASE WHEN ""dep_avg"">""com_avg"" THEN 'higher' WHEN ""dep_avg""<""com_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t1"".""pay_month""=""t2"".""pay_month"""
51,"WITH ""d"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dept_avg"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2), ""c"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""comp_avg"" FROM ""salary"" GROUP BY 1) SELECT ""d"".""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""comp_avg"" THEN 'higher' WHEN ""dept_avg""<""comp_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""d"" JOIN ""c"" ON ""d"".""pay_month""=""c"".""pay_month"""
52,"WITH ""avg_salary"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"" AS ""department_id"",AVG(""s"".""amount"") OVER (PARTITION BY TO_CHAR(""s"".""pay_date"", 'YYYY-%m'), ""e"".""department_id"") AS ""dept_avg"",AVG(""s"".""amount"") OVER (PARTITION BY TO_CHAR(""s"".""pay_date"", 'YYYY-%m')) AS ""company_avg"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""company_avg"" THEN 'higher' WHEN ""dept_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""avg_salary"" ORDER BY 1 DESC,2"
53,"WITH ""cte"" AS (SELECT AVG(""amount"") AS ""avg_salary_company"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""cte2"" AS (SELECT AVG(""amount"") AS ""avg_salary_department"",""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m')) SELECT ""cte"".""pay_month"" AS ""pay_month"",""department_id"",CASE WHEN ""avg_salary_department"">""avg_salary_company"" THEN 'higher' WHEN ""avg_salary_department""<""avg_salary_company"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte"" JOIN ""cte2"" ON ""cte2"".""pay_month""=""cte"".""pay_month"""
54,"SELECT ""t"".""pay_month"",""t"".""department_id"",CASE WHEN ""t"".""aavg"">""t2"".""cavg"" THEN 'higher' WHEN ""t"".""aavg""<""t2"".""cavg"" THEN 'lower' WHEN ""t"".""aavg""=""t2"".""cavg"" THEN 'same' END AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""aavg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""department_id"") AS ""t"" JOIN (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""cavg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"") AS ""t2"" ON ""t"".""pay_month""=""t2"".""pay_month"""
55,"WITH ""temp"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""com_avg"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""temp1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dept_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m')) SELECT ""temp1"".""pay_month"",""department_id"",CASE WHEN ""dept_avg""=""com_avg"" THEN 'same' WHEN ""dept_avg"">""com_avg"" THEN 'higher' ELSE 'lower' END AS ""comparison"" FROM ""temp1"" JOIN ""temp"" ON ""temp1"".""pay_month""=""temp"".""pay_month"""
56,"SELECT ""pay_month"",""department_id"",(CASE WHEN ""dept_avg_sal""=""comp_avg_sal"" THEN 'same' WHEN ""dept_avg_sal""<""comp_avg_sal"" THEN 'lower' ELSE 'higher' END) AS ""comparison"" FROM (SELECT DISTINCT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""dept_avg_sal"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""comp_avg_sal"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"") AS ""A"""
57,"WITH ""sal_dep"" AS (SELECT TO_CHAR(""S"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""E"".""department_id"",SUM(""S"".""amount"") AS ""department_salary"",COUNT(""S"".""amount"") AS ""department_count"" FROM ""salary"" AS ""S"" JOIN ""employee"" AS ""E"" ON ""S"".""employee_id""=""E"".""employee_id"" GROUP BY ""pay_month"",""E"".""department_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""A"".""pay_month"",""B"".""department_id"",""A"".""company_avg"",""B"".""department_avg"" FROM (SELECT ""pay_month"",SUM(""department_salary"")/SUM(""department_count"") AS ""company_avg"" FROM ""sal_dep"" GROUP BY ""pay_month"") AS ""A"" RIGHT JOIN (SELECT ""pay_month"",""department_id"",SUM(""department_salary"")/SUM(""department_count"") AS ""department_avg"" FROM ""sal_dep"" GROUP BY ""pay_month"",""department_id"") AS ""B"" ON ""A"".""pay_month""=""B"".""pay_month"") AS ""Z"""
58,"SELECT ""Sub"".""pay_month"",""Sub"".""department_id"",CASE WHEN ""Sub"".""dpt_avg"">""Sub"".""company_avg"" THEN 'higher' WHEN ""Sub"".""dpt_avg""<""Sub"".""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""S"".*,""E"".""department_id"",AVG(""S"".""amount"") OVER (PARTITION BY ""S"".""pay_date"") AS ""company_avg"",AVG(""S"".""amount"") OVER (PARTITION BY ""S"".""pay_date"", ""E"".""department_id"") AS ""dpt_avg"",TO_CHAR(""S"".""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""S"" LEFT JOIN ""employee"" AS ""E"" ON ""S"".""employee_id""=""E"".""employee_id"" ORDER BY ""S"".""id"") AS ""Sub"" GROUP BY ""Sub"".""pay_month"",""Sub"".""department_id"" ORDER BY ""Sub"".""pay_month"" DESC,""Sub"".""department_id"""
59,"WITH ""t1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""cmpy_avg"" FROM ""salary"" GROUP BY ""pay_month""), ""t2"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""dpt_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""e"".""department_id"",""pay_month"") SELECT ""t2"".""pay_month"",""department_id"",CASE WHEN ""cmpy_avg""=""dpt_avg"" THEN 'same' ELSE CASE WHEN ""dpt_avg"">""cmpy_avg"" THEN 'higher' ELSE 'lower' END END AS ""comparison"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t1"".""pay_month""=""t2"".""pay_month"" ORDER BY ""t2"".""department_id"",""t2"".""pay_month"" DESC"
60,"WITH ""ds"" AS (SELECT ""e"".""department_id"",""s"".""amount"",TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""ds_avg"" AS (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""d_avg"" FROM ""ds"" GROUP BY 1,2), ""c_avg"" AS (SELECT ""pay_month"",AVG(""amount"") AS ""c_avg"" FROM ""ds"" GROUP BY 1) SELECT ""d"".""pay_month"",""d"".""department_id"",CASE WHEN ""d_avg"">""c_avg"" THEN 'higher' WHEN ""d_avg""<""c_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""ds_avg"" AS ""d"" LEFT JOIN ""c_avg"" AS ""c"" ON ""d"".""pay_month""=""c"".""pay_month"""
61,"WITH ""TEMP"" AS (SELECT LEFT(""a"".""pay_date"", 7) AS ""pay_month"",""b"".""department_id"",AVG(""a"".""amount"") AS ""department_salary"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"" GROUP BY 1,2) SELECT ""d"".""pay_month"",""d"".""department_id"",CASE WHEN ""d"".""department_salary"">""c"".""company_salary"" THEN 'higher' WHEN ""d"".""department_salary""<""c"".""company_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""TEMP"" AS ""d"" LEFT JOIN (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""company_salary"" FROM ""salary"" GROUP BY 1) AS ""c"" ON ""d"".""pay_month""=""c"".""pay_month"" ORDER BY 1 DESC,2"
62,"WITH ""company"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",SUM(""amount"")/COUNT(1) AS ""company_average"" FROM ""salary"" GROUP BY ""pay_month""), ""department"" AS (SELECT ""t2"".""department_id"",TO_CHAR(""t1"".""pay_date"", 'YYYY-%m') AS ""pay_month"",SUM(""t1"".""amount"")/COUNT(1) AS ""department_average"" FROM ""salary"" AS ""t1"" JOIN ""employee"" AS ""t2"" ON ""t2"".""employee_id""=""t1"".""employee_id"" GROUP BY ""t2"".""department_id"",""pay_month"") SELECT ""t1"".""pay_month"",""t1"".""department_id"",CASE WHEN ""t1"".""department_average"">""t2"".""company_average"" THEN 'higher' WHEN ""t1"".""department_average""<""t2"".""company_average"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""department"" AS ""t1"" JOIN ""company"" AS ""t2"" ON ""t2"".""pay_month""=""t1"".""pay_month"" ORDER BY ""t1"".""pay_month"" DESC,""t1"".""department_id"""
63,"WITH ""cte"" AS (SELECT ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY ""pay_date"", ""department_id"") AS ""dept_avg"",AVG(""amount"") OVER (PARTITION BY ""pay_date"") AS ""company_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""dept_avg"">""company_avg"" THEN 'higher' WHEN ""dept_avg""<""company_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""cte"" ORDER BY ""pay_month"" DESC,""department_id"""
64,"SELECT ""da"".""month"" AS ""pay_month"",""department_id"",CASE WHEN ""department_average"">""company_average"" THEN 'higher' WHEN ""department_average""<""company_average"" THEN 'lower' WHEN ""department_average""=""company_average"" THEN 'same' END AS ""comparison"" FROM (SELECT SUBSTR(""pay_date"", 1, 7) AS ""month"",""department_id"",AVG(""amount"") AS ""department_average"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY 1,2) AS ""da"" JOIN (SELECT SUBSTR(""pay_date"", 1, 7) AS ""month"",AVG(""amount"") AS ""company_average"" FROM ""salary"" GROUP BY 1) AS ""ca"" ON ""da"".""month""=""ca"".""month"""
65,"WITH ""monthly_avg"" AS (SELECT SUBSTR(""a"".""pay_date"", 1, 7) AS ""mnth"",""b"".""department_id"",AVG(""amount"") AS ""avg_salary"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"" GROUP BY 1,2), ""company_avg"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""mnth"",AVG(""amount"") AS ""avg_comp_salary"" FROM ""salary"" GROUP BY 1) SELECT ""a"".""mnth"" AS ""pay_month"",""a"".""department_id"",CASE WHEN ""a"".""avg_salary"">""b"".""avg_comp_salary"" THEN 'higher' WHEN ""a"".""avg_salary""=""b"".""avg_comp_salary"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""monthly_avg"" AS ""a"" LEFT JOIN ""company_avg"" AS ""b"" ON ""a"".""mnth""=""b"".""mnth"""
66,"WITH ""t1"" AS (SELECT ""pay_date"" AS ""pay_month"",AVG(""amount"") AS ""cmpy_avg"" FROM ""salary"" GROUP BY EXTRACT(MONTH FROM ""pay_date"")), ""t2"" AS (SELECT ""pay_date"" AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""dpt_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""e"".""department_id"",EXTRACT(MONTH FROM ""pay_date"")) SELECT TO_CHAR(""t2"".""pay_month"", 'YYYY-%m') AS ""pay_month"",""department_id"",CASE WHEN ""dpt_avg"">""cmpy_avg"" THEN 'higher' WHEN ""dpt_avg""<""cmpy_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t1"".""pay_month""=""t2"".""pay_month"" ORDER BY ""t2"".""department_id"",""t2"".""pay_month"" DESC"
67,"SELECT ""pay_month"",""department_id"",(CASE WHEN ""dept_avg_sal""=""comp_avg_sal"" THEN 'same' WHEN ""dept_avg_sal""<""comp_avg_sal"" THEN 'lower' ELSE 'higher' END) AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dept_avg_sal"",(SELECT AVG(""amount"") FROM ""salary"" WHERE LEFT(""pay_date"", 7)=""pay_month"") AS ""comp_avg_sal"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY ""pay_month"",""department_id"") AS ""A"""
68,"WITH ""cmp"" AS (SELECT LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") AS ""cm_avg"" FROM ""salary"" GROUP BY 1), ""dept"" AS (SELECT ""department_id"",LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") AS ""dpt_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2) SELECT ""cmp"".""month"" AS ""pay_month"",""department_id"",CASE WHEN ""cm_avg"">""dpt_avg"" THEN 'lower' WHEN ""cm_avg""<""dpt_avg"" THEN 'higher' ELSE 'same' END AS ""comparison"" FROM ""cmp"" LEFT JOIN ""dept"" ON ""cmp"".""month""=""dept"".""month"""
69,"WITH ""tmp"" AS (SELECT ""id"",""employee_id"",""amount"",""pay_date"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"") SELECT DISTINCT ""a"".""pay_month"",""a"".""department_id"",(CASE WHEN ""a"".""depart_avg"">""a"".""company_avg"" THEN 'higher' WHEN ""a"".""depart_avg""<""a"".""company_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM (SELECT ""t"".""pay_month"",""e"".""department_id"",AVG(""t"".""amount"") OVER (PARTITION BY ""t"".""pay_month"") AS ""company_avg"",AVG(""t"".""amount"") OVER (PARTITION BY ""t"".""pay_month"", ""e"".""department_id"") AS ""depart_avg"" FROM ""tmp"" AS ""t"" LEFT JOIN ""employee"" AS ""e"" ON ""t"".""employee_id""=""e"".""employee_id"") AS ""a"""
70,"WITH ""temp"" AS (SELECT ""s"".*,""e"".""department_id"",AVG(""amount"") OVER (PARTITION BY ""e"".""department_id"", ""s"".""pay_date"") AS ""dept_avg"",AVG(""amount"") OVER (PARTITION BY ""s"".""pay_date"") AS ""company_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT DISTINCT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""company_avg"" THEN 'higher' ELSE CASE WHEN ""dept_avg""<""company_avg"" THEN 'lower' ELSE 'same' END END AS ""comparison"" FROM ""temp"""
71,"SELECT ""dept"".""pay_month"",""dept"".""department_id"",CASE WHEN ""comp"".""comp_avg"">""dept"".""dept_avg"" THEN 'lower' WHEN ""comp"".""comp_avg""<""dept"".""dept_avg"" THEN 'higher' ELSE 'same' END AS ""comparison"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""comp_avg"" FROM ""salary"" AS ""s"" GROUP BY ""pay_month"") AS ""comp"" JOIN (SELECT ""e"".""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""dept_avg"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""e"".""department_id"",""pay_month"") AS ""dept"" ON ""comp"".""pay_month""=""dept"".""pay_month"""
72,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
73,"SELECT ""month"" AS ""pay_month"",""department_id"",CASE WHEN ""avg_d"">""avg_o"" THEN 'higher' WHEN ""avg_d""<""avg_o"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""s"".""employee_id"",""department_id"",LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") OVER (PARTITION BY ""department_id"", LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_d"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_o"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"") AS ""temp"" GROUP BY 1,2"
74,"SELECT DISTINCT TO_CHAR(""u"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""u"".""department_id"",(CASE WHEN ""u"".""dpt_avg""<""u"".""comp_avg"" THEN 'lower' WHEN ""u"".""dpt_avg"">""u"".""comp_avg"" THEN 'higher' WHEN ""u"".""dpt_avg""=""u"".""comp_avg"" THEN 'same' END) AS ""comparison"" FROM (SELECT ""t"".*,AVG(""t"".""amount"") OVER (PARTITION BY ""t"".""department_id"", ""t"".""pay_date"") AS ""dpt_avg"",AVG(""t"".""amount"") OVER (PARTITION BY ""t"".""pay_date"") AS ""comp_avg"" FROM (SELECT ""a"".*,""b"".""department_id"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") AS ""t"") AS ""u"" ORDER BY ""u"".""pay_date"" DESC,""u"".""department_id"""
75,"WITH ""compavg"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""avgcompsalary"" FROM ""salary"" GROUP BY 1), ""avgdept"" AS (SELECT DISTINCT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""deptavgsalary"" FROM ""salary"" JOIN ""employee"" ON ""employee"".""employee_id""=""salary"".""employee_id"" GROUP BY 1,2) SELECT ""k2"".""pay_month"",""k2"".""department_id"",CASE WHEN ""deptavgsalary"">""avgcompsalary"" THEN 'higher' WHEN ""deptavgsalary""<""avgcompsalary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""compavg"" AS ""k1"" JOIN ""avgdept"" AS ""k2"" ON ""k2"".""pay_month""=""k1"".""pay_month"""
76,"SELECT ""x"".""pay_mon"" AS ""pay_month"",""x"".""department_id"",CASE WHEN ""x"".""avg_amt""=""y"".""t_avg_amt"" THEN 'same' WHEN ""x"".""avg_amt""<""y"".""t_avg_amt"" THEN 'lower' ELSE 'higher' END AS ""comparison"" FROM (SELECT ""e"".""department_id"",""s"".""pay_mon"",AVG(""s"".""amount"") AS ""avg_amt"" FROM (SELECT ""employee_id"",""amount"",SUBSTR(""pay_date"", 1, 7) AS ""pay_mon"" FROM ""salary"") AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""s"".""pay_mon"",""e"".""department_id"") AS ""x"" LEFT JOIN (SELECT ""y"".""pay_mon"",AVG(""amount"") AS ""t_avg_amt"" FROM (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_mon"",""amount"" FROM ""salary"") AS ""y"" GROUP BY ""y"".""pay_mon"") AS ""y"" ON ""x"".""pay_mon""=""y"".""pay_mon"" ORDER BY 1 DESC,2"
77,"WITH ""avg_comp_salary"" AS (SELECT ""pay_date"",AVG(""amount"") AS ""avg_salary"" FROM ""salary"" GROUP BY ""pay_date""), ""avg_dpt_salary"" AS (SELECT ""s"".""pay_date"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""e"".""department_id"",""s"".""pay_date"") SELECT DISTINCT TO_CHAR(""avg_comp_salary"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""avg_dpt_salary"".""department_id"",CASE WHEN ""avg_comp_salary"".""avg_salary""=""avg_dpt_salary"".""avg_salary"" THEN 'same' WHEN ""avg_comp_salary"".""avg_salary""<""avg_dpt_salary"".""avg_salary"" THEN 'higher' WHEN ""avg_comp_salary"".""avg_salary"">""avg_dpt_salary"".""avg_salary"" THEN 'lower' ELSE NULL END AS ""comparison"" FROM ""avg_comp_salary"" JOIN ""avg_dpt_salary"" ON ""avg_comp_salary"".""pay_date""=""avg_dpt_salary"".""pay_date"""
78,"SELECT ""month"" AS ""pay_month"",""department_id"",CASE WHEN ""avg_d"">""avg_o"" THEN 'higher' WHEN ""avg_d""<""avg_o"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""s"".""employee_id"",""department_id"",LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") OVER (PARTITION BY ""department_id"", LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_d"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_o"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"") AS ""temp"" GROUP BY 1,2"
79,"SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""avg_dep"">""avg_comp"" THEN 'higher' WHEN ""avg_dep""=""avg_comp"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT TO_CHAR(""a"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""b"".""department_id"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""a"".""pay_date"", 'YYYY-%m'), ""department_id"") AS ""avg_dep"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""a"".""pay_date"", 'YYYY-%m')) AS ""avg_comp"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") AS ""cte"" ORDER BY ""pay_month"",""department_id"""
80,"SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""company_avg"">""dept_avg"" THEN 'lower' WHEN ""company_avg""<""dept_avg"" THEN 'higher' ELSE 'same' END AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""amount"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""department_id"", ""pay_date"") AS ""dept_avg"",AVG(""amount"") OVER (PARTITION BY ""pay_date"") AS ""company_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""a"""
81,"SELECT ""pay_month"",""department_id"",(CASE WHEN ""dep_avg"">""com_avg"" THEN 'higher' WHEN ""dep_avg""<""com_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""dep_avg"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7) ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS ""com_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""tbl"" GROUP BY 1,2"
82,"SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""department_salary""<""company_salary"" THEN 'lower' WHEN ""department_salary"">""company_salary"" THEN 'higher' WHEN ""department_salary""=""company_salary"" THEN 'same' END AS ""comparison"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m'), ""department_id"") AS ""department_salary"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""avg_salary"""
83,"WITH ""sub"" AS (SELECT ""s"".""employee_id"",""department_id"",""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""comp"" AS (SELECT ""s1"".""pay_month"",""department_id"",""comp_avg"",""dept_avg"" FROM (SELECT ""pay_month"",AVG(""amount"") AS ""comp_avg"" FROM ""sub"" GROUP BY ""pay_month"") AS ""s1"" JOIN (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""dept_avg"" FROM ""sub"" GROUP BY ""pay_month"",""department_id"") AS ""s2"" ON ""s1"".""pay_month""=""s2"".""pay_month"" GROUP BY 1,2) SELECT ""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""comp_avg"" THEN 'higher' WHEN ""dept_avg""<""comp_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""comp"""
84,"SELECT ""s1"".""pay_month"",""s2"".""department_id"",CASE WHEN ""s2"".""avg_department_salary"">""s1"".""avg_company_salary"" THEN 'higher' WHEN ""s2"".""avg_department_salary""=""s1"".""avg_company_salary"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""avg_company_salary"" FROM ""salary"" GROUP BY ""pay_month"") AS ""s1"" JOIN (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") AS ""avg_department_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""department_id"") AS ""s2"" ON ""s1"".""pay_month""=""s2"".""pay_month"""
85,"WITH ""cte"" AS (SELECT ""s"".""employee_id"",""amount"",""pay_date"",""e"".""department_id"",AVG(""amount"") AS ""department_avg"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""e"".""department_id"",EXTRACT(MONTH FROM ""pay_date"")), ""cte2"" AS (SELECT ""pay_date"",AVG(""amount"") AS ""cmp_avg"" FROM ""salary"" GROUP BY EXTRACT(MONTH FROM ""pay_date"")) SELECT SUBSTRING(""cte"".""pay_date"", 1, 7) AS ""pay_month"",""department_id"",(CASE WHEN ""department_avg"">""cmp_avg"" THEN 'higher' WHEN ""department_avg""<""cmp_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""cte"" LEFT JOIN ""cte2"" ON ""cte"".""pay_date""=""cte2"".""pay_date"""
86,"SELECT ""d"".""pay_month"",""d"".""department_id"",CASE WHEN ""c"".""company_avg""<""d"".""department_avg"" THEN 'higher' WHEN ""c"".""company_avg"">""d"".""department_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""c"" JOIN (SELECT ""b"".""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m'),""department_id"") AS ""d"" ON ""c"".""pay_month""=""d"".""pay_month"" ORDER BY ""d"".""pay_month"",""d"".""department_id"""
87,"SELECT ""t1"".""pay_month"" AS ""pay_month"",""department_id"",CASE WHEN ""t1"".""average_month"">""t2"".""average_month"" THEN 'higher' WHEN ""t1"".""average_month""<""t2"".""average_month"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""average_month"" FROM (""employee"") JOIN ""salary"" WHERE ""employee"".""employee_id""=""salary"".""employee_id"" GROUP BY ""pay_month"",""department_id"") AS ""t1"" JOIN (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""average_month"" FROM ""salary"" GROUP BY ""pay_month"") AS ""t2"" ON ""t1"".""pay_month""=""t2"".""pay_month"" ORDER BY ""department_id"",""pay_month"""
88,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
89,"WITH ""T"" AS (SELECT ""a"".*,LEFT(""a"".""pay_date"", 7) AS ""pay_month"",""b"".""department_id"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""company_avg"" THEN 'higher' WHEN ""dept_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT DISTINCT ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""company_avg"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""dept_avg"" FROM ""T"" ORDER BY ""pay_month"" DESC,""department_id"") AS ""a"""
90,"SELECT ""dept"".""pay_month"",""dept"".""department_id"",CASE WHEN ""dept"".""dept_salary"">""com"".""com_salary"" THEN 'higher' WHEN ""dept"".""dept_salary""<""com"".""com_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT SUBSTR(""s"".""pay_date"", 1, 7) AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""dept_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2) AS ""dept"" JOIN (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""com_salary"" FROM ""salary"" GROUP BY 1) AS ""com"" ON ""dept"".""pay_month""=""com"".""pay_month"""
91,"WITH ""ct"" AS (SELECT ""a"".""pay_date"",""b"".""department_id"",AVG(""a"".""amount"") OVER (PARTITION BY ""a"".""pay_date"") AS ""company_avg"",AVG(""a"".""amount"") OVER (PARTITION BY ""a"".""pay_date"", ""b"".""department_id"") AS ""dep_avg"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"" ORDER BY 1 DESC,2) SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",CASE WHEN ""dep_avg"">""company_avg"" THEN 'higher' WHEN ""dep_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""ct"" GROUP BY 1,2"
92,"WITH ""t1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",""amount"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN (AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id""))>AVG(""amount"") OVER (PARTITION BY ""pay_month"") THEN 'higher' WHEN (AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id""))<AVG(""amount"") OVER (PARTITION BY ""pay_month"") THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""t1"" ORDER BY ""pay_month"" DESC,""department_id"""
93,"WITH ""comp_avg"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",SUM(""amount"")/COUNT(1) AS ""average"" FROM ""salary"" GROUP BY LEFT(""pay_date"", 7)), ""dept_avg"" AS (SELECT LEFT(""s"".""pay_date"", 7) AS ""pay_month"",""d"".""department_id"",SUM(""s"".""amount"")/COUNT(1) AS ""average"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""d"" WHERE ""s"".""employee_id""=""d"".""employee_id"" GROUP BY LEFT(""s"".""pay_date"", 7),""d"".""department_id"") SELECT ""comp_avg"".""pay_month"",""dept_avg"".""department_id"",CASE WHEN ""dept_avg"".""average"">""comp_avg"".""average"" THEN 'higher' WHEN ""dept_avg"".""average""=""comp_avg"".""average"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (""comp_avg"") JOIN ""dept_avg"" WHERE ""comp_avg"".""pay_month""=""dept_avg"".""pay_month"""
94,"WITH ""d"" AS (SELECT ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""mon"",AVG(""amount"") AS ""salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""d"" ON ""s"".""employee_id""=""d"".""employee_id"" GROUP BY 1,2), ""c"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""mon"",AVG(""amount"") AS ""salary"" FROM ""salary"" GROUP BY 1) SELECT ""d"".""mon"" AS ""pay_month"",""d"".""department_id"",(CASE WHEN ""d"".""salary"">""c"".""salary"" THEN 'higher' WHEN ""d"".""salary""<""c"".""salary"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""d"" JOIN ""c"" ON ""d"".""mon""=""c"".""mon"""
95,"WITH ""t"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""e"".""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""co_sal"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""e"".""department_id"") AS ""dept_sal"" FROM ""employee"" AS ""e"" LEFT JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""dept_sal""<""co_sal"" THEN 'lower' WHEN ""dept_sal"">""co_sal"" THEN 'higher' WHEN ""dept_sal""=""co_sal"" THEN 'same' END AS ""comparison"" FROM ""t"""
96,"WITH ""COMPANY_AVG_SAL"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""s"".""amount"") AS ""co_avg"" FROM ""salary"" AS ""s"" GROUP BY 1), ""dept_avg"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""dept_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2) SELECT ""da"".""pay_month"",""da"".""department_id"",CASE WHEN ""da"".""dept_avg"">""cas"".""co_avg"" THEN 'higher' WHEN ""da"".""dept_avg""<""cas"".""co_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""dept_avg"" AS ""da"" JOIN ""COMPANY_AVG_SAL"" AS ""cas"" ON ""da"".""pay_month""=""cas"".""pay_month"""
97,"WITH ""ave_salary"" AS (SELECT LEFT(""pay_date"", 7) AS ""dates"",AVG(""amount"") AS ""ave_comp"" FROM ""salary"" GROUP BY LEFT(""pay_date"", 7)), ""ave_dep"" AS (SELECT ""department_id"",AVG(COALESCE(""amount"", 0)) AS ""dep_ave"",LEFT(""pay_date"", 7) AS ""dates"" FROM ""employee"" LEFT JOIN ""salary"" ON ""employee"".""employee_id""=""salary"".""employee_id"" GROUP BY ""department_id"",LEFT(""pay_date"", 7)), ""full_table"" AS (SELECT ""ave_salary"".""dates"" AS ""pay_month"",""ave_dep"".""department_id"" AS ""department_id"",""dep_ave"",""ave_comp"" FROM ""ave_dep"" LEFT JOIN ""ave_salary"" ON ""ave_dep"".""dates""=""ave_salary"".""dates"") SELECT ""pay_month"",""department_id"",CASE WHEN ""dep_ave"">""ave_comp"" THEN 'higher' WHEN ""dep_ave""<""ave_comp"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""full_table"""
98,"WITH ""temp"" AS (SELECT ""employee_id"",""department_id"",""amount"",SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"" FROM (SELECT ""a"".*,""b"".""department_id"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") AS ""a""), ""temp2"" AS (SELECT ""a"".""avg_comp"",""b"".* FROM (SELECT AVG(""amount"") AS ""avg_comp"",""pay_month"" FROM ""temp"" GROUP BY ""pay_month"" ORDER BY ""pay_month"") AS ""a"" JOIN (SELECT AVG(""amount"") AS ""avg_sal"",""pay_month"",""department_id"" FROM ""temp"" GROUP BY ""department_id"",""pay_month"" ORDER BY ""department_id"",""pay_month"") AS ""b"" ON ""a"".""pay_month""=""b"".""pay_month"") SELECT ""pay_month"",""department_id"",CASE WHEN ""avg_sal"">""avg_comp"" THEN 'higher' WHEN ""avg_sal""<""avg_comp"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""temp2"""
99,"SELECT ""dept_month_salary"".""pay_month"",""dept_month_salary"".""department_id"",CASE WHEN ""dept_month_salary"".""dept_avg_salary"">""comp_month_salary"".""comp_avg_salary"" THEN 'higher' WHEN ""dept_month_salary"".""dept_avg_salary""=""comp_month_salary"".""comp_avg_salary"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",""employee"".""department_id"" AS ""department_id"",AVG(""amount"") AS ""dept_avg_salary"" FROM ""salary"" LEFT JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""employee"".""department_id"",SUBSTR(""pay_date"", 1, 7)) AS ""dept_month_salary"" LEFT JOIN (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""comp_avg_salary"" FROM ""salary"" GROUP BY SUBSTR(""pay_date"", 1, 7)) AS ""comp_month_salary"" ON ""dept_month_salary"".""pay_month""=""comp_month_salary"".""pay_month"""
100,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
101,"SELECT ""d"".""pay_month"",""department_id"",CASE WHEN ""avg_department"">""company_avg"" THEN 'higher' WHEN ""avg_department""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""avg_department"",SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""d"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"" FROM ""salary"" GROUP BY ""pay_month"") AS ""e"" ON ""d"".""pay_month""=""e"".""pay_month"""
102,"WITH ""cte1"" AS (SELECT TO_CHAR(""b"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""a"".""department_id"",COALESCE(AVG(""amount""), 0) AS ""average"" FROM ""employee"" AS ""a"" LEFT JOIN ""salary"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"" GROUP BY 1,2), ""cte2"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""average"" FROM ""salary"" GROUP BY 1) SELECT ""cte1"".""pay_month"",""cte1"".""department_id"",CASE WHEN ""cte1"".""average"">""cte2"".""average"" THEN 'higher' WHEN ""cte1"".""average""=""cte2"".""average"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""cte1"" JOIN ""cte2"" ON ""cte1"".""pay_month""=""cte2"".""pay_month"""
103,"SELECT ""pay_month"",""department_id"",CASE WHEN ""average_dept_month"">""average_month"" THEN 'higher' WHEN ""average_dept_month""<""average_month"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT DISTINCT ""e"".""department_id"",LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""e"".""department_id"") AS ""average_dept_month"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""average_month"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""ASD"" ORDER BY ""pay_month"" DESC"
104,"SELECT ""pay_month"",""department_id"",(CASE WHEN ""dpt_avg"">""month_avg"" THEN 'higher' WHEN ""dpt_avg""=""month_avg"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM (SELECT ""b"".""pay_month"",""department_id"",""dpt_avg"",""month_avg"" FROM (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""dpt_avg"" FROM (SELECT ""department_id"",""amount"",SUBSTR(""pay_date"", 1, 7) AS ""pay_month"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"") AS ""a"" GROUP BY ""a"".""pay_month"",""a"".""department_id"") AS ""b"" JOIN (SELECT ""pay_month"",AVG(""amount"") AS ""month_avg"" FROM (SELECT ""department_id"",""amount"",SUBSTR(""pay_date"", 1, 7) AS ""pay_month"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"") AS ""d"" GROUP BY ""pay_month"") AS ""c"" ON ""b"".""pay_month""=""c"".""pay_month"") AS ""final"" ORDER BY ""pay_month"" DESC,""department_id"""
105,"WITH ""cte"" AS (SELECT LEFT(""z"".""pay_date"", 7) AS ""pay_month"",""z"".""department_id"" AS ""department_id"",AVG(""z"".""avg_comp"") AS ""avg_com"",AVG(""z"".""avg_dept"") AS ""avg_dept"" FROM (SELECT ""a"".""pay_date"",""b"".""department_id"",AVG(""a"".""amount"") OVER (PARTITION BY EXTRACT(MONTH FROM ""a"".""pay_date"")) AS ""avg_comp"",AVG(""a"".""amount"") OVER (PARTITION BY EXTRACT(MONTH FROM ""a"".""pay_date""), ""b"".""department_id"") AS ""avg_dept"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") AS ""z"" GROUP BY LEFT(""z"".""pay_date"", 7),""z"".""department_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""avg_dept"">""avg_com"" THEN 'higher' WHEN ""avg_dept""<""avg_com"" THEN 'lower' WHEN ""avg_dept""=""avg_com"" THEN 'same' END AS ""Comparison"" FROM ""cte"""
106,"WITH ""T"" AS (SELECT ""a"".*,LEFT(""a"".""pay_date"", 7) AS ""pay_month"",""b"".""department_id"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id""), ""CP_AVERAGE"" AS (SELECT ""pay_month"",AVG(""amount"") AS ""cp_avg"" FROM ""T"" GROUP BY 1), ""DPT_AVERAGE"" AS (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""dpt_avg"" FROM ""T"" GROUP BY 1,2) SELECT ""a"".""pay_month"",""a"".""department_id"",CASE WHEN ""a"".""dpt_avg"">""b"".""cp_avg"" THEN 'higher' WHEN ""a"".""dpt_avg""<""b"".""cp_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""DPT_AVERAGE"" AS ""a"" JOIN ""CP_AVERAGE"" AS ""b"" ON ""a"".""pay_month""=""b"".""pay_month"" ORDER BY 1 DESC,2"
107,"WITH ""t1"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""avg_amount_dept"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id""), ""t2"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""avg_amount"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"") SELECT ""t1"".""pay_month"",""t1"".""department_id"",CASE WHEN ""t1"".""avg_amount_dept""<""t2"".""avg_amount"" THEN 'lower' WHEN ""t1"".""avg_amount_dept"">""t2"".""avg_amount"" THEN 'higher' ELSE 'same' END AS ""comparison"" FROM ""t1"" JOIN ""t2"" ON ""t1"".""pay_month""=""t2"".""pay_month"""
108,"WITH ""t1"" AS (SELECT ""pay_date"" AS ""pay_month"",AVG(""amount"") AS ""cmpy_avg"" FROM ""salary"" GROUP BY EXTRACT(MONTH FROM ""pay_date"")), ""t2"" AS (SELECT ""pay_date"" AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""dpt_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""e"".""department_id"",EXTRACT(MONTH FROM ""pay_date"")) SELECT TO_CHAR(""t2"".""pay_month"", 'YYYY-%m') AS ""pay_month"",""department_id"",CASE WHEN ""dpt_avg"">""cmpy_avg"" THEN 'higher' WHEN ""dpt_avg""<""cmpy_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t1"".""pay_month""=""t2"".""pay_month"" ORDER BY ""t2"".""department_id"",""t2"".""pay_month"" DESC"
109,"WITH ""company_avg_sal"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""comp_avg_sal"" FROM ""salary"" GROUP BY 1), ""dept_avg_salary"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dept_avg_sal"" FROM ""Salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,""department_id"") SELECT ""cs"".""pay_month"",""department_id"",CASE WHEN ""dept_avg_sal"">""cs"".""comp_avg_sal"" THEN 'higher' WHEN ""dept_avg_sal""=""comp_avg_sal"" THEN 'same' WHEN ""dept_avg_sal""<""comp_avg_sal"" THEN 'lower' END AS ""comparison"" FROM ""company_avg_sal"" AS ""cs"" JOIN ""dept_avg_salary"" AS ""ds"" ON ""cs"".""pay_month""=""ds"".""pay_month"""
110,"SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""department_avg_salary"">""company_avg_salary"" THEN 'higher' WHEN ""department_avg_salary""<""company_avg_salary"" THEN 'lower' WHEN ""department_avg_salary""=""company_avg_salary"" THEN 'same' END) AS ""comparison"" FROM (SELECT ""A"".""employee_id"",""amount"",""pay_date"",""department_id"",LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY ""A"".""pay_date"") AS ""company_avg_salary"",AVG(""amount"") OVER (PARTITION BY ""A"".""pay_date"", ""B"".""department_id"") AS ""department_avg_salary"" FROM ""salary"" AS ""A"" JOIN ""employee"" AS ""B"" ON ""A"".""employee_id""=""B"".""employee_id"") AS ""temp"""
111,"SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""avg_dept"">""avg_salary"" THEN 'higher' WHEN ""avg_dept""<""avg_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY SUBSTR(""pay_date"", 1, 7)) AS ""avg_salary"",AVG(""amount"") OVER (PARTITION BY ""department_id"", SUBSTR(""pay_date"", 1, 7)) AS ""avg_dept"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") AS ""x"" ORDER BY ""pay_month"" DESC"
112,"SELECT ""month"" AS ""pay_month"",""department_id"",CASE WHEN ""avg_d"">""avg_o"" THEN 'higher' WHEN ""avg_d""<""avg_o"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""s"".""employee_id"",""department_id"",LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") OVER (PARTITION BY ""department_id"", LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_d"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_o"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"") AS ""temp"" GROUP BY 1,2"
113,"WITH ""company_avg_salary"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""avg_salary"" FROM ""salary"" GROUP BY ""pay_month""), ""department_avg_salary"" AS (SELECT SUBSTRING(""s"".""pay_date"", 1, 7) AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id"") SELECT ""d"".""pay_month"",""d"".""department_id"",CASE WHEN ""c"".""avg_salary"">""d"".""avg_salary"" THEN 'lower' WHEN ""c"".""avg_salary""=""d"".""avg_salary"" THEN 'same' ELSE 'higher' END AS ""comparison"" FROM ""company_avg_salary"" AS ""c"" JOIN ""department_avg_salary"" AS ""d"" ON ""c"".""pay_month""=""d"".""pay_month"""
114,"WITH ""tbl"" AS (SELECT ""pay_date"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""department_id"", LEFT(""pay_date"", 7)) AS ""dpt_amt"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""cp_amt"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") SELECT DISTINCT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",CASE WHEN ""dpt_amt"">""cp_amt"" THEN 'higher' WHEN ""dpt_amt""<""cp_amt"" THEN 'lower' WHEN ""dpt_amt""=""cp_amt"" THEN 'same' END AS ""comparison"" FROM ""tbl"""
115,"WITH ""depart_combine"" AS (SELECT ""s"".""pay_date"",""s"".""amount"",""e"".""department_id"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""month_avg"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""month"",AVG(""amount"") AS ""comp_avg"" FROM ""depart_combine"" GROUP BY 1), ""depart_avg"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""month"",""department_id"",AVG(""amount"") AS ""depart_avg"" FROM ""depart_combine"" GROUP BY 1,2) SELECT ""da"".""month"" AS ""pay_month"",""da"".""department_id"",CASE WHEN ""depart_avg""<""comp_avg"" THEN 'lower' WHEN ""depart_avg"">""comp_avg"" THEN 'higher' ELSE 'same' END AS ""comparison"" FROM ""depart_avg"" AS ""da"" JOIN ""month_avg"" AS ""ma"" ON ""da"".""month""=""ma"".""month"""
116,"WITH ""t"" AS (SELECT *,LEFT(""pay_date"", 7) AS ""pay_month"" FROM ""salary"") SELECT ""c"".""pay_month"",""c"".""department_id"",CASE WHEN ""c"".""avg_sal"">""c"".""avg_sal_overall"" THEN 'higher' WHEN ""c"".""avg_sal""=""c"".""avg_sal_overall"" THEN 'same' WHEN ""c"".""avg_sal""<""c"".""avg_sal_overall"" THEN 'lower' END AS ""comparison"" FROM (SELECT ""b"".""pay_month"",""a"".""department_id"",AVG(""b"".""amount"") AS ""avg_sal"",(SELECT AVG(""q"".""amount"") FROM ""t"" AS ""q"" WHERE ""q"".""pay_month""=""b"".""pay_month"" GROUP BY ""q"".""pay_month"") AS ""avg_sal_overall"" FROM (""employee"" AS ""a"") LEFT JOIN (""t"" AS ""b"") ON ""a"".""employee_id""=""b"".""employee_id"" GROUP BY ""b"".""pay_month"",""a"".""department_id"") AS ""c"""
117,"SELECT ""month"" AS ""pay_month"",""department_id"",CASE WHEN ""avg_d"">""avg_o"" THEN 'higher' WHEN ""avg_d""<""avg_o"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""s"".""employee_id"",""department_id"",LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") OVER (PARTITION BY ""department_id"", LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_d"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_o"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"") AS ""temp"" GROUP BY 1,2"
118,"WITH ""CTE"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY EXTRACT(MONTH FROM ""pay_date"")) AS ""company_avg"",AVG(""amount"") OVER (PARTITION BY EXTRACT(MONTH FROM ""pay_date""), ""department_id"") AS ""department_avg"" FROM ""salary"" AS ""S1"" JOIN ""employee"" AS ""E1"" ON ""S1"".""employee_id""=""E1"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""CTE"""
119,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
120,"SELECT DISTINCT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",CASE WHEN AVG(""amount"") OVER (PARTITION BY ""department_id"", ""pay_date"")>AVG(""amount"") OVER (PARTITION BY ""pay_date"") THEN 'higher' WHEN AVG(""amount"") OVER (PARTITION BY ""department_id"", ""pay_date"")<AVG(""amount"") OVER (PARTITION BY ""pay_date"") THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" ORDER BY 1 DESC,2"
121,"WITH ""tmp"" AS (SELECT ""s"".*,""e"".""department_id"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""tmp2"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""avg1"" FROM ""tmp"" GROUP BY ""pay_month""), ""tmp3"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""avg2"" FROM ""tmp"" GROUP BY ""pay_month"",""department_id"") SELECT ""t3"".""pay_month"",""t3"".""department_id"",(CASE WHEN ""t3"".""avg2"">""t2"".""avg1"" THEN 'higher' WHEN ""t3"".""avg2""=""t2"".""avg1"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM ""tmp3"" AS ""t3"" LEFT JOIN ""tmp2"" AS ""t2"" ON ""t3"".""pay_month""=""t2"".""pay_month"""
122,"SELECT ""c"".""pay_month"",""c"".""department_id"",CASE WHEN ""average_dept"">""average_comp"" THEN 'higher' WHEN ""average_dept""<""average_comp"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""b"".""department_id"",SUM(""amount"")/COUNT(1) AS ""average_dept"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"" GROUP BY LEFT(""pay_date"", 7),""b"".""department_id"") AS ""c"" LEFT JOIN (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",SUM(""amount"")/COUNT(1) AS ""average_comp"" FROM ""salary"" GROUP BY LEFT(""pay_date"", 7)) AS ""d"" ON ""c"".""pay_month""=""d"".""pay_month"""
123,"WITH ""monthly_data"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"" AS ""department_id"",AVG(""amount"") OVER (PARTITION BY EXTRACT(YEAR_MONTH FROM ""pay_date"")) AS ""company_avg"",AVG(""amount"") OVER (PARTITION BY ""e"".""department_id"", EXTRACT(YEAR_MONTH FROM ""pay_date"")) AS ""dept_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""dept_avg""=""company_avg"" THEN 'same' WHEN ""dept_avg"">""company_avg"" THEN 'higher' WHEN ""dept_avg""<""company_avg"" THEN 'lower' END AS ""comparison"" FROM ""monthly_data"" GROUP BY 1,2"
124,"SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""department_avg_salary"">""company_avg_salary"" THEN 'higher' WHEN ""department_avg_salary""<""company_avg_salary"" THEN 'lower' WHEN ""department_avg_salary""=""company_avg_salary"" THEN 'same' END) AS ""comparison"" FROM (SELECT ""A"".""employee_id"",""amount"",""pay_date"",""department_id"",LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY ""A"".""pay_date"") AS ""company_avg_salary"",AVG(""amount"") OVER (PARTITION BY ""A"".""pay_date"", ""B"".""department_id"") AS ""department_avg_salary"" FROM ""salary"" AS ""A"" JOIN ""employee"" AS ""B"" ON ""A"".""employee_id""=""B"".""employee_id"") AS ""temp"""
125,"WITH ""monthly_averages"" AS (SELECT ""pay_date"",AVG(""amount"") AS ""avg_salary"" FROM ""salary"" GROUP BY ""pay_date""), ""department_monthly_average"" AS (SELECT ""s"".""pay_date"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY ""s"".""pay_date"",""e"".""department_id"") SELECT DISTINCT SUBSTR(""d"".""pay_date"", 1, 7) AS ""pay_month"",""d"".""department_id"",CASE WHEN ""d"".""avg_salary"">""m"".""avg_salary"" THEN 'higher' WHEN ""d"".""avg_salary""<""m"".""avg_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""department_monthly_average"" AS ""d"" JOIN ""monthly_averages"" AS ""m"" ON ""d"".""pay_date""=""m"".""pay_date"""
126,"WITH ""CTE1"" AS (SELECT ""department_id"",LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""avg_by_dep"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id""), ""CTE2"" AS (SELECT AVG(""amount"") AS ""comp_avg"",LEFT(""pay_date"", 7) AS ""pay_month"" FROM ""salary"" GROUP BY ""pay_month"") SELECT DISTINCT ""CTE2"".""pay_month"",""CTE1"".""department_id"",CASE WHEN ""avg_by_dep"">""comp_avg"" THEN 'higher' WHEN ""avg_by_dep""<""comp_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""CTE1"" JOIN ""CTE2"" ON ""CTE1"".""pay_month""=""CTE2"".""pay_month"""
127,"WITH ""cte"" AS (SELECT ""department_id"",SUBSTRING(""pay_date"", 1, 7) AS ""pay"",AVG(""amount"") AS ""tot_ave"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY 2 ORDER BY 1), ""cte1"" AS (SELECT ""department_id"",SUBSTRING(""pay_date"", 1, 7) AS ""pay"",AVG(""amount"") AS ""ave"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY 1,2 ORDER BY 1) SELECT ""cte1"".""pay"" AS ""pay_month"",""cte1"".""department_id"",(CASE WHEN ""tot_ave"">""ave"" THEN 'lower' ELSE CASE WHEN ""tot_ave""<""ave"" THEN 'higher' ELSE 'same' END END) AS ""comparison"" FROM ""cte"" JOIN ""cte1"" ON ""cte"".""pay""=""cte1"".""pay"""
128,"WITH ""monthly_dept_salary"" AS (SELECT SUBSTR(""s"".""pay_date"", 1, 7) AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""avg_amount"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY ""e"".""department_id"",SUBSTR(""s"".""pay_date"", 1, 7)), ""monthly_salary"" AS (SELECT SUBSTR(""s"".""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""avg_amount"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY SUBSTR(""s"".""pay_date"", 1, 7)) SELECT ""mds"".""pay_month"",""department_id"",CASE WHEN ""mds"".""avg_amount"">""ms"".""avg_amount"" THEN 'higher' WHEN ""mds"".""avg_amount""<""ms"".""avg_amount"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""monthly_dept_salary"" AS ""mds"" JOIN ""monthly_salary"" AS ""ms"" ON ""mds"".""pay_month""=""ms"".""pay_month"""
129,"WITH ""cte"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""comp_avg"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) SELECT TO_CHAR(""salary"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""employee"".""department_id"",CASE WHEN ROUND(AVG(""salary"".""amount""), 2)>ROUND(""cte"".""comp_avg"", 2) THEN 'higher' WHEN ROUND(AVG(""salary"".""amount""), 2)<ROUND(""cte"".""comp_avg"", 2) THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (""salary"" JOIN ""employee"" ON ""employee"".""employee_id""=""salary"".""employee_id"") JOIN ""cte"" ON ""cte"".""pay_month""=TO_CHAR(""pay_date"", 'YYYY-%m') GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m'),""employee"".""department_id"""
130,"ERROR: mysql parse error: line 1 column 390 near ""as t1 left join (select left(s.pay_date, 7) pay_month, avg(s.amount) company_salary from salary s, employee e where s.employee_id = e.employee_id group by pay_month) as t2 on t1.pay_month = t2.pay_month) order by pay_month desc, department_id "" "
131,"WITH ""cte"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg_amount"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id""), ""cte1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""am"" FROM ""salary"" GROUP BY ""pay_month"") SELECT ""cte1"".""pay_month"",""cte"".""department_id"",CASE WHEN ""cte"".""avg_amount"">""cte1"".""am"" THEN 'higher' WHEN ""cte"".""avg_amount""<""cte1"".""am"" THEN 'lower' WHEN ""cte"".""avg_amount""=""cte1"".""am"" THEN 'same' ELSE NULL END AS ""comparison"" FROM ""cte"" LEFT JOIN ""cte1"" ON ""cte"".""pay_month""=""cte1"".""pay_month"""
132,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
133,"WITH ""CTE"" AS (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""comp_avg"" FROM ""salary"" GROUP BY SUBSTRING(""pay_date"", 1, 7)), ""CTE1"" AS (SELECT SUBSTRING(""s"".""pay_date"", 1, 7) AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""dept_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY SUBSTRING(""s"".""pay_date"", 1, 7),""e"".""department_id"") SELECT ""c1"".""pay_month"",""c2"".""department_id"",CASE WHEN ""c2"".""dept_avg""=""c1"".""comp_avg"" THEN 'same' WHEN ""c2"".""dept_avg"">""c1"".""comp_avg"" THEN 'higher' ELSE 'lower' END AS ""comparison"" FROM ""CTE"" AS ""c1"" JOIN ""CTE1"" AS ""C2"" ON ""C1"".""pay_month""=""C2"".""pay_month"""
134,"SELECT DISTINCT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",CASE WHEN AVG(""amount"") OVER (PARTITION BY ""department_id"", ""pay_date"")>AVG(""amount"") OVER (PARTITION BY ""pay_date"") THEN 'higher' WHEN AVG(""amount"") OVER (PARTITION BY ""department_id"", ""pay_date"")<AVG(""amount"") OVER (PARTITION BY ""pay_date"") THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" ORDER BY ""pay_month"" DESC,""department_id"""
135,"SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""avg_dep"">""avg_comp"" THEN 'higher' WHEN ""avg_dep""=""avg_comp"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT LEFT(""a"".""pay_date"", 7) AS ""pay_month"",""b"".""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""a"".""pay_date"", 7), ""department_id"") AS ""avg_dep"",AVG(""amount"") OVER (PARTITION BY LEFT(""a"".""pay_date"", 7)) AS ""avg_comp"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") AS ""cte"" ORDER BY ""pay_month"",""department_id"""
136,"WITH ""TEMP"" AS (SELECT DISTINCT SUBSTR(""S"".""PAY_DATE"", 1, 7) AS ""PAY_MONTH"",""E"".""DEPARTMENT_ID"",AVG(""S"".""AMOUNT"") OVER (PARTITION BY SUBSTR(""S"".""PAY_DATE"", 1, 7), ""E"".""DEPARTMENT_ID"") AS ""DEPT_AVG"",AVG(""S"".""AMOUNT"") OVER (PARTITION BY SUBSTR(""S"".""PAY_DATE"", 1, 7)) AS ""COMP_AVG"" FROM (""SALARY"" AS ""S"") JOIN ""EMPLOYEE"" AS ""E"" WHERE ""S"".""EMPLOYEE_ID""=""E"".""EMPLOYEE_ID"") SELECT ""PAY_MONTH"",""DEPARTMENT_ID"",CASE WHEN ""DEPT_AVG"">""COMP_AVG"" THEN 'higher' WHEN ""DEPT_AVG""<""COMP_AVG"" THEN 'lower' ELSE 'same' END AS ""COMPARISON"" FROM ""TEMP"""
137,"SELECT ""c"".""pay_month"",""a"".""department_id"",CASE WHEN ""a"".""avg_dept_amount"">""c"".""avg_amt"" THEN 'higher' WHEN ""a"".""avg_dept_amount""<""c"".""avg_amt"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT AVG(""a"".""amount"") AS ""avg_dept_amount"",""b"".""department_id"",TO_CHAR(""a"".""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON (""a"".""employee_id""=""b"".""employee_id"") GROUP BY 2,3) AS ""a"" JOIN (SELECT AVG(""amount"") AS ""avg_amt"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM (SELECT ""a"".""amount"",""a"".""pay_date"",""b"".""department_id"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") AS ""ab"" GROUP BY 2) AS ""c"" ON (""a"".""pay_month""=""c"".""pay_month"")"
138,"WITH ""merge"" AS (SELECT ""s"".*,""department_id"",LEFT(""pay_date"", 7) AS ""month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""t1"" AS (SELECT ""month"",AVG(""amount"") AS ""c_avg"" FROM ""merge"" GROUP BY ""month""), ""t2"" AS (SELECT ""department_id"",""month"",AVG(""amount"") AS ""d_avg"" FROM ""merge"" GROUP BY ""month"",""department_id"") SELECT ""t2"".""month"" AS ""pay_month"",""department_id"",CASE WHEN ""d_avg"">""c_avg"" THEN 'higher' WHEN ""d_avg""=""c_avg"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t2"".""month""=""t1"".""month"""
139,"SELECT DISTINCT ""C"".""pay_month"",""C"".""department_id"",CASE WHEN ""dept_salary"">""cmpy_salary"" THEN 'higher' WHEN ""dept_salary""<""cmpy_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""B"".""department_id"",AVG(""amount"") OVER (PARTITION BY ""B"".""department_id"", LEFT(""pay_date"", 7)) AS ""dept_salary"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""cmpy_salary"" FROM ""salary"" AS ""A"" JOIN ""employee"" AS ""B"" ON ""A"".""employee_id""=""B"".""employee_id"") AS ""C"""
140,"SELECT DISTINCT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",CASE WHEN AVG(""amount"") OVER (PARTITION BY ""department_id"", ""pay_date"")>AVG(""amount"") OVER (PARTITION BY ""pay_date"") THEN 'higher' WHEN AVG(""amount"") OVER (PARTITION BY ""department_id"", ""pay_date"")<AVG(""amount"") OVER (PARTITION BY ""pay_date"") THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" ORDER BY 1 DESC,2"
141,"WITH ""department_salary"" AS (SELECT ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""dept_avg"" FROM ""salary"" LEFT JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month""), ""company_salary"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""company_avg"" FROM ""salary"" GROUP BY ""pay_month"") SELECT ""a"".""pay_month"" AS ""pay_month"",""department_id"",CASE WHEN ""dept_avg""<""company_avg"" THEN 'lower' WHEN ""dept_avg"">""company_avg"" THEN 'higher' WHEN ""dept_avg""=""company_avg"" THEN 'same' END AS ""comparison"" FROM ""department_salary"" AS ""a"" JOIN ""company_salary"" AS ""b"" ON ""a"".""pay_month""=""b"".""pay_month"""
142,"SELECT ""pay_month"",""department_id"",CASE WHEN ""e_sal"">""c_sal"" THEN 'higher' WHEN ""e_sal""<""c_sal"" THEN 'lower' WHEN ""e_sal""=""c_sal"" THEN 'same' END AS ""comparison"" FROM (SELECT AVG(""amount"") AS ""e_sal"",AVG(""cmp_avg"") AS ""c_sal"",""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ((""employee"" AS ""e"") JOIN ""salary"" AS ""s"") JOIN (SELECT AVG(""amount"") AS ""cmp_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""date"" FROM (""employee"" AS ""e"") JOIN ""salary"" AS ""s"" WHERE ""e"".""employee_id""=""s"".""employee_id"" GROUP BY 2) AS ""b"" WHERE ""e"".""employee_id""=""s"".""employee_id"" AND TO_CHAR(""s"".""pay_date"", 'YYYY-%m')=""b"".""date"" GROUP BY 3,4) AS ""xx"""
143,"WITH ""cte"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_date"") AS ""com_avg"",AVG(""amount"") OVER (PARTITION BY ""department_id"", ""pay_date"") AS ""dep_avg"" FROM ""salary"" JOIN ""employee"" USING (""employee_id"")) SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""dep_avg"">""com_avg"" THEN 'higher' WHEN ""dep_avg""<""com_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""cte"" ORDER BY ""pay_month"" DESC,""department_id"""
144,"WITH ""dept_salary"" AS (SELECT ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""dep_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2), ""cmp_salary"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""cmp_avg"" FROM ""salary"" GROUP BY 1) SELECT ""ds"".""pay_month"",""ds"".""department_id"",CASE WHEN ""dep_avg"">""cmp_avg"" THEN 'higher' WHEN ""dep_avg""=""cmp_avg"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""dept_salary"" AS ""ds"" JOIN ""cmp_salary"" AS ""cs"" ON ""ds"".""pay_month""=""cs"".""pay_month"""
145,"WITH ""overall"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""overall_avg"" FROM ""Salary"" GROUP BY ""pay_month""), ""dept"" AS (SELECT ""e"".""department_id"",TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""s"".""amount"") AS ""dept_avg"" FROM ""Salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""e"".""department_id"",""pay_month"") SELECT ""d"".""pay_month"",""d"".""department_id"",CASE WHEN ""d"".""dept_avg"">""o"".""overall_avg"" THEN 'higher' WHEN ""d"".""dept_avg""=""o"".""overall_avg"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""dept"" AS ""d"" JOIN ""overall"" AS ""o"" ON ""d"".""pay_month""=""o"".""pay_month"" ORDER BY ""d"".""pay_month"" DESC,""d"".""department_id"""
146,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
147,"WITH ""cte"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_date"") AS ""Avg_all"",AVG(""amount"") OVER (PARTITION BY ""pay_date"", ""department_id"") AS ""Avg_dep"" FROM ""salary"" JOIN ""employee"" USING (""employee_id"")) SELECT ""pay_month"",""department_id"",(CASE WHEN ""Avg_dep"">""Avg_all"" THEN 'higher' WHEN ""Avg_dep""<""Avg_all"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""cte"" GROUP BY 1,2"
148,"WITH ""dep_cum_salary"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",SUM(""s"".""amount"") AS ""dep_salary"",COUNT(""s"".""amount"") AS ""dep_count"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id""), ""avg_salary"" AS (SELECT ""pay_month"",""department_id"",""dep_salary""/""dep_count"" AS ""dep_avg_salary"",SUM(""dep_salary"") OVER (PARTITION BY ""pay_month"")/SUM(""dep_count"") OVER (PARTITION BY ""pay_month"") AS ""comp_avg_salary"" FROM ""dep_cum_salary"") SELECT ""pay_month"",""department_id"",(CASE WHEN ""dep_avg_salary"">""comp_avg_salary"" THEN 'higher' WHEN ""dep_avg_salary""<""comp_avg_salary"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""avg_salary"""
149,"WITH ""cte"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg_amount"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id""), ""cte1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""am"" FROM ""salary"" GROUP BY ""pay_month"") SELECT ""cte1"".""pay_month"",""cte"".""department_id"",CASE WHEN ""cte"".""avg_amount"">""cte1"".""am"" THEN 'higher' WHEN ""cte"".""avg_amount""<""cte1"".""am"" THEN 'lower' WHEN ""cte"".""avg_amount""=""cte1"".""am"" THEN 'same' ELSE NULL END AS ""comparison"" FROM ""cte"" LEFT JOIN ""cte1"" ON ""cte"".""pay_month""=""cte1"".""pay_month"""
150,"WITH ""company"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""com_avg"" FROM ""salary"" GROUP BY ""pay_month""), ""department"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dep_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY LEFT(""pay_date"", 7),""department_id"") SELECT ""d"".""pay_month"",""d"".""department_id"",CASE WHEN ""d"".""dep_avg""<""c"".""com_avg"" THEN 'lower' WHEN ""d"".""dep_avg"">""c"".""com_avg"" THEN 'higher' ELSE 'same' END AS ""comparison"" FROM ""department"" AS ""d"" LEFT JOIN ""company"" AS ""c"" ON ""d"".""pay_month""=""c"".""pay_month"""
151,"SELECT DISTINCT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",CASE WHEN ""tmp"".""company_avg"">AVG(""amount"") OVER (PARTITION BY ""department_id"", SUBSTRING(""pay_date"", 1, 7)) THEN 'lower' WHEN ""tmp"".""company_avg""<AVG(""amount"") OVER (PARTITION BY ""department_id"", SUBSTRING(""pay_date"", 1, 7)) THEN 'higher' ELSE 'same' END AS ""comparison"" FROM (""salary"" AS ""s"" JOIN ""employee"" AS ""e"" USING (""employee_id"")) JOIN (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""company_avg"" FROM ""salary"" GROUP BY 1) AS ""tmp"" ON ""tmp"".""pay_month""=SUBSTRING(""pay_date"", 1, 7)"
152,"WITH ""cte1"" AS (SELECT LEFT(""s"".""pay_date"", 7) AS ""pay_date"",""e"".""department_id"",AVG(""amount"") AS ""avg_dept_amount"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY LEFT(""s"".""pay_date"", 7),""e"".""department_id""), ""cte2"" AS (SELECT LEFT(""s"".""pay_date"", 7) AS ""pay_date"",AVG(""amount"") AS ""avg_month_amount"" FROM ""salary"" AS ""s"" GROUP BY LEFT(""s"".""pay_date"", 7)) SELECT ""c1"".""pay_date"" AS ""pay_month"",""c1"".""department_id"",CASE WHEN ""c1"".""avg_dept_amount""-""c2"".""avg_month_amount"">0 THEN 'higher' WHEN ""c1"".""avg_dept_amount""-""c2"".""avg_month_amount""<0 THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte1"" AS ""c1"" LEFT JOIN ""cte2"" AS ""c2"" ON ""c1"".""pay_date""=""c2"".""pay_date"""
153,"WITH ""d"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""avg_s"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""department_id"",SUBSTR(""pay_date"", 1, 7)), ""t"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""avg_t"" FROM ""salary"" GROUP BY SUBSTR(""pay_date"", 1, 7)) SELECT ""d"".""pay_month"",""department_id"",CASE WHEN ""avg_t""<""avg_s"" THEN 'higher' WHEN ""avg_t"">""avg_s"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""d"" JOIN ""t"" ON ""d"".""pay_month""=""t"".""pay_month"" ORDER BY ""pay_month"" DESC,""department_id"""
154,"WITH ""cte"" AS (SELECT ""department_id"",SUBSTRING(""pay_date"", 1, 7) AS ""pay"",AVG(""amount"") AS ""tot_ave"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY 2 ORDER BY 1), ""cte1"" AS (SELECT ""department_id"",SUBSTRING(""pay_date"", 1, 7) AS ""pay"",AVG(""amount"") AS ""ave"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY 1,2 ORDER BY 1) SELECT ""cte1"".""pay"" AS ""pay_month"",""cte1"".""department_id"",(CASE WHEN ""tot_ave"">""ave"" THEN 'lower' ELSE CASE WHEN ""tot_ave""<""ave"" THEN 'higher' ELSE 'same' END END) AS ""comparison"" FROM ""cte"" JOIN ""cte1"" ON ""cte"".""pay""=""cte1"".""pay"""
155,"WITH ""salarytable"" AS (SELECT ""s"".""employee_id"",""e"".""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""s"".""amount"" AS ""amount"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" USING (""employee_id"")) SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""avgsalary_dept"">""avgsalary_comp"" THEN 'higher' WHEN ""avgsalary_dept""<""avgsalary_comp"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT DISTINCT ""department_id"",""pay_month"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""avgsalary_dept"",AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""avgsalary_comp"" FROM ""salarytable"") AS ""a"""
156,"SELECT DISTINCT * FROM (SELECT SUBSTRING(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",CASE WHEN ""avg_dept_sal"">""avg_sal"" THEN 'higher' WHEN ""avg_dept_sal""=""avg_sal"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT ""s"".*,""e"".""department_id"",AVG(""amount"") OVER (PARTITION BY ""e"".""department_id"", SUBSTRING(""pay_date"", 1, 7)) AS ""avg_dept_sal"",AVG(""amount"") OVER (PARTITION BY SUBSTRING(""pay_date"", 1, 7)) AS ""avg_sal"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""a"") AS ""b"" ORDER BY ""pay_month"" DESC,""department_id"",""comparison"""
157,"SELECT ""dept"".""pay_month"",""dept"".""department_id"",CASE WHEN ""dept"".""avg_dept_salary"">""company"".""avg_company_salary"" THEN 'higher' WHEN ""dept"".""avg_dept_salary""<""company"".""avg_company_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT LEFT(""s"".""pay_date"", 7) AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg_dept_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""department_id"") AS ""dept"" LEFT JOIN (SELECT LEFT(""s"".""pay_date"", 7) AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg_company_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"") AS ""company"" ON ""dept"".""pay_month""=""company"".""pay_month"" GROUP BY ""dept"".""pay_month"",""dept"".""department_id"""
158,"SELECT DISTINCT (CASE WHEN EXTRACT(MONTH FROM ""B"".""pay_date"")-10<0 THEN CONCAT(CONVERT(EXTRACT(YEAR FROM ""B"".""pay_date""), CHAR), CONCAT('-0', CONVERT(EXTRACT(MONTH FROM ""B"".""pay_date""), CHAR))) ELSE CONCAT(CONVERT(EXTRACT(YEAR FROM ""B"".""pay_date""), CHAR), CONCAT('-', CONVERT(EXTRACT(MONTH FROM ""B"".""pay_date""), CHAR))) END) AS ""pay_month"",""B"".""dep"" AS ""department_id"",(CASE WHEN ""B"".""sal"">""C"".""pay"" THEN 'higher' WHEN ""B"".""sal""<""C"".""pay"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM (SELECT ""A"".""dep"",""A"".""pay_date"",AVG(""A"".""sal"") AS ""sal"" FROM (SELECT ""E"".""department_id"" AS ""dep"",""S"".""amount"" AS ""sal"",""S"".""pay_date"" FROM ""salary"" AS ""S"" LEFT JOIN ""employee"" AS ""E"" ON ""S"".""employee_id""=""E"".""employee_id"") AS ""A"" GROUP BY ""A"".""dep"",""A"".""pay_date"") AS ""B"" LEFT JOIN (SELECT ""pay_date"",AVG(""amount"") AS ""pay"" FROM ""salary"" GROUP BY ""pay_date"") AS ""C"" ON ""B"".""pay_date""=""C"".""pay_date"""
159,"WITH ""cte"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""month"",AVG(""amount"") AS ""avg_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""cte2"" AS (SELECT ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""mon"",AVG(""amount"") AS ""amt"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m')) SELECT ""c"".""month"" AS ""pay_month"",""d"".""department_id"",(CASE WHEN ""c"".""avg_salary""<""d"".""amt"" THEN 'higher' WHEN ""c"".""avg_salary"">""d"".""amt"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""cte"" AS ""c"" JOIN ""cte2"" AS ""d"" ON ""c"".""month""=""d"".""mon"""
160,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
161,"SELECT ""pay_month"",""department_id"",(CASE WHEN ""dept_avg_sal""=""comp_avg_sal"" THEN 'same' WHEN ""dept_avg_sal""<""comp_avg_sal"" THEN 'lower' ELSE 'higher' END) AS ""comparison"" FROM (SELECT DISTINCT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""dept_avg_sal"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""comp_avg_sal"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"") AS ""A"""
162,"WITH ""depavg"" AS (SELECT ""pay_date"",""department_id"",AVG(""amount"") AS ""dep"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_date"",""department_id""), ""comavg"" AS (SELECT ""pay_date"",AVG(""amount"") AS ""com"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_date"") SELECT DISTINCT LEFT(""c"".""pay_date"", 7) AS ""pay_month"",""department_id"",CASE WHEN ""dep"">""com"" THEN 'higher' WHEN ""dep""=""com"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""depavg"" AS ""d"" JOIN ""comavg"" AS ""c"" ON ""c"".""pay_date""=""d"".""pay_date"""
163,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
164,"SELECT ""pay_month"",""department_id"",CASE WHEN ""CompanyAverage""=""departmentAverage"" THEN 'same' WHEN ""CompanyAverage""<""departmentAverage"" THEN 'higher' ELSE 'lower' END AS ""comparison"" FROM (SELECT DISTINCT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""CompanyAverage"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m'), ""department_id"") AS ""departmentAverage"" FROM ""EMPLOYEE"" AS ""E"" LEFT JOIN ""SALARY"" AS ""S"" ON ""E"".""employee_id""=""S"".""employee_id"") AS ""MonthlyDeptCompAvg"" ORDER BY ""pay_month"" DESC,""department_id"""
165,"WITH ""cte_window"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""co_avg_monthly_salary"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""dept_avg_monthly_salary"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""cte_assemble"" AS (SELECT ""pay_month"",""department_id"",CASE WHEN ANY_VALUE(""co_avg_monthly_salary"")>ANY_VALUE(""dept_avg_monthly_salary"") THEN 'lower' WHEN ANY_VALUE(""co_avg_monthly_salary"")<ANY_VALUE(""dept_avg_monthly_salary"") THEN 'higher' ELSE 'same' END AS ""comparison"" FROM ""cte_window"" GROUP BY 1,2) SELECT * FROM ""cte_assemble"""
166,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
167,"WITH ""cte"" AS (SELECT LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") AS ""company_avg"" FROM ""salary"" GROUP BY EXTRACT(MONTH FROM ""pay_date"")), ""cte2"" AS (SELECT LEFT(""pay_date"", 7) AS ""month"",""e"".""department_id"",AVG(""amount"") AS ""department_avg"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" USING (""employee_id"") GROUP BY LEFT(""pay_date"", 7),""e"".""department_id"") SELECT ""month"" AS ""pay_month"",""department_id"",(CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""cte"" JOIN ""cte2"" USING (""month"")"
168,"SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""dept_avg"">""com_avg"" THEN 'higher' WHEN ""dept_avg""<""com_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""dept_avg"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""com_avg"" FROM ""salary"" RIGHT JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"") AS ""src"" ORDER BY ""pay_month"" DESC,""department_id"""
169,"SELECT LEFT(""sal"".""pay_date"", 7) AS ""pay_month"",""emp"".""department_id"" AS ""department_id"",CASE WHEN ROUND(COALESCE(AVG(""sal"".""amount""), 0), 4)>ROUND(""avg_company"".""avg_company_salary"", 4) THEN 'higher' WHEN ROUND(COALESCE(AVG(""sal"".""amount""), 0), 4)<ROUND(""avg_company"".""avg_company_salary"", 4) THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (""employee"" AS ""emp"" LEFT JOIN ""salary"" AS ""sal"" ON ""emp"".""employee_id""=""sal"".""employee_id"") LEFT JOIN (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""avg_company_salary"" FROM ""salary"" GROUP BY ""pay_month"") AS ""avg_company"" ON LEFT(""sal"".""pay_date"", 7)=""avg_company"".""pay_month"" GROUP BY ""pay_month"",""department_id"""
170,"WITH ""cte"" AS (WITH ""cte"" AS (WITH ""cte"" AS (SELECT ""s"".""employee_id"",""s"".""amount"",""s"".""pay_date"",""e"".""department_id"",AVG(""s"".""amount"") OVER (PARTITION BY EXTRACT(MONTH FROM ""pay_date"")) AS ""monthly_average"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT *,AVG(""amount"") OVER (PARTITION BY EXTRACT(MONTH FROM ""pay_date""), ""department_id"") AS ""department_average"" FROM ""cte"") SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""monthly_average"",""department_average"",""department_id"" FROM ""cte"" GROUP BY LEFT(""pay_date"", 7),""department_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""department_average"">""monthly_average"" THEN 'higher' WHEN ""department_average""<""monthly_average"" THEN 'lower' WHEN ""department_average""=""monthly_average"" THEN 'same' END AS ""comparison"" FROM ""cte"""
171,"WITH ""T"" AS (SELECT ""a"".*,LEFT(""a"".""pay_date"", 7) AS ""pay_month"",""b"".""department_id"" FROM ""salary"" AS ""a"" LEFT JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""company_avg"" THEN 'higher' WHEN ""dept_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT DISTINCT ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""company_avg"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""dept_avg"" FROM ""T"" ORDER BY ""pay_month"" DESC,""department_id"") AS ""a"""
172,"SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""deptsal"">""globalsal"" THEN 'higher' WHEN ""deptsal""<""globalsal"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m'), ""department_id"") AS ""deptsal"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""globalsal"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""t"" ORDER BY ""pay_month"" DESC,""department_id"""
173,"WITH ""A"" AS (SELECT LEFT(""S1"".""PAY_DATE"", 7) AS ""MONTH"",""E1"".""DEPARTMENT_ID"",AVG(""S1"".""AMOUNT"") AS ""ES"" FROM ""EMPLOYEE"" AS ""E1"" JOIN ""SALARY"" AS ""S1"" ON ""E1"".""EMPLOYEE_ID""=""S1"".""EMPLOYEE_ID"" GROUP BY ""MONTH"",""E1"".""DEPARTMENT_ID""), ""C"" AS (SELECT LEFT(""S2"".""PAY_DATE"", 7) AS ""M"",AVG(""S2"".""AMOUNT"") AS ""CS"" FROM ""SALARY"" AS ""S2"" GROUP BY ""M"") SELECT ""A"".""MONTH"" AS ""PAY_MONTH"",""A"".""DEPARTMENT_ID"",CASE WHEN ""ES"">""CS"" THEN 'higher' WHEN ""ES""<""CS"" THEN 'lower' ELSE 'same' END AS ""COMPARISON"" FROM ""A"" JOIN ""C"" ON ""A"".""MONTH""=""C"".""M"""
174,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
175,"WITH ""t"" AS (SELECT ""s"".""employee_id"",""s"".""amount"",LEFT(""s"".""pay_date"", 7) AS ""pay_month"",""e"".""department_id"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""avg"">""avg2"" THEN 'higher' WHEN ""avg""=""avg2"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT ""pay_month"",""department_id"",""amount"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""avg"",AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""avg2"" FROM ""t"") AS ""t2"" GROUP BY ""pay_month"",""department_id"""
176,"WITH ""cte1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""mnth"",AVG(""amount"") AS ""mnth_avg"" FROM ""salary"" GROUP BY ""mnth""), ""cte2"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""amt"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id"") SELECT ""c2"".""pay_month"",""c2"".""department_id"",CASE WHEN ""c2"".""amt"">""c1"".""mnth_avg"" THEN 'higher' WHEN ""c2"".""amt""<""c1"".""mnth_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte1"" AS ""c1"" JOIN ""cte2"" AS ""c2"" ON ""c1"".""mnth""=""c2"".""pay_month"""
177,"WITH ""cte"" AS (SELECT *,AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""comp1"",AVG(""amount"") OVER (PARTITION BY ""department_id"", ""pay_month"") AS ""comp2"" FROM (SELECT ""s"".""id"",""s"".""employee_id"",""s"".""amount"",TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" USING (""employee_id"")) AS ""a"" ORDER BY ""pay_month"") SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""comp2"">""comp1"" THEN 'higher' WHEN ""comp2""=""comp1"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM ""cte"""
178,"WITH ""tmp"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""pay_all"" FROM ""employee"" AS ""e"" LEFT JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY SUBSTR(""pay_date"", 1, 7)), ""tmp1"" AS (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""pay_company"" FROM ""employee"" AS ""e"" LEFT JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY SUBSTR(""pay_date"", 1, 7),""department_id"") SELECT ""tmp1"".""pay_month"",""department_id"",CASE WHEN ""pay_company"">""pay_all"" THEN 'higher' WHEN ""pay_company""=""pay_all"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""tmp1"" LEFT JOIN ""tmp"" ON ""tmp1"".""pay_month""=""tmp"".""pay_month"""
179,"SELECT ""da"".""month"" AS ""pay_month"",""department_id"",CASE WHEN ""department_average"">""company_average"" THEN 'higher' WHEN ""department_average""<""company_average"" THEN 'lower' WHEN ""department_average""=""company_average"" THEN 'same' END AS ""comparison"" FROM (SELECT SUBSTR(""pay_date"", 1, 7) AS ""month"",""department_id"",AVG(""amount"") AS ""department_average"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY 1,2) AS ""da"" JOIN (SELECT SUBSTR(""pay_date"", 1, 7) AS ""month"",AVG(""amount"") AS ""company_average"" FROM ""salary"" GROUP BY 1) AS ""ca"" ON ""da"".""month""=""ca"".""month"""
180,"SELECT ""dep"".""pay_month"",""department_id"",CASE WHEN ""dep_avg"">""cmp_avg"" THEN 'higher' WHEN ""dep_avg""<""cmp_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dep_avg"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2) AS ""dep"" JOIN (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""cmp_avg"" FROM ""salary"" GROUP BY 1) AS ""cmp"" ON ""dep"".""pay_month""=""cmp"".""pay_month"""
181,"SELECT ""a"".""s"" AS ""pay_month"",""a"".""department_id"",(CASE WHEN ""a"".""avg_de_salary""<""b"".""avg_salary"" THEN 'lower' WHEN ""a"".""avg_de_salary"">""b"".""avg_salary"" THEN 'higher' ELSE 'same' END) AS ""comparison"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""s"",""department_id"",ROUND(AVG(""amount""), 2) AS ""avg_de_salary"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""s"",""department_id"") AS ""a"" JOIN (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""s"",ROUND(AVG(""amount""), 2) AS ""avg_salary"" FROM ""salary"" GROUP BY ""s"") AS ""b"" ON ""a"".""s""=""b"".""s"""
182,"WITH ""CTE"" AS (SELECT ""e"".""department_id"",LEFT(""s"".""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY ""e"".""department_id"", LEFT(""s"".""pay_date"", 7)) AS ""dept_avg"",AVG(""amount"") OVER (PARTITION BY LEFT(""s"".""pay_date"", 7)) AS ""comp_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""comp_avg"" THEN 'higher' WHEN ""dept_avg""<""comp_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte"" GROUP BY 1,2"
183,"SELECT ""a"".""pay_month"",""a"".""department_id"",CASE WHEN ""a"".""avg_dept_sal"">""a"".""avg_comp_sal"" THEN 'higher' WHEN ""a"".""avg_dept_sal""=""a"".""avg_comp_sal"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT DISTINCT LEFT(""pay_date"", 7) AS ""pay_month"",""e"".""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""avg_comp_sal"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""e"".""department_id"") AS ""avg_dept_sal"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""a"" ORDER BY ""a"".""pay_month"" DESC"
184,"WITH ""company"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""month_avg"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""department"" AS (SELECT ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""dep_month_avg"" FROM ""Salary"" AS ""a"" JOIN ""Employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"" GROUP BY ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m')) SELECT ""a"".""pay_month"",""a"".""department_id"",CASE WHEN ""dep_month_avg"">""month_avg"" THEN 'higher' WHEN ""dep_month_avg""=""month_avg"" THEN 'same' WHEN ""dep_month_avg""<""month_avg"" THEN 'lower' END AS ""comparison"" FROM ""department"" AS ""a"" JOIN ""company"" AS ""b"" ON ""a"".""pay_month""=""b"".""pay_month"""
185,"WITH ""cte"" AS (SELECT LEFT(""pay_date"", 7) AS ""month"",ROUND(AVG(""amount""), 2) AS ""avg_Cmp"" FROM ""salary"" GROUP BY 1) SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",CASE WHEN ROUND(AVG(""s"".""amount""), 2)>(SELECT ""avg_Cmp"" FROM ""cte"" WHERE ""month""=LEFT(""s"".""pay_date"", 7)) THEN 'higher' WHEN ROUND(AVG(""s"".""amount""), 2)<(SELECT ""avg_Cmp"" FROM ""cte"" WHERE ""month""=LEFT(""s"".""pay_date"", 7)) THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2 ORDER BY 1 DESC,2"
186,"WITH ""temp"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""avg_by_month"" FROM ""salary"" AS ""s"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""t2"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") AS ""emp_avg"" FROM (""employee"" AS ""e"") JOIN ""salary"" AS ""s"" WHERE ""e"".""employee_id""=""s"".""employee_id"" GROUP BY ""pay_month"",""department_id"") SELECT DISTINCT ""temp"".""pay_month"",""t2"".""department_id"",CASE WHEN ""t2"".""emp_avg"">""temp"".""avg_by_month"" THEN 'higher' WHEN ""t2"".""emp_avg""<""temp"".""avg_by_month"" THEN 'lower' WHEN ""t2"".""emp_avg""=""temp"".""avg_by_month"" THEN 'same' END AS ""comparison"" FROM ""t2"" JOIN ""temp"" ON ""temp"".""pay_month""=""t2"".""pay_month"" ORDER BY ""pay_month"" DESC,""department_id"""
187,"SELECT ""department_salary"".""pay_month"" AS ""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY ""pay_month"") AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
188,"WITH ""cte"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg_amount"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id""), ""cte1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""am"" FROM ""salary"" GROUP BY ""pay_month"") SELECT ""cte1"".""pay_month"",""cte"".""department_id"",CASE WHEN ""cte"".""avg_amount"">""cte1"".""am"" THEN 'higher' WHEN ""cte"".""avg_amount""<""cte1"".""am"" THEN 'lower' WHEN ""cte"".""avg_amount""=""cte1"".""am"" THEN 'same' ELSE NULL END AS ""comparison"" FROM ""cte"" LEFT JOIN ""cte1"" ON ""cte"".""pay_month""=""cte1"".""pay_month"""
189,"WITH ""CompanyAverage"" AS (SELECT LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") AS ""CmpyAvgPerMonth"" FROM ""salary"" GROUP BY LEFT(""pay_date"", 7)), ""DepartmentAverage"" AS (SELECT LEFT(""S"".""pay_date"", 7) AS ""month"",""E"".""department_id"",AVG(""amount"") AS ""DptAvgPerMonth"" FROM ""salary"" AS ""S"" JOIN ""employee"" AS ""E"" ON ""E"".""employee_id""=""S"".""employee_id"" GROUP BY LEFT(""S"".""pay_date"", 7),""E"".""department_id"") SELECT ""DA"".""month"" AS ""pay_month"",""DA"".""department_id"",CASE WHEN ""CA"".""CmpyAvgPerMonth"">""DA"".""DptAvgPerMonth"" THEN 'lower' WHEN ""CA"".""CmpyAvgPerMonth""<""DA"".""DptAvgPerMonth"" THEN 'higher' ELSE 'same' END AS ""comparison"" FROM ""DepartmentAverage"" AS ""DA"" JOIN ""CompanyAverage"" AS ""CA"" ON ""CA"".""month""=""DA"".""month"""
190,"WITH ""full_table"" AS (SELECT ""s"".""employee_id"",""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""d_avg""=""c_avg"" THEN 'same' WHEN ""d_avg""<""c_avg"" THEN 'lower' ELSE 'higher' END AS ""comparison"" FROM (SELECT ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""d_avg"",AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""c_avg"" FROM ""full_table"") AS ""a"" ORDER BY ""pay_month"" DESC,""department_id"""
191,"WITH ""temp"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dept_amount"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""pay_month"",""department_id"") SELECT ""temp"".""pay_month"",""department_id"",CASE WHEN ""dept_amount"">""total_amount"" THEN 'higher' WHEN ""dept_amount""<""total_amount"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""temp"" JOIN (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""total_amount"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""pay_month"") AS ""temp2"" ON ""temp2"".""pay_month""=""temp"".""pay_month"""
192,"WITH ""temp"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""amount"" FROM ""salary"" GROUP BY LEFT(""pay_date"", 7)), ""temp1"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dept_avg"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY LEFT(""pay_date"", 7),""department_id"") SELECT ""temp1"".""pay_month"",""department_id"",CASE WHEN ""temp1"".""dept_avg"">""temp"".""amount"" THEN 'higher' WHEN ""temp1"".""dept_avg""<""temp"".""amount"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""temp"" JOIN ""temp1"" ON ""temp"".""pay_month""=""temp1"".""pay_month"""
193,"SELECT ""t"".""pay_month"",""t"".""department_id"",CASE WHEN ""t"".""dept_salary"">""t1"".""company_salary"" THEN 'higher' WHEN ""t"".""dept_salary""<""t1"".""company_salary"" THEN 'lower' WHEN ""t"".""dept_salary""=""t1"".""company_salary"" THEN 'same' END AS ""comparison"" FROM (SELECT AVG(""s"".""amount"") AS ""dept_salary"",""e"".""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY ""e"".""department_id"",TO_CHAR(""s"".""pay_date"", 'YYYY-%m')) AS ""t"" JOIN (SELECT AVG(""s"".""amount"") AS ""company_salary"",TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY TO_CHAR(""s"".""pay_date"", 'YYYY-%m')) AS ""t1"" ON ""t"".""pay_month""=""t1"".""pay_month"""
194,"WITH ""x"" AS (SELECT ""department_id"",""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""employee"".""employee_id""=""salary"".""employee_id""), ""y"" AS (SELECT DISTINCT ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""company"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""depart"" FROM ""x"") SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""depart"">""company"" THEN 'higher' WHEN ""depart""=""company"" THEN 'same' WHEN ""depart""<""company"" THEN 'lower' END AS ""comparison"" FROM ""y"" ORDER BY ""pay_month"" DESC,""department_id"""
195,"SELECT DISTINCT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",CASE WHEN ""davg"">""cavg"" THEN 'higher' WHEN ""davg""=""cavg"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT ""id"",""s"".""employee_id"",""department_id"",""amount"",""pay_date"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""cavg"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""davg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""a"" ORDER BY 1 DESC,2"
196,"SELECT DISTINCT ""pay_month"",""department_id"",(CASE WHEN ""department_avg_salary"">""company_avg_salary"" THEN 'higher' WHEN ""department_avg_salary""<""company_avg_salary"" THEN 'lower' WHEN ""department_avg_salary""=""company_avg_salary"" THEN 'same' END) AS ""comparison"" FROM (SELECT ""A"".""employee_id"",""amount"",""pay_date"",""department_id"",LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY ""A"".""pay_date"") AS ""company_avg_salary"",AVG(""amount"") OVER (PARTITION BY ""A"".""pay_date"", ""B"".""department_id"") AS ""department_avg_salary"" FROM ""salary"" AS ""A"" JOIN ""employee"" AS ""B"" ON ""A"".""employee_id""=""B"".""employee_id"") AS ""temp"""
197,"WITH ""c"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""a"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m'), ""department_id"") AS ""b"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""b"">""a"" THEN 'higher' WHEN ""b""<""a"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""c"" ORDER BY ""pay_month"" DESC,""department_id"""
198,"WITH ""cte"" AS (SELECT AVG(""amount"") AS ""avg_salary_company"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""cte2"" AS (SELECT AVG(""amount"") AS ""avg_salary_department"",""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m')) SELECT ""cte"".""pay_month"" AS ""pay_month"",""department_id"",CASE WHEN ""avg_salary_department"">""avg_salary_company"" THEN 'higher' WHEN ""avg_salary_department""<""avg_salary_company"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte"" JOIN ""cte2"" ON ""cte2"".""pay_month""=""cte"".""pay_month"""
199,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
200,"WITH ""tmp"" AS (SELECT ""a"".*,""b"".""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""avg_dept"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""avg_company"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" USING (""employee_id"")) SELECT DISTINCT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",CASE WHEN ""avg_dept""<""avg_company"" THEN 'lower' WHEN ""avg_dept""=""avg_company"" THEN 'same' ELSE 'higher' END AS ""comparison"" FROM ""tmp"""
201,"WITH ""cte1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""mnth"",AVG(""amount"") AS ""mnth_avg"" FROM ""salary"" GROUP BY ""mnth""), ""cte2"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""amt"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id"") SELECT ""c2"".""pay_month"",""c2"".""department_id"",CASE WHEN ""c2"".""amt"">""c1"".""mnth_avg"" THEN 'higher' WHEN ""c2"".""amt""<""c1"".""mnth_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte1"" AS ""c1"" JOIN ""cte2"" AS ""c2"" ON ""c1"".""mnth""=""c2"".""pay_month"""
202,"WITH ""cte_avgs"" AS (SELECT DISTINCT ""e"".""department_id"",""s"".""pay_date"",AVG(""amount"") OVER (PARTITION BY ""pay_date"") AS ""avg_company_salary"",AVG(""amount"") OVER (PARTITION BY ""pay_date"", ""department_id"") AS ""avg_department_salary"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"") SELECT DISTINCT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",CASE WHEN ""avg_department_salary"">""avg_company_salary"" THEN 'higher' WHEN ""avg_department_salary""<""avg_company_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte_avgs"" ORDER BY ""department_id"",""pay_month"""
203,"WITH ""Depavg_Sal"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""Avg_Sal"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2 ORDER BY 1 DESC,2), ""Compavg_Sal"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""s"".""amount"") AS ""AvgSalc"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1) SELECT ""d1"".""pay_month"",""d1"".""department_id"",CASE WHEN ""d1"".""Avg_Sal""=""c1"".""AvgSalc"" THEN 'same' WHEN ""d1"".""Avg_Sal"">""c1"".""AvgSalc"" THEN 'higher' ELSE 'lower' END AS ""comparison"" FROM ""Depavg_Sal"" AS ""d1"" JOIN ""Compavg_Sal"" AS ""c1"" ON ""d1"".""pay_month""=""c1"".""pay_month"" ORDER BY 1 DESC,2"
204,"WITH ""month_avg"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""co_avg"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""department_avg"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""dpt_avg"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m'),""e"".""department_id"") SELECT ""d"".""pay_month"",""department_id"",CASE WHEN ""co_avg"">""dpt_avg"" THEN 'lower' WHEN ""co_avg""<""dpt_avg"" THEN 'higher' ELSE 'same' END AS ""comparison"" FROM ""month_avg"" AS ""m"" JOIN ""department_avg"" AS ""d"" ON ""m"".""pay_month""=""d"".""pay_month"""
205,"WITH ""cte"" AS (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""avg_dep"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""avg_comp"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT DISTINCT (""pay_month""),""department_id"",(CASE WHEN ""avg_dep"">""avg_comp"" THEN 'higher' WHEN ""avg_dep""<""avg_comp"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""cte"""
206,"WITH ""department_avg"" AS ((SELECT ""e1"".""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""s1"".""amount"") AS ""pay_avg"" FROM ""salary"" AS ""s1"" JOIN ""employee"" AS ""e1"" ON ""s1"".""employee_id""=""e1"".""employee_id"" GROUP BY EXTRACT(YEAR FROM ""pay_date""),EXTRACT(MONTH FROM ""pay_date""),""e1"".""department_id"")), ""company_avg"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""s2"".""amount"") AS ""pay_avg"" FROM ""salary"" AS ""s2"" JOIN ""employee"" AS ""e2"" ON ""s2"".""employee_id""=""e2"".""employee_id"" GROUP BY EXTRACT(YEAR FROM ""pay_date""),EXTRACT(MONTH FROM ""pay_date"")) SELECT ""department_avg"".""department_id"",""department_avg"".""pay_month"",(CASE WHEN ""department_avg"".""pay_avg"">""company_avg"".""pay_avg"" THEN 'higher' WHEN ""department_avg"".""pay_avg""=""company_avg"".""pay_avg"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM ""department_avg"" JOIN ""company_avg"" ON ""department_avg"".""pay_month""=""company_avg"".""pay_month"""
207,"SELECT ""da"".""month"" AS ""pay_month"",""department_id"",CASE WHEN ""department_average"">""company_average"" THEN 'higher' WHEN ""department_average""<""company_average"" THEN 'lower' WHEN ""department_average""=""company_average"" THEN 'same' END AS ""comparison"" FROM (SELECT SUBSTR(""pay_date"", 1, 7) AS ""month"",""department_id"",AVG(""amount"") AS ""department_average"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY 1,2) AS ""da"" JOIN (SELECT SUBSTR(""pay_date"", 1, 7) AS ""month"",AVG(""amount"") AS ""company_average"" FROM ""salary"" GROUP BY 1) AS ""ca"" ON ""da"".""month""=""ca"".""month"""
208,"WITH ""joined"" AS (SELECT ""s"".""employee_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""amount"",""department_id"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""company_avg"" AS (SELECT ""pay_month"",AVG(""amount"") AS ""average_salary"" FROM ""joined"" GROUP BY ""pay_month""), ""avg_pay_department"" AS (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""department_average_salary"" FROM ""joined"" GROUP BY ""pay_month"",""department_id"") SELECT ""apd"".""pay_month"",""apd"".""department_id"",CASE WHEN ""department_average_salary""<""average_salary"" THEN 'lower' WHEN ""department_average_salary"">""average_salary"" THEN 'higher' ELSE 'same' END AS ""comparison"" FROM ""avg_pay_department"" AS ""apd"" LEFT JOIN ""company_avg"" AS ""ca"" ON ""apd"".""pay_month""=""ca"".""pay_month"""
209,"WITH ""date_avg"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""year_mon"",AVG(""amount"") AS ""avg_mon"" FROM ""salary"" GROUP BY ""year_mon""), ""com_avg"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""year_mon"",""department_id"",AVG(""amount"") AS ""avg_mon"" FROM (""salary"") JOIN ""employee"" WHERE ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""employee"".""department_id"",""year_mon"") SELECT ""com_avg"".""year_mon"" AS ""pay_month"",""com_avg"".""department_id"" AS ""department_id"",CASE WHEN ""com_avg"".""avg_mon"">""date_avg"".""avg_mon"" THEN 'higher' WHEN ""com_avg"".""avg_mon""=""date_avg"".""avg_mon"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (""com_avg"") JOIN ""date_avg"" WHERE ""com_avg"".""year_mon""=""date_avg"".""year_mon"""
210,"WITH ""cte1"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""month_avg"" FROM ""salary"" GROUP BY ""pay_month""), ""cte2"" AS (SELECT TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") AS ""dept_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""e"".""department_id"") SELECT ""c2"".""pay_month"",""c2"".""department_id"",CASE WHEN ""c2"".""dept_avg"">""c1"".""month_avg"" THEN 'higher' WHEN ""c2"".""dept_avg""<""c1"".""month_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte1"" AS ""c1"" JOIN ""cte2"" AS ""c2"" ON ""c1"".""pay_month""=""c2"".""pay_month"""
211,"WITH ""table1"" AS (SELECT ""employee_id"",""department_id"",""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" USING (""employee_id"")), ""table2"" AS (SELECT DISTINCT ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""avg_dept"" FROM ""table1""), ""table3"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""avg_comp"" FROM ""salary"" GROUP BY ""pay_month"") SELECT ""pay_month"",""department_id"",(CASE WHEN ""avg_dept"">""avg_comp"" THEN 'higher' WHEN ""avg_dept""=""avg_comp"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM ""table2"" JOIN ""table3"" USING (""pay_month"")"
212,"SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""department_avg"">""month_avg"" THEN 'higher' WHEN ""department_avg""=""month_avg"" THEN 'same' WHEN ""department_avg""<""month_avg"" THEN 'lower' END AS ""comparison"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""month_avg"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m'), ""department_id"") AS ""department_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""a"""
213,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
214,"WITH ""cte1"" AS (SELECT AVG(""amount"") AS ""firm_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')), ""cte2"" AS (SELECT ""e"".""department_id"",TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""pay"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""e"".""department_id"",TO_CHAR(""s"".""pay_date"", 'YYYY-%m')) SELECT ""c2"".""pay_month"",""c2"".""department_id"",CASE WHEN ""c2"".""pay"">""c1"".""firm_avg"" THEN 'higher' WHEN ""c2"".""pay""<""c1"".""firm_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte2"" AS ""c2"" JOIN ""cte1"" AS ""c1"" ON ""c1"".""pay_month""=""c2"".""pay_month"""
215,"WITH ""t2"" AS (SELECT SUBSTR(CONVERT(""pay_date"", CHAR), 1, 7) AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""dept_avg"",SUM(""amount"") AS ""s_amt"",COUNT(1) AS ""cnt"" FROM ""SALARY"" AS ""s"" JOIN ""EMPLOYEE"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY EXTRACT(YEAR FROM ""pay_date"")*100+EXTRACT(MONTH FROM ""pay_date""),""e"".""department_id""), ""t1"" AS (SELECT ""pay_month"",SUM(""s_amt"")/SUM(""cnt"") AS ""COMPANY_AVG"" FROM ""T2"" GROUP BY ""pay_month"") SELECT ""T2"".""pay_month"",""T2"".""department_id"",CASE WHEN ""T2"".""dept_avg"">""T1"".""COMPANY_AVG"" THEN 'higher' WHEN ""T2"".""dept_avg""<""T1"".""COMPANY_AVG"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""T2"" JOIN ""T1"" ON ""T2"".""pay_month""=""T1"".""pay_month"""
216,"WITH ""dept_avg"" AS (SELECT ""s"".""amount"",""s"".""pay_date"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY EXTRACT(MONTH FROM ""s"".""pay_date""),""e"".""department_id""), ""comp_avg"" AS (SELECT ""s"".""amount"",""s"".""pay_date"",""e"".""department_id"",AVG(""s"".""amount"") AS ""avg"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY EXTRACT(MONTH FROM ""s"".""pay_date"")) SELECT SUBSTRING(""d"".""pay_date"", 1, 7) AS ""pay_month"",""d"".""department_id"",CASE WHEN ""d"".""avg"">""c"".""avg"" THEN 'higher' WHEN ""d"".""avg""<""c"".""avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""dept_avg"" AS ""d"" LEFT JOIN ""comp_avg"" AS ""c"" ON EXTRACT(MONTH FROM ""d"".""pay_date"")=EXTRACT(MONTH FROM ""c"".""pay_date"")"
217,"SELECT ""pay_month"",""department_id"",CASE WHEN ""average_dept_month"">""average_month"" THEN 'higher' WHEN ""average_dept_month""<""average_month"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT DISTINCT ""e"".""department_id"",LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""e"".""department_id"") AS ""average_dept_month"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) AS ""average_month"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""ASD"" ORDER BY ""pay_month"" DESC"
218,"SELECT ""a"".""pay_month"",""a"".""department_id"",CASE WHEN ""a"".""average""<""b"".""average"" THEN 'lower' WHEN ""a"".""average""=""b"".""average"" THEN 'same' WHEN ""a"".""average"">""b"".""average"" THEN 'higher' END AS ""comparison"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") AS ""average"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"" GROUP BY ""pay_month"",""department_id"") AS ""a"" JOIN (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""average"" FROM ""salary"" GROUP BY ""pay_month"") AS ""b"" ON ""a"".""pay_month""=""b"".""pay_month"""
219,"SELECT ""a"".""pay_month"",""department_id"",(CASE WHEN ""dept_avg"">""comp_avg"" THEN 'higher' WHEN ""dept_avg""<""comp_avg"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""dept_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""employee"" AS ""e"" LEFT JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id"" GROUP BY ""department_id"",""pay_month"" ORDER BY ""pay_month"" DESC,""department_id"") AS ""a"" JOIN (SELECT AVG(""amount"") AS ""comp_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY ""pay_month"") AS ""b"" ON ""a"".""pay_month""=""b"".""pay_month"""
220,"WITH ""date_avg"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""year_mon"",AVG(""amount"") AS ""avg_mon"" FROM ""salary"" GROUP BY ""year_mon""), ""com_avg"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""year_mon"",""department_id"",AVG(""amount"") AS ""avg_mon"" FROM (""salary"") JOIN ""employee"" WHERE ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""employee"".""department_id"",""year_mon"") SELECT ""com_avg"".""year_mon"" AS ""pay_month"",""com_avg"".""department_id"" AS ""department_id"",CASE WHEN ""com_avg"".""avg_mon"">""date_avg"".""avg_mon"" THEN 'higher' WHEN ""com_avg"".""avg_mon""=""date_avg"".""avg_mon"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (""com_avg"") JOIN ""date_avg"" WHERE ""com_avg"".""year_mon""=""date_avg"".""year_mon"""
221,"WITH ""A"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dep_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 2,1), ""b"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""mon_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1) SELECT ""A"".""pay_month"",""A"".""department_id"",CASE WHEN ""A"".""dep_avg"">""B"".""mon_avg"" THEN 'higher' WHEN ""A"".""dep_avg""<""B"".""mon_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""A"" JOIN ""B"" ON ""A"".""pay_month""=""B"".""pay_month"""
222,"WITH ""cte"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""amount"",""department_id"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""cte2"" AS (SELECT ""pay_month"",AVG(""amount"") AS ""c_amt"" FROM ""cte"" GROUP BY ""pay_month""), ""cte3"" AS (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""d_amt"" FROM ""cte"" GROUP BY ""pay_month"",""department_id"") SELECT ""cte3"".""pay_month"",""department_id"",(CASE WHEN ""d_amt"">""c_amt"" THEN 'higher' WHEN ""d_amt""=""c_amt"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""pay_month""=""cte2"".""pay_month"""
223,"SELECT ""dept"".""pay_month"",""department_id"",CASE WHEN ""deptAvgSal"">""comAvgSal"" THEN 'higher' WHEN ""deptAvgSal""<""comAvgSal"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",SUM(""s"".""amount"")/COUNT(1) AS ""deptAvgSal"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY TO_CHAR(""pay_date"", 'YYYY%m'),""department_id"" ORDER BY TO_CHAR(""pay_date"", 'YYYY%m') DESC,""department_id"") AS ""dept"" JOIN (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",SUM(""s"".""amount"")/COUNT(1) AS ""comAvgSal"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY TO_CHAR(""pay_date"", 'YYYY%m') ORDER BY TO_CHAR(""pay_date"", 'YYYY%m') DESC) AS ""com"" ON ""dept"".""pay_month""=""com"".""pay_month"""
224,"WITH ""t2"" AS (SELECT SUBSTR(CONVERT(""pay_date"", CHAR), 1, 7) AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""dept_avg"",SUM(""amount"") AS ""s_amt"",COUNT(1) AS ""cnt"" FROM ""SALARY"" AS ""s"" JOIN ""EMPLOYEE"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY EXTRACT(YEAR FROM ""pay_date"")*100+EXTRACT(MONTH FROM ""pay_date""),""e"".""department_id""), ""t1"" AS (SELECT ""pay_month"",SUM(""s_amt"")/SUM(""cnt"") AS ""COMPANY_AVG"" FROM ""T2"" GROUP BY ""pay_month"") SELECT ""T2"".""pay_month"",""T2"".""department_id"",CASE WHEN ""T2"".""dept_avg"">""T1"".""COMPANY_AVG"" THEN 'higher' WHEN ""T2"".""dept_avg""<""T1"".""COMPANY_AVG"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""T2"" JOIN ""T1"" ON ""T2"".""pay_month""=""T1"".""pay_month"""
225,"SELECT ""pay_month"",""department_id"",CASE WHEN ""dept_salary"">""company_salary"" THEN 'higher' WHEN ""dept_salary""<""company_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") AS ""dept_salary"" FROM ""salary"" JOIN ""employee"" USING (""employee_id"") GROUP BY 1,2) AS ""temp2"" JOIN (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""company_salary"" FROM ""salary"" GROUP BY ""pay_month"") AS ""temp"" USING (""pay_month"") ORDER BY ""pay_month"""
226,"WITH ""cte"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""department_id"", TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""depar_monthly_avg"",AVG(""amount"") OVER (PARTITION BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_monthly_avg"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""depar_monthly_avg"">""company_monthly_avg"" THEN 'higher' WHEN ""depar_monthly_avg""<""company_monthly_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""cte"" ORDER BY 1 DESC,2"
227,"SELECT ""department_salary"".""pay_month"",""department_id"",CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""department_id"",AVG(""amount"") AS ""department_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""department_id"",""pay_month"") AS ""department_salary"" JOIN (SELECT AVG(""amount"") AS ""company_avg"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" GROUP BY TO_CHAR(""pay_date"", 'YYYY-%m')) AS ""company_salary"" ON ""department_salary"".""pay_month""=""company_salary"".""pay_month"""
228,"SELECT ""pay_month"",""department_id"",""comparison"" FROM (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",""department_id"",CASE WHEN AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"")>AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) THEN 'higher' WHEN AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"")=AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7)) THEN 'same' ELSE 'lower' END AS ""comparison"",ROW_NUMBER() OVER (PARTITION BY LEFT(""pay_date"", 7), ""department_id"") AS ""row_ct"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""sub"" WHERE ""row_ct""=1 ORDER BY ""pay_month"" DESC,""department_id"""
229,"SELECT ""R"".""pay_month"",""R"".""department_id"",(CASE WHEN ""R"".""department_avg"">""C"".""company_avg"" THEN 'higher' WHEN ""R"".""department_avg""=""C"".""company_avg"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM (SELECT LEFT(""S"".""pay_date"", 7) AS ""pay_month"",""E"".""department_id"",AVG(""S"".""amount"") AS ""department_avg"" FROM ""Salary"" AS ""S"" JOIN ""employee"" AS ""E"" ON ""S"".""employee_id""=""E"".""employee_id"" GROUP BY ""E"".""department_id"",""pay_month"") AS ""R"" JOIN (SELECT LEFT(""pay_date"", 7) AS ""pay_month"",AVG(""amount"") AS ""company_avg"" FROM ""salary"" GROUP BY ""pay_month"") AS ""C"" ON ""R"".""pay_month""=""C"".""pay_month"" ORDER BY 1,2"
230,"WITH ""A"" AS (SELECT LEFT(""S1"".""PAY_DATE"", 7) AS ""MONTH"",""E1"".""DEPARTMENT_ID"",AVG(""S1"".""AMOUNT"") AS ""ES"" FROM ""EMPLOYEE"" AS ""E1"" JOIN ""SALARY"" AS ""S1"" ON ""E1"".""EMPLOYEE_ID""=""S1"".""EMPLOYEE_ID"" GROUP BY ""MONTH"",""E1"".""DEPARTMENT_ID""), ""C"" AS (SELECT LEFT(""S2"".""PAY_DATE"", 7) AS ""M"",AVG(""S2"".""AMOUNT"") AS ""CS"" FROM ""SALARY"" AS ""S2"" GROUP BY ""M"") SELECT ""A"".""MONTH"" AS ""PAY_MONTH"",""A"".""DEPARTMENT_ID"",CASE WHEN ""ES"">""CS"" THEN 'higher' WHEN ""ES""<""CS"" THEN 'lower' ELSE 'same' END AS ""COMPARISON"" FROM ""A"" JOIN ""C"" ON ""A"".""MONTH""=""C"".""M"""
231,"WITH ""Averages"" AS (SELECT ""s"".""id"",""s"".""employee_id"",""e"".""department_id"",""s"".""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") OVER (PARTITION BY ""pay_date"" ORDER BY ""pay_date"") AS ""CompAvg"",AVG(""amount"") OVER (PARTITION BY ""pay_date"", ""e"".""department_id"" ORDER BY ""pay_date"",""e"".""department_id"") AS ""DeptAvg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""DeptAvg"">""CompAvg"" THEN 'higher' WHEN ""DeptAvg""<""CompAvg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""Averages"""
232,"WITH ""avg_salary"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",AVG(""amount"") AS ""avg_pay"" FROM ""salary"" AS ""s"" GROUP BY 1), ""dep_salary"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""e"".""department_id"",AVG(""amount"") AS ""avg_dep_pay"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 1,2) SELECT ""d"".""pay_month"",""d"".""department_id"",CASE WHEN ""avg_dep_pay"">""a"".""avg_pay"" THEN 'higher' WHEN ""avg_dep_pay""<""a"".""avg_pay"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""dep_salary"" AS ""d"" LEFT JOIN ""avg_salary"" AS ""a"" ON ""a"".""pay_month""=""d"".""pay_month"" ORDER BY 1,2"
233,"WITH ""cte"" AS (SELECT ""department_id"",""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" JOIN ""employee"" USING (""employee_id"")) SELECT ""dep"".""pay_month"",""dep"".""department_id"",CASE WHEN ""department""<""company"" THEN 'lower' WHEN ""department""=""company"" THEN 'same' WHEN ""department"">""company"" THEN 'higher' END AS ""comparison"" FROM (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""department"" FROM ""cte"" GROUP BY ""pay_month"",""department_id"") AS ""dep"" JOIN (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""company"" FROM ""cte"" GROUP BY ""pay_month"") AS ""com"" ON ""dep"".""pay_month""=""com"".""pay_month"""
234,"WITH ""tbAll"" AS (SELECT AVG(""amount"") OVER (PARTITION BY EXTRACT(YEAR FROM ""pay_date""), EXTRACT(MONTH FROM ""pay_date"")) AS ""avgAmtMonth"",AVG(""amount"") OVER (PARTITION BY EXTRACT(YEAR FROM ""pay_date""), EXTRACT(MONTH FROM ""pay_date""), ""department_id"") AS ""avgAmtDept"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT ""pay_month"",""department_id"",(CASE WHEN MIN(""avgAmtDept"")>MIN(""avgAmtMonth"") THEN 'higher' WHEN MIN(""avgAmtDept"")<MIN(""avgAmtMonth"") THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""tbAll"" GROUP BY ""pay_month"",""department_id"""
235,"SELECT ""month"" AS ""pay_month"",""department_id"",CASE WHEN ""avg_d"">""avg_o"" THEN 'higher' WHEN ""avg_d""<""avg_o"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""s"".""employee_id"",""department_id"",LEFT(""pay_date"", 7) AS ""month"",AVG(""amount"") OVER (PARTITION BY ""department_id"", LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_d"",AVG(""amount"") OVER (PARTITION BY LEFT(""pay_date"", 7) ORDER BY LEFT(""pay_date"", 7)) AS ""avg_o"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""s"".""employee_id""=""e"".""employee_id"") AS ""temp"" GROUP BY 1,2"
236,"SELECT ""dept_month_salary"".""pay_month"",""dept_month_salary"".""department_id"",CASE WHEN ""dept_month_salary"".""dept_avg_salary"">""comp_month_salary"".""comp_avg_salary"" THEN 'higher' WHEN ""dept_month_salary"".""dept_avg_salary""=""comp_month_salary"".""comp_avg_salary"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",""employee"".""department_id"" AS ""department_id"",AVG(""amount"") AS ""dept_avg_salary"" FROM ""salary"" LEFT JOIN ""employee"" ON ""salary"".""employee_id""=""employee"".""employee_id"" GROUP BY ""employee"".""department_id"",SUBSTR(""pay_date"", 1, 7)) AS ""dept_month_salary"" LEFT JOIN (SELECT SUBSTR(""pay_date"", 1, 7) AS ""pay_month"",AVG(""amount"") AS ""comp_avg_salary"" FROM ""salary"" GROUP BY SUBSTR(""pay_date"", 1, 7)) AS ""comp_month_salary"" ON ""dept_month_salary"".""pay_month""=""comp_month_salary"".""pay_month"""
237,"WITH ""t1"" AS (SELECT ""pay_month"",""department_id"",AVG(""amount"") OVER (PARTITION BY ""pay_month"", ""department_id"") AS ""dept_avg"",AVG(""amount"") OVER (PARTITION BY ""pay_month"") AS ""com_avg"" FROM (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""s"".""employee_id"",""amount"",""department_id"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") AS ""t"") SELECT DISTINCT ""pay_month"",""department_id"",CASE WHEN ""dept_avg"">""com_avg"" THEN 'higher' WHEN ""dept_avg""=""com_avg"" THEN 'same' WHEN ""dept_avg""<""com_avg"" THEN 'lower' END AS ""comparison"" FROM ""t1"" ORDER BY ""pay_month"" DESC"
238,"WITH ""monthly_avgs"" AS (SELECT DISTINCT LEFT(""s"".""pay_date"", 7) AS ""pay_month"",""e"".""department_id"",AVG(""s"".""amount"") OVER (PARTITION BY EXTRACT(MONTH FROM ""s"".""pay_date""), ""e"".""department_id"") AS ""dept_avg"",AVG(""s"".""amount"") OVER (PARTITION BY EXTRACT(MONTH FROM ""s"".""pay_date"")) AS ""company_avg"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"") SELECT ""pay_month"",""department_id"",CASE WHEN ""dept_avg""<""company_avg"" THEN 'lower' WHEN ""dept_avg""=""company_avg"" THEN 'same' WHEN ""dept_avg"">""company_avg"" THEN 'higher' END AS ""comparison"" FROM ""monthly_avgs"" ORDER BY ""pay_month"" DESC,""department_id"""
239,"WITH ""CTE"" AS (SELECT LEFT(""s"".""pay_date"", 7) AS ""pay_month"",""e"".""department_id"" AS ""department_id"",AVG(""s"".""amount"") OVER (PARTITION BY ""s"".""pay_date"") AS ""company_avg"",AVG(""s"".""amount"") OVER (PARTITION BY ""e"".""department_id"", ""s"".""pay_date"") AS ""department_avg"" FROM (""salary"" AS ""s"") JOIN ""employee"" AS ""e"" WHERE ""e"".""employee_id""=""s"".""employee_id"") SELECT ""pay_month"",""department_id"",(CASE WHEN ""department_avg"">""company_avg"" THEN 'higher' WHEN ""department_avg""<""company_avg"" THEN 'lower' WHEN ""department_avg""=""company_avg"" THEN 'same' END) AS ""comparison"" FROM ""CTE"" GROUP BY ""pay_month"",""department_id"""
240,"WITH ""tmp1"" AS (SELECT ""a"".""employee_id"",""a"".""amount"",""a"".""pay_date"",""b"".""department_id"",AVG(""a"".""amount"") OVER (PARTITION BY ""b"".""department_id"", ""a"".""pay_date"") AS ""dep_avg"",AVG(""a"".""amount"") OVER (PARTITION BY ""a"".""pay_date"") AS ""comp_avg"" FROM ""salary"" AS ""a"" JOIN ""employee"" AS ""b"" ON ""a"".""employee_id""=""b"".""employee_id"") SELECT DISTINCT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""department_id"",CASE WHEN ""dep_avg"">""comp_avg"" THEN 'higher' WHEN ""dep_avg""=""comp_avg"" THEN 'same' ELSE 'lower' END AS ""comparison"" FROM ""tmp1"""
241,"WITH ""emp_salary"" AS (SELECT ""e"".""employee_id"",""department_id"",""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""employee"" AS ""e"" JOIN ""salary"" AS ""s"" ON ""e"".""employee_id""=""s"".""employee_id""), ""comp_avg_salary"" AS (SELECT ""pay_month"",AVG(""amount"") AS ""avg_salary"" FROM ""emp_salary"" GROUP BY ""pay_month""), ""department_avg_salary"" AS (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""avg_salary"" FROM ""emp_salary"" GROUP BY ""pay_month"",""department_id"") SELECT ""cas"".""pay_month"",""department_id"",CASE WHEN ""cas"".""avg_salary""=""das"".""avg_salary"" THEN 'same' WHEN ""cas"".""avg_salary"">""das"".""avg_salary"" THEN 'lower' ELSE 'higher' END AS ""comparison"" FROM ""department_avg_salary"" AS ""das"" JOIN ""comp_avg_salary"" AS ""cas"" ON ""das"".""pay_month""=""cas"".""pay_month"""
242,"SELECT ""tt1"".""pay_month"",""tt1"".""department_id"",CASE WHEN ""tt1"".""avg"">""tt2"".""avg_month"" THEN 'higher' WHEN ""tt1"".""avg""<""tt2"".""avg_month"" THEN 'lower' WHEN ""tt1"".""avg""=""tt2"".""avg_month"" THEN 'same' END AS ""comparison"" FROM (SELECT AVG(""amount"") AS ""avg"",""department_id"",""pay_month"" FROM (SELECT ""e"".""department_id"",""s"".""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" ORDER BY ""pay_month"") AS ""t1"" GROUP BY ""department_id"",""pay_month"") AS ""tt1"" JOIN (SELECT AVG(""amount"") AS ""avg_month"",""pay_month"" FROM (SELECT ""e"".""department_id"",""s"".""amount"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" ORDER BY ""pay_month"") AS ""t2"" GROUP BY ""pay_month"") AS ""tt2"" ON ""tt1"".""pay_month""=""tt2"".""pay_month"""
243,"WITH ""CTE"" AS (SELECT ""ID"",""S"".""EMPLOYEE_ID"",""AMOUNT"",""PAY_DATE"",""DEPARTMENT_ID"",AVG(""AMOUNT"") OVER (PARTITION BY ""PAY_DATE"") AS ""COM_AVG"",AVG(""AMOUNT"") OVER (PARTITION BY ""PAY_DATE"", ""DEPARTMENT_ID"") AS ""D_AVG"" FROM ""SALARY"" AS ""S"" LEFT JOIN ""EMPLOYEE"" AS ""E"" ON ""S"".""EMPLOYEE_ID""=""E"".""EMPLOYEE_ID"") SELECT TO_CHAR(""PAY_DATE"", 'YYYY-%m') AS ""pay_month"",""department_id"",CASE WHEN ""COM_AVG""<""D_AVG"" THEN 'higher' WHEN ""COM_AVG"">""D_AVG"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""CTE"" GROUP BY ""DEPARTMENT_ID"",TO_CHAR(""PAY_DATE"", 'YYYY-%m') ORDER BY TO_CHAR(""PAY_DATE"", 'YYYY-%m') DESC"
244,"SELECT LEFT(""temp"".""pay_date"", 7) AS ""pay_month"",""temp"".""department_id"",CASE WHEN ""temp"".""a_avg"">""temp"".""c_avg"" THEN 'higher' WHEN ""temp"".""a_avg""<""temp"".""c_avg"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM (SELECT ""s"".""id"",""s"".""employee_id"",""e"".""department_id"",""s"".""amount"",""s"".""pay_date"",AVG(""s"".""amount"") OVER (PARTITION BY LEFT(""s"".""pay_date"", 7), ""e"".""department_id"") AS ""a_avg"",AVG(""s"".""amount"") OVER (PARTITION BY LEFT(""s"".""pay_date"", 7)) AS ""c_avg"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""e"".""employee_id""=""s"".""employee_id"") AS ""temp"" GROUP BY LEFT(""temp"".""pay_date"", 7),""temp"".""department_id"""
245,"WITH ""t"" AS (SELECT AVG(""s"".""amount"") AS ""avg_month_salary"",TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""avg_year_month"" FROM ""salary"" AS ""s"" GROUP BY 2), ""t2"" AS (SELECT AVG(""s"".""amount"") AS ""avg_dept_month_salary"",""e"".""department_id"",TO_CHAR(""s"".""pay_date"", 'YYYY-%m') AS ""avg_year_month_dept"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY 2,3) SELECT ""t2"".""avg_year_month_dept"" AS ""pay_month"",""t2"".""department_id"",CASE WHEN ""t2"".""avg_dept_month_salary"">""t"".""avg_month_salary"" THEN 'higher' WHEN ""t2"".""avg_dept_month_salary""<""t"".""avg_month_salary"" THEN 'lower' ELSE 'same' END AS ""comparison"" FROM ""t"" JOIN ""t2"" ON ""t"".""avg_year_month""=""t2"".""avg_year_month_dept"""
246,"WITH ""cte"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""pay_month"",""amount"",""department_id"" FROM ""salary"" AS ""s"" LEFT JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id""), ""cte2"" AS (SELECT ""pay_month"",AVG(""amount"") AS ""c_amt"" FROM ""cte"" GROUP BY ""pay_month""), ""cte3"" AS (SELECT ""pay_month"",""department_id"",AVG(""amount"") AS ""d_amt"" FROM ""cte"" GROUP BY ""pay_month"",""department_id"") SELECT ""cte3"".""pay_month"",""department_id"",(CASE WHEN ""d_amt"">""c_amt"" THEN 'higher' WHEN ""d_amt""=""c_amt"" THEN 'same' ELSE 'lower' END) AS ""comparison"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""pay_month""=""cte2"".""pay_month"""
247,"WITH ""avg_monthly"" AS (SELECT TO_CHAR(""pay_date"", 'YYYY-%m') AS ""month"",AVG(""s"".""amount"") AS ""avg_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY EXTRACT(MONTH FROM ""s"".""pay_date"")), ""avg_department"" AS (SELECT ""e"".""department_id"",TO_CHAR(""pay_date"", 'YYYY-%m') AS ""month"",AVG(""s"".""amount"") AS ""avg_dep_month"" FROM ""salary"" AS ""s"" JOIN ""employee"" AS ""e"" ON ""s"".""employee_id""=""e"".""employee_id"" GROUP BY EXTRACT(MONTH FROM ""s"".""pay_date""),""e"".""department_id"") SELECT ""ad"".""month"" AS ""pay_month"",""ad"".""department_id"",(CASE WHEN ""avg_dep_month"">""avg_month"" THEN 'higher' WHEN ""avg_dep_month""<""avg_month"" THEN 'lower' ELSE 'same' END) AS ""comparison"" FROM ""avg_department"" AS ""ad"" JOIN ""avg_monthly"" AS ""am"" ON ""ad"".""month""=""am"".""month"""
