id,original query
1,"WITH RECURSIVE ""dates"" AS (SELECT ""product_id"",""average_daily_sales"",""period_end"",""period_start"" AS ""year_start"",LEAST(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-12-31'), ""period_end"") AS ""year_end"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_end"",CONCAT(EXTRACT(YEAR FROM ""year_start"")+1, '-01-01'),LEAST(CONCAT(EXTRACT(YEAR FROM ""year_start"")+1, '-12-31'), ""period_end"") FROM ""dates"" WHERE CONCAT(EXTRACT(YEAR FROM ""year_start"")+1, '-01-01')<=""period_end"") SELECT ""product_id"",""product_name"",CAST(EXTRACT(YEAR FROM ""year_start"") AS CHAR) AS ""report_year"",(""year_end"" - ""year_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""dates"" AS ""d"" JOIN ""Product"" AS ""p"" USING (""product_id"") ORDER BY ""product_id"",""report_year"""
2,"SELECT ""temp"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE ""period_end"">='2018-01-01' AND ""period_start""<='2018-12-31' UNION SELECT ""product_id"",'2019',""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) FROM ""Sales"" WHERE ""period_end"">='2019-01-01' AND ""period_start""<='2019-12-31' UNION SELECT ""product_id"",'2020',""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) FROM ""Sales"" WHERE ""period_end"">='2020-01-01' AND ""period_start""<='2020-12-31') AS ""temp"" JOIN ""Product"" USING (""product_id"") ORDER BY ""temp"".""product_id"",""report_year"""
3,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
4,"WITH ""T1"" AS (SELECT '2018' AS ""report_year"" UNION SELECT '2019' AS ""report_year"" UNION SELECT '2020' AS ""report_year""), ""T2"" AS (SELECT ""product_id"",CASE WHEN ""period_start""<'2019-01-01' AND ""period_end"">'2018-12-31' THEN CAST('2019-01-01' AS DATE) - ""period_start""*""average_daily_sales"" WHEN ""period_start""<'2019-01-01' THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" ELSE 0 END AS ""amt_2018"",CASE WHEN ""period_start""<'2019-01-01' AND ""period_end"">'2019-12-31' THEN 365*""average_daily_sales"" WHEN ""period_start"">'2019-12-31' AND ""period_end"">'2019-12-31' THEN 0 WHEN ""period_end"">'2019-12-31' THEN CAST('2020-01-01' AS DATE) - ""period_start""*""average_daily_sales"" WHEN ""period_start""<'2019-01-01' AND ""period_end"">'2018-12-31' THEN ""period_end"" - CAST('2018-12-31' AS DATE)*""average_daily_sales"" WHEN ""period_end"">'2018-12-31' THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" ELSE 0 END AS ""amt_2019"",CASE WHEN ""period_end"">'2019-12-31' THEN ""period_end"" - CAST('2019-12-31' AS DATE)*""average_daily_sales"" ELSE 0 END AS ""amt_2020"" FROM ""Sales"") SELECT * FROM (SELECT CAST(""Product_1"".""product_id"" AS CHAR) AS ""product_id"",""Product_1"".""product_name"",""Product_1"".""report_year"",CASE WHEN ""Product_1"".""report_year""='2018' THEN ""amt_2018"" WHEN ""Product_1"".""report_year""='2019' THEN ""amt_2019"" ELSE ""amt_2020"" END AS ""total_amount"" FROM (SELECT * FROM ""Product"" JOIN ""T1"") AS ""Product_1"" JOIN ""T2"" WHERE ""Product_1"".""product_id""=""T2"".""product_id"") AS ""Product_2"" WHERE ""total_amount"">0 ORDER BY ""product_id"",""report_year"""
5,"WITH ""table2018"" AS (SELECT ""s"".""product_id"",""p"".""product_name"",'2018' AS ""report_year"",(LEAST(""s"".""period_end"", '2018-12-31') - GREATEST(""s"".""period_start"", '2018-01-01')+1)*""s"".""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" AS ""s"" LEFT JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" WHERE EXTRACT(YEAR FROM ""s"".""period_start"")<=2018 AND EXTRACT(YEAR FROM ""s"".""period_end"")>=2018), ""table2019"" AS (SELECT ""s"".""product_id"",""p"".""product_name"",'2019' AS ""report_year"",(LEAST(""s"".""period_end"", '2019-12-31') - GREATEST(""s"".""period_start"", '2019-01-01')+1)*""s"".""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" AS ""s"" LEFT JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" WHERE EXTRACT(YEAR FROM ""s"".""period_start"")<=2019 AND EXTRACT(YEAR FROM ""s"".""period_end"")>=2019), ""table2020"" AS (SELECT ""s"".""product_id"",""p"".""product_name"",'2020' AS ""report_year"",(LEAST(""s"".""period_end"", '2020-12-31') - GREATEST(""s"".""period_start"", '2020-01-01')+1)*""s"".""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" AS ""s"" LEFT JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" WHERE EXTRACT(YEAR FROM ""s"".""period_start"")<=2020 AND EXTRACT(YEAR FROM ""s"".""period_end"")>=2020) SELECT * FROM ""table2018"" UNION ALL (SELECT * FROM ""table2019"") UNION ALL (SELECT * FROM ""table2020"") ORDER BY ""product_id"",""report_year"""
6,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total"" AS ""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY 1,3"
7,"WITH RECURSIVE ""report_years"" AS (SELECT ""product_id"",EXTRACT(YEAR FROM ""period_start"") AS ""report_year"",""period_start"" AS ""interval_start"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" ELSE STR_TO_DATE(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-12-31'), '%Y-%m-%d') END AS ""interval_end"",""period_end"",""average_daily_sales"" FROM ""Sales"" UNION SELECT ""product_id"",""report_year""+1,STR_TO_DATE(CONCAT(""report_year""+1, '-01-01'), '%Y-%m-%d') AS ""interval_start"",CASE WHEN ""report_year""+1=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" ELSE STR_TO_DATE(CONCAT(""report_year""+1, '-12-31'), '%Y-%m-%d') END AS ""interval_end"",""period_end"",""average_daily_sales"" FROM ""report_years"" WHERE ""report_year""<EXTRACT(YEAR FROM ""period_end"")) SELECT ""r"".""product_id"",""p"".""product_name"",CAST(""r"".""report_year"" AS CHAR) AS ""report_year"",""average_daily_sales""*(""r"".""interval_end"" - ""r"".""interval_start""+1) AS ""total_amount"" FROM ""report_years"" AS ""r"" LEFT JOIN ""Product"" AS ""p"" ON ""r"".""product_id""=""p"".""product_id"" ORDER BY ""r"".""product_id"",""r"".""report_year"""
8,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
9,"SELECT ""product_id"",""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST(""period_end"", '2018-12-31') - ""period_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")='2018' OR EXTRACT(YEAR FROM ""period_end"")='2018' UNION SELECT ""product_id"",'2019' AS ""report_year"",(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<='2019' AND EXTRACT(YEAR FROM ""period_end"")>='2019' UNION SELECT ""product_id"",'2020' AS ""report_year"",(""period_end"" - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")='2020' OR EXTRACT(YEAR FROM ""period_end"")='2020') AS ""TEMP"" JOIN ""Product"" USING (""product_id"") ORDER BY 1,3"
10,"WITH RECURSIVE ""TEMP"" AS (SELECT MIN(EXTRACT(YEAR FROM ""PERIOD_START"")) AS ""YEAR"",MAX(EXTRACT(YEAR FROM ""PERIOD_END"")) AS ""MYEAR"" FROM ""SALES"" UNION SELECT ""YEAR""+1,""MYEAR"" FROM ""TEMP"" WHERE ""YEAR""<=""MYEAR""), ""TEMP2"" AS (SELECT ""S"".""PRODUCT_ID"",CASE WHEN EXTRACT(YEAR FROM ""S"".""PERIOD_START"")=""T"".""YEAR"" THEN ""S"".""PERIOD_START"" ELSE CONCAT(""T"".""YEAR"", '-01-01') END AS ""PERIOD_START"",CASE WHEN EXTRACT(YEAR FROM ""S"".""PERIOD_END"")=""T"".""YEAR"" THEN ""S"".""PERIOD_END"" ELSE CONCAT(""T"".""YEAR"", '-12-31') END AS ""PERIOD_END"",""S"".""AVERAGE_DAILY_SALES"" FROM (""SALES"" AS ""S"") JOIN ""TEMP"" AS ""T"" WHERE EXTRACT(YEAR FROM ""S"".""PERIOD_START"")<=""T"".""YEAR"" AND EXTRACT(YEAR FROM ""S"".""PERIOD_END"")>=""T"".""YEAR"") SELECT CAST(""P"".""PRODUCT_ID"" AS CHAR) AS ""PRODUCT_ID"",""P"".""PRODUCT_NAME"",CAST(EXTRACT(YEAR FROM ""T"".""PERIOD_START"") AS CHAR) AS ""REPORT_YEAR"",(""T"".""PERIOD_END"" - ""T"".""PERIOD_START""+1)*""T"".""AVERAGE_DAILY_SALES"" AS ""TOTAL_AMOUNT"" FROM (""PRODUCT"" AS ""P"") JOIN ""TEMP2"" AS ""T"" WHERE ""P"".""PRODUCT_ID""=""T"".""PRODUCT_ID"" ORDER BY 1,3"
11,"SELECT ""t"".""product_id"",""p"".""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""t"" JOIN ""Product"" AS ""p"" ON ""t"".""product_id""=""p"".""product_id"" ORDER BY 1,3"
12,"WITH RECURSIVE ""Cte"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",EXTRACT(YEAR FROM ""period_start"") AS ""report_year"" FROM ""Sales"" UNION SELECT ""Cte"".""product_id"",""Sales"".""period_start"",""Sales"".""period_end"",""Sales"".""average_daily_sales"",""Cte"".""report_year""+1 FROM ""Cte"" LEFT JOIN ""Sales"" ON ""Sales"".""product_id""=""Cte"".""product_id"" WHERE ""Cte"".""report_year""<EXTRACT(YEAR FROM ""Sales"".""period_end"")) SELECT ""Cte"".""product_id"",""product_name"",CAST(""report_year"" AS CHAR) AS ""report_year"",(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")=""report_year"" THEN DATE(CONCAT(""report_year"", '-12-31')) - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_end"")=""report_year"" THEN ""period_end"" - DATE(CONCAT(""report_year"", '-01-01'))+1 ELSE DATE(CONCAT(""report_year"", '-12-31')) - DATE(CONCAT(""report_year"", '-01-01'))+1 END)*""average_daily_sales"" AS ""total_amount"" FROM ""Cte"" LEFT JOIN ""Product"" ON ""Product"".""product_id""=""Cte"".""product_id"" ORDER BY 1,3"
13,"WITH ""tmp"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - ""period_start""+1) AS ""total_amount"" FROM ""sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 UNION SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(""period_end"" - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""sales"" WHERE EXTRACT(YEAR FROM ""period_end"")=2020) SELECT ""a"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""tmp"" AS ""a"" JOIN ""product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY 1,3"
14,"WITH ""eighteen"" AS (SELECT ""product_id"",""period_start"",""period_end"",""period_end"" - ""period_start""+1 AS ""total_days"",""average_daily_sales"" FROM (SELECT ""product_id"",""period_start"",CASE WHEN ""period_end"">'2018-12-31' THEN '2018-12-31' ELSE ""period_end"" END AS ""period_end"",""average_daily_sales"" FROM ""Sales"" WHERE ""period_start"" BETWEEN '2018-01-01' AND '2018-12-31') AS ""X""), ""nighteen"" AS (SELECT ""product_id"",""period_start"",""period_end"",""period_end"" - ""period_start""+1 AS ""total_days"",""average_daily_sales"" FROM (SELECT ""product_id"",CASE WHEN ""period_start""<'2019-01-01' THEN '2019-01-01' ELSE ""period_start"" END AS ""period_start"",CASE WHEN ""period_end"">'2019-12-31' THEN '2019-12-31' ELSE ""period_end"" END AS ""period_end"",""average_daily_sales"" FROM (SELECT * FROM ""Sales"" WHERE ""period_start""<'2019-12-31' AND ""period_end"">='2019-01-01') AS ""A"") AS ""AA""), ""twenty"" AS (SELECT ""product_id"",""period_start"",""period_end"",""period_end"" - ""period_start""+1 AS ""total_days"",""average_daily_sales"" FROM (SELECT ""product_id"",CASE WHEN ""period_start""<'2020-01-01' THEN '2020-01-01' ELSE ""period_start"" END AS ""period_start"",""period_end"",""average_daily_sales"" FROM (SELECT * FROM ""Sales"" WHERE ""period_start""<'2020-12-31' AND ""period_end"">='2020-01-01') AS ""B"") AS ""BB"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') AS ""report_year"",""c"".""total_days""*""average_daily_sales"" AS ""total_amount"" FROM (SELECT * FROM ""eighteen"" UNION ALL SELECT * FROM ""nighteen"" UNION ALL SELECT * FROM ""twenty"") AS ""c"" LEFT JOIN ""Product"" AS ""p"" ON ""c"".""product_id""=""p"".""product_id"" ORDER BY 1,3"
15,"WITH ""sales_by_year"" AS (SELECT ""product_id"",""average_daily_sales""*GREATEST(LEAST('2018-12-31', ""period_end"") - GREATEST(""period_start"", '2018-01-01')+1, 0) AS ""sales_2018"",""average_daily_sales""*GREATEST(LEAST('2019-12-31', ""period_end"") - GREATEST(""period_start"", '2019-01-01')+1, 0) AS ""sales_2019"",""average_daily_sales""*GREATEST(LEAST('2020-12-31', ""period_end"") - GREATEST(""period_start"", '2020-01-01')+1, 0) AS ""sales_2020"" FROM ""Sales""), ""sales_by_year_unpivot"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""sales_2018"" AS ""total_amount"" FROM ""sales_by_year"" UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""sales_2019"" AS ""total_amount"" FROM ""sales_by_year"" UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""sales_2020"" AS ""total_amount"" FROM ""sales_by_year"") SELECT CAST(""a"".""product_id"" AS CHAR) AS ""PRODUCT_ID"",""a"".""product_name"" AS ""PRODUCT_NAME"",""b"".""report_year"" AS ""REPORT_YEAR"",""b"".""total_amount"" AS ""TOTAL_AMOUNT"" FROM ""Product"" AS ""a"" JOIN ""sales_by_year_unpivot"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" WHERE ""b"".""total_amount""!=0 ORDER BY CAST(""a"".""product_id"" AS CHAR),""b"".""report_year"""
16,"WITH ""T1"" AS (SELECT '2018' AS ""report_year"" UNION SELECT '2019' AS ""report_year"" UNION SELECT '2020' AS ""report_year""), ""T2"" AS (SELECT ""product_id"",CASE WHEN ""period_start""<'2019-01-01' THEN (LEAST('2018-12-31', ""period_end"") - ""period_start""+1)*""average_daily_sales"" ELSE 0 END AS ""amt_2018"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")<='2019' AND EXTRACT(YEAR FROM ""period_end"")>='2019' THEN (LEAST('2019-12-31', ""period_end"") - GREATEST('2019-01-01', ""period_start"")+1)*""average_daily_sales"" ELSE 0 END AS ""amt_2019"",CASE WHEN ""period_end"">'2019-12-31' THEN (""period_end"" - GREATEST('2020-01-01', ""period_start"")+1)*""average_daily_sales"" ELSE 0 END AS ""amt_2020"" FROM ""Sales"") SELECT * FROM (SELECT CAST(""Product_1"".""product_id"" AS CHAR) AS ""product_id"",""Product_1"".""product_name"",""Product_1"".""report_year"",CASE WHEN ""Product_1"".""report_year""='2018' THEN ""amt_2018"" WHEN ""Product_1"".""report_year""='2019' THEN ""amt_2019"" ELSE ""amt_2020"" END AS ""total_amount"" FROM (SELECT * FROM ""Product"" JOIN ""T1"") AS ""Product_1"" JOIN ""T2"" WHERE ""Product_1"".""product_id""=""T2"".""product_id"") AS ""Product_2"" WHERE ""total_amount"">0 ORDER BY ""product_id"",""report_year"""
17,"WITH ""cte"" AS (SELECT ""product_id"",'2018' AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2018 THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")>2018 THEN CAST('2019-01-01' AS DATE) - ""period_start""*""average_daily_sales"" END AS ""year_sale"" FROM ""sales"" UNION SELECT ""product_id"",'2019' AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")<2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN (""period_end"" - CAST('2019-01-01' AS DATE)+1)*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")<2019 AND EXTRACT(YEAR FROM ""period_end"")>2019 THEN (CAST('2020-01-01' AS DATE) - CAST('2019-01-01' AS DATE))*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")>2019 THEN CAST('2020-01-01' AS DATE) - ""period_start""*""average_daily_sales"" END AS ""year_sale"" FROM ""sales"" UNION SELECT ""product_id"",'2020' AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")<2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN (""period_end"" - CAST('2020-01-01' AS DATE)+1)*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")<2020 AND EXTRACT(YEAR FROM ""period_end"")>2020 THEN (CAST('2021-01-01' AS DATE) - CAST('2020-01-01' AS DATE))*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")=2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")=2020 AND EXTRACT(YEAR FROM ""period_end"")>2020 THEN CAST('2021-01-01' AS DATE) - ""period_start""*""average_daily_sales"" END AS ""year_sale"" FROM ""sales"") SELECT ""cte"".""product_id"",""product_name"",""report_year"",""year_sale"" AS ""total_amount"" FROM ""cte"" JOIN ""product"" ON ""product"".""product_id""=""cte"".""product_id"" WHERE ""year_sale"" IS NOT NULL GROUP BY 1,3 ORDER BY 1,3"
18,"WITH ""tbY"" AS (SELECT '2018' AS ""report_year"",'2018-01-01' AS ""start"",'2018-12-31' AS ""end"" UNION ALL SELECT '2019','2019-01-01','2019-12-31' UNION ALL SELECT '2020','2020-01-01','2020-12-31'), ""tbS"" AS (SELECT ""s"".*,""tbY"".""report_year"",1+CASE WHEN ""s"".""period_end""<""tbY"".""end"" THEN ""s"".""period_end"" ELSE ""tbY"".""end"" END - CASE WHEN ""s"".""period_start"">""tbY"".""start"" THEN ""s"".""period_start"" ELSE ""tbY"".""start"" END AS ""days"" FROM (""Sales"" AS ""s"") JOIN ""tbY"" WHERE ""s"".""period_end"">=""tbY"".""start"" AND ""s"".""period_start""<=""tbY"".""end"") SELECT ""tbS"".""product_id"",""p"".""product_name"",""tbS"".""report_year"",""tbS"".""average_daily_sales""*""days"" AS ""total_amount"" FROM ""tbS"" JOIN ""Product"" AS ""p"" ON ""tbS"".""product_id""=""p"".""product_id"" ORDER BY ""product_id"",""tbs"".""report_year"""
19,"WITH ""CTE"" AS (SELECT ""product_id"",CASE WHEN (""period_start"" BETWEEN '2018-01-01' AND '2018-12-31') AND (""period_end"" BETWEEN '2018-01-01' AND '2018-12-31') THEN ""period_end"" - ""period_start""+1 WHEN ""period_start"" BETWEEN '2018-01-01' AND '2018-12-31' AND ""period_end"">'2018-12-31' THEN CAST('2018-12-31' AS DATE) - ""period_start""+1 WHEN ""period_start""<'2018-01-01' AND (""period_end"" BETWEEN '2018-01-01' AND '2018-12-31') THEN ""period_end"" - CAST('2018-01-01' AS DATE)+1 WHEN ""period_start""<'2018-01-01' AND ""period_end"">'2018-12-31' THEN 365 ELSE 0 END AS ""year_2018"",CASE WHEN (""period_start"" BETWEEN '2019-01-01' AND '2019-12-31') AND (""period_end"" BETWEEN '2019-01-01' AND '2019-12-31') THEN ""period_end"" - ""period_start""+1 WHEN ""period_start"" BETWEEN '2019-01-01' AND '2019-12-31' AND ""period_end"">'2019-12-31' THEN CAST('2019-12-31' AS DATE) - ""period_start""+1 WHEN ""period_start""<'2019-01-01' AND (""period_end"" BETWEEN '2019-01-01' AND '2019-12-31') THEN ""period_end"" - CAST('2019-01-01' AS DATE)+1 WHEN ""period_start""<'2019-01-01' AND ""period_end"">'2019-12-31' THEN 365 ELSE 0 END AS ""year_2019"",CASE WHEN (""period_start"" BETWEEN '2020-01-01' AND '2020-12-31') AND (""period_end"" BETWEEN '2020-01-01' AND '2020-12-31') THEN ""period_end"" - ""period_start""+1 WHEN ""period_start"" BETWEEN '2020-01-01' AND '2020-12-31' AND ""period_end"">'2020-12-31' THEN CAST('2020-12-31' AS DATE) - ""period_start""+1 WHEN ""period_start""<'2020-01-01' AND (""period_end"" BETWEEN '2020-01-01' AND '2020-12-31') THEN ""period_end"" - CAST('2020-01-01' AS DATE)+1 WHEN ""period_start""<'2020-01-01' AND ""period_end"">'2020-12-31' THEN 365 ELSE 0 END AS ""year_2020"",""average_daily_sales"" FROM ""Sales""), ""CTE2"" AS (SELECT ""d1"".""product_id"",""d2"".""product_name"",""average_daily_sales""*""year_2018"" AS ""total_amount_2018"",""average_daily_sales""*""year_2019"" AS ""total_amount_2019"",""average_daily_sales""*""year_2020"" AS ""total_amount_2020"" FROM ""CTE"" AS ""d1"" JOIN ""Product"" AS ""d2"" ON ""d1"".""product_id""=""d2"".""product_id"") SELECT ""product_id"",""product_name"",'2018' AS ""report_year"",""total_amount_2018"" AS ""total_amount"" FROM ""CTE2"" WHERE ""total_amount_2018""!=0 UNION SELECT ""product_id"",""product_name"",'2019' AS ""report_year"",""total_amount_2019"" FROM ""CTE2"" WHERE ""total_amount_2019""!=0 UNION SELECT ""product_id"",""product_name"",'2020' AS ""report_year"",""total_amount_2020"" FROM ""CTE2"" WHERE ""total_amount_2020""!=0 ORDER BY 1,3"
20,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
21,"WITH RECURSIVE ""CTE"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""Sales"" UNION ALL SELECT ""date"" + INTERVAL '1 DAY' FROM ""CTE"" WHERE ""date""<=ALL (SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""e"".""date"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""CTE"" AS ""e"" ON ""s"".""period_start""<=""e"".""date"" AND ""s"".""period_end"">=""e"".""date"" GROUP BY 1,2,3 ORDER BY 1,3"
22,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
23,"SELECT ""a"".""product_id"",""p"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST('2018-12-31', ""period_end"") - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",(LEAST('2019-12-31', ""period_end"") - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",(LEAST('2020-12-31', ""period_end"") - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""a"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
24,"WITH ""tmp"" AS (SELECT *,CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 THEN ""period_start"" END AS ""start_18"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")>2018 THEN '2018-12-31' ELSE ""period_end"" END AS ""end_18"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")<2019 THEN '2019-01-01' WHEN EXTRACT(YEAR FROM ""period_start"")=2019 THEN ""period_start"" END AS ""start_19"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" WHEN EXTRACT(YEAR FROM ""period_end"")>2019 THEN '2019-12-31' END AS ""end_19"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")<2020 THEN '2020-01-01' WHEN EXTRACT(YEAR FROM ""period_start"")=2020 THEN ""period_start"" END AS ""start_20"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=2020 THEN ""period_end"" END AS ""end_20"" FROM ""sales"" ORDER BY 1), ""tmp2"" AS (SELECT ""a"".""product_id"",""product_name"",""period_start"",""period_end"",""average_daily_sales"",COALESCE(""end_18"" - ""start_18""+1, 0) AS ""days_18"",COALESCE(""end_19"" - ""start_19""+1, 0) AS ""days_19"",COALESCE(""end_20"" - ""start_20""+1, 0) AS ""days_20"" FROM ""tmp"" AS ""a"" JOIN ""product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY 1) SELECT ""product_id"",""product_name"",'2018' AS ""report_year"",""average_daily_sales""*""days_18"" AS ""total_amount"" FROM ""tmp2"" WHERE ""days_18"">0 UNION SELECT ""product_id"",""product_name"",'2019' AS ""report_year"",""average_daily_sales""*""days_19"" AS ""total_amount"" FROM ""tmp2"" WHERE ""days_19"">0 UNION SELECT ""product_id"",""product_name"",'2020' AS ""report_year"",""average_daily_sales""*""days_20"" AS ""total_amount"" FROM ""tmp2"" WHERE ""days_20"">0 ORDER BY 1,3"
25,"WITH RECURSIVE ""time_period"" AS (SELECT *,CAST(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-01-01') AS DATE) AS ""lower_bound"",CAST(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-12-31') AS DATE) AS ""upper_bound"" FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",CAST(CONCAT(EXTRACT(YEAR FROM ""lower_bound"")+1, '-01-01') AS DATE) AS ""lower_bound"",CAST(CONCAT(EXTRACT(YEAR FROM ""upper_bound"")+1, '-12-31') AS DATE) AS ""upper_bound"" FROM ""time_period"" WHERE EXTRACT(YEAR FROM ""upper_bound"")<EXTRACT(YEAR FROM ""period_end"")) SELECT ""combined"".""product_id"",""product_name"",CAST(EXTRACT(YEAR FROM ""start_date"") AS CHAR) AS ""report_year"",(""end_date"" - ""start_date""+1)*""average_daily_sales"" AS ""total_amount"" FROM (SELECT ""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""lower_bound"") THEN ""period_start"" ELSE ""lower_bound"" END AS ""start_date"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=EXTRACT(YEAR FROM ""upper_bound"") THEN ""period_end"" ELSE ""upper_bound"" END AS ""end_date"",""average_daily_sales"" FROM ""time_period"") AS ""combined"" LEFT JOIN ""product"" ON ""combined"".""product_id""=""product"".""product_id"" ORDER BY 1,3"
26,"WITH RECURSIVE ""t"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t"" WHERE ""period_start""<""period_end"") SELECT ""t"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""t"" JOIN ""Product"" ON ""t"".""product_id""=""product"".""product_id"" GROUP BY ""product_id"",""report_year"" ORDER BY ""product_id"",""product_id"""
27,"WITH RECURSIVE ""daily_sales"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""period_start"" AS ""dur"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""dur"" + INTERVAL '1 DAY' AS ""dur"" FROM ""daily_sales"" WHERE ""dur""<""period_end"") SELECT ""ds"".""product_id"" AS ""product_id"",(SELECT ""p"".""product_name"" FROM ""Product"" AS ""p"" WHERE ""p"".""product_id""=""ds"".""product_id"") AS ""product_name"",CAST(EXTRACT(YEAR FROM ""ds"".""dur"") AS CHAR(4)) AS ""report_year"",SUM(""ds"".""average_daily_sales"") AS ""total_amount"" FROM ""daily_sales"" AS ""ds"" GROUP BY 1,3 ORDER BY 1,3"
28,"WITH ""temp"" AS (SELECT '2018-01-01' AS ""start_date"",'2018-12-31' AS ""end_date"" UNION ALL SELECT '2019-01-01' AS ""start_date"",'2019-12-31' AS ""end_date"" UNION ALL SELECT '2020-01-01' AS ""start_date"",'2020-12-31' AS ""end_date"") SELECT * FROM (SELECT ""sales"".""product_id"",""product_name"",CAST(EXTRACT(YEAR FROM ""start_date"") AS CHAR) AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""start_date"") AND EXTRACT(YEAR FROM ""period_end"")=EXTRACT(YEAR FROM ""end_date"") THEN ""period_end"" + INTERVAL '1 DAY' - ""period_start""*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""start_date"") AND EXTRACT(YEAR FROM ""period_end"")>EXTRACT(YEAR FROM ""end_date"") THEN ""end_date"" + INTERVAL '1 DAY' - ""period_start""*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")<EXTRACT(YEAR FROM ""start_date"") AND EXTRACT(YEAR FROM ""period_end"")>EXTRACT(YEAR FROM ""end_date"") THEN ""end_date"" + INTERVAL '1 DAY' - ""start_date""*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")<EXTRACT(YEAR FROM ""start_date"") AND EXTRACT(YEAR FROM ""period_end"")=EXTRACT(YEAR FROM ""end_date"") THEN ""period_end"" + INTERVAL '1 DAY' - ""start_date""*""average_daily_sales"" END AS ""total_amount"" FROM (""sales"" JOIN ""product"" ON ""sales"".""product_id""=""product"".""product_id"") JOIN ""temp"") AS ""annual_sales"" WHERE ""total_amount"" IS NOT NULL ORDER BY ""product_id"",""report_year"""
29,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
30,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
31,"WITH ""a"" AS (SELECT *,CASE WHEN LEAST(CAST('2018-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2018-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2018-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2018-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y18"",CASE WHEN LEAST(CAST('2019-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2019-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2019-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2019-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y19"",CASE WHEN LEAST(CAST('2020-12-31' AS DATE) - ""period_start""+1, 366)-GREATEST(CAST('2020-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2020-12-31' AS DATE) - ""period_start""+1, 366)-GREATEST(CAST('2020-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y20"" FROM ""Sales""), ""uni"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""y18"" AS ""total_amount"" FROM ""a"" UNION SELECT ""product_id"",'2019' AS ""report_year"",""y19"" AS ""total_amount"" FROM ""a"" UNION SELECT ""product_id"",'2020' AS ""report_year"",""y20"" AS ""total_amount"" FROM ""a"") SELECT ""u"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""uni"" AS ""u"" JOIN ""Product"" AS ""p"" ON ""u"".""product_id""=""p"".""product_id"" WHERE ""total_amount""!=0 ORDER BY ""product_id"",""report_year"""
32,"WITH RECURSIVE ""t1"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t1"" WHERE ""period_start""<""period_end"") SELECT ""t1"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""t1"" JOIN ""product"" ON ""t1"".""product_id""=""product"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
33,"WITH RECURSIVE ""sales_daily"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""period_start"" AS ""dur"" FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""dur"" + INTERVAL '1 DAY' AS ""dur"" FROM ""sales_daily"" WHERE ""dur""<""period_end"") SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""s"".""dur"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM ""sales_daily"" AS ""s"" JOIN ""product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" WHERE LEFT(""s"".""dur"", 4) BETWEEN 2018 AND 2020 GROUP BY ""s"".""product_id"",""report_year"" ORDER BY ""s"".""product_id"",""report_year"""
34,"WITH ""a"" AS (SELECT *,CASE WHEN LEAST(CAST('2018-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2018-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2018-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2018-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y18"",CASE WHEN LEAST(CAST('2019-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2019-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2019-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2019-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y19"",CASE WHEN LEAST(CAST('2020-12-31' AS DATE) - ""period_start""+1, 366)-GREATEST(CAST('2020-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2020-12-31' AS DATE) - ""period_start""+1, 366)-GREATEST(CAST('2020-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y20"" FROM ""Sales""), ""uni"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""y18"" AS ""total_amount"" FROM ""a"" UNION SELECT ""product_id"",'2019' AS ""report_year"",""y19"" AS ""total_amount"" FROM ""a"" UNION SELECT ""product_id"",'2020' AS ""report_year"",""y20"" AS ""total_amount"" FROM ""a"") SELECT ""u"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""uni"" AS ""u"" JOIN ""Product"" AS ""p"" ON ""u"".""product_id""=""p"".""product_id"" WHERE ""total_amount""!=0 ORDER BY ""product_id"",""report_year"""
35,"WITH RECURSIVE ""cte"" AS (SELECT *,CAST(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-01-01') AS DATE) AS ""stt"",CAST(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-12-31') AS DATE) AS ""nd"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",CAST(CONCAT(EXTRACT(YEAR FROM ""stt"")+1, '-01-01') AS DATE) AS ""stt"",CAST(CONCAT(EXTRACT(YEAR FROM ""nd"")+1, '-12-31') AS DATE) AS ""nd"" FROM ""cte"" WHERE EXTRACT(YEAR FROM ""stt"")<EXTRACT(YEAR FROM ""period_end"") AND EXTRACT(YEAR FROM ""nd"")<EXTRACT(YEAR FROM ""period_end"")) SELECT ""sub"".""product_id"",""product_name"",LEFT(""start_dt"", 4) AS ""report_year"",SUM((""end_dt"" - ""start_dt""+1)*""average_daily_sales"") AS ""total_amount"" FROM ""Product"" AS ""p"" JOIN (SELECT ""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""stt"") THEN ""period_start"" ELSE ""stt"" END AS ""start_dt"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=EXTRACT(YEAR FROM ""nd"") THEN ""period_end"" ELSE ""nd"" END AS ""end_dt"",""average_daily_sales"" FROM ""cte"") AS ""sub"" ON ""p"".""product_id""=""sub"".""product_id"" GROUP BY ""sub"".""product_id"",""product_name"",LEFT(""start_dt"", 4) ORDER BY ""product_id"",""report_year"""
36,"SELECT ""a"".""product_id"",""p"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST('2018-12-31', ""period_end"") - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",(LEAST('2019-12-31', ""period_end"") - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",(LEAST('2020-12-31', ""period_end"") - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""a"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
37,"WITH RECURSIVE ""cte"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""cte"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""cte"" JOIN ""product"" ON ""cte"".""product_id""=""product"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
38,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2020 AND EXTRACT(YEAR FROM ""period_end"")>=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
39,"WITH ""tem"" AS (SELECT *,CASE WHEN ""period_start"">='2018-01-01' AND ""period_end""<='2018-12-31' THEN (""period_end"" - ""period_start""+1) WHEN ""period_start"" BETWEEN '2018-01-01' AND '2018-12-31' AND ""period_end"">='2019-01-01' THEN (CAST('2018-12-31' AS DATE) - ""period_start""+1) ELSE 0 END AS ""days_2018"",CASE WHEN ""period_start""<='2018-12-31' AND ""period_end"" BETWEEN '2019-01-01' AND '2019-12-31' THEN (""period_end"" - CAST('2019-01-01' AS DATE)+1) WHEN ""period_start""<='2018-12-31' AND ""period_end"">'2019-12-31' THEN (CAST('2019-12-31' AS DATE) - CAST('2019-01-01' AS DATE)+1) WHEN ""period_start"">='2019-01-01' AND ""period_end"" BETWEEN '2019-01-01' AND '2019-12-31' THEN (""period_end"" - ""period_start""+1) WHEN ""period_start"">='2019-01-01' AND ""period_end"">'2019-12-31' THEN (CAST('2019-12-31' AS DATE) - ""period_start""+1) ELSE 0 END AS ""days_2019"",CASE WHEN ""period_start""<='2019-12-31' AND ""period_end"" BETWEEN '2020-01-01' AND '2020-12-31' THEN (""period_end"" - CAST('2020-01-01' AS DATE)+1) WHEN ""period_start"">='2020-01-01' AND ""period_end""<='2020-12-31' THEN (""period_end"" - ""period_start""+1) ELSE 0 END AS ""days_2020"" FROM ""sales""), ""tem1"" AS (SELECT ""a"".*,""b"".""product_name"" FROM ""tem"" AS ""a"" LEFT JOIN ""product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"") SELECT ""product_id"",""product_name"",'2018' AS ""report_year"",""days_2018""*""average_daily_sales"" AS ""total_amount"" FROM ""tem1"" WHERE ""days_2018"">0 UNION (SELECT ""product_id"",""product_name"",'2019' AS ""report_year"",""days_2019""*""average_daily_sales"" AS ""total_amount"" FROM ""tem1"" WHERE ""days_2019"">0) UNION (SELECT ""product_id"",""product_name"",'2020' AS ""report_year"",""days_2020""*""average_daily_sales"" AS ""total_amount"" FROM ""tem1"" WHERE ""days_2020"">0) ORDER BY ""product_id"",""report_year"""
40,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2020 AND EXTRACT(YEAR FROM ""period_end"")>=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
41,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
42,"WITH ""c1"" AS (SELECT ""s"".""product_id"",""p"".""product_name"",(LEAST('2018-12-31', ""s"".""period_end"") - GREATEST('2018-01-01', ""s"".""period_start"")+1)*""average_daily_sales"" AS ""sales_18"",(LEAST('2019-12-31', ""s"".""period_end"") - GREATEST('2019-01-01', ""s"".""period_start"")+1)*""average_daily_sales"" AS ""sales_19"",(LEAST('2020-12-31', ""s"".""period_end"") - GREATEST('2020-01-01', ""s"".""period_start"")+1)*""average_daily_sales"" AS ""sales_20"" FROM ""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") SELECT ""product_id"",""product_name"",'2018' AS ""report_year"",""sales_18"" AS ""total_amount"" FROM ""c1"" WHERE ""sales_18"">0 UNION ALL SELECT ""product_id"",""product_name"",'2019' AS ""report_year"",""sales_19"" AS ""total_amount"" FROM ""c1"" WHERE ""sales_19"">0 UNION ALL SELECT ""product_id"",""product_name"",'2020' AS ""report_year"",""sales_20"" AS ""total_amount"" FROM ""c1"" WHERE ""sales_20"">0 ORDER BY 1,3"
43,"WITH ""cte"" AS (SELECT ""product_id"",'2018' AS ""report_year"",((CASE WHEN ""period_end"">='2018-12-31' THEN '2018-12-31' ELSE ""period_end"" END) - (CASE WHEN ""period_start""<='2018-01-01' THEN '2018-01-01' ELSE ""period_start"" END)+1)*""average_daily_sales"" AS ""total_sales"" FROM ""sales"" WHERE '2018' BETWEEN EXTRACT(YEAR FROM ""period_start"") AND EXTRACT(YEAR FROM ""period_end"") UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",((CASE WHEN ""period_end"">='2019-12-31' THEN '2019-12-31' ELSE ""period_end"" END) - (CASE WHEN ""period_start""<='2019-01-01' THEN '2019-01-01' ELSE ""period_start"" END)+1)*""average_daily_sales"" AS ""total_sales"" FROM ""sales"" WHERE '2019' BETWEEN EXTRACT(YEAR FROM ""period_start"") AND EXTRACT(YEAR FROM ""period_end"") UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",((CASE WHEN ""period_end"">='2020-12-31' THEN '2020-12-31' ELSE ""period_end"" END) - (CASE WHEN ""period_start""<='2020-01-01' THEN '2020-01-01' ELSE ""period_start"" END)+1)*""average_daily_sales"" AS ""total_sales"" FROM ""sales"" WHERE '2020' BETWEEN EXTRACT(YEAR FROM ""period_start"") AND EXTRACT(YEAR FROM ""period_end"")) SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_sales"" AS ""total_amount"" FROM ""cte"" AS ""a"" JOIN ""product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY 1,3"
44,"WITH ""t1"" AS (SELECT ""p"".""product_id"",""p"".""product_name"",'2018' AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""s"".""period_start"")='2018' AND EXTRACT(YEAR FROM ""s"".""period_end"")='2018' THEN ""s"".""period_end"" - ""s"".""period_start""+1 WHEN EXTRACT(YEAR FROM ""s"".""period_start"")='2018' AND EXTRACT(YEAR FROM ""s"".""period_end"")>'2018' THEN CAST('2018-12-31' AS DATE) - ""s"".""period_start""+1 ELSE 0 END AS ""year_days"" FROM ""product"" AS ""p"" JOIN ""sales"" AS ""s"" USING (""product_id"") GROUP BY 1,2 UNION SELECT ""p"".""product_id"",""p"".""product_name"",'2019' AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""s"".""period_start"")='2019' AND EXTRACT(YEAR FROM ""s"".""period_end"")='2019' THEN ""s"".""period_end"" - ""s"".""period_start""+1 WHEN EXTRACT(YEAR FROM ""s"".""period_start"")='2019' AND EXTRACT(YEAR FROM ""s"".""period_end"")>'2019' THEN CAST('2019-12-31' AS DATE) - ""s"".""period_start""+1 WHEN EXTRACT(YEAR FROM ""s"".""period_start"")='2018' AND EXTRACT(YEAR FROM ""s"".""period_end"")='2019' THEN ""s"".""period_end"" - CAST('2019-01-01' AS DATE)+1 WHEN EXTRACT(YEAR FROM ""s"".""period_start"")='2018' AND EXTRACT(YEAR FROM ""s"".""period_end"")='2020' THEN 365 ELSE 0 END AS ""year_days"" FROM ""product"" AS ""p"" JOIN ""sales"" AS ""s"" USING (""product_id"") GROUP BY 1,2 UNION SELECT ""p"".""product_id"",""p"".""product_name"",'2020' AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""s"".""period_start"")='2020' AND EXTRACT(YEAR FROM ""s"".""period_end"")='2020' THEN ""s"".""period_end"" - ""s"".""period_start""+1 WHEN EXTRACT(YEAR FROM ""s"".""period_start"")<'2020' AND EXTRACT(YEAR FROM ""s"".""period_end"")='2020' THEN ""s"".""period_end"" - CAST('2020-01-01' AS DATE)+1 ELSE 0 END AS ""year_days"" FROM ""product"" AS ""p"" JOIN ""sales"" AS ""s"" USING (""product_id"") GROUP BY 1,2) SELECT CONVERT(""t"".""product_id"", CHAR) AS ""product_id"",""t"".""product_name"",""t"".""report_year"",""t"".""year_days""*""s"".""average_daily_sales"" AS ""total_amount"" FROM ""t1"" AS ""t"" JOIN ""sales"" AS ""s"" USING (""product_id"") WHERE ""t"".""year_days"">0 ORDER BY 1,3"
45,"ERROR: mysql parse error: line 1 column 344 near ""NCHAR) as report_year, sum(average_daily_sales) as total_amount from cte join Product p ON cte.product_id = p.product_id where cur_date between '2018-01-01' AND '2020-12-31' group by cte.product_id, year(cur_date) order by 1, 3 "" "
46,"WITH RECURSIVE ""tmp"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"" FROM ""sales"" UNION SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""tmp"" WHERE ""period_start""<""period_end"") SELECT ""a"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",LEFT(""period_start"", 4) AS ""report_year"",(""average_daily_sales""*COUNT(1)) AS ""total_amount"" FROM ""tmp"" GROUP BY ""product_id"",""report_year"") AS ""a"" JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""product_id"",""report_year"""
47,"SELECT ""u"".""product_id"" AS ""product_id"",""p"".""product_name"" AS ""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST(""period_end"", '2018-12-31') - ""period_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" WHERE ""period_start""<='2018-12-31' UNION SELECT ""product_id"",'2019' AS ""report_year"",(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" WHERE ""period_start""<='2019-12-31' UNION SELECT ""product_id"",'2020' AS ""report_year"",(""period_end"" - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"") AS ""u"" JOIN ""product"" AS ""p"" ON ""u"".""product_id""=""p"".""product_id"" WHERE ""total_amount"">0 ORDER BY 1,3"
48,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
49,"WITH RECURSIVE ""reports"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",EXTRACT(YEAR FROM ""period_start"") AS ""report_year"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""report_year""+1 FROM ""reports"" WHERE EXTRACT(YEAR FROM ""period_end"")>""report_year"") SELECT ""report"".""product_id"",""prod"".""product_name"",CAST(""report"".""report_year"" AS CHAR(10)) AS ""report_year"",((CASE WHEN EXTRACT(YEAR FROM ""period_start"")=""report_year"" AND EXTRACT(YEAR FROM ""period_end"")=""report_year"" THEN ""period_end"" - ""period_start"" WHEN EXTRACT(YEAR FROM ""period_start"")=""report_year"" AND EXTRACT(YEAR FROM ""period_end"")>""report_year"" THEN CONCAT(""report_year"", '-12-31') - ""period_start"" WHEN EXTRACT(YEAR FROM ""period_start"")<""report_year"" AND EXTRACT(YEAR FROM ""period_end"")>""report_year"" THEN CONCAT(""report_year"", '-12-31') - CONCAT(""report_year"", '-01-01') ELSE ""period_end"" - CONCAT(""report_year"", '-01-01') END)+1)*""average_daily_sales"" AS ""total_amount"" FROM ""reports"" AS ""report"" JOIN ""Product"" AS ""prod"" ON ""report"".""product_id""=""prod"".""product_id"" ORDER BY ""product_id"",""report_year"""
50,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
51,"WITH RECURSIVE ""caltable"" AS (SELECT MIN(""period_start"") AS ""day"" FROM ""sales"" UNION ALL SELECT ""day"" + INTERVAL '1 DAY' AS ""day"" FROM ""caltable"" WHERE ""day""<(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""day"", 'YYYY') AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""caltable"" AS ""c"" JOIN ""sales"" AS ""s"" ON ""c"".""day"" BETWEEN ""s"".""period_start"" AND ""s"".""period_end"") JOIN ""product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" GROUP BY ""s"".""product_id"",EXTRACT(YEAR FROM ""c"".""day"") ORDER BY ""s"".""product_id"",""report_year"""
52,"WITH RECURSIVE ""report_years"" AS (SELECT ""product_id"",EXTRACT(YEAR FROM ""period_start"") AS ""report_year"",""period_start"" AS ""interval_start"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" ELSE STR_TO_DATE(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-12-31'), '%Y-%m-%d') END AS ""interval_end"",""period_end"",""average_daily_sales"" FROM ""Sales"" UNION SELECT ""product_id"",""report_year""+1,STR_TO_DATE(CONCAT(""report_year""+1, '-01-01'), '%Y-%m-%d') AS ""interval_start"",CASE WHEN ""report_year""+1=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" ELSE STR_TO_DATE(CONCAT(""report_year""+1, '-12-31'), '%Y-%m-%d') END AS ""interval_end"",""period_end"",""average_daily_sales"" FROM ""report_years"" WHERE ""report_year""<EXTRACT(YEAR FROM ""period_end"")) SELECT ""r"".""product_id"",""p"".""product_name"",CAST(""r"".""report_year"" AS CHAR) AS ""report_year"",""average_daily_sales""*(""r"".""interval_end"" - ""r"".""interval_start""+1) AS ""total_amount"" FROM ""report_years"" AS ""r"" LEFT JOIN ""Product"" AS ""p"" ON ""r"".""product_id""=""p"".""product_id"" ORDER BY ""r"".""product_id"",""r"".""report_year"""
53,"WITH RECURSIVE ""yearin"" AS (SELECT ""product_id"",EXTRACT(YEAR FROM ""period_start"") AS ""yr"",""period_end"" FROM ""sales"" AS ""s"" UNION ALL SELECT ""product_id"",""yr""+1,""period_end"" FROM ""yearin"" WHERE ""yr""<EXTRACT(YEAR FROM ""period_end"")) SELECT CAST(""p"".""product_id"" AS CHAR) AS ""product_id"",""product_name"",CAST(""yr"" AS CHAR) AS ""report_year"",(CASE WHEN ""yr""=EXTRACT(YEAR FROM ""period_start"") AND ""yr""=EXTRACT(YEAR FROM ""s"".""period_end"") THEN (""s"".""period_end"" - ""period_start""+1)*""average_daily_sales"" WHEN ""yr""=EXTRACT(YEAR FROM ""period_start"") AND ""yr""!=EXTRACT(YEAR FROM ""s"".""period_end"") THEN (CONCAT(""yr"", '-12-31') - ""period_start""+1)*""average_daily_sales"" WHEN ""yr""=EXTRACT(YEAR FROM ""s"".""period_end"") AND ""yr""!=EXTRACT(YEAR FROM ""period_start"") THEN (""s"".""period_end"" - CONCAT(""yr"", '-01-01')+1)*""average_daily_sales"" ELSE DAYOFYEAR(CONCAT(""yr"", '-12-31'))*""average_daily_sales"" END) AS ""total_amount"" FROM (""product"" AS ""p"" JOIN ""sales"" AS ""s"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""yearin"" AS ""y"" ON ""y"".""product_id""=""s"".""product_id"" ORDER BY ""product_id"",""report_year"""
54,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""period_start"" AS ""newDt"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""newDt"" + INTERVAL '1 DAY' AS ""newDt"" FROM ""cte"" WHERE ""newDt""<""period_end"") SELECT CONCAT(""P"".""product_id"", '') AS ""product_id"",""P"".""product_name"",CONCAT(EXTRACT(YEAR FROM ""C"".""newDt""), '') AS ""report_year"",SUM(""C"".""average_daily_sales"") AS ""total_amount"" FROM ""Product"" AS ""P"" JOIN ""cte"" AS ""C"" ON ""P"".""product_id""=""C"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
55,"WITH ""d"" AS (SELECT '2018' AS ""yr"",'2018-01-01' AS ""sy"",'2018-12-31' AS ""ey"" UNION ALL SELECT '2019' AS ""yr"",'2019-01-01' AS ""sy"",'2019-12-31' AS ""ey"" UNION ALL SELECT '2020' AS ""yr"",'2020-01-01' AS ""sy"",'2020-12-31' AS ""ey""), ""s"" AS (SELECT ""product_id"",""yr"",GREATEST(""sy"", ""s"".""period_start"") AS ""ps"",LEAST(""ey"", ""s"".""period_end"") AS ""pe"",""average_daily_sales"" AS ""ads"" FROM ""Sales"" AS ""s"" JOIN ""d"" ON ""s"".""period_start""<=""d"".""ey"" AND ""s"".""period_end"">=""d"".""sy"") SELECT ""s"".""product_id"",""p"".""product_name"",""s"".""yr"" AS ""report_year"",(""ads"")*(""pe"" - ""ps""+1) AS ""total_amount"" FROM ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" ORDER BY ""s"".""product_id"",""s"".""yr"""
56,"WITH RECURSIVE ""report_years"" AS (SELECT ""product_id"",EXTRACT(YEAR FROM ""period_start"") AS ""report_year"",""period_start"" AS ""interval_start"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" ELSE STR_TO_DATE(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-12-31'), '%Y-%m-%d') END AS ""interval_end"",""period_end"",""average_daily_sales"" FROM ""Sales"" UNION SELECT ""product_id"",""report_year""+1,STR_TO_DATE(CONCAT(""report_year""+1, '-01-01'), '%Y-%m-%d') AS ""interval_start"",CASE WHEN ""report_year""+1=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" ELSE STR_TO_DATE(CONCAT(""report_year""+1, '-12-31'), '%Y-%m-%d') END AS ""interval_end"",""period_end"",""average_daily_sales"" FROM ""report_years"" WHERE ""report_year""<EXTRACT(YEAR FROM ""period_end"")) SELECT ""r"".""product_id"",""p"".""product_name"",CAST(""r"".""report_year"" AS CHAR) AS ""report_year"",""average_daily_sales""*(""r"".""interval_end"" - ""r"".""interval_start""+1) AS ""total_amount"" FROM ""report_years"" AS ""r"" LEFT JOIN ""Product"" AS ""p"" ON ""r"".""product_id""=""p"".""product_id"" ORDER BY ""r"".""product_id"",""r"".""report_year"""
57,"WITH ""total_sales"" AS (SELECT ""s"".""product_id"",""p"".""product_name"",((CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2018 THEN ""period_end"" - ""period_start"" WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")>2018 THEN CAST('2018-12-31' AS DATE) - ""period_start"" END)+1)*""average_daily_sales"" AS ""sales_in_2018"",((CASE WHEN EXTRACT(YEAR FROM ""period_start"")<2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" - CAST('2019-01-01' AS DATE) WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" - ""period_start"" WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")>2019 THEN CAST('2019-12-31' AS DATE) - ""period_start"" WHEN EXTRACT(YEAR FROM ""period_start"")<2019 AND EXTRACT(YEAR FROM ""period_end"")>2019 THEN CAST('2019-12-31' AS DATE) - CAST('2019-01-01' AS DATE) END)+1)*""average_daily_sales"" AS ""sales_in_2019"",((CASE WHEN EXTRACT(YEAR FROM ""period_start"")<2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN ""period_end"" - CAST('2020-01-01' AS DATE) WHEN EXTRACT(YEAR FROM ""period_start"")=2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN ""period_end"" - ""period_start"" END)+1)*""average_daily_sales"" AS ""sales_in_2020"" FROM ""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") (SELECT ""product_id"",""product_name"",'2018' AS ""report_year"",SUM(""sales_in_2018"") AS ""total_amount"" FROM ""total_sales"" WHERE ""sales_in_2018"" IS NOT NULL GROUP BY 1,2,3 UNION SELECT ""product_id"",""product_name"",'2019' AS ""report_year"",SUM(""sales_in_2019"") AS ""total_amount"" FROM ""total_sales"" WHERE ""sales_in_2019"" IS NOT NULL GROUP BY 1,2,3 UNION SELECT ""product_id"",""product_name"",'2020' AS ""report_year"",SUM(""sales_in_2020"") AS ""total_amount"" FROM ""total_sales"" WHERE ""sales_in_2020"" IS NOT NULL GROUP BY 1,2,3) ORDER BY 1,3"
58,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
59,"ERROR: mysql parse error: line 1 column 465 near ""NCHAR) AS report_year, SUM(average_daily_sales) AS total_amount FROM cte C INNER JOIN Product P ON C.product_id=P.product_id GROUP BY C.product_id, product_name, CAST(EXTRACT(YEAR FROM curr_date) AS NCHAR) ORDER BY C.product_id, report_year"" "
60,"WITH RECURSIVE ""cte"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""Sales"" UNION ALL SELECT ""date"" + INTERVAL '1 DAY' AS ""date"" FROM ""cte"" WHERE ""date""<=(SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"" AS ""product_id"",""p"".""product_name"" AS ""product_name"",LEFT(""c"".""date"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") JOIN ""cte"" AS ""c"" ON ""c"".""date"">=""s"".""period_start"" AND ""c"".""date""<=""s"".""period_end"" GROUP BY 1,2,3 ORDER BY 1,3"
61,"WITH RECURSIVE ""dates"" AS (SELECT MIN(""period_start"") AS ""min_date"",MAX(""period_end"") AS ""max_date"" FROM ""Sales"" UNION ALL SELECT ""min_date"" + INTERVAL '1 DAY',""max_date"" FROM ""dates"" WHERE ""min_date""<""max_date"") SELECT CONVERT(""product_id"", CHAR) AS ""product_id"",""product_name"",CONVERT(""report_year"", CHAR) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (SELECT ""ina"".""product_id"",""ina"".""product_name"",EXTRACT(YEAR FROM ""inc"".""min_date"") AS ""report_year"",""inb"".""average_daily_sales"" FROM (""product"" AS ""ina"" LEFT JOIN ""Sales"" AS ""inb"" ON ""ina"".""product_id""=""inb"".""product_id"") LEFT JOIN ""dates"" AS ""inc"" ON ""inc"".""min_date"" BETWEEN ""inb"".""period_start"" AND ""inb"".""period_end"") AS ""ind"" GROUP BY ""product_id"",""product_name"",""report_year"" ORDER BY ""product_id"",""report_year"""
62,"WITH RECURSIVE ""cte"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""sales"" UNION SELECT ""date"" + INTERVAL '1 DAY' FROM ""cte"" WHERE ""date""<=(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""e"".""date"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""CTE"" AS ""e"" ON ""s"".""period_start""<=""e"".""date"" AND ""s"".""period_end"">=""e"".""date"" GROUP BY ""product_id"",""product_name"",""report_year"" ORDER BY ""product_id"",""report_year"""
63,"ERROR: mysql parse error: line 1 column 465 near ""NCHAR) AS report_year, SUM(average_daily_sales) AS total_amount FROM cte C INNER JOIN Product P ON C.product_id=P.product_id GROUP BY C.product_id, product_name, CAST(EXTRACT(YEAR FROM curr_date) AS NCHAR) ORDER BY C.product_id, report_year"" "
64,"WITH RECURSIVE ""t1"" (""n"") AS (SELECT 2018 UNION ALL SELECT ""n""+1 FROM ""t1"" WHERE ""n""<2020), ""t2"" AS (SELECT CAST(""p"".""PRODUCT_ID"" AS CHAR) AS ""PRODUCT_ID"",""p"".""PRODUCT_NAME"",CASE WHEN ""s"".""period_start"">CAST(CONCAT(CAST(""T1"".""n"" AS CHAR), '-01-01') AS DATE) THEN ""s"".""period_start"" ELSE CAST(CONCAT(CAST(""T1"".""n"" AS CHAR), '-01-01') AS DATE) END AS ""period_start_new"",CASE WHEN ""s"".""period_end""<CAST(CONCAT(CAST(""T1"".""n"" AS CHAR), '-12-31') AS DATE) THEN ""s"".""period_end"" ELSE CAST(CONCAT(CAST(""T1"".""n"" AS CHAR), '-12-31') AS DATE) END AS ""period_end_new"",""s"".""average_daily_sales"" FROM (""Sales"" AS ""s"" LEFT JOIN ""T1"" ON ""T1"".""n"" BETWEEN EXTRACT(YEAR FROM ""period_start"") AND EXTRACT(YEAR FROM ""period_end"")) JOIN ""PRODUCT"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") SELECT ""PRODUCT_ID"",""PRODUCT_NAME"",CAST(EXTRACT(YEAR FROM ""period_end_new"") AS CHAR) AS ""report_year"",(""period_end_new"" - ""period_start_new""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""T2"" ORDER BY ""PRODUCT_ID"",""REPORT_YEAR"""
65,"WITH ""tmp"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 UNION SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""sales"" WHERE EXTRACT(YEAR FROM ""period_end"")=2020) SELECT ""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""tmp"" NATURAL JOIN ""product"" ORDER BY 1,3"
66,"SELECT ""t"".""product_id"",""product_name"",""report_year"",""total"" AS ""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""t"" JOIN ""Product"" AS ""p"" ON ""t"".""product_id""=""p"".""product_id"" ORDER BY 1,3"
67,"WITH ""cte1"" AS (SELECT DATE('2018-01-01') AS ""start_date"",DATE('2018-12-31') AS ""end_date"" UNION ALL SELECT DATE('2019-01-01'),DATE('2019-12-31') UNION ALL SELECT DATE('2020-01-01'),DATE('2020-12-31')), ""cte2"" AS (SELECT ""sa"".""product_id"",""sa"".""average_daily_sales"",CAST(EXTRACT(YEAR FROM ""c1"".""start_date"") AS CHAR) AS ""report_year"",CASE WHEN ""sa"".""period_start"">=""c1"".""start_date"" AND ""sa"".""period_end""<=""c1"".""end_date"" THEN ""sa"".""period_end"" - ""sa"".""period_start""+1 WHEN ""sa"".""period_start"">=""c1"".""start_date"" AND ""sa"".""period_end"">=""c1"".""end_date"" THEN ""c1"".""end_date"" - ""sa"".""period_start""+1 WHEN ""sa"".""period_start""<=""c1"".""start_date"" AND ""sa"".""period_end"">=""c1"".""end_date"" THEN ""c1"".""end_date"" - ""c1"".""start_date""+1 WHEN ""sa"".""period_start""<=""c1"".""start_date"" AND ""sa"".""period_end""<=""c1"".""end_date"" THEN ""sa"".""period_end"" - ""c1"".""start_date""+1 END AS ""date_diff"" FROM ""sales"" AS ""sa"" JOIN ""cte1"" AS ""c1"") SELECT ""c2"".""product_id"",""pr"".""product_name"",""c2"".""report_year"",SUM(""c2"".""average_daily_sales""*""c2"".""date_diff"") AS ""total_amount"" FROM ""cte2"" AS ""c2"" JOIN ""product"" AS ""pr"" ON ""c2"".""product_id""=""pr"".""product_id"" WHERE ""c2"".""date_diff"">0 GROUP BY 1,2,3 ORDER BY ""product_id"",""product_name"",""report_year"""
68,"WITH ""a"" AS (SELECT ""product_id"",(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2018 THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")!=2018 THEN CAST('2018-12-31' AS DATE) - ""period_start""+1 ELSE 0 END)*""average_daily_sales"" AS ""day18"",(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")!=2019 THEN CAST('2019-12-31' AS DATE) - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" - CAST('2019-01-01' AS DATE)+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN CAST('2019-12-31' AS DATE) - CAST('2019-01-01' AS DATE)+1 ELSE 0 END)*""average_daily_sales"" AS ""day19"",(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")!=2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN ""period_end"" - CAST('2020-01-01' AS DATE)+1 ELSE 0 END)*""average_daily_sales"" AS ""day20"" FROM ""Sales""), ""b"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""day18"" AS ""total_amount"" FROM ""a"" WHERE ""day18""!=0 UNION ALL SELECT ""product_id"",'2019',""day19"" FROM ""a"" WHERE ""day19""!=0 UNION ALL SELECT ""product_id"",'2020',""day20"" FROM ""a"" WHERE ""day20""!=0) SELECT ""b"".""product_id"",""Product"".""product_name"",""b"".""report_year"",""b"".""total_amount"" FROM ""b"" JOIN ""Product"" ON ""b"".""product_id""=""Product"".""product_id"" ORDER BY ""product_id"",""report_year"""
69,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
70,"WITH RECURSIVE ""cte"" (""yr"") AS (SELECT 2018 UNION ALL SELECT ""yr""+1 FROM ""cte"" WHERE ""yr""<2020) SELECT ""temp"".""product_id"" AS ""product_id"",""product_name"",CAST(""report_year"" AS CHAR) AS ""report_year"",""total_amount"" FROM ""product"" AS ""p"" RIGHT JOIN (SELECT ""yr"" AS ""report_year"",CASE WHEN ""yr""=EXTRACT(YEAR FROM ""period_start"") AND ""yr""=EXTRACT(YEAR FROM ""period_end"") THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" WHEN ""yr""=EXTRACT(YEAR FROM ""period_start"") AND ""yr""<EXTRACT(YEAR FROM ""period_end"") THEN (CONCAT(""yr"", '-12-31') - ""period_start""+1)*""average_daily_sales"" WHEN ""yr"">EXTRACT(YEAR FROM ""period_start"") AND ""yr""<EXTRACT(YEAR FROM ""period_end"") THEN DAYOFYEAR(CONCAT(""yr"", '-12-31'))*""average_daily_sales"" WHEN ""yr"">EXTRACT(YEAR FROM ""period_start"") AND ""yr""=EXTRACT(YEAR FROM ""period_end"") THEN DAYOFYEAR(""period_end"")*""average_daily_sales"" END AS ""total_amount"",""s"".* FROM (""cte"") JOIN ""sales"" AS ""s"" WHERE ""yr"" BETWEEN EXTRACT(YEAR FROM ""period_start"") AND EXTRACT(YEAR FROM ""period_end"")) AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"" ORDER BY ""temp"".""product_id"",""report_year"""
71,"WITH ""T1"" AS (SELECT '2018' AS ""report_year"" UNION SELECT '2019' AS ""report_year"" UNION SELECT '2020' AS ""report_year""), ""T2"" AS (SELECT ""product_id"",CASE WHEN ""period_start""<'2019-01-01' THEN (LEAST('2018-12-31', ""period_end"") - ""period_start""+1)*""average_daily_sales"" ELSE 0 END AS ""amt_2018"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")<='2019' AND EXTRACT(YEAR FROM ""period_end"")>='2019' THEN (LEAST('2019-12-31', ""period_end"") - GREATEST('2019-01-01', ""period_start"")+1)*""average_daily_sales"" ELSE 0 END AS ""amt_2019"",CASE WHEN ""period_end"">'2019-12-31' THEN (""period_end"" - GREATEST('2020-01-01', ""period_start"")+1)*""average_daily_sales"" ELSE 0 END AS ""amt_2020"" FROM ""Sales"") SELECT * FROM (SELECT CAST(""Product_1"".""product_id"" AS CHAR) AS ""product_id"",""Product_1"".""product_name"",""Product_1"".""report_year"",CASE WHEN ""Product_1"".""report_year""='2018' THEN ""amt_2018"" WHEN ""Product_1"".""report_year""='2019' THEN ""amt_2019"" ELSE ""amt_2020"" END AS ""total_amount"" FROM (SELECT * FROM ""Product"" JOIN ""T1"") AS ""Product_1"" JOIN ""T2"" WHERE ""Product_1"".""product_id""=""T2"".""product_id"") AS ""Product_2"" WHERE ""total_amount"">0 ORDER BY ""product_id"",""report_year"""
72,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""period_start"" AS ""dur"" FROM ""Sales"" UNION ALL (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""dur"" + INTERVAL '1 DAY' AS ""dur"" FROM ""cte"" WHERE ""dur""<""period_end"")) SELECT ""sd"".""product_id"" AS ""product_id"",(SELECT ""p"".""product_name"" FROM ""product"" AS ""p"" WHERE ""p"".""product_id""=""sd"".""product_id"") AS ""product_name"",CAST(EXTRACT(YEAR FROM ""sd"".""dur"") AS CHAR(4)) AS ""report_year"",SUM(""sd"".""average_daily_sales"") AS ""total_amount"" FROM ""cte"" AS ""sd"" GROUP BY 1,3 ORDER BY 1"
73,"SELECT ""t3"".""product_id"",""p"".""product_name"",""year"" AS ""report_year"",""amount"" AS ""total_amount"" FROM (SELECT ""product_id"",""year"",CASE WHEN ""period_start"">""end"" OR ""period_end""<""start"" THEN -1 ELSE (1+CASE WHEN ""period_end"">""end"" THEN ""end"" ELSE ""period_end"" END - CASE WHEN ""period_start""<""start"" THEN ""start"" ELSE ""period_start"" END)*""average_daily_sales"" END AS ""amount"" FROM (SELECT * FROM ""Sales"" JOIN (SELECT '2018' AS ""year"",'2018-01-01' AS ""start"",'2018-12-31' AS ""end"" UNION ALL SELECT '2019' AS ""year"",'2019-01-01' AS ""start"",'2019-12-31' AS ""end"" UNION ALL SELECT '2020' AS ""year"",'2020-01-01' AS ""start"",'2020-12-31' AS ""end"") AS ""t1"") AS ""t2"") AS ""t3"" JOIN ""Product"" AS ""p"" WHERE ""t3"".""product_id""=""p"".""product_id"" AND ""t3"".""amount"">-1 ORDER BY ""t3"".""product_id"",""report_year"""
74,"WITH ""S0"" AS (SELECT ""product_id"",""period_start"",""period_end"",EXTRACT(YEAR FROM ""period_start"") AS ""year_start"",EXTRACT(YEAR FROM ""period_end"") AS ""year_end"",""average_daily_sales"" FROM ""Sales""), ""S1"" AS (SELECT ""product_id"",""year_start"" AS ""report_year"",(""period_end"" - ""period_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""S0"" WHERE ""year_start""=""year_end""), ""S2"" AS (SELECT ""product_id"",'2018' AS ""report_year"",(CAST('2018-12-31' AS DATE) - ""period_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""S0"" WHERE ""year_start""+2=""year_end"" UNION SELECT ""product_id"",'2019' AS ""report_year"",(CAST('2019-12-31' AS DATE) - CAST('2019-01-01' AS DATE)+1)*""average_daily_sales"" AS ""total_amount"" FROM ""S0"" WHERE ""year_start""+2=""year_end"" UNION SELECT ""product_id"",'2020' AS ""report_year"",(""period_END"" - CAST('2020-01-01' AS DATE)+1)*""average_daily_sales"" AS ""total_amount"" FROM ""S0"" WHERE ""year_start""+2=""year_end""), ""S3"" AS (SELECT ""product_id"",""year_start"" AS ""report_year"",(CONCAT(""year_start"", '-12-31') - ""period_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""S0"" WHERE ""year_start""+1=""year_end"" UNION SELECT ""product_id"",""year_end"" AS ""report_year"",(""period_end"" - CONCAT(""year_end"", '-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""S0"" WHERE ""year_start""+1=""year_end""), ""S4"" AS (SELECT * FROM ""S1"" UNION SELECT * FROM ""S2"" UNION SELECT * FROM ""S3"") SELECT ""S4"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""S4"" JOIN ""Product"" ON ""S4"".""product_id""=""Product"".""product_id"" ORDER BY ""product_id"",""report_year"""
75,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""cte"" WHERE ""period_start"" + INTERVAL '1 DAY'<=""period_end"") SELECT CAST(""b"".""product_id"" AS CHAR(50)) AS ""product_id"",""b"".""product_name"",LEFT(""period_start"", 4) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM ""cte"" AS ""a"" JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" GROUP BY 1,2,EXTRACT(YEAR FROM ""period_start"") ORDER BY 1,3"
76,"WITH ""flat_sales"" AS (SELECT * FROM ""sales"" AS ""s1"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") UNION SELECT ""product_id"",""period_start"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 THEN '2018-12-31' WHEN EXTRACT(YEAR FROM ""period_start"")=2019 THEN '2019-12-31' ELSE '2020-12-31' END AS ""period_end"",""average_daily_sales"" FROM ""sales"" AS ""s2"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-1 UNION SELECT ""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=2018 THEN '2018-01-01' WHEN EXTRACT(YEAR FROM ""period_end"")=2019 THEN '2019-01-01' ELSE '2020-01-01' END AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""sales"" AS ""s3"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-1 UNION SELECT ""product_id"",""period_start"",'2018-12-31',""average_daily_sales"" FROM ""sales"" AS ""s4"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-2 UNION SELECT ""product_id"",'2019-01-01','2019-12-31',""average_daily_sales"" FROM ""sales"" AS ""s5"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-2 UNION SELECT ""product_id"",'2020-01-01',""period_end"",""average_daily_sales"" FROM ""sales"" AS ""s6"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-2) SELECT ""fs"".""product_id"",""p"".""product_name"",CONVERT(EXTRACT(YEAR FROM ""period_end""), CHAR) AS ""report_year"",SUM((""fs"".""period_end"" - ""fs"".""period_start""+1)*""fs"".""average_daily_sales"") AS ""total_amount"" FROM (""flat_sales"" AS ""fs"") JOIN ""product"" AS ""p"" WHERE ""fs"".""product_id""=""p"".""product_id"" GROUP BY ""fs"".""product_id"",""p"".""product_name"",EXTRACT(YEAR FROM ""period_end"") ORDER BY ""fs"".""product_id"",EXTRACT(YEAR FROM ""period_end"")"
77,"WITH RECURSIVE ""taco"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""Sales"" UNION ALL SELECT ""date"" + INTERVAL '1 DAY' FROM ""taco"" WHERE ""date""<=(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""taco"".""date"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" USING (""product_id"")) JOIN ""taco"" ON ""s"".""period_start""<=""taco"".""date"" AND ""s"".""period_end"">=""taco"".""date"" GROUP BY 1,2,3 ORDER BY 1,3"
78,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2020 AND EXTRACT(YEAR FROM ""period_end"")>=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
79,"ERROR: mysql parse error: line 1 column 269 near ""nchar) as product_id, product_name, cast(year(calendar_date) as nchar) as report_year, sum(coalesce(average_daily_sales, 0)) as total_amount from cte_spine as sp left join Sales on sp.calendar_date between Sales.period_start and Sales.period_end left join Product as p on p.product_id = Sales.product_id group by 1, 2, 3 having total_amount > 0 order by 1, 3 ) select * from cte_join_agg"" "
80,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2020 AND EXTRACT(YEAR FROM ""period_end"")>=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
81,"SELECT ""s"".""product_id"" AS ""product_id"",""product_name"" AS ""product_name"",CAST(""report_year"" AS CHAR) AS ""report_year"",""total_amount"" AS ""total_amount"" FROM (SELECT ""product_id"",EXTRACT(YEAR FROM ""period_start"") AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=EXTRACT(YEAR FROM ""period_start"") THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_end"")-EXTRACT(YEAR FROM ""period_start"")>0 THEN (CONCAT(EXTRACT(YEAR FROM ""period_start""), '-', '12-31') - ""period_start""+1)*""average_daily_sales"" END AS ""total_amount"" FROM ""Sales"" UNION SELECT ""product_id"",EXTRACT(YEAR FROM ""period_start"")+1 AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")-EXTRACT(YEAR FROM ""period_start"")=1 THEN (""period_end"" - CONCAT(EXTRACT(YEAR FROM ""period_end""), '-', '01-01')+1)*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_end"")-EXTRACT(YEAR FROM ""period_start"")>1 THEN (CONCAT(EXTRACT(YEAR FROM ""period_start"")+1, '-', '12-31') - CONCAT(EXTRACT(YEAR FROM ""period_start"")+1, '-', '01-01')+1)*""average_daily_sales"" END AS ""total_amount"" FROM ""Sales"" UNION SELECT ""product_id"",EXTRACT(YEAR FROM ""period_start"")+2 AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")-EXTRACT(YEAR FROM ""period_start"")=2 THEN (""period_end"" - CONCAT(EXTRACT(YEAR FROM ""period_end""), '-', '01-01')+1)*""average_daily_sales"" END AS ""total_amount"" FROM ""Sales"") AS ""s"", ""Product"" AS ""p"" WHERE ""s"".""product_id""=""p"".""product_id"" AND ""total_amount"" IS NOT NULL GROUP BY ""product_id"",""report_year"" ORDER BY ""product_id"",""report_year"""
82,"ERROR: mysql parse error: line 1 column 465 near ""NCHAR) AS report_year, SUM(average_daily_sales) AS total_amount FROM cte C INNER JOIN Product P ON C.product_id=P.product_id GROUP BY C.product_id, product_name, CAST(EXTRACT(YEAR FROM curr_date) AS NCHAR) ORDER BY C.product_id, report_year "" "
83,"WITH RECURSIVE ""caltable"" AS (SELECT MIN(""period_start"") AS ""day"" FROM ""Sales"" UNION ALL SELECT ""day"" + INTERVAL '1 DAY' AS ""day"" FROM ""caltable"" WHERE ""day""<(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""day"", 'YYYY') AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""sales"" AS ""s"" JOIN ""caltable"" AS ""c"" ON ""c"".""day"" BETWEEN ""s"".""period_start"" AND ""s"".""period_end"") JOIN ""product"" AS ""p"" USING (""product_id"") GROUP BY ""s"".""product_id"",""p"".""product_name"",EXTRACT(YEAR FROM ""c"".""day"") ORDER BY ""s"".""product_id"",EXTRACT(YEAR FROM ""c"".""day"")"
84,"SELECT ""a"".""product_id"",""p"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST('2018-12-31', ""period_end"") - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",(LEAST('2019-12-31', ""period_end"") - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",(LEAST('2020-12-31', ""period_end"") - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"") AS ""a"" LEFT JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""a"".""product_id"" WHERE ""a"".""total_amount"">0 ORDER BY ""a"".""product_id"",""a"".""report_year"""
85,"WITH RECURSIVE ""dt"" AS (SELECT MIN(""period_start"") AS ""startdate"",MAX(""period_end"") AS ""enddate"" FROM ""Sales"" UNION ALL SELECT ""startdate"" + INTERVAL '1 DAY' AS ""startdate"",""enddate"" FROM ""dt"" WHERE ""startdate""<""enddate"") SELECT ""s"".""product_id"",""product_name"",CAST(EXTRACT(YEAR FROM ""startdate"") AS CHAR(20)) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" LEFT JOIN ""dt"" ON ""dt"".""startdate"" BETWEEN ""period_start"" AND ""period_end"") LEFT JOIN ""product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"" GROUP BY ""s"".""product_id"",EXTRACT(YEAR FROM ""startdate"") ORDER BY ""s"".""product_id"",""report_year"""
86,"WITH RECURSIVE ""CTE"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""Sales"" UNION ALL SELECT ""date"" + INTERVAL '1 DAY' FROM ""CTE"" WHERE ""date""<=ALL (SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",SUBSTRING((""cte"".""date""), 1, 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""cte"" ON ""s"".""period_start""<=""cte"".""date"" AND ""s"".""period_end"">=""cte"".""date"") JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"" GROUP BY ""s"".""product_id"",EXTRACT(YEAR FROM ""cte"".""date"") ORDER BY ""s"".""product_id"",""report_year"""
87,"WITH ""tbY"" AS (SELECT '2018' AS ""report_year"",'2018-01-01' AS ""start"",'2018-12-31' AS ""end"" UNION ALL SELECT '2019','2019-01-01','2019-12-31' UNION ALL SELECT '2020','2020-01-01','2020-12-31'), ""tbS"" AS (SELECT ""s"".*,""tbY"".""report_year"",1+CASE WHEN ""s"".""period_end""<""tbY"".""end"" THEN ""s"".""period_end"" ELSE ""tbY"".""end"" END - CASE WHEN ""s"".""period_start"">""tbY"".""start"" THEN ""s"".""period_start"" ELSE ""tbY"".""start"" END AS ""days"" FROM ""Sales"" AS ""s"" JOIN ""tbY"" WHERE ""s"".""period_end"">=""tbY"".""start"" AND ""s"".""period_start""<=""tbY"".""end"") SELECT ""tbS"".""product_id"",""p"".""product_name"",""tbS"".""report_year"",""tbS"".""average_daily_sales""*""days"" AS ""total_amount"" FROM ""tbS"" JOIN ""Product"" AS ""p"" ON ""tbS"".""product_id""=""p"".""product_id"" ORDER BY ""product_id"",""tbs"".""report_year"""
88,"WITH ""sales_2018"" AS (SELECT ""t1"".""product_id"",""t2"".""product_name"",CAST(EXTRACT(YEAR FROM ""t1"".""period_start"") AS CHAR) AS ""report_year"",(""t1"".""period_end"" - ""t1"".""period_start""+1)*""t1"".""average_daily_sales"" AS ""total_amount"" FROM (SELECT ""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 THEN ""period_start"" ELSE DATE('2018-01-01') END AS ""period_start"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=2018 THEN ""period_end"" ELSE DATE('2018-12-31') END AS ""period_end"",""average_daily_sales"" FROM ""sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018) AS ""t1"" JOIN ""product"" AS ""t2"" ON ""t2"".""product_id""=""t1"".""product_id""), ""sales_2019"" AS (SELECT ""t1"".""product_id"",""t2"".""product_name"",CAST(EXTRACT(YEAR FROM ""t1"".""period_start"") AS CHAR) AS ""report_year"",(""t1"".""period_end"" - ""t1"".""period_start""+1)*""t1"".""average_daily_sales"" AS ""total_amount"" FROM (SELECT ""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2019 THEN ""period_start"" ELSE DATE('2019-01-01') END AS ""period_start"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" ELSE DATE('2019-12-31') END AS ""period_end"",""average_daily_sales"" FROM ""sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019) AS ""t1"" JOIN ""product"" AS ""t2"" ON ""t2"".""product_id""=""t1"".""product_id""), ""sales_2020"" AS (SELECT ""t1"".""product_id"",""t2"".""product_name"",CAST(EXTRACT(YEAR FROM ""t1"".""period_start"") AS CHAR) AS ""report_year"",(""t1"".""period_end"" - ""t1"".""period_start""+1)*""t1"".""average_daily_sales"" AS ""total_amount"" FROM (SELECT ""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2020 THEN ""period_start"" ELSE DATE('2020-01-01') END AS ""period_start"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=2020 THEN ""period_end"" ELSE DATE('2020-12-31') END AS ""period_end"",""average_daily_sales"" FROM ""sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2020 AND EXTRACT(YEAR FROM ""period_end"")>=2020) AS ""t1"" JOIN ""product"" AS ""t2"" ON ""t2"".""product_id""=""t1"".""product_id"") SELECT * FROM (SELECT * FROM ""sales_2018"" UNION ALL SELECT * FROM ""sales_2019"" UNION ALL SELECT * FROM ""sales_2020"") AS ""t"" ORDER BY ""product_id"",""report_year"""
89,"WITH RECURSIVE ""sales_daily"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""period_start"" AS ""dur"" FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""dur"" + INTERVAL '1 DAY' AS ""dur"" FROM ""sales_daily"" WHERE ""dur""<""period_end"") SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""s"".""dur"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM ""sales_daily"" AS ""s"" JOIN ""product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" WHERE LEFT(""s"".""dur"", 4) BETWEEN 2018 AND 2020 GROUP BY ""s"".""product_id"",""report_year"" ORDER BY ""s"".""product_id"",""report_year"""
90,"WITH RECURSIVE ""t1"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t1"" WHERE ""period_start""<""period_end"") SELECT ""t1"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""t1"" JOIN ""product"" ON ""t1"".""product_id""=""product"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
91,"SELECT ""t"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""product"" AS ""a"" JOIN (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" AS ""a"" WHERE EXTRACT(YEAR FROM ""period_start"")='2018' OR EXTRACT(YEAR FROM ""period_end"")='2018' UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" AS ""a"" WHERE EXTRACT(YEAR FROM ""period_start"")<='2019' AND EXTRACT(YEAR FROM ""period_end"")>='2019' UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" AS ""a"" WHERE EXTRACT(YEAR FROM ""period_start"")='2020' OR EXTRACT(YEAR FROM ""period_end"")='2020') AS ""t"" USING (""product_id"") ORDER BY 1,3"
92,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2020 AND EXTRACT(YEAR FROM ""period_end"")>=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
93,"WITH RECURSIVE ""cte"" AS (SELECT (SELECT MIN(""period_start"") FROM ""Sales"") AS ""sale_date"" UNION ALL SELECT ""sale_date"" + INTERVAL '1 DAY' AS ""sale_date"" FROM ""cte"" WHERE ""sale_date""<(SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""c"".""sale_date"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""cte"" AS ""c"" JOIN ""Sales"" AS ""s"" ON ""c"".""sale_date"" BETWEEN ""s"".""period_start"" AND ""s"".""period_end"") JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
94,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
95,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"" FROM ""Sales"" UNION SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""a"".""product_id"",""b"".""product_name"",CONVERT(EXTRACT(YEAR FROM ""period_start""), CHAR) AS ""report_year"",SUM(""a"".""average_daily_sales"") AS ""total_amount"" FROM ""cte"" AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
96,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
97,"WITH ""cte"" AS (SELECT *,(""period_end"" - ""period_start""+1)*""average_daily_sales"" AS ""total_sales"",CASE WHEN ""period_start"">'2018-12-31' THEN 0 WHEN ""period_end""<='2018-12-31' THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" ELSE (CAST('2018-12-31' AS DATE) - ""period_start""+1)*""average_daily_sales"" END AS ""sales_2018"",CASE WHEN ""period_end""<'2020-01-01' THEN 0 WHEN ""period_start"">='2020-01-01' THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" ELSE (""period_end"" - CAST('2020-01-01' AS DATE)+1)*""average_daily_sales"" END AS ""sales_2020"" FROM ""sales"") SELECT ""a"".""product_id"",""b"".""product_name"",""c"".""report_year"",""c"".""total_amount"" FROM (""sales"" AS ""a"" LEFT JOIN ""product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"") LEFT JOIN (SELECT ""product_id"",'2018' AS ""report_year"",""sales_2018"" AS ""total_amount"" FROM ""cte"" UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""sales_2020"" AS ""total_amount"" FROM ""cte"" UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""total_sales""-""sales_2020""-""sales_2018"" AS ""total_amount"" FROM ""cte"") AS ""c"" ON ""a"".""product_id""=""c"".""product_id"" WHERE ""c"".""total_amount"">0 ORDER BY 1,3"
98,"WITH ""cte"" AS (SELECT ""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2018 THEN TIMESTAMPDIFF(DAY, ""period_start"", ""period_end"")+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")>2018 THEN TIMESTAMPDIFF(DAY, ""period_start"", '2019-01-01') ELSE 0 END*""average_daily_sales"" AS ""year_2018"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN TIMESTAMPDIFF(DAY, ""period_start"", ""period_end"")+1 WHEN EXTRACT(YEAR FROM ""period_start"")<2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN TIMESTAMPDIFF(DAY, '2019-01-01', ""period_end"")+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")>2019 THEN TIMESTAMPDIFF(DAY, ""period_start"", '2020-01-01') WHEN EXTRACT(YEAR FROM ""period_start"")<2019 AND EXTRACT(YEAR FROM ""period_end"")>2019 THEN 365 ELSE 0 END*""average_daily_sales"" AS ""year_2019"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN TIMESTAMPDIFF(DAY, ""period_start"", ""period_end"")+1 WHEN EXTRACT(YEAR FROM ""period_start"")<2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN TIMESTAMPDIFF(DAY, '2020-01-01', ""period_end"")+1 ELSE 0 END*""average_daily_sales"" AS ""year_2020"" FROM ""sales""), ""cte2"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""year_2018"" AS ""total_amount"" FROM ""cte"" UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""year_2019"" AS ""total_amount"" FROM ""cte"" UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""year_2020"" AS ""total_amount"" FROM ""cte"") SELECT ""cte2"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""cte2"" LEFT JOIN ""product"" AS ""p"" ON ""cte2"".""product_id""=""p"".""product_id"" WHERE ""total_amount""!=0 ORDER BY ""product_id"",""report_year"""
99,"SELECT ""u"".""product_id"" AS ""product_id"",""p"".""product_name"" AS ""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST(""period_end"", '2018-12-31') - ""period_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" WHERE ""period_start""<='2018-12-31' UNION SELECT ""product_id"",'2019' AS ""report_year"",(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" WHERE ""period_start""<='2019-12-31' UNION SELECT ""product_id"",'2020' AS ""report_year"",(""period_end"" - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"") AS ""u"" JOIN ""product"" AS ""p"" ON ""u"".""product_id""=""p"".""product_id"" WHERE ""total_amount"">0 ORDER BY 1,3"
100,"WITH RECURSIVE ""a"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""a"" WHERE ""period_start""<""period_end"") SELECT ""a"".""product_id"",""p"".""product_name"",TO_CHAR(""a"".""period_start"", 'YYYY') AS ""report_year"",COUNT(""a"".""product_id"")*""a"".""average_daily_sales"" AS ""total_amount"" FROM ""a"" JOIN ""product"" AS ""p"" ON ""a"".""product_id""=""p"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
101,"SELECT ""u"".""product_id"" AS ""product_id"",""p"".""product_name"" AS ""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST(""period_end"", '2018-12-31') - ""period_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" WHERE ""period_start""<='2018-12-31' UNION SELECT ""product_id"",'2019' AS ""report_year"",(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" WHERE ""period_start""<='2019-12-31' UNION SELECT ""product_id"",'2020' AS ""report_year"",(""period_end"" - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"") AS ""u"" JOIN ""product"" AS ""p"" ON ""u"".""product_id""=""p"".""product_id"" WHERE ""total_amount"">0 ORDER BY 1,3"
102,"WITH ""tmp"" AS (SELECT ""product_id"",""report_year"",""average_daily_sales""*""days"" AS ""total_amount"" FROM (SELECT ""product_id"",""average_daily_sales"",'2018' AS ""report_year"",LEAST('2018-12-31', ""period_end"") - GREATEST('2018-01-01', ""period_start"")+1 AS ""days"" FROM ""Sales"" HAVING ""days"">0) AS ""inc"" UNION ALL SELECT ""product_id"",""report_year"",""average_daily_sales""*""days"" AS ""total_amount"" FROM (SELECT ""product_id"",""average_daily_sales"",'2019' AS ""report_year"",LEAST('2019-12-31', ""period_end"") - GREATEST('2019-01-01', ""period_start"")+1 AS ""days"" FROM ""Sales"" HAVING ""days"">0) AS ""inc"" UNION ALL SELECT ""product_id"",""report_year"",""average_daily_sales""*""days"" AS ""total_amount"" FROM (SELECT ""product_id"",""average_daily_sales"",'2020' AS ""report_year"",LEAST('2020-12-31', ""period_end"") - GREATEST('2020-01-01', ""period_start"")+1 AS ""days"" FROM ""Sales"" HAVING ""days"">0) AS ""inc"") SELECT ""ina"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM (""tmp"" AS ""ina"") JOIN ""product"" AS ""inb"" WHERE ""ina"".""product_id""=""inb"".""product_id"" ORDER BY ""product_id"",""report_year"""
103,"WITH RECURSIVE ""d"" AS (SELECT MIN(""period_start"") AS ""calendar_date"" FROM ""Sales"" UNION ALL SELECT ""calendar_date"" + INTERVAL '1 DAY' FROM ""d"" WHERE ""calendar_date""<(SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""product_id"",""product_name"",""report_year"",""day""*""average_daily_sales"" AS ""total_amount"" FROM (SELECT ""s"".""product_id"",""product_name"",""calendar_date"",CONVERT(EXTRACT(YEAR FROM ""calendar_date""), CHAR) AS ""report_year"",COUNT(""calendar_date"") AS ""day"",""average_daily_sales"" FROM (""d"" JOIN ""Sales"" AS ""s"" ON ""d"".""calendar_date"" BETWEEN ""s"".""period_start"" AND ""s"".""period_end"") JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" GROUP BY 1,4) AS ""t"" ORDER BY 1,3"
104,"SELECT ""s"".""product_id"",""p"".""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST('2018-12-31', ""period_end"") - GREATEST('2018-01-01', ""period_start"")+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",(LEAST('2019-12-31', ""period_end"") - GREATEST('2019-01-01', ""period_start"")+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",(LEAST('2020-12-31', ""period_end"") - GREATEST('2020-01-01', ""period_start"")+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""s"" JOIN ""Product"" AS ""p"" USING (""product_id"") ORDER BY ""s"".""product_id"",""report_year"""
105,"WITH ""t1"" AS (SELECT ""product_id"",""average_daily_sales""*(LEAST('2018-12-31', ""period_end"") - GREATEST('2018-01-01', ""period_start"")+1) AS ""2018sales"",""average_daily_sales""*(LEAST('2019-12-31', ""period_end"") - GREATEST('2019-01-01', ""period_start"")+1) AS ""2019sales"",""average_daily_sales""*(LEAST('2020-12-31', ""period_end"") - GREATEST('2020-01-01', ""period_start"")+1) AS ""2020sales"" FROM ""Sales""), ""t2"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""2018sales"" AS ""total_amount"" FROM ""t1"" WHERE ""2018sales"">0 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""2019sales"" AS ""total_amount"" FROM ""t1"" WHERE ""2019sales"">0 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""2020sales"" AS ""total_amount"" FROM ""t1"" WHERE ""2020sales"">0 ORDER BY 1,2) SELECT ""t2"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""t2"" JOIN ""Product"" AS ""p"" ON ""t2"".""product_id""=""p"".""product_id"""
106,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",EXTRACT(YEAR FROM ""period_start"") AS ""yr"" FROM ""sales"" UNION SELECT ""product_id"",""yr""+1 AS ""yr"" FROM ""cte"" AS ""S1"" WHERE ""yr""<(SELECT EXTRACT(YEAR FROM ""period_end"") FROM ""sales"" AS ""S2"" WHERE ""S2"".""product_id""=""S1"".""product_id"")) SELECT ""C"".""product_id"",""product_name"",CAST(""C"".""yr"" AS CHAR) AS ""report_year"",(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") THEN (""period_end"" - ""period_start""+1)*""average_daily_sales"" WHEN ""yr""=EXTRACT(YEAR FROM ""period_start"") THEN (CONCAT(""yr"", '-12-31') - ""period_start""+1)*""average_daily_sales"" WHEN ""yr""=EXTRACT(YEAR FROM ""period_end"") THEN (""period_end"" - CONCAT(""yr"", '-01-01')+1)*""average_daily_sales"" ELSE 365*""average_daily_sales"" END) AS ""total_amount"" FROM (""cte"" AS ""C"" LEFT JOIN ""Sales"" AS ""S"" ON ""C"".""product_id""=""S"".""product_id"") JOIN ""Product"" AS ""P"" ON ""S"".""product_id""=""P"".""product_id"" ORDER BY ""C"".""product_id"",""yr"""
107,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
108,"WITH RECURSIVE ""t1"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t1"" WHERE ""period_start""<""period_end"") SELECT ""t1"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM ""t1"" JOIN ""product"" ON ""t1"".""product_id""=""product"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
109,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
110,"WITH RECURSIVE ""rcte"" AS (SELECT MIN(""period_start"") AS ""dt"" FROM ""sales"" UNION ALL SELECT ""dt"" + INTERVAL '1 DAY' AS ""dt"" FROM ""rcte"" WHERE ""dt""<=(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""r"".""dt"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""rcte"" AS ""r"" ON ""s"".""period_start""<=""r"".""dt"" AND ""s"".""period_end"">=""r"".""dt"" GROUP BY 1,2,3 ORDER BY 1,3"
111,"WITH RECURSIVE ""year_ranges"" AS (SELECT MIN(EXTRACT(YEAR FROM ""period_start"")) AS ""yr"" FROM ""sales"" UNION ALL SELECT ""yr""+1 FROM ""year_ranges"" WHERE ""yr""<(SELECT MAX(EXTRACT(YEAR FROM ""period_end"")) FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",CAST(""yr"" AS CHAR) AS ""report_year"",(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=""yr"" AND EXTRACT(YEAR FROM ""period_end"")=""yr"" THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")=""yr"" THEN (CONCAT(""yr"", '-12-31')) - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_end"")=""yr"" THEN ""period_end"" - (CONCAT(""yr"", '-01-01'))+1 ELSE DAYOFYEAR(CONCAT(""yr"", '-12-31')) END)*""average_daily_sales"" AS ""total_amount"" FROM (""product"" AS ""p"" LEFT JOIN ""sales"" AS ""s"" ON ""s"".""product_id""=""p"".""product_id"") JOIN ""year_ranges"" AS ""r"" ON ""yr"" BETWEEN EXTRACT(YEAR FROM ""period_start"") AND EXTRACT(YEAR FROM ""period_end"") ORDER BY ""product_id"",""report_year"""
112,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
113,"ERROR: mysql parse error: line 1 column 465 near ""NCHAR) AS report_year, SUM(average_daily_sales) AS total_amount FROM cte C INNER JOIN Product P ON C.product_id=P.product_id GROUP BY C.product_id, product_name, CAST(EXTRACT(YEAR FROM curr_date) AS NCHAR) ORDER BY C.product_id, report_year "" "
114,"WITH RECURSIVE ""dates"" AS (SELECT MIN(""period_start"") AS ""dte"" FROM ""sales"" UNION ALL SELECT ""dte"" + INTERVAL '1 DAY' AS ""dte"" FROM ""dates"" WHERE ""dte""<(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",TO_CHAR(""d"".""dte"", 'YYYY') AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""sales"" AS ""s"" LEFT JOIN ""dates"" AS ""d"" ON ""d"".""dte"" BETWEEN ""s"".""period_start"" AND ""s"".""period_end"") JOIN ""product"" AS ""p"" USING (""product_id"") GROUP BY 1,2,3 ORDER BY 1,3"
115,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""cte"" WHERE ""period_start"" + INTERVAL '1 DAY'<=""period_end"") SELECT ""cte"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM ""cte"" JOIN ""Product"" AS ""p"" USING (""product_id"") GROUP BY ""product_name"",""report_year"" ORDER BY ""product_id"",""report_year"""
116,"WITH ""a"" AS (SELECT *,CASE WHEN LEAST(CAST('2018-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2018-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2018-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2018-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y18"",CASE WHEN LEAST(CAST('2019-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2019-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2019-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2019-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y19"",CASE WHEN LEAST(CAST('2020-12-31' AS DATE) - ""period_start""+1, 366)-GREATEST(CAST('2020-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2020-12-31' AS DATE) - ""period_start""+1, 366)-GREATEST(CAST('2020-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y20"" FROM ""Sales""), ""uni"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""y18"" AS ""total_amount"" FROM ""a"" UNION SELECT ""product_id"",'2019' AS ""report_year"",""y19"" AS ""total_amount"" FROM ""a"" UNION SELECT ""product_id"",'2020' AS ""report_year"",""y20"" AS ""total_amount"" FROM ""a"") SELECT ""u"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""uni"" AS ""u"" JOIN ""Product"" AS ""p"" ON ""u"".""product_id""=""p"".""product_id"" WHERE ""total_amount""!=0 ORDER BY ""product_id"",""report_year"""
117,"WITH ""a"" AS (SELECT ""product_id"",""average_daily_sales"",CASE WHEN ""period_start""<='2018-12-31' AND ""period_end"">='2019-01-01' THEN CAST('2018-12-31' AS DATE) - ""period_start""+1 WHEN ""period_end""<='2018-12-31' THEN ""period_end"" - ""period_start""+1 ELSE 0 END AS ""sales_2018"",CASE WHEN ""period_start"">='2019-01-01' AND ""period_start""<='2019-12-31' AND ""period_end"">='2020-01-01' THEN CAST('2019-12-31' AS DATE) - ""period_start""+1 WHEN ""period_start""<='2018-12-31' AND ""period_end"">='2020-01-01' THEN 365 WHEN ""period_start""<='2018-12-31' AND ""period_end"">='2019-01-01' AND ""period_end""<'2019-12-31' THEN ""period_end"" - CAST('2019-01-01' AS DATE)+1 WHEN ""period_start"">='2019-01-01' AND ""period_end""<='2019-12-31' THEN ""period_end"" - ""period_start""+1 ELSE 0 END AS ""sales_2019"",CASE WHEN ""period_start"">='2018-01-01' AND ""period_end"">='2020-01-01' THEN ""period_end"" - CAST('2020-01-01' AS DATE)+1 WHEN ""period_start"">='2020-01-01' THEN ""period_end"" - ""period_start""+1 ELSE 0 END AS ""sales_2020"" FROM ""sales""), ""s_2018"" AS (SELECT ""a"".""product_id"",""p"".""product_name"",'2018' AS ""report_year"",""a"".""sales_2018""*""a"".""average_daily_sales"" AS ""total_amount"" FROM ""a"" JOIN ""product"" AS ""p"" ON ""a"".""product_id""=""p"".""product_id"" WHERE ""a"".""sales_2018""!=0), ""s_2019"" AS (SELECT ""a"".""product_id"",""p"".""product_name"",'2019' AS ""report_year"",""a"".""sales_2019""*""a"".""average_daily_sales"" AS ""total_amount"" FROM ""a"" JOIN ""product"" AS ""p"" ON ""a"".""product_id""=""p"".""product_id"" WHERE ""a"".""sales_2019""!=0), ""s_2020"" AS (SELECT ""a"".""product_id"",""p"".""product_name"",'2020' AS ""report_year"",""a"".""sales_2020""*""a"".""average_daily_sales"" AS ""total_amount"" FROM ""a"" JOIN ""product"" AS ""p"" ON ""a"".""product_id""=""p"".""product_id"" WHERE ""a"".""sales_2020""!=0) SELECT * FROM ""s_2018"" UNION ALL SELECT * FROM ""s_2019"" UNION ALL SELECT * FROM ""s_2020"" ORDER BY ""product_id"",""report_year"""
118,"WITH RECURSIVE ""CTE1"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"" FROM ""Sales"" AS ""s"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""CTE1"" AS ""ct"" WHERE ""ct"".""period_start""<""ct"".""period_end"") SELECT ""product_id"",""product_name"",""report_year"",""total_amount"" FROM (SELECT ""c"".""product_id"" AS ""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(""period_start"")*""average_daily_sales"" AS ""total_amount"" FROM ""CTE1"" AS ""c"" LEFT JOIN ""Product"" AS ""p"" ON ""c"".""product_id""=""p"".""product_id"" GROUP BY ""product_id"",""product_name"",""report_year"") AS ""v"" ORDER BY ""product_id"",""report_year"""
119,"WITH ""s"" AS (SELECT ""sales"".""product_id"" AS ""product_id"",""product_name"",""period_start"",""period_end"",""average_daily_sales"" FROM ""sales"" JOIN ""product"" ON ""sales"".""product_id""=""product"".""product_id""), ""s_2018"" AS (SELECT ""product_id"",""product_name"",'2018' AS ""report_year"",CASE WHEN ""period_end""<='2018-12-31' THEN ""average_daily_sales""*(""period_end"" - ""period_start""+1) WHEN ""period_start""<='2018-12-31' THEN ""average_daily_sales""*(CAST('2018-12-31' AS DATE) - ""period_start""+1) ELSE 0 END AS ""total_amount"" FROM ""s""), ""s_2019"" AS (SELECT ""s"".""product_id"" AS ""product_id"",""s"".""product_name"" AS ""product_name"",'2019' AS ""report_year"",CASE WHEN ""period_end""<='2019-12-31' THEN ""average_daily_sales""*(""period_end"" - ""period_start""+1) WHEN ""period_start""<='2019-12-31' THEN ""average_daily_sales""*(CAST('2019-12-31' AS DATE) - ""period_start""+1) ELSE 0 END-""s_2018"".""total_amount"" AS ""total_amount"" FROM ""s"" JOIN ""s_2018"" ON ""s"".""product_id""=""s_2018"".""product_id""), ""s_2020"" AS (SELECT ""s"".""product_id"" AS ""product_id"",""s"".""product_name"" AS ""product_name"",'2020' AS ""report_year"",CASE WHEN ""period_end""<='2020-12-31' THEN ""average_daily_sales""*(""period_end"" - ""period_start""+1) WHEN ""period_start""<='2020-12-31' THEN ""average_daily_sales""*(CAST('2020-12-31' AS DATE) - ""period_start""+1) ELSE 0 END-""s_2018"".""total_amount""-""s_2019"".""total_amount"" AS ""total_amount"" FROM (""s"" JOIN ""s_2018"" ON ""s"".""product_id""=""s_2018"".""product_id"") JOIN ""s_2019"" ON ""s"".""product_id""=""s_2019"".""product_id"") SELECT * FROM (SELECT * FROM ""s_2018"" UNION SELECT * FROM ""s_2019"" UNION SELECT * FROM ""s_2020"" ORDER BY ""product_id"",""report_year"") AS ""u"" WHERE ""total_amount"">0"
120,"SELECT ""u"".""product_id"",""p"".""product_name"",""u"".""report_year"",""u"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(CASE WHEN ""period_end""<='2018-12-31' THEN ""period_end"" ELSE '2018-12-31' END - CASE WHEN ""period_start"">='2018-01-01' THEN ""period_start"" ELSE '2018-01-01' END+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",(CASE WHEN ""period_end""<='2019-12-31' THEN ""period_end"" ELSE '2019-12-31' END - CASE WHEN ""period_start"">='2019-01-01' THEN ""period_start"" ELSE '2019-01-01' END+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",(CASE WHEN ""period_end""<='2020-12-31' THEN ""period_end"" ELSE '2020-12-31' END - CASE WHEN ""period_start"">='2020-01-01' THEN ""period_start"" ELSE '2020-01-01' END+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"") AS ""u"" JOIN ""Product"" AS ""p"" ON ""u"".""product_id""=""p"".""product_id"" WHERE ""u"".""total_amount"">=0 ORDER BY ""u"".""product_id"",""report_year"""
121,"WITH ""table2018"" AS (SELECT ""s"".""product_id"",""p"".""product_name"",'2018' AS ""report_year"",(LEAST(""s"".""period_end"", '2018-12-31') - GREATEST(""s"".""period_start"", '2018-01-01')+1)*""s"".""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" AS ""s"" LEFT JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" WHERE '2018-01-01' BETWEEN ""s"".""period_start"" AND ""s"".""period_end"" OR ""s"".""period_start"" BETWEEN '2018-01-01' AND '2018-12-31'), ""table2019"" AS (SELECT ""s"".""product_id"",""p"".""product_name"",'2019' AS ""report_year"",(LEAST(""s"".""period_end"", '2019-12-31') - GREATEST(""s"".""period_start"", '2019-01-01')+1)*""s"".""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" AS ""s"" LEFT JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" WHERE '2019-01-01' BETWEEN ""s"".""period_start"" AND ""s"".""period_end"" OR ""s"".""period_start"" BETWEEN '2019-01-01' AND '2019-12-31'), ""table2020"" AS (SELECT ""s"".""product_id"",""p"".""product_name"",'2020' AS ""report_year"",(LEAST(""s"".""period_end"", '2020-12-31') - GREATEST(""s"".""period_start"", '2020-01-01')+1)*""s"".""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" AS ""s"" LEFT JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" WHERE '2020-01-01' BETWEEN ""s"".""period_start"" AND ""s"".""period_end"" OR ""s"".""period_start"" BETWEEN '2020-01-01' AND '2020-12-31') SELECT * FROM ""table2018"" UNION ALL (SELECT * FROM ""table2019"") UNION ALL (SELECT * FROM ""table2020"") ORDER BY ""product_id"",""report_year"""
122,"WITH RECURSIVE ""years_table"" AS (SELECT * FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""years_table"" WHERE ""period_start""<""period_end"") SELECT ""a"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""years_table"" AS ""a"" JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
123,"WITH RECURSIVE ""CTE"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""Sales"" UNION ALL SELECT ""date"" + INTERVAL '1 DAY' FROM ""CTE"" WHERE ""date""<=ALL (SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""e"".""date"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""CTE"" AS ""e"" ON ""s"".""period_start""<=""e"".""date"" AND ""s"".""period_end"">=""e"".""date"" GROUP BY 1,2,3 ORDER BY 1,3"
124,"SELECT ""a"".""product_id"",""p"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST('2018-12-31', ""period_end"") - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",(LEAST('2019-12-31', ""period_end"") - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",(LEAST('2020-12-31', ""period_end"") - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"") AS ""a"" LEFT JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""a"".""product_id"" WHERE ""a"".""total_amount"">0 ORDER BY ""a"".""product_id"",""a"".""report_year"""
125,"WITH RECURSIVE ""years"" AS (SELECT 2018 AS ""yr"" UNION ALL SELECT ""yr""+1 FROM ""years"" WHERE ""yr""<2020) SELECT CAST(""p"".""product_id"" AS CHAR(50)) AS ""product_id"",""p"".""product_name"",CAST(""y"".""yr"" AS CHAR(4)) AS ""report_year"",SUM((LEAST(""period_end"", CAST(CONCAT(""yr"", '-12-31') AS DATE)) - GREATEST(""period_start"", CAST(CONCAT(""yr"", '-01-01') AS DATE))+1)*""average_daily_sales"") AS ""total_amount"" FROM (""Product"" AS ""p"" LEFT JOIN ""Sales"" AS ""s"" ON ""p"".""product_id""=""s"".""product_id"") LEFT JOIN ""years"" AS ""y"" ON EXTRACT(YEAR FROM ""period_start"")=""y"".""yr"" OR EXTRACT(YEAR FROM ""period_end"")=""y"".""yr"" OR (EXTRACT(YEAR FROM ""period_start"")<""y"".""yr"" AND ""y"".""yr""<EXTRACT(YEAR FROM ""period_end"")) GROUP BY ""p"".""product_id"",""p"".""product_name"",""y"".""yr"" ORDER BY ""product_id"",""report_year"""
126,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""a"".""product_id"",""b"".""product_name"",CONVERT(EXTRACT(YEAR FROM ""period_start""), CHAR) AS ""report_year"",SUM(""a"".""average_daily_sales"") AS ""total_amount"" FROM ""cte"" AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
127,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
128,"ERROR: mysql parse error: line 1 column 465 near ""NCHAR) AS report_year, SUM(average_daily_sales) AS total_amount FROM cte C INNER JOIN Product P ON C.product_id=P.product_id GROUP BY C.product_id, product_name, CAST(EXTRACT(YEAR FROM curr_date) AS NCHAR) ORDER BY C.product_id, report_year"" "
129,"WITH RECURSIVE ""t1"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t1"" WHERE ""period_start""<""period_end"") SELECT ""t1"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""t1"" LEFT JOIN ""Product"" AS ""p"" USING (""product_id"") GROUP BY 1,2,3 ORDER BY 1,3"
130,"WITH ""cte1"" AS (SELECT *,EXTRACT(YEAR FROM ""period_start"") AS ""year_start"",EXTRACT(YEAR FROM ""period_end"") AS ""year_end"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" - ""period_start""+1 ELSE DATE(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-12-31')) - ""period_start""+1 END AS ""days_year_start"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") THEN 0 ELSE ""period_end"" - DATE(CONCAT(EXTRACT(YEAR FROM ""period_end""), '-01-01'))+1 END AS ""days_year_end"" FROM ""Sales""), ""cte2"" AS (SELECT ""product_id"",""average_daily_sales"",""year_start"" AS ""year"",""days_year_start"" AS ""days"" FROM ""cte1"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""year_end"" AS ""year"",""days_year_end"" AS ""days"" FROM ""cte1"" UNION ALL SELECT ""product_id"",""average_daily_sales"",2019 AS ""year"",365 AS ""days"" FROM ""cte1"" WHERE ""year_end""-""year_start"">1) SELECT ""a"".""product_id"",""b"".""product_name"",CAST(""a"".""year"" AS CHAR) AS ""report_year"",SUM(""a"".""days""*""a"".""average_daily_sales"") AS ""total_amount"" FROM ""cte2"" AS ""a"" LEFT JOIN ""product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" GROUP BY ""a"".""product_id"",""b"".""product_name"",""a"".""year"" ORDER BY ""product_id"",""report_year"""
131,"WITH RECURSIVE ""reports"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",EXTRACT(YEAR FROM ""period_start"") AS ""report_year"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""report_year""+1 FROM ""reports"" WHERE EXTRACT(YEAR FROM ""period_end"")>""report_year"") SELECT ""report"".""product_id"",""prod"".""product_name"",CAST(""report"".""report_year"" AS CHAR(10)) AS ""report_year"",SUM(((CASE WHEN EXTRACT(YEAR FROM ""period_start"")=""report_year"" AND EXTRACT(YEAR FROM ""period_end"")=""report_year"" THEN ""period_end"" - ""period_start"" WHEN EXTRACT(YEAR FROM ""period_start"")=""report_year"" AND EXTRACT(YEAR FROM ""period_end"")>""report_year"" THEN CONCAT(""report_year"", '-12-31') - ""period_start"" WHEN EXTRACT(YEAR FROM ""period_start"")<""report_year"" AND EXTRACT(YEAR FROM ""period_end"")>""report_year"" THEN CONCAT(""report_year"", '-12-31') - CONCAT(""report_year"", '-01-01') ELSE ""period_end"" - CONCAT(""report_year"", '-01-01') END)+1)*""average_daily_sales"") AS ""total_amount"" FROM ""reports"" AS ""report"" JOIN ""Product"" AS ""prod"" ON ""report"".""product_id""=""prod"".""product_id"" GROUP BY ""report"".""product_id"",""prod"".""product_name"",""report"".""report_year"" ORDER BY ""product_id"",""report_year"""
132,"WITH RECURSIVE ""t1"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t1"" WHERE ""period_start""<""period_end"") SELECT ""t1"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""t1"" JOIN ""product"" ON ""t1"".""product_id""=""product"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
133,"WITH ""cte"" AS (SELECT ""Sales"".""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2018 THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")!=2018 THEN CAST('2019-01-01' AS DATE) - ""period_start"" ELSE 0 END AS ""n2018"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN 365 WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN CAST('2020-01-01' AS DATE) - ""period_start"" WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" - CAST('2019-01-01' AS DATE)+1 ELSE 0 END AS ""n2019"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")<2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN ""period_end"" - CAST('2019-12-31' AS DATE) WHEN EXTRACT(YEAR FROM ""period_start"")=2020 THEN ""period_end"" - ""period_start""+1 ELSE 0 END AS ""n2020"",""average_daily_sales"",""product_name"" FROM ""Sales"" JOIN ""Product"" ON ""Sales"".""product_id""=""Product"".""product_id"") SELECT ""product_id"",""product_name"",'2018' AS ""report_year"",""average_daily_sales""*""n2018"" AS ""total_amount"" FROM ""cte"" WHERE ""n2018""!=0 UNION ALL SELECT ""product_id"",""product_name"",'2019' AS ""report_year"",""average_daily_sales""*""n2019"" AS ""total_amount"" FROM ""cte"" WHERE ""n2019""!=0 UNION ALL SELECT ""product_id"",""product_name"",'2020' AS ""report_year"",""average_daily_sales""*""n2020"" AS ""total_amount"" FROM ""cte"" WHERE ""n2020""!=0 ORDER BY ""product_id"",""report_year"""
134,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
135,"WITH ""a"" AS (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE ""period_start""<='2018-12-31' AND ""period_end"">='2018-01-01' UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE ""period_start""<='2019-12-31' AND ""period_end"">='2019-01-01' UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""Sales"" WHERE ""period_start""<='2020-12-31' AND ""period_end"">='2020-01-01') SELECT ""a"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""a"" JOIN ""Product"" AS ""p"" ON ""a"".""product_id""=""p"".""product_id"" ORDER BY 1,3"
136,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
137,"WITH RECURSIVE ""a"" AS (SELECT MIN(""period_start"") AS ""m"" FROM ""Sales"" UNION ALL SELECT ""m"" + INTERVAL '1 DAY' AS ""m"" FROM ""a"" WHERE ""m""<(SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""a"".""m"", 4) AS ""report_year"",""s"".""average_daily_sales""*COUNT(""a"".""m"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""a"" ON ""a"".""m"" BETWEEN ""s"".""period_start"" AND ""s"".""period_end"") LEFT JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
138,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
139,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""average_daily_sales"",""period_start"",""period_end"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM ""cte"" AS ""c"" JOIN ""Product"" AS ""p"" ON ""c"".""product_id""=""p"".""product_id"" WHERE 2018<=EXTRACT(YEAR FROM ""period_start"") AND 2020>=EXTRACT(YEAR FROM ""period_start"") GROUP BY 1,2,3 ORDER BY 1,3"
140,"WITH ""CTE1"" AS (SELECT ""product_id"",(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 THEN CASE WHEN EXTRACT(YEAR FROM ""period_end"")=2018 THEN ""period_end"" - ""period_start""+1 ELSE CAST('2019-01-01' AS DATE) - ""period_start"" END ELSE 0 END) AS ""yr2018"",(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN ""period_end"" - CAST('2018-12-31' AS DATE) WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN 365 WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN CAST('2020-01-01' AS DATE) - ""period_start"" ELSE 0 END) AS ""yr2019"",(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")<2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN ""period_end"" - CAST('2019-12-31' AS DATE) ELSE 0 END) AS ""yr2020"",""average_daily_sales"" FROM ""Sales""), ""CTE2"" AS (SELECT ""CTE1"".""product_id"",""product_name"",""yr2018"",""yr2019"",""yr2020"",""average_daily_sales"" FROM ""CTE1"" JOIN ""Product"" ON ""CTE1"".""product_id""=""Product"".""product_id""), ""CTE3"" AS (SELECT ""product_id"",""product_name"",'2018' AS ""report_year"",SUM(""yr2018""*""average_daily_sales"") AS ""total_amount"" FROM ""CTE2"" GROUP BY ""product_id"",""product_name"" HAVING ""total_amount""!=0 UNION ALL SELECT ""product_id"",""product_name"",'2019' AS ""report_year"",SUM(""yr2019""*""average_daily_sales"") AS ""total_amount"" FROM ""CTE2"" GROUP BY ""product_id"",""product_name"" HAVING ""total_amount""!=0 UNION ALL SELECT ""product_id"",""product_name"",'2020' AS ""report_year"",SUM(""yr2020""*""average_daily_sales"") AS ""total_amount"" FROM ""CTE2"" GROUP BY ""product_id"",""product_name"" HAVING ""total_amount""!=0) SELECT * FROM ""CTE3"" ORDER BY ""product_id"",""report_year"""
141,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""average_daily_sales"",""period_start"",""period_end"" FROM ""sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') AS ""report_year"",COUNT(""c"".""period_start"")*""c"".""average_daily_sales"" AS ""total_amount"" FROM ""cte"" AS ""c"" JOIN ""product"" AS ""p"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
142,"WITH ""flat_sales"" AS (SELECT * FROM ""sales"" AS ""s1"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") UNION SELECT ""product_id"",""period_start"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 THEN '2018-12-31' WHEN EXTRACT(YEAR FROM ""period_start"")=2019 THEN '2019-12-31' ELSE '2020-12-31' END AS ""period_end"",""average_daily_sales"" FROM ""sales"" AS ""s2"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-1 UNION SELECT ""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_end"")=2018 THEN '2018-01-01' WHEN EXTRACT(YEAR FROM ""period_end"")=2019 THEN '2019-01-01' ELSE '2020-01-01' END AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""sales"" AS ""s3"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-1 UNION SELECT ""product_id"",""period_start"",'2018-12-31',""average_daily_sales"" FROM ""sales"" AS ""s4"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-2 UNION SELECT ""product_id"",'2019-01-01','2019-12-31',""average_daily_sales"" FROM ""sales"" AS ""s5"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-2 UNION SELECT ""product_id"",'2020-01-01',""period_end"",""average_daily_sales"" FROM ""sales"" AS ""s6"" WHERE EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"")-2) SELECT ""fs"".""product_id"",""p"".""product_name"",CONVERT(EXTRACT(YEAR FROM ""period_end""), CHAR) AS ""report_year"",SUM((""fs"".""period_end"" - ""fs"".""period_start""+1)*""fs"".""average_daily_sales"") AS ""total_amount"" FROM (""flat_sales"" AS ""fs"") JOIN ""product"" AS ""p"" WHERE ""fs"".""product_id""=""p"".""product_id"" GROUP BY ""fs"".""product_id"",""p"".""product_name"",EXTRACT(YEAR FROM ""period_end"") ORDER BY ""fs"".""product_id"",EXTRACT(YEAR FROM ""period_end"")"
143,"WITH ""s"" AS (SELECT ""product_id"",'2018' AS ""report_year"",CASE WHEN LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')>=0 THEN (LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"" ELSE 0 END AS ""total_amount"" FROM ""Sales"" UNION SELECT ""product_id"",'2019' AS ""report_year"",CASE WHEN LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')>=0 THEN (LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" ELSE 0 END AS ""total_amount"" FROM ""Sales"" UNION SELECT ""product_id"",'2020' AS ""report_year"",CASE WHEN LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')>=0 THEN (LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" ELSE 0 END AS ""total_amount"" FROM ""Sales"") SELECT ""s"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" WHERE ""total_amount"">0 ORDER BY 1,3"
144,"WITH RECURSIVE ""cte"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""sales"" UNION SELECT ""date"" + INTERVAL '1 DAY' FROM ""cte"" WHERE ""date""<=(SELECT MAX(""period_end"") FROM ""sales"")), ""joined"" AS (SELECT ""sales"".""product_id"",""product"".""product_name"",""period_start"",""period_end"",""average_daily_sales"" FROM ""sales"" LEFT JOIN ""product"" ON ""sales"".""product_id""=""product"".""product_id"") SELECT ""joined"".""product_id"",""joined"".""product_name"",LEFT(""e"".""date"", 4) AS ""report_year"",SUM(""joined"".""average_daily_sales"") AS ""total_amount"" FROM ""joined"" JOIN ""CTE"" AS ""e"" ON ""joined"".""period_start""<=""e"".""date"" AND ""joined"".""period_end"">=""e"".""date"" GROUP BY ""product_id"",""product_name"",""report_year"" ORDER BY ""product_id"",""report_year"""
145,"ERROR: mysql parse error: line 1 column 472 near ""NCHAR) as report_year, sum(average_daily_sales) as total_amount from cte c join Product p ON c.product_id = p.product_id GROUP BY c.product_id, YEAR(current_dt) Order by c.product_id, report_year "" "
146,"WITH ""t1"" AS (SELECT *,CASE WHEN CAST('2018-12-31' AS DATE) - ""period_start""+1>0 THEN CAST('2018-12-31' AS DATE) - ""period_start""+1 ELSE 0 END AS ""s_2018"",CASE WHEN CAST('2019-12-31' AS DATE) - ""period_start""+1>0 THEN CAST('2019-12-31' AS DATE) - ""period_start""+1 ELSE 0 END AS ""s_2019"",CASE WHEN CAST('2020-12-31' AS DATE) - ""period_start""+1>0 THEN CAST('2020-12-31' AS DATE) - ""period_start""+1 ELSE 0 END AS ""s_2020"",CASE WHEN CAST('2018-12-31' AS DATE) - ""period_end"">0 THEN CAST('2018-12-31' AS DATE) - ""period_end"" ELSE 0 END AS ""e_2018"",CASE WHEN CAST('2019-12-31' AS DATE) - ""period_end"">0 THEN CAST('2019-12-31' AS DATE) - ""period_end"" ELSE 0 END AS ""e_2019"",CASE WHEN CAST('2020-12-31' AS DATE) - ""period_end"">0 THEN CAST('2020-12-31' AS DATE) - ""period_end"" ELSE 0 END AS ""e_2020"" FROM ""Sales""), ""t2"" AS (SELECT ""product_id"",""average_daily_sales"",(""s_2018""-""e_2018"") AS ""d_2018"",(""s_2019""-""e_2019""-(""s_2018""-""e_2018"")) AS ""d_2019"",(""s_2020""-""e_2020""-(""s_2019""-""e_2019"")) AS ""d_2020"" FROM ""t1""), ""t3"" (""product_id"", ""report_year"", ""total_amount"") AS (SELECT ""product_id"",'2018',""average_daily_sales""*""d_2018"" FROM ""t2"" WHERE ""d_2018"">0 UNION ALL SELECT ""product_id"",'2019',""average_daily_sales""*""d_2019"" FROM ""t2"" WHERE ""d_2019"">0 UNION ALL SELECT ""product_id"",'2020',""average_daily_sales""*""d_2020"" FROM ""t2"" WHERE ""d_2020"">0) SELECT ""t3"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""t3"" LEFT JOIN ""Product"" AS ""p"" ON ""t3"".""product_id""=""p"".""product_id"" ORDER BY ""product_id"",""report_year"""
147,"WITH ""a"" AS (SELECT *,CASE WHEN LEAST(CAST('2018-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2018-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2018-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2018-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y18"",CASE WHEN LEAST(CAST('2019-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2019-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2019-12-31' AS DATE) - ""period_start""+1, 365)-GREATEST(CAST('2019-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y19"",CASE WHEN LEAST(CAST('2020-12-31' AS DATE) - ""period_start""+1, 366)-GREATEST(CAST('2020-12-31' AS DATE) - ""period_end"", 0)<0 THEN 0 ELSE LEAST(CAST('2020-12-31' AS DATE) - ""period_start""+1, 366)-GREATEST(CAST('2020-12-31' AS DATE) - ""period_end"", 0) END*""average_daily_sales"" AS ""y20"" FROM ""Sales""), ""uni"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""y18"" AS ""total_amount"" FROM ""a"" UNION SELECT ""product_id"",'2019' AS ""report_year"",""y19"" AS ""total_amount"" FROM ""a"" UNION SELECT ""product_id"",'2020' AS ""report_year"",""y20"" AS ""total_amount"" FROM ""a"") SELECT ""u"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""uni"" AS ""u"" JOIN ""Product"" AS ""p"" ON ""u"".""product_id""=""p"".""product_id"" WHERE ""total_amount""!=0 ORDER BY ""product_id"",""report_year"""
148,"WITH ""t"" AS (SELECT ""product_id"",CASE WHEN ""period_end""<'2018-01-01' OR ""period_start"">'2018-12-31' THEN 0 WHEN ""period_start""<'2018-01-01' AND ""period_end"">'2018-12-31' THEN CAST('2018-12-31' AS DATE) - CAST('2018-01-01' AS DATE)+1 WHEN ""period_start"">='2018-01-01' AND ""period_end""<='2018-12-31' THEN ""period_end"" - ""period_start""+1 WHEN ""period_start"">='2018-01-01' AND ""period_end"">'2018-12-31' THEN CAST('2018-12-31' AS DATE) - ""period_start""+1 ELSE ""period_end"" - CAST('2018-01-01' AS DATE)+1 END AS ""days_18"",CASE WHEN ""period_end""<'2019-01-01' OR ""period_start"">'2019-12-31' THEN 0 WHEN ""period_start""<'2019-01-01' AND ""period_end"">'2019-12-31' THEN CAST('2019-12-31' AS DATE) - CAST('2019-01-01' AS DATE)+1 WHEN ""period_start"">='2019-01-01' AND ""period_end""<='2019-12-31' THEN ""period_end"" - ""period_start""+1 WHEN ""period_start"">='2019-01-01' AND ""period_end"">'2019-12-31' THEN CAST('2019-12-31' AS DATE) - ""period_start""+1 ELSE ""period_end"" - CAST('2019-01-01' AS DATE)+1 END AS ""days_19"",CASE WHEN ""period_end""<'2020-01-01' OR ""period_start"">'2020-12-31' THEN 0 WHEN ""period_start""<'2020-01-01' AND ""period_end"">'2020-12-31' THEN CAST('2020-12-31' AS DATE) - CAST('2020-01-01' AS DATE)+1 WHEN ""period_start"">='2020-01-01' AND ""period_end""<='2020-12-31' THEN ""period_end"" - ""period_start""+1 WHEN ""period_start"">='2020-01-01' AND ""period_end"">'2020-12-31' THEN CAST('2020-12-31' AS DATE) - ""period_start""+1 ELSE ""period_end"" - CAST('2020-01-01' AS DATE)+1 END AS ""days_20"" FROM ""Sales"") SELECT * FROM (SELECT ""s"".""product_id"",""product_name"",'2018' AS ""report_year"",""days_18""*""average_daily_sales"" AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") JOIN ""t"" ON ""s"".""product_id""=""t"".""product_id"" AND ""days_18"">0 UNION SELECT ""s"".""product_id"",""product_name"",'2019' AS ""report_year"",""days_19""*""average_daily_sales"" AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") JOIN ""t"" ON ""s"".""product_id""=""t"".""product_id"" AND ""days_19"">0 UNION SELECT ""s"".""product_id"",""product_name"",'2020' AS ""report_year"",""days_20""*""average_daily_sales"" AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") JOIN ""t"" ON ""s"".""product_id""=""t"".""product_id"" AND ""days_20"">0) AS ""t"" ORDER BY ""product_id"",""report_year"""
149,"WITH RECURSIVE ""cte"" AS (SELECT MIN(EXTRACT(YEAR FROM ""period_start"")) AS ""start_year"",MAX(EXTRACT(YEAR FROM ""period_end"")) AS ""end_year"" FROM ""sales""), ""cte1"" AS (SELECT ""start_year"" AS ""report_year"" FROM ""cte"" UNION ALL SELECT ""report_year""+1 FROM (""cte1"") JOIN ""cte"" WHERE ""report_year""<""end_year"") SELECT ""Sales"".""product_id"",""Product"".""product_name"",CAST(""cte1"".""report_year"" AS CHAR) AS ""report_year"",(CASE WHEN EXTRACT(YEAR FROM ""period_end"")!=""cte1"".""report_year"" THEN CAST(CONCAT(CAST(""cte1"".""report_year"" AS CHAR), '12', '31') AS DATE) ELSE ""period_end"" END - CASE WHEN EXTRACT(YEAR FROM ""period_start"")!=""cte1"".""report_year"" THEN CAST(CONCAT(CAST(""cte1"".""report_year"" AS CHAR), '01', '01') AS DATE) ELSE ""period_start"" END+1)*""average_daily_sales"" AS ""total_amount"" FROM (""Sales"" LEFT JOIN ""Product"" ON ""Sales"".""product_id""=""Product"".""product_id"") LEFT JOIN ""cte1"" ON ""cte1"".""report_year"">=EXTRACT(YEAR FROM ""period_start"") AND ""cte1"".""report_year""<=EXTRACT(YEAR FROM ""period_end"") ORDER BY 1,3"
150,"WITH RECURSIVE ""t1"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t1"" WHERE ""period_start""<""period_end"") SELECT ""t1"".""product_id"",""product_name"",LEFT(""period_start"", 4) AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""t1"" JOIN ""product"" ON ""t1"".""product_id""=""product"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
151,"WITH RECURSIVE ""CTE"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""Sales"" UNION ALL SELECT ""date"" + INTERVAL '1 DAY' FROM ""CTE"" WHERE ""date""<=ALL (SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""e"".""date"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""CTE"" AS ""e"" ON ""s"".""period_start""<=""e"".""date"" AND ""s"".""period_end"">=""e"".""date"" GROUP BY 1,2,3 ORDER BY 1,3"
152,"ERROR: mysql parse error: line 1 column 255 near ""NCHAR) as report_year, count(period_start) * average_daily_sales as total_amount from t1 INNER join product as p on t1.product_id = p.product_id group by 1, 3 order by 1, 3 "" "
153,"WITH RECURSIVE ""seq"" AS (SELECT ""product_id"",EXTRACT(YEAR FROM ""period_start"") AS ""report_year"",EXTRACT(YEAR FROM ""period_end"") AS ""year_end"" FROM ""sales"" UNION ALL SELECT ""product_id"",""report_year""+1,""year_end"" FROM ""seq"" WHERE ""report_year""<""year_end"") SELECT ""s"".""product_id"",""p"".""product_name"",CONVERT(""seq"".""report_year"", CHAR) AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") THEN ""s"".""average_daily_sales""*(""period_end"" - ""period_start""+1) WHEN EXTRACT(YEAR FROM ""period_start"")=""report_year"" THEN (DATE(CONCAT(EXTRACT(YEAR FROM ""period_start""), '-12-31')) - ""period_start""+1)*""s"".""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_end"")=""report_year"" THEN (""period_end"" - DATE(CONCAT(EXTRACT(YEAR FROM ""period_end""), '-01-01'))+1)*""s"".""average_daily_sales"" ELSE 365*""s"".""average_daily_sales"" END AS ""total_amount"" FROM (""sales"" AS ""s"" LEFT JOIN ""seq"" ON ""s"".""product_id""=""seq"".""product_id"") LEFT JOIN ""product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" ORDER BY 1,3"
154,"WITH RECURSIVE ""cte"" (""report_year"") AS (SELECT 2018 UNION ALL SELECT ""report_year""+1 FROM ""cte"" WHERE ""report_year""<=2020) SELECT ""s"".""product_id"",""p"".""product_name"",CAST(""report_year"" AS CHAR(4)) AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")!=EXTRACT(YEAR FROM ""period_end"") AND ""report_year""=EXTRACT(YEAR FROM ""period_start"") THEN CONCAT(""report_year"", '-12-31') - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")!=EXTRACT(YEAR FROM ""period_end"") AND ""report_year""=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" - CONCAT(""report_year"", '-1-1')+1 ELSE CONCAT(""report_year"", '-12-31') - CONCAT(""report_year"", '-1-1')+1 END*""average_daily_sales"" AS ""total_amount"" FROM (""cte"" RIGHT JOIN ""sales"" AS ""s"" ON ""cte"".""report_year"">=EXTRACT(YEAR FROM ""period_start"") AND ""cte"".""report_year""<=EXTRACT(YEAR FROM ""period_end"")) LEFT JOIN ""product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" ORDER BY ""s"".""product_id"",""report_year"""
155,"WITH RECURSIVE ""cte"" AS (SELECT MIN(""period_start"") AS ""day"" FROM ""sales"" UNION ALL SELECT ""day"" + INTERVAL '1 DAY' FROM ""cte"" WHERE ""day""<ALL (SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""b"".""product_id"",""c"".""product_name"",CAST(EXTRACT(YEAR FROM ""a"".""day"") AS CHAR) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""cte"" AS ""a"" JOIN ""sales"" AS ""b"" ON ""a"".""day"">=""b"".""period_start"" AND ""a"".""day""<=""b"".""period_end"") JOIN ""product"" AS ""c"" ON ""b"".""product_id""=""c"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
156,"WITH RECURSIVE ""t1"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t1"" WHERE ""period_start""<""period_end"") SELECT ""t1"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""t1"" JOIN ""product"" ON ""t1"".""product_id""=""product"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
157,"WITH RECURSIVE ""period"" AS (SELECT ""product_id"",'2018-01-01' AS ""start_date"",'2018-12-31' AS ""end_date"" FROM ""product"" UNION ALL SELECT ""product_id"",""start_date"" + INTERVAL '1 YEAR' AS ""start_date"",""end_date"" + INTERVAL '1 YEAR' AS ""end_date"" FROM ""period"" WHERE EXTRACT(YEAR FROM ""start_date"")<2020), ""sales_new"" AS (SELECT ""s"".*,""p"".""start_date"",""p"".""end_date"" FROM ""period"" AS ""p"" JOIN ""sales"" AS ""s"" ON ""p"".""product_id""=""s"".""product_id"" WHERE EXTRACT(YEAR FROM ""p"".""start_date"") BETWEEN EXTRACT(YEAR FROM ""s"".""period_start"") AND EXTRACT(YEAR FROM ""period_end"")), ""sales_final"" AS (SELECT ""product_id"",""average_daily_sales"",CASE WHEN ""period_start"">""start_date"" THEN ""period_start"" ELSE ""start_date"" END AS ""period_start"",CASE WHEN ""period_end""<""end_date"" THEN ""period_end"" ELSE ""end_date"" END AS ""period_end"" FROM ""sales_new"") SELECT ""product_id"",""product_name"",LEFT(""period_end"", 4) AS ""report_year"",(""period_end"" - ""period_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales_final"" JOIN ""Product"" USING (""product_id"") ORDER BY 1,3"
158,"WITH RECURSIVE ""cte"" AS (SELECT MIN(""period_start"") AS ""start_date"" FROM ""sales"" UNION ALL SELECT ""start_date"" + INTERVAL '1 DAY' FROM ""cte"" WHERE ""start_date""<(SELECT MAX(""period_end"") FROM ""Sales"")) SELECT CAST(""product_id"" AS CHAR) AS ""product_id"",""product_name"",CAST(EXTRACT(YEAR FROM ""start_date"") AS CHAR) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (SELECT ""p"".""product_id"",""p"".""product_name"",""cte"".""start_date"",""s"".""average_daily_sales"" FROM (""cte"" LEFT JOIN ""Sales"" AS ""s"" ON ""cte"".""start_date"">=""s"".""period_start"" AND ""cte"".""start_date""<=""s"".""period_end"") RIGHT JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"") AS ""temp"" GROUP BY 1,3 ORDER BY 1,3"
159,"WITH ""distinct_years"" AS (SELECT EXTRACT(YEAR FROM ""period_start"") AS ""years"" FROM ""Sales"" UNION SELECT EXTRACT(YEAR FROM ""period_end"") AS ""years"" FROM ""Sales"" ORDER BY ""years"") SELECT ""sub"".""product_id"",""p"".""product_name"",CAST(""sub"".""years"" AS CHAR) AS ""report_year"",SUM(""sub"".""average_daily_sales""*""sub"".""day_counts"") AS ""total_amount"" FROM (SELECT ""b"".""product_id"",""b"".""average_daily_sales"",""a"".""years"",CASE WHEN ""a"".""years""=EXTRACT(YEAR FROM ""b"".""period_start"") AND ""a"".""years""=EXTRACT(YEAR FROM ""b"".""period_end"") THEN ""b"".""period_end"" - ""b"".""period_start""+1 WHEN ""a"".""years""=EXTRACT(YEAR FROM ""b"".""period_start"") THEN DATE(CONCAT(""a"".""years"", '-12-31')) - ""b"".""period_start""+1 WHEN ""a"".""years""=EXTRACT(YEAR FROM ""b"".""period_end"") THEN ""b"".""period_end"" - DATE(CONCAT(""a"".""years"", '-01-01'))+1 ELSE DATE(CONCAT(""a"".""years"", '-12-31')) - DATE(CONCAT(""a"".""years"", '-01-01'))+1 END AS ""day_counts"" FROM ""distinct_years"" AS ""a"" LEFT JOIN ""Sales"" AS ""b"" ON ""a"".""years"" BETWEEN EXTRACT(YEAR FROM ""b"".""period_start"") AND EXTRACT(YEAR FROM ""b"".""period_end"") WHERE ""b"".""product_id"" IS NOT NULL ORDER BY ""b"".""product_id"") AS ""sub"" LEFT JOIN ""Product"" AS ""p"" USING (""product_id"") GROUP BY ""sub"".""product_id"",""p"".""product_name"",""sub"".""years"" ORDER BY ""sub"".""product_id"",""sub"".""years"""
160,"WITH RECURSIVE ""cte"" (""s_date"", ""e_date"") AS (SELECT MIN(""period_start"") AS ""s_date"",MAX(""period_end"") AS ""e_date"" FROM ""sales"" UNION ALL SELECT ""s_date"" + INTERVAL '1 DAY' AS ""s_date"",""e_date"" FROM ""cte"" WHERE ""s_date""<""e_date"") SELECT CAST(""p"".""product_id"" AS CHAR(100)) AS ""product_id"",""p"".""product_name"",CAST(EXTRACT(YEAR FROM ""s_date"") AS CHAR(10)) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""product"" AS ""p"" LEFT JOIN ""sales"" AS ""s"" ON ""p"".""product_id""=""s"".""product_id"") LEFT JOIN ""cte"" ON ""cte"".""s_date"" BETWEEN ""s"".""period_start"" AND ""s"".""period_end"" GROUP BY ""product_id"",""product_name"",EXTRACT(YEAR FROM ""s_date"") ORDER BY 1,3"
161,"WITH RECURSIVE ""cte1"" AS (SELECT MIN(""period_start"") AS ""d1"" FROM ""sales"" UNION ALL SELECT ""d1"" + INTERVAL '1 DAY' AS ""d1"" FROM ""cte1"" WHERE ""d1""<=(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""product_id"",""product_name"",LEFT(""d1"", 4) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""sales"" AS ""s"" JOIN ""product"" USING (""product_id"")) JOIN ""cte1"" AS ""c"" ON ""s"".""period_start""<=""c"".""d1"" AND ""s"".""period_end"">=""c"".""d1"" GROUP BY 1,2,3 ORDER BY 1,3"
162,"WITH ""Report"" AS (SELECT ""product_id"",SUM(GREATEST(0, (LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"")) AS ""amount_2018"",SUM(GREATEST(0, (LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"")) AS ""amount_2019"",SUM(GREATEST(0, (LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"")) AS ""amount_2020"" FROM ""Sales"" GROUP BY 1) SELECT * FROM (SELECT ""Report"".""product_id"",""product_name"",'2018' AS ""report_year"",""amount_2018"" AS ""total_amount"" FROM ""Report"" JOIN ""Product"" ON ""Report"".""product_id""=""Product"".""product_id"" WHERE ""amount_2018"">0 UNION ALL SELECT ""Report"".""product_id"",""product_name"",'2019' AS ""report_year"",""amount_2019"" AS ""total_amount"" FROM ""Report"" JOIN ""Product"" ON ""Report"".""product_id""=""Product"".""product_id"" WHERE ""amount_2019"">0 UNION ALL SELECT ""Report"".""product_id"",""product_name"",'2020' AS ""report_year"",""amount_2020"" AS ""total_amount"" FROM ""Report"" JOIN ""Product"" ON ""Report"".""product_id""=""Product"".""product_id"" WHERE ""amount_2020"">0) AS ""tmp"" ORDER BY 1,3"
163,"WITH RECURSIVE ""date_tbl"" AS (SELECT MIN(""period_start"") AS ""day"" FROM ""sales"" UNION SELECT ""day"" + INTERVAL '1 DAY' AS ""day"" FROM ""date_tbl"" WHERE ""day""<(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""product_name"",CAST(EXTRACT(YEAR FROM ""day"") AS CHAR) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""date_tbl"" RIGHT JOIN ""sales"" AS ""s"" ON ""date_tbl"".""day""<=""period_end"" AND ""date_tbl"".""day"">=""period_start"") JOIN ""product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"" GROUP BY 1,3 ORDER BY 1,3"
164,"ERROR: mysql parse error: line 1 column 466 near ""nchar) as report_year, sum(average_daily_sales) as total_amount from cte c inner join product p on c.product_id = p.product_id group by c.product_id, product_name, cast(extract(year from curr_date) as nchar) order by c.product_id, report_year"" "
165,"WITH RECURSIVE ""d"" AS (SELECT MIN(""period_start"") AS ""day"" FROM ""sales"" UNION ALL SELECT ""day"" + INTERVAL '1 DAY' AS ""day"" FROM ""d"" WHERE ""day""<=(SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""d"".""day"", 4) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" LEFT JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") JOIN ""d"" ON ""d"".""day"" BETWEEN ""period_start"" AND ""period_end"" GROUP BY 1,2,3 ORDER BY 1,2"
166,"SELECT ""temp"".""product_id"",""p"".""product_name"",""temp"".""report_year"",""temp"".""total_amount"" FROM (SELECT ""product_id"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"",'2018' AS ""report_year"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"",'2019' AS ""report_year"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"",'2020' AS ""report_year"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""temp"" LEFT JOIN ""Product"" AS ""p"" ON ""temp"".""product_id""=""p"".""product_id"" ORDER BY ""product_id"",""report_year"""
167,"WITH RECURSIVE ""sales_daily"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""period_start"" AS ""dur"" FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""dur"" + INTERVAL '1 DAY' AS ""dur"" FROM ""sales_daily"" WHERE ""dur""<""period_end"") SELECT ""sd"".""product_id"" AS ""product_id"",(SELECT ""p"".""product_name"" FROM ""product"" AS ""p"" WHERE ""p"".""product_id""=""sd"".""product_id"") AS ""product_name"",CAST(EXTRACT(YEAR FROM ""sd"".""dur"") AS CHAR(4)) AS ""report_year"",SUM(""sd"".""average_daily_sales"") AS ""total_amount"" FROM ""sales_daily"" AS ""sd"" GROUP BY ""sd"".""product_id"",EXTRACT(YEAR FROM ""sd"".""dur"") ORDER BY 1,3"
168,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
169,"SELECT ""temp"".""product_id"",""P"".""product_name"",""temp"".""report_year"",""temp"".""total_amount"" FROM (SELECT ""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"",'2018' AS ""report_year"",""product_id"" FROM ""SALES"" WHERE ""period_start""<='2018-12-31' AND ""period_end"">='2018-01-01' UNION ALL SELECT ""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"",'2019' AS ""report_year"",""product_id"" FROM ""SALES"" WHERE ""period_start""<='2019-12-31' AND ""period_end"">='2019-01-01' UNION ALL SELECT ""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"",'2020' AS ""report_year"",""product_id"" FROM ""SALES"" WHERE ""period_start""<='2020-12-31' AND ""period_end"">='2020-01-01') AS ""temp"" LEFT JOIN ""Product"" AS ""P"" ON ""P"".""product_id""=""temp"".""product_id"" ORDER BY ""temp"".""product_id"",""temp"".""report_year"""
170,"WITH RECURSIVE ""cte"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""Sales"" UNION ALL SELECT ""date"" + INTERVAL '1 DAY' FROM ""CTE"" WHERE ""date""<=(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",TO_CHAR(""cte"".""date"", 'YYYY') AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") LEFT JOIN ""cte"" ON ""cte"".""date"" BETWEEN ""s"".""period_start"" AND ""s"".""period_end"" GROUP BY ""s"".""product_id"",""p"".""product_name"",""report_year"" ORDER BY ""s"".""product_id"",""report_year"""
171,"WITH ""cte"" AS (SELECT ""product_id"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")=2018 THEN TIMESTAMPDIFF(DAY, ""period_start"", ""period_end"")+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2018 AND EXTRACT(YEAR FROM ""period_end"")>2018 THEN TIMESTAMPDIFF(DAY, ""period_start"", '2019-01-01') ELSE 0 END*""average_daily_sales"" AS ""year_2018"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN TIMESTAMPDIFF(DAY, ""period_start"", ""period_end"")+1 WHEN EXTRACT(YEAR FROM ""period_start"")<2019 AND EXTRACT(YEAR FROM ""period_end"")=2019 THEN TIMESTAMPDIFF(DAY, '2019-01-01', ""period_end"")+1 WHEN EXTRACT(YEAR FROM ""period_start"")=2019 AND EXTRACT(YEAR FROM ""period_end"")>2019 THEN TIMESTAMPDIFF(DAY, ""period_start"", '2020-01-01') WHEN EXTRACT(YEAR FROM ""period_start"")<2019 AND EXTRACT(YEAR FROM ""period_end"")>2019 THEN 365 ELSE 0 END*""average_daily_sales"" AS ""year_2019"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN TIMESTAMPDIFF(DAY, ""period_start"", ""period_end"")+1 WHEN EXTRACT(YEAR FROM ""period_start"")<2020 AND EXTRACT(YEAR FROM ""period_end"")=2020 THEN TIMESTAMPDIFF(DAY, '2020-01-01', ""period_end"")+1 ELSE 0 END*""average_daily_sales"" AS ""year_2020"" FROM ""sales""), ""cte2"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""year_2018"" AS ""total_amount"" FROM ""cte"" UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""year_2019"" AS ""total_amount"" FROM ""cte"" UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""year_2020"" AS ""total_amount"" FROM ""cte"") SELECT ""cte2"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""cte2"" LEFT JOIN ""product"" AS ""p"" ON ""cte2"".""product_id""=""p"".""product_id"" WHERE ""total_amount""!=0 ORDER BY ""product_id"",""report_year"""
172,"ERROR: mysql parse error: line 1 column 456 near ""nchar) as report_year, sum(average_daily_sales) as total_amount from cte c join Product p using (product_id) group by c.product_id, p.product_name, cast(year(c.curr_date) as nchar) order by c.product_id, report_year"" "
173,"SELECT ""u"".""product_id"" AS ""product_id"",""p"".""product_name"" AS ""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",(LEAST(""period_end"", '2018-12-31') - ""period_start""+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" WHERE ""period_start""<='2018-12-31' UNION SELECT ""product_id"",'2019' AS ""report_year"",(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"" WHERE ""period_start""<='2019-12-31' UNION SELECT ""product_id"",'2020' AS ""report_year"",(""period_end"" - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"" AS ""total_amount"" FROM ""sales"") AS ""u"" JOIN ""product"" AS ""p"" ON ""u"".""product_id""=""p"".""product_id"" WHERE ""total_amount"">0 ORDER BY 1,3"
174,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""average_daily_sales"",""period_start"",""period_end"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') AS ""report_year"",COUNT(""c"".""period_start"")*""c"".""average_daily_sales"" AS ""total_amount"" FROM ""cte"" AS ""c"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
175,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""average_daily_sales"",""period_start"",""period_end"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') AS ""report_year"",COUNT(""c"".""period_start"")*""c"".""average_daily_sales"" AS ""total_amount"" FROM ""cte"" AS ""c"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
176,"WITH RECURSIVE ""sales_daily"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""period_start"" AS ""dur"" FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""dur"" + INTERVAL '1 DAY' AS ""dur"" FROM ""sales_daily"" WHERE ""dur""<""period_end"") SELECT ""sd"".""product_id"" AS ""product_id"",(SELECT ""p"".""product_name"" FROM ""product"" AS ""p"" WHERE ""p"".""product_id""=""sd"".""product_id"") AS ""product_name"",CAST(EXTRACT(YEAR FROM ""sd"".""dur"") AS CHAR(4)) AS ""report_year"",SUM(""sd"".""average_daily_sales"") AS ""total_amount"" FROM ""sales_daily"" AS ""sd"" GROUP BY ""sd"".""product_id"",EXTRACT(YEAR FROM ""sd"".""dur"") ORDER BY 1,3"
177,"WITH RECURSIVE ""t1"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t1"" WHERE ""period_start""<""period_end"") SELECT ""t1"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""t1"" JOIN ""product"" ON ""t1"".""product_id""=""product"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
178,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
179,"WITH ""tmp"" AS (SELECT ""product_id"",""product_name"",""report_year"",""average_daily_sales""*""days"" AS ""total_amount"" FROM (SELECT ""ina"".""product_id"",""ina"".""product_name"",""inb"".""average_daily_sales"",'2018' AS ""report_year"",LEAST(STR_TO_DATE('2018-12-31', '%Y-%m-%d'), ""inb"".""period_end"") - GREATEST('2018-01-01', ""inb"".""period_start"")+1 AS ""days"" FROM ""Product"" AS ""ina"" JOIN ""Sales"" AS ""inb"" ON ""ina"".""product_id""=""inb"".""product_id"" HAVING ""days"">0) AS ""inc"" UNION ALL SELECT ""product_id"",""product_name"",""report_year"",""average_daily_sales""*""days"" AS ""total_amount"" FROM (SELECT ""ina"".""product_id"",""ina"".""product_name"",""inb"".""average_daily_sales"",'2019' AS ""report_year"",LEAST(STR_TO_DATE('2019-12-31', '%Y-%m-%d'), ""inb"".""period_end"") - GREATEST('2019-01-01', ""inb"".""period_start"")+1 AS ""days"" FROM ""Product"" AS ""ina"" JOIN ""Sales"" AS ""inb"" ON ""ina"".""product_id""=""inb"".""product_id"" HAVING ""days"">0) AS ""inc"" UNION ALL SELECT ""product_id"",""product_name"",""report_year"",""average_daily_sales""*""days"" AS ""total_amount"" FROM (SELECT ""ina"".""product_id"",""ina"".""product_name"",""inb"".""average_daily_sales"",'2020' AS ""report_year"",LEAST(STR_TO_DATE('2020-12-31', '%Y-%m-%d'), ""inb"".""period_end"") - GREATEST('2020-01-01', ""inb"".""period_start"")+1 AS ""days"" FROM ""Product"" AS ""ina"" JOIN ""Sales"" AS ""inb"" ON ""ina"".""product_id""=""inb"".""product_id"" HAVING ""days"">0) AS ""inc"") SELECT CONVERT(""product_id"", CHAR) AS ""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""tmp"" ORDER BY ""product_id"",""report_year"""
180,"WITH RECURSIVE ""yr"" AS (SELECT MIN(EXTRACT(YEAR FROM ""period_start"")) AS ""minyr"" FROM ""Sales"" UNION ALL SELECT ""minyr""+1 FROM ""yr"" WHERE ""minyr""<(SELECT MAX(EXTRACT(YEAR FROM ""period_end"")) FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",CAST(""minyr"" AS CHAR) AS ""report_year"",""average_daily_sales""*(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=""minyr"" AND EXTRACT(YEAR FROM ""period_end"")=""minyr"" THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")=""minyr"" THEN (CONCAT(""minyr"", '-12-31')) - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_end"")=""minyr"" THEN ""period_end"" - (CONCAT(""minyr"", '-01-01'))+1 ELSE DAYOFYEAR(CONCAT(""minyr"", '-12-31')) END) AS ""total_amount"" FROM (""Product"" AS ""p"" JOIN ""sales"" AS ""s"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""yr"" ON ""minyr"" BETWEEN EXTRACT(YEAR FROM ""period_start"") AND EXTRACT(YEAR FROM ""period_end"") ORDER BY ""product_id"",""report_year"""
181,"WITH ""Report"" AS (SELECT ""product_id"",SUM(GREATEST(0, (LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1)*""average_daily_sales"")) AS ""amount_2018"",SUM(GREATEST(0, (LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1)*""average_daily_sales"")) AS ""amount_2019"",SUM(GREATEST(0, (LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1)*""average_daily_sales"")) AS ""amount_2020"" FROM ""Sales"" GROUP BY 1) SELECT * FROM (SELECT ""Report"".""product_id"",""product_name"",'2018' AS ""report_year"",""amount_2018"" AS ""total_amount"" FROM ""Report"" JOIN ""Product"" ON ""Report"".""product_id""=""Product"".""product_id"" WHERE ""amount_2018"">0 UNION ALL SELECT ""Report"".""product_id"",""product_name"",'2019' AS ""report_year"",""amount_2019"" AS ""total_amount"" FROM ""Report"" JOIN ""Product"" ON ""Report"".""product_id""=""Product"".""product_id"" WHERE ""amount_2019"">0 UNION ALL SELECT ""Report"".""product_id"",""product_name"",'2020' AS ""report_year"",""amount_2020"" AS ""total_amount"" FROM ""Report"" JOIN ""Product"" ON ""Report"".""product_id""=""Product"".""product_id"" WHERE ""amount_2020"">0) AS ""tmp"" ORDER BY 1,3"
182,"WITH RECURSIVE ""cte1"" AS (SELECT MIN(""period_start"") AS ""d1"" FROM ""sales"" UNION ALL SELECT ""d1"" + INTERVAL '1 DAY' AS ""d1"" FROM ""cte1"" WHERE ""d1""<=(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""product_id"",""product_name"",LEFT(""d1"", 4) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""sales"" AS ""s"" JOIN ""product"" USING (""product_id"")) JOIN ""cte1"" AS ""c"" ON ""s"".""period_start""<=""c"".""d1"" AND ""s"".""period_end"">=""c"".""d1"" GROUP BY 1,2,3 ORDER BY 1,3"
183,"WITH RECURSIVE ""t"" AS (SELECT * FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY',""period_end"",""average_daily_sales"" FROM ""t"" WHERE ""period_start""<""period_end"") SELECT ""t"".""product_id"",""product_name"",TO_CHAR(""period_start"", 'YYYY') AS ""report_year"",COUNT(1)*""average_daily_sales"" AS ""total_amount"" FROM ""t"" JOIN ""Product"" ON ""t"".""product_id""=""product"".""product_id"" GROUP BY ""product_id"",""report_year"" ORDER BY ""product_id"",""product_id"""
184,"WITH RECURSIVE ""yrr"" AS (SELECT MIN(EXTRACT(YEAR FROM ""period_start"")) AS ""yr"" FROM ""sales"" UNION ALL SELECT ""yr""+1 FROM ""yrr"" WHERE ""yr""<(SELECT MAX(EXTRACT(YEAR FROM ""period_end"")) FROM ""sales"")) SELECT ""product_id"",""product_name"",CAST(""report_year"" AS CHAR) AS ""report_year"",""total_amount"" FROM (SELECT ""s"".""product_id"",""p"".""product_name"",""yr"" AS ""report_year"",""average_daily_sales""*(CASE WHEN EXTRACT(YEAR FROM ""period_start"")=""yr"" AND EXTRACT(YEAR FROM ""period_end"")=""yr"" THEN ""period_end"" - ""period_start""+1 WHEN ""yr""=EXTRACT(YEAR FROM ""period_start"") THEN CONCAT(""yr"", '-12-31') - ""period_start""+1 WHEN ""yr""=EXTRACT(YEAR FROM ""period_end"") THEN ""period_end"" - CONCAT(""yr"", '-01-01')+1 ELSE 365 END) AS ""total_amount"",""period_start"",""period_end"" FROM (""sales"" AS ""s"" JOIN ""product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"") JOIN ""yrr"" ORDER BY ""s"".""product_id"") AS ""x"" WHERE ""report_year"" BETWEEN EXTRACT(YEAR FROM ""period_start"") AND EXTRACT(YEAR FROM ""period_end"") ORDER BY 1,3"
185,"WITH RECURSIVE ""cte"" AS (SELECT MIN(""period_start"") AS ""day"" FROM ""Sales"" UNION ALL SELECT ""day"" + INTERVAL '1 DAY' AS ""day"" FROM ""cte"" WHERE ""day""<=ALL (SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""day"", 4) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""Product"" AS ""p"" JOIN ""Sales"" AS ""s"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""cte"" AS ""c"" ON ""c"".""day"">=""s"".""period_start"" AND ""c"".""day""<=""s"".""period_end"" GROUP BY 1,2,3 ORDER BY 1,3"
186,"WITH RECURSIVE ""years"" AS (SELECT 2018 AS ""cyear"",2020 AS ""max_year"" UNION ALL SELECT ""cyear""+1 AS ""cyear"",""max_year"" FROM ""years"" WHERE ""cyear""<""max_year""), ""mast"" AS (SELECT *,CASE WHEN CASE WHEN DATE('2018-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2018-12-31') - ""period_start"" END<0 THEN 0 ELSE CASE WHEN DATE('2018-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2018-12-31') - ""period_start"" END+1 END*""average_daily_sales"" AS ""sales_2018"",(CASE WHEN CASE WHEN DATE('2019-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2019-12-31') - ""period_start"" END<0 THEN 0 ELSE CASE WHEN DATE('2019-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2019-12-31') - ""period_start"" END+1 END-CASE WHEN CASE WHEN DATE('2018-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2018-12-31') - ""period_start"" END<0 THEN 0 ELSE CASE WHEN DATE('2018-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2018-12-31') - ""period_start"" END+1 END)*""average_daily_sales"" AS ""sales_2019"",(CASE WHEN CASE WHEN DATE('2020-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2020-12-31') - ""period_start"" END<0 THEN 0 ELSE CASE WHEN DATE('2020-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2020-12-31') - ""period_start"" END+1 END-(CASE WHEN CASE WHEN DATE('2019-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2019-12-31') - ""period_start"" END<0 THEN 0 ELSE CASE WHEN DATE('2019-12-31') - ""period_start"">""period_end"" - ""period_start"" THEN ""period_end"" - ""period_start"" ELSE DATE('2019-12-31') - ""period_start"" END+1 END))*""average_daily_sales"" AS ""sales_2020"",2018 AS ""year_2018"",2019 AS ""year_2019"",2020 AS ""year_2020"" FROM ""sales""), ""jtab"" AS (SELECT ""cyear"",""product_id"",""sales_2018"" FROM ""years"" JOIN ""mast"" ON ""cyear""=""year_2018"" UNION ALL (SELECT ""cyear"",""product_id"",""sales_2019"" FROM ""years"" JOIN ""mast"" ON ""cyear""=""year_2019"") UNION ALL (SELECT ""cyear"",""product_id"",""sales_2020"" FROM ""years"" JOIN ""mast"" ON ""cyear""=""year_2020"")) SELECT CAST(""p"".""product_id"" AS CHAR) AS ""product_id"",""product_name"",CAST(""cyear"" AS CHAR) AS ""report_year"",""sales_2018"" AS ""total_amount"" FROM ""jtab"" JOIN ""product"" AS ""p"" USING (""product_id"") WHERE ""sales_2018"">0 ORDER BY 1,3"
187,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""average_daily_sales"",""period_start"",""period_end"" FROM ""sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') AS ""report_year"",COUNT(""c"".""period_start"")*""c"".""average_daily_sales"" AS ""total_amount"" FROM ""cte"" AS ""c"" JOIN ""product"" AS ""p"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') ORDER BY ""c"".""product_id"",TO_CHAR(""c"".""period_start"", 'YYYY')"
188,"WITH RECURSIVE ""cte"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""sales"" UNION SELECT ""date"" + INTERVAL '1 DAY' FROM ""cte"" WHERE ""date""<=(SELECT MAX(""period_end"") FROM ""sales"")), ""joined"" AS (SELECT ""sales"".""product_id"",""product"".""product_name"",""period_start"",""period_end"",""average_daily_sales"" FROM ""sales"" LEFT JOIN ""product"" ON ""sales"".""product_id""=""product"".""product_id"") SELECT ""joined"".""product_id"",""joined"".""product_name"",LEFT(""e"".""date"", 4) AS ""report_year"",SUM(""joined"".""average_daily_sales"") AS ""total_amount"" FROM ""joined"" JOIN ""CTE"" AS ""e"" ON ""joined"".""period_start""<=""e"".""date"" AND ""joined"".""period_end"">=""e"".""date"" GROUP BY ""product_id"",""product_name"",""report_year"" ORDER BY ""product_id"",""report_year"""
189,"WITH ""t1"" AS (SELECT ""product_id"",""average_daily_sales""*(LEAST('2018-12-31', ""period_end"") - GREATEST('2018-01-01', ""period_start"")+1) AS ""2018sales"",""average_daily_sales""*(LEAST('2019-12-31', ""period_end"") - GREATEST('2019-01-01', ""period_start"")+1) AS ""2019sales"",""average_daily_sales""*(LEAST('2020-12-31', ""period_end"") - GREATEST('2020-01-01', ""period_start"")+1) AS ""2020sales"" FROM ""Sales""), ""t2"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""2018sales"" AS ""total_amount"" FROM ""t1"" WHERE ""2018sales"">0 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""2019sales"" AS ""total_amount"" FROM ""t1"" WHERE ""2019sales"">0 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""2020sales"" AS ""total_amount"" FROM ""t1"" WHERE ""2020sales"">0 ORDER BY 1,2) SELECT ""t2"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""t2"" JOIN ""Product"" AS ""p"" ON ""t2"".""product_id""=""p"".""product_id"""
190,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""average_daily_sales"",""period_start"",""period_end"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') AS ""report_year"",COUNT(""c"".""period_start"")*""c"".""average_daily_sales"" AS ""total_amount"" FROM ""cte"" AS ""c"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
191,"WITH RECURSIVE ""CTE"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""Sales"" UNION ALL SELECT ""date"" + INTERVAL '1 DAY' FROM ""CTE"" WHERE ""date""<=(SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",TO_CHAR(""e"".""date"", 'YYYY') AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""CTE"" AS ""e"" ON ""s"".""period_start""<=""e"".""date"" AND ""s"".""period_end"">=""e"".""date"" GROUP BY 1,3 ORDER BY 1,3"
192,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
193,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2020 AND EXTRACT(YEAR FROM ""period_end"")>=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
194,"SELECT ""temp"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE ""period_end"">='2018-01-01' AND ""period_start""<='2018-12-31' UNION SELECT ""product_id"",'2019',""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) FROM ""Sales"" WHERE ""period_end"">='2019-01-01' AND ""period_start""<='2019-12-31' UNION SELECT ""product_id"",'2020',""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) FROM ""Sales"" WHERE ""period_end"">='2020-01-01' AND ""period_start""<='2020-12-31') AS ""temp"" JOIN ""Product"" ON ""Product"".""product_id""=""temp"".""product_id"" ORDER BY ""temp"".""product_id"",""report_year"""
195,"WITH RECURSIVE ""caltable"" AS (SELECT MIN(""period_start"") AS ""day"" FROM ""sales"" UNION ALL SELECT ""day"" + INTERVAL '1 DAY' AS ""day"" FROM ""caltable"" WHERE ""day""<(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""day"", 'YYYY') AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""caltable"" AS ""c"" JOIN ""sales"" AS ""s"" ON ""c"".""day"" BETWEEN ""s"".""period_start"" AND ""s"".""period_end"") JOIN ""product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" GROUP BY ""s"".""product_id"",EXTRACT(YEAR FROM ""c"".""day"") ORDER BY ""s"".""product_id"",""report_year"""
196,"WITH ""t"" AS (SELECT ""product_id"",""average_daily_sales"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")='2018' AND EXTRACT(YEAR FROM ""period_end"")='2018' THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")='2018' AND EXTRACT(YEAR FROM ""period_end"")>'2018' THEN CAST('2018-12-31' AS DATE) - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")<'2018' AND EXTRACT(YEAR FROM ""period_end"")>'2018' THEN CAST('2019-12-31' AS DATE) - CAST('2019-1-1' AS DATE)+1 WHEN EXTRACT(YEAR FROM ""period_start"")<'2018' AND EXTRACT(YEAR FROM ""period_end"")='2018' THEN ""period_end"" - CAST('2019-1-1' AS DATE)+1 ELSE 0 END AS ""2018_"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")<'2019' AND EXTRACT(YEAR FROM ""period_end"")='2019' THEN ""period_end"" - CAST('2019-1-1' AS DATE)+1 WHEN EXTRACT(YEAR FROM ""period_start"")<'2019' AND EXTRACT(YEAR FROM ""period_end"")>'2019' THEN CAST('2019-12-31' AS DATE) - CAST('2019-1-1' AS DATE)+1 WHEN EXTRACT(YEAR FROM ""period_start"")='2019' AND EXTRACT(YEAR FROM ""period_end"")='2019' THEN ""period_end"" - ""period_start""+1 WHEN EXTRACT(YEAR FROM ""period_start"")='2019' AND EXTRACT(YEAR FROM ""period_end"")>'2019' THEN CAST('2019-12-31' AS DATE) - ""period_start""+1 ELSE 0 END AS ""2019_"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")<'2020' AND EXTRACT(YEAR FROM ""period_end"")='2020' THEN ""period_end"" - CAST('2020-1-1' AS DATE)+1 WHEN EXTRACT(YEAR FROM ""period_start"")<'2020' AND EXTRACT(YEAR FROM ""period_end"")>'2020' THEN CAST('2020-12-31' AS DATE) - CAST('2020-1-1' AS DATE)+1 WHEN EXTRACT(YEAR FROM ""period_start"")='2020' AND EXTRACT(YEAR FROM ""period_end"")='2020' THEN ""period_end"" - ""period_start""+1 ELSE 0 END AS ""2020_"" FROM ""Sales"") SELECT * FROM (SELECT ""product_id"",""product_name"",'2018' AS ""report_year"",""2018_""*""average_daily_sales"" AS ""total_amount"" FROM ""t"" JOIN ""Product"" USING (""product_id"") WHERE ""2018_""!=0 UNION ALL SELECT ""product_id"",""product_name"",'2019' AS ""report_year"",""2019_""*""average_daily_sales"" AS ""total_amount"" FROM ""t"" JOIN ""Product"" USING (""product_id"") WHERE ""2019_""!=0 UNION ALL SELECT ""product_id"",""product_name"",'2020' AS ""report_year"",""2020_""*""average_daily_sales"" AS ""total_amount"" FROM ""t"" JOIN ""Product"" USING (""product_id"") WHERE ""2020_""!=0) AS ""t"" ORDER BY ""product_id"",""report_year"""
197,"WITH RECURSIVE ""sales_daily"" AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""period_start"" AS ""dur"" FROM ""sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""dur"" + INTERVAL '1 DAY' AS ""dur"" FROM ""sales_daily"" WHERE ""dur""<""period_end"") SELECT ""sd"".""product_id"" AS ""product_id"",(SELECT ""p"".""product_name"" FROM ""product"" AS ""p"" WHERE ""p"".""product_id""=""sd"".""product_id"") AS ""product_name"",CAST(EXTRACT(YEAR FROM ""sd"".""dur"") AS CHAR(4)) AS ""report_year"",SUM(""sd"".""average_daily_sales"") AS ""total_amount"" FROM ""sales_daily"" AS ""sd"" GROUP BY ""sd"".""product_id"",EXTRACT(YEAR FROM ""sd"".""dur"") ORDER BY 1,3"
198,"SELECT ""s"".""product_id"",""product_name"",'2018' AS ""report_year"",SUM(CASE WHEN '2018' BETWEEN LEFT(""period_start"", 4) AND LEFT(""period_end"", 4) THEN (LEAST('2018-12-31', ""period_end"") - GREATEST('2018-01-01', ""period_start"")+1)*""average_daily_sales"" ELSE 0 END) AS ""total_amount"" FROM ""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" GROUP BY ""s"".""product_id"" HAVING ""total_amount"">0 UNION ALL SELECT ""s"".""product_id"",""product_name"",'2019' AS ""report_year"",SUM(CASE WHEN '2019' BETWEEN LEFT(""period_start"", 4) AND LEFT(""period_end"", 4) THEN (LEAST('2019-12-31', ""period_end"") - GREATEST('2019-01-01', ""period_start"")+1)*""average_daily_sales"" ELSE 0 END) AS ""total_amount"" FROM ""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" GROUP BY ""s"".""product_id"" HAVING ""total_amount"">0 UNION ALL SELECT ""s"".""product_id"",""product_name"",'2020' AS ""report_year"",SUM(CASE WHEN '2020' BETWEEN LEFT(""period_start"", 4) AND LEFT(""period_end"", 4) THEN (LEAST('2020-12-31', ""period_end"") - GREATEST('2020-01-01', ""period_start"")+1)*""average_daily_sales"" ELSE 0 END) AS ""total_amount"" FROM ""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""s"".""product_id""=""p"".""product_id"" GROUP BY ""s"".""product_id"" HAVING ""total_amount"">0 ORDER BY 1,3"
199,"WITH ""T1"" AS (SELECT * FROM (SELECT ""product_id"",'2018' AS ""year"",(LEAST('2018-12-31', ""period_end"") - GREATEST('2018-01-01', ""period_start"")+1)*""average_daily_sales"" AS ""total_sales"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 GROUP BY ""product_id"",""year"" UNION ALL SELECT ""product_id"",'2019' AS ""year"",(LEAST('2019-12-31', ""period_end"") - GREATEST('2019-01-01', ""period_start"")+1)*""average_daily_sales"" AS ""total_sales"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 GROUP BY ""product_id"",""year"" UNION ALL SELECT ""product_id"",'2020' AS ""year"",(LEAST('2020-12-31', ""period_end"") - GREATEST('2020-01-01', ""period_start"")+1)*""average_daily_sales"" AS ""total_sales"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020 GROUP BY ""product_id"",""year"") AS ""A"") SELECT ""T1"".""product_id"",""P"".""product_name"",""T1"".""year"" AS ""report_year"",""T1"".""total_sales"" AS ""total_amount"" FROM ""T1"" JOIN ""Product"" AS ""P"" ON ""T1"".""product_id""=""P"".""product_id"" ORDER BY ""T1"".""product_id"",""report_year"""
200,"WITH RECURSIVE ""cte"" AS (SELECT * FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""cte"".""product_id"",""p"".""product_name"",TO_CHAR(""cte"".""period_start"", 'YYYY') AS ""report_year"",SUM(""cte"".""average_daily_sales"") AS ""total_amount"" FROM ""cte"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""cte"".""product_id"" GROUP BY 1,2,3 ORDER BY 1"
201,"ERROR: mysql parse error: line 1 column 269 near ""nchar) as product_id, product_name, cast(year(calendar_date) as nchar) as report_year, sum(coalesce(average_daily_sales, 0)) as total_amount from cte_spine as sp left join Sales on sp.calendar_date between Sales.period_start and Sales.period_end left join Product as p on p.product_id = Sales.product_id group by 1, 2, 3 having total_amount > 0 order by 1, 3 ) select * from cte_join_agg"" "
202,"WITH ""sales_by_year"" AS (SELECT ""product_id"",""average_daily_sales""*GREATEST(LEAST('2018-12-31', ""period_end"") - GREATEST(""period_start"", '2018-01-01')+1, 0) AS ""sales_2018"",""average_daily_sales""*GREATEST(LEAST('2019-12-31', ""period_end"") - GREATEST(""period_start"", '2019-01-01')+1, 0) AS ""sales_2019"",""average_daily_sales""*GREATEST(LEAST('2020-12-31', ""period_end"") - GREATEST(""period_start"", '2020-01-01')+1, 0) AS ""sales_2020"" FROM ""Sales""), ""sales_by_year_unpivot"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""sales_2018"" AS ""total_amount"" FROM ""sales_by_year"" UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""sales_2019"" AS ""total_amount"" FROM ""sales_by_year"" UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""sales_2020"" AS ""total_amount"" FROM ""sales_by_year"") SELECT CAST(""a"".""product_id"" AS CHAR) AS ""PRODUCT_ID"",""a"".""product_name"" AS ""PRODUCT_NAME"",""b"".""report_year"" AS ""REPORT_YEAR"",""b"".""total_amount"" AS ""TOTAL_AMOUNT"" FROM ""Product"" AS ""a"" JOIN ""sales_by_year_unpivot"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" WHERE ""b"".""total_amount""!=0 ORDER BY CAST(""a"".""product_id"" AS CHAR),""b"".""report_year"""
203,"WITH ""tmp2018"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""period_start"",CASE WHEN ""period_end"">'2018-12-31' THEN DATE('2018-12-31') ELSE ""period_end"" END AS ""period_end"",""average_daily_sales"" FROM ""sales"" WHERE ""period_start""<'2019-01-01'), ""tmp2019"" AS (SELECT ""product_id"",'2019' AS ""report_year"",CASE WHEN ""period_start""<'2019-01-01' THEN DATE('2019-01-01') ELSE ""period_start"" END AS ""period_start"",CASE WHEN ""period_end"">'2019-12-31' THEN DATE('2019-12-31') ELSE ""period_end"" END AS ""period_end"",""average_daily_sales"" FROM ""sales"" WHERE ""period_start""<'2020-01-01' AND ""period_end"">'2018-12-31'), ""tmp2020"" AS (SELECT ""product_id"",'2020' AS ""report_year"",CASE WHEN ""period_start""<'2020-01-01' THEN DATE('2020-01-01') ELSE ""period_start"" END AS ""period_start"",""period_end"",""average_daily_sales"" FROM ""sales"" WHERE ""period_end"">'2019-12-31') (SELECT ""a"".""product_id"",""product_name"",""report_year"",""average_daily_sales""*(""period_end"" - ""period_start""+1) AS ""total_amount"" FROM ""tmp2018"" AS ""a"" JOIN ""product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"") UNION ALL (SELECT ""a"".""product_id"",""product_name"",""report_year"",""average_daily_sales""*(""period_end"" - ""period_start""+1) AS ""total_amount"" FROM ""tmp2019"" AS ""a"" JOIN ""product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"") UNION ALL (SELECT ""a"".""product_id"",""product_name"",""report_year"",""average_daily_sales""*(""period_end"" - ""period_start""+1) AS ""total_amount"" FROM ""tmp2020"" AS ""a"" JOIN ""product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"") ORDER BY ""product_id"",""report_year"""
204,"WITH RECURSIVE ""cte"" AS (SELECT MIN(""period_start"") AS ""date"" FROM ""sales"" UNION SELECT ""date"" + INTERVAL '1 DAY' FROM ""cte"" WHERE ""date""<=(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""s"".""product_id"",""p"".""product_name"",LEFT(""e"".""date"", 4) AS ""report_year"",SUM(""s"".""average_daily_sales"") AS ""total_amount"" FROM (""Sales"" AS ""s"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""s"".""product_id"") JOIN ""CTE"" AS ""e"" ON ""s"".""period_start""<=""e"".""date"" AND ""s"".""period_end"">=""e"".""date"" GROUP BY ""product_id"",""product_name"",""report_year"" ORDER BY ""product_id"",""report_year"""
205,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
206,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""average_daily_sales"",""period_start"",""period_end"" FROM ""sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') AS ""report_year"",COUNT(""c"".""period_start"")*""c"".""average_daily_sales"" AS ""total_amount"" FROM ""cte"" AS ""c"" JOIN ""product"" AS ""p"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY ""c"".""product_id"",""p"".""product_name"",""report_year"" ORDER BY ""c"".""product_id"",""report_year"""
207,"WITH RECURSIVE ""CTE"" AS (SELECT ""product_id"",""average_daily_sales"",""period_start"",""period_end"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"" FROM ""CTE"" WHERE ""period_start""<""period_end"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') AS ""report_year"",COUNT(""c"".""period_start"")*""c"".""average_daily_sales"" AS ""total_amount"" FROM ""CTE"" AS ""c"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY ""c"".""product_id"",TO_CHAR(""c"".""period_start"", 'YYYY') ORDER BY ""c"".""product_id"",""report_year"""
208,"WITH ""sales_2018"" AS (SELECT ""product_id"",""period_start"",""adj_period_end"" AS ""period_end"",""average_daily_sales"",""adj_period_end"" - ""period_start""+1 AS ""num_days"",'2018' AS ""report_year"" FROM (SELECT *,CASE WHEN ""period_end"">'2018-12-31' THEN '2018-12-31' ELSE ""period_end"" END AS ""adj_period_end"" FROM ""Sales"" WHERE ""period_start""<'2019-01-01') AS ""sub""), ""sales_2019"" AS (SELECT ""product_id"",""adj_period_start"" AS ""period_start"",""adj_period_end"" AS ""period_end"",""average_daily_sales"",""adj_period_end"" - ""adj_period_start""+1 AS ""num_days"",'2019' AS ""report_year"" FROM (SELECT *,CASE WHEN ""period_start""<'2019-01-01' THEN '2019-01-01' ELSE ""period_start"" END AS ""adj_period_start"",CASE WHEN ""period_end"">'2019-12-31' THEN '2019-12-31' ELSE ""period_end"" END AS ""adj_period_end"" FROM ""Sales"" WHERE ""period_start""<'2020-01-01' AND ""period_end"">'2018-12-31') AS ""sub""), ""sales_2020"" AS (SELECT *,""period_end"" - CAST('2019-12-31' AS DATE) AS ""num_days"",'2020' AS ""report_year"" FROM ""Sales"" WHERE ""period_end"">'2019-12-31') SELECT ""sub"".""product_id"",""product_name"",""report_year"",SUM(""num_days"")*""average_daily_sales"" AS ""total_amount"" FROM ((SELECT * FROM ""sales_2018"") UNION ALL (SELECT * FROM ""sales_2019"") UNION ALL (SELECT * FROM ""sales_2020"")) AS ""sub"" LEFT JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""sub"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,2"
209,"WITH ""table2018"" AS (SELECT ""product_id"",(1+LEAST(""period_end"", '2018-12-31') - ""period_start"")*""average_daily_sales"" AS ""total_amount"",'2018' AS ""report_year"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018), ""table2019"" AS (SELECT ""product_id"",(1+LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01'))*""average_daily_sales"" AS ""total_amount"",'2019' AS ""report_year"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019), ""table2020"" AS (SELECT ""product_id"",(1+LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01'))*""average_daily_sales"" AS ""total_amount"",'2020' AS ""report_year"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020), ""t"" AS (SELECT * FROM ""table2018"" UNION ALL SELECT * FROM ""table2019"" UNION ALL SELECT * FROM ""table2020"") SELECT ""t"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""t"" JOIN ""Product"" ON ""Product"".""product_id""=""t"".""product_id"" ORDER BY ""product_id"",""report_year"""
210,"WITH RECURSIVE ""cte"" (""product_id"", ""period_start"", ""period_end"", ""average_daily_sales"", ""curr_date"") AS (SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""period_start"" AS ""curr_date"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""period_start"",""period_end"",""average_daily_sales"",""curr_date"" + INTERVAL '1 DAY' AS ""curr_date"" FROM ""cte"" WHERE ""curr_date"" + INTERVAL '1 DAY'<=""period_end"") SELECT ""C"".""product_id"",""product_name"",CAST(EXTRACT(YEAR FROM ""curr_date"") AS CHAR) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM ""cte"" AS ""C"" JOIN ""Product"" ON ""C"".""product_id""=""Product"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
211,"WITH RECURSIVE ""dates_cte"" AS (SELECT MIN(""period_start"") AS ""dt"" FROM ""sales"" UNION ALL SELECT ""dt"" + INTERVAL '1 DAY' AS ""dt"" FROM ""dates_cte"" WHERE ""dt"" + INTERVAL '1 DAY'<=(SELECT MAX(""period_end"") FROM ""sales"")) SELECT ""b"".""product_id"",""c"".""product_name"",CAST(EXTRACT(YEAR FROM ""dt"") AS CHAR) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM ((""dates_cte"" AS ""a"") JOIN ""sales"" AS ""b"") JOIN ""product"" AS ""c"" WHERE ""a"".""dt"" BETWEEN ""b"".""period_start"" AND ""b"".""period_end"" AND ""b"".""product_id""=""c"".""product_id"" GROUP BY ""b"".""product_id"",""c"".""product_name"",EXTRACT(YEAR FROM ""dt"") ORDER BY ""product_id"",EXTRACT(YEAR FROM ""dt"")"
212,"WITH RECURSIVE ""date_d"" AS (SELECT MIN(""period_start"") AS ""report_date"" FROM ""Sales"" UNION SELECT ""report_date"" + INTERVAL '1 DAY' FROM ""date_d"" WHERE ""report_date""<(SELECT MAX(""period_end"") FROM ""Sales"")) SELECT ""Sales"".""product_id"",""product_name"",SUBSTRING(""report_date"", 1, 4) AS ""report_year"",SUM(""average_daily_sales"") AS ""total_amount"" FROM (""Product"" JOIN ""Sales"" USING (""product_id"")) JOIN ""date_d"" ON ""period_start""<=""report_date"" AND ""report_date""<=""period_end"" GROUP BY ""product_id"",""report_year"" ORDER BY ""product_id"",""report_year"""
213,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2018 AND EXTRACT(YEAR FROM ""period_end"")>=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
214,"ERROR: mysql parse error: line 1 column 465 near ""NCHAR) AS report_year, SUM(average_daily_sales) AS total_amount FROM cte C INNER JOIN Product P ON C.product_id=P.product_id GROUP BY C.product_id, product_name, CAST(EXTRACT(YEAR FROM curr_date) AS NCHAR) ORDER BY C.product_id, report_year "" "
215,"WITH ""anual_sales"" AS (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) SELECT ""a"".""product_id"",""product_name"",""report_year"",""total_amount"" FROM ""Product"" AS ""p"" JOIN ""anual_sales"" AS ""a"" ON ""p"".""product_id""=""a"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
216,"ERROR: mysql parse error: line 1 column 401 near ""NCHAR) as report_year, sum(average_daily_sales) as total_amount from cte c join Product p ON c.product_id = p.product_id GROUP BY c.product_id, YEAR(current_dt) Order by c.product_id, report_year "" "
217,"WITH ""temp"" AS (SELECT '2018-01-01' AS ""start_date"",'2018-12-31' AS ""end_date"" UNION ALL SELECT '2019-01-01' AS ""start_date"",'2019-12-31' AS ""end_date"" UNION ALL SELECT '2020-01-01' AS ""start_date"",'2020-12-31' AS ""end_date"") SELECT * FROM (SELECT ""sales"".""product_id"",""product_name"",CAST(EXTRACT(YEAR FROM ""start_date"") AS CHAR) AS ""report_year"",CASE WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""start_date"") AND EXTRACT(YEAR FROM ""period_end"")=EXTRACT(YEAR FROM ""end_date"") THEN ""period_end"" + INTERVAL '1 DAY' - ""period_start""*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")=EXTRACT(YEAR FROM ""start_date"") AND EXTRACT(YEAR FROM ""period_end"")>EXTRACT(YEAR FROM ""end_date"") THEN ""end_date"" + INTERVAL '1 DAY' - ""period_start""*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")<EXTRACT(YEAR FROM ""start_date"") AND EXTRACT(YEAR FROM ""period_end"")>EXTRACT(YEAR FROM ""end_date"") THEN ""end_date"" + INTERVAL '1 DAY' - ""start_date""*""average_daily_sales"" WHEN EXTRACT(YEAR FROM ""period_start"")<EXTRACT(YEAR FROM ""start_date"") AND EXTRACT(YEAR FROM ""period_end"")=EXTRACT(YEAR FROM ""end_date"") THEN ""period_end"" + INTERVAL '1 DAY' - ""start_date""*""average_daily_sales"" END AS ""total_amount"" FROM (""sales"" JOIN ""product"" ON ""sales"".""product_id""=""product"".""product_id"") JOIN ""temp"") AS ""annual_sales"" WHERE ""total_amount"" IS NOT NULL ORDER BY ""product_id"",""report_year"""
218,"SELECT ""a"".""product_id"",""b"".""product_name"",""a"".""report_year"",""a"".""total_amount"" FROM (SELECT ""product_id"",'2018' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2018-12-31') - GREATEST(""period_start"", '2018-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2018 OR EXTRACT(YEAR FROM ""period_end"")=2018 UNION ALL SELECT ""product_id"",'2019' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2019-12-31') - GREATEST(""period_start"", '2019-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")<=2019 AND EXTRACT(YEAR FROM ""period_end"")>=2019 UNION ALL SELECT ""product_id"",'2020' AS ""report_year"",""average_daily_sales""*(LEAST(""period_end"", '2020-12-31') - GREATEST(""period_start"", '2020-01-01')+1) AS ""total_amount"" FROM ""Sales"" WHERE EXTRACT(YEAR FROM ""period_start"")=2020 OR EXTRACT(YEAR FROM ""period_end"")=2020) AS ""a"" LEFT JOIN ""Product"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" ORDER BY ""a"".""product_id"",""a"".""report_year"""
219,"WITH RECURSIVE ""cte"" AS (SELECT ""product_id"",""average_daily_sales"",""period_start"",""period_end"" FROM ""Sales"" UNION ALL SELECT ""product_id"",""average_daily_sales"",""period_start"" + INTERVAL '1 DAY' AS ""period_start"",""period_end"" FROM ""cte"" WHERE ""period_start""<""period_end"") SELECT ""c"".""product_id"",""p"".""product_name"",TO_CHAR(""c"".""period_start"", 'YYYY') AS ""report_year"",COUNT(""c"".""period_start"")*""c"".""average_daily_sales"" AS ""total_amount"" FROM ""cte"" AS ""c"" JOIN ""Product"" AS ""p"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY 1,2,3 ORDER BY 1,3"
