id,original query
1,"WITH RECURSIVE ""cte1"" (""day"") AS (SELECT STR_TO_DATE('2020-01-31', '%Y-%m-%d') UNION ALL SELECT LAST_DAY(""day"" + INTERVAL '1 MONTH') FROM ""cte1"" WHERE ""day""<'2020-12-1'), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""day"") AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""cte1"" LEFT JOIN ""drivers"" ON ""join_date""<=""day"" GROUP BY ""month""), ""cte3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" NATURAL JOIN ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""cte2"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""cte2"" LEFT JOIN ""cte3"" ON ""cte2"".""month""=""cte3"".""month"""
2,"WITH RECURSIVE ""cte"" AS (SELECT ""r"".""ride_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""driver_id"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020), ""month_cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_cte"" WHERE ""month""<=11), ""active_driver_cte"" AS (SELECT ""mc"".""month"",COUNT(""d"".""driver_id"") AS ""dcount"" FROM ""month_cte"" AS ""mc"" LEFT JOIN ""Drivers"" AS ""d"" ON ""d"".""join_date""<=LAST_DAY(CONCAT('2020-', ""mc"".""month"", '-', '01')) GROUP BY ""mc"".""month"") SELECT ""mc"".""month"",CASE WHEN ""a"".""dcount"" IS NULL THEN 0 ELSE ""a"".""dcount"" END AS ""active_drivers"",COUNT(""c"".""driver_id"") AS ""accepted_rides"" FROM (""month_cte"" AS ""mc"" LEFT JOIN ""active_driver_cte"" AS ""a"" ON ""mc"".""month""=""a"".""month"") LEFT JOIN ""cte"" AS ""c"" ON ""mc"".""month""=""c"".""month"" GROUP BY ""mc"".""month"" ORDER BY ""mc"".""month"""
3,"WITH RECURSIVE ""cte_count"" (""n"") AS (SELECT 1 UNION ALL SELECT ""n""+1 FROM ""cte_count"" WHERE ""n""<20) SELECT ""month"",""active_drivers"",""accepted_rides"" FROM (SELECT ""t2"".""cal_year"",""t2"".""cal_month"" AS ""month"",SUM(COALESCE(""cnt"", 0)) OVER (ORDER BY ""t2"".""cal_year"",""t2"".""cal_month"") AS ""active_drivers"",COALESCE(""t4"".""cnt_rides"", 0) AS ""accepted_rides"" FROM ((SELECT EXTRACT(YEAR FROM CAST('2019-09-30' AS DATE) + INTERVAL '""n"" MONTH') AS ""cal_year"",EXTRACT(MONTH FROM CAST('2019-09-30' AS DATE) + INTERVAL '""n"" MONTH') AS ""cal_month"" FROM ""cte_count"") AS ""t2"" LEFT JOIN (SELECT EXTRACT(YEAR FROM ""join_date"") AS ""join_year"",EXTRACT(MONTH FROM ""join_date"") AS ""join_month"",COUNT(""driver_id"") AS ""cnt"" FROM ""Drivers"" GROUP BY EXTRACT(YEAR FROM ""join_date""),EXTRACT(MONTH FROM ""join_date"")) AS ""t1"" ON ""t1"".""join_year""=""t2"".""cal_year"" AND ""t1"".""join_month""=""t2"".""cal_month"") LEFT JOIN (SELECT EXTRACT(YEAR FROM ""r"".""requested_at"") AS ""ride_year"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""ride_month"",COUNT(1) AS ""cnt_rides"" FROM ""RIDES"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY EXTRACT(YEAR FROM ""r"".""requested_at""),EXTRACT(MONTH FROM ""r"".""requested_at"")) AS ""t4"" ON ""t4"".""ride_year""=""t2"".""cal_year"" AND ""t4"".""ride_month""=""t2"".""cal_month"") AS ""t3"" WHERE ""cal_year""=2020"
4,"WITH RECURSIVE ""Month_CTE"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Month_CTE"" WHERE ""month""<12), ""Active_drivers"" AS (SELECT ""m"".""month"",SUM(CASE WHEN ""d"".""month""<=""m"".""month"" THEN ""d"".""driver_counts"" ELSE 0 END) AS ""active_drivers"" FROM ""Month_CTE"" AS ""m"" JOIN (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") AS ""driver_counts"" FROM ""Drivers"" WHERE ""join_date"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1 UNION SELECT 0 AS ""month"",COUNT(""driver_id"") FROM ""Drivers"" WHERE ""join_date""<'2020-01-01') AS ""d"" GROUP BY ""m"".""month"" ORDER BY ""m"".""month""), ""Accepted_Rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""a"".""driver_id"") AS ""accepted_rides"" FROM (SELECT * FROM ""Rides"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY 1) SELECT ""ad"".*,COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""Active_drivers"" AS ""ad"" LEFT JOIN ""Accepted_Rides"" AS ""ar"" ON ""ad"".""month""=""ar"".""month"""
5,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""N_row"" UNION ALL SELECT ""N_row""+1 FROM ""seq"" WHERE ""N_row""<12), ""new_drivers"" AS (SELECT TO_CHAR(""join_date"", '%m') AS ""join_month"",COUNT(DISTINCT ""driver_id"") AS ""N_drivers"" FROM ""Drivers"" AS ""d"" WHERE TO_CHAR(""join_date"", 'YYYY')='2020' GROUP BY 1), ""ride_count"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""ride_month"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" LEFT JOIN ""Rides"" AS ""r"" USING (""ride_id"") WHERE TO_CHAR(""requested_at"", 'YYYY')='2020' GROUP BY 1) SELECT ""N_row"" AS ""month"",SUM(COALESCE(""N_drivers"", 0)) OVER (ORDER BY ""N_row"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)+""N_before"" AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ((""seq"" LEFT JOIN ""new_drivers"" AS ""nd"" ON ""seq"".""N_row""=CAST(""nd"".""join_month"" AS INTEGER)) LEFT JOIN ""ride_count"" AS ""rc"" ON ""seq"".""N_row""=CAST(""rc"".""ride_month"" AS INTEGER)) JOIN (SELECT COUNT(DISTINCT ""driver_id"") AS ""N_before"" FROM ""Drivers"" WHERE TO_CHAR(""join_date"", 'YYYY')<'2020') AS ""history"" ORDER BY 1"
6,"ERROR: mysql parse error: line 1 column 70 near ""), d_stat as ( Select m.month, count(driver_id) as active_drivers from m left join Drivers d on (date_add(concat('2020-', m.month, '-01'), INTERVAL 1 MONTH) > d.join_date) group by month ), a_rides2020 as ( select month(requested_at) as month, count(*) as accepted_rides from AcceptedRides a join Rides USING(ride_id) where year(requested_at) = '2020' group by month ) select month, active_drivers, coalesce(accepted_rides, 0) as accepted_rides from d_stat left join a_rides2020 USING(month) "" "
7,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12) SELECT ""m"".*,COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""t"".""month"",COUNT(""d"".""driver_id"") AS ""active_drivers"" FROM ""t"" LEFT JOIN ""Drivers"" AS ""d"" ON STR_TO_DATE(CONCAT('2020-', ""t"".""month"", '-01'), '%Y-%m-%d')>=TO_CHAR(""d"".""join_date"", 'YYYY-%m-01') GROUP BY ""t"".""month"") AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""r"" ON ""m"".""month""=""r"".""month"""
8,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""driver"" AS (SELECT TO_CHAR(""join_date"", 'YYYY-%m-01') AS ""month"",SUM(COUNT(1)) OVER (ORDER BY TO_CHAR(""join_date"", 'YYYY-%m-01')) AS ""active_drivers"" FROM ""drivers"" WHERE ""join_date""<='2020-12-31' GROUP BY 1), ""driver_2020"" AS (SELECT ""month"",""active_drivers"" FROM ""driver"" WHERE TO_CHAR(""driver"".""month"", 'YYYY')=2020), ""accepted_rides"" AS (SELECT TO_CHAR(""rides"".""requested_at"", 'YYYY-%m-01') AS ""month"",COUNT(""AcceptedRides"".""driver_id"") AS ""accepted_rides"" FROM ""rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE ""rides"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT ""cte"".""month"",COALESCE(MAX(""driver_2020"".""active_drivers"") OVER (ORDER BY ""cte"".""month""), 0) AS ""active_drivers"",COALESCE(""accepted_rides"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" LEFT JOIN ""driver_2020"" ON ""cte"".""month""=TO_CHAR(""driver_2020"".""month"", '%c')) LEFT JOIN ""accepted_rides"" ON ""cte"".""month""=TO_CHAR(""accepted_rides"".""month"", '%c')"
9,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""c"".""month"",MAX(COALESCE(""ndriver"", 0)) AS ""active_drivers"",MAX(COALESCE(""nride"", 0)) AS ""accepted_rides"" FROM (""cte"" AS ""c"" LEFT JOIN (SELECT TRIM(BOTH '-' FROM RIGHT(LEFT(""requested_at"", 7), 2)) AS ""month"",COUNT(""r"".""ride_id"") AS ""nride"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE LEFT(""requested_at"", 4)='2020' GROUP BY TRIM(BOTH '-' FROM RIGHT(LEFT(""requested_at"", 7), 2))) AS ""r"" ON ""c"".""month""=""r"".""month"") LEFT JOIN (SELECT LEFT(""join_date"", 7) AS ""ymonth"",COUNT(""driver_id"") OVER (ORDER BY LEFT(""join_date"", 7)) AS ""ndriver"" FROM ""Drivers"") AS ""d"" ON TRIM(BOTH '-' FROM RIGHT(""d"".""ymonth"", 2))<=""c"".""month"" AND LEFT(""d"".""ymonth"", 4)='2020' GROUP BY ""month"" ORDER BY ""c"".""month"""
10,"WITH RECURSIVE ""CTE1"" AS (SELECT '2020-01-01' AS ""date"" UNION SELECT ""date"" + INTERVAL '1 DAY' FROM ""CTE1"" WHERE ""date""<'2020-12-31'), ""CTE2"" AS (SELECT DISTINCT EXTRACT(MONTH FROM ""d1"".""date"") AS ""month"",COUNT(""d2"".""driver_id"") OVER (ORDER BY EXTRACT(MONTH FROM ""d1"".""date"")) AS ""active_drivers"" FROM ""CTE1"" AS ""d1"" LEFT JOIN (SELECT ""driver_id"",CASE WHEN ""join_date""<='2019-12-31' THEN '2020-01-01' ELSE ""join_date"" END AS ""join_date"" FROM ""Drivers"") AS ""d2"" ON ""d1"".""date""=""d2"".""join_date"" ORDER BY 1), ""CTE3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""d2"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""d1"" JOIN ""AcceptedRides"" AS ""d2"" ON ""d1"".""ride_id""=""d2"".""ride_id"" WHERE EXTRACT(YEAR FROM ""d1"".""requested_at"")=2020 GROUP BY 1) SELECT ""d1"".""month"",""d1"".""active_drivers"",COALESCE(""d2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""CTE2"" AS ""d1"" LEFT JOIN ""CTE3"" AS ""d2"" ON ""d1"".""month""=""d2"".""month"" ORDER BY 1"
11,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""N_row"" UNION ALL SELECT ""N_row""+1 FROM ""seq"" WHERE ""N_row""<12), ""new_drivers"" AS (SELECT TO_CHAR(""join_date"", '%m') AS ""join_month"",COUNT(DISTINCT ""driver_id"") AS ""N_drivers"" FROM ""Drivers"" AS ""d"" WHERE TO_CHAR(""join_date"", 'YYYY')='2020' GROUP BY 1), ""ride_count"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""ride_month"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" LEFT JOIN ""Rides"" AS ""r"" USING (""ride_id"") WHERE TO_CHAR(""requested_at"", 'YYYY')='2020' GROUP BY 1) SELECT ""N_row"" AS ""month"",SUM(COALESCE(""N_drivers"", 0)) OVER (ORDER BY ""N_row"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)+""N_before"" AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ((""seq"" LEFT JOIN ""new_drivers"" AS ""nd"" ON ""seq"".""N_row""=CAST(""nd"".""join_month"" AS INTEGER)) LEFT JOIN ""ride_count"" AS ""rc"" ON ""seq"".""N_row""=CAST(""rc"".""ride_month"" AS INTEGER)) JOIN (SELECT COUNT(DISTINCT ""driver_id"") AS ""N_before"" FROM ""Drivers"" WHERE TO_CHAR(""join_date"", 'YYYY')<'2020') AS ""history"" ORDER BY 1"
12,"WITH RECURSIVE ""getMonth"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""getMonth"" WHERE ""month""<12), ""getDates"" AS (SELECT ""month"",LAST_DAY(CONCAT('2020-', ""month"", '-01')) AS ""last_day"" FROM ""getMonth""), ""getRides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month_"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1), ""getDrivers"" AS (SELECT ""month"",SUM(CASE WHEN ""Drivers"".""driver_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""active_drivers"" FROM ""getDates"" LEFT JOIN ""Drivers"" ON ""Drivers"".""join_date""<=""last_day"" GROUP BY 1) SELECT ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""getDrivers"" LEFT JOIN ""getRides"" ON ""month""=""month_"" ORDER BY 1"
13,"WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte1"" WHERE ""month""<12), ""cte2"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""driver_nums"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021 GROUP BY 1), ""cte3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT ""cte1"".""month"" AS ""month"",COALESCE(SUM(""driver_nums"") OVER (ORDER BY ""month""), 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte1"" LEFT JOIN ""cte2"" ON ""cte1"".""month""=""cte2"".""month"") LEFT JOIN ""cte3"" ON ""cte1"".""month""=""cte3"".""month"""
14,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""m"" UNION ALL SELECT ""m""+1 AS ""m"" FROM ""cte"" WHERE ""m""<=11), ""tb2"" AS (SELECT ""cte"".""m"",COUNT(""driver_id"")+(SELECT COUNT(""driver_id"") FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020) AS ""ct"" FROM ""cte"" LEFT JOIN ""drivers"" ON EXTRACT(MONTH FROM ""join_date"")<=""cte"".""m"" AND EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY ""cte"".""m"") SELECT ""tb2"".""m"" AS ""month"",""ct"" AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""tb2"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""m"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""tb3"" ON ""tb2"".""m""=""tb3"".""m"""
15,"WITH ""months"" AS (SELECT 1 AS ""month"" UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12), ""active_drivers_pt1"" AS (SELECT ""d"".""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" AS ""d"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021), ""active_drivers_pt2"" AS (SELECT ""m"".""month"",COUNT(DISTINCT ""driver_id"") AS ""cnt"" FROM ""months"" AS ""m"" LEFT JOIN ""active_drivers_pt1"" AS ""a1"" ON ""a1"".""month""=""m"".""month"" GROUP BY ""m"".""month""), ""active_drivers"" AS (SELECT ""a2"".""month"",SUM(COALESCE(""cnt"", 0)) OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""active_drivers_pt2"" AS ""a2""), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""ad"".""month"",""ad"".""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""active_drivers"" AS ""ad"" LEFT JOIN ""accepted_rides"" AS ""ar"" ON ""ad"".""month""=""ar"".""month"" ORDER BY ""ad"".""month"""
16,"WITH ""cte"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COALESCE(MAX(""cnt""), 0) AS ""cnt"" FROM (SELECT ""join_date"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""cnt"" FROM ""drivers"") AS ""t1"" WHERE EXTRACT(YEAR FROM ""join_date"")='2020' GROUP BY 1), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""ride_cnt"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY 1), ""cte3"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 2 AS ""month"" UNION ALL SELECT 3 AS ""month"" UNION ALL SELECT 4 AS ""month"" UNION ALL SELECT 5 AS ""month"" UNION ALL SELECT 6 AS ""month"" UNION ALL SELECT 7 AS ""month"" UNION ALL SELECT 8 AS ""month"" UNION ALL SELECT 9 AS ""month"" UNION ALL SELECT 10 AS ""month"" UNION ALL SELECT 11 AS ""month"" UNION ALL SELECT 12 AS ""month"") SELECT ""cte3"".""month"",CASE WHEN ""cte"".""cnt"" IS NULL THEN COALESCE(MAX(""cnt"") OVER (ORDER BY ""month""), 0) ELSE ""cnt"" END AS ""active_drivers"",COALESCE(""cte2"".""ride_cnt"", 0) AS ""accepted_rides"" FROM (""cte3"" LEFT JOIN ""cte"" ON ""cte3"".""month""=""cte"".""month"") LEFT JOIN ""cte2"" ON ""cte3"".""month""=""cte2"".""month"""
17,"WITH RECURSIVE ""CTE_MONTH"" AS (SELECT '202001' AS ""YYYY_MON"",1 AS ""MON_ID"" UNION ALL SELECT ""YYYY_MON""+1,""MON_ID""+1 FROM ""CTE_MONTH"" WHERE ""MON_ID""<12), ""CTE_DRIVER_FLG"" AS (SELECT ""CM"".""YYYY_MON"" AS ""JOIN_YYYYMM"",0 AS ""DRIVER_FLG"" FROM ""CTE_MONTH"" AS ""CM"" LEFT JOIN ""DRIVERS"" AS ""D"" ON ""CM"".""YYYY_MON""=TO_CHAR(""D"".""JOIN_DATE"", 'YYYY%m') AND ""D"".""JOIN_DATE""<='2020-12-31' WHERE ""D"".""JOIN_DATE"" IS NULL UNION ALL SELECT TO_CHAR(""D"".""JOIN_DATE"", 'YYYY%m'),SUM(1) AS ""DRIVER_FLG"" FROM ""CTE_MONTH"" AS ""CM"" RIGHT JOIN ""DRIVERS"" AS ""D"" ON ""CM"".""YYYY_MON""=TO_CHAR(""D"".""JOIN_DATE"", 'YYYY%m') WHERE ""D"".""JOIN_DATE""<='2020-12-31' GROUP BY 1), ""CTE_ACTIVE_DRIVER"" AS (SELECT ""JOIN_YYYYMM"",SUM(""DRIVER_FLG"") OVER (ORDER BY ""JOIN_YYYYMM"") AS ""ACTIVE_DRI_CNT"" FROM ""CTE_DRIVER_FLG"") SELECT ""CM"".""MON_ID"" AS ""month"",""CAD"".""ACTIVE_DRI_CNT"" AS ""active_drivers"",COUNT(""AR"".""DRIVER_ID"") AS ""accepted_rides"" FROM ((""CTE_MONTH"" AS ""CM"" JOIN ""CTE_ACTIVE_DRIVER"" AS ""CAD"" ON ""CM"".""YYYY_MON""=""CAD"".""JOIN_YYYYMM"") LEFT JOIN ""RIDES"" AS ""R"" ON ""CM"".""YYYY_MON""=TO_CHAR(""R"".""REQUESTED_AT"", 'YYYY%m')) LEFT JOIN ""ACCEPTEDRIDES"" AS ""AR"" ON ""AR"".""RIDE_ID""=""R"".""RIDE_ID"" GROUP BY 1,2"
18,"WITH RECURSIVE ""t2"" AS (SELECT 1 AS ""m"" UNION ALL SELECT ""m""+1 AS ""m"" FROM ""t2"" WHERE ""m""<12), ""t3"" AS (SELECT ""m"",SUM(CASE WHEN (EXTRACT(YEAR FROM ""join_date"")<=2019) OR (EXTRACT(YEAR FROM ""join_date"")=2020 AND EXTRACT(MONTH FROM ""join_date"")<=""m"") THEN 1 ELSE 0 END) AS ""available_drivers"" FROM ""t2"" AS ""a"" JOIN ""drivers"" AS ""b"" GROUP BY ""a"".""m""), ""t1"" AS (SELECT COUNT(1) AS ""c"",EXTRACT(MONTH FROM ""requested_at"") AS ""m"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""t2"".""m"" AS ""month"",""t3"".""available_drivers"" AS ""active_drivers"",COALESCE(""t1"".""c"", 0) AS ""accepted_rides"" FROM (""t2"" LEFT JOIN ""t1"" ON ""t2"".""m""=""t1"".""m"") LEFT JOIN ""t3"" ON ""t2"".""m""=""t3"".""m"""
19,"WITH RECURSIVE ""getMonth"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""getMonth"" WHERE ""month""<12), ""getDates"" AS (SELECT ""month"",LAST_DAY(CONCAT('2020-', ""month"", '-01')) AS ""last_day"" FROM ""getMonth""), ""getRides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month_"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1), ""getDrivers"" AS (SELECT ""month"",SUM(CASE WHEN ""Drivers"".""driver_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""active_drivers"" FROM ""getDates"" LEFT JOIN ""Drivers"" ON ""Drivers"".""join_date""<=""last_day"" GROUP BY 1) SELECT ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""getDrivers"" LEFT JOIN ""getRides"" ON ""month""=""month_"" ORDER BY 1"
20,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""cnt"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY ""month""), ""t3"" AS (SELECT ""t1"".""month"",SUM(COALESCE(""cnt"", 0)) OVER (ORDER BY ""t1"".""month"") AS ""all_drivers"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""month""=""t2"".""month""), ""t4"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""driver_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""a"" RIGHT JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""t3"".""month"",""all_drivers"" AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""t3"" LEFT JOIN ""t4"" ON ""t3"".""month""=""t4"".""month"""
21,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""tmpp"" AS (SELECT ""tmp"".""ride_id"",CASE WHEN EXTRACT(YEAR FROM ""requested_at"")!=2020 THEN -1 ELSE EXTRACT(MONTH FROM ""requested_at"") END AS ""join_month"" FROM (SELECT ""ride_id"" FROM ""AcceptedRides"" JOIN ""Drivers"" ON ""AcceptedRides"".""driver_id""=""Drivers"".""driver_id"") AS ""tmp"" LEFT JOIN ""Rides"" ON ""tmp"".""ride_id""=""Rides"".""ride_id"") SELECT ""a"".""month"",SUM(""month_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"",COALESCE(""b"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""months"".""month"",COALESCE(""month_drivers"", 0) AS ""month_drivers"" FROM ""months"" LEFT JOIN (SELECT COUNT(""driver_id"") AS ""month_drivers"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021 GROUP BY ""join_month"") AS ""tmp"" ON ""months"".""month""=""tmp"".""join_month"") AS ""a"" LEFT JOIN (SELECT COUNT(""ride_id"") AS ""accepted_rides"",""join_month"" AS ""month"" FROM ""tmpp"" GROUP BY ""month"") AS ""b"" ON ""a"".""month""=""b"".""month"""
22,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""month"" WHERE ""month""<12), ""new_drivers"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") AS ""new_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY EXTRACT(MONTH FROM ""join_date"")), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""temp"".""month"" AS ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""m"".""month"" AS ""month"",COALESCE(SUM(""nd2"".""new_drivers"")+(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020), 0) AS ""active_drivers"" FROM (""month"" AS ""m"" LEFT JOIN ""new_drivers"" AS ""nd1"" ON ""m"".""month""=""nd1"".""month"") LEFT JOIN ""new_drivers"" AS ""nd2"" ON ""m"".""month"">=""nd2"".""month"" GROUP BY ""m"".""month"") AS ""temp"" LEFT JOIN ""accepted_rides"" AS ""a"" ON ""temp"".""month""=""a"".""month"""
23,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""mon"" UNION ALL SELECT ""mon""+1 AS ""mon"" FROM ""month"" WHERE ""mon""<12), ""t1"" AS ((SELECT 1 AS ""mon"",COUNT(""driver_id"") AS ""cn"" FROM ""Drivers"" WHERE TO_CHAR(""join_date"", 'YYYY-%m')<='2020-01') UNION (SELECT EXTRACT(MONTH FROM ""join_date""),COUNT(""driver_id"") AS ""cn"" FROM ""Drivers"" WHERE TO_CHAR(""join_date"", 'YYYY-%m') BETWEEN '2020-02' AND '2020-12' GROUP BY TO_CHAR(""join_date"", 'YYYY-%m'))), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mon"",COUNT(""a"".""ride_id"") AS ""cn1"" FROM ""acceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""m"".""mon"" AS ""month"",SUM(""cn"") OVER (ORDER BY ""m"".""mon"") AS ""active_drivers"",COALESCE(""cn1"", 0) AS ""accepted_rides"" FROM (""month"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""mon""=""t1"".""mon"") LEFT JOIN ""t2"" ON ""m"".""mon""=""t2"".""mon"""
24,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT CASE WHEN ""join_date""<='2020-01-31' THEN 1 WHEN ""join_date""<='2020-02-29' THEN 2 WHEN ""join_date""<='2020-03-31' THEN 3 WHEN ""join_date""<='2020-04-30' THEN 4 WHEN ""join_date""<='2020-05-31' THEN 5 WHEN ""join_date""<='2020-06-30' THEN 6 WHEN ""join_date""<='2020-07-31' THEN 7 WHEN ""join_date""<='2020-08-31' THEN 8 WHEN ""join_date""<='2020-09-30' THEN 9 WHEN ""join_date""<='2020-10-31' THEN 10 WHEN ""join_date""<='2020-11-30' THEN 11 WHEN ""join_date""<='2020-12-31' THEN 12 END AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31' GROUP BY CASE WHEN ""join_date""<='2020-01-31' THEN 1 WHEN ""join_date""<='2020-02-29' THEN 2 WHEN ""join_date""<='2020-03-31' THEN 3 WHEN ""join_date""<='2020-04-30' THEN 4 WHEN ""join_date""<='2020-05-31' THEN 5 WHEN ""join_date""<='2020-06-30' THEN 6 WHEN ""join_date""<='2020-07-31' THEN 7 WHEN ""join_date""<='2020-08-31' THEN 8 WHEN ""join_date""<='2020-09-30' THEN 9 WHEN ""join_date""<='2020-10-31' THEN 10 WHEN ""join_date""<='2020-11-30' THEN 11 WHEN ""join_date""<='2020-12-31' THEN 12 END), ""CTE3"" AS (SELECT ""d1"".""month"",SUM(""active_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""CTE1"" AS ""d1"" LEFT JOIN ""CTE2"" AS ""d2"" ON ""d1"".""month""=""d2"".""month""), ""CTE4"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""d1"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""d1"" JOIN ""AcceptedRides"" AS ""d2"" ON ""d1"".""ride_id""=""d2"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""d1"".""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""CTE3"" AS ""d1"" LEFT JOIN ""CTE4"" AS ""d2"" ON ""d1"".""month""=""d2"".""month"" ORDER BY 1"
25,"WITH ""rec"" AS (WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12) SELECT * FROM ""seq""), ""d_agg"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")>2020 THEN NULL ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month_2020"",COUNT(DISTINCT ""driver_id"") AS ""ct"" FROM ""drivers"" GROUP BY 1), ""ac_d"" AS (SELECT ""r"".""month"",SUM(COALESCE(""d"".""ct"", 0)) OVER (ORDER BY ""r"".""month"") AS ""ac_drivers"" FROM ""rec"" AS ""r"" LEFT JOIN ""d_agg"" AS ""d"" ON ""r"".""month""=""d"".""join_month_2020""), ""ac_r"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""ac_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""ac_d"".""month"" AS ""month"",""ac_d"".""ac_drivers"" AS ""active_drivers"",COALESCE(""ac_r"".""ac_rides"", 0) AS ""accepted_rides"" FROM ""ac_d"" LEFT JOIN ""ac_r"" ON ""ac_d"".""month""=""ac_r"".""month"""
26,"WITH ""tp"" AS (SELECT ""m"".""month"",SUM(COUNT(""driver_id"")) OVER (ORDER BY ""m"".""month"") AS ""active_drivers"" FROM (SELECT 1 AS ""month"" UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12) AS ""m"" LEFT JOIN (SELECT ""driver_id"",CASE WHEN ""join_date""<DATE('2020-01-01') THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""clean_month"" FROM ""drivers"" WHERE ""join_date""<DATE('2021-01-01')) AS ""s"" ON ""s"".""clean_month""=""m"".""month"" GROUP BY 1) SELECT ""tp"".*,CASE WHEN ""s"".""cnt"" IS NULL THEN 0 ELSE ""s"".""cnt"" END AS ""accepted_rides"" FROM ""tp"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mm"",COUNT(""a"".""ride_id"") AS ""cnt"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""requested_at"">=DATE('2020-01-01') AND ""requested_at""<=DATE('2020-12-31') GROUP BY 1) AS ""s"" ON ""tp"".""month""=""s"".""mm"""
27,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""temp"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",MAX(""drivers"") AS ""drivers"" FROM (SELECT ""join_date"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""drivers"" FROM ""Drivers"") AS ""t"" WHERE ""join_date"">='2020-01-01' AND ""join_date""<='2020-12-31' GROUP BY EXTRACT(MONTH FROM ""join_date"")), ""temp1"" AS (SELECT ""month"",MAX(""drivers"") OVER (ORDER BY ""month"") AS ""drivers"" FROM (SELECT ""cte"".""month"",CASE WHEN ""drivers"" IS NULL THEN 0 ELSE ""drivers"" END AS ""drivers"" FROM ""cte"" LEFT JOIN ""temp"" ON ""cte"".""month""=""temp"".""month"") AS ""t""), ""temp2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""requested_at"">='2020-01-01' AND ""requested_at""<='2020-12-31' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""temp1"".""month"",""drivers"" AS ""active_drivers"",CASE WHEN ""rides"" IS NULL THEN 0 ELSE ""rides"" END AS ""accepted_rides"" FROM ""temp1"" LEFT JOIN ""temp2"" ON ""temp1"".""month""=""temp2"".""month"" ORDER BY ""month"""
28,"WITH ""cte"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""rnk"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""cte2"" AS (SELECT ""month"",COUNT(1) AS ""cnt"" FROM (SELECT ""y"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" AS ""x"" JOIN ""AcceptedRides"" AS ""y"" ON ""x"".""ride_id""=""y"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""a"" GROUP BY 1), ""cte3"" AS (WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<=11) SELECT * FROM ""cte"") SELECT ""x"".""month"",MAX(COALESCE(""y"".""rnk"", 0)) AS ""active_drivers"",MAX(COALESCE(""z"".""cnt"", 0)) AS ""accepted_rides"" FROM (""cte3"" AS ""x"" LEFT JOIN ""cte"" AS ""y"" ON ""x"".""month"">=""y"".""month"") LEFT JOIN ""cte2"" AS ""z"" ON ""x"".""month""=""z"".""month"" GROUP BY 1"
29,"WITH RECURSIVE ""all_months"" (""dates"") AS (SELECT LEAST(MIN(""join_date""), '2020-01-01') AS ""dates"" FROM ""Drivers"" UNION SELECT ""dates"" + INTERVAL '1 MONTH' FROM ""all_months"" WHERE EXTRACT(YEAR FROM ""dates"")<2021), ""drivers_joined1"" AS (SELECT EXTRACT(YEAR FROM ""join_date"") AS ""year"",EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") AS ""new_drivers"" FROM ""Drivers"" GROUP BY EXTRACT(YEAR FROM ""join_date""),EXTRACT(MONTH FROM ""join_date"")), ""drivers_joined2"" AS (SELECT EXTRACT(YEAR FROM ""am"".""dates"") AS ""year"",EXTRACT(MONTH FROM ""am"".""dates"") AS ""month"",COALESCE(""d"".""new_drivers"", 0) AS ""new_drivers"" FROM ""all_months"" AS ""am"" LEFT JOIN ""drivers_joined1"" AS ""d"" ON EXTRACT(YEAR FROM ""am"".""dates"")=""d"".""year"" AND EXTRACT(MONTH FROM ""am"".""dates"")=""d"".""month"" ORDER BY ""year"",""month""), ""drivers_joined_rolling"" AS (SELECT ""year"",""month"",SUM(""new_drivers"") OVER (ORDER BY ""year"",""month"") AS ""active_drivers"" FROM ""drivers_joined2""), ""rides_2020"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""ar"".""driver_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""d"".""month"",""d"".""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""drivers_joined_rolling"" AS ""d"" LEFT JOIN ""rides_2020"" AS ""r"" ON ""d"".""month""=""r"".""month"" WHERE ""d"".""year""=2020"
30,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""n"" UNION ALL SELECT ""n""+1 AS ""n"" FROM ""cte"" WHERE ""n""<12), ""acc"" AS (SELECT ""requested_at"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""totdrivers"" AS (SELECT ""n"" AS ""month"",(SELECT COUNT(1) FROM ""drivers"" WHERE ((EXTRACT(YEAR FROM ""join_date"")=2020 AND EXTRACT(MONTH FROM ""join_date"")<=""c"".""n"") OR (EXTRACT(YEAR FROM ""join_date"")<2020))) AS ""active_drivers"",(SELECT COUNT(1) FROM ""acc"" WHERE (EXTRACT(MONTH FROM ""requested_at"")=""c"".""n"")) AS ""accepted_rides"" FROM ""cte"" AS ""c"") SELECT * FROM ""totdrivers"""
31,"WITH RECURSIVE ""M"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""M"" WHERE ""month""<12), ""D1"" AS (SELECT ""driver_id"",CASE WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-01' THEN 1 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-02' THEN 2 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-03' THEN 3 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-04' THEN 4 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-05' THEN 5 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-06' THEN 6 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-07' THEN 7 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-08' THEN 8 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-09' THEN 9 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-10' THEN 10 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-11' THEN 11 WHEN TO_CHAR(""join_date"", 'YYYY-%m')='2020-12' THEN 12 ELSE 1 END AS ""month"" FROM ""Drivers"" WHERE ""join_date""<'2021-01-01'), ""D2"" AS (SELECT ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""D1"" GROUP BY ""month""), ""MD1"" AS (SELECT ""M"".""month"",COALESCE(""D2"".""active_drivers"", 0) AS ""active_drivers"" FROM ""M"" LEFT JOIN ""D2"" ON ""M"".""month""=""D2"".""month""), ""MD2"" AS (SELECT ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""MD1""), ""R1"" AS (SELECT ""ride_id"",CASE WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-01' THEN 1 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-02' THEN 2 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-03' THEN 3 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-04' THEN 4 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-05' THEN 5 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-06' THEN 6 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-07' THEN 7 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-08' THEN 8 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-09' THEN 9 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-10' THEN 10 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-11' THEN 11 WHEN TO_CHAR(""requested_at"", 'YYYY-%m')='2020-12' THEN 12 END AS ""month"" FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"")), ""R2"" AS (SELECT ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""R1"" GROUP BY ""month"") SELECT ""MD2"".""month"",""MD2"".""active_drivers"",COALESCE(""R2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""MD2"" LEFT JOIN ""R2"" ON ""MD2"".""month""=""R2"".""month"""
32,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""AR"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""AR"" ON EXTRACT(YEAR FROM ""R"".""requested_at"")='2020' AND ""R"".""ride_id""=""AR"".""ride_id"" GROUP BY ""month""), ""active_drivers"" AS (SELECT ""C"".""month"",COALESCE(COUNT(""driver_id""), 0) AS ""active_drivers"" FROM ""cte"" AS ""C"" LEFT JOIN ""drivers"" AS ""D"" ON TO_CHAR(""D"".""join_date"", 'YYYY-%m')<=TO_CHAR(CONCAT('2020-', ""C"".""month"", '-01'), 'YYYY-%m') GROUP BY ""month"") SELECT ""AD"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""active_drivers"" AS ""AD"" LEFT JOIN ""accepted_rides"" AS ""AR"" ON ""AD"".""month""=""AR"".""month"""
33,"WITH RECURSIVE ""dte"" AS (SELECT 1 AS ""Month"" UNION SELECT ""month""+1 AS ""Month"" FROM ""dte"" WHERE ""Month""<12), ""cte"" AS (SELECT LEFT(""join_date"", 7) AS ""Month"",COUNT(""driver_id"") AS ""Total"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31' GROUP BY LEFT(""join_date"", 7)), ""ete"" AS (SELECT ""Month"",SUM(""Total"") OVER (ORDER BY ""Month"") AS ""Total"" FROM ""cte""), ""fte"" AS (SELECT RIGHT(""Month"", 2) AS ""Month"",""Total"" AS ""active_drivers"" FROM ""ete"" WHERE LEFT(""Month"", 4)='2020'), ""gte"" AS (SELECT ""dte"".""Month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"" FROM ""dte"" LEFT JOIN ""fte"" ON ""dte"".""month""=""fte"".""month""), ""hte"" AS (SELECT ""Month"",MAX(""active_drivers"") OVER (ORDER BY ""Month"") AS ""active_drivers"" FROM ""gte""), ""ite"" AS (SELECT EXTRACT(MONTH FROM ""requested_At"") AS ""Month"",COUNT(""AcceptedRides"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" JOIN ""Acceptedrides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_At"")='2020' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""hte"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""hte"" LEFT JOIN ""ite"" ON ""hte"".""month""=""ite"".""month"""
34,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")=2020 THEN EXTRACT(MONTH FROM ""join_date"") ELSE 0 END AS ""driver_month"" FROM ""drivers""), ""t3"" AS (SELECT ""month"",COUNT(1) AS ""cnt1"" FROM ""t1"" JOIN ""t2"" ON ""month""=""driver_month"" GROUP BY ""month""), ""t4"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""cnt2"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""t1"".""month"",SUM(COALESCE(""cnt1"", 0)) OVER (ORDER BY ""t1"".""month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"",COALESCE(""cnt2"", 0) AS ""accepted_rides"" FROM (""t1"" LEFT JOIN ""t3"" ON ""t1"".""month""=""t3"".""month"") LEFT JOIN ""t4"" ON ""t1"".""month""=""t4"".""month"""
35,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12), ""driver_m"" AS (SELECT ""d"".*,CASE WHEN EXTRACT(YEAR FROM ""d"".""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""d"".""join_date"") END AS ""month"" FROM ""drivers"" AS ""d"" WHERE ""d"".""join_date""<'2021-01-01'), ""seq_dri"" AS (SELECT ""seq"".""month"",COUNT(""d"".""month"") AS ""active_drivers"" FROM ""seq"" LEFT JOIN ""driver_m"" AS ""d"" ON ""seq"".""month"">=""d"".""month"" GROUP BY ""seq"".""month""), ""acc_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM (""rides"" AS ""r"") JOIN ""acceptedrides"" AS ""ar"" WHERE ""r"".""ride_id""=""ar"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""dm"".""month"",""dm"".""active_drivers"",CASE WHEN ""ar"".""accepted_rides"" IS NULL THEN 0 ELSE ""ar"".""accepted_rides"" END AS ""accepted_rides"" FROM ""seq_dri"" AS ""dm"" LEFT JOIN ""acc_rides"" AS ""ar"" ON ""dm"".""month""=""ar"".""month"" ORDER BY ""dm"".""month"""
36,"WITH RECURSIVE ""monthTable"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""monthTable"" WHERE ""month""<12), ""AcceptedDrivers"" AS (SELECT COUNT(""a"".""ride_id"") AS ""accepted_rides"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month""), ""ActiveDrivers"" AS (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) SELECT DISTINCT ""m"".""month"" AS ""month"",COUNT(""a"".""driver_id"") OVER (ORDER BY ""m"".""month"") AS ""active_drivers"",COALESCE(""accept"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""monthTable"" AS ""m"" LEFT JOIN ""ActiveDrivers"" AS ""a"" ON ""m"".""month""=""a"".""month"") LEFT JOIN ""AcceptedDrivers"" AS ""accept"" ON ""m"".""month""=""accept"".""month"""
37,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""Drivers_before_2020"" AS (SELECT COUNT(1) AS ""num"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020), ""Active_Drives"" AS (SELECT ""c"".""month"",SUM(CASE WHEN ""d"".""driver_id"" IS NOT NULL THEN 1 ELSE 0 END) OVER (ORDER BY ""c"".""month"") AS ""active_drivers"" FROM ""cte"" AS ""c"" LEFT JOIN (SELECT * FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020) AS ""d"" ON ""c"".""month""=EXTRACT(MONTH FROM ""d"".""join_date"")), ""AcceptedRides_2020"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""ad"".""month"",""ad"".""active_drivers""+(SELECT ""num"" FROM ""Drivers_before_2020"") AS ""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""Active_Drives"" AS ""ad"" LEFT JOIN ""AcceptedRides_2020"" AS ""ar"" ON ""ad"".""month""=""ar"".""month"""
38,"WITH RECURSIVE ""cte"" AS (SELECT '2020-01-01' AS ""month"" UNION ALL SELECT ""month"" + INTERVAL '1 MONTH' FROM ""cte"" WHERE ""month""<'2020-12-01') SELECT EXTRACT(MONTH FROM ""cte"".""month"") AS ""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COALESCE(""b"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" AS ""cte"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) AS ""b"" ON EXTRACT(MONTH FROM ""cte"".""month"")=""b"".""month"") LEFT JOIN ""drivers"" AS ""c"" ON LAST_DAY(""cte"".""month"")>=""c"".""join_date"" GROUP BY 1 ORDER BY 1"
39,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""rides2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""rides"" FROM ""Rides"" AS ""r1"" LEFT JOIN ""AcceptedRides"" AS ""a1"" ON ""a1"".""ride_id""=""r1"".""ride_id"" WHERE ""a1"".""driver_id"" IS NOT NULL AND ""requested_at"" LIKE '2020%' GROUP BY 1), ""monthsTable"" AS (SELECT ""c1"".""month"",""r1"".""rides"" FROM ""cte"" AS ""c1"" LEFT JOIN ""rides2"" AS ""r1"" ON ""r1"".""month""=""c1"".""month""), ""driversTable"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(1) AS ""drivers"",ROW_NUMBER() OVER (ORDER BY ""join_date"") AS ""rowNum"" FROM ""Drivers"" WHERE ""join_date"" LIKE '2020%' GROUP BY 1), ""driversTable2"" AS (SELECT ""month"",CASE WHEN ""rowNum""=1 THEN ""drivers""+(SELECT COUNT(1) FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020) ELSE ""drivers"" END AS ""drivers2"" FROM ""driversTable"") SELECT ""m1"".""month"",COALESCE(SUM(""drivers2"") OVER (ORDER BY ""m1"".""month""), 0) AS ""active_drivers"",COALESCE(""m1"".""rides"", 0) AS ""accepted_rides"" FROM ""monthsTable"" AS ""m1"" LEFT JOIN ""driversTable2"" AS ""d1"" ON ""m1"".""month""=""d1"".""month"""
40,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT DISTINCT EXTRACT(MONTH FROM CASE WHEN ""join_date""<='2019-12-31' THEN '2020-01-01' ELSE ""join_date"" END) AS ""month"",COUNT(""driver_id"") AS ""active_driver"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31' GROUP BY 1), ""CTE3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""d2"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""d1"" JOIN ""AcceptedRides"" AS ""d2"" ON ""d1"".""ride_id""=""d2"".""ride_id"" WHERE EXTRACT(YEAR FROM ""d1"".""requested_at"")=2020 GROUP BY 1) SELECT ""d1"".""month"",COALESCE(SUM(""d2"".""active_driver"") OVER (ORDER BY ""d1"".""month""), 0) AS ""active_drivers"",COALESCE(""d3"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""CTE1"" AS ""d1"" LEFT JOIN ""CTE2"" AS ""d2"" ON ""d1"".""month""=""d2"".""month"") LEFT JOIN ""CTE3"" AS ""d3"" ON ""d1"".""month""=""d3"".""month"" ORDER BY 1"
41,"WITH RECURSIVE ""month_list"" (""month"") AS (SELECT 1 UNION SELECT ""month""+1 FROM ""month_list"" WHERE ""month""<12), ""accept_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_distance"") AS ""accepted_rides"" FROM ""Rides"" LEFT JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""month_list"".""month"" AS ""month"",COUNT(""driver_id"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month_list"" LEFT JOIN ""accept_rides"" ON ""month_list"".""month""=""accept_rides"".""month"") LEFT JOIN ""Drivers"" ON (EXTRACT(YEAR FROM ""join_date"")=2020 AND EXTRACT(MONTH FROM ""join_date"")<=""month_list"".""month"") OR (EXTRACT(YEAR FROM ""join_date"")<2020) GROUP BY ""month_list"".""month"" ORDER BY ""month_list"".""month"""
42,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""ride_tbl"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""driver_tbl"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY 1) SELECT ""c"".""month"",COALESCE(SUM(""active_drivers"") OVER (ORDER BY ""month""), 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" AS ""c"" LEFT JOIN ""ride_tbl"" AS ""r"" ON ""c"".""month""=""r"".""month"") LEFT JOIN ""driver_tbl"" AS ""d"" ON ""c"".""month""=""d"".""month"""
43,"WITH ""cte"" AS (WITH RECURSIVE ""cte1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte1"" WHERE ""month""<12) SELECT * FROM ""cte1""), ""drivers"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY 1 ORDER BY 1), ""rides"" AS (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT ""cte"".""month"",COALESCE(SUM(""active_drivers"") OVER (ORDER BY ""cte"".""month""), 0) AS ""active_drivers"",COALESCE(""c"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" LEFT JOIN ""drivers"" AS ""a"" ON ""cte"".""month""=""a"".""month"") LEFT JOIN ""rides"" AS ""c"" ON ""cte"".""month""=""c"".""month"""
44,"WITH RECURSIVE ""month_table"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month_table"" WHERE ""month""<12), ""available_drivers"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<'2020' THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<='2020'), ""accumulated_drivers"" AS (SELECT DISTINCT ""month_table"".""month"",COUNT(""driver_id"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""month_table"" LEFT JOIN ""available_drivers"" ON ""month_table"".""month""=""available_drivers"".""month""), ""accepted_rides_per_month"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""AcceptedRides"" JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""month_table"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month_table"" LEFT JOIN ""accumulated_drivers"" ON ""month_table"".""month""=""accumulated_drivers"".""month"") LEFT JOIN ""accepted_rides_per_month"" ON ""month_table"".""month""=""accepted_rides_per_month"".""month"" ORDER BY ""month"""
45,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""m"" UNION SELECT ""m""+1 FROM ""month"" WHERE ""m""<12), ""ad"" AS (SELECT ""driver_id"",CASE WHEN ""join_date""<='2020-1-1' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month"" FROM ""Drivers"" WHERE ""join_date""<'2021-1-1'), ""ar"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""m"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY 1) SELECT DISTINCT ""month"".""m"" AS ""month"",COUNT(""ad"".""driver_id"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month"" LEFT JOIN ""ad"" ON ""month"".""m"">=""ad"".""join_month"") LEFT JOIN ""ar"" ON ""month"".""m""=""ar"".""m"" GROUP BY 1 ORDER BY 1"
46,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 UNION SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""ad"" AS (SELECT ""month"",COUNT(""driver_id"") AS ""cnt"" FROM (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",""driver_id"" FROM ""Drivers"" WHERE ""join_date"" BETWEEN DATE('2020-01-01') AND DATE('2020-12-31') UNION ALL SELECT ""month"",NULL AS ""driver_id"" FROM ""cte"") AS ""t1"" GROUP BY ""month""), ""ar"" AS (SELECT ""month"",COUNT(""ride_id"") AS ""cnt2"" FROM (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN DATE('2020-01-01') AND DATE('2020-12-31') UNION ALL SELECT ""month"",NULL AS ""ride_id"" FROM ""cte"") AS ""t2"" GROUP BY ""month"") SELECT ""ad"".""month"",SUM(""ad"".""cnt"") OVER (ORDER BY ""ad"".""month"")+(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE ""join_date""<DATE('2020-01-01')) AS ""active_drivers"",""ar"".""cnt2"" AS ""accepted_rides"" FROM ""ad"" JOIN ""ar"" ON ""ad"".""month""=""ar"".""month"""
47,"WITH RECURSIVE ""cte_spine"" AS (SELECT 1 AS ""month_num"" UNION ALL SELECT 1+""month_num"" FROM ""cte_spine"" WHERE ""month_num""<12), ""cte_accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""cte_monthly_drivers"" AS (SELECT ""s"".""month_num"" AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""cte_spine"" AS ""s"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT('2020-', LPAD(""s"".""month_num"", 2, '0'), '-01'), '%Y-%m-%d'))>=""d"".""join_date"" GROUP BY 1), ""cte_assemble"" AS (SELECT ""s"".""month_num"" AS ""month"",""md"".""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte_spine"" AS ""s"" LEFT JOIN ""cte_accepted_rides"" AS ""ar"" ON ""s"".""month_num""=""ar"".""month"") LEFT JOIN ""cte_monthly_drivers"" AS ""md"" ON ""s"".""month_num""=""md"".""month"" ORDER BY 1) SELECT * FROM ""cte_assemble"""
48,"WITH ""month_col"" AS (SELECT 1 AS ""month"" UNION SELECT 2 AS ""month"" UNION SELECT 3 AS ""month"" UNION SELECT 4 AS ""month"" UNION SELECT 5 AS ""month"" UNION SELECT 6 AS ""month"" UNION SELECT 7 AS ""month"" UNION SELECT 8 AS ""month"" UNION SELECT 9 AS ""month"" UNION SELECT 10 AS ""month"" UNION SELECT 11 AS ""month"" UNION SELECT 12 AS ""month""), ""new_driver"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") AS ""new"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY 1), ""tmp"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""m"".""month"",(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020)+SUM(COALESCE(""n"".""new"", 0)) OVER (ORDER BY ""m"".""month"") AS ""active_drivers"",COALESCE(""tmp"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month_col"" AS ""m"" LEFT JOIN ""new_driver"" AS ""n"" ON ""m"".""month""=""n"".""month"") LEFT JOIN ""tmp"" ON ""m"".""month""=""tmp"".""month"""
49,"WITH ""rec"" AS (WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12) SELECT * FROM ""seq""), ""d_agg"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")>2020 THEN NULL ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month_2020"",COUNT(DISTINCT ""driver_id"") AS ""ct"" FROM ""drivers"" GROUP BY 1), ""ac_d"" AS (SELECT ""r"".""month"",SUM(COALESCE(""d"".""ct"", 0)) OVER (ORDER BY ""r"".""month"") AS ""ac_drivers"" FROM ""rec"" AS ""r"" LEFT JOIN ""d_agg"" AS ""d"" ON ""r"".""month""=""d"".""join_month_2020""), ""ac_r"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""ac_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""ac_d"".""month"" AS ""month"",""ac_d"".""ac_drivers"" AS ""active_drivers"",COALESCE(""ac_r"".""ac_rides"", 0) AS ""accepted_rides"" FROM ""ac_d"" LEFT JOIN ""ac_r"" ON ""ac_d"".""month""=""ac_r"".""month"""
50,"WITH RECURSIVE ""Month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""Month"" WHERE ""month""<12), ""T1"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""num"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY ""month""), ""T2"" AS (SELECT ""M"".""month"",SUM(COALESCE(""T1"".""num"", 0)) OVER (ORDER BY ""M"".""month"") AS ""active_drivers"" FROM ""Month"" AS ""M"" LEFT JOIN ""T1"" ON ""M"".""month""=""T1"".""month""), ""T3"" AS (SELECT ""T2"".""month"",COUNT(""A"".""ride_id"") AS ""accepted_rides"" FROM (""T2"" LEFT JOIN (SELECT * FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""R"" ON ""T2"".""month""=EXTRACT(MONTH FROM ""R"".""requested_at"")) LEFT JOIN ""AcceptedRides"" AS ""A"" ON ""R"".""ride_id""=""A"".""ride_id"" GROUP BY ""T2"".""month"" ORDER BY ""T2"".""month"") SELECT ""T2"".""month"",""T2"".""active_drivers"",""T3"".""accepted_rides"" FROM ""T2"" JOIN ""T3"" ON ""T2"".""month""=""T3"".""month"" ORDER BY ""T2"".""month"""
51,"WITH RECURSIVE ""monthdim"" AS (SELECT 1 AS ""m"" UNION SELECT ""m""+1 FROM ""monthdim"" WHERE ""m""<12), ""activeDr"" AS (SELECT ""driver_id"",""join_date"" FROM ""drivers"" UNION ALL SELECT ""driver_id"",""join_date"" + INTERVAL '1 MONTH' FROM ""activeDr"" WHERE ""join_date""<STR_TO_DATE('20201201', '%Y%m%d')) SELECT ""md"".""m"" AS ""month"",COALESCE(""ad"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""monthdim"" AS ""md"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""requestedmonth"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) AS ""ar"" ON ""md"".""m""=""ar"".""requestedmonth"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""joinMonth"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"" FROM ""activeDr"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY EXTRACT(MONTH FROM ""join_date"")) AS ""ad"" ON ""joinMonth""=""md"".""m"""
52,"WITH RECURSIVE ""temp_table"" (""n"") AS (SELECT 1 UNION ALL SELECT ""n""+1 FROM ""temp_table"" WHERE ""n""<12), ""t2"" AS (SELECT ""join_year"",""join_month"" FROM (SELECT 2019 AS ""join_year"",""n"" AS ""join_month"" FROM ""temp_table"" UNION SELECT 2020,""n"" FROM ""temp_table"" UNION SELECT 2021,""n"" FROM ""temp_table"") AS ""t1"" WHERE ""join_year""*100+""join_month"" BETWEEN 201912 AND 202101), ""t3"" AS (SELECT EXTRACT(YEAR FROM ""join_date"") AS ""join_year"",EXTRACT(MONTH FROM ""join_date"") AS ""join_month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""Drivers"" GROUP BY EXTRACT(YEAR FROM ""join_date""),EXTRACT(MONTH FROM ""join_date"")), ""t4"" AS (SELECT EXTRACT(YEAR FROM ""r"".""requested_at"") AS ""join_year"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""join_month"",COUNT(1) AS ""cnt"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY EXTRACT(YEAR FROM ""r"".""requested_at""),EXTRACT(MONTH FROM ""r"".""requested_at"")), ""t5"" AS (SELECT ""t2"".""join_year"",""t2"".""join_month"",SUM(COALESCE(""active_drivers"", 0)) OVER (ORDER BY ""t2"".""join_year"",""t2"".""join_month"") AS ""active_drivers"",COALESCE(""cnt"", 0) AS ""accepted_rides"" FROM (""t2"" LEFT JOIN ""t3"" ON ""t2"".""join_year""=""t3"".""join_year"" AND ""t2"".""join_month""=""t3"".""join_month"") LEFT JOIN ""t4"" ON ""t2"".""join_year""=""t4"".""join_year"" AND ""t2"".""join_month""=""t4"".""join_month"") SELECT ""join_month"" AS ""month"",""active_drivers"",""accepted_rides"" FROM ""t5"" WHERE ""join_year""=2020"
53,"SELECT ""column_0"" AS ""month"",(SELECT COUNT(1) FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""column_0"")) AS ""active_drivers"",(SELECT COUNT(1) FROM (""AcceptedRides"") JOIN ""Rides"" WHERE ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" AND ""requested_at""<'2021-01-01' AND ""requested_at"">='2020-01-01' AND EXTRACT(MONTH FROM ""requested_at"")=""column_0"") AS ""accepted_rides"" FROM (VALUES ROW(1), ROW(2), ROW(3), ROW(4), ROW(5), ROW(6), ROW(7), ROW(8), ROW(9), ROW(10), ROW(11), ROW(12)) AS ""months"""
54,"SELECT ""column_0"" AS ""month"",(SELECT COUNT(1) FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""column_0"")) AS ""active_drivers"",(SELECT COUNT(1) FROM (""AcceptedRides"") JOIN ""Rides"" WHERE ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" AND ""requested_at""<'2021-01-01' AND ""requested_at"">='2020-01-01' AND EXTRACT(MONTH FROM ""requested_at"")=""column_0"") AS ""accepted_rides"" FROM (VALUES ROW(1), ROW(2), ROW(3), ROW(4), ROW(5), ROW(6), ROW(7), ROW(8), ROW(9), ROW(10), ROW(11), ROW(12)) AS ""months"""
55,"ERROR: mysql parse error: line 1 column 70 near ""), d_stat as ( Select m.month, count(driver_id) as active_drivers from m left join Drivers d on (date_add(concat('2020-', m.month, '-01'), INTERVAL 1 MONTH) > d.join_date) group by month ), a_rides2020 as ( select month(requested_at) as month, count(*) as accepted_rides from AcceptedRides a join Rides USING(ride_id) where year(requested_at) = '2020' group by month ) select month, active_drivers, coalesce(accepted_rides, 0) as accepted_rides from d_stat left join a_rides2020 USING(month) "" "
56,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""N_row"" UNION ALL SELECT ""N_row""+1 FROM ""seq"" WHERE ""N_row""<12), ""new_drivers"" AS (SELECT TO_CHAR(""join_date"", '%m') AS ""join_month"",COUNT(DISTINCT ""driver_id"") AS ""N_drivers"" FROM ""Drivers"" AS ""d"" WHERE TO_CHAR(""join_date"", 'YYYY')='2020' GROUP BY 1), ""ride_count"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""ride_month"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" LEFT JOIN ""Rides"" AS ""r"" USING (""ride_id"") WHERE TO_CHAR(""requested_at"", 'YYYY')='2020' GROUP BY 1) SELECT ""N_row"" AS ""month"",SUM(COALESCE(""N_drivers"", 0)) OVER (ORDER BY ""N_row"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)+""N_before"" AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ((""seq"" LEFT JOIN ""new_drivers"" AS ""nd"" ON ""seq"".""N_row""=CAST(""nd"".""join_month"" AS INTEGER)) LEFT JOIN ""ride_count"" AS ""rc"" ON ""seq"".""N_row""=CAST(""rc"".""ride_month"" AS INTEGER)) JOIN (SELECT COUNT(DISTINCT ""driver_id"") AS ""N_before"" FROM ""Drivers"" WHERE TO_CHAR(""join_date"", 'YYYY')<'2020') AS ""history"" ORDER BY 1"
57,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""month"" WHERE ""month""<12), ""new_drivers"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") AS ""new_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY EXTRACT(MONTH FROM ""join_date"")), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""temp"".""month"" AS ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""m"".""month"" AS ""month"",COALESCE(SUM(""nd2"".""new_drivers"")+(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020), 0) AS ""active_drivers"" FROM (""month"" AS ""m"" LEFT JOIN ""new_drivers"" AS ""nd1"" ON ""m"".""month""=""nd1"".""month"") LEFT JOIN ""new_drivers"" AS ""nd2"" ON ""m"".""month"">=""nd2"".""month"" GROUP BY ""m"".""month"") AS ""temp"" LEFT JOIN ""accepted_rides"" AS ""a"" ON ""temp"".""month""=""a"".""month"""
58,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""cte2"" AS (SELECT ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""a"" GROUP BY 1), ""cte3"" AS (SELECT EXTRACT(MONTH FROM ""c"".""requested_at"") AS ""join_month"",COUNT(""b"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" AS ""b"" JOIN ""rides"" AS ""c"" ON ""b"".""ride_id""=""c"".""ride_id"" WHERE EXTRACT(YEAR FROM ""c"".""requested_at"")=2020 GROUP BY 1) SELECT ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"",""accepted_rides"" FROM (SELECT ""d"".""month"",COALESCE(""e"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""f"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" AS ""d"" LEFT JOIN ""cte2"" AS ""e"" ON ""d"".""month""=""e"".""month"") LEFT JOIN ""cte3"" AS ""f"" ON ""d"".""month""=""f"".""join_month"") AS ""y"" ORDER BY ""month"""
59,"WITH ""t"" AS (WITH ""t"" AS (WITH ""t"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""m"",COUNT(1) AS ""c"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY EXTRACT(MONTH FROM ""join_date"") UNION ALL SELECT 1,COUNT(1) AS ""c"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020 UNION ALL SELECT 1,0 UNION ALL SELECT 2,0 UNION ALL SELECT 3,0 UNION ALL SELECT 4,0 UNION ALL SELECT 5,0 UNION ALL SELECT 6,0 UNION ALL SELECT 7,0 UNION ALL SELECT 8,0 UNION ALL SELECT 9,0 UNION ALL SELECT 10,0 UNION ALL SELECT 11,0 UNION ALL SELECT 12,0) SELECT ""m"",SUM(""c"") AS ""c"" FROM ""t"" GROUP BY ""m"") SELECT ""m"",SUM(""c"") OVER (ORDER BY ""m"") AS ""c"" FROM ""t""), ""k"" AS (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""m"",COUNT(1) AS ""c"" FROM ""AcceptedRides"" AS ""a"" JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""b"".""requested_at"")) SELECT ""t"".""m"" AS ""month"",""t"".""c"" AS ""active_drivers"",COALESCE(""k"".""c"", 0) AS ""accepted_rides"" FROM ""t"" LEFT JOIN ""k"" ON ""k"".""m""=""t"".""m"" ORDER BY ""t"".""m"""
60,"WITH ""rec"" AS (WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12) SELECT * FROM ""seq""), ""d_agg"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")>2020 THEN NULL ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month_2020"",COUNT(DISTINCT ""driver_id"") AS ""ct"" FROM ""drivers"" GROUP BY 1), ""ac_d"" AS (SELECT ""r"".""month"",SUM(COALESCE(""d"".""ct"", 0)) OVER (ORDER BY ""r"".""month"") AS ""ac_drivers"" FROM ""rec"" AS ""r"" LEFT JOIN ""d_agg"" AS ""d"" ON ""r"".""month""=""d"".""join_month_2020""), ""ac_r"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""ac_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""ac_d"".""month"" AS ""month"",""ac_d"".""ac_drivers"" AS ""active_drivers"",COALESCE(""ac_r"".""ac_rides"", 0) AS ""accepted_rides"" FROM ""ac_d"" LEFT JOIN ""ac_r"" ON ""ac_d"".""month""=""ac_r"".""month"""
61,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""acceptedmonth"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""amonth"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""ar"" WHERE ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(YEAR FROM ""r"".""requested_at""),EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COALESCE(""a"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""acceptedmonth"" AS ""a"" ON ""m"".""month""=""a"".""amonth"" GROUP BY ""m"".""month"""
62,"WITH RECURSIVE ""seq"" AS (SELECT 0 AS ""cnt"",1 AS ""value"" UNION ALL SELECT 0 AS ""cnt"",""value""+1 FROM ""seq"" WHERE ""value""<12), ""rides_2020"" AS (SELECT ""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""dam"" AS (SELECT COUNT(""b"".""ride_id"") AS ""cnt"",""a"".""month"" FROM ""rides_2020"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" GROUP BY 2), ""damn"" AS (SELECT ""a"".""cnt""+COALESCE(""b"".""cnt"", 0) AS ""cnt"",""a"".""value"" AS ""month"" FROM ""seq"" AS ""a"" LEFT JOIN ""dam"" AS ""b"" ON ""a"".""value""=""b"".""month""), ""avp"" AS (SELECT COUNT(""driver_id"") AS ""d_cnt"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020), ""avc"" AS (SELECT COUNT(""driver_id"") AS ""ad_cnt"",EXTRACT(MONTH FROM ""join_date"") AS ""month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY 2), ""avs"" AS (SELECT ""a"".""cnt""+COALESCE(""b"".""ad_cnt"", 0) AS ""cnt"",""a"".""value"" AS ""month"" FROM ""seq"" AS ""a"" LEFT JOIN ""avc"" AS ""b"" ON ""a"".""value""=""b"".""month""), ""avl"" AS (SELECT SUM(""cnt"") OVER (ORDER BY ""month"")+""avp"".""d_cnt"" AS ""cnt"",""month"" FROM (""avs"") JOIN ""avp""), ""final"" AS (SELECT ""avl"".""month"" AS ""month"",""damn"".""cnt"" AS ""d_cnt"",""avl"".""cnt"" AS ""a_cnt"" FROM ""avl"" JOIN ""damn"" ON ""damn"".""month""=""avl"".""month"") SELECT ""month"",""a_cnt"" AS ""active_drivers"",""d_cnt"" AS ""accepted_rides"" FROM ""final"""
63,"WITH RECURSIVE ""tim"" AS (SELECT 1 AS ""mon"" UNION ALL SELECT ""mon""+1 FROM ""tim"" WHERE ""mon""<12), ""tb1"" AS (SELECT *,EXTRACT(MONTH FROM ""requested_at"") AS ""mon"" FROM ""rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""tb2"" AS (SELECT ""mon"",""ride_id"" FROM ""tb1"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"")), ""tb3"" AS (SELECT *,EXTRACT(MONTH FROM ""join_date"") AS ""mon"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020), ""tb4"" AS (SELECT DISTINCT ""mon"",COUNT(""driver_id"") OVER (PARTITION BY ""mon"") AS ""ct"" FROM ""tb3""), ""tb5"" AS (SELECT ""tim"".""mon"" AS ""mon"",COALESCE(""tb4"".""ct"", 0) AS ""ct"" FROM ""tim"" LEFT JOIN ""tb4"" ON ""tim"".""mon""=""tb4"".""mon""), ""tb6"" AS (SELECT 1 AS ""mon"",COUNT(""driver_id"") AS ""d19"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020), ""tb7"" AS (SELECT ""tb5"".""mon"",(COALESCE(""tb6"".""d19"", 0)+""tb5"".""ct"") AS ""ct"" FROM ""tb5"" LEFT JOIN ""tb6"" USING (""mon"")), ""tb8"" AS (SELECT DISTINCT ""mon"",SUM(""ct"") OVER (ORDER BY ""mon"") AS ""dr"" FROM ""tb7""), ""tb9"" AS (SELECT DISTINCT ""mon"",COUNT(""ride_id"") OVER (PARTITION BY ""mon"") AS ""num"" FROM ""tb2"") SELECT ""tb8"".""mon"" AS ""month"",""dr"" AS ""active_drivers"",COALESCE(""num"", 0) AS ""accepted_rides"" FROM ""tb8"" LEFT JOIN ""tb9"" USING (""mon"")"
64,"WITH RECURSIVE ""month"" (""m"") AS (SELECT 1 UNION SELECT ""m""+1 FROM ""month"" WHERE ""m""<12), ""driver_month"" AS (SELECT ""driver_id"",EXTRACT(MONTH FROM ""join_date"") AS ""mon"",EXTRACT(YEAR FROM ""join_date"") AS ""yea"",""join_date"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021), ""driver"" AS (SELECT ""mon"",""active"" FROM (SELECT ""join_date"",""mon"",""yea"",COUNT(""driver_id"") OVER (ORDER BY ""yea"",""mon"") AS ""active"" FROM ""driver_month"") AS ""d"" WHERE ""yea""=2020), ""ride_month"" AS (SELECT ""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""mon"" FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"")), ""ride"" AS (SELECT ""mon"",COUNT(""ride_id"") AS ""active"" FROM ""ride_month"" GROUP BY ""mon"") SELECT DISTINCT ""month"".""m"" AS ""month"",COALESCE(MAX(""driver"".""active"") OVER (ORDER BY ""month"".""m""), 0) AS ""active_drivers"",COALESCE(""ride"".""active"", 0) AS ""accepted_rides"" FROM (""month"" LEFT JOIN ""driver"" ON ""month"".""m""=""driver"".""mon"") LEFT JOIN ""ride"" ON ""month"".""m""=""ride"".""mon"""
65,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
66,"SELECT ""A"".""MONTH"" AS ""month"",""A"".""active_drivers"",COALESCE(""B"".""no_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""M"".""MONTH"",COUNT(""D"".""join_date"") AS ""active_drivers"" FROM (SELECT 1 AS ""MONTH"" UNION ALL SELECT 2 AS ""MONTH"" UNION ALL SELECT 3 AS ""MONTH"" UNION ALL SELECT 4 AS ""MONTH"" UNION ALL SELECT 5 AS ""MONTH"" UNION ALL SELECT 6 AS ""MONTH"" UNION ALL SELECT 7 AS ""MONTH"" UNION ALL SELECT 8 AS ""MONTH"" UNION ALL SELECT 9 AS ""MONTH"" UNION ALL SELECT 10 AS ""MONTH"" UNION ALL SELECT 11 AS ""MONTH"" UNION ALL SELECT 12 AS ""MONTH"") AS ""M"" LEFT JOIN ""Drivers"" AS ""D"" ON (CASE WHEN ""M"".""MONTH""=2 THEN CONCAT('2020-', ""M"".""MONTH"", '-29')>=""D"".""join_date"" WHEN ""M"".""MONTH""=4 OR ""M"".""MONTH""=6 OR ""M"".""MONTH""=9 OR ""M"".""MONTH""=11 THEN CONCAT('2020-', ""M"".""MONTH"", '-30')>=""D"".""join_date"" ELSE CONCAT('2020-', ""M"".""MONTH"", '-31')>=""D"".""join_date"" END) GROUP BY ""M"".""MONTH"") AS ""A"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""MONTH"",COUNT(""R"".""requested_at"") AS ""no_rides"" FROM ""AcceptedRides"" AS ""A"" LEFT JOIN ""Rides"" AS ""R"" ON ""R"".""ride_id""=""A"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""R"".""requested_at"")) AS ""B"" ON ""A"".""MONTH""=""B"".""MONTH"""
67,"WITH RECURSIVE ""r"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""r"" WHERE ""month""<12), ""b"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",""active_drivers"" FROM (SELECT ""join_date"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE ""join_date""<='2020-12-31') AS ""a"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020), ""c"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""r"".""month"",COALESCE(MAX(""b"".""active_drivers"") OVER (ORDER BY ""r"".""month""), 0) AS ""active_drivers"",COALESCE(""c"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""r"" LEFT JOIN ""b"" ON ""r"".""month""=""b"".""month"") LEFT JOIN ""c"" ON ""r"".""month""=""c"".""month"" GROUP BY ""r"".""month"""
68,"WITH RECURSIVE ""AllMonths"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""AllMonths"" WHERE ""month""<12), ""DriversActiveSince"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""Month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ActiveDriversMonths"" AS (SELECT ""AM"".""Month"",COUNT(""DAS"".""driver_id"") AS ""new_active_drivers"" FROM ""DriversActiveSince"" AS ""DAS"" RIGHT JOIN ""AllMonths"" AS ""AM"" ON ""AM"".""month""=""DAS"".""month"" GROUP BY ""AM"".""Month""), ""CumulativeActiveDrivers"" AS (SELECT ""Month"",SUM(""new_active_drivers"") OVER (ORDER BY ""Month"") AS ""active_drivers"" FROM ""ActiveDriversMonths""), ""MonthlyRides"" AS (SELECT ""AR"".""ride_id"",EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""MontlyRidesSummary"" AS (SELECT ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""MonthlyRides"" GROUP BY ""month"") SELECT ""CAD"".""Month"",""CAD"".""active_drivers"",COALESCE(""MRS"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""CumulativeActiveDrivers"" AS ""CAD"" LEFT JOIN ""MontlyRidesSummary"" AS ""MRS"" ON ""MRS"".""month""=""CAD"".""month"""
69,"WITH RECURSIVE ""all_months"" (""dates"") AS (SELECT LEAST(MIN(""join_date""), '2020-01-01') AS ""dates"" FROM ""Drivers"" UNION SELECT ""dates"" + INTERVAL '1 MONTH' FROM ""all_months"" WHERE EXTRACT(YEAR FROM ""dates"")<2021), ""drivers_joined1"" AS (SELECT EXTRACT(YEAR FROM ""join_date"") AS ""year"",EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") AS ""new_drivers"" FROM ""Drivers"" GROUP BY EXTRACT(YEAR FROM ""join_date""),EXTRACT(MONTH FROM ""join_date"")), ""drivers_joined2"" AS (SELECT EXTRACT(YEAR FROM ""am"".""dates"") AS ""year"",EXTRACT(MONTH FROM ""am"".""dates"") AS ""month"",COALESCE(""d"".""new_drivers"", 0) AS ""new_drivers"" FROM ""all_months"" AS ""am"" LEFT JOIN ""drivers_joined1"" AS ""d"" ON EXTRACT(YEAR FROM ""am"".""dates"")=""d"".""year"" AND EXTRACT(MONTH FROM ""am"".""dates"")=""d"".""month"" ORDER BY ""year"",""month""), ""drivers_joined_rolling"" AS (SELECT ""year"",""month"",SUM(""new_drivers"") OVER (ORDER BY ""year"",""month"") AS ""active_drivers"" FROM ""drivers_joined2""), ""rides_2020"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""ar"".""driver_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""d"".""month"",""d"".""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""drivers_joined_rolling"" AS ""d"" LEFT JOIN ""rides_2020"" AS ""r"" ON ""d"".""month""=""r"".""month"" WHERE ""d"".""year""=2020"
70,"WITH RECURSIVE ""month_sequence"" AS (SELECT 1 AS ""inc"" UNION SELECT ""inc""+1 FROM ""month_sequence"" WHERE ""inc""<=11), ""months_of_2020"" AS (SELECT TO_CHAR(CAST('2019-12-01' AS DATE) + INTERVAL '""inc"" MONTH', 'YYYY-%m-01') AS ""year_month"" FROM ""month_sequence""), ""driver_per_month"" AS (SELECT TO_CHAR(""join_date"", 'YYYY-%m-01') AS ""year_month"",COUNT(1) AS ""driver_num"" FROM ""drivers"" GROUP BY 1), ""active_drivers"" AS (SELECT ""year_month"",SUM(""driver_num"") OVER (ORDER BY ""year_month"") AS ""active_drivers"" FROM (SELECT ""year_month"",""driver_num"" FROM ""driver_per_month"" UNION SELECT ""year_month"",0 AS ""driver_num"" FROM ""months_of_2020"" WHERE ""year_month"" NOT IN (SELECT ""year_month"" FROM ""driver_per_month"")) AS ""active_drivers_2020""), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""rides"" AS ""r"" JOIN ""acceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT EXTRACT(MONTH FROM ""d"".""year_month"") AS ""month"",""d"".""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""active_drivers"" AS ""d"" LEFT JOIN ""accepted_rides"" AS ""r"" ON EXTRACT(MONTH FROM ""d"".""year_month"")=""r"".""month"" WHERE ""d"".""year_month"" BETWEEN '2020-01-01' AND '2020-12-31'"
71,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"",2020 AS ""year"" UNION ALL SELECT ""month""+1,""year"" FROM ""t1"" WHERE ""month""<12), ""active"" AS (SELECT ""m"".""month"",SUM(CASE WHEN EXTRACT(YEAR FROM ""d"".""join_date"")<2020 OR EXTRACT(MONTH FROM ""d"".""join_date"")<=""m"".""month"" THEN 1 ELSE 0 END) AS ""total"" FROM (""Drivers"" AS ""d"") JOIN ""t1"" AS ""m"" WHERE ""d"".""join_date""<'2021-01-01' GROUP BY 1), ""ride_total"" AS (SELECT ""a"".""ride_id"",""a"".""driver_id"",""r"".""requested_at"" AS ""date"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') SELECT ""a"".""month"",""a"".""total"" AS ""active_drivers"",SUM(CASE WHEN EXTRACT(MONTH FROM ""r"".""date"")=""a"".""month"" THEN 1 ELSE 0 END) AS ""accepted_rides"" FROM (""active"" AS ""a"") JOIN ""ride_total"" AS ""r"" GROUP BY 1,2 ORDER BY 1"
72,"WITH ""act_driver"" AS (SELECT COUNT(CASE WHEN ""join_date""<='2020-1-31' THEN ""d"".""driver_id"" END) AS ""Jan"",COUNT(CASE WHEN ""join_date""<='2020-2-29' THEN ""d"".""driver_id"" END) AS ""Feb"",COUNT(CASE WHEN ""join_date""<='2020-3-31' THEN ""d"".""driver_id"" END) AS ""Mar"",COUNT(CASE WHEN ""join_date""<='2020-4-30' THEN ""d"".""driver_id"" END) AS ""Apr"",COUNT(CASE WHEN ""join_date""<='2020-5-31' THEN ""d"".""driver_id"" END) AS ""May"",COUNT(CASE WHEN ""join_date""<='2020-6-30' THEN ""d"".""driver_id"" END) AS ""Jun"",COUNT(CASE WHEN ""join_date""<='2020-7-31' THEN ""d"".""driver_id"" END) AS ""Jul"",COUNT(CASE WHEN ""join_date""<='2020-8-31' THEN ""d"".""driver_id"" END) AS ""Aug"",COUNT(CASE WHEN ""join_date""<='2020-9-30' THEN ""d"".""driver_id"" END) AS ""Sep"",COUNT(CASE WHEN ""join_date""<='2020-10-31' THEN ""d"".""driver_id"" END) AS ""Oct"",COUNT(CASE WHEN ""join_date""<='2020-11-30' THEN ""d"".""driver_id"" END) AS ""Nov"",COUNT(CASE WHEN ""join_date""<='2020-12-31' THEN ""d"".""driver_id"" END) AS ""Dec"" FROM ""drivers"" AS ""d""), ""num_acc_rides"" AS (SELECT COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-1-1' AND '2020-1-31' THEN ""ac"".""ride_id"" END) AS ""Jan_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-2-1' AND '2020-2-29' THEN ""ac"".""ride_id"" END) AS ""Feb_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-3-1' AND '2020-3-31' THEN ""ac"".""ride_id"" END) AS ""Mar_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-4-1' AND '2020-4-30' THEN ""ac"".""ride_id"" END) AS ""Apr_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-5-1' AND '2020-5-31' THEN ""ac"".""ride_id"" END) AS ""May_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-6-1' AND '2020-6-30' THEN ""ac"".""ride_id"" END) AS ""Jun_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-7-1' AND '2020-7-31' THEN ""ac"".""ride_id"" END) AS ""Jul_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-8-1' AND '2020-8-31' THEN ""ac"".""ride_id"" END) AS ""Aug_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-9-1' AND '2020-9-30' THEN ""ac"".""ride_id"" END) AS ""Sep_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-10-1' AND '2020-10-31' THEN ""ac"".""ride_id"" END) AS ""Oct_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-11-1' AND '2020-11-30' THEN ""ac"".""ride_id"" END) AS ""Nov_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-12-1' AND '2020-12-31' THEN ""ac"".""ride_id"" END) AS ""Dec_acc"" FROM ""rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ac"" ON ""r"".""ride_id""=""ac"".""ride_id""), ""active_drivers_col"" AS (SELECT ""Jan"" AS ""active_drivers"",1 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Feb"",2 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Mar"",3 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Apr"",4 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""May"",5 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Jun"",6 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Jul"",7 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Aug"",8 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Sep"",9 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Oct"",10 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Nov"",11 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Dec"",12 AS ""month"" FROM ""act_driver""), ""acc_rides_col"" AS (SELECT ""Jan_acc"" AS ""accepted_rides"",1 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Feb_acc"",2 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Mar_acc"",3 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Apr_acc"",4 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""May_acc"",5 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Jun_acc"",6 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Jul_acc"",7 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Aug_acc"",8 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Sep_acc"",9 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Oct_acc"",10 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Nov_acc"",11 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Dec_acc"",12 AS ""month"" FROM ""num_acc_rides"") SELECT ""t1"".""month"",""active_drivers"",""accepted_rides"" FROM ""active_drivers_col"" AS ""t1"" JOIN ""acc_rides_col"" AS ""t2"" ON ""t1"".""month""=""t2"".""month"""
73,"WITH RECURSIVE ""date_dummy"" (""n"") AS (SELECT 1 UNION ALL SELECT ""n""+1 FROM ""date_dummy"" WHERE ""n""<12), ""date_n"" AS (SELECT TO_CHAR((STR_TO_DATE(CONCAT('2020-', ""n"", '-1'), '%Y-%m-%d')), 'YYYY-%m') AS ""mn"" FROM ""date_dummy""), ""cte1"" AS (SELECT ""ride_date"",SUM(CASE WHEN ""ride_distance"" IS NULL THEN 0 ELSE 1 END) AS ""accepted_rides"" FROM (SELECT TO_CHAR(""requested_at"", 'YYYY-%m') AS ""ride_date"",""r"".""ride_id"" AS ""ride_id"",""ride_distance"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE TO_CHAR(""requested_at"", 'YYYY')=2020) AS ""t"" GROUP BY ""ride_date"") SELECT EXTRACT(MONTH FROM (STR_TO_DATE(CONCAT(""month"", '-1'), '%Y-%m-%d'))) AS ""month"",""driver_cnt"" AS ""active_drivers"",""accepted_rides"" FROM (SELECT ""mn"" AS ""month"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""date_n"" AS ""dn"" LEFT JOIN ""cte1"" AS ""ct"" ON ""dn"".""mn""=""ct"".""ride_date"") AS ""a"" LEFT JOIN (SELECT ""mn"",COUNT(DISTINCT ""driver_id"") AS ""driver_cnt"" FROM ""date_n"" AS ""dn"" LEFT JOIN ""Drivers"" AS ""d"" ON ""dn"".""mn"">=TO_CHAR(""join_date"", 'YYYY-%m') GROUP BY ""mn"") AS ""b"" ON ""a"".""month""=""b"".""mn"""
74,"WITH RECURSIVE ""mons"" AS (SELECT 1 AS ""month"",2020 AS ""year"" UNION ALL SELECT ""month""+1,2020 AS ""year"" FROM ""mons"" WHERE (""month""+1)<=12), ""ars"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""jds"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",EXTRACT(YEAR FROM ""join_date"") AS ""year"",COUNT(""driver_id"") AS ""joined_drivers"" FROM ""drivers"" GROUP BY 1,2), ""jds1"" AS (SELECT ""month"",""year"",""joined_drivers"" FROM ""jds"" UNION ALL (SELECT ""mons"".""month"",""mons"".""year"",0 AS ""joined_drivers"" FROM ""mons"" LEFT JOIN ""jds"" ON ""jds"".""month""=""mons"".""month"" AND ""jds"".""year""=""mons"".""year"" WHERE ""jds"".""month"" IS NULL)), ""ads"" AS (SELECT ""month"",""year"",SUM(""joined_drivers"") OVER (ORDER BY ""year"",""month"" RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM ""jds1"") SELECT ""ads"".""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""ars"" RIGHT JOIN ""ads"" ON ""ars"".""month""=""ads"".""month"" WHERE ""ads"".""year""=2020"
75,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""driver"" AS (SELECT ""driver_id"",CASE WHEN ""join_date""<'2020-01-01' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31'), ""activedriver"" AS (SELECT ""t2"".""month"",COUNT(DISTINCT ""t2"".""driver_id"") AS ""active_drivers"" FROM (SELECT * FROM ""Month"" AS ""m"" LEFT JOIN (SELECT ""join_month"",""driver_id"" FROM ""driver"") AS ""j"" ON ""m"".""Month"">=""j"".""join_month"") AS ""t2"" GROUP BY ""t2"".""month""), ""sumride"" AS (SELECT ""month"".""month"",COALESCE(""m"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""month"" AS ""month"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""b"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""b"".""requested_at"") ORDER BY 1) AS ""m"" ON ""month"".""month""=""m"".""month"") SELECT ""a"".*,""b"".""accepted_rides"" FROM ""activedriver"" AS ""a"" LEFT JOIN ""sumride"" AS ""b"" ON ""a"".""month""=""b"".""month"" ORDER BY 1"
76,"WITH RECURSIVE ""a"" AS (SELECT DISTINCT '2020-01-01' AS ""m_start"" FROM ""drivers"" UNION ALL SELECT ""m_start"" + INTERVAL '+1 MONTH' FROM ""a"" WHERE ""m_start""<'2020-12-01'), ""b"" AS (SELECT *,CASE WHEN TO_CHAR(""join_date"", 'YYYY-%m')<=TO_CHAR(""m_start"", 'YYYY-%m') THEN 1 ELSE 0 END AS ""joined"" FROM ""drivers"" JOIN ""a""), ""t1"" AS (SELECT ""m_start"",SUM(""joined"") AS ""active_drivers"" FROM ""b"" GROUP BY ""m_start""), ""t2"" AS (SELECT ""m_start"",COUNT(""ride_id"") AS ""accepted_rides"" FROM (SELECT ""ar"".""ride_id"",""r"".""requested_at"" - INTERVAL 'DAYOFMONTH(""r"".""requested_at"")-1 DAY' AS ""m_start"" FROM ""rides"" AS ""r"" RIGHT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") AS ""temp"" GROUP BY ""m_start"") SELECT EXTRACT(MONTH FROM ""t1"".""m_start"") AS ""month"",""t1"".""active_drivers"",CASE WHEN ""t2"".""accepted_rides"" IS NULL THEN 0 ELSE ""t2"".""accepted_rides"" END AS ""accepted_rides"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""m_start""=""t2"".""m_start"" ORDER BY ""t1"".""m_start"""
77,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""mon"" UNION ALL SELECT ""mon""+1 FROM ""month"" WHERE ""mon""<12), ""driver"" AS (SELECT ""jmonth"",SUM(""dcount"") AS ""dcount"" FROM (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""jmonth"",COUNT(""driver_id"") AS ""dcount"" FROM ""drivers"" WHERE TO_CHAR(""join_date"", 'YYYY')='2020' GROUP BY 1 UNION ALL SELECT 1 AS ""jmonth"",(SELECT COUNT(""driver_id"") FROM ""drivers"" WHERE ""join_date""<'2020-01-1') AS ""dcount"") AS ""a"" GROUP BY ""jmonth""), ""acceptedr"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""rmonth"",COUNT(""ar"".""ride_id"") AS ""acount"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE TO_CHAR(""r"".""requested_at"", 'YYYY')='2020' GROUP BY 1) SELECT ""mon"" AS ""month"",SUM(""dcount"") OVER (ORDER BY ""mon"") AS ""active_drivers"",COALESCE(""acount"", 0) AS ""accepted_rides"" FROM (""month"" AS ""m"" LEFT JOIN ""driver"" AS ""d"" ON ""m"".""mon""=""d"".""jmonth"") LEFT JOIN ""acceptedr"" AS ""ar"" ON ""m"".""mon""=""ar"".""rmonth"" GROUP BY 1 ORDER BY 1"
78,"WITH ""months"" AS ((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")), ""z"" AS (SELECT ""m"".""month"",COALESCE(COUNT(DISTINCT (""d"".""driver_id"")), 0) AS ""month_drivers"" FROM (SELECT (CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"",""driver_id"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021) AS ""d"" RIGHT JOIN ""months"" AS ""m"" ON ""d"".""month""<=""m"".""month"" GROUP BY (""m"".""month"")) SELECT ""z"".""month"",""z"".""month_drivers"" AS ""active_drivers"",COALESCE(""a"".""month_count"", 0) AS ""accepted_rides"" FROM ""z"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(1) AS ""month_count"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) AS ""a"" ON ""z"".""month""=""a"".""month"" ORDER BY ""z"".""month"""
79,"WITH RECURSIVE ""AllMonths"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""AllMonths"" WHERE ""month""<12), ""DriversActiveSince"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""Month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ActiveDriversMonths"" AS (SELECT ""AM"".""Month"",COUNT(""DAS"".""driver_id"") AS ""new_active_drivers"" FROM ""DriversActiveSince"" AS ""DAS"" RIGHT JOIN ""AllMonths"" AS ""AM"" ON ""AM"".""month""=""DAS"".""month"" GROUP BY ""AM"".""Month""), ""CumulativeActiveDrivers"" AS (SELECT ""Month"",SUM(""new_active_drivers"") OVER (ORDER BY ""Month"") AS ""active_drivers"" FROM ""ActiveDriversMonths""), ""MonthlyRides"" AS (SELECT ""AR"".""ride_id"",EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""MontlyRidesSummary"" AS (SELECT ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""MonthlyRides"" GROUP BY ""month"") SELECT ""CAD"".""Month"",""CAD"".""active_drivers"",COALESCE(""MRS"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""CumulativeActiveDrivers"" AS ""CAD"" LEFT JOIN ""MontlyRidesSummary"" AS ""MRS"" ON ""MRS"".""month""=""CAD"".""month"""
80,"WITH ""rec"" AS (WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12) SELECT * FROM ""seq""), ""d_agg"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")>2020 THEN NULL ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month_2020"",COUNT(DISTINCT ""driver_id"") AS ""ct"" FROM ""drivers"" GROUP BY 1), ""ac_d"" AS (SELECT ""r"".""month"",SUM(COALESCE(""d"".""ct"", 0)) OVER (ORDER BY ""r"".""month"") AS ""ac_drivers"" FROM ""rec"" AS ""r"" LEFT JOIN ""d_agg"" AS ""d"" ON ""r"".""month""=""d"".""join_month_2020""), ""ac_r"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""ac_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""ac_d"".""month"" AS ""month"",""ac_d"".""ac_drivers"" AS ""active_drivers"",COALESCE(""ac_r"".""ac_rides"", 0) AS ""accepted_rides"" FROM ""ac_d"" LEFT JOIN ""ac_r"" ON ""ac_d"".""month""=""ac_r"".""month"""
81,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""t"".""month"",(SELECT COUNT(DISTINCT ""driver_id"") FROM ""drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""t"".""month"")) AS ""active_drivers"",(SELECT COUNT(DISTINCT ""a"".""ride_id"") FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' AND EXTRACT(MONTH FROM ""a"".""requested_at"")=""t"".""month"") AS ""accepted_rides"" FROM ""months"" AS ""t"""
82,"WITH ""cte"" AS (SELECT 1 AS ""mth"" UNION SELECT 2 AS ""mth"" UNION SELECT 3 AS ""mth"" UNION SELECT 4 AS ""mth"" UNION SELECT 5 AS ""mth"" UNION SELECT 6 AS ""mth"" UNION SELECT 7 AS ""mth"" UNION SELECT 8 AS ""mth"" UNION SELECT 9 AS ""mth"" UNION SELECT 10 AS ""mth"" UNION SELECT 11 AS ""mth"" UNION SELECT 12 AS ""mth"") SELECT ""cte"".""mth"" AS ""month"",(SELECT COUNT(1) FROM ""drivers"" AS ""d2"" WHERE (EXTRACT(MONTH FROM ""join_date"")<=""cte"".""mth"" OR EXTRACT(YEAR FROM ""join_date"")<2020) AND EXTRACT(YEAR FROM ""join_date"")<2021) AS ""active_drivers"",SUM((CASE WHEN ""ar"".""ride_id"" IS NULL THEN 0 ELSE 1 END)) AS ""accepted_rides"" FROM (""cte"" LEFT JOIN ""rides"" AS ""r"" ON ""cte"".""mth""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN (SELECT ""ar1"".* FROM ""acceptedrides"" AS ""ar1"" JOIN ""drivers"" AS ""d"" ON ""d"".""driver_id""=""ar1"".""driver_id"") AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY 1 ORDER BY 1"
83,"WITH RECURSIVE ""monthtable"" AS (SELECT 1 AS ""month"",2020 AS ""year"" UNION ALL SELECT ""month""+1,""year"" FROM ""monthtable"" WHERE ""month""<12), ""ridetable"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""numrides"" FROM ""acceptedrides"" JOIN ""rides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""d"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""r"".""numrides"", 0) AS ""accepted_rides"" FROM (""monthtable"" AS ""m"" LEFT JOIN (SELECT EXTRACT(YEAR FROM ""join_date"")*12+EXTRACT(MONTH FROM ""join_date""),EXTRACT(MONTH FROM ""join_date"") AS ""month"",EXTRACT(YEAR FROM ""join_date"") AS ""year"",COUNT(""driver_id"") OVER (ORDER BY EXTRACT(YEAR FROM ""join_date"")*12+EXTRACT(MONTH FROM ""join_date"")) AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""m"".""month""=""d"".""month"" AND ""m"".""year""=""d"".""year"") LEFT JOIN ""ridetable"" AS ""r"" ON ""m"".""month""=""r"".""month"" ORDER BY ""m"".""month"""
84,"ERROR: mysql parse error: line 1 column 559 near "";&amp; YEAR(n.requested_at)= ""2020"" ) As accepted_rides from m GROUP By m.month ORDER BY m.month"" "
85,"WITH RECURSIVE ""months_in_year"" AS (SELECT 1 AS ""month_num"" UNION SELECT ""month_num""+1 FROM ""months_in_year"" WHERE ""month_num""<12) SELECT ""month_num"" AS ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month_num"") AS ""active_drivers"",COALESCE(COUNT(""ride_id""), 0) AS ""accepted_rides"" FROM (SELECT ""month_num"",COALESCE(""active_drivers"", 0) AS ""active_drivers"" FROM ""months_in_year"" LEFT JOIN (SELECT ""monthly"",CASE WHEN ""monthly""=1 THEN ""active_drivers""+(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020) ELSE ""active_drivers"" END AS ""active_drivers"" FROM (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""monthly"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY ""monthly"") AS ""active_driver_subset"") AS ""active_drivers"" ON ""month_num""=""monthly"") AS ""active_drivers_cascaded"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""monthly_rides"",""AR"".""ride_id"" AS ""ride_id"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""AR"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""accepted_rides_data"" ON ""month_num""=""monthly_rides"" GROUP BY ""month_num"" ORDER BY ""month_num"""
86,"WITH RECURSIVE ""month_tab"" AS (SELECT 1 AS ""month"",0 AS ""active_drivers"" UNION SELECT ""month""+1 AS ""month"",0 FROM ""month_tab"" WHERE ""month""<12), ""tab_driver"" AS (SELECT CAST(SUBSTR(""yymm"", 6, 2) AS INTEGER) AS ""month"",MAX(""active_drivers"") AS ""active_drivers"" FROM (SELECT TO_CHAR(""join_date"", 'YYYY-%m') AS ""yymm"",""driver_id"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"") AS ""a"" WHERE ""a"".""yymm"">'2019-12' AND ""a"".""yymm""<'2021-01' GROUP BY ""yymm""), ""tab_ride"" AS (SELECT CAST(TO_CHAR(""requested_at"", '%m') AS INTEGER) AS ""month"",TO_CHAR(""requested_at"", 'YYYY-%m') AS ""yymm"",COUNT(""rides"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" JOIN ""rides"" ON ""acceptedrides"".""ride_id""=""rides"".""ride_id"" GROUP BY TO_CHAR(""requested_at"", 'YYYY-%m') HAVING ""yymm"">'2019-12' AND ""yymm""<'2021-01'), ""tab4"" AS (SELECT ""month_tab"".""month"",""month_tab"".""active_drivers""+COALESCE(""tab_driver"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""tab_ride"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month_tab"" LEFT JOIN ""tab_driver"" ON ""month_tab"".""month""=""tab_driver"".""month"") LEFT JOIN ""tab_ride"" ON ""month_tab"".""month""=""tab_ride"".""month"") SELECT ""tab4"".""month"",MAX(""tab4"".""active_drivers"") OVER (ORDER BY ""tab4"".""month"") AS ""active_drivers"",""accepted_rides"" FROM ""tab4"""
87,"WITH RECURSIVE ""CTE1"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""join_month"",""active_drivers"" FROM (SELECT ""driver_id"",CASE WHEN ""join_date""<='2020-01-01' THEN 0 ELSE ""join_date"" END AS ""join_date"",COUNT(""join_date"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<='2020' ORDER BY ""join_date"") AS ""t"" WHERE EXTRACT(MONTH FROM ""join_date"") IS NOT NULL), ""CTE3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""r"".""requested_at"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" LEFT JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE ""driver_id"" IN (SELECT DISTINCT ""driver_id"" FROM ""CTE2"") AND EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""CTE4"" AS (SELECT ""month"",MAX(COALESCE(""active_drivers"", 0)) OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""CTE2"" RIGHT JOIN ""CTE1"" ON ""CTE2"".""join_month""=""CTE1"".""month"") SELECT DISTINCT ""CTE4"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""CTE3"" RIGHT JOIN ""CTE4"" ON ""CTE3"".""month""=""CTE4"".""month"""
88,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""t"".""month"",(SELECT COUNT(DISTINCT ""driver_id"") FROM ""drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""t"".""month"")) AS ""active_drivers"",(SELECT COUNT(DISTINCT ""a"".""ride_id"") FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' AND EXTRACT(MONTH FROM ""a"".""requested_at"")=""t"".""month"") AS ""accepted_rides"" FROM ""months"" AS ""t"""
89,"WITH RECURSIVE ""calendar"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""calendar"" WHERE ""month""<12), ""year_2020"" AS (SELECT ""join_date"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""cnt"" FROM ""drivers"" WHERE ""join_date""<'2021-01-01'), ""after_2019"" AS (SELECT ""join_date"",""cnt"" FROM ""year_2020"" WHERE ""join_date"">'2019-12-31'), ""accepted"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_cnt"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at""<'2021-01-01' AND ""requested_at"">'2019-12-31' GROUP BY ""month""), ""parts"" AS (SELECT ""calendar"".""month"",""cnt"",SUM(CASE WHEN ""cnt"" IS NULL THEN 0 ELSE 1 END) OVER (ORDER BY ""month"") AS ""c_partition"",COALESCE(""accepted_cnt"", 0) AS ""accepted_rides"" FROM (""calendar"" LEFT JOIN ""after_2019"" ON ""calendar"".""month""=EXTRACT(MONTH FROM ""after_2019"".""join_date"")) LEFT JOIN ""accepted"" ON ""calendar"".""month""=""accepted"".""month"") SELECT DISTINCT ""month"",COALESCE(FIRST_VALUE(""cnt"") OVER (PARTITION BY ""c_partition"" ORDER BY ""month""), 0) AS ""active_drivers"",""accepted_rides"" FROM ""parts"" ORDER BY ""month"""
90,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
91,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""tmp_cnt"" AS (SELECT ""month"",COUNT(1) AS ""d_cnt"" FROM (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021) AS ""T"" GROUP BY ""month""), ""acc_cnt"" AS (SELECT ""month"",SUM(""total"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM (SELECT ""a"".""month"",CASE WHEN ""b"".""d_cnt"" IS NULL THEN 0 ELSE ""b"".""d_cnt"" END AS ""total"" FROM ""cte"" AS ""a"" LEFT JOIN ""tmp_cnt"" AS ""b"" ON ""a"".""month""=""b"".""month"") AS ""T""), ""order_cnt"" AS (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""a"".""requested_at"")) SELECT ""a"".*,CASE WHEN ""b"".""accepted_rides"" IS NOT NULL THEN ""b"".""accepted_rides"" ELSE 0 END AS ""accepted_rides"" FROM ""acc_cnt"" AS ""a"" LEFT JOIN ""order_cnt"" AS ""b"" ON ""a"".""month""=""b"".""month"""
92,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""active_driver"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""acceptedrides"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" JOIN ""rides"" ON ""rides"".""ride_id""=""acceptedrides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month"" AS ""m"" LEFT JOIN ""active_driver"" AS ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""accepted_rides"" AS ""t2"" ON ""m"".""month""=""t2"".""month"""
93,"WITH RECURSIVE ""months_in_year"" AS (SELECT 1 AS ""month_num"" UNION SELECT ""month_num""+1 FROM ""months_in_year"" WHERE ""month_num""<12) SELECT ""month_num"" AS ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month_num"") AS ""active_drivers"",COALESCE(COUNT(""ride_id""), 0) AS ""accepted_rides"" FROM (SELECT ""month_num"",COALESCE(""active_drivers"", 0) AS ""active_drivers"" FROM ""months_in_year"" LEFT JOIN (SELECT ""monthly"",CASE WHEN ""monthly""=1 THEN ""active_drivers""+(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020) ELSE ""active_drivers"" END AS ""active_drivers"" FROM (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""monthly"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY ""monthly"") AS ""active_driver_subset"") AS ""active_drivers"" ON ""month_num""=""monthly"" ORDER BY ""month_num"") AS ""active_drivers_cascaded"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""monthly_rides"",""AR"".""ride_id"" AS ""ride_id"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""AR"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""accepted_rides_data"" ON ""month_num""=""monthly_rides"" GROUP BY ""month_num"" ORDER BY ""month_num"""
94,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""mnth"" UNION SELECT ""mnth""+1 FROM ""month"" WHERE ""mnth""<12), ""total_active_drivers"" AS (SELECT DISTINCT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""total_accepted_rides"" AS (SELECT DISTINCT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ar"".""ride_id"") OVER (PARTITION BY EXTRACT(MONTH FROM ""requested_at"")) AS ""accepted_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 ORDER BY EXTRACT(MONTH FROM ""requested_at"")) SELECT DISTINCT ""m"".""mnth"" AS ""month"",COALESCE((MAX(""ad"".""active_drivers"") OVER (ORDER BY ""m"".""mnth"")), 0) AS ""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month"" AS ""m"" LEFT JOIN ""total_active_drivers"" AS ""ad"" ON ""ad"".""month""=""mnth"") LEFT JOIN ""total_accepted_rides"" AS ""ar"" ON ""m"".""mnth""=""ar"".""month"""
95,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
96,"WITH RECURSIVE ""CTE1"" AS (SELECT CASE WHEN '2020-01-01'<(SELECT MIN(""join_DATE"") FROM ""Drivers"") THEN '2020-01-01' ELSE (SELECT MIN(""join_DATE"") FROM ""Drivers"") END AS ""dates"" UNION SELECT ""dates"" + INTERVAL '1 DAY' FROM ""CTE1"" WHERE ""dates""<'2020-12-31'), ""CTE2"" AS (SELECT ""d1"".""dates"",""d2"".""join_date"",COALESCE(""d2"".""driver_cnt"", 0) AS ""driver_cnt"" FROM ""CTE1"" AS ""d1"" LEFT JOIN (SELECT ""join_date"",1 AS ""driver_cnt"" FROM ""Drivers"") AS ""d2"" ON ""d1"".""dates""=""d2"".""join_date""), ""CTE3"" AS (SELECT CASE WHEN ""dates""<='2020-01-31' THEN 1 WHEN ""dates""<='2020-02-29' THEN 2 WHEN ""dates""<='2020-03-31' THEN 3 WHEN ""dates""<='2020-04-30' THEN 4 WHEN ""dates""<='2020-05-31' THEN 5 WHEN ""dates""<='2020-06-30' THEN 6 WHEN ""dates""<='2020-07-31' THEN 7 WHEN ""dates""<='2020-08-31' THEN 8 WHEN ""dates""<='2020-09-30' THEN 9 WHEN ""dates""<='2020-10-31' THEN 10 WHEN ""dates""<='2020-11-30' THEN 11 WHEN ""dates""<='2020-12-31' THEN 12 END AS ""month"",SUM(""driver_cnt"") AS ""active_drivers"" FROM ""CTE2"" GROUP BY CASE WHEN ""dates""<='2020-01-31' THEN 1 WHEN ""dates""<='2020-02-29' THEN 2 WHEN ""dates""<='2020-03-31' THEN 3 WHEN ""dates""<='2020-04-30' THEN 4 WHEN ""dates""<='2020-05-31' THEN 5 WHEN ""dates""<='2020-06-30' THEN 6 WHEN ""dates""<='2020-07-31' THEN 7 WHEN ""dates""<='2020-08-31' THEN 8 WHEN ""dates""<='2020-09-30' THEN 9 WHEN ""dates""<='2020-10-31' THEN 10 WHEN ""dates""<='2020-11-30' THEN 11 WHEN ""dates""<='2020-12-31' THEN 12 END), ""CTE4"" AS (SELECT ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""CTE3""), ""CTE5"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM (SELECT ""d1"".""ride_id"",""d1"".""requested_at"" FROM ""Rides"" AS ""d1"" JOIN ""AcceptedRides"" AS ""d2"" ON ""d1"".""ride_id""=""d2"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""sub"" GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""d1"".""month"",""d1"".""active_drivers"",COALESCE(""d2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""CTE4"" AS ""d1"" LEFT JOIN ""CTE5"" AS ""d2"" ON ""d1"".""month""=""d2"".""month"" ORDER BY 1"
97,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""mnth"" UNION SELECT ""mnth""+1 FROM ""month"" WHERE ""mnth""<12), ""total_active_drivers"" AS (SELECT DISTINCT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""total_accepted_rides"" AS (SELECT DISTINCT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ar"".""ride_id"") OVER (PARTITION BY EXTRACT(MONTH FROM ""requested_at"")) AS ""accepted_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 ORDER BY EXTRACT(MONTH FROM ""requested_at"")) SELECT DISTINCT ""m"".""mnth"" AS ""month"",COALESCE((MAX(""ad"".""active_drivers"") OVER (ORDER BY ""m"".""mnth"")), 0) AS ""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month"" AS ""m"" LEFT JOIN ""total_active_drivers"" AS ""ad"" ON ""ad"".""month""=""mnth"") LEFT JOIN ""total_accepted_rides"" AS ""ar"" ON ""m"".""mnth""=""ar"".""month"""
98,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12), ""ActiveDrivers"" AS (SELECT CASE WHEN ""T"".""join_date"" IS NULL THEN 2020 ELSE EXTRACT(YEAR FROM ""T"".""join_date"") END AS ""year"",""T"".""month"",COUNT(""T"".""driver_id"") OVER (ORDER BY CASE WHEN ""T"".""join_date"" IS NULL THEN 2020 ELSE EXTRACT(YEAR FROM ""T"".""join_date"") END,""T"".""month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM (SELECT * FROM ""Months"" AS ""M"" LEFT JOIN ""Drivers"" AS ""D"" ON ""M"".""month""=EXTRACT(MONTH FROM ""D"".""join_date"") AND EXTRACT(YEAR FROM ""D"".""join_date"")=2020 UNION SELECT * FROM ""Months"" AS ""M"" JOIN ""Drivers"" AS ""D"" ON ""M"".""month""=EXTRACT(MONTH FROM ""D"".""join_date"") AND EXTRACT(YEAR FROM ""D"".""join_date"")<2020) AS ""T""), ""AcceptedRidesPerMonth"" AS (SELECT ""M"".""month"",COUNT(""A"".""ride_id"") AS ""accepted_rides"" FROM (""AcceptedRides"" AS ""A"" JOIN ""Rides"" AS ""R"" ON ""A"".""ride_id""=""R"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020) RIGHT JOIN ""Months"" AS ""M"" ON ""M"".""month""=EXTRACT(MONTH FROM ""R"".""requested_at"") GROUP BY ""M"".""month"") SELECT ""AD"".""month"",MAX(""AD"".""active_drivers"") AS ""active_drivers"",MAX(""AR"".""accepted_rides"") AS ""accepted_rides"" FROM ""ActiveDrivers"" AS ""AD"" JOIN ""AcceptedRidesPerMonth"" AS ""AR"" ON ""AD"".""month""=""AR"".""month"" AND ""AD"".""year""=2020 GROUP BY ""AD"".""month"""
99,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""active_drivers"" AS (SELECT TO_CHAR(""join_date"", 'YYYY-%m-01') AS ""join_month"",COUNT(""driver_id"") AS ""driver_cnt"" FROM ""Drivers"" GROUP BY 1), ""cum_drivers"" AS (SELECT ""join_month"",SUM(""driver_cnt"") OVER (ORDER BY ""join_month"") AS ""cum_driver_cnt"" FROM ""active_drivers""), ""active_driver_cnt"" AS (SELECT ""month"",SUM(""driver_cnt"") OVER (ORDER BY ""month"") AS ""cum_driver_cnt"" FROM (SELECT ""month"",CASE WHEN ""driver_cnt"" IS NULL THEN 0 ELSE ""driver_cnt"" END AS ""driver_cnt"" FROM (SELECT ""a"".""month"",""b"".""cum_driver_cnt"",CASE WHEN ""a"".""month""=1 THEN ""b"".""cum_driver_cnt"" ELSE ""c"".""driver_cnt"" END AS ""driver_cnt"" FROM (""months"" AS ""a"" LEFT JOIN ""cum_drivers"" AS ""b"" ON ""a"".""month""=EXTRACT(MONTH FROM ""b"".""join_month"") AND EXTRACT(YEAR FROM ""b"".""join_month"")='2020') LEFT JOIN ""active_drivers"" AS ""c"" ON ""a"".""month""=EXTRACT(MONTH FROM ""c"".""join_month"") AND EXTRACT(YEAR FROM ""c"".""join_month"")='2020') AS ""c"") AS ""d""), ""accepted_rides"" AS (SELECT ""requested_month"",COUNT(""ride_id"") AS ""ride_cnt"" FROM (SELECT ""e"".""requested_at"",TO_CHAR(""e"".""requested_at"", 'YYYY-%m-01') AS ""requested_month"",""e"".""ride_id"" FROM ""Rides"" AS ""e"" JOIN ""AcceptedRides"" AS ""f"" ON ""e"".""ride_id""=""f"".""ride_id"" WHERE EXTRACT(YEAR FROM ""e"".""requested_at"")=2020) AS ""g"" GROUP BY 1) SELECT ""h"".""month"",""h"".""cum_driver_cnt"" AS ""active_drivers"",CASE WHEN ""i"".""ride_cnt"" IS NULL THEN 0 ELSE ""i"".""ride_cnt"" END AS ""accepted_rides"" FROM ""active_driver_cnt"" AS ""h"" LEFT JOIN ""accepted_rides"" AS ""i"" ON ""h"".""month""=EXTRACT(MONTH FROM ""i"".""requested_month"")"
100,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""driver_cnt"" AS (SELECT ""month"",COALESCE(""driver_cnt"", 0) AS ""driver_cnt"" FROM ""cte"" AS ""a"" LEFT JOIN (SELECT ""join_date_2"",COUNT(1) AS ""driver_cnt"" FROM (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_date_2"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""temp"" GROUP BY 1) AS ""b"" ON ""a"".""month""=""b"".""join_date_2"") SELECT ""e"".""month"",""e"".""cum_cnt"" AS ""active_drivers"",COALESCE(""f"".""accp_cnt"", 0) AS ""accepted_rides"" FROM (SELECT ""a"".""month"",SUM(""b"".""driver_cnt"") AS ""cum_cnt"" FROM ""driver_cnt"" AS ""a"" JOIN ""driver_cnt"" AS ""b"" ON ""a"".""month"">=""b"".""month"" GROUP BY 1) AS ""e"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""d"".""ride_id"") AS ""accp_cnt"" FROM ""rides"" AS ""c"" JOIN ""acceptedrides"" AS ""d"" ON ""c"".""ride_id""=""d"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) AS ""f"" ON ""e"".""month""=""f"".""month"" ORDER BY ""month"""
101,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12), ""ActiveDrivers"" AS (SELECT CASE WHEN ""T"".""join_date"" IS NULL THEN 2020 ELSE EXTRACT(YEAR FROM ""T"".""join_date"") END AS ""year"",""T"".""month"",COUNT(""T"".""driver_id"") OVER (ORDER BY CASE WHEN ""T"".""join_date"" IS NULL THEN 2020 ELSE EXTRACT(YEAR FROM ""T"".""join_date"") END,""T"".""month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM (SELECT * FROM ""Months"" AS ""M"" LEFT JOIN ""Drivers"" AS ""D"" ON ""M"".""month""=EXTRACT(MONTH FROM ""D"".""join_date"") AND EXTRACT(YEAR FROM ""D"".""join_date"")=2020 UNION SELECT * FROM ""Months"" AS ""M"" JOIN ""Drivers"" AS ""D"" ON ""M"".""month""=EXTRACT(MONTH FROM ""D"".""join_date"") AND EXTRACT(YEAR FROM ""D"".""join_date"")<2020) AS ""T""), ""AcceptedRidesPerMonth"" AS (SELECT ""M"".""month"",COUNT(""A"".""ride_id"") AS ""accepted_rides"" FROM (""AcceptedRides"" AS ""A"" JOIN ""Rides"" AS ""R"" ON ""A"".""ride_id""=""R"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020) RIGHT JOIN ""Months"" AS ""M"" ON ""M"".""month""=EXTRACT(MONTH FROM ""R"".""requested_at"") GROUP BY ""M"".""month"") SELECT ""AD"".""month"",MAX(""AD"".""active_drivers"") AS ""active_drivers"",MAX(""AR"".""accepted_rides"") AS ""accepted_rides"" FROM ""ActiveDrivers"" AS ""AD"" JOIN ""AcceptedRidesPerMonth"" AS ""AR"" ON ""AD"".""month""=""AR"".""month"" AND ""AD"".""year""=2020 GROUP BY ""AD"".""month"""
102,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
103,"WITH RECURSIVE ""2020month"" AS (SELECT 1 AS ""mon"",LAST_DAY(CONCAT('2020-', 1, '-01')) AS ""lastday"" UNION ALL SELECT ""mon""+1 AS ""mon"",LAST_DAY(CONCAT('2020-', ""mon""+1, '-01')) AS ""lastday"" FROM ""2020month"" WHERE ""mon""<12) SELECT ""acceptedrides"".""month"" AS ""month"",""activedriver"".""active_drivers"",""acceptedrides"".""accepted_rides"" FROM (SELECT ""2020mon"".""mon"" AS ""month"",COALESCE(COUNT(""drivers"".""driver_id""), 0) AS ""active_drivers"" FROM ""2020month"" AS ""2020mon"" LEFT JOIN ""Drivers"" AS ""drivers"" ON ""2020mon"".""lastday"">=""drivers"".""join_date"" GROUP BY ""2020mon"".""mon"") AS ""activedriver"" JOIN (SELECT ""2020mon"".""mon"" AS ""month"",COALESCE(COUNT(""acctrides"".""ride_id""), 0) AS ""accepted_rides"" FROM (""2020month"" AS ""2020mon"" LEFT JOIN ""Rides"" AS ""rides"" ON EXTRACT(MONTH FROM ""rides"".""requested_at"")=""2020mon"".""mon"" AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" AS ""acctrides"" ON ""rides"".""ride_id""=""acctrides"".""ride_id"" GROUP BY ""2020mon"".""mon"") AS ""acceptedrides"" ON ""activedriver"".""month""=""acceptedrides"".""month"" ORDER BY ""month"""
104,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""acceptedmonth"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""amonth"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""ar"" WHERE ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(YEAR FROM ""r"".""requested_at""),EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COALESCE(""a"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""acceptedmonth"" AS ""a"" ON ""m"".""month""=""a"".""amonth"" GROUP BY ""m"".""month"""
105,"WITH ""cte1"" AS ((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")), ""cte2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""cte3"" AS (SELECT ""a"".""ride_id"",""b"".""driver_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT ""cte1"".""month"",COUNT(DISTINCT ""cte2"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM (""cte1"" LEFT JOIN ""cte2"" ON ""cte1"".""month"">=""cte2"".""month"") LEFT JOIN ""cte3"" ON ""cte1"".""month""=""cte3"".""month"" AND ""cte2"".""driver_id""=""cte3"".""driver_id"" GROUP BY ""cte1"".""month"""
106,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""active_drivers"" AS (SELECT ""m"".""month"",COUNT(""d"".""driver_id"") AS ""active_drivers"" FROM ""months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON EXTRACT(YEAR FROM ""d"".""join_date"")<2020 OR (EXTRACT(YEAR FROM ""d"".""join_date"")=2020 AND ""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"")) GROUP BY ""m"".""month""), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT ""m"".""month"",COALESCE(""d"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""active_drivers"" AS ""d"" ON ""m"".""month""=""d"".""month"") LEFT JOIN ""accepted_rides"" AS ""r"" ON ""m"".""month""=""r"".""month"""
107,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12), ""ActiveDrivers"" AS (SELECT CASE WHEN ""T"".""join_date"" IS NULL THEN 2020 ELSE EXTRACT(YEAR FROM ""T"".""join_date"") END AS ""year"",""T"".""month"",COUNT(""T"".""driver_id"") OVER (ORDER BY CASE WHEN ""T"".""join_date"" IS NULL THEN 2020 ELSE EXTRACT(YEAR FROM ""T"".""join_date"") END,""T"".""month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM (SELECT * FROM ""Months"" AS ""M"" LEFT JOIN ""Drivers"" AS ""D"" ON ""M"".""month""=EXTRACT(MONTH FROM ""D"".""join_date"") AND EXTRACT(YEAR FROM ""D"".""join_date"")=2020 UNION SELECT * FROM ""Months"" AS ""M"" JOIN ""Drivers"" AS ""D"" ON ""M"".""month""=EXTRACT(MONTH FROM ""D"".""join_date"") AND EXTRACT(YEAR FROM ""D"".""join_date"")<2020) AS ""T""), ""AcceptedRidesPerMonth"" AS (SELECT ""M"".""month"",COUNT(""A"".""ride_id"") AS ""accepted_rides"" FROM (""AcceptedRides"" AS ""A"" JOIN ""Rides"" AS ""R"" ON ""A"".""ride_id""=""R"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020) RIGHT JOIN ""Months"" AS ""M"" ON ""M"".""month""=EXTRACT(MONTH FROM ""R"".""requested_at"") GROUP BY ""M"".""month"") SELECT ""AD"".""month"",MAX(""AD"".""active_drivers"") AS ""active_drivers"",MAX(""AR"".""accepted_rides"") AS ""accepted_rides"" FROM ""ActiveDrivers"" AS ""AD"" JOIN ""AcceptedRidesPerMonth"" AS ""AR"" ON ""AD"".""month""=""AR"".""month"" AND ""AD"".""year""=2020 GROUP BY ""AD"".""month"""
108,"WITH ""month_ends"" AS (SELECT DATE('2020-01-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-02-29') AS ""month_dates"" UNION ALL SELECT DATE('2020-03-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-04-30') AS ""month_dates"" UNION ALL SELECT DATE('2020-05-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-06-30') AS ""month_dates"" UNION ALL SELECT DATE('2020-07-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-08-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-09-30') AS ""month_dates"" UNION ALL SELECT DATE('2020-10-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-11-30') AS ""month_dates"" UNION ALL SELECT DATE('2020-12-31') AS ""month_dates""), ""active_drivers"" AS (SELECT ""month_dates"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""month_ends"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON ""m"".""month_dates"">=""d"".""join_date"" GROUP BY 1), ""accepted_rides"" AS (SELECT ""month_dates"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""month_ends"" AS ""m"" LEFT JOIN (SELECT ""r"".""ride_id"",""r"".""requested_at"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"") AS ""a"" ON EXTRACT(MONTH FROM ""m"".""month_dates"")=EXTRACT(MONTH FROM ""a"".""requested_at"") AND EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY 1) SELECT EXTRACT(MONTH FROM ""d"".""month_dates"") AS ""month"",""d"".""active_drivers"",""a"".""accepted_rides"" FROM ""active_drivers"" AS ""d"" JOIN ""accepted_rides"" AS ""a"" ON ""d"".""month_dates""=""a"".""month_dates"" ORDER BY ""month"""
109,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""Drivers_before_2020"" AS (SELECT COUNT(1) AS ""num"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020), ""Active_Drives"" AS (SELECT DISTINCT ""c"".""month"",SUM(CASE WHEN ""d"".""driver_id"" IS NOT NULL THEN 1 ELSE 0 END) OVER (ORDER BY ""c"".""month"") AS ""active_drivers"" FROM ""cte"" AS ""c"" LEFT JOIN (SELECT * FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020) AS ""d"" ON ""c"".""month""=EXTRACT(MONTH FROM ""d"".""join_date"")), ""AcceptedRides_2020"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT ""ad"".""month"",""ad"".""active_drivers""+(SELECT ""num"" FROM ""Drivers_before_2020"") AS ""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""Active_Drives"" AS ""ad"" LEFT JOIN ""AcceptedRides_2020"" AS ""ar"" ON ""ad"".""month""=""ar"".""month"""
110,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
111,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""m"",0 AS ""n"" UNION SELECT ""m""+1,""n"" FROM ""t1"" WHERE ""m""<12), ""t2"" AS (SELECT COUNT(1) AS ""existing_drivers"" FROM ""Drivers"" WHERE ""join_date""<'2020-1-1'), ""t3"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""m"",COUNT(1) AS ""n_new"" FROM ""Drivers"" WHERE ""join_date"" BETWEEN '2020-1-1' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""join_date"")), ""t4"" AS (SELECT ""t1"".""m"",""t1"".""n""+COALESCE(""t3"".""n_new"", 0) AS ""n"" FROM ""t1"" LEFT JOIN ""t3"" ON ""t1"".""m""=""t3"".""m""), ""t5"" AS (SELECT ""m"",SUM(""n"") OVER (ORDER BY ""m"")+""t2"".""existing_drivers"" AS ""n"" FROM (""t4"") JOIN ""t2"" GROUP BY ""m""), ""t6"" AS (SELECT EXTRACT(MONTH FROM ""inb"".""requested_at"") AS ""m"",COUNT(1) AS ""n"" FROM (""AcceptedRides"" AS ""ina"") JOIN ""Rides"" AS ""inb"" WHERE ""ina"".""ride_id""=""inb"".""ride_id"" AND ""inb"".""requested_at"" BETWEEN '2020-1-1' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""inb"".""requested_at"")), ""t7"" AS (SELECT ""t1"".""m"",""t1"".""n""+COALESCE(""t6"".""n"", 0) AS ""n"" FROM ""t1"" LEFT JOIN ""t6"" ON ""t1"".""m""=""t6"".""m"") SELECT ""t5"".""m"" AS ""month"",""t5"".""n"" AS ""active_drivers"",""t7"".""n"" AS ""accepted_rides"" FROM (""t5"") JOIN ""t7"" WHERE ""t5"".""m""=""t7"".""m"""
112,"WITH ""month_ends"" AS (SELECT DATE('2020-01-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-02-29') AS ""month_dates"" UNION ALL SELECT DATE('2020-03-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-04-30') AS ""month_dates"" UNION ALL SELECT DATE('2020-05-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-06-30') AS ""month_dates"" UNION ALL SELECT DATE('2020-07-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-08-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-09-30') AS ""month_dates"" UNION ALL SELECT DATE('2020-10-31') AS ""month_dates"" UNION ALL SELECT DATE('2020-11-30') AS ""month_dates"" UNION ALL SELECT DATE('2020-12-31') AS ""month_dates""), ""active_drivers"" AS (SELECT ""month_dates"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""month_ends"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON ""m"".""month_dates"">=""d"".""join_date"" GROUP BY 1), ""accepted_rides"" AS (SELECT ""month_dates"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""month_ends"" AS ""m"" LEFT JOIN (SELECT ""r"".""ride_id"",""r"".""requested_at"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"") AS ""a"" ON EXTRACT(MONTH FROM ""m"".""month_dates"")=EXTRACT(MONTH FROM ""a"".""requested_at"") AND EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY 1) SELECT EXTRACT(MONTH FROM ""d"".""month_dates"") AS ""month"",""d"".""active_drivers"",""a"".""accepted_rides"" FROM ""active_drivers"" AS ""d"" JOIN ""accepted_rides"" AS ""a"" ON ""d"".""month_dates""=""a"".""month_dates"" ORDER BY ""month"""
113,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11), ""d1"" AS (SELECT TO_CHAR(""join_date"", 'YYYY') AS ""j_year"",TO_CHAR(""join_date"", '%m') AS ""j_month"",COUNT(1) AS ""j_drivers"" FROM ""drivers"" GROUP BY TO_CHAR(""join_date"", 'YYYY'),TO_CHAR(""join_date"", '%m')), ""a"" AS (SELECT TO_CHAR(""requested_at"", 'YYYY') AS ""r_year"",TO_CHAR(""requested_at"", '%m') AS ""r_month"",COUNT(1) AS ""ac_rides"" FROM ""acceptedrides"" AS ""ac"" JOIN ""rides"" AS ""r"" ON ""ac"".""ride_id""=""r"".""ride_id"" GROUP BY TO_CHAR(""requested_at"", 'YYYY'),TO_CHAR(""requested_at"", '%m')) SELECT ""m"".""month"" AS ""month"",COALESCE(SUM(""j_drivers""), 0) AS ""active_drivers"",COALESCE(AVG(""ac_rides""), 0) AS ""accepted_rides"" FROM (""m"" LEFT JOIN ""d1"" ON (""d1"".""j_year""=2020 AND ""d1"".""j_month""<=""m"".""month"") OR ""d1"".""j_year""<2020) LEFT JOIN ""a"" ON ""m"".""month""=""a"".""r_month"" AND ""a"".""r_year""=2020 GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
114,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE1"" WHERE 1+""month""<=12), ""CTE2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""CTE3"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE2"".""driver_id"") OVER (ORDER BY ""CTE1"".""month"") AS ""active_drivers"" FROM ""CTE1"" LEFT JOIN ""CTE2"" ON ""CTE1"".""month""=""CTE2"".""month""), ""CTE4"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""A"".""ride_id"" FROM (""Rides"" AS ""R"") JOIN ""AcceptedRIdes"" AS ""A"" WHERE ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE4"".""ride_id"") OVER (PARTITION BY ""CTE1"".""month"") AS ""accepted_rides"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month"") SELECT ""CTE5"".""month"",""CTE3"".""active_drivers"",""CTE5"".""accepted_rides"" FROM (""CTE5"") JOIN ""CTE3"" WHERE ""CTE5"".""month""=""CTE3"".""month"""
115,"WITH RECURSIVE ""cte"" (""n"") AS (SELECT CAST('2020-01-01' AS DATE) UNION ALL SELECT ""n"" + INTERVAL '1 MONTH' FROM ""cte"" WHERE ""n"" + INTERVAL '1 MONTH'<='2020-12-31') SELECT EXTRACT(MONTH FROM ""cte_day"") AS ""month"",""active_drivers"",""accepted_rides"" FROM (SELECT ""cte_day"",SUM(""active_drivers"") OVER (ORDER BY ""cte_day"") AS ""active_drivers"",COALESCE(""total_rides"", 0) AS ""accepted_rides"" FROM (SELECT LAST_DAY(""n"") AS ""cte_day"",""td1"".""active_drivers"",""td2"".""total_rides"" FROM (""cte"" LEFT JOIN (SELECT ""t1"".""date_time"" AS ""date_time"",""t1"".""total_drivers"" AS ""active_drivers"" FROM (SELECT ""date_time"",""num_drivers"" AS ""total_drivers"" FROM (SELECT LAST_DAY(""join_date"") AS ""date_time"",COUNT(""driver_id"") AS ""num_drivers"" FROM ""drivers"" GROUP BY LAST_DAY(""join_date"")) AS ""tmp1"") AS ""t1"") AS ""td1"" ON ""td1"".""date_time""=LAST_DAY(""cte"".""n"")) LEFT JOIN (SELECT LAST_DAY(""requested_at"") AS ""date_time2"",COUNT(""user_id"") AS ""total_rides"" FROM ""AcceptedRides"" JOIN ""rides"" ON ""AcceptedRides"".""ride_id""=""rides"".""ride_id"" GROUP BY LAST_DAY(""requested_at"")) AS ""td2"" ON ""td2"".""date_time2""=LAST_DAY(""cte"".""n"") UNION ALL SELECT CAST('2019-12-31' AS DATE) AS ""date_time"",COUNT(""driver_id"") AS ""active_drivers"",0 AS ""accepted_rides"" FROM ""drivers"" WHERE ""join_date""<'2020-01-01') AS ""combo"") AS ""combo2"" WHERE EXTRACT(YEAR FROM ""cte_day"")=2020"
116,"WITH RECURSIVE ""getdates"" AS (SELECT 1 AS ""month"",LAST_DAY(CONCAT('2020-', '1', '-01')) AS ""last_day"",CONCAT('2020-', '1', '-01') AS ""first_day"" UNION ALL SELECT ""month""+1 AS ""month"",LAST_DAY(CONCAT('2020-', ""month""+1, '-01')) AS ""last_day"",CONCAT('2020-', ""month""+1, '-01') AS ""first_day"" FROM ""getdates"" WHERE ""month""<12), ""Goodrides"" AS (SELECT ""AcceptedRides"".""ride_id"",""Rides"".""requested_at"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id""), ""resultrides"" AS (SELECT ""month"",COUNT(""Goodrides"".""ride_id"") AS ""accepted_rides"" FROM ""getdates"" LEFT JOIN ""Goodrides"" ON ""getdates"".""last_day"">=""Goodrides"".""requested_at"" AND ""getdates"".""first_day""<=""Goodrides"".""requested_at"" GROUP BY ""month""), ""resultdrivers"" AS (SELECT ""month"",COUNT(""Drivers"".""driver_id"") AS ""active_drivers"" FROM ""getdates"" LEFT JOIN ""Drivers"" ON ""getdates"".""last_day"">=""Drivers"".""join_date"" GROUP BY ""month"") SELECT ""getdates"".""month"",""resultdrivers"".""active_drivers"",""resultrides"".""accepted_rides"" FROM (""getdates"" LEFT JOIN ""resultrides"" ON ""getdates"".""month""=""resultrides"".""month"") LEFT JOIN ""resultdrivers"" ON ""getdates"".""month""=""resultdrivers"".""month"""
117,"WITH RECURSIVE ""monthdim"" AS (SELECT 1 AS ""m"" UNION SELECT ""m""+1 FROM ""monthdim"" WHERE ""m""<12), ""activeDr"" AS (SELECT ""driver_id"",""join_date"" FROM ""drivers"" UNION ALL SELECT ""driver_id"",""join_date"" + INTERVAL '1 MONTH' FROM ""activeDr"" WHERE ""join_date""<STR_TO_DATE('20201201', '%Y%m%d')) SELECT ""md"".""m"" AS ""month"",COALESCE(""ad"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""monthdim"" AS ""md"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""requestedmonth"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) AS ""ar"" ON ""md"".""m""=""ar"".""requestedmonth"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""joinMonth"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"" FROM ""activeDr"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY EXTRACT(MONTH FROM ""join_date"")) AS ""ad"" ON ""joinMonth""=""md"".""m"""
118,"WITH RECURSIVE ""end_of_months"" AS (SELECT LAST_DAY('2020-01-01') AS ""mon"" UNION ALL SELECT LAST_DAY(""mon"" + INTERVAL '1 MONTH') FROM ""end_of_months"" WHERE LAST_DAY(""mon"" + INTERVAL '1 MONTH')<='2020-12-31'), ""active_drivers"" AS (SELECT EXTRACT(MONTH FROM ""m"".""mon"") AS ""month"",COUNT(""d"".""driver_id"") AS ""active_drivers"" FROM ""end_of_months"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON ""d"".""join_date""<=""m"".""mon"" GROUP BY ""mon""), ""accepted"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month"") SELECT ""ad"".*,COALESCE(""a"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""active_drivers"" AS ""ad"" LEFT JOIN ""accepted"" AS ""a"" ON ""ad"".""month""=""a"".""month"" ORDER BY ""ad"".""month"""
119,"WITH ""Canlendar"" AS (SELECT 1 AS ""month"" UNION SELECT 2 AS ""month"" UNION SELECT 3 AS ""month"" UNION SELECT 4 AS ""month"" UNION SELECT 5 AS ""month"" UNION SELECT 1 AS ""month"" UNION SELECT 6 AS ""month"" UNION SELECT 7 AS ""month"" UNION SELECT 8 AS ""month"" UNION SELECT 9 AS ""month"" UNION SELECT 10 AS ""month"" UNION SELECT 11 AS ""month"" UNION SELECT 12 AS ""month""), ""Temp"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM (""AcceptedRides"" AS ""ar"" LEFT JOIN ""Drivers"" AS ""d"" ON ""d"".""driver_id""=""ar"".""driver_id"") LEFT JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""c"".""month"",COUNT(""d"".""driver_id"") AS ""active_drivers"",COALESCE(""t"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""Canlendar"" AS ""c"" LEFT JOIN ""Temp"" AS ""t"" ON ""t"".""month""=""c"".""month"") LEFT JOIN ""Drivers"" AS ""d"" ON EXTRACT(YEAR FROM ""d"".""join_date"")<2020 OR (EXTRACT(YEAR FROM ""d"".""join_date"")=2020 AND EXTRACT(MONTH FROM ""d"".""join_date"")<=""c"".""month"") GROUP BY ""c"".""month"" ORDER BY ""c"".""month"""
120,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY ""month""), ""t3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(DISTINCT ""Rides"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""t1"".""month"",COALESCE(SUM(""t2"".""active_drivers""), 0) AS ""active_drivers"",COALESCE(""t3"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""t1"" LEFT JOIN ""t2"" ON ""t1"".""month"">=""t2"".""month"") LEFT JOIN ""t3"" ON ""t1"".""month""=""t3"".""month"" GROUP BY ""t1"".""month"" ORDER BY ""t1"".""month"""
121,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""month"",(SELECT COUNT(1) FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""month"")) AS ""active_drivers"",(SELECT COUNT(1) FROM (""AcceptedRides"") JOIN ""Rides"" WHERE ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" AND ""requested_at""<'2021-01-01' AND ""requested_at"">='2020-01-01' AND EXTRACT(MONTH FROM ""requested_at"")=""month"") AS ""accepted_rides"" FROM ""cte"""
122,"WITH RECURSIVE ""month_seq"" AS (SELECT 1 AS ""MONTH_NUM"" UNION ALL SELECT ""MONTH_NUM""+1 FROM ""month_seq"" WHERE ""MONTH_NUM""<12), ""active_drivers_table"" AS (SELECT ""MONTH_NUM"" AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""month_seq"" AS ""M1"" LEFT JOIN ""Drivers"" AS ""D1"" ON (""M1"".""MONTH_NUM"">=EXTRACT(MONTH FROM ""D1"".""join_date"") AND EXTRACT(YEAR FROM ""D1"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""D1"".""join_date"")<2020 GROUP BY ""MONTH_NUM""), ""accepted_rides_table"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""A1"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""A1"" JOIN ""Rides"" AS ""R1"" ON ""A1"".""ride_id""=""R1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""T1"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""active_drivers_table"" AS ""T1"" LEFT JOIN ""accepted_rides_table"" AS ""T2"" ON ""T1"".""month""=""T2"".""month"""
123,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<='2020'), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accpted_rides"" FROM ""Rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accpted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
124,"WITH RECURSIVE ""calendar"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""calendar"" WHERE ""month""<12), ""ad"" AS (SELECT ""c"".""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""calendar"" AS ""c"" LEFT JOIN ""drivers"" AS ""d"" ON CONCAT('2020', LPAD(""c"".""month"", 2, 0))>=TO_CHAR(""d"".""join_date"", 'YYYY%m') GROUP BY ""c"".""month""), ""ar"" AS (SELECT ""c"".""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM (""calendar"" AS ""c"" LEFT JOIN ""rides"" AS ""r"" ON ""c"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")='2020') LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY ""c"".""month"") SELECT * FROM ""ad"" JOIN ""ar"" USING (""month"")"
125,"WITH RECURSIVE ""active_drivers"" AS (SELECT ""mth"",""active_drivers"" FROM (SELECT ""yr"",""mth"",SUM(""new_drivers"") OVER (ORDER BY ""yr"",""mth"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM (SELECT DISTINCT EXTRACT(YEAR FROM ""join_date"") AS ""yr"",EXTRACT(MONTH FROM ""join_date"") AS ""mth"",COUNT(1) OVER (PARTITION BY EXTRACT(YEAR FROM ""join_date""), EXTRACT(MONTH FROM ""join_date"")) AS ""new_drivers"" FROM ""drivers"") AS ""new_drivers_by_month"") AS ""active_drivers_cumulative"" WHERE ""yr""=2020), ""months"" (""mth"") AS (SELECT 1 UNION ALL SELECT ""mth""+1 FROM ""months"" WHERE ""mth""<12), ""active_drivers_2020"" AS (SELECT ""months"".""mth"",COALESCE(""active_drivers"".""active_drivers"", COALESCE(MAX(""active_drivers"") OVER (ORDER BY ""mth"" ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING), 0)) AS ""active_drivers"" FROM ""months"" LEFT JOIN ""active_drivers"" ON ""months"".""mth""=""active_drivers"".""mth""), ""accepted_rides_2020"" AS (SELECT ""mth"",COUNT(1) AS ""accepted_rides"" FROM (SELECT ""AcceptedRides"".""ride_id"",EXTRACT(YEAR FROM ""requested_at"") AS ""yr"",EXTRACT(MONTH FROM ""requested_at"") AS ""mth"" FROM ""AcceptedRides"" LEFT JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"") AS ""accepted_rides_dated"" WHERE ""yr""=2020 GROUP BY ""mth"") SELECT ""active_drivers_2020"".""mth"" AS ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""active_drivers_2020"" LEFT JOIN ""accepted_rides_2020"" ON ""active_drivers_2020"".""mth""=""accepted_rides_2020"".""mth"""
126,"WITH RECURSIVE ""tmp"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""tmp"" WHERE ""month""<12), ""tmp2"" AS (SELECT * FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020), ""tmp3"" AS (SELECT ""requested_at"" FROM ""acceptedrides"" NATURAL JOIN ""rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""tmp4"" AS (SELECT ""month"",SUM(COUNT(""driver_id"")) OVER (ORDER BY ""month"")+(SELECT COUNT(1) FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020) AS ""active_drivers"" FROM ""tmp2"" RIGHT JOIN ""tmp"" ON EXTRACT(MONTH FROM ""join_date"")=""month"" GROUP BY 1), ""tmp5"" AS (SELECT ""month"",COUNT(""requested_at"") AS ""accepted_rides"" FROM ""tmp"" LEFT JOIN ""tmp3"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") GROUP BY 1) SELECT ""month"",""active_drivers"",""accepted_rides"" FROM ""tmp4"" NATURAL JOIN ""tmp5"" GROUP BY 1"
127,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12), ""t2"" AS (SELECT DISTINCT ""month"",COUNT(""driver_id"") OVER (PARTITION BY ""month"") AS ""active_drivers"" FROM ""t"" LEFT JOIN (SELECT ""driver_id"",""join_date"",CASE WHEN EXTRACT(YEAR FROM ""Drivers"".""join_date"")<2020 THEN '2020-01-01' ELSE ""join_date"" END AS ""join_date_new"" FROM ""Drivers"") AS ""Drivers"" ON ""t"".""month""=EXTRACT(MONTH FROM ""Drivers"".""join_date_new"") AND EXTRACT(YEAR FROM ""Drivers"".""join_date_new"")=2020), ""t3"" AS (SELECT DISTINCT ""month"",COUNT(""ride_id"") OVER (PARTITION BY ""t"".""month"") AS ""accepted_rides"" FROM ""t"" LEFT JOIN ""Rides"" ON ""t"".""month""=EXTRACT(MONTH FROM ""Rides"".""requested_at"") AND EXTRACT(YEAR FROM ""Rides"".""requested_at"")=2020 AND ""Rides"".""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"")) SELECT DISTINCT ""t2"".""month"",SUM(""active_drivers"") OVER (ORDER BY ""t2"".""month"") AS ""active_drivers"",""accepted_rides"" FROM ""t2"" LEFT JOIN ""t3"" ON ""t2"".""month""=""t3"".""month"""
128,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""mth"" UNION ALL SELECT ""mth""+1 AS ""mth"" FROM ""m"" WHERE ""mth""<12), ""accept_ride"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""num_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT DISTINCT ""m"".""mth"" AS ""month"",COALESCE(MAX(""sub2"".""cum_driver"") OVER (ORDER BY ""m"".""mth""), 0) AS ""active_drivers"",COALESCE(""ac"".""num_rides"", 0) AS ""accepted_rides"" FROM ((SELECT EXTRACT(MONTH FROM ""sub"".""join_date"") AS ""month"",""sub"".""cum_driver"" FROM (SELECT ""d"".""join_date"",COUNT(""d"".""driver_id"") OVER (ORDER BY ""d"".""join_date"") AS ""cum_driver"" FROM ""Drivers"" AS ""d"" WHERE EXTRACT(YEAR FROM ""d"".""join_date"")<=2020) AS ""sub"" WHERE EXTRACT(YEAR FROM ""sub"".""join_date"")=2020) AS ""sub2"" RIGHT JOIN ""m"" ON ""m"".""mth""=""sub2"".""month"") LEFT JOIN ""accept_ride"" AS ""ac"" ON ""ac"".""month""=""m"".""mth"""
129,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""all_yr_m"" AS (SELECT TO_CHAR(STR_TO_DATE(CONCAT(""yt"".""join_year"", '-', ""a"".""month""), '%Y-%m'), 'YYYY-%m') AS ""yr_month"" FROM (SELECT DISTINCT EXTRACT(YEAR FROM ""join_date"") AS ""join_year"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""yt"" JOIN ""months"" AS ""a"" WHERE TO_CHAR(STR_TO_DATE(CONCAT(""yt"".""join_year"", '-', ""a"".""month""), '%Y-%m'), 'YYYY-%m')>=(SELECT MIN(TO_CHAR(""join_date"", 'YYYY-%m')) FROM ""Drivers"") AND ""yt"".""join_year""<=2020), ""num_drivers"" AS (SELECT ""c"".""yr_month"",SUM(COALESCE(COUNT(DISTINCT ""d"".""driver_id""), 0)) OVER (ORDER BY ""c"".""yr_month"") AS ""active_drivers"" FROM (SELECT TO_CHAR(""join_date"", 'YYYY-%m') AS ""yr_month"",""driver_id"" FROM ""Drivers"") AS ""d"" RIGHT JOIN ""all_yr_m"" AS ""c"" USING (""yr_month"") GROUP BY 1), ""acc_rides"" AS (SELECT ""a"".""month"",""n"".""ride_id"" FROM ""months"" AS ""a"" LEFT JOIN (SELECT ""x"".""ride_id"",EXTRACT(MONTH FROM ""y"".""requested_at"") AS ""req_month"" FROM ""AcceptedRides"" AS ""x"" LEFT JOIN ""Rides"" AS ""y"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""y"".""requested_at"")=2020) AS ""n"" ON ""a"".""month""=""n"".""req_month"") SELECT ""ar"".""month"",COALESCE(""ad"".""active_drivers"", 0) AS ""active_drivers"",""ar"".""accepted_rides"" FROM (SELECT EXTRACT(MONTH FROM STR_TO_DATE(""yr_month"", '%Y-%m')) AS ""join_month"",""active_drivers"" FROM ""num_drivers"" WHERE EXTRACT(YEAR FROM STR_TO_DATE(""yr_month"", '%Y-%m'))=2020) AS ""ad"" RIGHT JOIN (SELECT ""month"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM ""acc_rides"" GROUP BY ""month"") AS ""ar"" ON ""ad"".""join_month""=""ar"".""month"""
130,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""month"" WHERE ""month""<12), ""cte"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1), ""current_driver"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""cd"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""c"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month"" AS ""m"" LEFT JOIN ""current_driver"" AS ""cd"" ON ""m"".""month""=""cd"".""month"") LEFT JOIN ""cte"" AS ""c"" ON ""m"".""month""=""c"".""month"" ORDER BY ""m"".""month"""
131,"WITH RECURSIVE ""full_year"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""full_year"" WHERE ""month""<12), ""cte1"" AS (SELECT ""driver_id"",""join_date"" FROM ""Drivers"" WHERE ""join_date""<'2021-01-01'), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""d1"".""join_date"") AS ""month"",""d2"".""driver_id"" FROM (""cte1"" AS ""d1"") JOIN ""cte1"" AS ""d2"" WHERE ""d1"".""join_date"">=""d2"".""join_date""), ""cte3"" AS (SELECT ""month"",COUNT(DISTINCT ""driver_id"") AS ""driver_id"" FROM ""cte2"" GROUP BY ""month"" ORDER BY ""month""), ""cte4"" AS (SELECT ""full_year"".""month"",MAX(""driver_id"") AS ""active_drivers"" FROM (""full_year"") JOIN ""cte3"" WHERE ""full_year"".""month"">=""cte3"".""month"" GROUP BY ""full_year"".""month""), ""cte5"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""a"" WHERE ""r"".""ride_id""=""a"".""ride_id"" AND ""requested_at"">='2020-01-01' AND ""requested_at""<'2021-01-01' GROUP BY EXTRACT(MONTH FROM ""requested_at"") ORDER BY ""month"") SELECT ""full_year"".""month"" AS ""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte4"" LEFT JOIN ""cte5"" ON ""cte4"".""month""=""cte5"".""month"") RIGHT JOIN ""full_year"" ON ""cte4"".""month""=""full_year"".""month"" ORDER BY ""month"""
132,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""m"" UNION SELECT ""m""+1 FROM ""month"" WHERE ""m""<12), ""ad"" AS (SELECT ""driver_id"",CASE WHEN ""join_date""<='2020-1-1' THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month"" FROM ""Drivers"" WHERE ""join_date""<'2021-1-1'), ""ar"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""m"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY 1) SELECT ""month"".""m"" AS ""month"",COUNT(DISTINCT ""ad"".""driver_id"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month"" LEFT JOIN ""ad"" ON ""month"".""m"">=""ad"".""join_month"") LEFT JOIN ""ar"" ON ""month"".""m""=""ar"".""m"" GROUP BY 1 ORDER BY 1"
133,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT (""month""+1) AS ""month"" FROM ""months"" WHERE ""month""<12), ""mau"" AS (SELECT ""month"",SUM(""monthly_new_driver"") OVER (ORDER BY ""month"") AS ""mau"" FROM (SELECT ""a"".""month"",COALESCE(""monthly_new_driver"", 0) AS ""monthly_new_driver"" FROM ""months"" AS ""a"" LEFT JOIN (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""monthly_new_driver"" FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' GROUP BY 1) AS ""b"" ON ""a"".""month""=""b"".""month"" ORDER BY 1) AS ""c""), ""accept"" AS (SELECT ""a"".""month"",COALESCE(""accept_driver"", 0) AS ""accept_driver"" FROM ""months"" AS ""a"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accept_driver"" FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) AS ""c"" ON ""a"".""month""=""c"".""month"") SELECT ""a"".""month"",""mau"" AS ""active_drivers"",""accept_driver"" AS ""accepted_rides"" FROM ""accept"" AS ""a"" JOIN ""mau"" AS ""b"" ON ""a"".""month""=""b"".""month"""
134,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""temp1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM (SELECT ""driver_id"",CASE WHEN ""join_date""<'2020-1-1' THEN '2020-1-1' ELSE ""join_date"" END AS ""join_date"" FROM ""Drivers"") AS ""sub"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021 GROUP BY EXTRACT(MONTH FROM ""join_date"")), ""temp2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""temp3"" AS (SELECT ""cte"".""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" LEFT JOIN ""temp1"" AS ""t1"" ON ""cte"".""month""=""t1"".""month"") LEFT JOIN ""temp2"" AS ""t2"" ON ""cte"".""month""=""t2"".""month"") SELECT ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"",""accepted_rides"" FROM ""temp3"" ORDER BY ""month"""
135,"WITH RECURSIVE ""monthtable"" AS (SELECT 1 AS ""month"",2020 AS ""year"" UNION ALL SELECT ""month""+1,""year"" FROM ""monthtable"" WHERE ""month""<12), ""ridetable"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""numrides"" FROM ""acceptedrides"" JOIN ""rides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""d"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""r"".""numrides"", 0) AS ""accepted_rides"" FROM (""monthtable"" AS ""m"" LEFT JOIN (SELECT EXTRACT(YEAR FROM ""join_date"")*12+EXTRACT(MONTH FROM ""join_date""),EXTRACT(MONTH FROM ""join_date"") AS ""month"",EXTRACT(YEAR FROM ""join_date"") AS ""year"",COUNT(""driver_id"") OVER (ORDER BY EXTRACT(YEAR FROM ""join_date"")*12+EXTRACT(MONTH FROM ""join_date"")) AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""m"".""month""=""d"".""month"" AND ""m"".""year""=""d"".""year"") LEFT JOIN ""ridetable"" AS ""r"" ON ""m"".""month""=""r"".""month"" ORDER BY ""m"".""month"""
136,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""mth"" UNION ALL SELECT ""mth""+1 AS ""mth"" FROM ""m"" WHERE ""mth""<12), ""accept_ride"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""num_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""m"".""mth"" AS ""month"",COALESCE(MAX(""sub2"".""cum_driver"") OVER (ORDER BY ""m"".""mth""), 0) AS ""active_drivers"",COALESCE(""ac"".""num_rides"", 0) AS ""accepted_rides"" FROM ((SELECT EXTRACT(MONTH FROM ""sub"".""join_date"") AS ""month"",MAX(""sub"".""cum_driver"") AS ""cum_driver"" FROM (SELECT ""d"".""join_date"",COUNT(""d"".""driver_id"") OVER (ORDER BY ""d"".""join_date"") AS ""cum_driver"" FROM ""Drivers"" AS ""d"" WHERE EXTRACT(YEAR FROM ""d"".""join_date"")<=2020) AS ""sub"" WHERE EXTRACT(YEAR FROM ""sub"".""join_date"")=2020 GROUP BY 1) AS ""sub2"" RIGHT JOIN ""m"" ON ""m"".""mth""=""sub2"".""month"") LEFT JOIN ""accept_ride"" AS ""ac"" ON ""ac"".""month""=""m"".""mth"""
137,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
138,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""n"",CAST('2020-01-31' AS DATE) AS ""eom_Date"" UNION ALL SELECT ""n""+1,CAST('2020-01-31' AS DATE) + INTERVAL '""n"" MONTH' FROM ""month"" WHERE ""n""<12) SELECT ""o"".""month"",""o"".""active_drivers"",COALESCE(""k"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT EXTRACT(MONTH FROM ""eom_Date"") AS ""month"",COUNT(""join_date"") AS ""active_drivers"" FROM ""month"" LEFT JOIN ""drivers"" ON ""join_date""<=""eom_Date"" GROUP BY ""eom_Date"" ORDER BY ""eom_Date"") AS ""o"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month_"",COUNT(1) AS ""accepted_rides"" FROM ""rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""k"" ON ""o"".""month""=""k"".""month_"""
139,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""cte0"" AS (SELECT DISTINCT * FROM ""drivers"" ORDER BY ""join_date""), ""cte1"" AS (SELECT ""join_date"",COUNT(""driver_id"") OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM ""cte0""), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",""active_drivers"" FROM ""cte1"" WHERE ""join_date"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte3"" AS (SELECT ""a"".""month"",(CASE WHEN ""b"".""active_drivers"" IS NULL AND ""a"".""month""=1 THEN 0 WHEN ""b"".""active_drivers"" IS NULL AND ""a"".""month""!=1 THEN MAX(""b"".""active_drivers"") OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) ELSE ""b"".""active_drivers"" END) AS ""active_drivers"" FROM ""months"" AS ""a"" LEFT JOIN ""cte2"" AS ""b"" ON ""a"".""month""=""b"".""month""), ""cte00"" AS (SELECT DISTINCT * FROM ""rides"" ORDER BY ""requested_at""), ""cte000"" AS (SELECT DISTINCT * FROM ""acceptedrides""), ""cte4"" AS (SELECT ""a"".""ride_id"",""a"".""requested_at"" FROM ""cte00"" AS ""a"" JOIN ""cte000"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte5"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""cte4"" GROUP BY ""month""), ""cte6"" AS (SELECT ""a"".""month"",COALESCE(""b"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""months"" AS ""a"" LEFT JOIN ""cte5"" AS ""b"" ON ""a"".""month""=""b"".""month"") SELECT ""a"".""month"",MAX(""a"".""active_drivers"") AS ""active_drivers"",""b"".""accepted_rides"" FROM ""cte3"" AS ""a"" JOIN ""cte6"" AS ""b"" ON ""a"".""month""=""b"".""month"" GROUP BY ""a"".""month"""
140,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12), ""new_driver"" AS (SELECT CASE WHEN ""join_date""<'2020-01-01' THEN 1 ELSE CONVERT(SUBSTRING(""join_date"", 6, 2), INTEGER) END AS ""month"",COUNT(DISTINCT ""driver_id"") AS ""n_join"" FROM ""drivers"" WHERE ""join_date""<='2020-12-31' GROUP BY 1), ""monthly_new_driver"" AS (SELECT ""seq"".""month"",COALESCE(""n1"".""n_join"", 0) AS ""n_join"" FROM ""seq"" LEFT JOIN ""new_driver"" AS ""n1"" ON ""seq"".""month""=""n1"".""month""), ""active_driver"" AS (SELECT ""n1"".""month"",SUM(""n2"".""n_join"") AS ""active_drivers"" FROM ""monthly_new_driver"" AS ""n1"" LEFT JOIN ""monthly_new_driver"" AS ""n2"" ON ""n1"".""month"">=""n2"".""month"" GROUP BY 1), ""ride"" AS (SELECT CONVERT(SUBSTRING(""r"".""requested_at"", 6, 2), INTEGER) AS ""month"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE LEFT(""r"".""requested_at"", 4)='2020' GROUP BY 1) SELECT ""a"".""month"",""a"".""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""active_driver"" AS ""a"" LEFT JOIN ""ride"" AS ""r"" ON ""a"".""month""=""r"".""month"""
141,"SELECT ""t1"".""month"",SUM(COALESCE(""t2"".""d_ct"", 0)) OVER (ORDER BY ""t1"".""month"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ((SELECT 1 AS ""month"" UNION SELECT 2 AS ""month"" UNION SELECT 3 AS ""month"" UNION SELECT 4 AS ""month"" UNION SELECT 5 AS ""month"" UNION SELECT 6 AS ""month"" UNION SELECT 7 AS ""month"" UNION SELECT 8 AS ""month"" UNION SELECT 9 AS ""month"" UNION SELECT 10 AS ""month"" UNION SELECT 11 AS ""month"" UNION SELECT 12 AS ""month"") AS ""t1"" LEFT JOIN (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""d_ct"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY 1) AS ""t2"" ON ""t1"".""month""=""t2"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) AS ""t3"" ON ""t1"".""month""=""t3"".""month"" ORDER BY 1"
142,"WITH RECURSIVE ""CET"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""CET"" WHERE ""month""<=11), ""CET2"" AS (SELECT ""month"",""active_drivers"",0 AS ""accepted_rides"" FROM (SELECT ""join_date"",EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY LEFT(""join_date"", 7)) AS ""active_drivers"" FROM ""Drivers"") AS ""p1"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020), ""CET3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",0 AS ""active_drivers"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""CET"" AS ""m"" LEFT JOIN ""CET2"" AS ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""CET3"" AS ""t2"" ON ""m"".""month""=""t2"".""month"""
143,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12), ""t2"" AS (SELECT DISTINCT ""t"".""month"",COUNT(""driver_id"") OVER (PARTITION BY ""t"".""month"") AS ""active_drivers"" FROM ""t"" LEFT JOIN (SELECT ""driver_id"",CASE WHEN ""join_date""<'2020-01-01' THEN '2020-01-01' ELSE ""join_date"" END AS ""date_new"" FROM ""drivers"") AS ""drivers"" ON ""t"".""month""=EXTRACT(MONTH FROM ""drivers"".""date_new"") AND EXTRACT(YEAR FROM ""Drivers"".""date_new"")=2020), ""t3"" AS (SELECT DISTINCT ""t"".""month"",COUNT(""AcceptedRides"".""ride_id"") OVER (PARTITION BY ""t"".""month"") AS ""accepted_rides"" FROM (""rides"" RIGHT JOIN ""AcceptedRides"" ON ""rides"".""ride_id""=""AcceptedRides"".""ride_id"") RIGHT JOIN ""t"" ON EXTRACT(MONTH FROM ""requested_At"")=""t"".""month"" AND EXTRACT(YEAR FROM ""requested_At"")=2020) SELECT ""t2"".""month"",SUM(""active_drivers"") OVER (ORDER BY ""t2"".""month"") AS ""active_drivers"",""accepted_rides"" FROM ""t2"" JOIN ""t3"" ON ""t2"".""month""=""t3"".""month"""
144,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
145,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""active"" AS (SELECT EXTRACT(MONTH FROM ""d"".""join_date"") AS ""month"",COUNT(""d"".""driver_id"") OVER (ORDER BY ""d"".""join_date"") AS ""active_drivers"" FROM ""Drivers"" AS ""d"" WHERE EXTRACT(YEAR FROM ""d"".""join_date"")<2021), ""accepted"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" WHERE ""r"".""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT DISTINCT ""c"".""month"",COALESCE(MAX(""a"".""active_drivers"") OVER (ORDER BY ""c"".""month""), 0) AS ""active_drivers"",COALESCE(""ac"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" AS ""c"" LEFT JOIN ""active"" AS ""a"" ON ""c"".""month""=""a"".""month"") LEFT JOIN ""accepted"" AS ""ac"" ON ""c"".""month""=""ac"".""month"""
146,"WITH RECURSIVE ""monthtable"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""monthtable"" WHERE ""month""<12), ""drivertable"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY EXTRACT(YEAR FROM ""join_date"")*100+EXTRACT(MONTH FROM ""join_date"")) AS ""num_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ridetable"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""d"".""num_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""monthtable"" AS ""m"" LEFT JOIN ""drivertable"" AS ""d"" USING (""month"")) LEFT JOIN ""ridetable"" AS ""r"" USING (""month"") ORDER BY ""month"""
147,"WITH RECURSIVE ""CTE1"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""REQUESTED_AT"") AS ""MONTH"",""A"".""RIDE_ID"" FROM ""RIDES"" AS ""R"" JOIN ""ACCEPTEDRIDES"" AS ""A"" ON ""R"".""RIDE_ID""=""A"".""RIDE_ID"" WHERE EXTRACT(YEAR FROM ""REQUESTED_AT"")=2020), ""CTE3"" AS (SELECT ""CTE1"".""MONTH"",COUNT(""RIDE_ID"") AS ""ACCEPTED_RIDES"" FROM ""CTE1"" LEFT JOIN ""CTE2"" USING (""MONTH"") GROUP BY ""CTE1"".""MONTH""), ""CTE4"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""JOIN_DATE"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""JOIN_DATE"") END AS ""MONTH"",""DRIVER_ID"" FROM ""DRIVERS"" WHERE EXTRACT(YEAR FROM ""JOIN_DATE"")<=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""MONTH"",COUNT(""DRIVER_ID"") OVER (ORDER BY ""CTE1"".""MONTH"") AS ""ACTIVE_DRIVERS"" FROM ""CTE1"" LEFT JOIN ""CTE4"" USING (""MONTH"")) SELECT ""CTE3"".""MONTH"",""ACTIVE_DRIVERS"",""ACCEPTED_RIDES"" FROM ""CTE3"" JOIN ""CTE5"" USING (""MONTH"")"
148,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""t"".""month"",(SELECT COUNT(DISTINCT ""driver_id"") FROM ""drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""t"".""month"")) AS ""active_drivers"",(SELECT COUNT(DISTINCT ""a"".""ride_id"") FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' AND EXTRACT(MONTH FROM ""a"".""requested_at"")=""t"".""month"") AS ""accepted_rides"" FROM ""months"" AS ""t"""
149,"WITH RECURSIVE ""getMonth"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""getMonth"" WHERE ""month""<12), ""getDates"" AS (SELECT ""month"",LAST_DAY(CONCAT('2020-', ""month"", '-01')) AS ""last_day"" FROM ""getMonth""), ""getRides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month_"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1), ""getDrivers"" AS (SELECT ""month"",SUM(CASE WHEN ""Drivers"".""driver_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""active_drivers"" FROM ""getDates"" LEFT JOIN ""Drivers"" ON ""Drivers"".""join_date""<=""last_day"" GROUP BY 1) SELECT ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""getDrivers"" LEFT JOIN ""getRides"" ON ""month""=""month_"" ORDER BY 1"
150,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12), ""t2"" AS (SELECT *,CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t3"" AS (SELECT *,EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""acceptedrides"")) SELECT ""t"".""month"",SUM(COALESCE(COUNT(DISTINCT ""t2"".""driver_id""), 0)) OVER (ORDER BY ""month"") AS ""active_drivers"",COALESCE(COUNT(DISTINCT ""t3"".""ride_id""), 0) AS ""accepted_rides"" FROM (""t"" LEFT JOIN ""t2"" ON ""t"".""month""=""t2"".""month"") LEFT JOIN ""t3"" ON ""t"".""month""=""t3"".""month"" GROUP BY ""t"".""month"""
151,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
152,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""active_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1), ""active_users"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(DISTINCT ""driver_id"") AS ""counts"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY 1) SELECT DISTINCT ""m"".""month"",COALESCE(SUM(""counts"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""active_rides"" AS ""ar"" ON ""m"".""month""=""ar"".""month"") LEFT JOIN ""active_users"" AS ""au"" ON ""m"".""month""=""au"".""month"" ORDER BY ""m"".""month"""
153,"WITH ""A"" AS (SELECT 2020 AS ""year"",1 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",2 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",3 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",4 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",5 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",6 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",7 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",8 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",9 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",10 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",11 AS ""Month"",0 AS ""driver_num"" UNION SELECT 2020 AS ""year"",12 AS ""Month"",0 AS ""driver_num""), ""D"" AS (SELECT EXTRACT(YEAR FROM ""requested_at"") AS ""year"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""B"".""ride_id"") AS ""ride_num"" FROM ""AcceptedRides"" AS ""B"" JOIN ""Rides"" AS ""C"" ON ""B"".""ride_id""=""C"".""ride_id"" GROUP BY EXTRACT(YEAR FROM ""requested_at""),EXTRACT(MONTH FROM ""requested_at"")), ""E"" AS (SELECT COUNT(""driver_id"") AS ""driver_num"",EXTRACT(YEAR FROM ""join_date"") AS ""year"",EXTRACT(MONTH FROM ""join_date"") AS ""month"" FROM ""Drivers"" GROUP BY EXTRACT(YEAR FROM ""join_date""),EXTRACT(MONTH FROM ""join_date"")), ""F"" AS (SELECT ""driver_num"",""year"",""month"" FROM ""A"" UNION SELECT * FROM ""E""), ""G"" AS (SELECT ""year"",""month"",SUM(""driver_num"") AS ""driver_num2"" FROM ""F"" GROUP BY ""year"",""month"" ORDER BY ""year"",""month""), ""H"" AS (SELECT ""year"",""month"",SUM(""driver_num2"") OVER (ORDER BY ""year"",""month"") AS ""active_drivers"" FROM ""G"") SELECT ""H"".""month"",""active_drivers"",COALESCE(""ride_num"", 0) AS ""accepted_rides"" FROM ""H"" LEFT JOIN ""D"" ON ""H"".""year""=""D"".""year"" AND ""H"".""month""=""D"".""month"" WHERE ""H"".""year""=2020 ORDER BY ""H"".""month"""
154,"WITH ""act_r"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""AcceptedRides"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""m"" AS (SELECT 1 AS ""month"",'2020-01-31' AS ""end_day"" FROM ""Drivers"" UNION SELECT 2 AS ""month"",'2020-02-29' AS ""end_day"" FROM ""Drivers"" UNION SELECT 3 AS ""month"",'2020-03-31' AS ""end_day"" FROM ""Drivers"" UNION SELECT 4 AS ""month"",'2020-04-30' AS ""end_day"" FROM ""Drivers"" UNION SELECT 5 AS ""month"",'2020-05-31' AS ""end_day"" FROM ""Drivers"" UNION SELECT 6 AS ""month"",'2020-06-30' AS ""end_day"" FROM ""Drivers"" UNION SELECT 7 AS ""month"",'2020-07-31' AS ""end_day"" FROM ""Drivers"" UNION SELECT 8 AS ""month"",'2020-08-31' AS ""end_day"" FROM ""Drivers"" UNION SELECT 9 AS ""month"",'2020-09-30' AS ""end_day"" FROM ""Drivers"" UNION SELECT 10 AS ""month"",'2020-10-31' AS ""end_day"" FROM ""Drivers"" UNION SELECT 11 AS ""month"",'2020-11-30' AS ""end_day"" FROM ""Drivers"" UNION SELECT 12 AS ""month"",'2020-12-31' AS ""end_day"" FROM ""Drivers""), ""act_d"" AS (SELECT ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON ""join_date""<=""end_day"" GROUP BY 1) SELECT ""m"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""m"" JOIN ""act_d"" ON ""m"".""month""=""act_d"".""month"") LEFT JOIN ""act_r"" ON ""m"".""month""=""act_r"".""month"" ORDER BY 1"
155,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""t"".""month"",(SELECT COUNT(DISTINCT ""driver_id"") FROM ""drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""t"".""month"")) AS ""active_drivers"",(SELECT COUNT(DISTINCT ""a"".""ride_id"") FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""a"".""requested_at"")=""t"".""month"") AS ""accepted_rides"" FROM ""months"" AS ""t"""
156,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""active_drivers"" AS (SELECT ""cte"".""month"",COUNT(""driver_id"") AS ""cnt"" FROM ""cte"" LEFT JOIN (SELECT ""driver_id"",CASE WHEN ""join_date""<'2020-01-01' THEN 1 ELSE TO_CHAR(""join_date"", '%m') END AS ""month"" FROM ""drivers"" WHERE ""join_date""<'2021-01-01') AS ""c"" ON ""cte"".""month"">=""c"".""month"" GROUP BY ""cte"".""month""), ""accepted_rides"" AS (SELECT ""cte"".""month"",COUNT(""ride_id"") AS ""cntr"" FROM ""cte"" LEFT JOIN (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""a"" LEFT JOIN ""rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""requested_at"" LIKE '2020%') AS ""d"" ON ""cte"".""month""=""d"".""month"" GROUP BY ""cte"".""month"") SELECT ""m"".""month"",""cnt"" AS ""active_drivers"",""cntr"" AS ""accepted_rides"" FROM ""active_drivers"" AS ""m"" LEFT JOIN ""accepted_rides"" AS ""n"" ON ""m"".""month""=""n"".""month"""
157,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
158,"WITH RECURSIVE ""AllMonths"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""AllMonths"" WHERE ""month""<12), ""DriverActiveSince"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""DriverActiveSummary"" AS (SELECT ""AM"".""month"",COUNT(""DAS"".""driver_id"") AS ""active_drivers"" FROM ""AllMonths"" AS ""AM"" LEFT JOIN ""DriverActiveSince"" AS ""DAS"" ON ""DAS"".""month""=""AM"".""month"" GROUP BY ""AM"".""month""), ""CumulativeDrivers"" AS (SELECT ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""DriverActiveSummary""), ""AcceptedRidesMonth"" AS (SELECT ""AR"".""ride_id"",EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""AcceptedRidesMonthCounts"" AS (SELECT ""AL"".""month"",COUNT(""ARM"".""ride_id"") AS ""accepted_rides"" FROM ""AllMonths"" AS ""AL"" LEFT JOIN ""AcceptedRidesMonth"" AS ""ARM"" ON ""ARM"".""month""=""AL"".""month"" GROUP BY ""AL"".""month"") SELECT ""CD"".""month"",""CD"".""active_drivers"",""ARMC"".""accepted_rides"" FROM ""CumulativeDrivers"" AS ""CD"" JOIN ""AcceptedRidesMonthCounts"" AS ""ARMC"" ON ""ARMC"".""month""=""CD"".""month"" ORDER BY 1"
159,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""driver"" AS (SELECT ""driver_id"",EXTRACT(MONTH FROM ""join_date"") AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020), ""rider"" AS (SELECT ""r"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")='2020'), ""table1"" AS (SELECT ""cte"".""month"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""cte"" LEFT JOIN ""rider"" AS ""r"" ON ""cte"".""month""=""r"".""month"" GROUP BY ""month""), ""table2"" AS (SELECT ""table1"".""month"",COUNT(""driver_id"") OVER (ORDER BY ""month"") AS ""active_drivers"",""accepted_rides"" FROM ""table1"" LEFT JOIN ""driver"" AS ""d"" USING (""month"")) SELECT DISTINCT ""month"",""active_drivers""+(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020) AS ""active_drivers"",""accepted_rides"" FROM ""table2"""
160,"WITH RECURSIVE ""monthtable"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""monthtable"" WHERE ""month""<12), ""drivertable"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY EXTRACT(YEAR FROM ""join_date"")*100+EXTRACT(MONTH FROM ""join_date"")) AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ridetable"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""monthtable"" AS ""m"" LEFT JOIN ""drivertable"" USING (""month"")) LEFT JOIN ""ridetable"" USING (""month"")"
161,"WITH RECURSIVE ""t0"" (""m"") AS (SELECT '2020-02-01' AS ""m"" UNION ALL SELECT ""m"" + INTERVAL '1 MONTH' FROM ""t0"" WHERE ""m""<'2021-01-01'), ""t1"" AS (SELECT ""m"" - INTERVAL '1 DAY' AS ""mon"" FROM ""t0""), ""t2"" AS (SELECT ""t1"".""mon"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""t1"" LEFT JOIN ""Drivers"" AS ""d"" ON ""t1"".""mon"">=""d"".""join_date"" GROUP BY 1), ""t3"" AS (SELECT ""t1"".""mon"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""t1"" LEFT JOIN (SELECT ""a"".""ride_id"",""r"".""requested_at"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"") AS ""tmp"" ON ""requested_at""<=""t1"".""mon"" AND TO_CHAR(""requested_at"", 'YYYY-%m')=TO_CHAR(""t1"".""mon"", 'YYYY-%m') GROUP BY 1) SELECT EXTRACT(MONTH FROM ""t2"".""mon"") AS ""month"",""active_drivers"",""accepted_rides"" FROM ""t2"" JOIN ""t3"" ON ""t2"".""mon""=""t3"".""mon"""
162,"WITH RECURSIVE ""Month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""Month"" WHERE ""month""<12), ""ActiveDriver"" AS (SELECT DISTINCT EXTRACT(MONTH FROM ""join_date"") AS ""month"",(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020)+COUNT(""driver_id"") OVER (ORDER BY EXTRACT(MONTH FROM ""join_date"")) AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020), ""AcceptRides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""m"".""month"",COALESCE(MAX(""a1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""Month"" AS ""m"" LEFT JOIN ""ActiveDriver"" AS ""a1"" ON ""m"".""month""=""a1"".""month"") LEFT JOIN ""AcceptRides"" AS ""a2"" ON ""m"".""month""=""a2"".""month"" ORDER BY 1"
163,"WITH ""tmp"" AS (SELECT COUNT(1) AS ""ct"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020), ""tmp2"" AS (WITH RECURSIVE ""rec"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""rec"" WHERE ""month""<12) SELECT * FROM ""rec""), ""tmp3"" AS (SELECT * FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020), ""tmp4"" AS (SELECT ""requested_at"" FROM ""acceptedrides"" NATURAL JOIN ""rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""tmp5"" AS (SELECT ""month"",SUM(COUNT(""driver_id"")) OVER (ORDER BY ""month"")+(SELECT ""ct"" FROM ""tmp"") AS ""active_drivers"" FROM ""tmp3"" RIGHT JOIN ""tmp2"" ON EXTRACT(MONTH FROM ""join_date"")=""month"" GROUP BY 1), ""tmp6"" AS (SELECT ""month"",COUNT(""requested_at"") AS ""accepted_rides"" FROM ""tmp2"" LEFT JOIN ""tmp4"" ON ""month""=EXTRACT(MONTH FROM ""requested_at"") GROUP BY 1) SELECT ""month"",""active_drivers"",""accepted_rides"" FROM ""tmp5"" NATURAL JOIN ""tmp6"" GROUP BY 1"
164,"WITH RECURSIVE ""monthtbl"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""monthtbl"" WHERE ""month""<12), ""driver"" AS (SELECT ""join_month"" AS ""mon"",COUNT(""driver_id"") AS ""num_driver"" FROM (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month"",""driver_id"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""temp"" GROUP BY ""mon""), ""ride"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""ridemon"",COUNT(""a"".""ride_id"") AS ""num_accp"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY ""ridemon"") SELECT ""month"",SUM(""num_driver"") OVER (ORDER BY ""month"") AS ""active_drivers"",""accepted_rides"" FROM (SELECT ""month"",COALESCE(""num_driver"", 0) AS ""num_driver"",COALESCE(""num_accp"", 0) AS ""accepted_rides"" FROM (""monthtbl"" AS ""m"" LEFT JOIN ""driver"" AS ""d"" ON ""m"".""month""=""d"".""mon"") LEFT JOIN ""ride"" AS ""r"" ON ""m"".""month""=""r"".""ridemon"") AS ""t1"" ORDER BY ""month"""
165,"WITH RECURSIVE ""CTE1"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""REQUESTED_AT"") AS ""MONTH"",""A"".""RIDE_ID"" FROM ""RIDES"" AS ""R"" JOIN ""ACCEPTEDRIDES"" AS ""A"" ON ""R"".""RIDE_ID""=""A"".""RIDE_ID"" WHERE EXTRACT(YEAR FROM ""REQUESTED_AT"")=2020), ""CTE3"" AS (SELECT ""CTE1"".""MONTH"",COUNT(""RIDE_ID"") AS ""ACCEPTED_RIDES"" FROM ""CTE1"" LEFT JOIN ""CTE2"" USING (""MONTH"") GROUP BY ""CTE1"".""MONTH""), ""CTE4"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""JOIN_DATE"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""JOIN_DATE"") END AS ""MONTH"",""DRIVER_ID"" FROM ""DRIVERS"" WHERE EXTRACT(YEAR FROM ""JOIN_DATE"")<=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""MONTH"",COUNT(""DRIVER_ID"") OVER (ORDER BY ""CTE1"".""MONTH"") AS ""ACTIVE_DRIVERS"" FROM ""CTE1"" LEFT JOIN ""CTE4"" USING (""MONTH"")) SELECT ""CTE3"".""MONTH"",""ACTIVE_DRIVERS"",""ACCEPTED_RIDES"" FROM ""CTE3"" JOIN ""CTE5"" USING (""MONTH"")"
166,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte2"" AS (SELECT DISTINCT ""m"",COUNT(""ride_id"") OVER (PARTITION BY ""m"") AS ""accepted_rides"" FROM (SELECT ""A"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""m"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""A"" ON ""A"".""ride_id""=""R"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020') AS ""z"" ORDER BY ""m""), ""cte3"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""driver_month"",COUNT(""driver_id"") OVER (PARTITION BY ""driver_id"") AS ""n_driver"" FROM (SELECT * FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' AND ""join_date"">'2019-12-31') AS ""z"" UNION ALL (SELECT 1 AS ""driver_month"",COUNT(""driver_id"") AS ""nu"" FROM ""Drivers"" WHERE ""join_date""<'2020-01-01') ORDER BY ""driver_month""), ""cte4"" AS (SELECT DISTINCT ""month"" AS ""driver_month"",SUM(""n_driver"") OVER (ORDER BY ""month"") AS ""n"" FROM (SELECT ""month"",COALESCE(""n_driver"", 0) AS ""n_driver"" FROM ""cte"" LEFT JOIN ""cte3"" ON ""cte"".""month""=""cte3"".""driver_month"") AS ""z"") SELECT ""driver_month"" AS ""month"",""n"" AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""cte4"" LEFT JOIN ""cte2"" ON ""cte4"".""driver_month""=""cte2"".""m"""
167,"WITH RECURSIVE ""2020_m"" (""months"") AS (SELECT 1 UNION ALL SELECT ""months""+1 FROM ""2020_m"" WHERE ""months""<12), ""mth_cnt"" AS (SELECT ""m"".""months"",SUM(""dv_cnt"") OVER (ORDER BY ""m"".""months"") AS ""cur_cnt"" FROM ""2020_m"" AS ""m"" LEFT JOIN (SELECT CASE WHEN ""join_date""<'2020-01-01' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""m"",COUNT(""driver_id"") AS ""dv_cnt"" FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' GROUP BY 1) AS ""c"" ON ""m"".""months""=""c"".""m"") SELECT ""m"".""months"" AS ""month"",COALESCE(""m"".""cur_cnt"", 0) AS ""active_drivers"",COALESCE(""acc"".""acc_cnt"", 0) AS ""accepted_rides"" FROM ""mth_cnt"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mth"",COUNT(""ride_id"") AS ""acc_cnt"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ac"" USING (""ride_id"") WHERE ""requested_at"">'2019-12-31' AND ""requested_at""<'2021-01-01' GROUP BY 1) AS ""acc"" ON ""m"".""months""=""acc"".""mth"" ORDER BY 1"
168,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""cte1"" AS (SELECT ""join_date"",COUNT(""driver_id"") OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM (SELECT DISTINCT * FROM ""drivers"" ORDER BY ""join_date"") AS ""temp""), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",""active_drivers"" FROM ""cte1"" WHERE ""join_date"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte3"" AS (SELECT ""a"".""month"",(CASE WHEN ""b"".""active_drivers"" IS NULL AND ""a"".""month""=1 THEN 0 WHEN ""b"".""active_drivers"" IS NULL AND ""a"".""month""!=1 THEN MAX(""b"".""active_drivers"") OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) ELSE ""b"".""active_drivers"" END) AS ""active_drivers"" FROM ""months"" AS ""a"" LEFT JOIN ""cte2"" AS ""b"" ON ""a"".""month""=""b"".""month""), ""cte4"" AS (SELECT ""a"".""ride_id"",""a"".""requested_at"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte5"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""cte4"" GROUP BY ""month""), ""cte6"" AS (SELECT ""a"".""month"",COALESCE(""b"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""months"" AS ""a"" LEFT JOIN ""cte5"" AS ""b"" ON ""a"".""month""=""b"".""month"") SELECT ""a"".""month"",MAX(""a"".""active_drivers"") AS ""active_drivers"",""b"".""accepted_rides"" FROM ""cte3"" AS ""a"" JOIN ""cte6"" AS ""b"" ON ""a"".""month""=""b"".""month"" GROUP BY ""a"".""month"""
169,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""t"".""month"",(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021 AND (EXTRACT(MONTH FROM ""join_date"")<=""t"".""month"" OR EXTRACT(YEAR FROM ""join_date"")<2020)) AS ""active_drivers"",(SELECT COUNT(DISTINCT ""ride_id"") FROM ""AcceptedRides"" JOIN ""Rides"" USING (""ride_id"") WHERE EXTRACT(MONTH FROM ""requested_at"")=""t"".""month"" AND EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""accepted_rides"" FROM ""months"" AS ""t"""
170,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""Rides"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""M"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""Months"" AS ""M"" LEFT JOIN ""t1"" ON ""M"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""M"".""month""=""t2"".""month"""
171,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""rides2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""rides"" FROM ""Rides"" AS ""r1"" LEFT JOIN ""AcceptedRides"" AS ""a1"" ON ""a1"".""ride_id""=""r1"".""ride_id"" WHERE ""a1"".""driver_id"" IS NOT NULL AND ""requested_at"" LIKE '2020%' GROUP BY 1), ""monthsTable"" AS (SELECT ""c1"".""month"",""r1"".""rides"" FROM ""cte"" AS ""c1"" LEFT JOIN ""rides2"" AS ""r1"" ON ""r1"".""month""=""c1"".""month""), ""driversTable"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(1) AS ""drivers"",ROW_NUMBER() OVER (ORDER BY ""join_date"") AS ""rowNum"" FROM ""Drivers"" WHERE ""join_date"" LIKE '2020%' GROUP BY 1), ""driversTable2"" AS (SELECT ""month"",CASE WHEN ""rowNum""=1 THEN ""drivers""+(SELECT COUNT(1) FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020) ELSE ""drivers"" END AS ""drivers2"" FROM ""driversTable"") SELECT ""m1"".""month"",COALESCE(SUM(""drivers2"") OVER (ORDER BY ""m1"".""month""), 0) AS ""active_drivers"",COALESCE(""m1"".""rides"", 0) AS ""accepted_rides"" FROM ""monthsTable"" AS ""m1"" LEFT JOIN ""driversTable2"" AS ""d1"" ON ""m1"".""month""=""d1"".""month"""
172,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte1"" AS (SELECT COUNT(1) AS ""driver_id"",1 AS ""month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020 UNION ALL SELECT 1 AS ""driver_id"",EXTRACT(MONTH FROM ""join_date"") AS ""month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 UNION ALL SELECT 0 AS ""driver_id"",""month"" FROM ""cte"" WHERE ""month"" NOT IN (SELECT EXTRACT(MONTH FROM ""join_date"") FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020)), ""cte2"" AS (SELECT DISTINCT ""month"",SUM(""driver_id"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""cte1""), ""cte3"" AS (SELECT ""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020), ""cte4"" AS (SELECT ""month"",COUNT(1) AS ""accepted_rides"" FROM ""cte3"" GROUP BY ""month"") SELECT ""cte2"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""cte2"" LEFT JOIN ""cte4"" ON ""cte2"".""month""=""cte4"".""month"" ORDER BY ""cte2"".""month"""
173,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11), ""d1"" AS (SELECT TO_CHAR(""join_date"", 'YYYY') AS ""j_year"",TO_CHAR(""join_date"", '%m') AS ""j_month"",COUNT(1) AS ""j_drivers"" FROM ""drivers"" GROUP BY TO_CHAR(""join_date"", 'YYYY'),TO_CHAR(""join_date"", '%m')), ""y_m"" AS (SELECT ""month"",""j_year"" AS ""year"" FROM ""m"" JOIN (SELECT DISTINCT ""j_year"" FROM ""d1"") AS ""y""), ""d2"" AS (SELECT ""y_m"".""year"" AS ""act_year"",""y_m"".""month"" AS ""act_month"",COALESCE(SUM(""j_drivers"") OVER (ORDER BY ""y_m"".""year"",""y_m"".""month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW), 0) AS ""act_drivers"" FROM ""d1"" RIGHT JOIN ""y_m"" ON ""d1"".""j_month""=""y_m"".""month"" AND ""d1"".""j_year""=""y_m"".""year""), ""a"" AS (SELECT TO_CHAR(""requested_at"", 'YYYY') AS ""r_year"",TO_CHAR(""requested_at"", '%m') AS ""r_month"",COUNT(1) AS ""ac_rides"" FROM ""acceptedrides"" AS ""ac"" JOIN ""rides"" AS ""r"" ON ""ac"".""ride_id""=""r"".""ride_id"" GROUP BY TO_CHAR(""requested_at"", 'YYYY'),TO_CHAR(""requested_at"", '%m')) SELECT ""d2"".""act_month"" AS ""month"",""act_drivers"" AS ""active_drivers"",COALESCE(""ac_rides"", 0) AS ""accepted_rides"" FROM ""d2"" LEFT JOIN ""a"" ON ""d2"".""act_year""=""a"".""r_year"" AND ""d2"".""act_month""=""a"".""r_month"" WHERE ""d2"".""act_year""=2020 ORDER BY ""month"""
174,"WITH RECURSIVE ""r"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""r"" WHERE ""month""<12), ""a"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(1) OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<='2020'), ""b"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" JOIN ""acceptedrides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1) SELECT DISTINCT ""r"".""month"",COALESCE(MAX(""active_drivers"") OVER (ORDER BY ""month""), 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""r"" LEFT JOIN ""a"" USING (""month"")) LEFT JOIN ""b"" USING (""month"")"
175,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""A"".""ride_id"" FROM (""Rides"" AS ""R"") JOIN ""AcceptedRides"" AS ""A"" WHERE ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""CTE3"" AS (SELECT ""CTE1"".""month"",COUNT(""CTE2"".""ride_id"") AS ""accepted_rides"" FROM ""CTE2"" RIGHT JOIN ""CTE1"" ON ""CTE2"".""month""=""CTE1"".""month"" GROUP BY ""CTE1"".""month""), ""CTE4"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",""driver_id"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""CTE5"" AS (SELECT ""CTE1"".""month"",COUNT(""CTE4"".""driver_id"") OVER (ORDER BY ""CTE1"".""month"") AS ""active_drivers"" FROM ""CTE4"" RIGHT JOIN ""CTE1"" ON ""CTE4"".""month""=""CTE1"".""month"") SELECT DISTINCT ""CTE3"".""month"",""CTE5"".""active_drivers"",""CTE3"".""accepted_rides"" FROM (""CTE5"") JOIN ""CTE3"" WHERE ""CTE5"".""month""=""CTE3"".""month"""
176,"WITH RECURSIVE ""MONTHS"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""MONTHS"" WHERE ""month""<12), ""ACCEPTED"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""A"".""ride_id"" FROM ""Rides"" AS ""A"" JOIN ""AcceptedRides"" AS ""B"" ON ""A"".""ride_id""=""B"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""ACCEPTED_BY_MONTH"" AS (SELECT ""A"".""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""MONTHS"" AS ""A"" LEFT JOIN ""ACCEPTED"" AS ""B"" ON ""A"".""month""=""B"".""month"" GROUP BY ""month""), ""ACTIVE_DRIVERS"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",""driver_id"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ACTIVE_DRIVER_BY_MONTH"" AS (SELECT ""A"".""month"",COUNT(""driver_id"") OVER (ORDER BY ""A"".""month"") AS ""active_drivers"" FROM ""MONTHS"" AS ""A"" LEFT JOIN ""ACTIVE_DRIVERS"" AS ""B"" ON ""A"".""month""=""B"".""month"") SELECT DISTINCT ""A"".""month"",""active_drivers"",""accepted_rides"" FROM ""ACTIVE_DRIVER_BY_MONTH"" AS ""A"" JOIN ""ACCEPTED_BY_MONTH"" AS ""B"" ON ""A"".""month""=""B"".""month"""
177,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""temp"" AS (SELECT EXTRACT(MONTH FROM ""a"".""join_date"") AS ""month"",COUNT(DISTINCT ""b"".""driver_id"") AS ""drivers"" FROM ""Drivers"" AS ""a"" JOIN ""Drivers"" AS ""b"" WHERE EXTRACT(YEAR FROM ""a"".""join_date"")<2021 AND EXTRACT(YEAR FROM ""a"".""join_date"")>2019 AND EXTRACT(EPOCH FROM ""a"".""join_date"")>=EXTRACT(EPOCH FROM ""b"".""join_date"") GROUP BY EXTRACT(MONTH FROM ""a"".""join_date"")), ""temp1"" AS (SELECT ""cte"".""month"",CASE WHEN ""drivers"" IS NULL THEN 0 ELSE ""drivers"" END AS ""drivers"" FROM ""cte"" LEFT JOIN ""temp"" ON ""cte"".""month""=""temp"".""month""), ""temp2"" AS (SELECT ""a"".""month"",MAX(""b"".""drivers"") AS ""active_drivers"" FROM ""temp1"" AS ""a"" JOIN ""temp1"" AS ""b"" WHERE ""a"".""month"">=""b"".""month"" GROUP BY ""a"".""month"" ORDER BY ""a"".""month""), ""temp3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""rides"" FROM ""Rides"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")>2019 AND EXTRACT(YEAR FROM ""requested_at"")<2021 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""temp2"".*,CASE WHEN ""temp3"".""rides"" IS NULL THEN 0 ELSE ""temp3"".""rides"" END AS ""accepted_rides"" FROM ""temp2"" LEFT JOIN ""temp3"" ON ""temp2"".""month""=""temp3"".""month"" ORDER BY ""month"""
178,"WITH RECURSIVE ""month_table"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_table"" WHERE ""month""<12) SELECT ""md"".""month"",""md"".""active_drivers"",""mr"".""accepted_rides"" FROM (SELECT ""m"".""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""month_table"" AS ""m"" LEFT JOIN (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021) AS ""d"" ON ""d"".""month""<=""m"".""month"" GROUP BY ""m"".""month"") AS ""md"" JOIN (SELECT ""m"".""month"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""month_table"" AS ""m"" LEFT JOIN (SELECT ""r"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) AS ""r"" ON ""m"".""month""=""r"".""month"" GROUP BY ""m"".""month"") AS ""mr"" ON ""md"".""month""=""mr"".""month"""
179,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
180,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""driver"" AS (SELECT CAST(SUBSTR(""d2"".""join_month"", 6, 2) AS INTEGER) AS ""month"",SUM(""d1"".""driver_count"") AS ""active_drivers"" FROM (SELECT TO_CHAR(""join_date"", 'YYYY-%m') AS ""join_month"",COUNT(1) AS ""driver_count"" FROM ""Drivers"" GROUP BY TO_CHAR(""join_date"", 'YYYY-%m')) AS ""d1"", (SELECT TO_CHAR(""join_date"", 'YYYY-%m') AS ""join_month"",COUNT(1) AS ""driver_count"" FROM ""Drivers"" GROUP BY TO_CHAR(""join_date"", 'YYYY-%m')) AS ""d2"" WHERE ""d1"".""join_month""<=""d2"".""join_month"" AND ""d2"".""join_month"" BETWEEN '2020-01' AND '2020-12' GROUP BY ""d2"".""join_month"" ORDER BY ""d2"".""join_month""), ""ride"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY TO_CHAR(""requested_at"", 'YYYY-%m')) SELECT ""t"".*,COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""m"".""month"",COALESCE(""d"".""active_drivers"", 0) AS ""active_drivers"" FROM ""months"" AS ""m"" LEFT JOIN ""driver"" AS ""d"" ON ""d"".""month""<=""m"".""month"" GROUP BY ""m"".""month"") AS ""t"" LEFT JOIN ""ride"" AS ""r"" ON ""t"".""month""=""r"".""month"" ORDER BY ""t"".""month"""
181,"WITH RECURSIVE ""temp3"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""temp3"" WHERE ""month""<12), ""temp1"" AS (SELECT EXTRACT(YEAR FROM ""a"".""join_date"") AS ""join_year"",EXTRACT(MONTH FROM ""a"".""join_date"") AS ""join_month"",COUNT(DISTINCT ""b"".""driver_id"") AS ""active_drivers"" FROM ""Drivers"" AS ""a"" LEFT JOIN ""Drivers"" AS ""b"" ON ""a"".""join_date"">=""b"".""join_date"" GROUP BY 1,2 ORDER BY 1,2), ""temp2"" AS (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""requested_month"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")=2020 GROUP BY 1 ORDER BY 1), ""temp4"" AS (SELECT ""c"".""month"",MAX(""a"".""active_drivers"") AS ""active_drivers"" FROM ""temp3"" AS ""c"" LEFT JOIN ""temp1"" AS ""a"" ON ""c"".""month"">=""a"".""join_month"" AND ""a"".""join_year""=2020 GROUP BY 1 ORDER BY 1) SELECT ""c"".""month"",COALESCE(""c"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""b"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""temp4"" AS ""c"" LEFT JOIN ""temp2"" AS ""b"" ON ""c"".""month""=""b"".""requested_month"" ORDER BY 1"
182,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12), ""tbl"" AS (SELECT CAST(RIGHT(""year_month"", 2) AS INTEGER) AS ""month"",""active_drivers"" FROM (SELECT ""year_month"",SUM(""cnt"") OVER (ORDER BY ""year_month"") AS ""active_drivers"" FROM (SELECT EXTRACT(YEAR_MONTH FROM ""join_date"") AS ""year_month"",COUNT(1) AS ""cnt"" FROM ""Drivers"" GROUP BY ""year_month"") AS ""t"") AS ""tt"" WHERE ""tt"".""year_month"" BETWEEN '202001' AND '202012'), ""r"" AS (SELECT COUNT(""t1"".""ride_id"") AS ""accepted_rides"",EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""t1"" JOIN ""Rides"" AS ""t2"" ON ""t1"".""ride_id""=""t2"".""ride_id"" AND ""t2"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month"") SELECT ""seq"".""month"",COALESCE(MAX(""tbl"".""active_drivers"") OVER (ORDER BY ""seq"".""month""), 0) AS ""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""seq"" LEFT JOIN ""tbl"" ON ""seq"".""month""=""tbl"".""month"") LEFT JOIN ""r"" ON ""seq"".""month""=""r"".""month"""
183,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""t"".""month"",(SELECT COUNT(DISTINCT ""driver_id"") FROM ""drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""t"".""month"")) AS ""active_drivers"",(SELECT COUNT(DISTINCT ""a"".""ride_id"") FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' AND EXTRACT(MONTH FROM ""a"".""requested_at"")=""t"".""month"") AS ""accepted_rides"" FROM ""months"" AS ""t"""
184,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""t"".""month"",(SELECT COUNT(DISTINCT ""driver_id"") FROM ""drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""t"".""month"")) AS ""active_drivers"",(SELECT COUNT(DISTINCT ""a"".""ride_id"") FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' AND EXTRACT(MONTH FROM ""a"".""requested_at"")=""t"".""month"") AS ""accepted_rides"" FROM ""months"" AS ""t"""
185,"WITH ""cte"" AS (SELECT 1 AS ""mth"" UNION SELECT 2 AS ""mth"" UNION SELECT 3 AS ""mth"" UNION SELECT 4 AS ""mth"" UNION SELECT 5 AS ""mth"" UNION SELECT 6 AS ""mth"" UNION SELECT 7 AS ""mth"" UNION SELECT 8 AS ""mth"" UNION SELECT 9 AS ""mth"" UNION SELECT 10 AS ""mth"" UNION SELECT 11 AS ""mth"" UNION SELECT 12 AS ""mth"") SELECT ""cte"".""mth"" AS ""month"",(SELECT COUNT(1) FROM ""drivers"" AS ""d2"" WHERE (EXTRACT(MONTH FROM ""join_date"")<=""cte"".""mth"" OR EXTRACT(YEAR FROM ""join_date"")<2020) AND EXTRACT(YEAR FROM ""join_date"")<2021) AS ""active_drivers"",SUM((CASE WHEN ""ar"".""ride_id"" IS NULL THEN 0 ELSE 1 END)) AS ""accepted_rides"" FROM (""cte"" LEFT JOIN ""rides"" AS ""r"" ON ""cte"".""mth""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN (SELECT ""ar1"".* FROM ""acceptedrides"" AS ""ar1"" JOIN ""drivers"" AS ""d"" ON ""d"".""driver_id""=""ar1"".""driver_id"") AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY 1 ORDER BY 1"
186,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""drivers_modifieddate"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ride_modifieddate"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""request_month"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""Rides"".""requested_at"")=2020) SELECT ""t1"".""month"",""t1"".""active_drivers"",COUNT(""ride_modifieddate"".""request_month"") AS ""accepted_rides"" FROM (SELECT ""month"".""month"",COUNT(""drivers_modifieddate"".""month"") AS ""active_drivers"" FROM ""month"" LEFT JOIN ""drivers_modifieddate"" ON ""month"".""month"">=""drivers_modifieddate"".""month"" GROUP BY ""month"".""month"") AS ""t1"" LEFT JOIN ""ride_modifieddate"" ON ""ride_modifieddate"".""request_month""=""t1"".""month"" GROUP BY ""t1"".""month"""
187,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12), ""tbl"" AS (SELECT CAST(RIGHT(""year_month"", 2) AS INTEGER) AS ""month"",""active_drivers"" FROM (SELECT ""year_month"",SUM(""cnt"") OVER (ORDER BY ""year_month"") AS ""active_drivers"" FROM (SELECT EXTRACT(YEAR_MONTH FROM ""join_date"") AS ""year_month"",COUNT(1) AS ""cnt"" FROM ""Drivers"" GROUP BY ""year_month"") AS ""t"") AS ""tt"" WHERE ""tt"".""year_month"" BETWEEN '202001' AND '202012'), ""r"" AS (SELECT COUNT(""t1"".""ride_id"") AS ""accepted_rides"",EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""t1"" JOIN ""Rides"" AS ""t2"" ON ""t1"".""ride_id""=""t2"".""ride_id"" AND ""t2"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month"") SELECT ""seq"".""month"",COALESCE(MAX(""tbl"".""active_drivers"") OVER (ORDER BY ""seq"".""month""), 0) AS ""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""seq"" LEFT JOIN ""tbl"" ON ""seq"".""month""=""tbl"".""month"") LEFT JOIN ""r"" ON ""seq"".""month""=""r"".""month"""
188,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
189,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""mon"" UNION ALL SELECT ""mon""+1 FROM ""m"" WHERE ""mon""<12), ""t1"" AS (SELECT CASE WHEN ""join_date""<'2020-1-1' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""jd"",COUNT(1) AS ""ad"" FROM ""Drivers"" WHERE ""join_date""<'2021-1-1' GROUP BY 1), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mon"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-1-1' AND '2020-12-31' GROUP BY 1) SELECT ""m"".""mon"" AS ""month"",COALESCE(SUM(""ad"") OVER (ORDER BY ""m"".""mon""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""m"" LEFT JOIN ""t1"" ON ""m"".""mon""=""t1"".""jd"") LEFT JOIN ""t2"" ON ""m"".""mon""=""t2"".""mon"""
190,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
191,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""temp1"" AS (SELECT ""cte"".""month"",SUM(COALESCE(""drivers"", 0)) OVER (ORDER BY ""cte"".""month"") AS ""active_drivers"" FROM (SELECT EXTRACT(MONTH FROM CASE WHEN ""join_date""<'2020-01-01' THEN '2020-01-01' ELSE ""join_date"" END) AS ""month"",COUNT(""driver_id"") AS ""drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021 GROUP BY EXTRACT(MONTH FROM CASE WHEN ""join_date""<'2020-01-01' THEN '2020-01-01' ELSE ""join_date"" END)) AS ""sub"" RIGHT JOIN ""cte"" ON ""cte"".""month""=""sub"".""month""), ""temp2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""temp1"".""month"",""active_drivers"",COALESCE(""rides"", 0) AS ""accepted_rides"" FROM ""temp1"" LEFT JOIN ""temp2"" ON ""temp1"".""month""=""temp2"".""month"" ORDER BY ""month"""
192,"WITH RECURSIVE ""CTE"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE"" WHERE ""month""<12) SELECT ""month"",COALESCE(MAX(""active_drivers""), 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""CTE"" LEFT JOIN (SELECT EXTRACT(YEAR FROM ""requested_at"") AS ""YYYY"",EXTRACT(YEAR FROM ""requested_at"")*100+EXTRACT(MONTH FROM ""requested_at"") AS ""YYYYMM"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""Rides"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY EXTRACT(YEAR FROM ""requested_at""),EXTRACT(YEAR FROM ""requested_at"")*100+EXTRACT(MONTH FROM ""requested_at"")) AS ""R"" ON ""CTE"".""month""=""R"".""YYYYMM""-""R"".""YYYY""*100 AND ""R"".""YYYY""=2020) LEFT JOIN (SELECT EXTRACT(YEAR FROM ""join_date"") AS ""YYYY"",EXTRACT(YEAR FROM ""join_date"")*100+EXTRACT(MONTH FROM ""join_date"") AS ""YYYYMM"",COUNT(""driver_id"") OVER (ORDER BY EXTRACT(YEAR FROM ""join_date"")*100+EXTRACT(MONTH FROM ""join_date"")) AS ""active_drivers"" FROM ""Drivers"") AS ""D"" ON ""CTE"".""month"">=""D"".""YYYYMM""-""D"".""YYYY""*100 AND ""D"".""YYYY""=2020 GROUP BY ""month"",COALESCE(""accepted_rides"", 0) ORDER BY 1"
193,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month"" WHERE ""month""<12) SELECT ""t"".""month"",(SELECT COUNT(DISTINCT ""driver_id"") FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""t"".""month"")) AS ""active_drivers"",(SELECT COUNT(DISTINCT ""a"".""ride_id"") FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND EXTRACT(YEAR FROM ""a"".""requested_at"")='2020' AND EXTRACT(MONTH FROM ""a"".""requested_at"")=""t"".""month"") AS ""accepted_rides"" FROM ""month"" AS ""t"""
194,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""ride"" AS (SELECT EXTRACT(MONTH FROM ""a"".""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""rides_cnt"" FROM ""Rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""a"".""requested_at"")=2020 GROUP BY ""month"") SELECT ""x"".""month"",CASE WHEN ""x"".""driver_cnt"" IS NULL THEN 0 ELSE ""x"".""driver_cnt"" END AS ""active_drivers"",CASE WHEN ""y"".""rides_cnt"" IS NULL THEN 0 ELSE ""y"".""rides_cnt"" END AS ""accepted_rides"" FROM (SELECT ""a"".""month"",SUM(""b"".""cnt"") AS ""driver_cnt"" FROM ""cte"" AS ""a"" LEFT JOIN (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""cnt"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY ""month"") AS ""b"" ON ""b"".""month""<=""a"".""month"" GROUP BY ""a"".""month"") AS ""x"" LEFT JOIN ""ride"" AS ""y"" ON ""x"".""month""=""y"".""month"" ORDER BY ""x"".""month"""
195,"WITH RECURSIVE ""a"" AS (SELECT 1 AS ""month"",(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE ""join_date""<'2020-02-01') AS ""active_drivers"",(SELECT COUNT(""Rides"".""ride_id"") FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE ""requested_at"">=CONCAT('2020-', 1, '-01') AND ""requested_at""<CONCAT('2020-', 2, '-01')) AS ""accepted_rides"" UNION ALL SELECT ""month""+1,(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE ""join_date""<CASE WHEN ""month""+2>12 THEN '2021-01-01' ELSE CONCAT('2020-', ""month""+2, '-01') END) AS ""active_drivers"",(SELECT COUNT(""Rides"".""ride_id"") FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE ""requested_at"">=CONCAT('2020-', CASE WHEN ""month""+2>12 THEN 12 ELSE ""month""+1 END, '-01') AND ""requested_at""<CASE WHEN ""month""+2>12 THEN '2021-01-01' ELSE CONCAT('2020-', ""month""+2, '-01') END) AS ""accepted_rides"" FROM ""a"" WHERE ""month""<12) SELECT * FROM ""a"""
196,"WITH RECURSIVE ""months"" (""n"") AS (SELECT 1 UNION ALL SELECT 1+""n"" FROM ""months"" WHERE ""n""<12), ""driver_rides"" AS (SELECT ""ar"".""driver_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""ride_month"",COUNT(""r"".""ride_id"") AS ""cnt"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""ar"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 AND ""ar"".""ride_id""=""r"".""ride_id"" GROUP BY ""driver_id"",""ride_month"") SELECT ""n"" AS ""month"",COUNT(""d"".""driver_id"") AS ""active_drivers"",COALESCE(SUM(""dr"".""cnt""), 0) AS ""accepted_rides"" FROM (""months"" LEFT JOIN ""Drivers"" AS ""d"" ON EXTRACT(YEAR FROM ""join_date"")=2020 AND EXTRACT(MONTH FROM ""join_date"")<=""n"" OR EXTRACT(YEAR FROM ""join_date"")<2020) LEFT JOIN ""driver_rides"" AS ""dr"" ON ""d"".""driver_id""=""dr"".""driver_id"" AND ""n""=""dr"".""ride_month"" GROUP BY ""month"" ORDER BY ""month"""
197,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""n"" UNION ALL SELECT ""n""+1 AS ""n"" FROM ""cte"" WHERE ""n""<12), ""acc"" AS (SELECT ""requested_at"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""totdrivers"" AS (SELECT ""n"" AS ""month"",(SELECT COUNT(1) FROM ""drivers"" WHERE ((EXTRACT(YEAR FROM ""join_date"")=2020 AND EXTRACT(MONTH FROM ""join_date"")<=""c"".""n"") OR (EXTRACT(YEAR FROM ""join_date"")<2020))) AS ""active_drivers"",(SELECT COUNT(1) FROM ""acc"" WHERE (EXTRACT(MONTH FROM ""requested_at"")=""c"".""n"")) AS ""accepted_rides"" FROM ""cte"" AS ""c"") SELECT * FROM ""totdrivers"""
198,"WITH RECURSIVE ""Month_CTE"" AS (SELECT 1 AS ""Month"" UNION ALL SELECT ""Month""+1 FROM ""Month_CTE"" WHERE ""Month""<12), ""Ride_cte"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""Month"",COUNT(DISTINCT (""r"".""ride_id"")) AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")), ""driver_cte"" AS (SELECT ""t2"".""Month"",COUNT(DISTINCT ""t2"".""driver_id"") AS ""active_drivers"" FROM (SELECT * FROM ""Month_CTE"" AS ""m"" LEFT JOIN (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""Month_d"",""driver_id"" FROM ""Drivers"" AS ""d"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021) AS ""d"" ON ""m"".""Month"">=""d"".""Month_d"") AS ""t2"" GROUP BY ""t2"".""Month"") SELECT ""t1"".*,COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""driver_cte"" AS ""t1"" LEFT JOIN ""ride_cte"" AS ""t2"" ON ""t1"".""month""=""t2"".""month"""
199,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<=11) SELECT ""c"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM ((""cte"" AS ""c"" LEFT JOIN (SELECT ""driver_id"",CASE WHEN ""join_date""<'2020-01-01' THEN '2020-01-01' ELSE ""join_date"" END AS ""join_date"" FROM ""Drivers"") AS ""d"" ON ""c"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")<2021) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""d"".""driver_id""=""a"".""driver_id"") LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" AND ""c"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1 ORDER BY 1"
200,"WITH RECURSIVE ""temp0"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""temp0"" WHERE ""month""<12), ""temp1"" AS (SELECT ""a"".""driver_id"",""b"".""requested_at"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""b"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31'), ""temp2"" AS (SELECT ""a"".""month"",""b"".""driver_id"",""c"".""driver_id"" AS ""accepted"" FROM (""temp0"" AS ""a"" LEFT JOIN ""Drivers"" AS ""b"" ON ""a"".""month""+2020*12>=EXTRACT(YEAR FROM ""b"".""join_date"")*12+EXTRACT(MONTH FROM ""b"".""join_date"")) LEFT JOIN ""temp1"" AS ""c"" ON ""c"".""driver_id""=""b"".""driver_id"" AND EXTRACT(YEAR FROM ""c"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""c"".""requested_at"")=""a"".""month"") SELECT ""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(""accepted"") AS ""accepted_rides"" FROM ""temp2"" GROUP BY 1 ORDER BY 1"
201,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""acctive_drivers"" AS (SELECT ""month"",SUM(""driver_num"") OVER (ORDER BY ""month"") AS ""active_driver_num"" FROM (SELECT ""m"".*,COALESCE(""d"".""driver_num"", 0) AS ""driver_num"" FROM ""months"" AS ""m"" LEFT JOIN (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2020 THEN EXTRACT(MONTH FROM ""join_date"") ELSE 1 END AS ""month"",COUNT(1) AS ""driver_num"" FROM ""Drivers"" WHERE ""join_date""<DATE('2021-01-01') GROUP BY 1) AS ""d"" ON ""m"".""month""=""d"".""month"") AS ""a""), ""accepted_rides"" AS (SELECT ""m"".""month"",COALESCE(""ar"".""accepted_ride"", 0) AS ""accepted_ride"" FROM ""months"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_ride"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") AS ""ar"" ON ""m"".""month""=""ar"".""month"") SELECT ""ad"".""month"",""ad"".""active_driver_num"" AS ""active_drivers"",""ar"".""accepted_ride"" AS ""accepted_rides"" FROM ""acctive_drivers"" AS ""ad"" JOIN ""accepted_rides"" AS ""ar"" ON ""ad"".""month""=""ar"".""month"""
202,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""active"" AS (SELECT COUNT(""driver_id"") AS ""drivecounts"",EXTRACT(YEAR FROM ""join_date"") AS ""year"",EXTRACT(MONTH FROM ""join_date"") AS ""month"" FROM ""drivers"" GROUP BY ""year"",""month""), ""activecounts"" AS (SELECT SUM(""d1"".""drivecounts"") AS ""activedrivers"",""m"".""month"" AS ""month"" FROM (""month"" AS ""m"") JOIN ""active"" AS ""d1"" WHERE ((""d1"".""year""=2019) OR (""d1"".""year""=2020 AND ""m"".""month"">=""d1"".""month"")) GROUP BY ""m"".""month"") SELECT ""m"".""month"",COALESCE(""d"".""activedrivers"", 0) AS ""active_drivers"",COALESCE(""tmp2"".""acceptedcounts"", 0) AS ""accepted_rides"" FROM (""month"" AS ""m"" LEFT JOIN ""activecounts"" AS ""d"" ON ""m"".""month""=""d"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""request_month"",COUNT(DISTINCT ""ride_id"") AS ""acceptedcounts"" FROM (SELECT ""a"".*,""r"".""requested_at"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) AS ""tmp"" GROUP BY EXTRACT(MONTH FROM ""requested_at"") ORDER BY EXTRACT(MONTH FROM ""requested_at"")) AS ""tmp2"" ON ""tmp2"".""request_month""=""m"".""month"" ORDER BY ""m"".""month"""
203,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""driver1"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""driver2"" AS (SELECT ""month"",COUNT(DISTINCT ""driver_id"") AS ""driver_per_month"" FROM ""driver1"" GROUP BY ""month""), ""accepted"" AS (SELECT COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_ride"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""t"" AS (SELECT ""cte"".""month"",COALESCE(""driver_per_month"", 0) AS ""driver_per_month"" FROM ""cte"" LEFT JOIN ""driver2"" ON ""cte"".""month""=""driver2"".""month"") SELECT ""t"".""month"",SUM(""driver_per_month"") OVER (ORDER BY ""t"".""month"") AS ""active_drivers"",COALESCE(""accepted_ride"", 0) AS ""accepted_rides"" FROM ""t"" LEFT JOIN ""accepted"" AS ""a"" ON ""t"".""month""=""a"".""month"" ORDER BY 1"
204,"WITH RECURSIVE ""CTE1"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""REQUESTED_AT"") AS ""MONTH"",""A"".""RIDE_ID"" FROM ""RIDES"" AS ""R"" JOIN ""ACCEPTEDRIDES"" AS ""A"" ON ""R"".""RIDE_ID""=""A"".""RIDE_ID"" WHERE EXTRACT(YEAR FROM ""REQUESTED_AT"")=2020), ""CTE3"" AS (SELECT ""CTE1"".""MONTH"",COUNT(""RIDE_ID"") AS ""ACCEPTED_RIDES"" FROM ""CTE1"" LEFT JOIN ""CTE2"" USING (""MONTH"") GROUP BY ""CTE1"".""MONTH""), ""CTE4"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""JOIN_DATE"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""JOIN_DATE"") END AS ""MONTH"",""DRIVER_ID"" FROM ""DRIVERS"" WHERE EXTRACT(YEAR FROM ""JOIN_DATE"")<=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""MONTH"",COUNT(""DRIVER_ID"") OVER (ORDER BY ""CTE1"".""MONTH"") AS ""ACTIVE_DRIVERS"" FROM ""CTE1"" LEFT JOIN ""CTE4"" USING (""MONTH"")) SELECT ""CTE3"".""MONTH"",""ACTIVE_DRIVERS"",""ACCEPTED_RIDES"" FROM ""CTE3"" JOIN ""CTE5"" USING (""MONTH"")"
205,"WITH ""act_driver"" AS (SELECT COUNT(CASE WHEN ""join_date""<='2020-1-31' THEN ""d"".""driver_id"" END) AS ""Jan"",COUNT(CASE WHEN ""join_date""<='2020-2-29' THEN ""d"".""driver_id"" END) AS ""Feb"",COUNT(CASE WHEN ""join_date""<='2020-3-31' THEN ""d"".""driver_id"" END) AS ""Mar"",COUNT(CASE WHEN ""join_date""<='2020-4-30' THEN ""d"".""driver_id"" END) AS ""Apr"",COUNT(CASE WHEN ""join_date""<='2020-5-31' THEN ""d"".""driver_id"" END) AS ""May"",COUNT(CASE WHEN ""join_date""<='2020-6-30' THEN ""d"".""driver_id"" END) AS ""Jun"",COUNT(CASE WHEN ""join_date""<='2020-7-31' THEN ""d"".""driver_id"" END) AS ""Jul"",COUNT(CASE WHEN ""join_date""<='2020-8-31' THEN ""d"".""driver_id"" END) AS ""Aug"",COUNT(CASE WHEN ""join_date""<='2020-9-30' THEN ""d"".""driver_id"" END) AS ""Sep"",COUNT(CASE WHEN ""join_date""<='2020-10-31' THEN ""d"".""driver_id"" END) AS ""Oct"",COUNT(CASE WHEN ""join_date""<='2020-11-30' THEN ""d"".""driver_id"" END) AS ""Nov"",COUNT(CASE WHEN ""join_date""<='2020-12-31' THEN ""d"".""driver_id"" END) AS ""Dec"" FROM ""drivers"" AS ""d""), ""num_acc_rides"" AS (SELECT COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-1-1' AND '2020-1-31' THEN ""ac"".""ride_id"" END) AS ""Jan_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-2-1' AND '2020-2-29' THEN ""ac"".""ride_id"" END) AS ""Feb_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-3-1' AND '2020-3-31' THEN ""ac"".""ride_id"" END) AS ""Mar_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-4-1' AND '2020-4-30' THEN ""ac"".""ride_id"" END) AS ""Apr_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-5-1' AND '2020-5-31' THEN ""ac"".""ride_id"" END) AS ""May_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-6-1' AND '2020-6-30' THEN ""ac"".""ride_id"" END) AS ""Jun_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-7-1' AND '2020-7-31' THEN ""ac"".""ride_id"" END) AS ""Jul_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-8-1' AND '2020-8-31' THEN ""ac"".""ride_id"" END) AS ""Aug_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-9-1' AND '2020-9-30' THEN ""ac"".""ride_id"" END) AS ""Sep_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-10-1' AND '2020-10-31' THEN ""ac"".""ride_id"" END) AS ""Oct_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-11-1' AND '2020-11-30' THEN ""ac"".""ride_id"" END) AS ""Nov_acc"",COUNT(CASE WHEN ""requested_at"" BETWEEN '2020-12-1' AND '2020-12-31' THEN ""ac"".""ride_id"" END) AS ""Dec_acc"" FROM ""rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ac"" ON ""r"".""ride_id""=""ac"".""ride_id""), ""active_drivers_col"" AS (SELECT ""Jan"" AS ""active_drivers"",1 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Feb"",2 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Mar"",3 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Apr"",4 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""May"",5 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Jun"",6 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Jul"",7 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Aug"",8 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Sep"",9 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Oct"",10 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Nov"",11 AS ""month"" FROM ""act_driver"" UNION ALL SELECT ""Dec"",12 AS ""month"" FROM ""act_driver""), ""acc_rides_col"" AS (SELECT ""Jan_acc"" AS ""accepted_rides"",1 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Feb_acc"",2 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Mar_acc"",3 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Apr_acc"",4 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""May_acc"",5 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Jun_acc"",6 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Jul_acc"",7 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Aug_acc"",8 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Sep_acc"",9 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Oct_acc"",10 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Nov_acc"",11 AS ""month"" FROM ""num_acc_rides"" UNION ALL SELECT ""Dec_acc"",12 AS ""month"" FROM ""num_acc_rides"") SELECT ""t1"".""month"",""active_drivers"",""accepted_rides"" FROM ""active_drivers_col"" AS ""t1"" JOIN ""acc_rides_col"" AS ""t2"" ON ""t1"".""month""=""t2"".""month"""
206,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""num"" UNION ALL SELECT ""num""+1 FROM ""month"" WHERE ""num""+1<=12), ""temp2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""mnth"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""temp3"" AS (SELECT ""num"" AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""num"") AS ""active_drivers"" FROM ""month"" LEFT JOIN ""temp2"" ON ""month"".""num""=""temp2"".""mnth""), ""temp4"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mnth"",COUNT(DISTINCT ""AcceptedRides"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT DISTINCT ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""temp3"" LEFT JOIN ""temp4"" ON ""temp3"".""month""=""temp4"".""mnth"""
207,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
208,"WITH RECURSIVE ""CTE"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY LEFT(""join_date"", 7)) AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" WHERE ""r"".""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""CTE"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""CTE"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""CTE"" LEFT JOIN ""t1"" ON ""CTE"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""CTE"".""month""=""t2"".""month"""
209,"WITH ""cte_spine"" AS (WITH RECURSIVE ""cte_recursive"" AS (SELECT 0 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte_recursive"" WHERE ""month""<12) SELECT * FROM ""cte_recursive""), ""cte_drivers"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 0 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""Ndrivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY ""month""), ""cte_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""Nrides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" ON (""ar"".""ride_id""=""rides"".""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"") ORDER BY ""month""), ""cte_allmonths"" AS (SELECT ""cte_spine"".""month"",COALESCE(""Ndrivers"", 0) AS ""Ndrivers"",COALESCE(""Nrides"", 0) AS ""accepted_rides"" FROM (""cte_spine"" LEFT JOIN ""cte_drivers"" ON (""cte_spine"".""month""=""cte_drivers"".""month"")) LEFT JOIN ""cte_rides"" ON (""cte_spine"".""month""=""cte_rides"".""month"")), ""cte_allmonths_cum"" AS (SELECT ""month"",SUM(""Ndrivers"") OVER (ORDER BY ""month"" RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"",""accepted_rides"" FROM ""cte_allmonths"") SELECT * FROM ""cte_allmonths_cum"" WHERE ""month"">0"
210,"WITH RECURSIVE ""CTE"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" WHERE ""r"".""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""CTE"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""CTE"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""CTE"" LEFT JOIN ""t1"" ON ""CTE"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""CTE"".""month""=""t2"".""month"""
211,"WITH RECURSIVE ""datedim"" AS (SELECT STR_TO_DATE('20200101', '%Y%m%d') AS ""datevalue"" UNION ALL SELECT ""datevalue"" + INTERVAL '1 MONTH' FROM ""datedim"" WHERE ""datevalue""<'20201201'), ""active_driver_per_month"" AS (SELECT LAST_DAY(""dd"".""datevalue"") AS ""datevalue"",COUNT(""d"".""join_date"") AS ""active_drivers"" FROM ""datedim"" AS ""dd"" LEFT JOIN ""drivers"" AS ""d"" ON ""d"".""join_date""<=LAST_DAY(""dd"".""datevalue"") GROUP BY ""dd"".""datevalue""), ""accepted_ride_per_month"" AS (SELECT LAST_DAY(""requested_at"") AS ""requestDate"",COUNT(""ar"".""ride_id"") AS ""AcceptedRides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY LAST_DAY(""requested_at"")) SELECT EXTRACT(MONTH FROM ""adr"".""datevalue"") AS ""month"",""adr"".""active_drivers"",COALESCE(""ar"".""AcceptedRides"", 0) AS ""accepted_rides"" FROM ""active_driver_per_month"" AS ""adr"" LEFT JOIN ""accepted_ride_per_month"" AS ""ar"" ON ""ar"".""requestDate""=""adr"".""datevalue"" ORDER BY 1"
212,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""driver_count"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""acc_count"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""d"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""a"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""driver_count"" AS ""d"" ON ""m"".""month""=""d"".""month"") LEFT JOIN ""acc_count"" AS ""a"" ON ""m"".""month""=""a"".""month"""
213,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
214,"WITH RECURSIVE ""A"" AS (SELECT EXTRACT(YEAR FROM ""join_date"") AS ""yr"",EXTRACT(MONTH FROM ""join_date"") AS ""mth"",COUNT(1) AS ""ct"" FROM ""Drivers"" GROUP BY ""yr"",""mth"" HAVING ""yr""<2021), ""B"" AS (SELECT 1 AS ""mth"" UNION ALL SELECT ""mth""+1 FROM ""B"" WHERE ""mth""<12), ""C"" AS (SELECT * FROM ""A"" WHERE ""yr""=2020), ""D"" AS (SELECT ""B"".""mth"",COALESCE(""C"".""ct"", 0) AS ""ct"" FROM ""B"" LEFT JOIN ""C"" ON ""B"".""mth""=""C"".""mth""), ""E"" AS (SELECT ""mth"",SUM(""ct"") OVER (ORDER BY ""mth"") AS ""total"" FROM ""D""), ""active_driver"" AS (SELECT ""mth"",""total""+COALESCE((SELECT SUM(""ct"") FROM ""A"" WHERE ""yr""<2020), 0) AS ""active_drivers"" FROM ""E""), ""F"" AS (SELECT ""AcceptedRides"".""ride_id"",""requested_at"" FROM ""AcceptedRides"" JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id""), ""G"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""mth"",COUNT(1) AS ""ct"" FROM ""F"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""mth"") SELECT ""active_driver"".""mth"" AS ""month"",""active_driver"".""active_drivers"",COALESCE(""ct"", 0) AS ""accepted_rides"" FROM ""active_driver"" LEFT JOIN ""G"" ON ""active_driver"".""mth""=""G"".""mth"" ORDER BY ""month"""
215,"WITH RECURSIVE ""cte_month_spine"" AS (SELECT 1 AS ""n"" UNION ALL SELECT ""n""+1 AS ""n"" FROM ""cte_month_spine"" WHERE ""n""<12), ""cte_drivers"" AS (SELECT ""ms"".""n"" AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""cte_month_spine"" AS ""ms"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(CONCAT('2020-', ""ms"".""n"", '-01'))>=""d"".""join_date"" GROUP BY 1), ""cte_accepted_rides"" AS (SELECT ""ms"".""n"" AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM (""cte_month_spine"" AS ""ms"" LEFT JOIN ""Rides"" AS ""r"" ON ""r"".""requested_at"" BETWEEN CONCAT('2020-', ""ms"".""n"", '-01') AND LAST_DAY(CONCAT('2020-', ""ms"".""n"", '-01'))) LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY 1), ""cte_final"" AS (SELECT ""d"".""month"",""active_drivers"",""accepted_rides"" FROM ""cte_drivers"" AS ""d"" JOIN ""cte_accepted_rides"" AS ""ar"" ON ""d"".""month""=""ar"".""month"" ORDER BY 1) SELECT * FROM ""cte_final"""
216,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""active_driver"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""driver_cnt"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(DISTINCT ""ride_id"") AS ""ride_cnt"" FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT DISTINCT ""months"".""month"",COALESCE(MAX(""driver_cnt"") OVER (ORDER BY ""months"".""month""), 0) AS ""active_drivers"",COALESCE(""ride_cnt"", 0) AS ""accepted_rides"" FROM (""months"" LEFT JOIN ""active_driver"" ON ""months"".""month""=""active_driver"".""month"") LEFT JOIN ""accepted_rides"" ON ""months"".""month""=""accepted_rides"".""month"" ORDER BY ""months"".""month"""
217,"WITH ""months"" (""month"") AS (SELECT * FROM (VALUES ROW(1), ROW(2), ROW(3), ROW(4), ROW(5), ROW(6), ROW(7), ROW(8), ROW(9), ROW(10), ROW(11), ROW(12)) AS ""v""), ""valid_rides"" AS (SELECT ""ride_id"",""requested_at"" AS ""ride_date"" FROM ""AcceptedRides"" NATURAL LEFT JOIN ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""ride_count"" AS (SELECT ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""months"" LEFT JOIN ""valid_rides"" ON ""month""=EXTRACT(MONTH FROM ""ride_date"") GROUP BY ""month""), ""drivers_count"" AS (SELECT ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""months"" JOIN ""Drivers"" WHERE (EXTRACT(YEAR FROM ""join_date"")=2020 AND EXTRACT(MONTH FROM ""join_date"")<=""month"") OR EXTRACT(YEAR FROM ""join_date"")<2020 GROUP BY ""month"" ORDER BY ""month"") SELECT ""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""ride_count"" NATURAL LEFT JOIN ""drivers_count"" ORDER BY 1"
218,"WITH ""tbM"" AS (SELECT 1 AS ""month"" UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12), ""tbR"" AS (SELECT ""tbM"".""month"",COUNT(""drivers"".""driver_id"") AS ""active_drivers"" FROM ""drivers"" RIGHT JOIN ""tbM"" ON (EXTRACT(YEAR FROM ""drivers"".""join_date"")<2020 OR (EXTRACT(YEAR FROM ""drivers"".""join_date"")=2020 AND EXTRACT(MONTH FROM ""drivers"".""join_date"")<=""tbM"".""month"")) GROUP BY ""tbM"".""month"") SELECT ""tbR"".""month"",""tbR"".""active_drivers"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM (""tbR"" LEFT JOIN ""rides"" AS ""r"" ON EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""r"".""requested_at"")=""tbR"".""month"") LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""tbR"".""month"""
219,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""month"" WHERE ""month""<12), ""new_drivers"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") AS ""new_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY EXTRACT(MONTH FROM ""join_date"")), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""temp"".""month"" AS ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""m"".""month"" AS ""month"",COALESCE(SUM(""nd2"".""new_drivers"")+(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020), 0) AS ""active_drivers"" FROM (""month"" AS ""m"" LEFT JOIN ""new_drivers"" AS ""nd1"" ON ""m"".""month""=""nd1"".""month"") LEFT JOIN ""new_drivers"" AS ""nd2"" ON ""m"".""month"">=""nd2"".""month"" GROUP BY ""m"".""month"") AS ""temp"" LEFT JOIN ""accepted_rides"" AS ""a"" ON ""temp"".""month""=""a"".""month"""
220,"WITH RECURSIVE ""AllMonths"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""AllMonths"" WHERE ""month""<12), ""DriversActiveSince"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""Month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ActiveDriversMonths"" AS (SELECT ""AM"".""Month"",COUNT(""DAS"".""driver_id"") AS ""new_active_drivers"" FROM ""DriversActiveSince"" AS ""DAS"" RIGHT JOIN ""AllMonths"" AS ""AM"" ON ""AM"".""month""=""DAS"".""month"" GROUP BY ""AM"".""Month""), ""CumulativeActiveDrivers"" AS (SELECT ""Month"",SUM(""new_active_drivers"") OVER (ORDER BY ""Month"") AS ""active_drivers"" FROM ""ActiveDriversMonths""), ""MonthlyRides"" AS (SELECT ""AR"".""ride_id"",EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""MontlyRidesSummary"" AS (SELECT ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""MonthlyRides"" GROUP BY ""month"") SELECT ""CAD"".""Month"",""CAD"".""active_drivers"",COALESCE(""MRS"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""CumulativeActiveDrivers"" AS ""CAD"" LEFT JOIN ""MontlyRidesSummary"" AS ""MRS"" ON ""MRS"".""month""=""CAD"".""month"""
221,"WITH RECURSIVE ""MONTH"" AS (SELECT 1 AS ""MONTH"" UNION SELECT ""MONTH""+1 AS ""MONTH"" FROM ""MONTH"" WHERE ""MONTH""<=11), ""ACTIVE_DRIVERS"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ACCEPTED_RIDES"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" JOIN ""rides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""M"".""MONTH"",COALESCE(MAX(""active_drivers"") OVER (ORDER BY ""month""), 0) AS ""active_drivers"",COALESCE(""ACCEPTED_RIDES"", 0) AS ""ACCEPTED_RIDES"" FROM (""MONTH"" AS ""m"" LEFT JOIN ""active_drivers"" ON ""M"".""MONTH""=""active_drivers"".""MONTH"") LEFT JOIN ""ACCEPTED_RIDES"" ON ""M"".""MONTH""=""ACCEPTED_RIDES"".""MONTH"""
222,"ERROR: mysql parse error: line 1 column 70 near ""), d_stat as ( Select m.month, count(driver_id) as active_drivers from m left join Drivers d on (date_add(concat('2020-', m.month, '-01'), INTERVAL 1 MONTH) > d.join_date) group by month ), a_rides2020 as ( select month(requested_at) as month, count(*) as accepted_rides from AcceptedRides a join Rides USING(ride_id) where year(requested_at) = '2020' group by month ) select month, active_drivers, coalesce(accepted_rides, 0) as accepted_rides from d_stat left join a_rides2020 USING(month) "" "
223,"WITH ""rec"" AS (WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12) SELECT * FROM ""seq""), ""d_agg"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")>2020 THEN NULL ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month_2020"",COUNT(DISTINCT ""driver_id"") AS ""ct"" FROM ""drivers"" GROUP BY 1), ""ac_d"" AS (SELECT ""r"".""month"",SUM(COALESCE(""d"".""ct"", 0)) OVER (ORDER BY ""r"".""month"") AS ""ac_drivers"" FROM ""rec"" AS ""r"" LEFT JOIN ""d_agg"" AS ""d"" ON ""r"".""month""=""d"".""join_month_2020""), ""ac_r"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""ac_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""ac_d"".""month"" AS ""month"",""ac_d"".""ac_drivers"" AS ""active_drivers"",COALESCE(""ac_r"".""ac_rides"", 0) AS ""accepted_rides"" FROM ""ac_d"" LEFT JOIN ""ac_r"" ON ""ac_d"".""month""=""ac_r"".""month"""
224,"WITH RECURSIVE ""cte"" (""n"") AS (SELECT 1 UNION ALL SELECT ""n""+1 FROM ""cte"" WHERE ""n""<12), ""rides_by_month"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""Rides"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1 ORDER BY 1), ""active_drivers"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<='2019' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<='2020' GROUP BY 1) SELECT ""n"" AS ""month"",SUM(COALESCE(""active_drivers"", 0)) OVER (ORDER BY ""n"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" LEFT JOIN ""rides_by_month"" ON ""rides_by_month"".""month""=""cte"".""n"") LEFT JOIN ""active_drivers"" ON ""active_drivers"".""join_month""=""cte"".""n"""
225,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE1"" WHERE 1+""month""<=12), ""CTE2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""CTE3"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE2"".""driver_id"") OVER (ORDER BY ""CTE1"".""month"") AS ""active_drivers"" FROM ""CTE1"" LEFT JOIN ""CTE2"" ON ""CTE1"".""month""=""CTE2"".""month""), ""CTE4"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""A"".""driver_id"" FROM (""Rides"" AS ""R"") JOIN ""AcceptedRIdes"" AS ""A"" WHERE ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE4"".""driver_id"") OVER (PARTITION BY ""CTE1"".""month"") AS ""accepted_rides"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month"") SELECT ""CTE5"".""month"",""CTE3"".""active_drivers"",""CTE5"".""accepted_rides"" FROM (""CTE5"") JOIN ""CTE3"" WHERE ""CTE5"".""month""=""CTE3"".""month"""
226,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""active_drivers"" AS (SELECT 0 AS ""month"",COUNT(""driver_id"") AS ""cnt"" FROM ""Drivers"" WHERE ""join_date""<'2020-01-01' UNION SELECT TO_CHAR(""join_date"", '%m') AS ""month"",COUNT(""driver_id"") AS ""cnt"" FROM ""Drivers"" WHERE ""join_date"" LIKE '2020%' GROUP BY 1), ""accept"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",COUNT(""c"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""b"" LEFT JOIN ""AcceptedRides"" AS ""c"" USING (""ride_id"") WHERE ""requested_at"" LIKE '2020%' GROUP BY 1) SELECT ""month"",""active_drivers"",""accepted_rides"" FROM (SELECT ""cte"".""month"",SUM(""cnt"") OVER (ORDER BY ""cte"".""month"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" LEFT JOIN ""active_drivers"" AS ""a"" USING (""month"")) LEFT JOIN ""accept"" ON ""cte"".""month""=""accept"".""month"") AS ""t"" WHERE ""month"">0"
227,"WITH RECURSIVE ""a"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""a"" WHERE ""month""<12), ""b"" AS (SELECT ""driver_id"",""join_date"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN '2020-01-01' ELSE ""join_date"" END AS ""driver_active_date"" FROM ""drivers""), ""c"" AS (SELECT DISTINCT ""a"".""month"",COUNT(""b"".""driver_id"") OVER (PARTITION BY ""a"".""month"") AS ""active_driver"" FROM ""a"" LEFT JOIN ""b"" ON ""a"".""month""=EXTRACT(MONTH FROM ""b"".""driver_active_date"") AND EXTRACT(YEAR FROM ""b"".""driver_active_date"")=2020), ""d"" AS (SELECT DISTINCT ""a"".""month"",COUNT(""r"".""ride_id"") OVER (PARTITION BY ""a"".""month"") AS ""accepted_rides"" FROM ""a"" LEFT JOIN ""rides"" AS ""r"" ON ""a"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 AND ""r"".""ride_id"" IN (SELECT ""ride_id"" FROM ""acceptedrides"")) SELECT ""c"".""month"",SUM(""c"".""active_driver"") OVER (ORDER BY ""c"".""month"") AS ""active_drivers"",""accepted_rides"" FROM ""c"" LEFT JOIN ""d"" ON ""c"".""month""=""d"".""month"""
228,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT (CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")=2020 THEN EXTRACT(MONTH FROM ""join_date"") ELSE 0 END) AS ""driver_month"" FROM ""Drivers""), ""t3"" AS (SELECT ""t1"".""month"",COUNT(1) AS ""c1"" FROM ""t1"" JOIN ""t2"" ON ""t1"".""month""=""t2"".""driver_month"" GROUP BY 1), ""t4"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(1) AS ""c2"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT ""t1"".""month"",SUM(COALESCE(""t3"".""c1"", 0)) OVER (ORDER BY ""t1"".""month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"",SUM(COALESCE(""t4"".""c2"", 0)) AS ""accepted_rides"" FROM (""t1"" LEFT JOIN ""t3"" ON ""t1"".""month""=""t3"".""month"") LEFT JOIN ""t4"" ON ""t1"".""month""=""t4"".""month"" GROUP BY 1"
229,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""m"" WHERE ""month""<12), ""driver"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""join_month"",COUNT(""driver_id"") AS ""num_drivers"" FROM (SELECT ""driver_id"",(CASE WHEN ""join_Date""<'2020-01-01' THEN '2020-01-01' ELSE ""join_date"" END) AS ""join_date"" FROM ""drivers"" WHERE ""join_date""<'2021-01-01') AS ""t1"" GROUP BY 1), ""Ac_ride"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""ride_month"",COUNT(""ride_id"") AS ""num_ride"" FROM ""rides"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")='2020' GROUP BY 1) SELECT ""month"",COALESCE(SUM(""num_drivers"") OVER (ORDER BY ""month""), 0) AS ""active_drivers"",COALESCE(""num_ride"", 0) AS ""accepted_rides"" FROM (""m"" LEFT JOIN ""driver"" ON ""driver"".""join_month""=""m"".""month"") LEFT JOIN ""Ac_ride"" ON ""Ac_ride"".""ride_month""=""m"".""month"""
230,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
231,"WITH RECURSIVE ""year_cte"" AS (SELECT MIN(EXTRACT(YEAR FROM ""join_date"")) AS ""year"",MAX(EXTRACT(YEAR FROM ""join_date"")) AS ""max_year"" FROM ""drivers"" UNION ALL SELECT ""year""+1,""max_year"" FROM ""year_cte"" WHERE ""year""<""max_year""), ""header"" AS (SELECT ""year"",1 AS ""month"",12 AS ""max_month"" FROM ""year_cte"" UNION ALL SELECT ""year"",""month""+1,""max_month"" FROM ""header"" WHERE ""month""<""max_month""), ""drivers_count"" AS (SELECT MAX(EXTRACT(YEAR FROM ""join_date"")) AS ""year"",MAX(EXTRACT(MONTH FROM ""join_date"")) AS ""month"",COUNT(""driver_id"") AS ""drivers_count"" FROM ""drivers"" GROUP BY LEFT(""join_date"", 7)), ""rides_count"" AS (SELECT MAX(EXTRACT(YEAR FROM ""r"".""requested_at"")) AS ""year"",MAX(EXTRACT(MONTH FROM ""r"".""requested_at"")) AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" LEFT JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY LEFT(""r"".""requested_at"", 7)) SELECT ""month"",""active_drivers"",""accepted_rides"" FROM (SELECT ""t1"".""month"",""t1"".""year"",COALESCE(SUM(""t2"".""drivers_count"") OVER (ORDER BY ""t1"".""year"",""t1"".""month""), 0) AS ""active_drivers"",COALESCE(""t3"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""header"" AS ""t1"" LEFT JOIN ""drivers_count"" AS ""t2"" ON ""t1"".""year""=""t2"".""year"" AND ""t1"".""month""=""t2"".""month"") LEFT JOIN ""rides_count"" AS ""t3"" ON ""t1"".""year""=""t3"".""year"" AND ""t1"".""month""=""t3"".""month"") AS ""temp"" WHERE ""year""=2020"
232,"WITH RECURSIVE ""cte"" AS (SELECT 2020 AS ""year"",CAST(1 AS INTEGER) AS ""month"" UNION ALL SELECT 2020,""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte1"" AS (SELECT 2019 AS ""year"",CAST(1 AS INTEGER) AS ""month"" UNION ALL SELECT 2019,""month""+1 FROM ""cte1"" WHERE ""month""<12), ""ac_rides"" AS (SELECT EXTRACT(YEAR FROM ""requested_at"") AS ""yrr"",LPAD(EXTRACT(MONTH FROM ""requested_at""), 2, '0') AS ""month"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM (""AcceptedRides"" AS ""a"") JOIN ""rides"" AS ""r"" WHERE ""a"".""ride_id""=""r"".""ride_id"" AND ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1,2 ORDER BY 1,2) SELECT DISTINCT ""mn"" AS ""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT CONCAT(""cc"".""year"", ""cc"".""month""),""cc"".""year"" AS ""yr"",""cc"".""month"" AS ""mn"",SUM(""ct"") OVER (ORDER BY ""cc"".""year"",""cc"".""month"") AS ""active_drivers"" FROM (SELECT * FROM ""cte"" UNION SELECT * FROM ""cte1"") AS ""cc"" LEFT JOIN (SELECT ""driver_id"",""join_date"",COUNT(""driver_id"") AS ""ct"" FROM ""drivers"" GROUP BY ""join_date"") AS ""x"" ON CONCAT(""cc"".""year"", ""cc"".""month"")=CONCAT(EXTRACT(YEAR FROM ""join_date""), EXTRACT(MONTH FROM ""join_date"")) ORDER BY CONCAT(""cc"".""year"", ""cc"".""month"")) AS ""xx"" LEFT JOIN ""ac_rides"" ON ""ac_rides"".""yrr""=""xx"".""yr"" AND ""ac_rides"".""month""=""xx"".""mn"" WHERE ""yr""!='2019' ORDER BY ""mn"""
233,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
234,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""m"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" WHERE ""r"".""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT DISTINCT ""m"".""month"" AS ""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
235,"WITH RECURSIVE ""cte_month_spine"" AS (SELECT 1 AS ""n"" UNION ALL SELECT ""n""+1 AS ""n"" FROM ""cte_month_spine"" WHERE ""n""<12), ""cte_drivers"" AS (SELECT ""ms"".""n"" AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""cte_month_spine"" AS ""ms"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(CONCAT('2020-', ""ms"".""n"", '-01'))>=""d"".""join_date"" GROUP BY 1), ""cte_accepted_rides"" AS (SELECT ""ms"".""n"" AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM (""cte_month_spine"" AS ""ms"" LEFT JOIN ""Rides"" AS ""r"" ON ""r"".""requested_at"" BETWEEN CONCAT('2020-', ""ms"".""n"", '-01') AND LAST_DAY(CONCAT('2020-', ""ms"".""n"", '-01'))) LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY 1), ""cte_final"" AS (SELECT ""d"".""month"",""active_drivers"",""accepted_rides"" FROM ""cte_drivers"" AS ""d"" JOIN ""cte_accepted_rides"" AS ""ar"" ON ""d"".""month""=""ar"".""month"" ORDER BY 1) SELECT * FROM ""cte_final"""
236,"WITH RECURSIVE ""CTE"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE"" WHERE ""month""<12), ""t1"" AS (SELECT ""a"".""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM (SELECT ""r"".""ride_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) AS ""a"" GROUP BY 1 ORDER BY 1), ""t2"" AS (SELECT ""driver_id"",""join_date"",LEFT(""join_date"", 7),COUNT(""driver_id"") OVER (ORDER BY LEFT(""join_date"", 7)) AS ""active_drivers"" FROM ""Drivers"" ORDER BY ""join_date""), ""t3"" AS (SELECT EXTRACT(MONTH FROM ""t2"".""join_date"") AS ""month"",""t2"".""active_drivers"" FROM ""t2"" WHERE EXTRACT(YEAR FROM ""t2"".""join_date"")=2020) SELECT ""CTE"".""month"",COALESCE(MAX(""t3"".""active_drivers"") OVER (ORDER BY ""CTE"".""month""), 0) AS ""active_drivers"",COALESCE(""t1"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""CTE"" LEFT JOIN ""t1"" ON ""CTE"".""month""=""t1"".""month"") LEFT JOIN ""t3"" ON ""CTE"".""month""=""t3"".""month"" GROUP BY ""CTE"".""month"""
237,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
238,"WITH RECURSIVE ""full_year"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""full_year"" WHERE ""month""<12), ""cte1"" AS (SELECT ""driver_id"",""join_date"" FROM ""Drivers"" WHERE ""join_date""<'2021-01-01'), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""d1"".""join_date"") AS ""month"",""d2"".""driver_id"" FROM (""cte1"" AS ""d1"") JOIN ""cte1"" AS ""d2"" WHERE ""d1"".""join_date"">=""d2"".""join_date""), ""cte3"" AS (SELECT ""month"",COUNT(DISTINCT ""driver_id"") AS ""driver_id"" FROM ""cte2"" GROUP BY ""month"" ORDER BY ""month""), ""cte4"" AS (SELECT ""full_year"".""month"",MAX(""driver_id"") AS ""active_drivers"" FROM (""full_year"") JOIN ""cte3"" WHERE ""full_year"".""month"">=""cte3"".""month"" GROUP BY ""full_year"".""month""), ""cte5"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""a"" WHERE ""r"".""ride_id""=""a"".""ride_id"" AND ""requested_at"">='2020-01-01' AND ""requested_at""<'2021-01-01' GROUP BY EXTRACT(MONTH FROM ""requested_at"") ORDER BY ""month"") SELECT ""full_year"".""month"" AS ""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte4"" LEFT JOIN ""cte5"" ON ""cte4"".""month""=""cte5"".""month"") RIGHT JOIN ""full_year"" ON ""cte4"".""month""=""full_year"".""month"" ORDER BY ""month"""
239,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""v"" UNION SELECT ""v""+1 FROM ""seq"" WHERE ""v""<12), ""drive"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""Acc_ride"" AS (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT ""a"".""v"" AS ""month"",COUNT(DISTINCT ""b"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""c"".""ride_id"") AS ""accepted_rides"" FROM (""seq"" AS ""a"" LEFT JOIN ""drive"" AS ""b"" ON ""a"".""v"">=""b"".""month"") LEFT JOIN ""Acc_ride"" AS ""c"" ON ""a"".""v""=""c"".""month"" GROUP BY 1 ORDER BY 1"
240,"WITH RECURSIVE ""M"" AS (SELECT 1 AS ""MONTH"" UNION SELECT ""MONTH""+1 AS ""MONTH"" FROM ""M"" WHERE ""MONTH""<12), ""D"" AS (SELECT EXTRACT(YEAR FROM ""JOIN_DATE"") AS ""YEAR"",EXTRACT(MONTH FROM ""JOIN_DATE"") AS ""MONTH"",COUNT(""DRIVER_ID"") OVER (ORDER BY EXTRACT(YEAR FROM ""JOIN_DATE""),EXTRACT(MONTH FROM ""JOIN_DATE"")) AS ""CNT"" FROM ""DRIVERS"" AS ""D""), ""A"" AS (SELECT EXTRACT(MONTH FROM ""R"".""REQUESTED_AT"") AS ""MONTH"",COUNT(""AR"".""RIDE_ID"") AS ""CNT"" FROM (""RIDES"" AS ""R"") JOIN ""ACCEPTEDRIDES"" AS ""AR"" WHERE ""R"".""RIDE_ID""=""AR"".""RIDE_ID"" AND EXTRACT(YEAR FROM ""R"".""REQUESTED_AT"")=2020 GROUP BY EXTRACT(MONTH FROM ""R"".""REQUESTED_AT"")) SELECT DISTINCT ""M"".""MONTH"",COALESCE(""D"".""CNT"", MAX(""D"".""CNT"") OVER (ORDER BY ""M"".""MONTH""), 0) AS ""ACTIVE_DRIVERS"",COALESCE(""A"".""CNT"", 0) AS ""ACCEPTED_RIDES"" FROM (""M"" LEFT JOIN ""D"" ON ""M"".""MONTH""=""D"".""MONTH"" AND ""D"".""YEAR""=2020) LEFT JOIN ""A"" ON ""M"".""MONTH""=""A"".""MONTH"" ORDER BY 1"
241,"WITH RECURSIVE ""Seq"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Seq"" WHERE ""month""<12) SELECT ""Seq"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides_table"".""ride_id"") AS ""accepted_rides"" FROM (""Seq"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""Seq"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides_table"" ON ""Seq"".""month""=""rides_table"".""month"" GROUP BY ""Seq"".""month"" ORDER BY ""Seq"".""month"""
242,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""cte1"" AS (SELECT ""join_date"",COUNT(""driver_id"") OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM (SELECT DISTINCT * FROM ""drivers"" ORDER BY ""join_date"") AS ""temp""), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",""active_drivers"" FROM ""cte1"" WHERE ""join_date"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte3"" AS (SELECT ""a"".""month"",(CASE WHEN ""b"".""active_drivers"" IS NULL AND ""a"".""month""=1 THEN 0 WHEN ""b"".""active_drivers"" IS NULL AND ""a"".""month""!=1 THEN MAX(""b"".""active_drivers"") OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) ELSE ""b"".""active_drivers"" END) AS ""active_drivers"" FROM ""months"" AS ""a"" LEFT JOIN ""cte2"" AS ""b"" ON ""a"".""month""=""b"".""month""), ""cte4"" AS (SELECT ""a"".""ride_id"",""a"".""requested_at"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte5"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""cte4"" GROUP BY ""month""), ""cte6"" AS (SELECT ""a"".""month"",COALESCE(""b"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""months"" AS ""a"" LEFT JOIN ""cte5"" AS ""b"" ON ""a"".""month""=""b"".""month"") SELECT ""a"".""month"",MAX(""a"".""active_drivers"") AS ""active_drivers"",""b"".""accepted_rides"" FROM ""cte3"" AS ""a"" JOIN ""cte6"" AS ""b"" ON ""a"".""month""=""b"".""month"" GROUP BY ""a"".""month"""
243,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
244,"WITH RECURSIVE ""Month_CTE"" AS (SELECT 1 AS ""Month"" UNION ALL SELECT ""Month""+1 FROM ""Month_CTE"" WHERE ""Month""<12), ""Drivers_CTE"" AS (SELECT *,CASE WHEN EXTRACT(YEAR FROM ""join_date"")='2019' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""d_month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<'2021'), ""CTE_3"" AS (SELECT ""m"".""Month"",COUNT(""d"".""driver_id"") AS ""active_drivers"" FROM ""MONTH_CTE"" AS ""m"" LEFT JOIN ""Drivers_CTE"" AS ""d"" ON ""m"".""Month"">=""d"".""d_month"" GROUP BY ""m"".""Month""), ""CTE_4"" AS (SELECT ""t2"".""r_month"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM (SELECT *,EXTRACT(MONTH FROM ""t"".""requested_at"") AS ""r_month"" FROM (SELECT ""ar"".""ride_id"",""ar"".""driver_id"",""r"".""user_id"",""r"".""requested_at"" FROM ""AcceptedRides"" AS ""ar"" LEFT JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020') AS ""t"") AS ""t2"" GROUP BY ""t2"".""r_month"") SELECT ""CTE_3"".""Month"",""CTE_3"".""active_drivers"" AS ""active_drivers"",COALESCE(""CTE_4"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""CTE_3"" LEFT JOIN ""CTE_4"" ON ""CTE_3"".""Month""=""CTE_4"".""r_month"""
245,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""Months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month""=TO_CHAR(""r"".""requested_at"", '%c') AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY ""m"".""month"" ORDER BY 1"
246,"WITH ""months_2020"" AS (SELECT '2020-01-31' AS ""dt"" UNION SELECT '2020-02-29' AS ""dt"" UNION SELECT '2020-03-31' AS ""dt"" UNION SELECT '2020-04-30' AS ""dt"" UNION SELECT '2020-05-31' AS ""dt"" UNION SELECT '2020-06-30' AS ""dt"" UNION SELECT '2020-07-31' AS ""dt"" UNION SELECT '2020-08-31' AS ""dt"" UNION SELECT '2020-09-30' AS ""dt"" UNION SELECT '2020-10-31' AS ""dt"" UNION SELECT '2020-11-30' AS ""dt"" UNION SELECT '2020-12-31' AS ""dt""), ""drivers_2020"" AS (SELECT EXTRACT(MONTH FROM ""m"".""dt"") AS ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"" FROM (""months_2020"" AS ""m"") JOIN ""Drivers"" AS ""d"" WHERE ""d"".""join_date""<=""m"".""dt"" GROUP BY EXTRACT(MONTH FROM ""m"".""dt"")), ""rides_2020"" AS (SELECT EXTRACT(MONTH FROM ""m"".""dt"") AS ""month"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""months_2020"" AS ""m"") JOIN (""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"") WHERE EXTRACT(MONTH FROM ""r"".""requested_at"")=EXTRACT(MONTH FROM ""m"".""dt"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""m"".""dt"")) SELECT EXTRACT(MONTH FROM ""m"".""dt"") AS ""month"",COALESCE(""d"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months_2020"" AS ""m"" LEFT JOIN ""drivers_2020"" AS ""d"" ON EXTRACT(MONTH FROM ""m"".""dt"")=""d"".""month"") LEFT JOIN ""rides_2020"" AS ""r"" ON EXTRACT(MONTH FROM ""m"".""dt"")=""r"".""month"""
247,"WITH RECURSIVE ""month_2020"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_2020"" WHERE ""month""<12), ""driver"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31'), ""act_ride"" AS (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM (""month_2020"" AS ""m"" LEFT JOIN ""driver"" AS ""d"" ON ""m"".""month"">=""d"".""month"") LEFT JOIN ""act_ride"" AS ""a"" ON ""m"".""month""=""a"".""month"" GROUP BY ""m"".""month"""
248,"WITH RECURSIVE ""tmp"" AS (SELECT 1 AS ""month"",'2020-01-01' AS ""day"" UNION ALL SELECT ""month""+1 AS ""month"",""day"" + INTERVAL '1 MONTH' FROM ""tmp"" WHERE ""month""<12) SELECT ""month"",COUNT(""b"".""driver_id"") AS ""active_drivers"",COALESCE(""ride_cnt"", 0) AS ""accepted_rides"" FROM (""tmp"" AS ""a"" LEFT JOIN ""drivers"" AS ""b"" ON LEFT(""join_date"", 7)<=LEFT(""day"", 7)) LEFT JOIN (SELECT LEFT(""requested_at"", 7) AS ""mon"",COUNT(""ride_id"") AS ""ride_cnt"" FROM ""rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) AS ""c"" ON ""mon""=LEFT(""day"", 7) GROUP BY 1,3 ORDER BY 1"
249,"SELECT ""t1"".""month"",COUNT(DISTINCT ""t2"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""t3"".""ride_id"") AS ""accepted_rides"" FROM ((SELECT 1 AS ""month"" UNION SELECT 2 AS ""month"" UNION SELECT 3 AS ""month"" UNION SELECT 4 AS ""month"" UNION SELECT 5 AS ""month"" UNION SELECT 6 AS ""month"" UNION SELECT 7 AS ""month"" UNION SELECT 8 AS ""month"" UNION SELECT 9 AS ""month"" UNION SELECT 10 AS ""month"" UNION SELECT 11 AS ""month"" UNION SELECT 12 AS ""month"") AS ""t1"" LEFT JOIN (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""t2"" ON ""t2"".""month""<=""t1"".""month"") LEFT JOIN (SELECT ""ar"".""ride_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) AS ""t3"" ON ""t3"".""month""=""t1"".""month"" GROUP BY ""t1"".""month"" ORDER BY ""t1"".""month"""
250,"WITH RECURSIVE ""MONTH"" AS (SELECT 1 AS ""MONTH"" UNION SELECT 1+""MONTH"" FROM ""MONTH"" WHERE ""MONTH""<12), ""CTE1"" AS (SELECT ""MONTH"",COALESCE(COUNT(""DRIVER_ID""), 0) AS ""active_drivers"" FROM ""MONTH"" LEFT JOIN ""DRIVERS"" ON ((EXTRACT(YEAR FROM ""JOIN_DATE"")<2020) OR (EXTRACT(MONTH FROM ""JOIN_DATE"")<=""MONTH"")) AND (""JOIN_DATE""<'2021-01-01') GROUP BY ""MONTH""), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",COUNT(""A"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""A"" LEFT JOIN ""Rides"" AS ""R"" ON ""A"".""ride_id""=""R"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""R"".""requested_at"")) SELECT ""CTE1"".""month"",""active_drivers"",(CASE WHEN ""accepted_rides"" IS NULL THEN 0 ELSE ""accepted_rides"" END) AS ""accepted_rides"" FROM ""CTE1"" LEFT JOIN ""CTE2"" ON ""CTE1"".""month""=""CTE2"".""month"" ORDER BY 1"
251,"WITH RECURSIVE ""month_2020"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month_2020"" WHERE ""month""<12), ""cte"" AS (SELECT DISTINCT ""m"".""month"",COUNT(""temp"".""month"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""month_2020"" AS ""m"" LEFT JOIN (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31') AS ""temp"" ON ""m"".""month""=""temp"".""month""), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""c1"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""cte"" AS ""c1"" LEFT JOIN ""cte2"" AS ""c2"" ON ""c1"".""month""=""c2"".""month"" ORDER BY ""c1"".""month"""
252,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12), ""DriversWithMonths"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""AcceptedRidesWithMonth"" AS (SELECT ""A"".""ride_id"",EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""A"" JOIN ""Rides"" AS ""R"" ON ""A"".""ride_id""=""R"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020) SELECT ""M"".""month"",COUNT(DISTINCT ""D"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""A"".""ride_id"") AS ""accepted_rides"" FROM (""Months"" AS ""M"" LEFT JOIN ""DriversWithMonths"" AS ""D"" ON ""D"".""month""<=""M"".""month"") LEFT JOIN ""AcceptedRidesWithMonth"" AS ""A"" ON ""M"".""month""=""A"".""month"" GROUP BY ""M"".""month"""
253,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12), ""tbl"" AS (SELECT CAST(RIGHT(""year_month"", 2) AS INTEGER) AS ""month"",""active_drivers"" FROM (SELECT ""year_month"",SUM(""cnt"") OVER (ORDER BY ""year_month"") AS ""active_drivers"" FROM (SELECT EXTRACT(YEAR_MONTH FROM ""join_date"") AS ""year_month"",COUNT(1) AS ""cnt"" FROM ""Drivers"" GROUP BY ""year_month"") AS ""t"") AS ""tt"" WHERE ""tt"".""year_month"" BETWEEN '202001' AND '202012'), ""r"" AS (SELECT COUNT(""t1"".""ride_id"") AS ""accepted_rides"",EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""t1"" JOIN ""Rides"" AS ""t2"" ON ""t1"".""ride_id""=""t2"".""ride_id"" AND ""t2"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month"") SELECT ""seq"".""month"",COALESCE(MAX(""tbl"".""active_drivers"") OVER (ORDER BY ""seq"".""month""), 0) AS ""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""seq"" LEFT JOIN ""tbl"" ON ""seq"".""month""=""tbl"".""month"") LEFT JOIN ""r"" ON ""seq"".""month""=""r"".""month"""
254,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12) SELECT ""t1"".""month"",COUNT(DISTINCT ""t2"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""t3"".""ride_id"") AS ""accepted_rides"" FROM (""months"" AS ""t1"" LEFT JOIN (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""t2"" ON ""t2"".""month""<=""t1"".""month"") LEFT JOIN (SELECT ""ar"".""ride_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) AS ""t3"" ON ""t3"".""month""=""t1"".""month"" GROUP BY ""t1"".""month"" ORDER BY ""t1"".""month"""
255,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
256,"ERROR: mysql parse error: line 1 column 559 near "";&amp; YEAR(n.requested_at)= ""2020"" ) As accepted_rides from m GROUP By m.month ORDER BY m.month"" "
257,"WITH RECURSIVE ""months_in_year"" AS (SELECT 1 AS ""month_num"" UNION SELECT ""month_num""+1 FROM ""months_in_year"" WHERE ""month_num""<12) SELECT ""month_num"" AS ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month_num"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""month_num"",COALESCE(""active_drivers"", 0) AS ""active_drivers"" FROM ""months_in_year"" LEFT JOIN (SELECT ""monthly"",CASE WHEN ""monthly""=1 THEN ""active_drivers""+(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020) ELSE ""active_drivers"" END AS ""active_drivers"" FROM (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""monthly"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY ""monthly"") AS ""active_driver_subset"") AS ""active_drivers"" ON ""month_num""=""monthly"" ORDER BY ""month_num"") AS ""active_drivers_cascaded"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""monthly_rides"",COUNT(""AR"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""AR"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""monthly_rides"") AS ""accepted_rides_data"" ON ""month_num""=""monthly_rides"" ORDER BY ""month_num"""
258,"WITH ""temp1"" AS (SELECT EXTRACT(YEAR FROM ""a"".""join_date"") AS ""join_year"",EXTRACT(MONTH FROM ""a"".""join_date"") AS ""join_month"",COUNT(DISTINCT ""b"".""driver_id"") AS ""active_drivers"" FROM ""Drivers"" AS ""a"" LEFT JOIN ""Drivers"" AS ""b"" ON ""a"".""join_date"">=""b"".""join_date"" GROUP BY 1,2 ORDER BY 1,2), ""temp2"" AS (SELECT EXTRACT(MONTH FROM ""b"".""requested_at"") AS ""requested_month"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""b"".""requested_at"")=2020 GROUP BY 1 ORDER BY 1), ""temp3"" AS (SELECT 1 AS ""month"" UNION SELECT 2 AS ""month"" UNION SELECT 3 AS ""month"" UNION SELECT 4 AS ""month"" UNION SELECT 5 AS ""month"" UNION SELECT 6 AS ""month"" UNION SELECT 7 AS ""month"" UNION SELECT 8 AS ""month"" UNION SELECT 9 AS ""month"" UNION SELECT 10 AS ""month"" UNION SELECT 11 AS ""month"" UNION SELECT 12 AS ""month""), ""temp4"" AS (SELECT ""c"".""month"",MAX(""a"".""active_drivers"") AS ""active_drivers"" FROM ""temp3"" AS ""c"" LEFT JOIN ""temp1"" AS ""a"" ON ""c"".""month"">=""a"".""join_month"" AND ""a"".""join_year""=2020 GROUP BY 1 ORDER BY 1) SELECT ""c"".""month"",COALESCE(""c"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""b"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""temp4"" AS ""c"" LEFT JOIN ""temp2"" AS ""b"" ON ""c"".""month""=""b"".""requested_month"" ORDER BY 1"
259,"WITH RECURSIVE ""CTE"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""CTE"" WHERE ""month""<12), ""tab_drivers"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")=2020 THEN EXTRACT(MONTH FROM ""join_date"") END AS ""month"",""driver_id"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021), ""tab_driver"" AS (SELECT ""c"".""month"",""t"".""driver_id"" FROM ""CTE"" AS ""c"" LEFT JOIN ""tab_drivers"" AS ""t"" ON ""c"".""month""=""t"".""month""), ""drivers"" AS (SELECT DISTINCT ""month"",COUNT(""driver_id"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""tab_driver""), ""requested"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""d"".""month"",""d"".""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""drivers"" AS ""d"" LEFT JOIN ""requested"" AS ""r"" ON ""d"".""month""=""r"".""month"""
260,"WITH RECURSIVE ""table1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""table1"" WHERE ""month""<12) SELECT ""t"".""month"",COUNT(DISTINCT ""a"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""b"".""ride_id"") AS ""accepted_rides"" FROM (""table1"" AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""a"" ON ""a"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""b"" ON ""b"".""month""=""t"".""month"" GROUP BY 1"
261,"WITH RECURSIVE ""month_2020"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_2020"" WHERE ""month""<12), ""driver"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31'), ""act_ride"" AS (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" AND ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM (""month_2020"" AS ""m"" LEFT JOIN ""driver"" AS ""d"" ON ""m"".""month"">=""d"".""month"") LEFT JOIN ""act_ride"" AS ""a"" ON ""m"".""month""=""a"".""month"" GROUP BY ""m"".""month"""
262,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""m"",0 AS ""n"" UNION SELECT ""m""+1,""n"" FROM ""t1"" WHERE ""m""<12), ""t2"" AS (SELECT ""driver_id"",CASE WHEN ""join_date""<'2020-1-1' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""m"" FROM ""Drivers"" WHERE ""join_date""<'2021-1-1'), ""t3"" AS (SELECT ""ina"".""ride_id"",EXTRACT(MONTH FROM ""ina"".""requested_at"") AS ""m"" FROM (""Rides"" AS ""ina"") JOIN ""AcceptedRides"" AS ""inb"" WHERE ""ina"".""ride_id""=""inb"".""ride_id"" AND ""ina"".""requested_at"" BETWEEN '2020-1-1' AND '2020-12-31') SELECT ""t1"".""m"" AS ""month"",COUNT(DISTINCT ""t2"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""t3"".""ride_id"") AS ""accepted_rides"" FROM (""t1"" LEFT JOIN ""t2"" ON ""t1"".""m"">=""t2"".""m"") LEFT JOIN ""t3"" ON ""t1"".""m""=""t3"".""m"" GROUP BY ""t1"".""m"""
263,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""acceptedmonth"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""amonth"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""ar"" WHERE ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(YEAR FROM ""r"".""requested_at""),EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COALESCE(""a"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""acceptedmonth"" AS ""a"" ON ""m"".""month""=""a"".""amonth"" GROUP BY ""m"".""month"""
264,"WITH RECURSIVE ""tab"" AS (SELECT 1 AS ""month"" UNION SELECT 1+""month"" FROM ""tab"" WHERE ""month""<12), ""adrivers"" AS (SELECT ""driver_id"",""join_date"",0 AS ""join_month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020 UNION ALL SELECT ""driver_id"",""join_date"",EXTRACT(MONTH FROM ""join_date"") AS ""join_month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020), ""arides"" AS (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""req_month"" FROM ""rides"" AS ""a"" JOIN ""AcceptedRides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT ""a"".""month"",COUNT(DISTINCT ""b"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""c"".""ride_id"") AS ""accepted_rides"" FROM (""tab"" AS ""a"" LEFT JOIN ""adrivers"" AS ""b"" ON ""a"".""month"">=""b"".""join_month"") LEFT JOIN ""arides"" AS ""c"" ON ""a"".""month""=""c"".""req_month"" GROUP BY ""a"".""month"" ORDER BY ""a"".""month"""
265,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""Months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month""=TO_CHAR(""r"".""requested_at"", '%c') AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY ""m"".""month"" ORDER BY 1"
266,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""Months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month""=TO_CHAR(""r"".""requested_at"", '%c') AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY ""m"".""month"" ORDER BY 1"
267,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
268,"WITH RECURSIVE ""cte1"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte1"" WHERE ""month""<12), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""r"".""ride_id"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""cte3"" AS (SELECT COUNT(""c2"".""ride_id"") AS ""accepted_rides"",""c1"".""month"" FROM ""cte1"" AS ""c1"" LEFT JOIN ""cte2"" AS ""c2"" ON ""c1"".""month""=""c2"".""month"" GROUP BY 2), ""cte4"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",""driver_id"" FROM ""Drivers"" AS ""d"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""cte5"" AS (SELECT DISTINCT ""cte1"".""month"",COUNT(""driver_id"") OVER (ORDER BY ""cte1"".""month"") AS ""active_drivers"" FROM ""cte1"" LEFT JOIN ""cte4"" ON ""cte1"".""month""=""cte4"".""month"") SELECT ""cte3"".""month"",""cte5"".""active_drivers"",""cte3"".""accepted_rides"" FROM ""cte3"" JOIN ""cte5"" ON ""cte3"".""month""=""cte5"".""month"""
269,"WITH RECURSIVE ""CTE"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""CTE"" WHERE ""month""<12), ""tab_driver"" AS (SELECT ""month"",""driver_id"",""join_date"" FROM ""CTE"" LEFT JOIN ""Drivers"" AS ""d"" ON ((""CTE"".""month""=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""join_date"")=2020) OR (""CTE"".""month""=1 AND EXTRACT(YEAR FROM ""d"".""join_date"")<2020)) AND EXTRACT(YEAR FROM ""d"".""join_date"")<2021), ""drivers"" AS (SELECT DISTINCT ""month"",COUNT(""driver_id"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""tab_driver""), ""requested"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""d"".""month"",""d"".""active_drivers"",COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""drivers"" AS ""d"" LEFT JOIN ""requested"" AS ""r"" ON ""d"".""month""=""r"".""month"""
270,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
271,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
272,"WITH ""Month_Table"" AS (SELECT 1 AS ""Month"" UNION SELECT 2 AS ""Month"" UNION SELECT 3 AS ""Month"" UNION SELECT 4 AS ""Month"" UNION SELECT 5 AS ""Month"" UNION SELECT 6 AS ""Month"" UNION SELECT 7 AS ""Month"" UNION SELECT 8 AS ""Month"" UNION SELECT 9 AS ""Month"" UNION SELECT 10 AS ""Month"" UNION SELECT 11 AS ""Month"" UNION SELECT 12 AS ""Month""), ""Driver_Table"" AS (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""Month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021), ""AcceptedRides_Table"" AS (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""Month"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) SELECT ""m"".""Month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ac"".""ride_id"") AS ""accepted_rides"" FROM (""Month_Table"" AS ""m"" LEFT JOIN ""Driver_Table"" AS ""d"" ON ""m"".""Month"">=""d"".""Month"") LEFT JOIN ""AcceptedRides_Table"" AS ""ac"" ON ""m"".""Month""=""ac"".""Month"" GROUP BY ""m"".""Month"" ORDER BY ""m"".""Month"""
273,"WITH RECURSIVE ""AllMonths"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""AllMonths"" WHERE ""month""<12), ""DriversActiveFROM"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ActiveDriversDetails"" AS (SELECT ""AM"".""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""DriversActiveFROM"" AS ""DA"" RIGHT JOIN ""AllMonths"" AS ""AM"" ON ""AM"".""month""=""DA"".""month"" GROUP BY ""AM"".""month""), ""ActiveDriversSummary"" AS (SELECT ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""ActiveDriversDetails""), ""AcceptedRidesDetails"" AS (SELECT ""driver_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""R"".""ride_id""=""AR"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""AcceptedRidesSummary"" AS (SELECT ""month"",COUNT(""driver_id"") AS ""accepted_rides"" FROM ""AcceptedRidesDetails"" GROUP BY ""month"") SELECT ""AM"".""month"",COALESCE(""ADS"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""ARS"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""AllMonths"" AS ""AM"" LEFT JOIN ""ActiveDriversSummary"" AS ""ADS"" ON ""ADS"".""month""=""AM"".""month"") LEFT JOIN ""AcceptedRidesSummary"" AS ""ARS"" ON ""ARS"".""month""=""AM"".""month"""
274,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""all_months"" WHERE ""month""<12), ""monthly_joined_drivers"" AS (SELECT (CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""join_month"",COUNT(""driver_id"") AS ""joined_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY ""join_month""), ""monthly_AcceptedRides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""ride_month"",COUNT(""ar"".""ride_id"") AS ""AcceptedRides_month"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""ride_month"") SELECT ""month"",""active_drivers"",COALESCE(""AcceptedRides_month"", 0) AS ""accepted_rides"" FROM (SELECT ""am"".""month"",SUM(COALESCE(""joined_drivers"", 0)) AS ""active_drivers"" FROM ""all_months"" AS ""am"" LEFT JOIN ""monthly_joined_drivers"" AS ""mjd"" ON ""am"".""month"">=""mjd"".""join_month"" GROUP BY ""am"".""month"") AS ""arm_all"" LEFT JOIN ""monthly_AcceptedRides"" AS ""mar"" ON ""arm_all"".""month""=""mar"".""ride_month"""
275,"WITH RECURSIVE ""cte1"" (""day"") AS (SELECT STR_TO_DATE('2020-01-31', '%Y-%m-%d') UNION ALL SELECT LAST_DAY(""day"" + INTERVAL '1 MONTH') FROM ""cte1"" WHERE ""day""<'2020-12-1'), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""day"") AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""cte1"" LEFT JOIN ""drivers"" ON ""join_date""<=""day"" GROUP BY ""month""), ""cte3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" NATURAL JOIN ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""cte2"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""cte2"" LEFT JOIN ""cte3"" ON ""cte2"".""month""=""cte3"".""month"""
276,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""driver"" AS (SELECT CAST(SUBSTR(""d2"".""join_month"", 6, 2) AS INTEGER) AS ""month"",SUM(""d1"".""driver_count"") AS ""active_drivers"" FROM (SELECT TO_CHAR(""join_date"", 'YYYY-%m') AS ""join_month"",COUNT(1) AS ""driver_count"" FROM ""Drivers"" GROUP BY TO_CHAR(""join_date"", 'YYYY-%m')) AS ""d1"", (SELECT TO_CHAR(""join_date"", 'YYYY-%m') AS ""join_month"",COUNT(1) AS ""driver_count"" FROM ""Drivers"" GROUP BY TO_CHAR(""join_date"", 'YYYY-%m')) AS ""d2"" WHERE ""d1"".""join_month""<=""d2"".""join_month"" AND ""d2"".""join_month"" BETWEEN '2020-01' AND '2020-12' GROUP BY ""d2"".""join_month"" ORDER BY ""d2"".""join_month""), ""ride"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY TO_CHAR(""requested_at"", 'YYYY-%m')) SELECT ""t"".*,COALESCE(""r"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""m"".""month"",COALESCE(""d"".""active_drivers"", 0) AS ""active_drivers"" FROM ""months"" AS ""m"" LEFT JOIN ""driver"" AS ""d"" ON ""d"".""month""<=""m"".""month"" GROUP BY ""m"".""month"") AS ""t"" LEFT JOIN ""ride"" AS ""r"" ON ""t"".""month""=""r"".""month"" ORDER BY ""t"".""month"""
277,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
278,"WITH ""ride_accepted"" AS (SELECT EXTRACT(MONTH FROM ""AGG"".""requested_at"") AS ""fy_month"",COUNT(""agg"".""ride_id"") AS ""accepted_rides"" FROM (SELECT ""ar"".""ride_id"",""ar"".""driver_id"",""ar"".""ride_distance"",""ar"".""ride_duration"",""r"".""requested_at"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""AR"".""ride_id""=""R"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) AS ""AGG"" GROUP BY EXTRACT(MONTH FROM ""AGG"".""requested_at"")), ""months_table"" AS ((SELECT 1 AS ""fy_month"") UNION (SELECT 2 AS ""fy_month"") UNION (SELECT 3 AS ""fy_month"") UNION (SELECT 4 AS ""fy_month"") UNION (SELECT 5 AS ""fy_month"") UNION (SELECT 6 AS ""fy_month"") UNION (SELECT 7 AS ""fy_month"") UNION (SELECT 8 AS ""fy_month"") UNION (SELECT 9 AS ""fy_month"") UNION (SELECT 10 AS ""fy_month"") UNION (SELECT 11 AS ""fy_month"") UNION (SELECT 12 AS ""fy_month"")), ""drivers_active"" AS (SELECT ""agg"".""fy_month"",COUNT(""agg"".""driver_id"") AS ""active_drivers"" FROM (SELECT CASE WHEN EXTRACT(YEAR FROM ""d"".""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""d"".""join_date"") END AS ""fy_month"",""driver_id"" FROM ""drivers"" AS ""d"" WHERE EXTRACT(YEAR FROM ""d"".""join_date"")<=2020) AS ""AGG"" GROUP BY ""agg"".""fy_month"") SELECT ""agg"".* FROM (SELECT ""mt"".""fy_month"" AS ""month"",COALESCE(SUM(""da"".""active_drivers""), 0) AS ""active_drivers"",COALESCE(""ra"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months_table"" AS ""MT"" LEFT JOIN ""drivers_active"" AS ""da"" ON ""mt"".""fy_month"">=""da"".""fy_month"") LEFT JOIN ""ride_accepted"" AS ""ra"" ON ""ra"".""fy_month""=""mt"".""fy_month"" GROUP BY ""mt"".""fy_month"",COALESCE(""ra"".""accepted_rides"", 0)) AS ""AGG"" ORDER BY 'month'"
279,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""r_month"" UNION ALL SELECT ""r_month""+1 AS ""r_month"" FROM ""Months"" WHERE ""r_month""<12), ""RideSummary"" AS (SELECT ""Rides"".""ride_id"",EXTRACT(MONTH FROM ""Rides"".""requested_at"") AS ""ride_month"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""Rides"".""requested_at"")=2020) SELECT ""Months"".""r_month"" AS ""month"",COUNT(DISTINCT ""Drivers"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""RideSummary"".""ride_id"") AS ""accepted_rides"" FROM (""Months"" LEFT JOIN ""Drivers"" ON TO_CHAR(""Drivers"".""join_date"", 'YYYY%m')<=CONCAT('2020', LPAD(CAST(""Months"".""r_month"" AS CHAR), 2, '0'))) LEFT JOIN ""RideSummary"" ON ""RideSummary"".""ride_month""=""Months"".""r_month"" GROUP BY ""Months"".""r_month"""
280,"WITH RECURSIVE ""tmp"" AS (SELECT ""mon"",SUM(""id_cnt"") OVER (ORDER BY ""mon"") AS ""cum_id_cnt"" FROM (SELECT CAST(TO_CHAR(""join_date"", 'YYYY-%m-01') AS DATE) AS ""mon"",COUNT(""driver_id"") AS ""id_cnt"" FROM ""drivers"" GROUP BY 1) AS ""t""), ""tmp2"" AS (SELECT CAST(TO_CHAR(""requested_at"", 'YYYY-%m-01') AS DATE) AS ""mon"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""tmp3"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""tmp3"" WHERE ""month""<12) SELECT ""f"".""month"",COALESCE(""t"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""tmp3"" AS ""f"" LEFT JOIN (SELECT ""a"".""month"",MAX(""cum_id_cnt"") AS ""active_drivers"" FROM (""tmp3"" AS ""a"") JOIN (SELECT * FROM ""tmp"" WHERE EXTRACT(YEAR FROM ""mon"")=2020) AS ""b"" WHERE ""a"".""month"">=EXTRACT(MONTH FROM ""b"".""mon"") GROUP BY 1) AS ""t"" ON ""f"".""month""=""t"".""month"") LEFT JOIN ""tmp2"" AS ""c"" ON ""t"".""month""=EXTRACT(MONTH FROM ""c"".""mon"") ORDER BY 1"
281,"WITH RECURSIVE ""CTE1"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""MONTH"",""A"".""RIDE_ID"" FROM ""RIDES"" AS ""R"" JOIN ""ACCEPTEDRIDES"" AS ""A"" ON ""R"".""RIDE_ID""=""A"".""RIDE_ID"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020), ""CTE3"" AS (SELECT ""CTE1"".""MONTH"",COUNT(""RIDE_ID"") AS ""ACCEPTED_RIDES"" FROM ""CTE1"" LEFT JOIN ""CTE2"" USING (""MONTH"") GROUP BY ""CTE1"".""MONTH""), ""CTE4"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""JOIN_DATE"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""JOIN_DATE"") END AS ""MONTH"",""DRIVER_ID"" FROM ""DRIVERS"" WHERE EXTRACT(YEAR FROM ""JOIN_DATE"")<=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""MONTH"",COUNT(""DRIVER_ID"") OVER (ORDER BY ""CTE1"".""MONTH"") AS ""ACTIVE_DRIVERS"" FROM ""CTE1"" LEFT JOIN ""CTE4"" USING (""MONTH"")) SELECT ""CTE3"".""MONTH"",""ACTIVE_DRIVERS"",""ACCEPTED_RIDES"" FROM ""CTE3"" JOIN ""CTE5"" USING (""MONTH"")"
282,"WITH ""tbM"" AS (SELECT 1 AS ""month"" UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12), ""tbR"" AS (SELECT ""tbM"".""month"",COUNT(""drivers"".""driver_id"") AS ""active_drivers"" FROM ""drivers"" RIGHT JOIN ""tbM"" ON (EXTRACT(YEAR FROM ""drivers"".""join_date"")<2020 OR (EXTRACT(YEAR FROM ""drivers"".""join_date"")=2020 AND EXTRACT(MONTH FROM ""drivers"".""join_date"")<=""tbM"".""month"")) GROUP BY ""tbM"".""month"") SELECT ""tbR"".""month"",""tbR"".""active_drivers"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM (""tbR"" LEFT JOIN ""rides"" AS ""r"" ON EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""r"".""requested_at"")=""tbR"".""month"") LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""tbR"".""month"""
283,"WITH RECURSIVE ""month_2020"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_2020"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM (""month_2020"" AS ""m"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""m"".""month"") LEFT JOIN (SELECT ""r"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""accepts"" ON ""m"".""month""=""accepts"".""month"" GROUP BY ""m"".""month"""
284,"WITH RECURSIVE ""idx"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""idx"" WHERE ""month""<12) SELECT ""idx"".""month"",COUNT(DISTINCT (""drivers"".""driver_id"")) AS ""active_drivers"",COUNT(DISTINCT (""rides"".""ride_id"")) AS ""accepted_rides"" FROM (""idx"" LEFT JOIN ""drivers"" ON EXTRACT(YEAR FROM ""drivers"".""join_date"")<=2020 AND (""idx"".""month"">=EXTRACT(MONTH FROM ""drivers"".""join_date"") OR EXTRACT(YEAR FROM ""drivers"".""join_date"")<=2019)) LEFT JOIN ""Rides"" ON ""rides"".""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""rides"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""rides"".""requested_at"")=""idx"".""month"" GROUP BY ""idx"".""month"""
285,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE1"" WHERE 1+""month""<=12), ""CTE2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""CTE3"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE2"".""driver_id"") OVER (ORDER BY ""CTE1"".""month"") AS ""active_drivers"" FROM ""CTE1"" LEFT JOIN ""CTE2"" ON ""CTE1"".""month""=""CTE2"".""month""), ""CTE4"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""A"".""driver_id"" FROM (""Rides"" AS ""R"") JOIN ""AcceptedRIdes"" AS ""A"" WHERE ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE4"".""driver_id"") OVER (PARTITION BY ""CTE1"".""month"") AS ""accepted_rides"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month"") SELECT ""CTE5"".""month"",""CTE3"".""active_drivers"",""CTE5"".""accepted_rides"" FROM (""CTE5"") JOIN ""CTE3"" WHERE ""CTE5"".""month""=""CTE3"".""month"""
286,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12), ""t2"" AS (SELECT DISTINCT ""month"",COUNT(""driver_id"") OVER (PARTITION BY ""month"") AS ""active_drivers"" FROM ""t"" LEFT JOIN (SELECT ""driver_id"",""join_date"",CASE WHEN EXTRACT(YEAR FROM ""Drivers"".""join_date"")=2019 THEN '2020-01-01' ELSE ""join_date"" END AS ""join_date_new"" FROM ""Drivers"") AS ""Drivers"" ON ""t"".""month""=EXTRACT(MONTH FROM ""Drivers"".""join_date_new"") AND EXTRACT(YEAR FROM ""Drivers"".""join_date_new"")=2020), ""t3"" AS (SELECT DISTINCT ""month"",COUNT(""ride_id"") OVER (PARTITION BY ""t"".""month"") AS ""accepted_rides"" FROM ""t"" LEFT JOIN ""Rides"" ON ""t"".""month""=EXTRACT(MONTH FROM ""Rides"".""requested_at"") AND EXTRACT(YEAR FROM ""Rides"".""requested_at"")=2020 AND ""Rides"".""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"")) SELECT DISTINCT ""t2"".""month"",SUM(""active_drivers"") OVER (ORDER BY ""t2"".""month"") AS ""active_drivers"",""accepted_rides"" FROM ""t2"" LEFT JOIN ""t3"" ON ""t2"".""month""=""t3"".""month"""
287,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month""=TO_CHAR(""r"".""requested_at"", '%c') AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""acceptedrides"") GROUP BY 1 ORDER BY 1"
288,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
289,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""t"" WHERE ""month""<12) SELECT ""t"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""t"" LEFT JOIN ""Drivers"" AS ""d"" ON (""t"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""Rides"" AS ""r"" ON ""t"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
290,"WITH ""active_dr"" AS (SELECT LEFT(""join_date"", 7) AS ""join_month"",EXTRACT(YEAR FROM ""join_date"") AS ""join_year"",EXTRACT(MONTH FROM ""join_date"") AS ""join_month_num"",COUNT(1) AS ""num_drivers"" FROM ""drivers"" WHERE ""join_date""<'2021-01-01' GROUP BY LEFT(""join_date"", 7)), ""active_cts"" AS (SELECT *,SUM(""num_drivers"") OVER (ORDER BY ""join_month"") AS ""total_active_drivers"" FROM ""active_dr""), ""nums"" AS (SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""information_schema"".""columns""), ""months"" AS (SELECT ""num"" FROM ""nums"" WHERE ""num""<=12), ""active_month_join"" AS (SELECT ""mn"".""num"",MAX(""ac"".""join_month_num"") AS ""max_join_month_num"" FROM ""months"" AS ""mn"" LEFT JOIN ""active_cts"" AS ""ac"" ON ""mn"".""num"">=""ac"".""join_month_num"" AND ""ac"".""join_year""=2020 GROUP BY ""mn"".""num""), ""accept_rds"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month_num"",COUNT(1) AS ""total_rides"" FROM ""rides"" AS ""r"" JOIN (SELECT ""ride_id"" FROM ""acceptedrides"" GROUP BY ""ride_id"") AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE ""r"".""requested_at"">='2020-01-01' AND ""r"".""requested_at""<'2021-01-01' GROUP BY EXTRACT(MONTH FROM ""requested_at"")) SELECT ""mn"".""num"" AS ""month"",COALESCE(""ac"".""total_active_drivers"", 0) AS ""active_drivers"",COALESCE(""ar"".""total_rides"", 0) AS ""accepted_rides"" FROM ((""months"" AS ""mn"" LEFT JOIN ""accept_rds"" AS ""ar"" ON ""mn"".""num""=""ar"".""month_num"") LEFT JOIN ""active_month_join"" AS ""amj"" ON ""mn"".""num""=""amj"".""num"") LEFT JOIN ""active_cts"" AS ""ac"" ON ""amj"".""max_join_month_num""=""ac"".""join_month_num"" AND ""ac"".""join_year""=2020"
291,"WITH RECURSIVE ""Month_Table"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""Month_Table"" WHERE ""month""<12), ""available_driver"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""rides_accepted"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",COUNT(""A"".""ride_id"") AS ""ride_total"" FROM ""Rides"" AS ""R"" JOIN ""AcceptedRides"" AS ""A"" ON ""R"".""ride_id""=""A"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""M"".""month"",COUNT(""A"".""driver_id"") OVER (ORDER BY ""M"".""month"") AS ""active_drivers"",COALESCE(""R"".""ride_total"", 0) AS ""accepted_rides"" FROM (""Month_Table"" AS ""M"" LEFT JOIN ""available_driver"" AS ""A"" ON ""M"".""month""=""A"".""month"") LEFT JOIN ""rides_accepted"" AS ""R"" ON ""M"".""month""=""R"".""month"" ORDER BY ""M"".""month"""
292,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
293,"WITH ""rec"" AS (WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12) SELECT * FROM ""seq""), ""d_agg"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")>2020 THEN NULL ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month_2020"",COUNT(DISTINCT ""driver_id"") AS ""ct"" FROM ""drivers"" GROUP BY 1), ""ac_d"" AS (SELECT ""r"".""month"",SUM(COALESCE(""d"".""ct"", 0)) OVER (ORDER BY ""r"".""month"") AS ""ac_drivers"" FROM ""rec"" AS ""r"" LEFT JOIN ""d_agg"" AS ""d"" ON ""r"".""month""=""d"".""join_month_2020""), ""ac_r"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""ac_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""ac_d"".""month"" AS ""month"",""ac_d"".""ac_drivers"" AS ""active_drivers"",COALESCE(""ac_r"".""ac_rides"", 0) AS ""accepted_rides"" FROM ""ac_d"" LEFT JOIN ""ac_r"" ON ""ac_d"".""month""=""ac_r"".""month"""
294,"WITH RECURSIVE ""temp1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""temp1"" WHERE ""month""<12), ""temp2"" AS (SELECT *,CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")>2020 THEN 0 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers""), ""temp3"" AS (SELECT *,CASE WHEN EXTRACT(YEAR FROM ""requested_at"")!=2020 THEN 0 ELSE EXTRACT(MONTH FROM ""requested_at"") END AS ""month"" FROM ""Rides""), ""temp4"" AS (SELECT DISTINCT ""temp1"".""month"",COUNT(""driver_id"") OVER (ORDER BY ""temp1"".""month"") AS ""active_drivers"" FROM ""temp1"" LEFT JOIN ""temp2"" ON ""temp1"".""month""=""temp2"".""month""), ""temp5"" AS (SELECT ""temp1"".""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""temp1"" LEFT JOIN ""temp3"" ON ""temp1"".""month""=""temp3"".""month"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY ""temp1"".""month"") SELECT ""temp4"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""temp4"" LEFT JOIN ""temp5"" ON ""temp4"".""month""=""temp5"".""month"" ORDER BY ""temp4"".""month"""
295,"WITH RECURSIVE ""one_to_twelve"" (""n"") AS (SELECT 1 UNION ALL SELECT ""n""+1 FROM ""one_to_twelve"" WHERE ""n""<11), ""months"" AS (SELECT ""n"" AS ""month"",STR_TO_DATE(CONCAT('2020 ', ""n"", ' 1'), '%Y %m %d') AS ""start_date"",STR_TO_DATE(CONCAT('2020 ', ""n""+1, ' 1'), '%Y %m %d') - INTERVAL '1 DAY' AS ""end_date"" FROM ""one_to_twelve"" UNION ALL SELECT 12 AS ""month"",STR_TO_DATE('2020-12-01', '%Y-%m-%d') AS ""start_date"",STR_TO_DATE('2020-12-31', '%Y-%m-%d') AS ""end_date""), ""active_drivers"" AS (SELECT ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""months"" LEFT JOIN ""drivers"" ON ""drivers"".""join_date""<=""months"".""end_date"" GROUP BY 1), ""accepted_rides"" AS (SELECT ""month"",COUNT(""acceptedrides"".""ride_id"") AS ""accepted_rides"" FROM (""acceptedrides"" LEFT JOIN ""rides"" ON ""rides"".""ride_id""=""acceptedrides"".""ride_id"") RIGHT JOIN ""months"" ON (""months"".""start_date""<=""rides"".""requested_at"" AND ""rides"".""requested_at""<=""months"".""end_date"") GROUP BY 1) SELECT ""ad"".""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""active_drivers"" AS ""ad"" JOIN ""accepted_rides"" AS ""ar"" ON ""ad"".""month""=""ar"".""month"" ORDER BY ""month"""
296,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
297,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""Months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month""=TO_CHAR(""r"".""requested_at"", '%c') AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY ""m"".""month"" ORDER BY 1"
298,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
299,"WITH ""cte"" AS (SELECT 1 AS ""month"" UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) SELECT ""cte"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""cte"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")='2019' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31') AS ""d"" ON ""cte"".""month"">=""d"".""month"") LEFT JOIN (SELECT ""ride_id"",""requested_at"" FROM ""Rides"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""r"" ON ""cte"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"")) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY 1"
300,"WITH RECURSIVE ""CTE1"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""REQUESTED_AT"") AS ""MONTH"",""A"".""RIDE_ID"" FROM ""RIDES"" AS ""R"" JOIN ""ACCEPTEDRIDES"" AS ""A"" ON ""R"".""RIDE_ID""=""A"".""RIDE_ID"" WHERE EXTRACT(YEAR FROM ""REQUESTED_AT"")=2020), ""CTE3"" AS (SELECT ""CTE1"".""MONTH"",COUNT(""RIDE_ID"") AS ""ACCEPTED_RIDES"" FROM ""CTE1"" LEFT JOIN ""CTE2"" USING (""MONTH"") GROUP BY ""CTE1"".""MONTH""), ""CTE4"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""JOIN_DATE"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""JOIN_DATE"") END AS ""MONTH"",""DRIVER_ID"" FROM ""DRIVERS"" WHERE EXTRACT(YEAR FROM ""JOIN_DATE"")<=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""MONTH"",COUNT(""DRIVER_ID"") OVER (ORDER BY ""CTE1"".""MONTH"") AS ""ACTIVE_DRIVERS"" FROM ""CTE1"" LEFT JOIN ""CTE4"" USING (""MONTH"")) SELECT ""CTE3"".""MONTH"",""ACTIVE_DRIVERS"",""ACCEPTED_RIDES"" FROM ""CTE3"" JOIN ""CTE5"" USING (""MONTH"")"
301,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""cte"" WHERE ""month""<12), ""cte2"" AS (SELECT COALESCE(COUNT(""a"".""ride_id""), 0) AS ""accepted_rides"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")), ""cte3"" AS (SELECT ""cte"".""month"",COALESCE(""ncnt"", MAX(""ncnt"") OVER (ORDER BY ""month"")) AS ""active_drivers"" FROM (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",MAX(""cnt"") AS ""ncnt"" FROM (SELECT ""join_date"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""cnt"" FROM ""drivers"" ORDER BY ""join_date"") AS ""a"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY EXTRACT(MONTH FROM ""join_date"")) AS ""b"" RIGHT JOIN ""cte"" ON ""b"".""month""=""cte"".""month"") SELECT ""cte3"".""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""month""=""cte2"".""month"""
302,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""t1"".""month"",""t1"".""active_drivers"",""t2"".""accepted_rides"" FROM (SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"" FROM ""months"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON EXTRACT(YEAR FROM ""d"".""join_date"")<2020 OR (EXTRACT(YEAR FROM ""d"".""join_date"")=2020 AND EXTRACT(MONTH FROM ""d"".""join_date"")<=""m"".""month"") GROUP BY ""m"".""month"") AS ""t1"" JOIN (SELECT ""m"".""month"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"") RIGHT JOIN ""months"" AS ""m"" ON EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""r"".""requested_at"")=""m"".""month"" GROUP BY ""m"".""month"") AS ""t2"" ON ""t1"".""month""=""t2"".""month"""
303,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
304,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""N_row"" UNION ALL SELECT ""N_row""+1 FROM ""seq"" WHERE ""N_row""<12), ""new_drivers"" AS (SELECT TO_CHAR(""join_date"", '%m') AS ""join_month"",COUNT(DISTINCT ""driver_id"") AS ""N_drivers"" FROM ""Drivers"" AS ""d"" WHERE TO_CHAR(""join_date"", 'YYYY')='2020' GROUP BY 1), ""ride_count"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""ride_month"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" LEFT JOIN ""Rides"" AS ""r"" USING (""ride_id"") WHERE TO_CHAR(""requested_at"", 'YYYY')='2020' GROUP BY 1) SELECT ""N_row"" AS ""month"",SUM(COALESCE(""N_drivers"", 0)) OVER (ORDER BY ""N_row"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)+""N_before"" AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ((""seq"" LEFT JOIN ""new_drivers"" AS ""nd"" ON ""seq"".""N_row""=CAST(""nd"".""join_month"" AS INTEGER)) LEFT JOIN ""ride_count"" AS ""rc"" ON ""seq"".""N_row""=CAST(""rc"".""ride_month"" AS INTEGER)) JOIN (SELECT COUNT(DISTINCT ""driver_id"") AS ""N_before"" FROM ""Drivers"" WHERE TO_CHAR(""join_date"", 'YYYY')<'2020') AS ""history"" ORDER BY 1"
305,"SELECT ""t1"".""month"",""t1"".""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT ""m"".""month"",COUNT(""d"".""driver_id"") AS ""active_drivers"" FROM ((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON ""d"".""join_date""<=LAST_DAY(CONCAT('2020-', ""m"".""month"", '-1')) GROUP BY ""m"".""month"") AS ""t1"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) AS ""t2"" ON ""t1"".""month""=""t2"".""month"" ORDER BY ""t1"".""month"""
306,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
307,"WITH RECURSIVE ""all_months0"" AS (SELECT '2020-02-01' AS ""the_month"" UNION ALL SELECT ""the_month"" + INTERVAL '1 MONTH' AS ""the_month"" FROM ""all_months0"" WHERE ""the_month""<'2020-12-31'), ""all_months"" AS (SELECT ""the_month"" - INTERVAL '1 DAY' AS ""the_month"" FROM ""all_months0""), ""drivers_count"" AS (SELECT EXTRACT(MONTH FROM ""a"".""the_month"") AS ""the_month"",COUNT(""driver_id"") AS ""driver_count"" FROM ""all_months"" AS ""a"" LEFT JOIN ""drivers"" AS ""d"" ON ""d"".""join_date""<=""a"".""the_month"" GROUP BY 1), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""the_month"",COUNT(""a"".""ride_id"") AS ""ride_count"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT ""d"".""the_month"" AS ""month"",COALESCE(""d"".""driver_count"", 0) AS ""active_drivers"",COALESCE(""a"".""ride_count"", 0) AS ""accepted_rides"" FROM ""drivers_count"" AS ""d"" LEFT JOIN ""accepted_rides"" AS ""a"" ON ""d"".""the_month""=""a"".""the_month"""
308,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""Months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month""=TO_CHAR(""r"".""requested_at"", '%c') AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY ""m"".""month"" ORDER BY 1"
309,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""m"".""month"" AS ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""months"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" GROUP BY 1 ORDER BY 1"
310,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
311,"WITH RECURSIVE ""dat"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""dat"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT (""d"".""driver_id"")) AS ""active_drivers"",COUNT(DISTINCT (CASE WHEN ""ride_distance"" IS NOT NULL THEN ""r"".""ride_id"" ELSE NULL END)) AS ""accepted_rides"" FROM ((""dat"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
312,"ERROR: mysql parse error: line 1 column 70 near ""), d_stat as ( Select m.month, count(driver_id) as active_drivers from m left join Drivers d on (date_add(concat('2020-', m.month, '-01'), INTERVAL 1 MONTH) > d.join_date) group by month ), a_rides2020 as ( select month(requested_at) as month, count(*) as accepted_rides from AcceptedRides a join Rides USING(ride_id) where year(requested_at) = '2020' group by month ) select month, active_drivers, count(ride_id) as accepted_rides from d_stat d left join (AcceptedRides join Rides USING(ride_id)) ON (d.month = Month(requested_at) and Year(requested_at) = '2020') group by month "" "
313,"WITH RECURSIVE ""month_list"" (""month"") AS (SELECT 1 UNION SELECT ""month""+1 FROM ""month_list"" WHERE ""month""<12), ""accept_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_distance"") AS ""accepted_rides"" FROM ""Rides"" LEFT JOIN ""AcceptedRides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""month_list"".""month"" AS ""month"",COUNT(""driver_id"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""month_list"" LEFT JOIN ""accept_rides"" ON ""month_list"".""month""=""accept_rides"".""month"") LEFT JOIN ""Drivers"" ON (EXTRACT(YEAR FROM ""join_date"")=2020 AND EXTRACT(MONTH FROM ""join_date"")<=""month_list"".""month"") OR (EXTRACT(YEAR FROM ""join_date"")<2020) GROUP BY ""month_list"".""month"" ORDER BY ""month_list"".""month"""
314,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT (CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"",""driver_id"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",""a"".""ride_id"" AS ""accepted_rides"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) SELECT ""m"".""month"",COUNT(DISTINCT ""t1"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""accepted_rides"") AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""t1"".""month""<=""m"".""month"") LEFT JOIN ""t2"" ON ""t2"".""month""=""m"".""month"" GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
315,"WITH RECURSIVE ""r_month"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""r_month"" WHERE ""month""<12), ""available_drivers"" AS (SELECT ""b"".""month"",COALESCE(SUM(""a"".""available_drivers"") OVER (ORDER BY ""b"".""month""), 0) AS ""active_drivers"" FROM (SELECT CASE WHEN ""join_date""<'2020-01-01' THEN 1 ELSE CAST(TO_CHAR(""join_date"", '%m') AS INTEGER) END AS ""month"",COUNT(DISTINCT ""driver_id"") AS ""available_drivers"" FROM ""drivers"" WHERE ""join_date""<'2021-01-01' GROUP BY 1) AS ""a"" RIGHT JOIN ""r_month"" AS ""b"" USING (""month"")), ""accepted_rides"" AS (SELECT CAST(TO_CHAR(""r"".""requested_at"", '%m') AS INTEGER) AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ar"" USING (""ride_id"") WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1) SELECT ""ad"".*,COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""available_drivers"" AS ""ad"" LEFT JOIN ""accepted_rides"" AS ""ar"" USING (""month"")"
316,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
317,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" AS ""month"" FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT ""month"",COUNT(DISTINCT ""driver_id"") AS ""nbr_drivers"" FROM (SELECT *,CASE WHEN ""join_date""<='2019-12-31' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31') AS ""a"" GROUP BY ""month""), ""t3"" AS (SELECT ""t1"".""month"",SUM(COALESCE(""t2"".""nbr_drivers"", 0)) OVER (ORDER BY ""t1"".""month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""month""=""t2"".""month""), ""t4"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY EXTRACT(MONTH FROM ""r"".""requested_at"")) SELECT ""t3"".""month"",""t3"".""active_drivers"",COALESCE(""t4"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""t3"" LEFT JOIN ""t4"" ON ""t3"".""month""=""t4"".""month"""
318,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
319,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""rides_updated"" AS (SELECT ""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 ORDER BY 2), ""rides_rideId"" AS (SELECT ""m"".""month"",COALESCE(""real_drive"".""ride_id"", 0) AS ""ride_id"" FROM ""months"" AS ""m"" LEFT JOIN (SELECT ""ride_id"",""month"" FROM ""rides_updated"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"")) AS ""real_drive"" ON ""m"".""month""=""real_drive"".""month""), ""accepted_rides"" AS (SELECT ""month"",CASE WHEN ""ride_id""=0 THEN 0 ELSE COUNT(1) END AS ""accepted_rides"" FROM ""rides_rideId"" GROUP BY ""month"" ORDER BY ""month""), ""drivers_updated"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 ORDER BY 2), ""drivers_counted"" AS (SELECT ""m"".""month"",COALESCE(""nd"".""number_driver"", 0) AS ""driver_number"" FROM ""months"" AS ""m"" LEFT JOIN (SELECT ""month"",COUNT(1) AS ""number_driver"" FROM ""drivers_updated"" GROUP BY ""month"") AS ""nd"" ON ""m"".""month""=""nd"".""month""), ""active_drive"" AS (SELECT ""month"",SUM(""driver_number"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""drivers_counted"") SELECT ""ad"".""month"",""ar"".""active_drivers"",""ad"".""accepted_rides"" FROM ""accepted_rides"" AS ""ad"" JOIN ""active_drive"" AS ""ar"" ON ""ad"".""month""=""ar"".""month"""
320,"WITH ""months"" AS (SELECT 1 AS ""month"" UNION SELECT 2 AS ""month"" UNION SELECT 3 AS ""month"" UNION SELECT 4 AS ""month"" UNION SELECT 5 AS ""month"" UNION SELECT 6 AS ""month"" UNION SELECT 7 AS ""month"" UNION SELECT 8 AS ""month"" UNION SELECT 9 AS ""month"" UNION SELECT 10 AS ""month"" UNION SELECT 11 AS ""month"" UNION SELECT 12 AS ""month""), ""drivers_joined"" AS (SELECT ""a"".""month"",COALESCE(COUNT(DISTINCT ""driver_id""), 0) AS ""n_drivers"" FROM ""months"" AS ""a"" LEFT JOIN (SELECT * FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""b"" ON ""a"".""month""=(CASE WHEN EXTRACT(YEAR FROM ""b"".""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""b"".""join_date"") END) GROUP BY 1) SELECT ""a"".""month"",SUM(""n_drivers"") OVER (ORDER BY ""a"".""month"") AS ""active_drivers"",COALESCE(""n_rides"", 0) AS ""accepted_rides"" FROM ""drivers_joined"" AS ""a"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""n_rides"" FROM ""AcceptedRides"" AS ""AR"" JOIN ""Rides"" AS ""R"" ON ""AR"".""ride_id""=""R"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) AS ""b"" ON ""a"".""month""=""b"".""month"""
321,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""cnt"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""foo"".*,COALESCE(""cte2"".""cnt"", 0) AS ""accepted_rides"" FROM (SELECT ""cte"".""month"",COUNT(""d"".""driver_id"") AS ""active_drivers"" FROM ""cte"" LEFT JOIN ""drivers"" AS ""d"" ON EXTRACT(YEAR FROM ""d"".""join_date"")=2020 AND EXTRACT(MONTH FROM ""d"".""join_date"")<=""cte"".""month"" OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020 GROUP BY 1) AS ""foo"" LEFT JOIN ""cte2"" ON ""foo"".""month""=""cte2"".""month"" ORDER BY ""foo"".""month"""
322,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
323,"WITH RECURSIVE ""t"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""t"" WHERE ""month""<12) SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
324,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
325,"WITH ""c1"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY 1), ""c2"" AS (WITH RECURSIVE ""se"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""se"" WHERE ""month""<12) SELECT * FROM ""se""), ""c3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",SUM(CASE WHEN ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") THEN 1 ELSE 0 END) AS ""accepted_rides"" FROM ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1), ""c4"" AS (SELECT ""c2"".""month"",COALESCE(""c1"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""c3"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""c2"" LEFT JOIN ""c1"" ON ""c2"".""month""=""c1"".""month"") LEFT JOIN ""c3"" ON ""c2"".""month""=""c3"".""month"") SELECT ""month"",SUM(""active_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"",""accepted_rides"" FROM ""c4"" ORDER BY 1"
326,"WITH RECURSIVE ""CTE1"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 1+""month"" FROM ""CTE1"" WHERE 1+""month""<=12), ""CTE2"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""CTE3"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE2"".""driver_id"") OVER (ORDER BY ""CTE1"".""month"") AS ""active_drivers"" FROM ""CTE1"" LEFT JOIN ""CTE2"" ON ""CTE1"".""month""=""CTE2"".""month""), ""CTE4"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""month"",""A"".""driver_id"" FROM (""Rides"" AS ""R"") JOIN ""AcceptedRIdes"" AS ""A"" WHERE ""R"".""ride_id""=""A"".""ride_id"" AND EXTRACT(YEAR FROM ""R"".""requested_at"")=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""month"",COUNT(""CTE4"".""driver_id"") OVER (PARTITION BY ""CTE1"".""month"") AS ""accepted_rides"" FROM ""CTE1"" LEFT JOIN ""CTE4"" ON ""CTE1"".""month""=""CTE4"".""month"") SELECT ""CTE5"".""month"",""CTE3"".""active_drivers"",""CTE5"".""accepted_rides"" FROM (""CTE5"") JOIN ""CTE3"" WHERE ""CTE5"".""month""=""CTE3"".""month"""
327,"WITH ""rec"" AS (WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12) SELECT * FROM ""seq""), ""d_agg"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 WHEN EXTRACT(YEAR FROM ""join_date"")>2020 THEN NULL ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month_2020"",COUNT(DISTINCT ""driver_id"") AS ""ct"" FROM ""drivers"" GROUP BY 1), ""ac_d"" AS (SELECT ""r"".""month"",SUM(COALESCE(""d"".""ct"", 0)) OVER (ORDER BY ""r"".""month"") AS ""ac_drivers"" FROM ""rec"" AS ""r"" LEFT JOIN ""d_agg"" AS ""d"" ON ""r"".""month""=""d"".""join_month_2020""), ""ac_r"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""ac_rides"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""ac_d"".""month"" AS ""month"",""ac_d"".""ac_drivers"" AS ""active_drivers"",COALESCE(""ac_r"".""ac_rides"", 0) AS ""accepted_rides"" FROM ""ac_d"" LEFT JOIN ""ac_r"" ON ""ac_d"".""month""=""ac_r"".""month"""
328,"SELECT ""t1"".""month"",COUNT(DISTINCT ""t2"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""t3"".""ride_id"") AS ""accepted_rides"" FROM ((SELECT 1 AS ""month"" UNION SELECT 2 AS ""month"" UNION SELECT 3 AS ""month"" UNION SELECT 4 AS ""month"" UNION SELECT 5 AS ""month"" UNION SELECT 6 AS ""month"" UNION SELECT 7 AS ""month"" UNION SELECT 8 AS ""month"" UNION SELECT 9 AS ""month"" UNION SELECT 10 AS ""month"" UNION SELECT 11 AS ""month"" UNION SELECT 12 AS ""month"") AS ""t1"" LEFT JOIN (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""t2"" ON ""t2"".""month""<=""t1"".""month"") LEFT JOIN (SELECT ""t1"".""ride_id"",EXTRACT(MONTH FROM ""t2"".""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""t1"" JOIN ""rides"" AS ""t2"" ON ""t2"".""ride_id""=""t1"".""ride_id"" WHERE EXTRACT(YEAR FROM ""t2"".""requested_at"")=2020) AS ""t3"" ON ""t3"".""month""=""t1"".""month"" GROUP BY ""t1"".""month"""
329,"WITH RECURSIVE ""cte1"" (""day"") AS (SELECT STR_TO_DATE('2020-01-31', '%Y-%m-%d') UNION ALL SELECT LAST_DAY(""day"" + INTERVAL '1 MONTH') FROM ""cte1"" WHERE ""day""<'2020-12-1'), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""day"") AS ""month"",COUNT(""driver_id"") AS ""active_drivers"" FROM ""cte1"" LEFT JOIN ""drivers"" ON ""join_date""<=""day"" GROUP BY ""month""), ""cte3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" NATURAL JOIN ""Rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""cte2"".""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""cte2"" LEFT JOIN ""cte3"" ON ""cte2"".""month""=""cte3"".""month"""
330,"WITH ""months_2020"" AS (SELECT '2020-01-31' AS ""dt"" UNION SELECT '2020-02-29' AS ""dt"" UNION SELECT '2020-03-31' AS ""dt"" UNION SELECT '2020-04-30' AS ""dt"" UNION SELECT '2020-05-31' AS ""dt"" UNION SELECT '2020-06-30' AS ""dt"" UNION SELECT '2020-07-31' AS ""dt"" UNION SELECT '2020-08-31' AS ""dt"" UNION SELECT '2020-09-30' AS ""dt"" UNION SELECT '2020-10-31' AS ""dt"" UNION SELECT '2020-11-30' AS ""dt"" UNION SELECT '2020-12-31' AS ""dt""), ""drivers_2020"" AS (SELECT EXTRACT(MONTH FROM ""m"".""dt"") AS ""month"",COUNT(DISTINCT CASE WHEN ""d"".""join_date""<=""m"".""dt"" THEN ""d"".""driver_id"" ELSE NULL END) AS ""active_drivers"" FROM (""months_2020"" AS ""m"") JOIN ""Drivers"" AS ""d"" GROUP BY EXTRACT(MONTH FROM ""m"".""dt"")), ""rides_2020"" AS (SELECT EXTRACT(MONTH FROM ""m"".""dt"") AS ""month"",COUNT(DISTINCT CASE WHEN EXTRACT(MONTH FROM ""r"".""requested_at"")=EXTRACT(MONTH FROM ""m"".""dt"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 THEN ""r"".""ride_id"" ELSE NULL END) AS ""accepted_rides"" FROM (""months_2020"" AS ""m"") JOIN (""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"") GROUP BY EXTRACT(MONTH FROM ""m"".""dt"")) SELECT ""d"".""month"",""d"".""active_drivers"",""r"".""accepted_rides"" FROM ""drivers_2020"" AS ""d"" JOIN ""rides_2020"" AS ""r"" ON ""d"".""month""=""r"".""month"""
331,"WITH RECURSIVE ""cte_month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte_month"" WHERE ""month""<12), ""cte_active_drivers"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""drivers"" WHERE ""join_date""<'2021-01-01'), ""cte_accepted_rides"" AS (SELECT ""ar"".""ride_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""cte_month"".""month"",COUNT(DISTINCT ""cad"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""car"".""ride_id"") AS ""accepted_rides"" FROM (""cte_month"" LEFT JOIN ""cte_active_drivers"" AS ""cad"" ON ""cte_month"".""month"">=""cad"".""month"") LEFT JOIN ""cte_accepted_rides"" AS ""car"" ON ""cte_month"".""month""=""car"".""month"" GROUP BY ""cte_month"".""month"""
332,"WITH RECURSIVE ""end_of_months"" AS (SELECT LAST_DAY('2020-01-01') AS ""mon"" UNION ALL SELECT LAST_DAY(""mon"" + INTERVAL '1 MONTH') FROM ""end_of_months"" WHERE LAST_DAY(""mon"" + INTERVAL '1 MONTH')<='2020-12-31'), ""active_drivers"" AS (SELECT EXTRACT(MONTH FROM ""m"".""mon"") AS ""month"",COUNT(""d"".""driver_id"") AS ""active_drivers"" FROM ""end_of_months"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON ""d"".""join_date""<=""m"".""mon"" GROUP BY ""mon""), ""accepted"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""month"") SELECT ""ad"".*,COALESCE(""a"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""active_drivers"" AS ""ad"" LEFT JOIN ""accepted"" AS ""a"" ON ""ad"".""month""=""a"".""month"" ORDER BY ""ad"".""month"""
333,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""c2"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""cnt"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""c3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""m"",COUNT(""r"".""ride_id"") AS ""cnt2"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""m"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""cnt"") OVER (ORDER BY ""month""), 0) AS ""active_drivers"",COALESCE(""cnt2"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""c2"" ON ""m"".""month""=""c2"".""month"") LEFT JOIN ""c3"" ON ""m"".""month""=""c3"".""m"""
334,"WITH ""dates"" AS (SELECT @""start_date"":=@""start_date"" + INTERVAL '1 MONTH' AS ""year_month"" FROM ((""rides"" AS ""r1"") JOIN ""rides"" AS ""r2"") JOIN (SELECT @""start_date"":='2019-11-01') AS ""s1"" WHERE @""start_date""<'2020-12-01'), ""tmp"" AS (SELECT ""year_month"",COUNT(""driver_id"") OVER (ORDER BY ""year_month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM ""dates"" LEFT JOIN ""drivers"" AS ""d"" ON ""dates"".""year_month""=TO_CHAR(""d"".""join_date"", 'YYYY-%m-01')), ""spine"" AS (SELECT ""year_month"",MAX(""active_drivers"") AS ""active_drivers"" FROM ""tmp"" GROUP BY ""year_month""), ""r"" AS (SELECT TO_CHAR(""requested_at"", 'YYYY-%m-01') AS ""year_month"",COUNT(1) AS ""accepted_rides"" FROM ""rides"" JOIN ""acceptedrides"" ON ""rides"".""ride_id""=""acceptedrides"".""ride_id"" GROUP BY ""year_month"") SELECT EXTRACT(MONTH FROM ""spine"".""year_month"") AS ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""spine"" LEFT JOIN ""r"" ON ""spine"".""year_month""=""r"".""year_month"" WHERE EXTRACT(YEAR FROM ""spine"".""year_month"")=2020"
335,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" WHERE ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""m"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""t1"" ON ""m"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""m"".""month""=""t2"".""month"""
336,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
337,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
338,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
339,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""active_drivers"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",MAX(""drivers"") AS ""active_drivers"" FROM (SELECT ""join_date"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""drivers"" FROM ""Drivers"") AS ""t1"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020 GROUP BY EXTRACT(MONTH FROM ""join_date"")), ""accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""ar"" LEFT JOIN ""Rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT ""month"",MAX(""active_drivers"") OVER (ORDER BY ""month"") AS ""active_drivers"",""accepted_rides"" FROM (SELECT ""m"".""month"",COALESCE(""ad"".""active_drivers"", 0) AS ""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""active_drivers"" AS ""ad"" ON ""m"".""month""=""ad"".""month"") LEFT JOIN ""accepted_rides"" AS ""ar"" ON ""m"".""month""=""ar"".""month"") AS ""t2"" ORDER BY ""month"""
340,"WITH RECURSIVE ""months"" (""month"") AS (SELECT 1 UNION SELECT ""month""+1 FROM ""months"" WHERE ""month""<12), ""cte1"" AS (SELECT ""join_date"",COUNT(""driver_id"") OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM (SELECT DISTINCT * FROM ""drivers"" ORDER BY ""join_date"") AS ""temp""), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",""active_drivers"" FROM ""cte1"" WHERE ""join_date"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte3"" AS (SELECT ""a"".""month"",(CASE WHEN ""b"".""active_drivers"" IS NULL AND ""a"".""month""=1 THEN 0 WHEN ""b"".""active_drivers"" IS NULL AND ""a"".""month""!=1 THEN MAX(""b"".""active_drivers"") OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) ELSE ""b"".""active_drivers"" END) AS ""active_drivers"" FROM ""months"" AS ""a"" LEFT JOIN ""cte2"" AS ""b"" ON ""a"".""month""=""b"".""month""), ""cte4"" AS (SELECT ""a"".""ride_id"",""a"".""requested_at"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" WHERE ""a"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31'), ""cte5"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""cte4"" GROUP BY ""month""), ""cte6"" AS (SELECT ""a"".""month"",COALESCE(""b"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""months"" AS ""a"" LEFT JOIN ""cte5"" AS ""b"" ON ""a"".""month""=""b"".""month"") SELECT ""a"".""month"",MAX(""a"".""active_drivers"") AS ""active_drivers"",""b"".""accepted_rides"" FROM ""cte3"" AS ""a"" JOIN ""cte6"" AS ""b"" ON ""a"".""month""=""b"".""month"" GROUP BY ""a"".""month"""
341,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
342,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""Months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month""=TO_CHAR(""r"".""requested_at"", '%m') AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY ""m"".""month"" ORDER BY 1"
343,"WITH RECURSIVE ""CTE1"" (""month"") AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE1"" WHERE ""month""<12), ""CTE2"" AS (SELECT EXTRACT(MONTH FROM ""REQUESTED_AT"") AS ""MONTH"",""A"".""RIDE_ID"" FROM ""RIDES"" AS ""R"" JOIN ""ACCEPTEDRIDES"" AS ""A"" ON ""R"".""RIDE_ID""=""A"".""RIDE_ID"" WHERE EXTRACT(YEAR FROM ""REQUESTED_AT"")=2020), ""CTE3"" AS (SELECT ""CTE1"".""MONTH"",COUNT(""RIDE_ID"") AS ""ACCEPTED_RIDES"" FROM ""CTE1"" LEFT JOIN ""CTE2"" USING (""MONTH"") GROUP BY ""CTE1"".""MONTH""), ""CTE4"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""JOIN_DATE"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""JOIN_DATE"") END AS ""MONTH"",""DRIVER_ID"" FROM ""DRIVERS"" WHERE EXTRACT(YEAR FROM ""JOIN_DATE"")<=2020), ""CTE5"" AS (SELECT DISTINCT ""CTE1"".""MONTH"",COUNT(""DRIVER_ID"") OVER (ORDER BY ""CTE1"".""MONTH"") AS ""ACTIVE_DRIVERS"" FROM ""CTE1"" LEFT JOIN ""CTE4"" USING (""MONTH"")) SELECT ""CTE3"".""MONTH"",""ACTIVE_DRIVERS"",""ACCEPTED_RIDES"" FROM ""CTE3"" JOIN ""CTE5"" USING (""MONTH"")"
344,"WITH RECURSIVE ""cte"" (""month"") AS (SELECT 1 UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""Drivers_before_2020"" AS (SELECT COUNT(1) AS ""num"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020), ""Active_Drives"" AS (SELECT DISTINCT ""c"".""month"",SUM(CASE WHEN ""d"".""driver_id"" IS NOT NULL THEN 1 ELSE 0 END) OVER (ORDER BY ""c"".""month"") AS ""active_drivers"" FROM ""cte"" AS ""c"" LEFT JOIN (SELECT * FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")=2020) AS ""d"" ON ""c"".""month""=EXTRACT(MONTH FROM ""d"".""join_date"")), ""AcceptedRides_2020"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT ""ad"".""month"",""ad"".""active_drivers""+(SELECT ""num"" FROM ""Drivers_before_2020"") AS ""active_drivers"",COALESCE(""ar"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""Active_Drives"" AS ""ad"" LEFT JOIN ""AcceptedRides_2020"" AS ""ar"" ON ""ad"".""month""=""ar"".""month"""
345,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12) SELECT ""seq"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (""seq"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""seq"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""seq"".""month""=""rides"".""month"" GROUP BY ""seq"".""month"" ORDER BY ""seq"".""month"""
346,"SELECT ""column_0"" AS ""month"",(SELECT COUNT(1) FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""column_0"")) AS ""active_drivers"",(SELECT COUNT(1) FROM (""AcceptedRides"") JOIN ""Rides"" WHERE ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" AND ""requested_at""<'2021-01-01' AND ""requested_at"">='2020-01-01' AND EXTRACT(MONTH FROM ""requested_at"")=""column_0"") AS ""accepted_rides"" FROM (VALUES ROW(1), ROW(2), ROW(3), ROW(4), ROW(5), ROW(6), ROW(7), ROW(8), ROW(9), ROW(10), ROW(11), ROW(12)) AS ""months"""
347,"WITH RECURSIVE ""CTE"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""CTE"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""r"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" WHERE ""r"".""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""CTE"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""CTE"".""month""), 0) AS ""active_drivers"",COALESCE(""t2"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""CTE"" LEFT JOIN ""t1"" ON ""CTE"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""CTE"".""month""=""t2"".""month"""
348,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""ride_id"",0 AS ""user_id"",'2020-01-01' AS ""requested_at"" UNION ALL SELECT 0 AS ""ride_id"",0 AS ""user_id"",""requested_at"" + INTERVAL '1 MONTH' AS ""requested_at"" FROM ""cte"" WHERE ""requested_at""<'2021-01-01'), ""ridesx"" AS (SELECT * FROM ""cte"" UNION ALL SELECT * FROM ""Rides"") SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",(SELECT COUNT(1) FROM ""Drivers"" WHERE TO_CHAR(""join_date"", 'YYYY-%m')<=TO_CHAR(""r"".""requested_at"", 'YYYY-%m')) AS ""active_drivers"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM ""ridesx"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")='2020' GROUP BY 1 ORDER BY 1"
349,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""t"" AS (SELECT ""m"".""month"",COALESCE(MAX(""active_drivers"") OVER (ORDER BY ""month""), 0) AS ""active_drivers"" FROM ""month"" AS ""m"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""a"" USING (""month"")) SELECT DISTINCT ""t"".""month"",""t"".""active_drivers"",COALESCE(""t1"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""t"" LEFT JOIN (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""ac"".""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ac"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) AS ""t1"" USING (""month"")"
350,"WITH RECURSIVE ""a"" AS (SELECT 1 AS ""month"",(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE ""join_date""<'2020-02-01') AS ""active_drivers"",(SELECT COUNT(""Rides"".""ride_id"") FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-01-31') AS ""accepted_rides"" UNION ALL SELECT ""month""+1,(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE ""join_date""<CASE WHEN ""month""+2>12 THEN '2021-01-01' ELSE CONCAT('2020-', ""month""+2, '-01') END) AS ""active_drivers"",(SELECT COUNT(""Rides"".""ride_id"") FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE ""requested_at"">=CONCAT('2020-', CASE WHEN ""month""+2>12 THEN 12 ELSE ""month""+1 END, '-01') AND ""requested_at""<CASE WHEN ""month""+2>12 THEN '2021-01-01' ELSE CONCAT('2020-', ""month""+2, '-01') END) AS ""accepted_rides"" FROM ""a"" WHERE ""month""<12) SELECT * FROM ""a"""
351,"WITH RECURSIVE ""month_count"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""month_count"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""month_count"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""Rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
352,"WITH RECURSIVE ""all_months"" AS (SELECT 1 AS ""join_month"" UNION ALL SELECT ""join_month""+1 FROM ""all_months"" WHERE ""join_month""<12), ""rolling_drivers"" AS (SELECT ""join_year"",""join_month"",SUM(""new_drivers"") OVER (ORDER BY ""join_year"",""join_month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ""active_drivers"" FROM (SELECT EXTRACT(YEAR FROM ""join_date"") AS ""join_year"",EXTRACT(MONTH FROM ""join_date"") AS ""join_month"",COUNT(DISTINCT ""driver_id"") AS ""new_drivers"" FROM ""Drivers"" GROUP BY EXTRACT(YEAR_MONTH FROM ""join_date"")) AS ""t1""), ""monthly_rides"" AS (SELECT EXTRACT(YEAR FROM ""requested_at"") AS ""join_year"",EXTRACT(MONTH FROM ""requested_at"") AS ""join_month"",COUNT(DISTINCT ""AcceptedRides"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" JOIN ""Rides"" ON ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY EXTRACT(YEAR_MONTH FROM ""requested_at"")), ""existing_data"" AS (SELECT ""m_r"".""join_month"" AS ""join_month"",""r_d"".""active_drivers"",""m_r"".""accepted_rides"" FROM (SELECT * FROM ""monthly_rides"") AS ""m_r"" LEFT JOIN (SELECT * FROM ""rolling_drivers"" WHERE ""join_year""=2020) AS ""r_d"" ON ""r_d"".""join_month""=""m_r"".""join_month"" UNION SELECT ""r_d"".""join_month"" AS ""join_month"",""r_d"".""active_drivers"",""m_r"".""accepted_rides"" FROM (SELECT * FROM ""monthly_rides"") AS ""m_r"" RIGHT JOIN (SELECT * FROM ""rolling_drivers"" WHERE ""join_year""=2020) AS ""r_d"" ON ""r_d"".""join_month""=""m_r"".""join_month"" ORDER BY ""join_month"") SELECT ""t1"".""join_month"" AS ""month"",COALESCE(""active_drivers"", MAX(""active_drivers"") OVER (ORDER BY ""t1"".""join_month"" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW), 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (SELECT * FROM ""all_months"") AS ""t1"" LEFT JOIN (SELECT * FROM ""existing_data"") AS ""t2"" ON ""t1"".""join_month""=""t2"".""join_month"""
353,"WITH RECURSIVE ""date_dummy"" (""n"") AS (SELECT 1 UNION ALL SELECT ""n""+1 FROM ""date_dummy"" WHERE ""n""<12), ""date_n"" AS (SELECT TO_CHAR((STR_TO_DATE(CONCAT('2020-', ""n"", '-1'), '%Y-%m-%d')), 'YYYY-%m') AS ""mn"" FROM ""date_dummy""), ""cte1"" AS (SELECT ""ride_date"",SUM(CASE WHEN ""ride_distance"" IS NULL THEN 0 ELSE 1 END) AS ""accepted_rides"" FROM (SELECT TO_CHAR(""requested_at"", 'YYYY-%m') AS ""ride_date"",""r"".""ride_id"" AS ""ride_id"",""ride_distance"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE TO_CHAR(""requested_at"", 'YYYY')=2020) AS ""t"" GROUP BY ""ride_date"") SELECT EXTRACT(MONTH FROM (STR_TO_DATE(CONCAT(""month"", '-1'), '%Y-%m-%d'))) AS ""month"",""driver_cnt"" AS ""active_drivers"",""accepted_rides"" FROM (SELECT ""mn"" AS ""month"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""date_n"" AS ""dn"" LEFT JOIN ""cte1"" AS ""ct"" ON ""dn"".""mn""=""ct"".""ride_date"") AS ""a"" LEFT JOIN (SELECT ""mn"",COUNT(DISTINCT ""driver_id"") AS ""driver_cnt"" FROM ""date_n"" AS ""dn"" LEFT JOIN ""Drivers"" AS ""d"" ON ""dn"".""mn"">=TO_CHAR(""join_date"", 'YYYY-%m') GROUP BY ""mn"") AS ""b"" ON ""a"".""month""=""b"".""mn"""
354,"WITH RECURSIVE ""temp"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""temp"" WHERE ""month""<12), ""b"" AS (SELECT ""driver_id"",""join_date"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN '2020-01-01' ELSE ""join_date"" END AS ""driver_date"" FROM ""drivers""), ""c"" AS (SELECT ""t"".""month"",COUNT(""b"".""driver_id"") AS ""active_drivers"" FROM ""temp"" AS ""t"" LEFT JOIN ""b"" ON ""t"".""month""=EXTRACT(MONTH FROM ""b"".""driver_date"") AND EXTRACT(YEAR FROM ""b"".""driver_date"")=2020 GROUP BY 1), ""d"" AS (SELECT ""t"".""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""temp"" AS ""t"" LEFT JOIN ""rides"" AS ""r"" ON ""t"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 AND ""r"".""ride_id"" IN (SELECT ""ride_id"" FROM ""acceptedrides"") GROUP BY 1) SELECT ""c"".""month"",SUM(""c"".""active_drivers"") OVER (ORDER BY ""c"".""month"") AS ""active_drivers"",""d"".""accepted_rides"" FROM ""c"" LEFT JOIN ""d"" ON ""c"".""month""=""d"".""month"""
355,"WITH RECURSIVE ""t1"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""t1"" WHERE ""month""<12), ""t2"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COALESCE(COUNT(DISTINCT ""driver_id""), 0) AS ""active_drivers"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY ""month""), ""t3"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COALESCE(COUNT(DISTINCT ""Rides"".""ride_id""), 0) AS ""accepted_rides"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT ""t1"".""month"",COALESCE(SUM(""t2"".""active_drivers""), 0) AS ""active_drivers"",COALESCE(""t3"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""t1"" LEFT JOIN ""t2"" ON ""t1"".""month"">=""t2"".""month"") LEFT JOIN ""t3"" ON ""t1"".""month""=""t3"".""month"" GROUP BY ""t1"".""month"" ORDER BY ""t1"".""month"""
356,"WITH RECURSIVE ""mont_cte"" AS (SELECT 1 AS ""start_mon"" UNION ALL SELECT ""start_mon""+1 AS ""start_mon"" FROM ""mont_cte"" WHERE ""start_mon""<12), ""driver"" AS (SELECT DISTINCT CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""driver_month"",""driver_id"" FROM ""mont_cte"" AS ""mct"" LEFT JOIN ""Drivers"" AS ""d"" ON ""mct"".""start_mon""=CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AND EXTRACT(YEAR FROM ""join_date"")<=2020), ""ride"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT ""mc"".""start_mon"" AS ""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM (""mont_cte"" AS ""mc"" LEFT JOIN ""driver"" AS ""d"" ON ""mc"".""start_mon"">=""d"".""driver_month"") LEFT JOIN ""ride"" AS ""r"" ON ""mc"".""start_mon""=""r"".""month"" GROUP BY 1 ORDER BY 1"
357,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
358,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""m"" UNION SELECT ""m""+1 FROM ""cte"" WHERE ""m""<12) SELECT ""t3"".""m"" AS ""month"",""active_drivers"",""accepted_rides"" FROM (SELECT ""m"",SUM(""cnt"") OVER (ORDER BY ""m"") AS ""active_drivers"" FROM (SELECT DISTINCT ""m"",COUNT(""join_month"") OVER (PARTITION BY ""m"" ORDER BY ""m"") AS ""cnt"" FROM ""cte"" LEFT JOIN (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021) AS ""t1"" ON ""m""=""join_month"") AS ""t2"") AS ""t3"" JOIN (SELECT ""m"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM (""cte"" LEFT JOIN (SELECT * FROM ""rides"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""r"" ON ""cte"".""m""=EXTRACT(MONTH FROM ""r"".""requested_at"")) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""ar"".""ride_id""=""r"".""ride_id"" GROUP BY ""m"") AS ""t4"" USING (""m"")"
359,"WITH RECURSIVE ""seq"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""seq"" WHERE ""month""<12), ""driver"" AS (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""accepted"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (""seq"" AS ""t"" LEFT JOIN ""driver"" AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN ""accepted"" AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
360,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""cte"" WHERE ""month""<12), ""active_drivers"" AS (SELECT 0 AS ""month"",COUNT(""driver_id"") AS ""cnt"" FROM ""Drivers"" WHERE ""join_date""<'2020-01-01' UNION SELECT TO_CHAR(""join_date"", '%m') AS ""month"",COUNT(""driver_id"") AS ""cnt"" FROM ""Drivers"" WHERE ""join_date"" LIKE '2020%' GROUP BY 1), ""accept"" AS (SELECT TO_CHAR(""requested_at"", '%m') AS ""month"",COUNT(""c"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""b"" LEFT JOIN ""AcceptedRides"" AS ""c"" USING (""ride_id"") WHERE ""requested_at"" LIKE '2020%' GROUP BY 1) SELECT ""month"",""active_drivers"",""accepted_rides"" FROM (SELECT ""cte"".""month"",SUM(""cnt"") OVER (ORDER BY ""cte"".""month"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" LEFT JOIN ""active_drivers"" AS ""a"" USING (""month"")) LEFT JOIN ""accept"" ON ""cte"".""month""=""accept"".""month"") AS ""t"" WHERE ""month"">0"
361,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11), ""d1"" AS (SELECT TO_CHAR(""join_date"", 'YYYY') AS ""j_year"",TO_CHAR(""join_date"", '%m') AS ""j_month"",COUNT(1) AS ""j_drivers"" FROM ""drivers"" GROUP BY TO_CHAR(""join_date"", 'YYYY'),TO_CHAR(""join_date"", '%m')), ""a"" AS (SELECT TO_CHAR(""requested_at"", 'YYYY') AS ""r_year"",TO_CHAR(""requested_at"", '%m') AS ""r_month"",COUNT(1) AS ""ac_rides"" FROM ""acceptedrides"" AS ""ac"" JOIN ""rides"" AS ""r"" ON ""ac"".""ride_id""=""r"".""ride_id"" GROUP BY TO_CHAR(""requested_at"", 'YYYY'),TO_CHAR(""requested_at"", '%m')) SELECT ""m"".""month"" AS ""month"",COALESCE(SUM(""j_drivers""), 0) AS ""active_drivers"",COALESCE(AVG(""ac_rides""), 0) AS ""accepted_rides"" FROM (""m"" LEFT JOIN ""d1"" ON (""d1"".""j_year""=2020 AND ""d1"".""j_month""<=""m"".""month"") OR ""d1"".""j_year""<2020) LEFT JOIN ""a"" ON ""m"".""month""=""a"".""r_month"" AND ""a"".""r_year""=2020 GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
362,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""t"".""month"",(SELECT COUNT(""driver_id"") FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021 AND (EXTRACT(MONTH FROM ""join_date"")<=""t"".""month"" OR EXTRACT(YEAR FROM ""join_date"")<2020)) AS ""active_drivers"",(SELECT COUNT(DISTINCT ""a"".""ride_id"") FROM ""rides"" AS ""a"" JOIN ""Acceptedrides"" AS ""b"" ON ""a"".""ride_id""=""b"".""ride_id"" AND EXTRACT(MONTH FROM ""a"".""requested_at"")=""t"".""month"" WHERE ""a"".""requested_at"" LIKE '2020%') AS ""accepted_rides"" FROM ""months"" AS ""t"""
363,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM ((""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"") RIGHT JOIN ""months"" AS ""m"" ON EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""r"".""requested_at"")=""m"".""month"") LEFT JOIN ""Drivers"" AS ""d"" ON EXTRACT(YEAR FROM ""d"".""join_date"")<2020 OR (EXTRACT(YEAR FROM ""d"".""join_date"")=2020 AND EXTRACT(MONTH FROM ""d"".""join_date"")<=""m"".""month"") GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
364,"WITH RECURSIVE ""month_cte"" AS (SELECT 1 AS ""month_num"",STR_TO_DATE('2020-02-01', '%Y-%m-%d') AS ""next_month"" UNION ALL SELECT ""month_num""+1,CASE WHEN ""month_num""+1<=11 THEN STR_TO_DATE(CONCAT('2020-', LPAD(""month_num""+2, 2, '00'), '-01'), '%Y-%m-%d') ELSE STR_TO_DATE('2021-01-01', '%Y-%m-%d') END AS ""next_month"" FROM ""month_cte"" WHERE ""month_num""<12) SELECT ""month_num"" AS ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM ((""Rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"") RIGHT JOIN ""month_cte"" AS ""m"" ON ""m"".""month_num""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")='2020') LEFT JOIN ""Drivers"" AS ""d"" ON ""m"".""next_month"">""d"".""join_date"" GROUP BY ""month_num"" ORDER BY ""month_num"""
365,"WITH RECURSIVE ""cte_month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte_month"" WHERE ""month""<12), ""cte_active_drivers"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")<=2019 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""drivers"" WHERE ""join_date""<'2021-01-01'), ""cte_accepted_rides"" AS (SELECT ""ar"".""ride_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""ar"" JOIN ""rides"" AS ""r"" ON ""ar"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY 1) SELECT ""cte_month"".""month"",COUNT(DISTINCT ""cad"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""car"".""ride_id"") AS ""accepted_rides"" FROM (""cte_month"" LEFT JOIN ""cte_active_drivers"" AS ""cad"" ON ""cte_month"".""month"">=""cad"".""month"") LEFT JOIN ""cte_accepted_rides"" AS ""car"" ON ""cte_month"".""month""=""car"".""month"" GROUP BY ""cte_month"".""month"""
366,"WITH ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT 2 AS ""month"" UNION ALL SELECT 3 AS ""month"" UNION ALL SELECT 4 AS ""month"" UNION ALL SELECT 5 AS ""month"" UNION ALL SELECT 6 AS ""month"" UNION ALL SELECT 7 AS ""month"" UNION ALL SELECT 8 AS ""month"" UNION ALL SELECT 9 AS ""month"" UNION ALL SELECT 10 AS ""month"" UNION ALL SELECT 11 AS ""month"" UNION ALL SELECT 12 AS ""month""), ""drivermonth"" AS (SELECT ""driver_id"",CASE WHEN ""join_date""<'2020-01-01' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""join_month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31'), ""months_with_drivers"" AS (SELECT ""M"".""month"",COALESCE(COUNT(""D"".""driver_id""), 0) AS ""active_drivers"" FROM ""months"" AS ""M"" LEFT JOIN ""drivermonth"" AS ""D"" ON ""M"".""month"">=""D"".""join_month"" GROUP BY ""M"".""month""), ""ridesmonth"" AS (SELECT EXTRACT(MONTH FROM ""R"".""requested_at"") AS ""requested_month"",COUNT(""A"".""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" AS ""A"" JOIN ""Rides"" AS ""R"" ON ""A"".""ride_id""=""R"".""ride_id"" WHERE ""R"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY ""requested_month""), ""finaltable"" AS (SELECT ""M"".""month"",""M"".""active_drivers"",COALESCE(""R"".""accepted_rides"", 0) AS ""accepted_rides"" FROM ""months_with_drivers"" AS ""M"" LEFT JOIN ""ridesmonth"" AS ""R"" ON ""M"".""month""=""R"".""requested_month"") SELECT * FROM ""finaltable"""
367,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12) SELECT ""month"",(SELECT COUNT(1) FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""month"")) AS ""active_drivers"",(SELECT COUNT(1) FROM (""AcceptedRides"") JOIN ""Rides"" WHERE ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" AND ""requested_at""<'2021-01-01' AND ""requested_at"">='2020-01-01' AND EXTRACT(MONTH FROM ""requested_at"")=""month"") AS ""accepted_rides"" FROM ""cte"""
368,"SELECT ""column_0"" AS ""month"",(SELECT COUNT(1) FROM ""Drivers"" WHERE ""join_date""<'2021-01-01' AND (""join_date""<'2020-01-01' OR EXTRACT(MONTH FROM ""join_date"")<=""column_0"")) AS ""active_drivers"",(SELECT COUNT(1) FROM (""AcceptedRides"") JOIN ""Rides"" WHERE ""AcceptedRides"".""ride_id""=""Rides"".""ride_id"" AND ""requested_at""<'2021-01-01' AND ""requested_at"">='2020-01-01' AND EXTRACT(MONTH FROM ""requested_at"")=""column_0"") AS ""accepted_rides"" FROM (VALUES ROW(1), ROW(2), ROW(3), ROW(4), ROW(5), ROW(6), ROW(7), ROW(8), ROW(9), ROW(10), ROW(11), ROW(12)) AS ""months"""
369,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
370,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""t1"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT COUNT(""r"".""ride_id"") AS ""accepted_rides"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""c"".""month"",COALESCE(MAX(""t1"".""active_drivers"") OVER (ORDER BY ""c"".""month""), 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" AS ""c"" LEFT JOIN ""t1"" ON ""c"".""month""=""t1"".""month"") LEFT JOIN ""t2"" ON ""c"".""month""=""t2"".""month"" ORDER BY ""c"".""month"""
371,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11) SELECT ""m"".""month"" AS ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""m"" LEFT JOIN ""drivers"" AS ""d"" ON (TO_CHAR(""d"".""join_date"", '%m')<=""m"".""month"" AND TO_CHAR(""d"".""join_date"", 'YYYY')=2020) OR TO_CHAR(""d"".""join_date"", 'YYYY')<2020) LEFT JOIN ""rides"" AS ""r"" ON TO_CHAR(""r"".""requested_at"", '%m')=""m"".""month"" AND TO_CHAR(""r"".""requested_at"", 'YYYY')=2020) LEFT JOIN ""acceptedrides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
372,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"",0 AS ""driver_cnt"" UNION ALL SELECT ""month""+1 AS ""month"",0 AS ""driver_cnt"" FROM ""cte"" WHERE ""month""<12), ""cte1"" AS (SELECT ""month"",COUNT(""driver_id"") AS ""driver_cnt"" FROM (SELECT ""driver_id"",EXTRACT(MONTH FROM CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN '2020-1-1' ELSE ""join_date"" END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""t"" GROUP BY ""month""), ""cte2"" AS (SELECT ""month"",COUNT(""ride_id"") AS ""ride_cnt"" FROM (SELECT ""a"".""ride_id"",""r"".""requested_at"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"" FROM ""AcceptedRides"" AS ""a"" LEFT JOIN ""Rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) AS ""t"" GROUP BY ""month"") SELECT ""t1"".""month"",SUM(""driver_cnt"") OVER (ORDER BY ""t1"".""month"") AS ""active_drivers"",COALESCE(""ride_cnt"", 0) AS ""accepted_rides"" FROM (SELECT ""month"",SUM(""driver_cnt"") AS ""driver_cnt"" FROM (SELECT * FROM ""cte"" UNION ALL SELECT * FROM ""cte1"") AS ""t0"" GROUP BY ""month"") AS ""t1"" LEFT JOIN ""cte2"" AS ""t2"" ON ""t1"".""month""=""t2"".""month"" ORDER BY ""t1"".""month"""
373,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<=11) SELECT ""m"".""month"" AS ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""m"" LEFT JOIN ""drivers"" AS ""d"" ON (TO_CHAR(""d"".""join_date"", '%m')<=""m"".""month"" AND TO_CHAR(""d"".""join_date"", 'YYYY')=2020) OR TO_CHAR(""d"".""join_date"", 'YYYY')<2020) LEFT JOIN ""rides"" AS ""r"" ON TO_CHAR(""r"".""requested_at"", '%m')=""m"".""month"" AND TO_CHAR(""r"".""requested_at"", 'YYYY')=2020) LEFT JOIN ""acceptedrides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
374,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
375,"WITH RECURSIVE ""full_year"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""full_year"" WHERE ""month""<12), ""cte1"" AS (SELECT ""driver_id"",""join_date"" FROM ""Drivers"" WHERE ""join_date""<'2021-01-01'), ""cte2"" AS (SELECT EXTRACT(MONTH FROM ""d1"".""join_date"") AS ""month"",""d2"".""driver_id"" FROM (""cte1"" AS ""d1"") JOIN ""cte1"" AS ""d2"" WHERE ""d1"".""join_date"">=""d2"".""join_date""), ""cte3"" AS (SELECT ""month"",COUNT(DISTINCT ""driver_id"") AS ""driver_id"" FROM ""cte2"" GROUP BY ""month"" ORDER BY ""month""), ""cte4"" AS (SELECT ""full_year"".""month"",MAX(""driver_id"") AS ""active_drivers"" FROM ""full_year"" LEFT JOIN ""cte3"" ON ""full_year"".""month"">=""cte3"".""month"" GROUP BY ""full_year"".""month""), ""cte5"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM (""Rides"" AS ""r"") JOIN ""AcceptedRides"" AS ""a"" WHERE ""r"".""ride_id""=""a"".""ride_id"" AND ""requested_at"">='2020-01-01' AND ""requested_at""<'2021-01-01' GROUP BY EXTRACT(MONTH FROM ""requested_at"") ORDER BY ""month"") SELECT ""cte4"".""month"" AS ""month"",COALESCE(""active_drivers"", 0) AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""cte4"" LEFT JOIN ""cte5"" ON ""cte4"".""month""=""cte5"".""month"" ORDER BY ""month"""
376,"WITH RECURSIVE ""month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""month"" WHERE ""month""<12), ""drivers_modifieddate"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ride_modifieddate"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""request_month"" FROM ""Rides"" JOIN ""AcceptedRides"" ON ""Rides"".""ride_id""=""AcceptedRides"".""ride_id"" WHERE EXTRACT(YEAR FROM ""Rides"".""requested_at"")=2020) SELECT ""t1"".""month"",""t1"".""active_drivers"",COUNT(""ride_modifieddate"".""request_month"") AS ""accepted_rides"" FROM (SELECT ""month"".""month"",COUNT(""drivers_modifieddate"".""month"") AS ""active_drivers"" FROM ""month"" LEFT JOIN ""drivers_modifieddate"" ON ""month"".""month"">=""drivers_modifieddate"".""month"" GROUP BY ""month"".""month"") AS ""t1"" LEFT JOIN ""ride_modifieddate"" ON ""ride_modifieddate"".""request_month""=""t1"".""month"" GROUP BY ""t1"".""month"""
377,"WITH RECURSIVE ""m"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""m"" WHERE ""month""<12), ""wau"" AS (SELECT ""join_date"",""driver_id"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2021) SELECT ""m"".""month"",COUNT(DISTINCT ""wau"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""m"" LEFT JOIN ""wau"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""wau"".""join_date"") AND EXTRACT(YEAR FROM ""join_date"")=2020) OR EXTRACT(YEAR FROM ""wau"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 AND EXTRACT(MONTH FROM ""r"".""requested_at"")=""m"".""month"") LEFT JOIN ""acceptedrides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
378,"WITH ""cte"" AS (SELECT 1 AS ""month"" UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) SELECT ""cte"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""cte"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")='2019' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31') AS ""d"" ON ""cte"".""month"">=""d"".""month"") LEFT JOIN (SELECT ""ride_id"",""requested_at"" FROM ""Rides"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""r"" ON ""cte"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"")) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY 1"
379,"WITH RECURSIVE ""Months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""Months"" WHERE ""month""<12) SELECT ""m"".""month"",COALESCE(MAX(""t1"".""active_drivers""), 0) AS ""active_drivers"",COUNT(DISTINCT ""r"".""ride_id"") AS ""accepted_rides"" FROM (""Months"" AS ""m"" LEFT JOIN (SELECT TO_CHAR(""d1"".""join_date"", '%c') AS ""month"",COUNT(""d1"".""driver_id"") AS ""active_drivers"" FROM ""Drivers"" AS ""d1"" LEFT JOIN ""Drivers"" AS ""d2"" ON ""d1"".""join_date"">=""d2"".""join_date"" WHERE LEFT(""d1"".""join_date"", 4)=2020 GROUP BY ""d1"".""driver_id"") AS ""t1"" ON ""m"".""month"">=""t1"".""month"") LEFT JOIN ""Rides"" AS ""r"" ON LEFT(""r"".""requested_at"", 4)=2020 AND ""m"".""month""=TO_CHAR(""r"".""requested_at"", '%c') AND ""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") GROUP BY ""m"".""month"" ORDER BY 1"
380,"WITH RECURSIVE ""dates"" AS (SELECT '2020-01-01' AS ""dates"" UNION ALL SELECT ""dates"" + INTERVAL '+1 DAY' AS ""dates"" FROM ""dates"" WHERE ""dates""<'2020-12-31'), ""monthly_driver"" AS (SELECT EXTRACT(MONTH FROM ""dates"") AS ""month"",COUNT(DISTINCT ""driver_id"", ""join_date"") AS ""dr_cnt"" FROM (""dates"" AS ""m1"") JOIN (SELECT ""driver_id"",""join_date"" FROM ""drivers"" WHERE ""join_date""<='2020-12-31') AS ""d2"" WHERE ""m1"".""dates"">=""d2"".""join_date"" GROUP BY EXTRACT(MONTH FROM ""dates"")), ""monthly_accept"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""ac_cnt"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31' GROUP BY 1 ORDER BY 1) SELECT ""m"".""month"",COALESCE(""dr_cnt"", 0) AS ""active_drivers"",COALESCE(""ac_cnt"", 0) AS ""accepted_rides"" FROM ((SELECT DISTINCT EXTRACT(MONTH FROM ""dates"") AS ""month"" FROM ""dates"") AS ""m"" LEFT JOIN ""monthly_accept"" AS ""a"" ON ""m"".""month""=""a"".""month"") LEFT JOIN ""monthly_driver"" AS ""d"" ON ""m"".""month""=""d"".""month"""
381,"WITH ""cte"" AS (SELECT 1 AS ""month"" UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) SELECT ""cte"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""cte"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")='2019' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31') AS ""d"" ON ""cte"".""month"">=""d"".""month"") LEFT JOIN (SELECT ""ride_id"",""requested_at"" FROM ""Rides"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""r"" ON ""cte"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"")) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY 1"
382,"WITH ""A"" AS (SELECT 1 AS ""month"" UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12), ""B"" AS (SELECT ""ar"".""ride_id"",EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""req_month"" FROM ""rides"" AS ""r"" JOIN ""AcceptedRides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE ""r"".""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') SELECT ""A"".""month"",COALESCE(COUNT(DISTINCT ""d"".""driver_id""), 0) AS ""active_drivers"",COALESCE(COUNT(DISTINCT ""B"".""ride_id""), 0) AS ""accepted_rides"" FROM (""A"" LEFT JOIN ""drivers"" AS ""d"" ON ""d"".""join_date""<=LAST_DAY(CONCAT('2020-', ""A"".""month"", '-01'))) LEFT JOIN ""B"" ON ""B"".""req_month""=""A"".""month"" GROUP BY ""A"".""month"" ORDER BY ""A"".""month"""
383,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""rides2"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""rides"" FROM ""Rides"" AS ""r1"" LEFT JOIN ""AcceptedRides"" AS ""a1"" ON ""a1"".""ride_id""=""r1"".""ride_id"" WHERE ""a1"".""driver_id"" IS NOT NULL AND ""requested_at"" LIKE '2020%' GROUP BY 1), ""monthsTable"" AS (SELECT ""c1"".""month"",""r1"".""rides"" FROM ""cte"" AS ""c1"" LEFT JOIN ""rides2"" AS ""r1"" ON ""r1"".""month""=""c1"".""month""), ""driversTable"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(1) AS ""drivers"",ROW_NUMBER() OVER (ORDER BY ""join_date"") AS ""rowNum"" FROM ""Drivers"" WHERE ""join_date"" LIKE '2020%' GROUP BY 1), ""driversTable2"" AS (SELECT ""month"",CASE WHEN ""rowNum""=1 THEN ""drivers""+(SELECT COUNT(1) FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<2020) ELSE ""drivers"" END AS ""drivers2"" FROM ""driversTable"") SELECT ""m1"".""month"",COALESCE(SUM(""drivers2"") OVER (ORDER BY ""m1"".""month""), 0) AS ""active_drivers"",COALESCE(""m1"".""rides"", 0) AS ""accepted_rides"" FROM ""monthsTable"" AS ""m1"" LEFT JOIN ""driversTable2"" AS ""d1"" ON ""m1"".""month""=""d1"".""month"""
384,"WITH RECURSIVE ""MONTH"" AS (SELECT 1 AS ""MONTH"" UNION SELECT ""MONTH""+1 AS ""MONTH"" FROM ""MONTH"" WHERE ""MONTH""<=11), ""ACTIVE_DRIVERS"" AS (SELECT EXTRACT(MONTH FROM ""join_date"") AS ""month"",COUNT(""driver_id"") OVER (ORDER BY ""join_date"") AS ""active_drivers"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""ACCEPTED_RIDES"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""AcceptedRides"" JOIN ""rides"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY ""month"") SELECT DISTINCT ""M"".""MONTH"",COALESCE(MAX(""active_drivers"") OVER (ORDER BY ""month""), 0) AS ""active_drivers"",COALESCE(""ACCEPTED_RIDES"", 0) AS ""ACCEPTED_RIDES"" FROM (""MONTH"" AS ""m"" LEFT JOIN ""active_drivers"" ON ""M"".""MONTH""=""active_drivers"".""MONTH"") LEFT JOIN ""ACCEPTED_RIDES"" ON ""M"".""MONTH""=""ACCEPTED_RIDES"".""MONTH"""
385,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
386,"WITH RECURSIVE ""monthid"" AS (SELECT 1 AS ""m"" UNION SELECT ""m""+1 AS ""m"" FROM ""monthid"" WHERE ""m""<12), ""t"" AS (SELECT ""driver_id"",""join_date"" FROM ""Drivers"" UNION ALL SELECT ""driver_id"",""join_date"" + INTERVAL '1 MONTH' FROM ""t"" WHERE ""join_date""<STR_TO_DATE('20201201', '%Y%m%d')), ""t2"" AS (SELECT TO_CHAR(""join_date"", 'YYYY-%m-01') AS ""date"",COUNT(DISTINCT ""driver_id"") AS ""counts"" FROM ""t"" WHERE TO_CHAR(""join_date"", 'YYYY-%m')<='2020-12' AND TO_CHAR(""join_date"", 'YYYY-%m')>='2020-01' GROUP BY 1), ""t3"" AS (SELECT EXTRACT(MONTH FROM ""date"") AS ""months"",""counts"" FROM ""t2"" GROUP BY 1), ""t4"" AS (SELECT ""driver_id"",""requested_at"" FROM ""Rides"" JOIN ""AcceptedRides"" USING (""ride_id"")), ""t5"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""months"",COUNT(""driver_id"") AS ""counts"" FROM ""t4"" WHERE TO_CHAR(""requested_at"", 'YYYY-%m')<='2020-12' AND TO_CHAR(""requested_at"", 'YYYY-%m')>='2020-01' GROUP BY 1) SELECT ""m"" AS ""month"",COALESCE(""t3"".""counts"", 0) AS ""active_drivers"",COALESCE(""t5"".""counts"", 0) AS ""accepted_rides"" FROM (""monthid"" LEFT JOIN ""t3"" ON ""m""=""t3"".""months"") LEFT JOIN ""t5"" ON ""m""=""t5"".""months"" GROUP BY 1 ORDER BY 1"
387,"WITH RECURSIVE ""month_2020"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""month_2020"" WHERE ""month""<12), ""active_drivers"" AS (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""drivers"" WHERE ""join_date""<='2020-12-31'), ""accepts"" AS (SELECT ""a"".""ride_id"",EXTRACT(MONTH FROM ""requested_at"") AS ""month"" FROM ""acceptedrides"" AS ""a"" JOIN ""rides"" AS ""r"" ON ""a"".""ride_id""=""r"".""ride_id"" WHERE ""requested_at"">='2020-01-01' AND ""requested_at""<='2020-12-31') SELECT ""m"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM (""month_2020"" AS ""m"" LEFT JOIN ""active_drivers"" AS ""d"" ON ""m"".""month"">=""d"".""month"") LEFT JOIN ""accepts"" AS ""a"" ON ""m"".""month""=""a"".""month"" GROUP BY ""m"".""month"""
388,"WITH ""month"" AS (SELECT 1 AS ""month"" UNION SELECT 2 AS ""month"" UNION SELECT 3 AS ""month"" UNION SELECT 4 AS ""month"" UNION SELECT 5 AS ""month"" UNION SELECT 6 AS ""month"" UNION SELECT 7 AS ""month"" UNION SELECT 8 AS ""month"" UNION SELECT 9 AS ""month"" UNION SELECT 10 AS ""month"" UNION SELECT 11 AS ""month"" UNION SELECT 12 AS ""month"") SELECT ""m"".""month"" AS ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""month"" AS ""m"" LEFT JOIN ""Rides"" AS ""r"" ON (EXTRACT(MONTH FROM ""r"".""requested_at"")=""m"".""month"" AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020)) LEFT JOIN ""AcceptedRides"" AS ""ar"" ON (""r"".""ride_id""=""ar"".""ride_id"")) LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON (""m"".""month"">=""d"".""month"") GROUP BY ""m"".""month"" ORDER BY ""m"".""month"""
389,"WITH ""cte"" AS (SELECT 1 AS ""month"" UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) SELECT ""cte"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""cte"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")='2019' THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE ""join_date""<='2020-12-31') AS ""d"" ON ""cte"".""month"">=""d"".""month"") LEFT JOIN (SELECT ""ride_id"",""requested_at"" FROM ""Rides"" WHERE ""requested_at"" BETWEEN '2020-01-01' AND '2020-12-31') AS ""r"" ON ""cte"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"")) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY 1"
390,"WITH RECURSIVE ""tmp"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""tmp"" WHERE ""month""<12) SELECT ""a"".""month"",COUNT(""driver_id"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""tmp"" AS ""a"" LEFT JOIN ""drivers"" AS ""b"" ON (EXTRACT(YEAR FROM ""join_date"")=2020 AND EXTRACT(MONTH FROM ""join_date"")<=""month"") OR EXTRACT(YEAR FROM ""join_date"")<2020) LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""a"" JOIN ""acceptedrides"" AS ""b"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) AS ""c"" ON ""a"".""month""=""c"".""month"" GROUP BY 1 ORDER BY 1"
391,"WITH ""d1"" AS (SELECT CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"",COUNT(""driver_id"") AS ""driver_count"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY 1), ""d2"" AS (WITH RECURSIVE ""se"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""se"" WHERE ""month""<12) SELECT * FROM ""se""), ""d3"" AS (SELECT EXTRACT(MONTH FROM ""r"".""requested_at"") AS ""month"",COUNT(""a"".""ride_id"") AS ""accepted_rides"" FROM ""Rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020 GROUP BY 1) SELECT ""d2"".""month"",SUM(COALESCE(""d1"".""driver_count"", 0)) OVER (ORDER BY ""month"") AS ""active_drivers"",COALESCE(""d3"".""accepted_rides"", 0) AS ""accepted_rides"" FROM (""d2"" LEFT JOIN ""d1"" ON ""d2"".""month""=""d1"".""month"") LEFT JOIN ""d3"" ON ""d2"".""month""=""d3"".""month"" ORDER BY 1"
392,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""ar"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""drivers"" AS ""d"" ON (""m"".""month"">=EXTRACT(MONTH FROM ""d"".""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020) OR EXTRACT(YEAR FROM ""d"".""join_date"")<2020) LEFT JOIN ""rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020) LEFT JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" GROUP BY ""month"""
393,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
394,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
395,"WITH RECURSIVE ""monthtab"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""monthtab"" WHERE ""month""<12) SELECT ""monthtab"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (""monthtab"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""monthtab"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""monthtab"".""month""=""rides"".""month"" GROUP BY ""monthtab"".""month"" ORDER BY ""monthtab"".""month"""
396,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 AS ""month"" FROM ""months"" WHERE ""month""<12), ""all_yr_m"" AS (SELECT TO_CHAR(STR_TO_DATE(CONCAT(""yt"".""join_year"", '-', ""a"".""month""), '%Y-%m'), 'YYYY-%m') AS ""yr_month"" FROM (SELECT DISTINCT EXTRACT(YEAR FROM ""join_date"") AS ""join_year"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""yt"" JOIN ""months"" AS ""a"" WHERE TO_CHAR(STR_TO_DATE(CONCAT(""yt"".""join_year"", '-', ""a"".""month""), '%Y-%m'), 'YYYY-%m')>=(SELECT MIN(TO_CHAR(""join_date"", 'YYYY-%m')) FROM ""Drivers"") AND ""yt"".""join_year""<=2020), ""num_drivers"" AS (SELECT ""c"".""yr_month"",SUM(COALESCE(COUNT(DISTINCT ""d"".""driver_id""), 0)) OVER (ORDER BY ""c"".""yr_month"") AS ""active_drivers"" FROM (SELECT TO_CHAR(""join_date"", 'YYYY-%m') AS ""yr_month"",""driver_id"" FROM ""Drivers"") AS ""d"" RIGHT JOIN ""all_yr_m"" AS ""c"" USING (""yr_month"") GROUP BY 1), ""acc_rides"" AS (SELECT ""a"".""month"",""n"".""ride_id"" FROM ""months"" AS ""a"" LEFT JOIN (SELECT ""x"".""ride_id"",EXTRACT(MONTH FROM ""y"".""requested_at"") AS ""req_month"" FROM ""AcceptedRides"" AS ""x"" LEFT JOIN ""Rides"" AS ""y"" USING (""ride_id"") WHERE EXTRACT(YEAR FROM ""y"".""requested_at"")=2020) AS ""n"" ON ""a"".""month""=""n"".""req_month"") SELECT ""ar"".""month"",COALESCE(""ad"".""active_drivers"", 0) AS ""active_drivers"",""ar"".""accepted_rides"" FROM (SELECT EXTRACT(MONTH FROM STR_TO_DATE(""yr_month"", '%Y-%m')) AS ""join_month"",""active_drivers"" FROM ""num_drivers"" WHERE EXTRACT(YEAR FROM STR_TO_DATE(""yr_month"", '%Y-%m'))=2020) AS ""ad"" RIGHT JOIN (SELECT ""month"",COUNT(DISTINCT ""ride_id"") AS ""accepted_rides"" FROM ""acc_rides"" GROUP BY ""month"") AS ""ar"" ON ""ad"".""join_month""=""ar"".""month"""
397,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
398,"WITH RECURSIVE ""full_month"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""full_month"" WHERE ""month""<12), ""newdrivers_permonth"" AS (SELECT (CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"",COUNT(""driver_id"") AS ""count_driver_month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020 GROUP BY 1), ""drivers_fullmonth"" AS (SELECT ""month"",COALESCE(""count_driver_month"", 0) AS ""driver_month"" FROM ""full_month"" LEFT JOIN ""newdrivers_permonth"" USING (""month"") ORDER BY 1), ""month_active_drivers"" AS (SELECT ""month"",SUM(""driver_month"") OVER (ORDER BY ""month"") AS ""active_drivers"" FROM ""drivers_fullmonth""), ""month_accepted_rides"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(1) AS ""accepted_rides"" FROM ""rides"" JOIN ""AcceptedRides"" USING (""ride_id"") WHERE LEFT(""requested_at"", 4)='2020' GROUP BY 1 ORDER BY 1) SELECT ""month"",""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM ""month_active_drivers"" LEFT JOIN ""month_accepted_rides"" USING (""month"") ORDER BY ""month"""
399,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
400,"WITH RECURSIVE ""monthcount"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 AS ""month"" FROM ""monthcount"" WHERE ""month""<12) SELECT ""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""a"".""ride_id"") AS ""accepted_rides"" FROM ((""monthcount"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON (EXTRACT(YEAR FROM ""d"".""join_date"")<2020) OR (""m"".""month"">=EXTRACT(MONTH FROM ""join_date"") AND EXTRACT(YEAR FROM ""d"".""join_date"")=2020)) LEFT JOIN ""Rides"" AS ""r"" ON (""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020)) LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""a"".""ride_id""=""r"".""ride_id"" GROUP BY 1"
401,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""t1"" AS (SELECT *,CASE WHEN EXTRACT(YEAR FROM ""join_date"")<2020 THEN 1 ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""month"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""t2"" AS (SELECT ""month"",COUNT(""driver_id"") AS ""cnt"" FROM ""t1"" GROUP BY ""month"") SELECT ""cte"".""month"",SUM(COALESCE(""cnt"", 0)) OVER (ORDER BY ""month"") AS ""active_drivers"",COALESCE(""accepted_rides"", 0) AS ""accepted_rides"" FROM (""cte"" LEFT JOIN ""t2"" USING (""month"")) LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",COUNT(""ar"".""ride_id"") AS ""accepted_rides"" FROM ""rides"" AS ""r"" JOIN ""acceptedrides"" AS ""ar"" ON ""r"".""ride_id""=""ar"".""ride_id"" WHERE EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY EXTRACT(MONTH FROM ""requested_at"")) AS ""t3"" ON ""cte"".""month""=""t3"".""month"""
402,"WITH RECURSIVE ""cte"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""cte"" WHERE ""month""<12), ""drive"" AS (SELECT ""driver_id"",CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END AS ""months"" FROM ""drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020), ""accept"" AS (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""m"",""a"".""ride_id"" AS ""acc"" FROM ""rides"" AS ""r"" LEFT JOIN ""AcceptedRides"" AS ""a"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) SELECT ""c"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""acc"") AS ""accepted_rides"" FROM (""cte"" AS ""c"" LEFT JOIN ""drive"" AS ""d"" ON ""d"".""months""<=""c"".""month"") LEFT JOIN ""accept"" AS ""a"" ON ""a"".""m""=""c"".""month"" GROUP BY ""c"".""month"" ORDER BY ""c"".""month"""
403,"WITH RECURSIVE ""months"" AS (SELECT 1 AS ""month"" UNION ALL SELECT ""month""+1 FROM ""months"" WHERE ""month""<12) SELECT ""m"".""month"",COUNT(DISTINCT ""d"".""driver_id"") AS ""active_drivers"",COALESCE(COUNT(DISTINCT ""r"".""ride_id""), 0) AS ""accepted_rides"" FROM (""months"" AS ""m"" LEFT JOIN ""Drivers"" AS ""d"" ON LAST_DAY(STR_TO_DATE(CONCAT(2020, ""m"".""month""), '%Y%m'))>=""d"".""join_date"") LEFT JOIN ""Rides"" AS ""r"" ON ""m"".""month""=EXTRACT(MONTH FROM ""r"".""requested_at"") AND ""r"".""ride_id"" IN (SELECT ""ride_id"" FROM ""AcceptedRides"") AND EXTRACT(YEAR FROM ""r"".""requested_at"")=2020 GROUP BY ""m"".""month"""
404,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
405,"SELECT ""t"".""month"",COUNT(DISTINCT ""driver_id"") AS ""active_drivers"",COUNT(DISTINCT ""rides"".""ride_id"") AS ""accepted_rides"" FROM (((SELECT 1 AS ""month"") UNION (SELECT 2 AS ""month"") UNION (SELECT 3 AS ""month"") UNION (SELECT 4 AS ""month"") UNION (SELECT 5 AS ""month"") UNION (SELECT 6 AS ""month"") UNION (SELECT 7 AS ""month"") UNION (SELECT 8 AS ""month"") UNION (SELECT 9 AS ""month"") UNION (SELECT 10 AS ""month"") UNION (SELECT 11 AS ""month"") UNION (SELECT 12 AS ""month"")) AS ""t"" LEFT JOIN (SELECT ""driver_id"",(CASE WHEN EXTRACT(YEAR FROM ""join_date"")=2019 THEN '1' ELSE EXTRACT(MONTH FROM ""join_date"") END) AS ""month"" FROM ""Drivers"" WHERE EXTRACT(YEAR FROM ""join_date"")<=2020) AS ""d"" ON ""d"".""month""<=""t"".""month"") LEFT JOIN (SELECT EXTRACT(MONTH FROM ""requested_at"") AS ""month"",""a"".""ride_id"" FROM ""AcceptedRides"" AS ""a"" JOIN ""Rides"" AS ""r"" ON ""r"".""ride_id""=""a"".""ride_id"" WHERE EXTRACT(YEAR FROM ""requested_at"")=2020) AS ""rides"" ON ""t"".""month""=""rides"".""month"" GROUP BY ""t"".""month"" ORDER BY ""t"".""month"""
