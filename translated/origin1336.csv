id,original query
1,"WITH RECURSIVE ""cte2"" (""n"") AS (SELECT 0 UNION ALL SELECT ""n""+1 FROM ""cte2"" WHERE ""n""<(SELECT COUNT(1) FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY 1 DESC LIMIT 1)) SELECT ""cte2"".""n"" AS ""transactions_count"",COALESCE(""v_count"", 0) AS ""visits_count"" FROM ""cte2"" LEFT JOIN (SELECT COALESCE(""TCOUNT"", 0) AS ""TRAN_COUNT"",COUNT(1) AS ""v_count"" FROM ""Visits"" AS ""vi"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""TCOUNT"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""tc"" ON ""vi"".""user_id""=""tc"".""user_id"" AND ""vi"".""visit_date""=""tc"".""transaction_date"" GROUP BY COALESCE(""TCOUNT"", 0)) AS ""ABC"" ON ""cte2"".""n""=""ABC"".""TRAN_COUNT"""
2,"WITH ""trans_cts"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""amount"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""visit_cts"" AS (SELECT ""transaction_count"",COUNT(1) AS ""visits_count"" FROM ""trans_cts"" GROUP BY 1), ""all_counts"" AS (WITH RECURSIVE ""CTE"" (""ct"") AS (SELECT 0 UNION ALL SELECT ""ct""+1 FROM ""CTE"" WHERE ""ct""<(SELECT MAX(""transaction_count"") FROM ""trans_cts"")) SELECT * FROM ""CTE"") SELECT ""c"".""ct"" AS ""transactions_count"",COALESCE(""v"".""visits_count"", 0) AS ""visits_count"" FROM ""all_counts"" AS ""c"" LEFT JOIN ""visit_cts"" AS ""v"" ON ""c"".""ct""=""v"".""transaction_count"""
3,"WITH ""X"" AS (SELECT ""user_id"",""transaction_date"",COUNT(""amount"") AS ""transactions_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date""), ""Y"" AS (SELECT ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""X"" GROUP BY ""transactions_count"" UNION SELECT 0 AS ""transactions_count"",(SELECT COUNT(1) AS ""visits_count"" FROM ""Visits"")-(SELECT COUNT(1) FROM (SELECT DISTINCT ""user_id"",""transaction_date"" FROM ""Transactions"") AS ""t"") AS ""visits_count""), ""N"" AS (SELECT 0 AS ""n"" UNION SELECT ROW_NUMBER() OVER () AS ""n"" FROM ""Transactions"") SELECT ""n"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""N"" LEFT JOIN ""Y"" ON ""N"".""n""=""Y"".""transactions_count"" WHERE ""N"".""n""<=(SELECT MAX(""transactions_count"") FROM ""Y"")"
4,"SELECT ""c"".""counts"" AS ""transactions_count"",COUNT(""a"".""transactions_count"") AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN (SELECT COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""a"" ON ""c"".""counts""=""a"".""transactions_count"" GROUP BY ""c"".""counts"" ORDER BY ""c"".""counts"""
5,"WITH RECURSIVE ""t_count"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""t_count"" WHERE ""transactions_count""<(SELECT COUNT(""amount"") FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY 1 DESC LIMIT 1)), ""cnt"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""transactions_count"",1 AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""t"".""transactions_count"",COUNT(""c"".""user_id"") AS ""visits_count"" FROM ""t_count"" AS ""t"" LEFT JOIN ""cnt"" AS ""c"" ON ""t"".""transactions_count""=""c"".""transactions_count"" GROUP BY 1 ORDER BY 1"
6,"WITH RECURSIVE ""cte"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""cte2"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""cte2"" WHERE ""transactions_count""+1<=(SELECT MAX(""transactions_count"") FROM ""cte"")) SELECT ""c2"".""transactions_count"",COUNT(""c"".""visit_date"") AS ""visits_count"" FROM ""cte2"" AS ""c2"" LEFT JOIN ""cte"" AS ""c"" ON ""c2"".""transactions_count""=""c"".""transactions_count"" GROUP BY 1"
7,"WITH ""num_trans"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(""amount"") AS ""num_trans"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date""), ""nums"" AS (SELECT ""num"" AS ""num_trans"" FROM (SELECT 0 AS ""num"" UNION SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""Transactions"") AS ""a"" WHERE ""num""<=(SELECT MAX(""num_trans"") FROM ""num_trans"")) SELECT ""a"".""num_trans"" AS ""transactions_count"",COUNT(""b"".""user_id"") AS ""visits_count"" FROM ""nums"" AS ""a"" LEFT JOIN ""num_trans"" AS ""b"" ON ""a"".""num_trans""=""b"".""num_trans"" GROUP BY ""a"".""num_trans"""
8,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
9,"WITH RECURSIVE ""a"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""trans_counts"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""b"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""b"" WHERE ""transactions_count""<(SELECT MAX(""trans_counts"") FROM ""a"")) SELECT ""transactions_count"",COUNT(""a"".""trans_counts"") AS ""visits_count"" FROM ""b"" LEFT JOIN ""a"" ON ""b"".""transactions_count""=""a"".""trans_counts"" GROUP BY ""transactions_count"""
10,"WITH RECURSIVE ""a"" AS (SELECT ""a"".""user_id"",""visit_date"",COUNT(""b"".""user_id"") AS ""cnt"" FROM ""visits"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY 1,2), ""r"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT 1+""transactions_count"" FROM ""r"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM ""a"")) SELECT ""r"".""transactions_count"",COUNT(""cnt"") AS ""visits_count"" FROM ""r"" LEFT JOIN ""a"" ON ""r"".""transactions_count""=""a"".""cnt"" GROUP BY 1"
11,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON (""t2"".""user_id""=""t1"".""user_id"" AND ""t2"".""transaction_date""=""t1"".""visit_date"") GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""transactions_count""), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""t2"".""visits_count"" IS NULL THEN 0 ELSE ""t2"".""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t2"".""transactions_count""=""t1"".""transactions_count"""
12,"SELECT ""t"".""COUNTS"" AS ""TRANSACTIONS_COUNT"",COALESCE(""c"".""COUNT_NUM"", 0) AS ""VISITS_COUNT"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""t"" LEFT JOIN (SELECT COALESCE(""NUM_TRANSACTIONS"", 0) AS ""NUM_TRANSACTIONS"",COUNT(1) AS ""COUNT_NUM"" FROM (SELECT ""a"".""NUM_TRANSACTIONS"" FROM ""VISITS"" AS ""v"" LEFT JOIN (SELECT ""USER_ID"",""TRANSACTION_DATE"" AS ""VISIT_DATE"",COUNT(""AMOUNT"") AS ""NUM_TRANSACTIONS"" FROM ""TRANSACTIONS"" GROUP BY ""USER_ID"",""TRANSACTION_DATE"") AS ""a"" ON ""v"".""USER_ID""=""a"".""USER_ID"" AND ""v"".""VISIT_DATE""=""a"".""VISIT_DATE"") AS ""b"" GROUP BY ""NUM_TRANSACTIONS"") AS ""c"" ON ""t"".""counts""=""c"".""NUM_TRANSACTIONS"" ORDER BY ""t"".""COUNTS"""
13,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(DISTINCT ""v"".""user_id"") AS ""visits_count"",SUM(CASE WHEN ""t"".""user_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trans_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_Date"" GROUP BY 1,2) SELECT ""row_num"" AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""trans_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""trans_count"") FROM ""T1"") ORDER BY ""row_num"""
14,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
15,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"""
16,"WITH RECURSIVE ""transcnt"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 AS ""cnt"" FROM ""transcnt"" WHERE ""cnt""<(SELECT COUNT(""user_id"") AS ""cnt"" FROM ""Transactions"" GROUP BY ""transaction_date"",""user_id"" ORDER BY ""cnt"" DESC LIMIT 1)) SELECT ""tcnt"".""cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""transcnt"" AS ""tcnt"" LEFT JOIN (SELECT ""visits"".""visit_date"",""visits"".""user_id"",COALESCE(COUNT(""trans"".""transaction_date""), 0) AS ""trans_count"" FROM ""Visits"" AS ""visits"" LEFT JOIN ""Transactions"" AS ""trans"" ON ""visits"".""visit_date""=""trans"".""transaction_date"" AND ""visits"".""user_id""=""trans"".""user_id"" GROUP BY ""visits"".""visit_date"",""visits"".""user_id"") AS ""datetrans"" ON ""tcnt"".""cnt""=""datetrans"".""trans_count"" GROUP BY ""tcnt"".""cnt"""
17,"WITH ""T1"" AS ((SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") AS ""transactions_count"" FROM ""Transactions"") UNION (SELECT 0 AS ""transactions_count"")), ""T2"" AS (SELECT COALESCE(MAX(""txn_cnt""), 0) AS ""max_txn_cnt"" FROM (SELECT COUNT(1) AS ""txn_cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""Transactions_1""), ""T3"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""Visits"".""user_id"",""Visits"".""visit_date"",COALESCE(""Transactions_1"".""transactions_count"", 0) AS ""transactions_count"" FROM ""Visits"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""Transactions_1"" ON ""Visits"".""user_id""=""Transactions_1"".""user_id"" AND ""Visits"".""visit_date""=""Transactions_1"".""transaction_date"") AS ""Visits_1"" GROUP BY ""transactions_count"") SELECT ""T4"".""transactions_count"",COALESCE(""T3"".""visits_count"", 0) AS ""visits_count"" FROM (SELECT * FROM (""T1"") CROSS JOIN ""T2"" WHERE ""T1"".""transactions_count""<=""T2"".""max_txn_cnt"") AS ""T4"" LEFT JOIN ""T3"" ON ""T4"".""transactions_count""=""T3"".""transactions_count"" ORDER BY ""T4"".""transactions_count"""
18,"WITH RECURSIVE ""txn_count"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""a"" GROUP BY ""transactions_count""), ""number"" (""n"") AS (SELECT 0 UNION ALL SELECT ""n""+1 FROM ""number"" WHERE ""n""<(SELECT MAX(""transactions_count"") FROM ""txn_count"")) SELECT ""number"".""n"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""number"" LEFT JOIN ""txn_count"" AS ""t"" ON ""number"".""n""=""t"".""transactions_count"" ORDER BY 1"
19,"WITH ""visit"" AS (SELECT ""user_id"",""visit_date"",0 AS ""txn"" FROM ""visits""), ""trans"" AS (SELECT ""user_id"",""transaction_date"" AS ""t_date"",1 AS ""txn"" FROM ""transactions""), ""all_trx"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",SUM(""a"".""txn""+COALESCE(""b"".""txn"", 0)) AS ""txn"" FROM ""visit"" AS ""a"" LEFT JOIN ""trans"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""t_date"" GROUP BY 1,2), ""g_trx"" AS (SELECT ""txn"",COUNT(""user_id"") AS ""cnt"" FROM ""all_trx"" GROUP BY 1) SELECT ""a"".""txn"" AS ""transactions_count"",COALESCE(""b"".""cnt"", 0) AS ""visits_count"" FROM (WITH RECURSIVE ""d_trx"" AS (SELECT 0 AS ""txn"",0 AS ""cnt"" UNION ALL SELECT ""txn""+1 AS ""txn"",0 AS ""cnt"" FROM ""d_trx"" WHERE ""txn""<(SELECT MAX(""txn"") FROM ""g_trx"")) SELECT * FROM ""d_trx"") AS ""a"" LEFT JOIN ""g_trx"" AS ""b"" ON ""a"".""txn""=""b"".""txn"" ORDER BY 1"
20,"WITH RECURSIVE ""cnt_all"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cnt_all"" WHERE ""transactions_count""<(SELECT COUNT(1) FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY COUNT(1) DESC LIMIT 1)), ""cnt"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""t1"".""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""cnt_all"" AS ""t1"" LEFT JOIN (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""cnt"" GROUP BY ""transactions_count"") AS ""t2"" USING (""transactions_count"")"
21,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""cnt"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""row_nums"" LEFT JOIN ""t"" ON ""cnt""=""rn"" WHERE ""rn""<=(SELECT MAX(""cnt"") FROM ""t"") GROUP BY 1 ORDER BY 1"
22,"WITH RECURSIVE ""rfn"" AS (SELECT 0 AS ""rid"" UNION ALL SELECT ""rid""+1 FROM ""rfn"" WHERE ""rid""+1<=100), ""c"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""tr_ct"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""c1"" AS (SELECT ""tr_ct"",COUNT(DISTINCT ""user_id"", ""visit_date"") AS ""vct"" FROM ""c"" GROUP BY ""tr_ct"") SELECT ""rfn"".""rid"" AS ""transactions_count"",COALESCE(""c1"".""vct"", 0) AS ""visits_count"" FROM ""rfn"" LEFT JOIN ""c1"" ON ""c1"".""tr_ct""=""rfn"".""rid"" WHERE ""rfn"".""rid""<=(SELECT MAX(""tr_ct"") AS ""xtr_ct"" FROM ""c1"" WHERE ""vct"">0)"
23,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON (""t2"".""user_id""=""t1"".""user_id"" AND ""t2"".""transaction_date""=""t1"".""visit_date"") GROUP BY ""t1"".""user_id"",""t1"".""visit_date"") AS ""t"" GROUP BY ""transactions_count""), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""t2"".""visits_count"" IS NULL THEN 0 ELSE ""t2"".""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t2"".""transactions_count""=""t1"".""transactions_count"" ORDER BY ""t1"".""transactions_count"""
24,"WITH RECURSIVE ""transactions_count"" AS (SELECT 0 AS ""t_count"" UNION ALL SELECT ""t_count""+1 FROM ""transactions_count"" WHERE ""t_count""<(SELECT MAX(""trans_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(DISTINCT ""v"".""visit_date"") AS ""visit_count"",COUNT(""t"".""transaction_date"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""x"")), ""visits_count"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""t_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""tc"".""t_count"" AS ""transactions_count"",COUNT(""vc"".""user_id"") AS ""visits_count"" FROM ""transactions_count"" AS ""tc"" LEFT JOIN ""visits_count"" AS ""vc"" ON ""tc"".""t_count""=""vc"".""t_count"" GROUP BY 1"
25,"WITH RECURSIVE ""cte"" AS (SELECT ""cnt"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""v"".""user_id"" AS ""user_id"",COUNT(""t"".""user_id"") AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""tab"" GROUP BY ""transactions_count""), ""cte1"" AS (SELECT DISTINCT 0 AS ""transactions_count"",0 AS ""visits_count"" FROM ""cte"" UNION ALL SELECT ""transactions_count""+1,0 AS ""visits_count"" FROM ""cte1"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""cte"")) SELECT ""c1"".""transactions_count"" AS ""transactions_count"",COALESCE(""c"".""visits_count"", ""c1"".""visits_count"") AS ""visits_count"" FROM ""cte1"" AS ""c1"" LEFT JOIN ""cte"" AS ""c"" ON ""c1"".""transactions_count""=""c"".""transactions_count"" ORDER BY ""c1"".""transactions_count"""
26,"SELECT ""a"".""transactions_count"",COUNT(""b"".""user_id"") AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"") AS ""transactions_count"" FROM ""transactions"" UNION ALL SELECT 0) AS ""a"" LEFT JOIN (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""b"" ON ""a"".""transactions_count""=""b"".""transactions_count"" GROUP BY 1 ORDER BY 1"
27,"SELECT ""c"".""counts"" AS ""transactions_count"",COUNT(""a"".""transactions_count"") AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN (SELECT COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""a"" ON ""c"".""counts""=""a"".""transactions_count"" GROUP BY ""c"".""counts"" ORDER BY ""transactions_count"""
28,"WITH RECURSIVE ""cte"" AS (SELECT ""v"".""user_id"",SUM(CASE WHEN ""visit_date""=""transaction_date"" THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cte2"" WHERE ""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte"")) SELECT ""cte2"".""cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte2"" LEFT JOIN ""cte"" ON ""cnt""=""transactions_count"" GROUP BY ""cnt"""
29,"WITH RECURSIVE ""trans_ct_per_visit"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""seq"" (""transactions_count"") AS (SELECT 0 UNION ALL SELECT ""transactions_count""+1 FROM ""seq"" WHERE ""transactions_count""+1<=(SELECT MAX(""transactions_count"") FROM ""trans_ct_per_visit"")) SELECT ""s"".""transactions_count"",SUM(""user_id"" IS NOT NULL) AS ""visits_count"" FROM ""trans_ct_per_visit"" AS ""t"" RIGHT JOIN ""seq"" AS ""s"" ON ""t"".""transactions_count""=""s"".""transactions_count"" GROUP BY ""s"".""transactions_count"" ORDER BY ""s"".""transactions_count"""
30,"WITH ""trans_count_by_user"" AS (SELECT ""t"".""user_id"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" AS ""t"" GROUP BY ""t"".""user_id"",""t"".""transaction_date""), ""result"" AS (SELECT ""tr"".""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""trans_count_by_user"" AS ""tr"" GROUP BY ""tr"".""transactions_count""), ""cte_spine"" AS (WITH RECURSIVE ""counter"" (""n"") AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""counter"" WHERE ""n""+1<=(SELECT MAX(""tr"".""transactions_count"") FROM ""trans_count_by_user"" AS ""tr"")) SELECT * FROM ""counter""), ""zero"" AS (SELECT COUNT(1) FROM (SELECT ""v"".""user_id"",""t"".""transaction_date"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"") AS ""a"" WHERE ""a"".""transaction_date"" IS NULL) SELECT ""c"".""n"" AS ""transactions_count"",CASE WHEN ""c"".""n""=0 THEN (SELECT * FROM ""zero"") WHEN ""c"".""n""!=0 AND ""c"".""n"" NOT IN (SELECT ""r"".""transactions_count"" FROM ""result"" AS ""r"") THEN 0 ELSE (SELECT ""r"".""visits_count"" FROM ""result"" AS ""r"" WHERE ""r"".""transactions_count""=""c"".""n"") END AS ""visits_count"" FROM ""cte_spine"" AS ""c"""
31,"WITH RECURSIVE ""tbl1"" AS (SELECT 0 AS ""transaction_counts"" UNION ALL SELECT ""transaction_counts""+1 FROM ""tbl1"" WHERE ""transaction_counts""<(SELECT MAX(""t"".""c"") FROM (SELECT COUNT(1) AS ""c"" FROM ""Transactions"" AS ""t1"" GROUP BY ""t1"".""user_id"",""t1"".""transaction_date"") AS ""t"")), ""tbl2"" AS (SELECT COALESCE(""t"".""c"", 0) AS ""transaction_counts"",COUNT(1) AS ""visit_counts"" FROM ""Visits"" AS ""v"" LEFT JOIN (SELECT ""Transactions"".""user_id"",""Transactions"".""transaction_date"",COUNT(1) AS ""c"" FROM ""Transactions"" GROUP BY ""Transactions"".""user_id"",""Transactions"".""transaction_date"") AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""transaction_counts"" ORDER BY ""transaction_counts"") SELECT ""tbl1"".""transaction_counts"" AS ""transactions_count"",COALESCE(""tbl2"".""visit_counts"", 0) AS ""visits_count"" FROM ""tbl1"" LEFT JOIN ""tbl2"" USING (""transaction_counts"") ORDER BY ""transaction_counts"""
32,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"""
33,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_cnt"" UNION SELECT 1+""transactions_cnt"" FROM ""cte"" WHERE ""transactions_cnt""<(SELECT MAX(""transactions_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2 ORDER BY 3) AS ""a"")) SELECT ""cte"".""transactions_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""a"" ON ""cte"".""transactions_cnt""=""a"".""transactions_cnt"" GROUP BY 1 ORDER BY 1"
34,"WITH ""a"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(""amount"", 0) AS ""am"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""t"".""user_id""=""v"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date""), ""b"" AS (SELECT ""ct"" AS ""transactions_count"",COUNT(""ct"") AS ""visits_count"" FROM (SELECT ""user_id"",""visit_date"",SUM(CASE WHEN ""am""=0 THEN 0 ELSE 1 END) AS ""ct"" FROM ""a"" GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""ct""), ""c"" AS (SELECT ROW_NUMBER() OVER ()-1 AS ""rn"" FROM (SELECT ""user_id"" FROM ""Visits"" UNION ALL SELECT ""user_id"" FROM ""Transactions"") AS ""t3"") SELECT ""rn"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM (SELECT ""rn"" FROM ""c"" WHERE ""rn""<=(SELECT MAX(""transactions_count"") FROM ""b"")) AS ""t1"" LEFT JOIN ""b"" ON ""b"".""transactions_count""=""t1"".""rn"""
35,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
36,"WITH ""tab"" AS (SELECT ""v"".""visit_date"",""v"".""user_id"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""v"".""visit_date"",""v"".""user_id""), ""cte_recur"" AS (WITH RECURSIVE ""tmp"" AS (SELECT 0 AS ""trans_cnt"" UNION ALL SELECT ""trans_cnt""+1 AS ""trans_cnt"" FROM ""tmp"" WHERE ""trans_cnt""<(SELECT MAX(""transactions_count"") FROM ""tab"")) SELECT * FROM ""tmp"") SELECT ""cte_recur"".""trans_cnt"" AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""tab"" RIGHT JOIN ""cte_recur"" ON ""tab"".""transactions_count""=""cte_recur"".""trans_cnt"" GROUP BY ""cte_recur"".""trans_cnt"" ORDER BY ""cte_recur"".""trans_cnt"""
37,"WITH ""u_d_t"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""ctd"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""t_d"" AS (SELECT ""user_id"",""visit_date"",SUM(""ctd"") AS ""ct"" FROM ""u_d_t"" GROUP BY ""user_id"",""visit_Date""), ""rn"" AS (SELECT ROW_NUMBER() OVER () AS ""ro"" FROM ""transactions"" UNION SELECT 0) SELECT ""rn"".""ro"" AS ""transactions_count"",COUNT(""t_d"".""ct"") AS ""visits_count"" FROM ""t_d"" RIGHT JOIN ""rn"" ON ""t_d"".""ct""=""rn"".""ro"" WHERE ""rn"".""ro""<=(SELECT MAX(""ct"") FROM ""t_d"") GROUP BY 1 ORDER BY 1"
38,"WITH RECURSIVE ""valid_trans_counts"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""valid_trans_counts"" WHERE (""transactions_count""+1)<=(SELECT MAX(""transactions_count"") FROM (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2) AS ""x"")), ""trs"" AS (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2), ""trs_per_visit"" AS (SELECT ""v"".""visit_date"",""v"".""user_id"",COALESCE(""t"".""transactions_count"", 0) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""trs"" AS ""t"" ON ""t"".""transaction_date""=""v"".""visit_date"" AND ""v"".""user_id""=""t"".""user_id""), ""t"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""trs_per_visit"" GROUP BY 1) SELECT ""vtc"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""valid_trans_counts"" AS ""vtc"" LEFT JOIN ""t"" ON ""t"".""transactions_count""=""vtc"".""transactions_count"""
39,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""row_n"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""cnt"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""row_n"" LEFT JOIN ""t"" ON ""cnt""=""rn"" WHERE ""rn""<=(SELECT MAX(""cnt"") FROM ""t"") GROUP BY 1 ORDER BY 1"
40,"WITH ""tbl"" AS (SELECT COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""seq"" AS (SELECT ""transactions_count"" FROM (SELECT 0 AS ""transactions_count"" UNION SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""Transactions"") AS ""t"" WHERE ""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""tbl"")) SELECT ""seq"".""transactions_count"",COUNT(""tbl"".""transactions_count"") AS ""visits_count"" FROM ""seq"" LEFT JOIN ""tbl"" ON ""seq"".""transactions_count""=""tbl"".""transactions_count"" GROUP BY ""seq"".""transactions_count"" ORDER BY ""seq"".""transactions_count"""
41,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""ct_day"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""cte2"" AS (WITH RECURSIVE ""seq"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""seq"" WHERE ""transactions_count""<(SELECT MAX(""ct_day"") FROM ""cte1"")) SELECT * FROM ""seq"") SELECT ""c2"".""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""cte2"" AS ""c2"" LEFT JOIN ""cte1"" AS ""c1"" ON ""c2"".""transactions_count""=""c1"".""ct_day"" GROUP BY 1"
42,"WITH ""num_trans"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(""amount"") AS ""num_trans"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date""), ""nums"" AS (SELECT ""num"" AS ""num_trans"" FROM (SELECT 0 AS ""num"" UNION SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""Transactions"") AS ""a"" WHERE ""num""<=(SELECT MAX(""num_trans"") FROM ""num_trans"")) SELECT ""a"".""num_trans"" AS ""transactions_count"",COUNT(""b"".""user_id"") AS ""visits_count"" FROM ""nums"" AS ""a"" LEFT JOIN ""num_trans"" AS ""b"" ON ""a"".""num_trans""=""b"".""num_trans"" GROUP BY ""a"".""num_trans"""
43,"WITH RECURSIVE ""vt"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",""t"".""amount"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""vt_2"" AS (SELECT ""user_id"",""visit_date"",COALESCE(""amount"", 0) AS ""amount"",COUNT(1) OVER (PARTITION BY ""user_id"", ""visit_date"") AS ""trans_count"" FROM ""vt""), ""vt_3"" AS (SELECT DISTINCT ""user_id"",""visit_date"",CASE WHEN ""amount""=0 THEN 0 ELSE ""trans_count"" END AS ""transactions_count"" FROM ""vt_2""), ""ct"" (""trans_count"") AS (SELECT 0 UNION ALL SELECT ""trans_count""+1 FROM ""ct"" WHERE ""trans_count""<(SELECT MAX(""transactions_count"") FROM ""vt_3"")) SELECT ""ct"".""trans_count"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""vt_3"" GROUP BY ""transactions_count"" ORDER BY 1) AS ""vt_4"" RIGHT JOIN ""ct"" ON ""ct"".""trans_count""=""vt_4"".""transactions_count"""
44,"WITH RECURSIVE ""trs"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT 1+""transactions_count"" FROM ""trs"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(""transaction_date"") AS ""cnt"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t"")) SELECT ""trs"".""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""trs"" LEFT JOIN (SELECT ""v"".""user_id"",COALESCE(COUNT(""tr"".""transaction_date""), 0) AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""tr"" ON ""v"".""user_id""=""tr"".""user_id"" AND ""v"".""visit_date""=""tr"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""c"" ON ""trs"".""transactions_count""=""c"".""cnt"" GROUP BY ""trs"".""transactions_count"" ORDER BY ""trs"".""transactions_count"""
45,"WITH RECURSIVE ""transactions_count"" AS (SELECT 0 AS ""t_count"" UNION ALL SELECT ""t_count""+1 FROM ""transactions_count"" WHERE ""t_count""<(SELECT MAX(""trans_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(DISTINCT ""v"".""visit_date"") AS ""visit_count"",COUNT(""t"".""transaction_date"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""x"")), ""visits_count"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""t_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""tc"".""t_count"" AS ""transactions_count"",COUNT(""vc"".""user_id"") AS ""visits_count"" FROM ""transactions_count"" AS ""tc"" LEFT JOIN ""visits_count"" AS ""vc"" ON ""tc"".""t_count""=""vc"".""t_count"" GROUP BY 1"
46,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",""t2"".""transaction_date"" FROM ""visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON (""t2"".""user_id""=""t1"".""user_id"" AND ""t2"".""transaction_date""=""t1"".""visit_date"")) AS ""t"" GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""transactions_count""), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""t2"".""visits_count"" IS NULL THEN 0 ELSE ""t2"".""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t2"".""transactions_count""=""t1"".""transactions_count"""
47,"WITH RECURSIVE ""num_transactions"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT 1+""transactions_count"" FROM ""num_transactions"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2) AS ""t"")), ""transactions_count"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""visits_count"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""transactions_count"" GROUP BY 1) SELECT ""n"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""num_transactions"" AS ""n"" LEFT JOIN ""visits_count"" AS ""t"" ON ""n"".""transactions_count""=""t"".""transactions_count"""
48,"WITH ""cte1"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""v1"".""user_id"",""t1"".""transaction_date"",SUM(CASE WHEN ""t1"".""amount"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""v1"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""v1"".""user_id""=""t1"".""user_id"" AND ""v1"".""visit_date""=""t1"".""transaction_date"" GROUP BY ""v1"".""user_id"",""v1"".""visit_date"") AS ""temp"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte1"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte1"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte1"" ON ""cte3"".""transactions_count""=""cte1"".""transactions_count"""
49,"SELECT ""c"".""counts"" AS ""transactions_count"",COUNT(""a"".""transactions_count"") AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN (SELECT COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""a"" ON ""c"".""counts""=""a"".""transactions_count"" GROUP BY ""c"".""counts"" ORDER BY ""transactions_count"""
50,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY 1,2), ""cte1"" AS (SELECT 0 AS ""rownum"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""rownum"" FROM ""transactions"") SELECT ""rownum"" AS ""transactions_count"",COUNT(""transactions_count"") AS ""visits_count"" FROM ""cte"" RIGHT JOIN ""cte1"" ON ""transactions_count""=""rownum"" WHERE ""rownum""<=(SELECT MAX(""transactions_count"") FROM ""cte"") GROUP BY 1 ORDER BY 1"
51,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",""t2"".""transaction_date"" FROM ""visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON (""t2"".""user_id""=""t1"".""user_id"" AND ""t2"".""transaction_date""=""t1"".""visit_date"")) AS ""t"" GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""transactions_count""), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" FROM ""counts"" UNION SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""t2"".""visits_count"" IS NULL THEN 0 ELSE ""t2"".""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t2"".""transactions_count""=""t1"".""transactions_count"" ORDER BY ""t1"".""transactions_count"""
52,"WITH RECURSIVE ""tmpcnt"" AS (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COALESCE(""t2"".""cnt_trans"", 0) AS ""cnt_trans"" FROM ""visits"" AS ""t1"" LEFT JOIN (SELECT ""t"".""user_id"",""t"".""transaction_date"",COUNT(1) AS ""cnt_trans"" FROM ""transactions"" AS ""t"" GROUP BY ""t"".""user_id"",""t"".""transaction_date"") AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" AND ""t1"".""visit_date""=""t2"".""transaction_date""), ""tmpagg"" AS (SELECT ""t"".""cnt_trans"",COUNT(1) AS ""cnt_visit"" FROM ""tmpcnt"" AS ""t"" GROUP BY ""t"".""cnt_trans""), ""cte"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cte"" WHERE ""cnt""<(SELECT MAX(""cnt_trans"") FROM ""tmpagg"")) SELECT ""t"".""cnt"" AS ""transactions_count"",COALESCE(""a"".""cnt_visit"", 0) AS ""visits_count"" FROM ""cte"" AS ""t"" LEFT JOIN ""tmpagg"" AS ""a"" ON ""t"".""cnt""=""a"".""cnt_trans"" ORDER BY 1"
53,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",COUNT(""t"".""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""row_nums"".""rn"" AS ""transactions_count"",COUNT(""t"".""transaction_count"") AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
54,"WITH ""transactions_table"" AS (SELECT ""num_transactions"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""num_transactions"" FROM (SELECT ""Visits"".""user_id"",""visit_date"",""transaction_date"" FROM ""Visits"" LEFT JOIN ""Transactions"" ON ""Visits"".""user_id""=""Transactions"".""user_id"" AND ""Visits"".""visit_date""=""Transactions"".""transaction_date"") AS ""t1"" GROUP BY ""user_id"",""visit_date"") AS ""t2"" GROUP BY ""transactions_count""), ""transaction_counts"" AS (SELECT * FROM (SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""Transactions"" UNION ALL SELECT 0) AS ""t3"" WHERE ""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""transactions_table"")) SELECT ""transaction_counts"".""transactions_count"",COALESCE(""transactions_table"".""visits_count"", 0) AS ""visits_count"" FROM ""transaction_counts"" LEFT JOIN ""transactions_table"" ON ""transaction_counts"".""transactions_count""=""transactions_table"".""transactions_count"" ORDER BY ""transactions_count"""
55,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""transactions_count"" FROM ""Visits"" AS ""t1"" LEFT JOIN ""Transactions"" AS ""t2"" ON (""t1"".""user_id""=""t2"".""user_id"" AND ""t1"".""visit_date""=""t2"".""transaction_date"") GROUP BY 1,2) AS ""tmp"" GROUP BY 1), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""t2"".""visits_count"" IS NULL THEN 0 ELSE ""t2"".""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t1"".""transactions_count""=""t2"".""transactions_count"""
56,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""cte"" WHERE ""transactions_count""<(SELECT MAX(""transactions"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(""transaction_date"") AS ""transactions"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""a"")), ""base"" AS (SELECT ""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""countbase"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",""t"".""transaction_date"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"") AS ""a"" GROUP BY ""user_id"",""visit_date"") SELECT ""a"".""transactions_count"",COALESCE(COUNT(""b"".""countbase""), 0) AS ""visits_count"" FROM ""base"" AS ""b"" RIGHT JOIN ""cte"" AS ""a"" ON ""a"".""transactions_count""=""b"".""countbase"" GROUP BY ""a"".""transactions_count"""
57,"WITH RECURSIVE ""dummy"" AS (SELECT 0 AS ""num"" UNION ALL SELECT ""num""+1 AS ""num"" FROM ""dummy"" WHERE ""num""+1<=(SELECT MAX(""temp"") FROM (SELECT COUNT(1) AS ""temp"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""A"")), ""cte"" AS (SELECT ""no_of_t"",COUNT(1) AS ""no_of_visits"" FROM (SELECT ""Visits"".""visit_date"",""Visits"".""user_id"",COUNT(""transaction_date"") AS ""no_of_t"" FROM ""Visits"" LEFT JOIN ""Transactions"" ON ""Visits"".""user_id""=""Transactions"".""user_id"" AND ""Visits"".""visit_date""=""Transactions"".""transaction_date"" GROUP BY ""Visits"".""visit_date"",""Visits"".""user_id"") AS ""A"" GROUP BY ""no_of_t"") SELECT ""dummy"".""num"" AS ""transactions_count"",COALESCE(""no_of_visits"", 0) AS ""visits_count"" FROM ""dummy"" LEFT JOIN ""cte"" ON ""dummy"".""num""=""cte"".""no_of_t"" ORDER BY 1"
58,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions"",COUNT(1) AS ""visits_count"" FROM (SELECT ""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",""t2"".""transaction_date"" FROM ""visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON (""t2"".""user_id""=""t1"".""user_id"" AND ""t2"".""transaction_date""=""t1"".""visit_date"")) AS ""t"" GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""transactions""), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" FROM ""counts"" UNION SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""visits_count"" IS NULL THEN 0 ELSE ""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t2"".""transactions""=""t1"".""transactions_count"""
59,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"" ORDER BY 1), ""cte1"" AS (SELECT 0 AS ""rownum"" UNION SELECT ROW_NUMBER() OVER () AS ""rownum"" FROM ""transactions"") SELECT ""rownum"" AS ""transactions_count"",COUNT(""transactions_count"") AS ""visits_count"" FROM ""cte"" RIGHT JOIN ""cte1"" ON ""transactions_count""=""rownum"" WHERE ""rownum""<=(SELECT MAX(""transactions_count"") FROM ""cte"") GROUP BY 1 ORDER BY 1"
60,"WITH ""cte"" AS (SELECT ""a"".""user_id"",""visit_date"",SUM(CASE WHEN ""b"".""user_id"" IS NULL OR ""b"".""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""visit_date""), ""cte1"" AS (SELECT 0 AS ""row_num"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"") SELECT ""a"".""row_num"" AS ""transactions_count"",COUNT(""b"".""transactions_count"") AS ""visits_count"" FROM ""cte1"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""row_num""=""b"".""transactions_count"" WHERE ""a"".""row_num""<=(SELECT MAX(""transactions_count"") FROM ""cte"") GROUP BY ""a"".""row_num"""
61,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""cte"" WHERE ""n""<(SELECT MAX(""a"".""transaction_count"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transaction_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""a"")), ""transaction_counts"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transaction_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date""), ""zero_visit_counts"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"" AS ""transaction_date"",0 AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" WHERE ""t"".""transaction_date"" IS NULL), ""max_transactions"" AS (SELECT MAX(""transaction_count"") AS ""max_transaction_count"" FROM ""transaction_counts""), ""altogether"" AS (SELECT ""user_id"",""transaction_date"",""transaction_count"" FROM ""transaction_counts"" UNION SELECT ""user_id"",""transaction_date"",""transaction_count"" FROM ""zero_visit_counts""), ""second_altogether"" AS (SELECT ""transaction_count"",COUNT(1) AS ""visits_count"" FROM ""altogether"" GROUP BY ""transaction_count"" UNION SELECT ""n"" AS ""transaction_count"",0 AS ""visits_count"" FROM ""cte"") SELECT ""transaction_count"" AS ""transactions_count"",MAX(""visits_count"") AS ""visits_count"" FROM ""second_altogether"" GROUP BY ""transaction_count"" ORDER BY ""transaction_count"""
62,"WITH RECURSIVE ""t1"" AS (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""t_cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""t2"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""t2"" WHERE ""cnt""<(SELECT MAX(""t_cnt"") FROM ""t1"")) SELECT ""t2"".""cnt"" AS ""transactions_count"",COALESCE(COUNT(""t1"".""user_id""), 0) AS ""visits_count"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t1"".""t_cnt""=""t2"".""cnt"" GROUP BY 1 ORDER BY 1"
63,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",""t2"".""transaction_date"" FROM ""visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON (""t2"".""user_id""=""t1"".""user_id"" AND ""t2"".""transaction_date""=""t1"".""visit_date"")) AS ""t"" GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""transactions_count""), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""t2"".""visits_count"" IS NULL THEN 0 ELSE ""t2"".""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t2"".""transactions_count""=""t1"".""transactions_count"""
64,"WITH ""CTE"" AS (SELECT DISTINCT ""V1"".""user_id"",""visit_date"",COUNT(""transaction_date"") OVER (PARTITION BY ""V1"".""user_id"", ""visit_date"") AS ""transactions_count"" FROM ""Visits"" AS ""V1"" LEFT JOIN ""Transactions"" AS ""T1"" ON ""V1"".""user_id""=""T1"".""user_id"" AND ""V1"".""visit_date""=""T1"".""transaction_date""), ""FREQ"" AS (SELECT ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""CTE"" GROUP BY ""transactions_count""), ""CNTSEQ"" AS (WITH RECURSIVE ""CNT"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""CNT"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""FREQ"")) SELECT * FROM ""CNT"") SELECT ""CNTSEQ"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""CNTSEQ"" LEFT JOIN ""FREQ"" ON ""CNTSEQ"".""transactions_count""=""FREQ"".""transactions_count"""
65,"WITH ""T1"" AS ((SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") AS ""transactions_count"" FROM ""Transactions"") UNION (SELECT 0 AS ""transactions_count"")), ""T2"" AS (SELECT COALESCE(MAX(""txn_cnt""), 0) AS ""max_txn_cnt"" FROM (SELECT COUNT(1) AS ""txn_cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""Transactions_1""), ""T3"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""Visits"".""user_id"",""Visits"".""visit_date"",COALESCE(""Transactions_1"".""transactions_count"", 0) AS ""transactions_count"" FROM ""Visits"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""Transactions_1"" ON ""Visits"".""user_id""=""Transactions_1"".""user_id"" AND ""Visits"".""visit_date""=""Transactions_1"".""transaction_date"") AS ""Visits_1"" GROUP BY ""transactions_count"") SELECT ""T4"".""transactions_count"",COALESCE(""T3"".""visits_count"", 0) AS ""visits_count"" FROM (SELECT * FROM (""T1"") CROSS JOIN ""T2"" WHERE ""T1"".""transactions_count""<=""T2"".""max_txn_cnt"") AS ""T4"" LEFT JOIN ""T3"" ON ""T4"".""transactions_count""=""T3"".""transactions_count"" ORDER BY ""T4"".""transactions_count"""
66,"WITH RECURSIVE ""visit_transactions"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",CASE WHEN ""t"".""amount"" IS NULL THEN 0 ELSE 1 END AS ""indicator"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""transactions_per_visit"" AS (SELECT SUM(""indicator"") AS ""transactions_count"" FROM ""visit_transactions"" GROUP BY ""user_id"",""visit_date""), ""transactions_histogram"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""transactions_per_visit"" GROUP BY ""transactions_count""), ""no_gaps"" AS ((SELECT 0 AS ""transactions_count"") UNION ALL (SELECT 1+""transactions_count"" FROM ""no_gaps"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""transactions_histogram""))) SELECT ""ng"".""transactions_count"" AS ""transactions_count"",COALESCE(""h"".""visits_count"", 0) AS ""visits_count"" FROM ""no_gaps"" AS ""ng"" LEFT JOIN ""transactions_histogram"" AS ""h"" ON ""ng"".""transactions_count""=""h"".""transactions_count"""
67,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
68,"WITH ""cte_joined"" AS (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""Ntransactions"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON (""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"") GROUP BY ""v"".""user_id"",""visit_date""), ""cte_spine"" AS (WITH RECURSIVE ""counter"" AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""counter"" WHERE ""n""<(SELECT MAX(""Ntransactions"") FROM ""cte_joined"")) SELECT * FROM ""counter""), ""cte_summary"" AS (SELECT ""Ntransactions"",COUNT(1) AS ""Nvisits"" FROM ""cte_joined"" GROUP BY ""Ntransactions"") SELECT ""n"" AS ""transactions_count"",COALESCE(""Nvisits"", 0) AS ""visits_count"" FROM ""cte_spine"" LEFT JOIN ""cte_summary"" ON (""cte_spine"".""n""=""cte_summary"".""Ntransactions"")"
69,"WITH ""transactions_with_rank"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"") AS ""transactions_count"" FROM ""transactions""), ""unique_transactions_count"" AS (SELECT DISTINCT ""transactions_count"" FROM ""transactions_with_rank"" UNION ALL SELECT 0 AS ""transactions_count"" ORDER BY 1), ""visits_transactions"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""visits_count"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""visits_transactions"" GROUP BY 1) SELECT ""u"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""unique_transactions_count"" AS ""u"" LEFT JOIN ""visits_count"" AS ""v"" USING (""transactions_count"")"
70,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""ranking"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ROW_NUMBER() OVER () FROM ""Transactions"") SELECT ""r"".""transactions_count"",COALESCE(""sub"".""visits_count"", 0) AS ""visits_count"" FROM ""ranking"" AS ""r"" LEFT JOIN (SELECT ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""cte"" GROUP BY ""transactions_count"") AS ""sub"" USING (""transactions_count"") WHERE ""r"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""cte"") ORDER BY ""transactions_count"""
71,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions"" UNION ALL SELECT ""transactions""+1 FROM ""cte"" WHERE ""transactions""<(SELECT MAX(""transaction_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""t"".""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transaction_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""f"")) SELECT ""cte"".""transactions"" AS ""transactions_count"",COUNT(""f"".""user_id"") AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""t"".""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transaction_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""f"" ON ""cte"".""transactions""=""f"".""transaction_count"" GROUP BY 1"
72,"WITH ""t"" AS (SELECT ""Visits"".""user_id"",""visit_date"",""transaction_date"",COALESCE(""amount"", 0) AS ""amount"",ROW_NUMBER() OVER () AS ""rn"" FROM ""Visits"" LEFT JOIN ""Transactions"" ON ""Visits"".""user_id""=""Transactions"".""user_id"" AND ""visit_date""=""transaction_date""), ""t1"" AS (SELECT ""user_id"",COUNT(""amount"") AS ""ct"" FROM ""t"" WHERE ""amount"">0 GROUP BY ""user_id"",""visit_date""), ""t2"" AS (SELECT DISTINCT ""ct"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""t1"" GROUP BY ""ct""), ""t3"" AS (SELECT CASE WHEN ""rn"" NOT IN (SELECT ""transactions_count"" FROM ""t2"") THEN ""rn"" END AS ""transactions_count"",0 AS ""visits_count"" FROM ""t"") SELECT * FROM (SELECT 0 AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""t"" WHERE ""amount""=0 UNION SELECT DISTINCT ""ct"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""t1"" GROUP BY ""ct"" UNION SELECT * FROM ""t3"" WHERE ""transactions_count"" IS NOT NULL AND ""transactions_count""<=(SELECT MAX(""ct"") FROM ""t1"")) AS ""result"" ORDER BY ""transactions_count"""
73,"WITH RECURSIVE ""cte1"" (""n"") AS (SELECT 1 UNION ALL SELECT ""n""+1 FROM ""cte1"" WHERE ""n""<200), ""cte2"" AS (SELECT DISTINCT ""user_id"",""transaction_date"",COUNT(""amount"") OVER (PARTITION BY ""user_id"", ""transaction_date"") AS ""n_transactions"" FROM ""Transactions""), ""cte3"" AS (SELECT ""n_transactions"",COUNT(""user_id"") AS ""visits_counts"" FROM ""cte2"" GROUP BY ""n_transactions""), ""cte4"" AS (SELECT 0 AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""T"".""user_id"" FROM ""Visits"" AS ""V"" LEFT JOIN ""Transactions"" AS ""T"" ON ""V"".""user_id""=""T"".""user_id"" AND ""V"".""visit_date""=""T"".""transaction_date"" WHERE ""T"".""user_id"" IS NULL) AS ""z"") SELECT ""n"" AS ""transactions_count"",COALESCE(""visits_counts"", 0) AS ""visits_count"" FROM ""cte1"" LEFT JOIN ""cte3"" ON ""cte1"".""n""=""cte3"".""n_transactions"" WHERE ""n""<=(SELECT MAX(""n_transactions"") AS ""x"" FROM ""cte3"") UNION ALL SELECT * FROM ""cte4"" ORDER BY ""transactions_count"""
74,"WITH ""vt"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""t"".""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""v"".""user_id"",""visit_date""), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",COUNT(""vt"".""transaction_count"") AS ""visits_count"" FROM ""vt"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""vt"") GROUP BY ""rn"" ORDER BY ""rn"""
75,"WITH RECURSIVE ""t1"" AS (SELECT ""v"".*,SUM(CASE WHEN ""t"".""amount"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""t2"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""t2"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""t1"")) SELECT ""t2"".""transactions_count"",COALESCE(""t"".""visits_count"", 0) AS ""visits_count"" FROM ""t2"" LEFT JOIN (SELECT ""transactions_count"",COUNT(DISTINCT ""user_id"", ""visit_date"") AS ""visits_count"" FROM ""t1"" GROUP BY ""transactions_count"") AS ""t"" ON ""t2"".""transactions_count""=""t"".""transactions_count"""
76,"WITH ""TxnCount"" AS (SELECT ""V"".""user_id"",""V"".""visit_date"",COUNT(""T"".""transaction_date"") AS ""transactions_count"" FROM ""Visits"" AS ""V"" LEFT JOIN ""Transactions"" AS ""T"" ON ""T"".""user_id""=""V"".""user_id"" AND ""T"".""transaction_date""=""V"".""visit_date"" GROUP BY ""V"".""user_id"",""V"".""visit_date""), ""ALLTxnCount"" AS (WITH RECURSIVE ""AllTxns"" AS (SELECT MAX(""transactions_count"") AS ""Num"" FROM ""TxnCount"" UNION ALL SELECT ""Num""-1 AS ""Num"" FROM ""AllTxns"" WHERE ""Num"">0) SELECT ""Num"" FROM ""AllTxns""), ""TxnAnalysis"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""TxnCount"" GROUP BY ""transactions_count"") SELECT ""ATC"".""Num"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""ALLTxnCount"" AS ""ATC"" LEFT JOIN ""TxnAnalysis"" AS ""TA"" ON ""TA"".""transactions_count""=""ATC"".""Num"" ORDER BY 1"
77,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""row_nums"" LEFT JOIN ""t"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY 1 ORDER BY 1"
78,"SELECT ""c"".""counts"" AS ""transactions_count"",COUNT(""a"".""transactions_count"") AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN (SELECT COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""a"" ON ""c"".""counts""=""a"".""transactions_count"" GROUP BY ""c"".""counts"" ORDER BY ""transactions_count"""
79,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",COUNT(""t"".""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""row_nums"".""rn"" AS ""transactions_count"",COUNT(""t"".""transaction_count"") AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
80,"WITH ""num_trans"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(""amount"") AS ""num_trans"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date""), ""nums"" AS (SELECT ""num"" AS ""num_trans"" FROM (SELECT 0 AS ""num"" UNION SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""Transactions"") AS ""a"" WHERE ""num""<=(SELECT MAX(""num_trans"") FROM ""num_trans"")) SELECT ""a"".""num_trans"" AS ""transactions_count"",COUNT(""b"".""user_id"") AS ""visits_count"" FROM ""nums"" AS ""a"" LEFT JOIN ""num_trans"" AS ""b"" ON ""a"".""num_trans""=""b"".""num_trans"" GROUP BY ""a"".""num_trans"""
81,"WITH RECURSIVE ""transactions_count"" AS (SELECT 0 AS ""t_count"" UNION ALL SELECT ""t_count""+1 FROM ""transactions_count"" WHERE ""t_count""<(SELECT MAX(""trans_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(DISTINCT ""v"".""visit_date"") AS ""visit_count"",COUNT(""t"".""transaction_date"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""x"")), ""visits_count"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""t_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""tc"".""t_count"" AS ""transactions_count"",COUNT(""vc"".""user_id"") AS ""visits_count"" FROM ""transactions_count"" AS ""tc"" LEFT JOIN ""visits_count"" AS ""vc"" ON ""tc"".""t_count""=""vc"".""t_count"" GROUP BY 1"
82,"WITH RECURSIVE ""valid_trans_counts"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""valid_trans_counts"" WHERE (""transactions_count""+1)<=(SELECT MAX(""transactions_count"") FROM (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2) AS ""x"")), ""trs"" AS (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2), ""max_num_tr"" AS (SELECT MAX(""transactions_count"") AS ""max_num_tr"" FROM ""trs""), ""trs_per_visit"" AS (SELECT ""v"".""visit_date"",""v"".""user_id"",COALESCE(""t"".""transactions_count"", 0) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""trs"" AS ""t"" ON ""t"".""transaction_date""=""v"".""visit_date"" AND ""v"".""user_id""=""t"".""user_id""), ""t"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""trs_per_visit"" GROUP BY 1) SELECT ""vtc"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""valid_trans_counts"" AS ""vtc"" LEFT JOIN ""t"" ON ""t"".""transactions_count""=""vtc"".""transactions_count"""
83,"WITH ""num_trans"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(""amount"") AS ""num_trans"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date""), ""nums"" AS (SELECT ""num"" AS ""num_trans"" FROM (SELECT 0 AS ""num"" UNION SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""Transactions"") AS ""a"" WHERE ""num""<=(SELECT MAX(""num_trans"") FROM ""num_trans"")) SELECT ""a"".""num_trans"" AS ""transactions_count"",COUNT(""b"".""user_id"") AS ""visits_count"" FROM ""nums"" AS ""a"" LEFT JOIN ""num_trans"" AS ""b"" ON ""a"".""num_trans""=""b"".""num_trans"" GROUP BY ""a"".""num_trans"""
84,"WITH RECURSIVE ""cte"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""v"".""visit_date""=""t"".""transaction_date"" THEN 1 ELSE 0 END) AS ""transactions_cnt"",COALESCE(COUNT(""v"".""user_id""), 0) AS ""visits_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""cte2"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""cte2"" WHERE ""transactions_count""<(SELECT MAX(""transactions_cnt"") FROM ""cte"")) SELECT ""c1"".""transactions_count"",COALESCE(COUNT(""c2"".""visits_count""), 0) AS ""visits_count"" FROM ""cte2"" AS ""c1"" LEFT JOIN ""cte"" AS ""c2"" ON ""c1"".""transactions_count""=""c2"".""transactions_cnt"" GROUP BY 1"
85,"WITH RECURSIVE ""trans_1_n"" (""trans_n"") AS (SELECT 0 AS ""trans_n"" UNION ALL SELECT ""trans_n""+1 AS ""trans_n"" FROM ""trans_1_n"" WHERE ""trans_n""<(SELECT MAX(""transaction_count"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transaction_count"" FROM ""transactions"" AS ""t"" GROUP BY 1,2) AS ""a"")), ""group_trans"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transaction_count"" FROM ""transactions"" AS ""t"" GROUP BY 1,2), ""group_visit"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(1) AS ""visit_count"" FROM ""visits"" AS ""v"" GROUP BY 1,2), ""both_g"" AS (SELECT COALESCE(""transaction_count"", 0) AS ""transaction_count"",COUNT(""gv"".""visit_count"") AS ""visits_count"" FROM ""group_visit"" AS ""gv"" LEFT JOIN ""group_trans"" AS ""gt"" ON ""gt"".""user_id""=""gv"".""user_id"" AND ""gv"".""visit_date""=""gt"".""transaction_date"" GROUP BY 1) SELECT ""t"".""trans_n"" AS ""transactions_count"",COALESCE(""gv"".""visits_count"", 0) AS ""visits_count"" FROM ""trans_1_n"" AS ""t"" LEFT JOIN ""both_g"" AS ""gv"" ON ""t"".""trans_n""=""gv"".""transaction_count"" ORDER BY 1"
86,"WITH RECURSIVE ""a"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""trans_counts"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""b"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""b"" WHERE ""transactions_count""<(SELECT MAX(""trans_counts"") FROM ""a"")) SELECT ""transactions_count"",COUNT(""a"".""trans_counts"") AS ""visits_count"" FROM ""b"" LEFT JOIN ""a"" ON ""b"".""transactions_count""=""a"".""trans_counts"" GROUP BY 1"
87,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"""
88,"WITH ""t1"" AS (SELECT ""ina"".""user_id"",""ina"".""visit_date"",COUNT(""amount"") AS ""n"" FROM ""Visits"" AS ""ina"" LEFT JOIN ""Transactions"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""user_id"" AND ""ina"".""visit_date""=""inb"".""transaction_date"" GROUP BY ""ina"".""user_id"",""ina"".""visit_date""), ""t2"" AS (SELECT ""n"",COUNT(1) AS ""visits_count"" FROM ""t1"" GROUP BY ""n""), ""t3"" AS (SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""Transactions"" UNION SELECT 0) SELECT ""t3"".""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""t3"" LEFT JOIN ""t2"" ON ""t3"".""transactions_count""=""t2"".""n"" WHERE ""t3"".""transactions_count""<=(SELECT MAX(""n"") FROM ""t2"") ORDER BY ""t3"".""transactions_count"""
89,"WITH ""cte"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transaction_num"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date""), ""trans"" AS (WITH RECURSIVE ""seq"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""seq"" WHERE ""transactions_count""<(SELECT MAX(""transaction_num"") FROM ""cte"")) SELECT * FROM ""seq""), ""t"" AS (SELECT 0 AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""v"".""user_id"" AS ""visitor_id"",""v"".""visit_date"",""t"".""user_id"",""t"".""transaction_date"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"") AS ""t"" WHERE ""user_id"" IS NULL UNION ALL SELECT ""transaction_num"" AS ""transactions_count"",COUNT(""transaction_num"") AS ""visits_count"" FROM ""cte"" GROUP BY ""transaction_num"") SELECT ""trans"".""transactions_count"",COALESCE(""t"".""visits_count"", 0) AS ""visits_count"" FROM ""t"" RIGHT JOIN ""trans"" ON ""t"".""transactions_count""=""trans"".""transactions_count"""
90,"WITH ""ct"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"" AS ""date"",SUM(CASE WHEN ""t"".""amount"" IS NULL THEN 0 ELSE 1 END) AS ""trans"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cnt"" AS (SELECT ""roww""-1 AS ""roww"" FROM (SELECT ROW_NUMBER() OVER (ORDER BY ""rowss"") AS ""roww"" FROM (SELECT ROW_NUMBER() OVER (ORDER BY ""visit_date"") AS ""rowss"" FROM ""Visits"" UNION ALL SELECT ROW_NUMBER() OVER (ORDER BY ""visit_date"") AS ""rowss"" FROM ""Visits"") AS ""aaa"") AS ""aaaa"" WHERE ""roww""-1<=(SELECT MAX(""trans"") FROM ""ct"")) SELECT ""cc"".""roww"" AS ""transactions_count"",COALESCE(""tt"".""visits_count"", 0) AS ""visits_count"" FROM ""cnt"" AS ""cc"" LEFT JOIN (SELECT ""trans"" AS ""transactions_count"",COUNT(""trans"") AS ""visits_count"" FROM ""ct"" GROUP BY ""trans"") AS ""tt"" ON ""cc"".""roww""=""tt"".""transactions_count"""
91,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""num"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""cte1"" AS (SELECT ""r"" FROM (SELECT ROW_NUMBER() OVER () AS ""r"" FROM ""transactions"") AS ""f"" WHERE ""r""<=(SELECT MAX(""num"") FROM ""cte"") UNION SELECT 0) SELECT ""cte1"".""r"" AS ""transactions_count"",COALESCE(""h"".""visits_count"", 0) AS ""visits_count"" FROM ""cte1"" LEFT JOIN (SELECT ""num"",COUNT(""num"") AS ""visits_count"" FROM ""cte"" GROUP BY 1) AS ""h"" ON ""cte1"".""r""=""h"".""num"" ORDER BY 1"
92,"WITH ""temp"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""c"".""counts"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""temp"" GROUP BY 1) AS ""a"" ON ""c"".""counts""=""a"".""transactions_count"" ORDER BY 1"
93,"WITH RECURSIVE ""cte1"" AS (SELECT ""transactions_count"",COUNT(""transactions_count"") AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_Id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""tmp"" GROUP BY ""transactions_count""), ""cte2"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cte2"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""cte1"")) SELECT ""cte2"".""transactions_count"",COALESCE(""cte1"".""visits_count"", 0) AS ""visits_count"" FROM ""cte2"" LEFT JOIN ""cte1"" ON ""cte2"".""transactions_count""=""cte1"".""transactions_count"" ORDER BY ""CTE2"".""transactions_count"""
94,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",COUNT(""t"".""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""row_nums"".""rn"" AS ""transactions_count"",COUNT(""t"".""transaction_count"") AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
95,"WITH RECURSIVE ""getTransactionCount"" AS (SELECT ""visit_date"",""Visits"".""user_id"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" LEFT JOIN ""Transactions"" ON ""Visits"".""user_id""=""Transactions"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY 1,2), ""missingId"" (""id"") AS (SELECT 0 UNION ALL SELECT ""id""+1 FROM ""missingId"" WHERE ""id""<(SELECT MAX(""transactions_count"") FROM ""getTransactionCount"")) SELECT ""id"" AS ""transactions_count"",SUM(CASE WHEN ""transactions_count"" IS NULL THEN 0 ELSE 1 END) AS ""visits_count"" FROM ""missingId"" LEFT JOIN ""getTransactionCount"" ON ""transactions_count""=""id"" GROUP BY 1 ORDER BY 1"
96,"WITH RECURSIVE ""t1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""i"" ON ""v"".""user_id""=""i"".""user_id"" AND ""v"".""visit_date""=""i"".""transaction_date"" GROUP BY 1,2), ""t2"" AS ((SELECT 0 AS ""transactions_count"") UNION ALL (SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""t2"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""t1""))) SELECT ""t2"".""transactions_count"",COUNT(""t1"".""transactions_count"") AS ""visits_count"" FROM ""t1"" RIGHT JOIN ""t2"" ON ""t2"".""transactions_count""=""t1"".""transactions_count"" GROUP BY 1"
97,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cte"" WHERE ""cnt""<(SELECT COUNT(1) FROM ""Transactions"")), ""temp"" AS (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""t"".""amount"" IS NULL THEN 0 ELSE 1 END) AS ""trans"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""cte"".""cnt"" AS ""transactions_count"",SUM(CASE WHEN ""temp"".""user_id"" IS NULL THEN 0 ELSE 1 END) AS ""visits_count"" FROM ""cte"" LEFT JOIN ""temp"" ON ""cte"".""cnt""=""temp"".""trans"" WHERE ""cte"".""cnt""<=(SELECT MAX(""trans"") FROM ""temp"") GROUP BY ""transactions_count"" ORDER BY ""transactions_count"""
98,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cte"" WHERE ""cnt""<(SELECT MAX(""tcnt"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""tcnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""f"")) SELECT ""cnt"" AS ""transactions_count"",COUNT(""tcnt"") AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""tcnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""f1"" RIGHT JOIN ""cte"" ON ""cte"".""cnt""=""f1"".""tcnt"" GROUP BY ""cnt"" ORDER BY ""cnt"""
99,"WITH ""tran"" AS (SELECT ""a"".""trans_count"" AS ""transactions_count"",COUNT(""a"".""visit_date"") AS ""visits_count"" FROM (SELECT ""v1"".""visit_date"",""v1"".""user_id"",SUM(CASE WHEN (""t1"".""amount"" IS NULL OR ""t1"".""amount""=0) THEN 0 ELSE 1 END) AS ""trans_count"" FROM ""Visits"" AS ""v1"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""v1"".""user_id""=""t1"".""user_id"" AND ""v1"".""visit_date""=""t1"".""transaction_date"" GROUP BY ""v1"".""visit_date"",""v1"".""user_id"") AS ""a"" GROUP BY ""a"".""trans_count"" ORDER BY ""a"".""trans_count""), ""num"" AS (SELECT 0 AS ""num"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""Transactions"") SELECT ""num"".""num"" AS ""transactions_count"",COALESCE(""tran"".""visits_count"", 0) AS ""visits_count"" FROM ""tran"" RIGHT JOIN ""num"" ON ""num"".""num""=""tran"".""transactions_count"" WHERE ""num"".""num""<=(SELECT MAX(""tran"".""transactions_count"") FROM ""tran"")"
100,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
101,"WITH RECURSIVE ""cnttable"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cnttable"" WHERE ""cnt""<(SELECT COUNT(""user_id"") FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY COUNT(""user_id"") DESC LIMIT 1)), ""trantable"" AS (SELECT ""v"".""user_id"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""c"".""cnt"" AS ""transactions_count"",COALESCE(COUNT(""v"".""transactions_count""), 0) AS ""visits_count"" FROM ""cnttable"" AS ""c"" LEFT JOIN ""trantable"" AS ""v"" ON ""c"".""cnt""=""v"".""transactions_count"" GROUP BY ""c"".""cnt"""
102,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
103,"WITH RECURSIVE ""table1"" AS (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""visit_tran"" AS (SELECT ""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""trans_count"" FROM ""table1"" GROUP BY ""visit_date"",""user_id""), ""cte"" AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""cte"" WHERE ""n""<(SELECT MAX(""trans_count"") FROM ""visit_tran"")) SELECT ""n"" AS ""transactions_count"",COUNT(""trans_count"") AS ""visits_count"" FROM ""cte"" LEFT JOIN ""visit_tran"" ON ""cte"".""n""=""visit_tran"".""trans_count"" GROUP BY ""transactions_count"""
104,"WITH ""trx"" AS ((SELECT ""v"".""visit_date"",SUM(CASE WHEN ""t"".""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"")), ""tcounts"" AS (SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""Transactions"" UNION SELECT 0 AS ""transactions_count"") SELECT ""s"".""transactions_count"",CASE WHEN ""x"".""visit_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""tcounts"" AS ""s"" LEFT JOIN ""trx"" AS ""x"" ON ""s"".""transactions_count""=""x"".""transactions_count"" WHERE ""s"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""trx"") GROUP BY ""transactions_count"" ORDER BY ""transactions_count"""
105,"WITH RECURSIVE ""fte"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""fte"" WHERE ""transactions_count""<(SELECT COUNT(""amount"") FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY COUNT(""amount"") DESC LIMIT 1)), ""cte"" AS (SELECT ""e"".*,CASE WHEN ""e"".""amount""=0 THEN 0 ELSE 1 END AS ""Count_val"" FROM (SELECT ""visits"".""user_id"",""visits"".""visit_date"" AS ""day"",COALESCE(""amount"", 0) AS ""amount"" FROM ""Visits"" LEFT JOIN ""Transactions"" ON ""Visits"".""user_id""=""Transactions"".""user_id"" AND ""Visits"".""visit_date""=""Transactions"".""transaction_date"" ORDER BY ""day"") AS ""e""), ""dte"" AS (SELECT ""user_id"",""day"",SUM(""Count_val"") AS ""Total"" FROM ""cte"" GROUP BY 1,2), ""ete"" AS (SELECT ""Total"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""dte"" GROUP BY ""total"") SELECT ""fte"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""fte"" LEFT JOIN ""ete"" ON ""fte"".""transactions_count""=""ete"".""transactions_count"" ORDER BY ""transactions_count"""
106,"WITH RECURSIVE ""cte"" AS (SELECT ""tot"" AS ""transactions_count"",COUNT(""tot"") AS ""visits_count"" FROM (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""tot"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""a"" GROUP BY ""tot"" UNION SELECT 0 AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""visits"" WHERE ROW(""user_id"",""visit_date"") NOT IN (SELECT ""user_id"",""transaction_date"" FROM ""transactions"")), ""number"" (""n"") AS (SELECT 0 UNION ALL SELECT ""n""+1 FROM ""number"" WHERE ""n""<(SELECT MAX(""transactions_count"") FROM ""cte"")) SELECT ""number"".""n"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""number"" LEFT JOIN ""cte"" ON ""number"".""n""=""cte"".""transactions_count"" ORDER BY ""transactions_count"""
107,"WITH RECURSIVE ""id_Ranges"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""id_Ranges"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ((SELECT ""ina"".""user_id"",""ina"".""visit_date"",SUM(CASE WHEN ""inb"".""amount"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""ina"" LEFT JOIN ""Transactions"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""user_id"" AND ""ina"".""visit_date""=""inb"".""transaction_date"" GROUP BY ""ina"".""user_id"",""ina"".""visit_date"")) AS ""inc"")) SELECT ""l"".""transactions_count"",COALESCE(""r"".""visits_count"", 0) AS ""visits_count"" FROM ""id_Ranges"" AS ""l"" LEFT JOIN (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""ina"".""user_id"",""ina"".""visit_date"",SUM(CASE WHEN ""inb"".""amount"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""ina"" LEFT JOIN ""Transactions"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""user_id"" AND ""ina"".""visit_date""=""inb"".""transaction_date"" GROUP BY ""ina"".""user_id"",""ina"".""visit_date"") AS ""t"" GROUP BY ""transactions_count"") AS ""r"" ON ""l"".""transactions_count""=""r"".""transactions_count"""
108,"WITH RECURSIVE ""cte"" AS (SELECT ""a"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY 1,2), ""cte2"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cte2"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") AS ""transactions_count"" FROM ""cte"")) SELECT ""a"".""transactions_count"",COALESCE(COUNT(""visit_date""), 0) AS ""visits_count"" FROM ""cte2"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""transactions_count""=""b"".""transactions_count"" GROUP BY 1"
109,"WITH ""cte"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",SUM(CASE WHEN ""b"".""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""cnt"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date""), ""gaps"" AS (WITH RECURSIVE ""cte_count"" (""n"") AS (SELECT 0 UNION ALL SELECT ""n""+1 FROM ""cte_count"" WHERE ""n""<(SELECT MAX(""cnt"") FROM ""cte"")) SELECT ""n"" AS ""transactions_count"" FROM ""cte_count"") SELECT ""b"".""transactions_count"",COUNT(""a"".""user_id"") AS ""visits_count"" FROM ""gaps"" AS ""b"" LEFT JOIN ""cte"" AS ""a"" ON ""b"".""transactions_count""=""a"".""cnt"" GROUP BY ""b"".""transactions_count"""
110,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""user_id"",""visit_date""), ""row_num"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",COUNT(""t"".""transactions_count"") AS ""visits_count"" FROM ""row_num"" AS ""r"" LEFT JOIN ""t"" ON ""transactions_count""=""rn"" WHERE ""r"".""rn""<=(SELECT MAX(""transactions_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY ""rn"""
111,"WITH RECURSIVE ""cte"" AS (SELECT COUNT(""user_id"") AS ""cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date""), ""cte1"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""cte1"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM ""cte"")), ""cte2"" AS (SELECT 0 AS ""transactions_count"",COUNT(""visit_id"") AS ""visits_count"" FROM (SELECT ""v"".""user_id"" AS ""visit_id"",""visit_date"",""T"".""user_id"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""T"" ON ""v"".""user_id""=""T"".""user_id"" AND ""v"".""visit_date""=""T"".""transaction_date"") AS ""temp"" WHERE ""user_id"" IS NULL), ""cte3"" AS (SELECT ""transactions_count"",""visits_count"" FROM ""cte2"" UNION SELECT ""cnt"" AS ""transactions_count"",COUNT(""cnt"") AS ""visits_count"" FROM (SELECT ""cnt"" FROM ""cte"") AS ""temp"" GROUP BY ""cnt"") SELECT ""cte1"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""cte1"" LEFT JOIN ""cte3"" ON ""cte1"".""transactions_count""=""cte3"".""transactions_count"""
112,"WITH ""a"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transactions_count"",(CASE WHEN ""t"".""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""visits"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""b"" AS (SELECT ""transactions_count"",COUNT(""visits"") AS ""visits_count"" FROM ""a"" GROUP BY ""transactions_count""), ""c"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""transactions"") SELECT ""c"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""c"" LEFT JOIN ""b"" ON ""c"".""transactions_count""=""b"".""transactions_count"" WHERE ""c"".""transactions_count""<=(SELECT MAX(""b"".""transactions_count"") FROM ""b"")"
113,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_cnt"" UNION SELECT 1+""transactions_cnt"" FROM ""cte"" WHERE ""transactions_cnt""<(SELECT MAX(""transactions_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2 ORDER BY 3) AS ""a"")) SELECT ""cte"".""transactions_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""a"" ON ""cte"".""transactions_cnt""=""a"".""transactions_cnt"" GROUP BY 1 ORDER BY 1"
114,"WITH ""a"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",CASE WHEN ""t"".""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""trans_cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""b"" AS (WITH RECURSIVE ""tmp"" AS (SELECT 0 AS ""trans_cnt"" UNION SELECT ""trans_cnt""+1 FROM ""tmp"" WHERE ""trans_cnt""<(SELECT MAX(""trans_cnt"") FROM ""a"")) SELECT * FROM ""tmp"") SELECT ""b"".""trans_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""b"" LEFT JOIN ""a"" ON ""a"".""trans_cnt""=""b"".""trans_cnt"" GROUP BY 1 ORDER BY 1"
115,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",COUNT(""t"".""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""row_nums"".""rn"" AS ""transactions_count"",COUNT(""t"".""transaction_count"") AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
116,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""row_nums"" LEFT JOIN ""t"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY 1 ORDER BY 1"
117,"WITH RECURSIVE ""A"" AS (SELECT * FROM ""TRANSACTIONS""), ""B"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""ct"" FROM ""A"" GROUP BY ""user_id"",""transaction_date""), ""C"" AS (SELECT ""Visits"".""user_id"",""Visits"".""visit_date"",COALESCE(""ct"", 0) AS ""ct"" FROM ""Visits"" LEFT JOIN ""B"" ON ""visits"".""user_id""=""B"".""user_id"" AND ""visits"".""visit_date""=""B"".""transaction_date""), ""D"" AS (SELECT ""ct"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""C"" GROUP BY ""transactions_count""), ""CTE"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT 1+""transactions_count"" FROM ""CTE"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""D"")) SELECT ""CTE"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""CTE"" LEFT JOIN ""D"" ON ""CTE"".""transactions_count""=""D"".""transactions_count"""
118,"WITH RECURSIVE ""t1"" AS (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""t_cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""t2"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""t2"" WHERE ""cnt""<(SELECT MAX(""t_cnt"") FROM ""t1"")) SELECT ""t2"".""cnt"" AS ""transactions_count"",COALESCE(COUNT(""t1"".""user_id""), 0) AS ""visits_count"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t1"".""t_cnt""=""t2"".""cnt"" GROUP BY 1 ORDER BY 1"
119,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"""
120,"WITH RECURSIVE ""a"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""b"" AS (SELECT ""transactions_count"",COUNT(""transactions_count"") AS ""visit_count"" FROM ""a"" GROUP BY 1), ""c"" AS (SELECT 0 AS ""transactions_count"",MAX(""transactions_count"") AS ""m"" FROM ""b"" UNION ALL SELECT ""transactions_count""+1,""m"" FROM ""c"" WHERE ""transactions_count""<""m"") SELECT ""c"".""transactions_count"",COALESCE(""b"".""visit_count"", 0) AS ""visits_count"" FROM ""c"" LEFT JOIN ""b"" ON ""c"".""transactions_count""=""b"".""transactions_count"""
121,"WITH ""t"" AS (SELECT CASE WHEN ""t"".""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""t1"" AS (SELECT ""cnt"",COUNT(1) AS ""v_cnt"" FROM ""t"" GROUP BY ""cnt""), ""t2"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""transactions"" UNION SELECT 0 AS ""rn"") SELECT ""t2"".""rn"" AS ""transactions_count"",COALESCE(""t1"".""v_cnt"", 0) AS ""visits_count"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t2"".""rn""=""t1"".""cnt"" WHERE ""t2"".""rn""<=(SELECT MAX(""cnt"") FROM ""t1"") ORDER BY ""t2"".""rn"""
122,"WITH ""CTE"" AS (SELECT ""V"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""CTE_RECUR"" AS (WITH RECURSIVE ""TEMP"" AS (SELECT 0 AS ""trans_cnt"" UNION ALL SELECT ""trans_cnt""+1 AS ""trans_cnt"" FROM ""TEMP"" WHERE ""trans_cnt""<(SELECT MAX(""transaction_count"") FROM ""CTE"")) SELECT * FROM ""TEMP"") SELECT ""trans_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""CTE_RECUR"" AS ""cr"" LEFT JOIN ""CTE"" AS ""c"" ON ""cr"".""trans_cnt""=""c"".""transaction_count"" GROUP BY 1 ORDER BY 1"
123,"WITH RECURSIVE ""tmp1"" AS (SELECT ""a"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""tran_cnt"" FROM ""visits"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY 1,2), ""tmp2"" AS (SELECT 0 AS ""tran_cnt"" UNION ALL SELECT ""tran_cnt""+1 AS ""tran_cnt"" FROM ""tmp2"" WHERE ""tran_cnt""<(SELECT MAX(""tran_cnt"") FROM ""tmp1"")) SELECT ""a"".""tran_cnt"" AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""tmp2"" AS ""a"" LEFT JOIN ""tmp1"" AS ""b"" ON ""a"".""tran_cnt""=""b"".""tran_cnt"" GROUP BY 1 ORDER BY 1"
124,"WITH RECURSIVE ""temp"" AS (SELECT MAX(""max_trans_ct"") AS ""max_trans_ct"" FROM (SELECT COUNT(1) AS ""max_trans_ct"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"" UNION SELECT 0 AS ""max_trans_ct"") AS ""sub""), ""cte"" AS (SELECT 0 AS ""trans"",""max_trans_ct"" FROM ""temp"" UNION ALL SELECT ""trans""+1,""max_trans_ct"" FROM ""cte"" WHERE ""trans""<""max_trans_ct"") SELECT ""trans"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""amount""), 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""sub"" ON ""cte"".""trans""=""sub"".""transactions_count"" GROUP BY ""cte"".""trans"" ORDER BY ""transactions_count"""
125,"WITH ""visits_cleaned"" AS (SELECT ""v"".*,CASE WHEN ""t"".""user_id"" IS NULL THEN 0 ELSE 1 END AS ""cleaned_user_id_flag"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""final_table"" AS (SELECT ""user_id"",""visit_date"",SUM(""cleaned_user_id_flag"") AS ""num_visits"" FROM ""visits_cleaned"" GROUP BY ""user_id"",""visit_date""), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",COUNT(""num_visits"") AS ""visits_count"" FROM ""final_table"" RIGHT JOIN ""row_nums"" AS ""b"" ON ""b"".""rn""=""final_table"".""num_visits"" WHERE ""rn""<=(SELECT MAX(""num_visits"") FROM ""final_table"") GROUP BY ""rn"" ORDER BY ""rn"""
126,"WITH RECURSIVE ""tb3"" AS (SELECT 0 AS ""rk"" UNION ALL SELECT ""rk""+1 AS ""rk"" FROM ""tb3"" WHERE ""rk""<(SELECT COUNT(""amount"") FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY COUNT(""amount"") DESC LIMIT 1)), ""cte"" AS (SELECT ""v"".""user_id"",""visit_date"",""amount"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""tb1"" AS (SELECT ""user_id"",""visit_date"",COUNT(""amount"") AS ""ct"" FROM ""cte"" GROUP BY ""user_id"",""visit_date""), ""tb2"" AS (SELECT ""ct"",COUNT(""user_id"") AS ""visits_count"" FROM ""tb1"" GROUP BY ""ct"") SELECT ""rk"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""tb3"" LEFT JOIN ""tb2"" ON ""tb3"".""rk""=""tb2"".""ct"" ORDER BY ""transactions_count"""
127,"WITH RECURSIVE ""t1"" AS (SELECT MAX(""cnt"") AS ""maxT"" FROM (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""cnt"" FROM ""transactions"" GROUP BY ""transaction_date"",""user_id"") AS ""tb1""), ""tranCnt"" AS (SELECT 0 AS ""n"" UNION SELECT ""n""+1 FROM ""tranCnt"" WHERE ""n""<(SELECT ""maxT"" FROM ""t1"")), ""t2"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""vCnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""tranCnt"".""n"" AS ""transactions_count"",COUNT(""t2"".""user_id"") AS ""visits_count"" FROM ""tranCnt"" LEFT JOIN ""t2"" ON ""tranCnt"".""n""=""t2"".""vCnt"" GROUP BY ""tranCnt"".""n"""
128,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cte"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM (SELECT ""user_id"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t"")) SELECT ""transactions_count"",COALESCE(""freq"", 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""cnt"",COUNT(1) AS ""freq"" FROM (SELECT ""v"".""visit_date"",""v"".""user_id"",SUM(CASE WHEN ""t"".""user_id"" IS NULL THEN 0 ELSE 1 END) AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""visit_date"",""v"".""user_id"") AS ""sub"" GROUP BY ""cnt"") AS ""sub_s"" ON ""cte"".""transactions_count""=""sub_s"".""cnt"""
129,"WITH RECURSIVE ""cte"" AS (SELECT COUNT(""transaction_date"") AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date""), ""cte1"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""cte1"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM ""cte"")) SELECT ""transactions_count"",COUNT(""cnt"") AS ""visits_count"" FROM ""cte1"" LEFT JOIN ""cte"" ON ""cte1"".""transactions_count""=""cte"".""cnt"" GROUP BY 1"
130,"WITH RECURSIVE ""sub"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""amount"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date""), ""sub1"" AS (SELECT @""num"":=0 AS ""transactions_count"" UNION SELECT CASE WHEN @""num""<(SELECT MAX(""transactions_count"") FROM ""sub"") THEN @""num"":=@""num""+1 ELSE @""num"" END AS ""transactions_count"" FROM ""sub1"") SELECT ""transactions_count"",COUNT(DISTINCT ""user_id"", ""visit_date"") AS ""visits_count"" FROM ""sub1"" LEFT JOIN ""sub"" USING (""transactions_count"") GROUP BY ""transactions_count"""
131,"WITH ""t"" AS (SELECT ""v"".*,COALESCE(COUNT(""amount""), 0) AS ""trans_cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""t1"" AS (SELECT ""trans_cnt"",COUNT(1) AS ""visit_cnt"" FROM ""t"" GROUP BY ""trans_cnt""), ""t3"" AS (WITH RECURSIVE ""t2"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""t2"" WHERE ""transactions_count""<(SELECT MAX(""trans_cnt"") FROM ""t1"")) SELECT * FROM ""t2"") SELECT ""t3"".*,COALESCE(""t1"".""visit_cnt"", 0) AS ""visits_count"" FROM ""t3"" LEFT JOIN ""t1"" ON ""t3"".""transactions_count""=""t1"".""trans_cnt"""
132,"WITH ""num_transactions_by_users_by_date"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""num_transactions"" FROM ""visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2 ORDER BY 1,2), ""num_transactions_by_date"" AS (SELECT ""user_id"",""visit_date"",SUM(""num_transactions"") AS ""num_transactions"" FROM ""num_transactions_by_users_by_date"" GROUP BY 1,2 ORDER BY 1,2), ""num_transactions"" AS (SELECT ROW_NUMBER() OVER () AS ""num_transactions"" FROM ""transactions"" UNION SELECT 0) SELECT ""nt"".""num_transactions"" AS ""transactions_count"",COUNT(""ntbd"".""num_transactions"") AS ""visits_count"" FROM ""num_transactions"" AS ""nt"" LEFT JOIN ""num_transactions_by_date"" AS ""ntbd"" ON ""nt"".""num_transactions""=""ntbd"".""num_transactions"" WHERE ""nt"".""num_transactions""<=(SELECT MAX(""num_transactions"") FROM ""num_transactions_by_date"") GROUP BY 1 ORDER BY 1"
133,"WITH RECURSIVE ""trans_cnt"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(""b"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY 1,2), ""cte"" AS (SELECT 0 AS ""cnt"" UNION SELECT ""cnt""+1 FROM ""cte"" WHERE ""cnt""<(SELECT MAX(""transactions_count"") FROM ""trans_cnt"")) SELECT ""cte"".""cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN ""trans_cnt"" AS ""a"" ON ""cte"".""cnt""=""a"".""transactions_count"" GROUP BY 1 ORDER BY 1"
134,"WITH RECURSIVE ""table1"" AS (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"",DENSE_RANK() OVER (PARTITION BY ""visit_date"") FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""visit_tran"" AS (SELECT ""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transaction_count"" FROM ""table1"" GROUP BY ""visit_date"",""user_id""), ""cte"" AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""cte"" WHERE ""n""<(SELECT MAX(""transaction_count"") FROM ""visit_tran"")) SELECT ""n"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""cte"" LEFT JOIN ""visit_tran"" ON ""cte"".""n""=""visit_tran"".""transaction_count"" GROUP BY ""transactions_count"""
135,"WITH RECURSIVE ""max_trans"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT 1+""transactions_count"" AS ""transactions_count"" FROM ""max_trans"" WHERE ""transactions_count""<(SELECT MAX(""tc"") FROM (SELECT ""tc"",COUNT(1) AS ""cnt"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""tc"" FROM ""transactions"" AS ""t"" RIGHT JOIN ""visits"" AS ""v"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""trans_counter"" GROUP BY 1) AS ""trans_counter2"")), ""total_visits"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""m"".""transactions_count"",COUNT(""t"".""visit_Date"") AS ""visits_count"" FROM ""max_trans"" AS ""m"" LEFT JOIN ""total_visits"" AS ""t"" ON ""m"".""transactions_count""=""t"".""trans_count"" GROUP BY 1"
136,"WITH RECURSIVE ""t"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""t"" WHERE ""transactions_count""+1<=(SELECT COUNT(""transaction_date"") FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY 1 DESC LIMIT 1)), ""t1"" AS (SELECT ""v"".""user_id"",COUNT(""tr"".""transaction_date"") AS ""cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""tr"" ON ""v"".""visit_date""=""tr"".""transaction_date"" AND ""v"".""user_id""=""tr"".""user_id"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""t"" LEFT JOIN ""t1"" ON ""t"".""transactions_count""=""t1"".""cnt"" GROUP BY 1"
137,"WITH ""t"" AS (SELECT COALESCE(""transactions_count"", 0) AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""Visits"" AS ""v"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" GROUP BY 1,2) AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""row_nums"".""rn"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""t"".""transactions_count""=""row_nums"".""rn"" WHERE ""row_nums"".""rn""<=(SELECT MAX(""transactions_count"") FROM ""t"") ORDER BY 1"
138,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"""
139,"WITH ""tem"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(""b"".""user_id"") AS ""transactions_count"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date"") SELECT ""a"".""transactions_count"",COALESCE(""b"".""visits_count"", 0) AS ""visits_count"" FROM (SELECT 0 AS ""transactions_count"" UNION SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""Transactions"") AS ""a"" LEFT JOIN (SELECT ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""tem"" GROUP BY ""transactions_count"") AS ""b"" ON ""a"".""transactions_count""=""b"".""transactions_count"" WHERE ""a"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""tem"")"
140,"WITH RECURSIVE ""max_trans"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT 1+""transactions_count"" AS ""transactions_count"" FROM ""max_trans"" WHERE ""transactions_count""<(SELECT MAX(""tc"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""tc"" FROM ""transactions"" AS ""t"" RIGHT JOIN ""visits"" AS ""v"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""trans_counter"")), ""total_visits"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""m"".""transactions_count"",COUNT(""t"".""visit_Date"") AS ""visits_count"" FROM ""max_trans"" AS ""m"" LEFT JOIN ""total_visits"" AS ""t"" ON ""m"".""transactions_count""=""t"".""trans_count"" GROUP BY 1"
141,"WITH ""total"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""t"".""amount"" IS NULL THEN 0 ELSE 1 END) AS ""n"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""t"".""user_id""=""v"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY 1,2), ""counts"" AS (WITH RECURSIVE ""num"" (""n"") AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""num"" WHERE ""n""<(SELECT MAX(""n"") FROM ""total"")) SELECT * FROM ""num"") SELECT ""c"".""n"" AS ""transactions_count"",SUM(CASE WHEN ""t"".""n"" IS NULL THEN 0 ELSE 1 END) AS ""visits_count"" FROM ""total"" AS ""t"" RIGHT JOIN ""counts"" AS ""c"" USING (""n"") GROUP BY 1"
142,"WITH RECURSIVE ""transaction_count"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 AS ""cnt"" FROM ""transaction_count"" WHERE ""cnt""<(SELECT MAX(""count_tran"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(""transaction_date"") AS ""count_tran"" FROM ""transactions"" GROUP BY 1,2) AS ""a"")), ""user_transaction"" AS (SELECT ""user_id"",""transaction_date"",COUNT(""transaction_date"") AS ""count_tran"" FROM ""transactions"" GROUP BY 1,2), ""user_visit_tran"" AS (SELECT COALESCE(""b"".""count_tran"", 0) AS ""transaction_count1"",COUNT(""a"".""user_id"") AS ""visits_count"" FROM ""visits"" AS ""a"" LEFT JOIN ""user_transaction"" AS ""b"" ON ""a"".""visit_date""=""b"".""transaction_date"" AND ""a"".""user_id""=""b"".""user_id"" GROUP BY 1) SELECT ""a"".""cnt"" AS ""transactions_count"",COALESCE(""b"".""visits_count"", 0) AS ""visits_count"" FROM ""transaction_count"" AS ""a"" LEFT JOIN ""user_visit_tran"" AS ""b"" ON ""a"".""cnt""=""b"".""transaction_count1"" ORDER BY 1"
143,"WITH RECURSIVE ""temp"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",""t"".""user_id"" AS ""trans_id"",""t"".""transaction_date"",CASE WHEN ""t"".""user_id"" IS NULL THEN 0 ELSE 1 END AS ""trans_ornot"",SUM(CASE WHEN ""t"".""user_id"" IS NULL THEN 0 ELSE 1 END) OVER (PARTITION BY ""v"".""user_id"", ""v"".""visit_date"") AS ""num_trans"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_Date""), ""t2"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""t2"" WHERE ""transactions_count""<(SELECT MAX(""num_trans"") FROM ""temp"")) SELECT ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""t2"" LEFT JOIN (SELECT ""num_trans"",COUNT(DISTINCT ""user_id"", ""visit_date"") AS ""visits_count"" FROM ""temp"" GROUP BY ""num_trans"") AS ""temp2"" ON ""t2"".""transactions_count""=""temp2"".""num_trans"""
144,"WITH ""t"" AS (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trxn_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",SUM(CASE WHEN ""trxn_count"" IS NOT NULL THEN 1 ELSE 0 END) AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" AS ""r"" ON ""t"".""trxn_count""=""r"".""rn"" WHERE ""r"".""rn""<=(SELECT MAX(""trxn_count"") FROM ""t"") GROUP BY 1 ORDER BY 1"
145,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_cnt"" UNION SELECT 1+""transactions_cnt"" FROM ""cte"" WHERE ""transactions_cnt""<(SELECT MAX(""transactions_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2 ORDER BY 3) AS ""a"")) SELECT ""cte"".""transactions_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""a"" ON ""cte"".""transactions_cnt""=""a"".""transactions_cnt"" GROUP BY 1 ORDER BY 1"
146,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""cte2"" AS (WITH RECURSIVE ""cte3"" AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 AS ""n"" FROM ""cte3"" WHERE ""n""<(SELECT MAX(""cnt"") FROM ""cte"")) SELECT * FROM ""cte3"") SELECT ""n"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""cte2"" LEFT JOIN (SELECT ""cnt"",COUNT(1) AS ""visits_count"" FROM (SELECT ""visit_date"",""user_id"",COUNT(""amount"") AS ""cnt"" FROM (SELECT ""a"".""user_id"",""a"".""visit_date"",""b"".""transaction_date"",""b"".""amount"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"") AS ""x"" GROUP BY 1,2) AS ""y"" GROUP BY 1) AS ""z"" ON ""cte2"".""n""=""z"".""cnt"""
147,"WITH ""rn_cte"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""transactions"" UNION SELECT 0), ""tx_cte"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transaction_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""rn"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""rn_cte"" LEFT JOIN ""tx_cte"" ON ""rn_cte"".""rn""=""tx_cte"".""transaction_count"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""tx_cte"") GROUP BY 1 ORDER BY 1"
148,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cte"" WHERE ""cnt""<(SELECT MAX(""tcnt"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""tcnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""f"")) SELECT ""cnt"" AS ""transactions_count"",COUNT(""tcnt"") AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""tcnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""f1"" RIGHT JOIN ""cte"" ON ""cte"".""cnt""=""f1"".""tcnt"" GROUP BY ""cnt"" ORDER BY ""cnt"""
149,"WITH ""t"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transaction_counts"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""rowcounts"" AS (SELECT 0 AS ""t_counts"" UNION SELECT ROW_NUMBER() OVER (ORDER BY ""user_id"") FROM ""transactions""), ""temp"" AS (SELECT ""transaction_counts"",COUNT(""user_id"") AS ""visits_counts"" FROM ""t"" GROUP BY ""transaction_counts"") SELECT ""rc"".""t_counts"" AS ""transactions_count"",CASE WHEN ""temp"".""visits_counts"" IS NOT NULL THEN ""temp"".""visits_counts"" ELSE 0 END AS ""visits_count"" FROM ""rowcounts"" AS ""rc"" LEFT JOIN ""temp"" ON ""rc"".""t_counts""=""temp"".""transaction_counts"" WHERE ""rc"".""t_counts""<=(SELECT MAX(""transaction_counts"") FROM ""temp"")"
150,"WITH ""vts"" AS (SELECT ""v"".""user_id"",COUNT(""t"".""user_id"") AS ""t_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""t"".""transaction_date""=""v"".""visit_date"" AND ""t"".""user_id""=""v"".""user_id"" GROUP BY ""v"".""visit_date"",""v"".""user_id"") SELECT ""num_transactions"".""num"" AS ""transactions_count"",COUNT(""vts"".""user_id"") AS ""visits_count"" FROM ""vts"" RIGHT JOIN (SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""transactions"" UNION SELECT 0) AS ""num_transactions"" ON ""num_transactions"".""num""=""vts"".""t_count"" WHERE ""num_transactions"".""num""<=(SELECT MAX(""t_count"") FROM ""vts"") GROUP BY ""num_transactions"".""num"" ORDER BY ""transactions_count"""
151,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",COUNT(""t"".""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""row_nums"".""rn"" AS ""transactions_count"",COUNT(""t"".""transaction_count"") AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
152,"WITH RECURSIVE ""t2"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""vCnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""t1"" AS (SELECT MAX(""vCnt"") AS ""maxT"" FROM ""t2""), ""tranCnt"" AS (SELECT 0 AS ""n"" UNION SELECT ""n""+1 FROM ""tranCnt"" WHERE ""n""<(SELECT ""maxT"" FROM ""t1"")) SELECT ""tranCnt"".""n"" AS ""transactions_count"",COUNT(""t2"".""user_id"") AS ""visits_count"" FROM ""tranCnt"" LEFT JOIN ""t2"" ON ""tranCnt"".""n""=""t2"".""vCnt"" GROUP BY ""tranCnt"".""n"""
153,"WITH ""visit_tran_count"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""amount""), 0) AS ""num_tran"" FROM ""transactions"" AS ""t"" RIGHT JOIN ""visits"" AS ""v"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""cons_tran"" AS (SELECT 0 AS ""num_tran"" UNION SELECT ""rn"" FROM (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""transactions"") AS ""tmp"" WHERE ""rn""<=(SELECT MAX(""num_tran"") FROM ""visit_tran_count"")) SELECT ""cons_tran"".""num_tran"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""visit_tran_count"" AS ""vtc"" RIGHT JOIN ""cons_tran"" ON ""vtc"".""num_tran""=""cons_tran"".""num_tran"" GROUP BY 1 ORDER BY 1"
154,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"" ORDER BY 1), ""cte1"" AS (SELECT ""user_id"",""visit_date"",SUM(""transactions_count"") AS ""cnt"" FROM ""cte"" GROUP BY 1,2), ""cte2"" AS (SELECT ROW_NUMBER() OVER () AS ""rownum"" FROM ""transactions"" UNION SELECT 0) SELECT ""rownum"" AS ""transactions_count"",COUNT(""cnt"") AS ""visits_count"" FROM ""cte1"" RIGHT JOIN ""cte2"" ON ""cnt""=""rownum"" WHERE ""rownum""<=(SELECT MAX(""cnt"") FROM ""cte1"") GROUP BY 1 ORDER BY 1"
155,"WITH RECURSIVE ""trans_cnt"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""t_cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""trans_cnt_list"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""trans_cnt_list"" WHERE ""transactions_count""<(SELECT MAX(""t_cnt"") FROM ""trans_cnt"")) SELECT ""l"".""transactions_count"",COUNT(""t"".""user_id"") AS ""visits_count"" FROM ""trans_cnt_list"" AS ""l"" LEFT JOIN ""trans_cnt"" AS ""t"" ON ""l"".""transactions_count""=""t"".""t_cnt"" GROUP BY 1"
156,"WITH ""a"" AS (SELECT ""v1"".""user_id"",""v1"".""visit_date"",""t1"".""amount"" FROM ""Visits"" AS ""v1"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""v1"".""user_id""=""t1"".""user_id"" AND ""v1"".""visit_date""=""t1"".""transaction_date""), ""b"" AS (SELECT ""user_id"",""visit_date"",SUM(CASE WHEN ""amount"" IS NULL THEN 0 ELSE 1 END) AS ""num"" FROM ""a"" GROUP BY ""user_id"",""visit_date""), ""c"" AS (SELECT ""num"",COUNT(1) AS ""cnt"" FROM ""b"" GROUP BY ""num""), ""d"" AS (SELECT 0 AS ""r"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""r"" FROM ""Transactions"") SELECT ""d"".""r"" AS ""transactions_count"",COALESCE(""c"".""cnt"", 0) AS ""visits_count"" FROM ""d"" LEFT JOIN ""c"" ON ""c"".""num""=""d"".""r"" WHERE ""r""<=(SELECT MAX(""num"") FROM ""c"")"
157,"WITH RECURSIVE ""t1"" AS (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""t_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""t2"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""t2"" WHERE ""cnt""<(SELECT MAX(""t_cnt"") FROM ""t1"")) SELECT ""t2"".""cnt"" AS ""transactions_count"",COALESCE(COUNT(""t1"".""user_id""), 0) AS ""visits_count"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t1"".""t_cnt""=""t2"".""cnt"" GROUP BY 1 ORDER BY 1"
158,"WITH RECURSIVE ""t1"" AS (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""t_cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""t2"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""t2"" WHERE ""cnt""<(SELECT MAX(""t_cnt"") FROM ""t1"")) SELECT ""t2"".""cnt"" AS ""transactions_count"",COALESCE(COUNT(""t1"".""user_id""), 0) AS ""visits_count"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t1"".""t_cnt""=""t2"".""cnt"" GROUP BY 1 ORDER BY 1"
159,"WITH RECURSIVE ""tmp"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""tmp"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM (SELECT COUNT(1) AS ""cnt"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t"")), ""tmp2"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(CASE WHEN ""transaction_date"" IS NOT NULL THEN ""transaction_date"" ELSE NULL END) AS ""transactions_count"" FROM ""visits"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY 1,2) SELECT ""a"".""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""tmp"" AS ""a"" LEFT JOIN ""tmp2"" AS ""b"" USING (""transactions_count"") GROUP BY 1 ORDER BY 1"
160,"WITH ""CTE"" AS (SELECT ""num_tranc"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""num_tranc"" FROM ""Visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" AND ""t1"".""visit_date""=""t2"".""transaction_date"" GROUP BY ""t1"".""user_id"",""t1"".""visit_date"") AS ""temp"" GROUP BY ""num_tranc""), ""CTE2"" AS (SELECT ""row_num"" FROM (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"") AS ""temp"" WHERE ""row_num""<=(SELECT MAX(""transactions_count"") FROM ""CTE"") UNION SELECT 0) SELECT ""row_num"" AS ""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""CTE2"" AS ""t1"" LEFT JOIN ""CTE"" AS ""t2"" ON ""t1"".""row_num""=""t2"".""transactions_count"" ORDER BY ""row_num"""
161,"WITH RECURSIVE ""tran_series"" AS (SELECT 0 AS ""tran_num"" UNION SELECT ""tran_num""+1 FROM ""tran_series"" WHERE ""tran_num""<(SELECT COUNT(""user_id"") FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY COUNT(""user_id"") DESC LIMIT 1)), ""t"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"",1 AS ""visits_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""ts"".""tran_num"" AS ""transactions_count"",COALESCE(SUM(""t"".""visits_count""), 0) AS ""visits_count"" FROM ""tran_series"" AS ""ts"" LEFT JOIN ""t"" ON ""ts"".""tran_num""=""t"".""transactions_count"" GROUP BY ""ts"".""tran_num"" ORDER BY ""ts"".""tran_num"""
162,"WITH RECURSIVE ""tbl1"" AS (SELECT 0 AS ""transaction_counts"" UNION ALL SELECT ""transaction_counts""+1 FROM ""tbl1"" WHERE ""transaction_counts""<(SELECT MAX(""t"".""c"") FROM (SELECT COUNT(1) AS ""c"" FROM ""Transactions"" GROUP BY ""Transactions"".""user_id"",""Transactions"".""transaction_date"") AS ""t"")), ""tbl2"" AS (SELECT COALESCE(""t"".""c"", 0) AS ""transaction_counts"",COUNT(1) AS ""visit_counts"" FROM ""Visits"" AS ""v"" LEFT JOIN (SELECT ""Transactions"".""user_id"",""Transactions"".""transaction_date"",COUNT(1) AS ""c"" FROM ""Transactions"" GROUP BY ""Transactions"".""user_id"",""Transactions"".""transaction_date"") AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""transaction_counts"" ORDER BY ""transaction_counts"") SELECT ""tbl1"".""transaction_counts"" AS ""transactions_count"",COALESCE(""tbl2"".""visit_counts"", 0) AS ""visits_count"" FROM ""tbl1"" LEFT JOIN ""tbl2"" USING (""transaction_counts"") ORDER BY ""transaction_counts"""
163,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""cte"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" GROUP BY ""transaction_date"",""user_id"") AS ""t"")), ""visit"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT COALESCE(""transactions_count"", 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" GROUP BY ""transaction_date"",""user_id"") AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"") AS ""t1"" GROUP BY ""transactions_count"") SELECT ""cte"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN ""visit"" AS ""v"" ON ""cte"".""transactions_count""=""v"".""transactions_count"" ORDER BY ""cte"".""transactions_count"""
164,"WITH RECURSIVE ""dd"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""dd"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") AS ""transactions_count"" FROM (SELECT COUNT(""visit_date"") AS ""visits_count"",""transactions_count"" FROM (SELECT SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"",""visit_date"" FROM ""Visits"" AS ""V"" LEFT JOIN ""Transactions"" AS ""T"" ON ""T"".""user_id""=""V"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY ""V"".""user_id"",""visit_date"") AS ""a"" GROUP BY ""transactions_count"" HAVING COUNT(""visit_date"")>0) AS ""a"")), ""countD"" AS (SELECT COUNT(""visit_date"") AS ""visits_count"",""transactions_count"" FROM (SELECT SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"",""visit_date"" FROM ""Visits"" AS ""V"" LEFT JOIN ""Transactions"" AS ""T"" ON ""T"".""user_id""=""V"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY ""V"".""user_id"",""visit_date"") AS ""a"" GROUP BY ""transactions_count"" HAVING COUNT(""visit_date"")>0) SELECT ""d"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""countD"" AS ""c"" RIGHT JOIN ""dd"" AS ""d"" ON ""c"".""transactions_count""=""d"".""transactions_count"""
165,"WITH RECURSIVE ""CTE"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""CTE"" WHERE ""transactions_count""<100), ""visit"" AS (SELECT DISTINCT ""a"".*,COALESCE(""b"".""transaction_count"", 0) AS ""transaction_count"" FROM ""Visits"" AS ""a"" LEFT JOIN (SELECT DISTINCT ""user_id"",""transaction_date"",COUNT(1) AS ""transaction_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""transaction_date""=""visit_date"") SELECT ""a"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""CTE"" AS ""a"" LEFT JOIN (SELECT ""transaction_count"",COUNT(1) AS ""visits_count"" FROM ""Visit"" GROUP BY ""transaction_count"") AS ""b"" ON ""a"".""transactions_count""=""b"".""transaction_count"" WHERE ""a"".""transactions_count""<=(SELECT MAX(""transaction_count"") FROM ""Visit"") GROUP BY ""transactions_count"" ORDER BY 1"
166,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT ""new_cnt"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT *,CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE ""cnt"" END AS ""new_cnt"" FROM (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"",COUNT(1) AS ""cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""t"".""user_id""=""v"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"",""transaction_date"") AS ""a"") AS ""b"" GROUP BY ""new_cnt"") SELECT ""row_num"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""T"".""row_num""=""T1"".""transactions_count"" WHERE ""row_num""<=(SELECT MAX(""transactions_count"") FROM ""t1"") ORDER BY ""row_num"""
167,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
168,"WITH ""res"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""t"".""user_id"" IS NOT NULL AND ""t"".""transaction_date"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""dummy_rownum"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""transactions""), ""visit_count_by_transaction_count"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""res"" GROUP BY 1), ""sequence"" AS (SELECT ""rn"" FROM ""dummy_rownum"" WHERE ""rn""<=(SELECT MAX(""transactions_count"") FROM ""res"") UNION SELECT 0 AS ""rn"") SELECT ""s"".""rn"" AS ""transactions_count"",COALESCE(""vt"".""visits_count"", 0) AS ""visits_count"" FROM ""sequence"" AS ""s"" LEFT JOIN ""visit_count_by_transaction_count"" AS ""vt"" ON ""s"".""rn""=""vt"".""transactions_count"" ORDER BY 1"
169,"WITH RECURSIVE ""transact_counts"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""number_series"" AS (SELECT 0 AS ""val"" UNION ALL SELECT ""val""+1 FROM ""number_series"" WHERE ""val""<(SELECT MAX(""transactions_count"") FROM ""transact_counts"")) SELECT ""s"".""val"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""number_series"" AS ""s"" LEFT JOIN ""transact_counts"" AS ""tc"" ON ""s"".""val""=""tc"".""transactions_count"" GROUP BY ""s"".""val"" ORDER BY ""transactions_count"""
170,"WITH ""A"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""B"" AS (SELECT 0 AS ""trans_count"" UNION SELECT ROW_NUMBER() OVER () AS ""trans_count"" FROM ""Transactions""), ""C"" AS (SELECT ""A"".""user_id"" AS ""user_id"",""B"".""trans_count"",COALESCE(""A"".""transactions_count"", 0) AS ""transactions_count"" FROM ""B"" LEFT JOIN ""A"" ON ""B"".""trans_count""=""A"".""transactions_count"" WHERE ""B"".""trans_count""<=(SELECT MAX(""transactions_count"") FROM ""A"")) SELECT ""trans_count"" AS ""transactions_count"",(CASE WHEN ""user_id""=NULL THEN 0 ELSE COUNT(""user_id"") END) AS ""visits_count"" FROM ""C"" GROUP BY ""trans_count"" ORDER BY ""trans_count"""
171,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cte"" WHERE ""transactions_count""<(SELECT COUNT(1) FROM ""transactions"")), ""temp"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",CASE WHEN ""t"".""amount"" IS NULL THEN 0 ELSE 1 END AS ""amount"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""temp1"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""user_id"",""visit_date"",SUM(""amount"") AS ""transactions_count"" FROM ""temp"" GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""transactions_count"") SELECT ""cte"".""transactions_count"",CASE WHEN ""temp1"".""visits_count"" IS NULL THEN 0 ELSE ""temp1"".""visits_count"" END AS ""visits_count"" FROM ""cte"" LEFT JOIN ""temp1"" ON ""cte"".""transactions_count""=""temp1"".""transactions_count"" WHERE ""cte"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""temp1"") ORDER BY ""transactions_count"""
172,"WITH RECURSIVE ""t"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""t"" WHERE ""transactions_count""<=100), ""b"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""c"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""b"" GROUP BY ""transactions_count"") SELECT ""t"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""t"" LEFT JOIN ""c"" ON ""t"".""transactions_count""=""c"".""transactions_count"" WHERE ""t"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""c"")"
173,"WITH RECURSIVE ""transactions_count"" AS (SELECT 0 AS ""t_count"" UNION ALL SELECT ""t_count""+1 FROM ""transactions_count"" WHERE ""t_count""<(SELECT MAX(""trans_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(DISTINCT ""v"".""visit_date"") AS ""visit_count"",COUNT(""t"".""transaction_date"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""x"")), ""visits_count"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""t_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""tc"".""t_count"" AS ""transactions_count"",COUNT(""vc"".""user_id"") AS ""visits_count"" FROM ""transactions_count"" AS ""tc"" LEFT JOIN ""visits_count"" AS ""vc"" ON ""tc"".""t_count""=""vc"".""t_count"" GROUP BY 1"
174,"WITH ""trans"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM (WITH RECURSIVE ""trans_count"" AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""trans_count"" WHERE ""n""<(SELECT MAX(""transactions_count"") FROM ""trans"")) SELECT ""n"" AS ""transactions_count"" FROM ""trans_count"") AS ""test"" LEFT JOIN ""trans"" USING (""transactions_count"") GROUP BY ""transactions_count"""
175,"WITH ""seq"" AS (SELECT 0 AS ""seq"" UNION ALL SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") AS ""seq"" FROM ""transactions""), ""cte"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""tx"".""user_id"") AS ""tx_count"",COUNT(DISTINCT ""v"".""user_id"") AS ""visit_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""tx"" ON ""tx"".""transaction_date""=""v"".""visit_date"" AND ""tx"".""user_id""=""v"".""user_id"" GROUP BY 1,2) SELECT ""seq"".""seq"" AS ""transactions_count"",COALESCE(SUM(""cte"".""visit_count""), 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""cte"" ON ""seq"".""seq""=""cte"".""tx_count"" WHERE ""seq"".""seq""<=(SELECT MAX(""tx_count"") FROM ""cte"") GROUP BY 1"
176,"WITH RECURSIVE ""count_list"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""count_list"" WHERE ""transactions_count""<(SELECT COUNT(1) FROM ""Transactions"")), ""visits_summary"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""t"".""amount"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""c"".""transactions_count"",COUNT(""s"".""transactions_count"") AS ""visits_count"" FROM ""count_list"" AS ""c"" LEFT JOIN ""visits_summary"" AS ""s"" ON ""c"".""transactions_count""=""s"".""transactions_count"" WHERE ""c"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""visits_summary"") GROUP BY 1"
177,"WITH RECURSIVE ""cte1"" AS (SELECT DISTINCT ""user_id"",""transaction_date"",COUNT(""amount"") OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""user_id"",""transaction_date"") AS ""result1"" FROM ""Transactions""), ""cte2"" AS (SELECT ""result1"" AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM (SELECT DISTINCT ""v"".""user_id"",""visit_date"",CASE WHEN ""result1"" IS NULL THEN 0 ELSE ""result1"" END AS ""result1"" FROM ""Visits"" AS ""v"" LEFT JOIN ""cte1"" AS ""c"" ON ""c"".""user_id""=""v"".""user_id"" AND ""c"".""transaction_date""=""v"".""visit_date"") AS ""x"" GROUP BY ""result1""), ""cte3"" AS (SELECT 0 AS ""t1"" UNION ALL SELECT ""t1""+1 FROM ""cte3"" WHERE ""t1""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""t1"" AS ""transactions_count"",CASE WHEN ""visits_count"" IS NULL THEN 0 ELSE ""visits_count"" END AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""t1""=""cte2"".""transactions_count"""
178,"WITH RECURSIVE ""trans_count_raw"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date""), ""trans_count"" AS (SELECT COALESCE(""trans_count_raw"".""transactions_count"", 0) AS ""transactions_count"",""Visits"".""user_id"" AS ""user_id"",""Visits"".""visit_date"" AS ""visit_date"" FROM ""Visits"" LEFT JOIN ""trans_count_raw"" ON ""Visits"".""user_id""=""trans_count_raw"".""user_id"" AND ""Visits"".""visit_date""=""trans_count_raw"".""transaction_date""), ""trans_visit_count"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""trans_count"" GROUP BY ""transactions_count""), ""transactions_count"" AS (SELECT 0 AS ""transactions_count"",MAX(""transactions_count"") AS ""temp"" FROM ""trans_visit_count"" UNION ALL SELECT ""transactions_count""+1,""temp"" FROM ""transactions_count"" WHERE ""transactions_count""<""temp"") SELECT ""transactions_count"".""transactions_count"" AS ""transactions_count"",COALESCE(""trans_visit_count"".""visits_count"", 0) AS ""visits_count"" FROM ""transactions_count"" LEFT JOIN ""trans_visit_count"" ON ""transactions_count"".""transactions_count""=""trans_visit_count"".""transactions_count"""
179,"WITH ""t"" AS (SELECT COUNT(""t"".""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON CONCAT(""v"".""user_id"", ':', ""v"".""visit_date"")=CONCAT(""t"".""user_id"", ':', ""t"".""transaction_date"") GROUP BY CONCAT(""v"".""user_id"", ':', ""v"".""visit_date"")), ""row_num_t"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0) SELECT ""row_num"" AS ""transactions_count"",COUNT(""t"".""transaction_count"") AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_num_t"" ON ""t"".""transaction_count""=""row_num_t"".""row_num"" GROUP BY ""row_num_t"".""row_num"" HAVING ""row_num_t"".""row_num""<=(SELECT MAX(""transaction_count"") FROM ""t"") ORDER BY ""row_num"""
180,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""num"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""t"".""user_id""=""v"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""user_id"",""visit_date"") SELECT DISTINCT ""c"".""transactions_count"",COUNT(""num"") AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""transactions_count"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN ""cte"" ON ""cte"".""num""=""c"".""transactions_count"" GROUP BY ""c"".""transactions_count"" ORDER BY ""c"".""transactions_count"""
181,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",COALESCE(COUNT(""transaction_count""), 0) AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
182,"WITH RECURSIVE ""cte_trans"" AS (SELECT 0 AS ""transaction_count"" UNION ALL SELECT ""transaction_count""+1 AS ""transaction_count"" FROM ""cte_trans"" WHERE ""transaction_count""<(SELECT MAX(""cnt"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(""user_id"") AS ""cnt"" FROM ""transactions"" GROUP BY 1,2) AS ""x"")) SELECT ""ct"".""transaction_count"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte_trans"" AS ""ct"" LEFT JOIN (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(""x"".""transaction_date"", 0),COALESCE(""cnt"", 0) AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(""user_id"") AS ""cnt"" FROM ""transactions"" GROUP BY 1,2) AS ""x"" ON ""v"".""user_id""=""x"".""user_id"" AND ""v"".""visit_date""=""x"".""transaction_date"") AS ""y"" ON ""ct"".""transaction_count""=""y"".""cnt"" GROUP BY ""transaction_count"""
183,"SELECT ""b"".""transactions_count"" AS ""transactions_count"",COALESCE(""c"".""visits_count"", 0) AS ""visits_count"" FROM (SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM (""Transactions"") CROSS JOIN (SELECT @""cnt"":=-1) AS ""tmp"" WHERE @""cnt""<(SELECT COUNT(1) FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY COUNT(1) DESC LIMIT 1) UNION SELECT 0) AS ""b"" LEFT JOIN (SELECT ""a"".""transactions_count"" AS ""transactions_count"",COUNT(""a"".""user_id"") AS ""visits_count"" FROM (SELECT ""v"".""user_id"" AS ""user_id"",""v"".""visit_date"" AS ""visit_date"",SUM(CASE WHEN ""t"".""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""a"" GROUP BY ""a"".""transactions_count"") AS ""c"" ON ""b"".""transactions_count""=""c"".""transactions_count"""
184,"WITH RECURSIVE ""t"" AS (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END AS ""trans"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""u"" AS (SELECT DISTINCT ""user_id"",""visit_date"",SUM(""trans"") OVER (PARTITION BY ""user_id"", ""visit_date"") AS ""transperdayperuser"" FROM ""t""), ""w"" AS (SELECT ""transperdayperuser"",COUNT(""visit_date"") AS ""visits_count"" FROM ""u"" GROUP BY 1), ""seq"" AS (SELECT 0 AS ""value"" UNION ALL SELECT ""value""+1 FROM ""seq"" WHERE ""value""<(SELECT MAX(""transperdayperuser"") FROM ""w"")) SELECT ""seq"".""value"" AS ""transactions_count"",COALESCE(""w"".""visits_count"", 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""w"" ON ""seq"".""value""=""w"".""transperdayperuser"""
185,"WITH RECURSIVE ""transactions_count"" AS (SELECT 0 AS ""transaction_count"",0 AS ""visits_count"" UNION ALL SELECT ""transaction_count""+1 AS ""transaction_count"",0 AS ""visits_count"" FROM ""transactions_count"" WHERE ""transaction_count""<(SELECT MAX(""trans_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(DISTINCT ""v"".""visit_date"") AS ""visit_count"",COUNT(""t"".""transaction_date"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""x"")) SELECT ""transaction_count"" AS ""transactions_count"",SUM(""visits_count"") AS ""visits_count"" FROM (SELECT 0 AS ""transaction_count"",COUNT(""v"".""visit_date"") AS ""visits_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" WHERE ""t"".""transaction_date"" IS NULL GROUP BY ""transaction_count"" UNION ALL SELECT ""nb_transactions"" AS ""transaction_count"",COUNT(0) AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(0) AS ""nb_transactions"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" WHERE ""t"".""transaction_date"" IS NOT NULL GROUP BY ""v"".""visit_date"",""v"".""user_id"") AS ""t"" GROUP BY ""transaction_count"" UNION ALL SELECT * FROM ""transactions_count"") AS ""t"" GROUP BY 1 ORDER BY 1"
186,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cte"" WHERE ""cnt""<(SELECT MAX(""tcnt"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""tcnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""f"")) SELECT ""cnt"" AS ""transactions_count"",COUNT(""tcnt"") AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""tcnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""f1"" RIGHT JOIN ""cte"" ON ""cte"".""cnt""=""f1"".""tcnt"" GROUP BY ""cnt"" ORDER BY ""cnt"""
187,"WITH RECURSIVE ""transac_Per_Visit"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""user_id""), 0) AS ""transacPerVisit"" FROM ""Visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""his"" AS (SELECT ""transacPerVisit"",COUNT(""user_id"") AS ""vc"" FROM ""transac_per_visit"" GROUP BY ""transacPerVisit""), ""min_max"" AS (SELECT 0 AS ""num"",MAX(""transacPerVisit"") AS ""max"" FROM ""transac_per_visit"" AS ""tpv"" UNION SELECT ""num""+1,""max"" FROM ""min_max"" WHERE ""num""<""max"") SELECT ""mm"".""num"" AS ""transactions_count"",COALESCE(""his"".""vc"", 0) AS ""visits_count"" FROM ""min_max"" AS ""mm"" LEFT JOIN ""his"" ON ""mm"".""num""=""his"".""transacPerVisit"" ORDER BY 1"
188,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""cte"" WHERE ""transactions_count""<(SELECT COUNT(""amount"") FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY COUNT(""amount"") DESC LIMIT 1)) SELECT ""cte"".""transactions_count"",COALESCE(""v_cnt"", 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""t_cnt"",COUNT(""t_cnt"") AS ""v_cnt"" FROM (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""amount""), 0) AS ""t_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""temp"" GROUP BY ""t_cnt"") AS ""temp2"" ON ""cte"".""transactions_count""=""temp2"".""t_cnt"""
189,"WITH RECURSIVE ""timeline"" AS (SELECT ""v1"".*,COUNT(""t1"".""user_id"") AS ""transactionsAVisit"" FROM ""Visits"" AS ""v1"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""v1"".""user_id""=""t1"".""user_id"" AND ""v1"".""visit_date""=""t1"".""transaction_date"" GROUP BY 1,2), ""cte"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cte"" WHERE ""transactions_count""<(SELECT MAX(""transactionsAVisit"") AS ""maxTransactions"" FROM ""timeline"")) SELECT ""c1"".""transactions_count"",COUNT(""t1"".""transactionsAVisit"") AS ""visits_count"" FROM ""cte"" AS ""c1"" LEFT JOIN ""timeline"" AS ""t1"" ON ""c1"".""transactions_count""=""t1"".""transactionsAVisit"" GROUP BY 1"
190,"WITH ""tbl"" AS (SELECT ""v"".*,(CASE WHEN ""t"".""amount"" IS NULL THEN 0 ELSE 1 END) AS ""trans"",COUNT(1) AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""tbl2"" AS (SELECT ""cnt""*""trans"" AS ""transactions_count"",COUNT(""trans"") AS ""visits_count"" FROM ""tbl"" GROUP BY ""cnt""*""trans""), ""tbl3"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""transactions"" UNION SELECT 0 AS ""rn"") SELECT ""tbl3"".""rn"" AS ""transactions_count"",COALESCE(""tbl2"".""visits_count"", 0) AS ""visits_count"" FROM ""tbl3"" LEFT JOIN ""tbl2"" ON ""tbl2"".""transactions_count""=""tbl3"".""rn"" WHERE ""tbl3"".""rn""<=(SELECT MAX(""tbl2"".""transactions_count"") FROM ""tbl2"") ORDER BY ""transactions_count"""
191,"WITH ""A"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(""transactions_count"", 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""B"" AS (SELECT * FROM (SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""Transactions"" UNION SELECT 0) AS ""c"" WHERE ""transactions_count""<=(SELECT MAX(""A"".""transactions_count"") FROM ""A"")) SELECT ""B"".""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""B"" LEFT JOIN ""A"" USING (""transactions_count"") GROUP BY ""B"".""transactions_count"" ORDER BY ""B"".""transactions_count"""
192,"WITH ""visit_cnt"" AS (SELECT ""cnt"" AS ""tran_cnt"",COUNT(""visit_date"") AS ""visit_cnt"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""transaction_date"") AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""a"" GROUP BY ""cnt"") SELECT COALESCE(""b"".""tran_cnt"", ""a"".""cnt"") AS ""transactions_count"",CASE WHEN ""b"".""tran_cnt"" IS NULL THEN 0 ELSE ""visit_cnt"" END AS ""visits_count"" FROM ""visit_cnt"" AS ""b"" RIGHT JOIN (SELECT ""cnt"" FROM (SELECT 0 AS ""cnt"" UNION SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") AS ""cnt"" FROM ""transactions"") AS ""A"" WHERE ""cnt""<=(SELECT MAX(""tran_cnt"") FROM ""visit_cnt"")) AS ""a"" ON ""a"".""cnt""=""b"".""tran_cnt"""
193,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""cte"" WHERE ""transactions_count""<(SELECT COUNT(""amount"") FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY COUNT(""amount"") DESC LIMIT 1)), ""temp"" AS (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""amount""), 0) AS ""t_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date""), ""temp2"" AS (SELECT ""t_cnt"",COUNT(""t_cnt"") AS ""v_cnt"" FROM ""temp"" GROUP BY ""t_cnt"") SELECT ""cte"".""transactions_count"",COALESCE(""v_cnt"", 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN ""temp2"" ON ""cte"".""transactions_count""=""temp2"".""t_cnt"""
194,"WITH RECURSIVE ""cte2"" (""n"") AS (SELECT 0 UNION ALL SELECT ""n""+1 FROM ""cte2"" WHERE ""n""<(SELECT COUNT(1) FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY 1 DESC LIMIT 1)) SELECT ""cte2"".""n"" AS ""transactions_count"",COALESCE(""v_count"", 0) AS ""visits_count"" FROM ""cte2"" LEFT JOIN (SELECT COALESCE(""TCOUNT"", 0) AS ""TRAN_COUNT"",COUNT(1) AS ""v_count"" FROM ""Visits"" AS ""vi"" LEFT JOIN (SELECT ""t"".""user_id"",""t"".""transaction_date"",COUNT(1) AS ""TCOUNT"" FROM ""transactions"" AS ""t"" GROUP BY ""t"".""user_id"",""t"".""transaction_date"") AS ""tc"" ON ""vi"".""user_id""=""tc"".""user_id"" AND ""vi"".""visit_date""=""tc"".""transaction_date"" GROUP BY COALESCE(""TCOUNT"", 0)) AS ""ABC"" ON ""cte2"".""n""=""ABC"".""TRAN_COUNT"""
195,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON (""t2"".""user_id""=""t1"".""user_id"" AND ""t2"".""transaction_date""=""t1"".""visit_date"") GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""transactions_count""), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""t2"".""visits_count"" IS NULL THEN 0 ELSE ""t2"".""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t2"".""transactions_count""=""t1"".""transactions_count"""
196,"WITH RECURSIVE ""trans_count"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" AS ""t"" GROUP BY ""transaction_date"",""user_id""), ""trans_count_1"" AS (SELECT ""v"".""user_id"",""transaction_date"",""visit_date"",CASE WHEN ""transactions_count"" IS NULL THEN 0 WHEN ""transactions_count"" IS NOT NULL THEN ""transactions_count"" END AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""trans_count"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""final"" AS (SELECT ""transactions_count"",COUNT(""t1"".""user_id"") AS ""visits_count"" FROM ""trans_count_1"" AS ""t1"" GROUP BY ""transactions_count"" ORDER BY ""transactions_count""), ""sub"" AS (SELECT 0 AS ""possible_transactions_per_user"" UNION ALL SELECT ""possible_transactions_per_user""+1 AS ""possible_transactions_per_user"" FROM ""sub"" WHERE ""possible_transactions_per_user""<(SELECT MAX(""transactions_count"") FROM ""final"")) SELECT CASE WHEN ""transactions_count"" IS NULL THEN ""possible_transactions_per_user"" ELSE ""transactions_count"" END AS ""transactions_count"",CASE WHEN ""visits_count"" IS NULL THEN 0 ELSE ""visits_count"" END AS ""visits_count"" FROM ""final"" RIGHT JOIN (SELECT * FROM ""sub"") AS ""a"" ON ""final"".""transactions_count""=""a"".""possible_transactions_per_user"""
197,"WITH RECURSIVE ""id_Ranges"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""id_Ranges"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM (SELECT ""ina"".""user_id"",""ina"".""visit_date"",COUNT(""inb"".""amount"") AS ""transactions_count"" FROM ""Visits"" AS ""ina"" LEFT JOIN ""Transactions"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""user_id"" AND ""ina"".""visit_date""=""inb"".""transaction_date"" GROUP BY ""ina"".""user_id"",""ina"".""visit_date"") AS ""inc"")), ""tmp1"" AS (SELECT ""ina"".""user_id"",""ina"".""visit_date"",COUNT(""inb"".""amount"") AS ""transactions_count"" FROM ""Visits"" AS ""ina"" LEFT JOIN ""Transactions"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""user_id"" AND ""ina"".""visit_date""=""inb"".""transaction_date"" GROUP BY ""ina"".""user_id"",""ina"".""visit_date""), ""tmp2"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""tmp1"" GROUP BY ""transactions_count"") SELECT ""ina"".""transactions_count"",COALESCE(""inb"".""visits_count"", 0) AS ""visits_count"" FROM ""id_ranges"" AS ""ina"" LEFT JOIN ""tmp2"" AS ""inb"" ON ""ina"".""transactions_count""=""inb"".""transactions_count"" ORDER BY ""ina"".""transactions_count"""
198,"WITH ""cte1"" AS (SELECT ""a"".*,""b"".""amount"" AS ""amt"",CASE WHEN ""b"".""amount"" IS NULL THEN 0 ELSE 1 END AS ""trans_cnt"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date""), ""cte2"" AS (SELECT ""visit_date"",""user_id"",SUM(""trans_cnt"") AS ""transaction_count"" FROM ""cte1"" GROUP BY 1,2), ""base"" AS (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) SELECT ""a"".""counts"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""base"" AS ""a"" LEFT JOIN ""cte2"" AS ""b"" ON ""a"".""counts""=""b"".""transaction_count"" GROUP BY 1 ORDER BY 1"
199,"WITH RECURSIVE ""counts"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 AS ""cnt"" FROM ""counts"" WHERE ""cnt""<(SELECT MAX(""cnt"") FROM (SELECT COALESCE(""cnt"", 0) AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(""user_id"") AS ""cnt"" FROM ""transactions"" GROUP BY 1,2) AS ""t1"" ON ""v"".""user_id""=""t1"".""user_id"" AND ""v"".""visit_date""=""t1"".""transaction_date"") AS ""t2"")) SELECT ""c"".""cnt"" AS ""transactions_count"",COALESCE(""t3"".""visits_count"", 0) AS ""visits_count"" FROM ""counts"" AS ""c"" LEFT JOIN (SELECT ""cnt"",COUNT(""cnt"") AS ""visits_count"" FROM (SELECT COALESCE(""cnt"", 0) AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(""user_id"") AS ""cnt"" FROM ""transactions"" GROUP BY 1,2) AS ""t1"" ON ""v"".""user_id""=""t1"".""user_id"" AND ""v"".""visit_date""=""t1"".""transaction_date"") AS ""t2"" GROUP BY ""cnt"") AS ""t3"" ON ""c"".""cnt""=""t3"".""cnt"""
200,"WITH ""tbl"" AS (SELECT COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""seq"" AS (SELECT ""transactions_count"" FROM (SELECT 0 AS ""transactions_count"" UNION SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""Transactions"") AS ""t"" WHERE ""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""tbl"")) SELECT ""seq"".""transactions_count"",COUNT(""tbl"".""transactions_count"") AS ""visits_count"" FROM ""seq"" LEFT JOIN ""tbl"" ON ""seq"".""transactions_count""=""tbl"".""transactions_count"" GROUP BY ""seq"".""transactions_count"" ORDER BY ""seq"".""transactions_count"""
201,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"""
202,"WITH RECURSIVE ""t"" AS (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END AS ""trans"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""u"" AS (SELECT DISTINCT ""user_id"",""visit_date"",SUM(""trans"") OVER (PARTITION BY ""user_id"", ""visit_date"") AS ""transperdayperuser"" FROM ""t""), ""w"" AS (SELECT ""transperdayperuser"",COUNT(""visit_date"") AS ""visits_count"" FROM ""u"" GROUP BY 1), ""seq"" AS (SELECT 0 AS ""value"" UNION ALL SELECT ""value""+1 FROM ""seq"" WHERE ""value""<(SELECT MAX(""transperdayperuser"") FROM ""w"")) SELECT ""seq"".""value"" AS ""transactions_count"",COALESCE(""w"".""visits_count"", 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""w"" ON ""seq"".""value""=""w"".""transperdayperuser"""
203,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(DISTINCT ""v"".""user_id"") AS ""visits_count"",SUM(CASE WHEN ""t"".""user_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trans_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_Date"" GROUP BY 1,2) SELECT ""row_num"" AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""trans_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""trans_count"") FROM ""T1"") ORDER BY ""row_num"""
204,"WITH RECURSIVE ""transactions_count"" AS (SELECT 0 AS ""t_count"" UNION ALL SELECT ""t_count""+1 FROM ""transactions_count"" WHERE ""t_count""<(SELECT MAX(""trans_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(DISTINCT ""v"".""visit_date"") AS ""visit_count"",COUNT(""t"".""transaction_date"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""x"")), ""visits_count"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""t_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""tc"".""t_count"" AS ""transactions_count"",COUNT(""vc"".""user_id"") AS ""visits_count"" FROM ""transactions_count"" AS ""tc"" LEFT JOIN ""visits_count"" AS ""vc"" ON ""tc"".""t_count""=""vc"".""t_count"" GROUP BY 1"
205,"WITH ""t"" AS (SELECT ""d"".""counts"" AS ""transactions_count"",COUNT(""d"".""visit_date"") AS ""visits_count"" FROM (SELECT ""c"".""user_id"",""c"".""tran_id"",""c"".""visit_date"",SUM(CASE WHEN ""c"".""tran_id"" IS NULL THEN 0 ELSE 1 END) AS ""counts"" FROM (SELECT ""a"".""user_id"",""b"".""user_id"" AS ""tran_id"",""a"".""visit_date"",""b"".""transaction_date"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" ORDER BY 1) AS ""c"" GROUP BY 1,2,3) AS ""d"" GROUP BY 1 ORDER BY 1) SELECT ""s"".""rownum"" AS ""transactions_count"",COALESCE(""z"".""visits_count"", 0) AS ""visits_count"" FROM (SELECT ROW_NUMBER() OVER () AS ""rownum"" FROM ""Transactions"" UNION SELECT 0) AS ""s"" LEFT JOIN ""t"" AS ""z"" ON ""s"".""rownum""=""z"".""transactions_count"" WHERE ""s"".""rownum""<=(SELECT MAX(""transactions_count"") FROM ""t"") ORDER BY 1"
206,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_count"",0 AS ""visits_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"",0 AS ""visits_count"" FROM ""cte"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(""amount"") AS ""cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t"")), ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(""tran_cnt"", 0) AS ""tran_cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN (SELECT ""user_id"",""transaction_date"" AS ""visit_date"",COUNT(""amount"") AS ""tran_cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""visit_date"") SELECT ""transactions_count"",SUM(""visits_count"") AS ""visits_count"" FROM (SELECT ""tran_cnt"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""tran_cnt"" UNION ALL SELECT ""transactions_count"",""visits_count"" FROM ""cte"") AS ""t"" GROUP BY ""transactions_count"" ORDER BY ""transactions_count"""
207,"WITH RECURSIVE ""record"" AS (SELECT 0 AS ""num"" UNION SELECT ""num""+1 FROM ""record"" WHERE ""num""<(SELECT COUNT(1) FROM ""Transactions"")), ""visit_num_trans"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(""b"".""amount"") AS ""num_trans"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date"") SELECT ""m"".""num"" AS ""transactions_count"",COUNT(COALESCE(""n"".""user_id"", ""n"".""visit_date"")) AS ""visits_count"" FROM ""record"" AS ""m"" LEFT JOIN ""visit_num_trans"" AS ""n"" ON ""m"".""num""=""n"".""num_trans"" WHERE ""m"".""num""<=(SELECT MAX(""num_trans"") FROM ""visit_num_trans"") GROUP BY ""m"".""num"" ORDER BY ""transactions_count"""
208,"WITH RECURSIVE ""cte"" AS (SELECT COUNT(""transaction_date"") AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date""), ""cte1"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""cte1"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM ""cte"")) SELECT ""transactions_count"",COUNT(""cnt"") AS ""visits_count"" FROM ""cte1"" LEFT JOIN ""cte"" ON ""cte1"".""transactions_count""=""cte"".""cnt"" GROUP BY 1"
209,"WITH ""a"" AS (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""amount""), 0) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""b"" AS (SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""transactions"" UNION SELECT 0) SELECT ""b"".""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""b"" LEFT JOIN ""a"" ON ""b"".""transactions_count""=""a"".""transactions_count"" GROUP BY ""b"".""transactions_count"" HAVING ""b"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""a"") ORDER BY ""b"".""transactions_count"""
210,"WITH RECURSIVE ""CTE"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""cts"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""CTE1"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""CTE1"" WHERE ""transactions_count""<(SELECT MAX(""cts"") FROM ""CTE"")) SELECT ""CTE1"".""transactions_count"",COUNT(""CTE"".""cts"") AS ""visits_count"" FROM ""CTE1"" LEFT JOIN ""CTE"" ON ""CTE1"".""transactions_count""=""CTE"".""cts"" GROUP BY ""CTE1"".""transactions_count"" ORDER BY ""CTE1"".""transactions_count"""
211,"WITH ""x"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""v"".*,SUM(CASE WHEN ""t"".""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""a"" GROUP BY ""transactions_count"" ORDER BY ""transactions_count""), ""y"" AS (SELECT * FROM (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ROW_NUMBER() OVER (ORDER BY ""user_id"") AS ""transactions_count"" FROM ""transactions"") AS ""a"" WHERE ""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""x"") AND ""transactions_count"" NOT IN (SELECT ""transactions_count"" FROM ""x"")) SELECT * FROM ""x"" UNION ALL SELECT ""transactions_count"",0 AS ""visits_count"" FROM ""y"" ORDER BY ""transactions_count"""
212,"WITH ""ct"" AS (SELECT COUNT(1) AS ""tran_ct"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date""), ""vt"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""tran_ct"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""rt"" AS (WITH RECURSIVE ""se"" AS (SELECT 0 AS ""tran_ct"" UNION ALL SELECT ""tran_ct""+1 AS ""tran_ct"" FROM ""se"" WHERE ""tran_ct""<(SELECT MAX(""tran_ct"") FROM ""ct"")) SELECT * FROM ""se"") SELECT ""rt"".""tran_ct"" AS ""transactions_count"",COALESCE(COUNT(""vt"".""tran_ct""), 0) AS ""visits_count"" FROM ""rt"" LEFT JOIN ""vt"" ON ""rt"".""tran_ct""=""vt"".""tran_ct"" GROUP BY 1 ORDER BY 1"
213,"WITH RECURSIVE ""seq"" AS (SELECT 0 AS ""value"" UNION ALL SELECT ""value""+1 FROM ""seq"" WHERE ""value""<=100), ""a"" AS (SELECT ""transaction_count"",COUNT(""user_id"") AS ""visits_count"" FROM (SELECT ""Visits"".*,COALESCE(""tran_count"", 0) AS ""transaction_count"" FROM ""Visits"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(""amount"") AS ""tran_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""temp"" ON ""Visits"".""user_id""=""temp"".""user_id"" AND ""Visits"".""visit_date""=""temp"".""transaction_date"") AS ""temp2"" GROUP BY ""transaction_count"" ORDER BY ""transaction_count"") SELECT ""value"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""a"" ON ""a"".""transaction_count""=""seq"".""value"" WHERE ""seq"".""value""<=(SELECT MAX(""transaction_count"") FROM ""a"")"
214,"WITH ""CTE"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""cte_recur"" AS (WITH RECURSIVE ""TEMP"" AS (SELECT 0 AS ""trans_cnt"" UNION ALL SELECT ""trans_cnt""+1 AS ""trans_cnt"" FROM ""temp"" WHERE ""trans_cnt""<(SELECT MAX(""transaction_count"") FROM ""cte"")) SELECT * FROM ""TEMP"") SELECT ""trans_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte_recur"" AS ""r"" LEFT JOIN ""cte"" AS ""c"" ON ""r"".""trans_cnt""=""c"".""transaction_count"" GROUP BY 1 ORDER BY 1"
215,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY 1 ORDER BY 1"
216,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY 1 ORDER BY 1"
217,"WITH ""t1"" AS (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""transaction_count_per_day_n_user"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""user_id"",""visit_date""), ""t2"" AS (SELECT ""transaction_count_per_day_n_user"",COUNT(1) AS ""visits_count"" FROM ""t1"" GROUP BY ""transaction_count_per_day_n_user""), ""t3"" AS (SELECT MAX(""transaction_count_per_day_n_user"") AS ""max_transaction_count_per_day_n_user"" FROM ""t2""), ""RangeOfTransactionsCount"" AS (SELECT ""transactions_count"" FROM (SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") AS ""transactions_count"" FROM ""Transactions"" UNION SELECT 0) AS ""t5"" WHERE ""transactions_count""<=(SELECT ""max_transaction_count_per_day_n_user"" FROM ""t3"")) SELECT ""RangeOfTransactionsCount"".""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""RangeOfTransactionsCount"" LEFT JOIN ""t2"" ON ""t2"".""transaction_count_per_day_n_user""=""RangeOfTransactionsCount"".""transactions_count"" ORDER BY ""RangeOfTransactionsCount"".""transactions_count"""
218,"WITH ""num_transactions_by_users_by_date"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""num_transactions"" FROM ""visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"" ORDER BY ""v"".""user_id"",""visit_date""), ""num_transactions_by_date"" AS (SELECT ""user_id"",""visit_date"",SUM(""num_transactions"") AS ""num_transactions"" FROM ""num_transactions_by_users_by_date"" GROUP BY ""user_id"",""visit_date"" ORDER BY ""user_id"",""visit_date""), ""num_transactions"" AS (SELECT ROW_NUMBER() OVER () AS ""num_transactions"" FROM ""transactions"" UNION SELECT 0) SELECT ""nt"".""num_transactions"" AS ""transactions_count"",COUNT(""ntbd"".""num_transactions"") AS ""visits_count"" FROM ""num_transactions"" AS ""nt"" LEFT JOIN ""num_transactions_by_date"" AS ""ntbd"" ON ""nt"".""num_transactions""=""ntbd"".""num_transactions"" WHERE ""nt"".""num_transactions""<=(SELECT MAX(""num_transactions"") FROM ""num_transactions_by_date"") GROUP BY 1 ORDER BY 1"
219,"SELECT ""c"".""counts"" AS ""transactions_count"",COALESCE(COUNT(""d"".""visit_date""), 0) AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN (SELECT ""a"".""user_id"",""a"".""visit_date"",COALESCE(COUNT(""amount""), 0) AS ""num_transactions"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY 1,2) AS ""d"" ON ""c"".""counts""=""d"".""num_transactions"" GROUP BY 1 ORDER BY 1"
220,"SELECT ""t4"".""TRANSACTIONS_COUNT"",COALESCE(""t3"".""COUNT_COUNT"", 0) AS ""VISITS_COUNT"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""USER_ID"", ""TRANSACTION_DATE"") AS ""TRANSACTIONS_COUNT"" FROM ""TRANSACTIONS"" UNION SELECT 0) AS ""t4"" LEFT JOIN (SELECT ""TRANSACTIONS_COUNT"",COUNT(""TRANSACTIONS_COUNT"") AS ""COUNT_COUNT"" FROM (SELECT ""v"".""USER_ID"",""v"".""VISIT_DATE"",COALESCE(COUNT(""t"".""AMOUNT""), 0) AS ""TRANSACTIONS_COUNT"" FROM ""VISITS"" AS ""v"" LEFT JOIN ""TRANSACTIONS"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""VISIT_DATE""=""t"".""TRANSACTION_DATE"" GROUP BY ""v"".""USER_ID"",""v"".""VISIT_DATE"") AS ""t2"" GROUP BY ""TRANSACTIONS_COUNT"") AS ""t3"" ON ""t4"".""TRANSACTIONS_COUNT""=""t3"".""TRANSACTIONS_COUNT"" ORDER BY ""t4"".""TRANSACTIONS_COUNT"""
221,"WITH RECURSIVE ""l1"" AS (SELECT ""trans"",COUNT(""visit_date"") AS ""vc"" FROM (SELECT ""v"".""user_id"",""visit_date"",COUNT(""amount"") AS ""trans"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""user_id"",""visit_date"") AS ""tt"" GROUP BY ""trans""), ""cte"" (""n"") AS (SELECT 0 UNION SELECT ""n""+1 FROM ""cte"" WHERE ""n""<(SELECT MAX(""trans"") FROM ""l1"")) SELECT ""cte"".""n"" AS ""transactions_count"",COALESCE(""l1"".""vc"", 0) AS ""visits_count"" FROM ""l1"" RIGHT JOIN ""cte"" ON ""l1"".""trans""=""cte"".""n"""
222,"WITH ""transaction_number_reference"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""transactions"" UNION SELECT 0), ""dataset"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""t"".""user_id""=""v"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""user_id"",""visit_date""), ""aggregate_data"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""dataset"" GROUP BY ""transactions_count"") SELECT ""rn"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""transaction_number_reference"" AS ""t"" LEFT JOIN ""aggregate_data"" AS ""ad"" ON ""ad"".""transactions_count""=""t"".""rn"" GROUP BY ""rn"" HAVING ""rn""<=(SELECT MAX(""transactions_count"") FROM ""aggregate_data"") ORDER BY 1"
223,"WITH ""visit_tran_count"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""amount""), 0) AS ""num_tran"" FROM ""transactions"" AS ""t"" RIGHT JOIN ""visits"" AS ""v"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""cons_tran"" AS (SELECT 0 AS ""num_tran"" UNION SELECT ""rn"" FROM (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""transactions"") AS ""tmp"" WHERE ""rn""<=(SELECT MAX(""num_tran"") FROM ""visit_tran_count"")) SELECT ""cons_tran"".""num_tran"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""visit_tran_count"" AS ""vtc"" RIGHT JOIN ""cons_tran"" ON ""vtc"".""num_tran""=""cons_tran"".""num_tran"" GROUP BY 1 ORDER BY 1"
224,"WITH ""tbl"" AS (SELECT COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""seq"" AS (SELECT ""transactions_count"" FROM (SELECT 0 AS ""transactions_count"" UNION SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""Transactions"") AS ""t"" WHERE ""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""tbl"")) SELECT ""seq"".""transactions_count"",COUNT(""tbl"".""transactions_count"") AS ""visits_count"" FROM ""seq"" LEFT JOIN ""tbl"" ON ""seq"".""transactions_count""=""tbl"".""transactions_count"" GROUP BY ""seq"".""transactions_count"" ORDER BY ""seq"".""transactions_count"""
225,"WITH RECURSIVE ""max_trans"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT 1+""transactions_count"" AS ""transactions_count"" FROM ""max_trans"" WHERE ""transactions_count""<(SELECT MAX(""tc"") FROM (SELECT ""tc"",COUNT(1) AS ""cnt"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""tc"" FROM ""transactions"" AS ""t"" RIGHT JOIN ""visits"" AS ""v"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""trans_counter"" GROUP BY 1) AS ""trans_counter2"")), ""total_visits"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""m"".""transactions_count"",COALESCE(""r"".""visits_count"", 0) AS ""visits_count"" FROM ""max_trans"" AS ""m"" LEFT JOIN (SELECT ""trans_count"",COUNT(1) AS ""visits_count"" FROM ""total_visits"" GROUP BY 1) AS ""r"" ON ""m"".""transactions_count""=""r"".""trans_count"" GROUP BY 1"
226,"SELECT CEIL(""id"") AS ""transactions_count"",COALESCE(""num"", 0) AS ""visits_count"" FROM (SELECT (@""t"":=@""t""+1) AS ""id"" FROM ((""Transactions"" AS ""t0"") CROSS JOIN (SELECT @""t"":=0) AS ""b"") CROSS JOIN (SELECT MAX(""cnt"") AS ""maxi"" FROM ""Visits"" AS ""t11"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t21"" ON ""t11"".""user_id""=""t21"".""user_id"" AND ""visit_date""=""transaction_date"") AS ""t31"" WHERE @""t""<""maxi"" UNION SELECT 0) AS ""t33"" LEFT JOIN (SELECT COALESCE(""cnt"", 0) AS ""cnt"",COUNT(1) AS ""num"" FROM ""Visits"" AS ""t1"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY COALESCE(""cnt"", 0)) AS ""t3"" ON ""t33"".""id""=""t3"".""cnt"" ORDER BY ""id"""
227,"WITH RECURSIVE ""cte"" AS (SELECT ""cnt"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",CASE WHEN ""t"".""transaction_date"" IS NOT NULL THEN COUNT(1) ELSE 0 END AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""temp"" GROUP BY ""cnt""), ""cte2"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cte2"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""cte"")) SELECT ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""cte2"" LEFT JOIN ""cte"" USING (""transactions_count"")"
228,"WITH ""t1"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0), ""t2"" AS (SELECT COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""t1"".""rn"" AS ""transactions_count"",COUNT(""t2"".""transactions_count"") AS ""visits_count"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""rn""=""t2"".""transactions_count"" GROUP BY ""t1"".""rn"" HAVING ""t1"".""rn""<=(SELECT MAX(""t2"".""transactions_count"") FROM ""t2"") ORDER BY ""t1"".""rn"""
229,"WITH RECURSIVE ""cte2"" AS (SELECT 0 AS ""x"" UNION SELECT ""x""+1 FROM ""cte2"" WHERE ""x""<(SELECT MAX(""visit_transactions"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""t"".""user_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""visit_transactions"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""sub"")), ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""t"".""user_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""visit_transactions"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""c2"".""x"" AS ""transactions_count"",COUNT(DISTINCT ""user_id"", ""visit_date"") AS ""visits_count"" FROM ""cte1"" AS ""c1"" RIGHT JOIN ""cte2"" AS ""c2"" ON ""c1"".""visit_transactions""=""c2"".""x"" GROUP BY 1"
230,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""cnts"" UNION ALL SELECT ""cnts""+1 FROM ""cte"" WHERE ""cnts""<(SELECT CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE ""rnk"" END FROM (SELECT ""transaction_date"",""rnk"" FROM (SELECT ""a"".""user_id"",""visit_date"",""transaction_date"",""amount"",ROW_NUMBER() OVER (PARTITION BY ""a"".""user_id"", ""visit_date"" ORDER BY ""amount"") AS ""rnk"" FROM ""visits"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"") AS ""c"" ORDER BY ""rnk"" DESC,""transaction_date"" DESC LIMIT 1) AS ""d"")), ""t0"" AS (SELECT ""a"".""user_id"",""visit_date"",""transaction_date"",""amount"",ROW_NUMBER() OVER (PARTITION BY ""a"".""user_id"", ""visit_date"" ORDER BY ""amount"") AS ""rnk"" FROM ""visits"" AS ""a"" LEFT JOIN ""transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date""), ""t1"" AS (SELECT ""rnk"" AS ""trans_cnts"",COUNT(1) AS ""visit_cnts"" FROM (SELECT ""user_id"",""visit_date"",MAX(""rnk"") AS ""rnk"" FROM ""t0"" WHERE ""transaction_date"" IS NOT NULL GROUP BY 1,2) AS ""c"" GROUP BY 1 UNION ALL SELECT 0,COUNT(1) FROM (SELECT ""user_id"",""visit_date"",MAX(""rnk"") AS ""rnk"" FROM ""t0"" WHERE ""transaction_date"" IS NULL GROUP BY 1,2) AS ""c"") SELECT ""cnts"" AS ""transactions_count"",COALESCE(""visit_cnts"", 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN ""t1"" ON ""cte"".""cnts""=""t1"".""trans_cnts"""
231,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions_count"",COUNT(""transactions_count"") AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON (""t2"".""user_id""=""t1"".""user_id"" AND ""t2"".""transaction_date""=""t1"".""visit_date"") GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""transactions_count""), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""t2"".""visits_count"" IS NULL THEN 0 ELSE ""t2"".""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t2"".""transactions_count""=""t1"".""transactions_count"""
232,"WITH ""tran"" AS (SELECT ""a"".""trans_count"" AS ""transactions_count"",COUNT(""a"".""visit_date"") AS ""visits_count"" FROM (SELECT ""v1"".""visit_date"",""v1"".""user_id"",SUM(CASE WHEN (""t1"".""amount"" IS NULL OR ""t1"".""amount""=0) THEN 0 ELSE 1 END) AS ""trans_count"" FROM ""Visits"" AS ""v1"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""v1"".""user_id""=""t1"".""user_id"" AND ""v1"".""visit_date""=""t1"".""transaction_date"" GROUP BY ""v1"".""visit_date"",""v1"".""user_id"") AS ""a"" GROUP BY ""a"".""trans_count"" ORDER BY ""a"".""trans_count""), ""num"" AS (SELECT 0 AS ""num"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""Transactions"") SELECT ""num"".""num"" AS ""transactions_count"",COALESCE(""tran"".""visits_count"", 0) AS ""visits_count"" FROM ""tran"" RIGHT JOIN ""num"" ON ""num"".""num""=""tran"".""transactions_count"" WHERE ""num"".""num""<=(SELECT MAX(""tran"".""transactions_count"") FROM ""tran"")"
233,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""cte"" WHERE ""transactions_count""<(SELECT MAX(""t_count"") FROM (SELECT COUNT(1) AS ""t_count"" FROM ""transactions"" GROUP BY ""transaction_date"",""user_id"") AS ""a"")), ""zero_transac"" AS (SELECT ""amount"",COUNT(1) AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_Date"",COALESCE(""t"".""amount"", 0) AS ""amount"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_Date""=""t"".""transaction_Date"") AS ""b"" WHERE ""amount""=0), ""rest_trans"" AS (SELECT ""t_count"",COUNT(""transaction_date"") AS ""visits_count"" FROM (SELECT ""transaction_date"",COUNT(1) AS ""t_count"" FROM ""transactions"" GROUP BY ""transaction_date"",""user_id"") AS ""c"" GROUP BY ""t_count""), ""d"" AS (SELECT ""cte"".""transactions_count"",COALESCE(""r"".""visits_count"", 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN ""rest_trans"" AS ""r"" ON ""cte"".""transactions_count""=""r"".""t_count"") SELECT * FROM ""d"" WHERE ""transactions_count"">0 UNION ALL SELECT * FROM ""zero_transac"" ORDER BY 1"
234,"WITH ""cte"" AS (SELECT ""visits"".""user_id"",""visits"".""visit_date"",""transactions"".""transaction_date"",COUNT(""transactions"".""amount"") AS ""ct"" FROM ""visits"" LEFT JOIN ""transactions"" ON ""visits"".""user_id""=""transactions"".""user_id"" AND ""visits"".""visit_date""=""transactions"".""transaction_date"" GROUP BY ""visits"".""user_id"",""visits"".""visit_date""), ""cte3"" AS (SELECT ""num"" AS ""transactions_count"" FROM (SELECT 0 AS ""num"" UNION SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""transactions"") AS ""cte2"" WHERE ""num""<=(SELECT MAX(""ct"") FROM ""cte"")) SELECT ""cte3"".""transactions_count"",COUNT(""cte"".""user_id"") AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte"" ON ""cte"".""ct""=""cte3"".""transactions_count"" GROUP BY ""transactions_count"""
235,"WITH ""cte1"" AS (SELECT ""user_id"",""transaction_date"",COUNT(""transaction_date"") AS ""num_trans"" FROM ""transactions"" GROUP BY 1,2), ""cte2"" AS (WITH RECURSIVE ""new"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""new"" WHERE ""transactions_count""<(SELECT MAX(""num_trans"") FROM ""cte1"")) SELECT * FROM ""new""), ""cte3"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""num_trans"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte2"" AS ""c2"" LEFT JOIN ""cte3"" AS ""c3"" ON ""c2"".""transactions_count""=""c3"".""num_trans"" GROUP BY 1 ORDER BY 1"
236,"WITH ""tran"" AS (SELECT ""a"".""trans_count"" AS ""transactions_count"",COUNT(""a"".""visit_date"") AS ""visits_count"" FROM (SELECT ""v1"".""visit_date"",""v1"".""user_id"",SUM(CASE WHEN (""t1"".""amount"" IS NULL OR ""t1"".""amount""=0) THEN 0 ELSE 1 END) AS ""trans_count"" FROM ""Visits"" AS ""v1"" LEFT JOIN ""Transactions"" AS ""t1"" ON ""v1"".""user_id""=""t1"".""user_id"" AND ""v1"".""visit_date""=""t1"".""transaction_date"" GROUP BY ""v1"".""visit_date"",""v1"".""user_id"") AS ""a"" GROUP BY ""a"".""trans_count"" ORDER BY ""a"".""trans_count""), ""num"" AS (SELECT 0 AS ""num"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""Transactions"") SELECT ""num"".""num"" AS ""transactions_count"",COALESCE(""tran"".""visits_count"", 0) AS ""visits_count"" FROM ""tran"" RIGHT JOIN ""num"" ON ""num"".""num""=""tran"".""transactions_count"" WHERE ""num"".""num""<=(SELECT MAX(""tran"".""transactions_count"") FROM ""tran"")"
237,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"" ORDER BY 1), ""cte1"" AS (SELECT ""user_id"",""visit_date"",SUM(""transactions_count"") AS ""cnt"" FROM ""cte"" GROUP BY 1,2), ""cte2"" AS (SELECT ROW_NUMBER() OVER () AS ""rownum"" FROM ""transactions"" UNION SELECT 0) SELECT ""rownum"" AS ""transactions_count"",COUNT(""cnt"") AS ""visits_count"" FROM ""cte1"" RIGHT JOIN ""cte2"" ON ""cnt""=""rownum"" WHERE ""rownum""<=(SELECT MAX(""cnt"") FROM ""cte1"") GROUP BY 1 ORDER BY 1"
238,"WITH ""data"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",""b"".""transaction_date"",COALESCE(""b"".""amount"", 0) AS ""amount"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date""), ""data2"" AS (SELECT ""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions"" FROM ""data"" GROUP BY 1,2), ""seq"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""a"".""rn"" AS ""transactions_count"",COALESCE(COUNT(""b"".""user_id""), 0) AS ""visits_count"" FROM ""seq"" AS ""a"" LEFT JOIN (SELECT ""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions"" FROM ""data"" GROUP BY 1,2) AS ""b"" ON ""a"".""rn""=""b"".""transactions"" WHERE ""rn""<=(SELECT MAX(""transactions"") FROM ""data2"") GROUP BY 1 ORDER BY 1"
239,"WITH RECURSIVE ""seq"" AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""seq"" WHERE ""n""<(SELECT MAX(""t_cnt"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""t_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""a"")), ""t1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""t_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""t2"" AS (SELECT ""t1"".""t_cnt"",COUNT(""visit_date"") AS ""n_visits"" FROM ""t1"" GROUP BY 1) SELECT ""seq"".""n"" AS ""transactions_count"",COALESCE(""n_visits"", 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""t2"" ON ""seq"".""n""=""t2"".""t_cnt"""
240,"WITH ""all_trans"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(""a"".""transactions_count"", 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""a"" ON ""a"".""user_id""=""v"".""user_id"" AND ""a"".""transaction_date""=""v"".""visit_date"") AS ""b"" GROUP BY ""transactions_count""), ""all_counts"" AS (SELECT ""trans_count"" FROM (SELECT ROW_NUMBER() OVER (ORDER BY ""user_id"")-1 AS ""trans_count"" FROM (SELECT ""user_id"" FROM ""Visits"" UNION ALL SELECT ""user_id"" FROM ""Transactions"") AS ""c"") AS ""d"" WHERE ""trans_count""<=(SELECT MAX(""transactions_count"") FROM ""all_trans"")) SELECT ""allc"".""trans_count"" AS ""transactions_count"",COALESCE(""allt"".""visits_count"", 0) AS ""visits_count"" FROM ""all_counts"" AS ""allc"" LEFT JOIN ""all_trans"" AS ""allt"" ON ""allt"".""transactions_count""=""allc"".""trans_count"" ORDER BY ""transactions_count"""
241,"WITH RECURSIVE ""cte2"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cte2"" WHERE ""transactions_count""<(SELECT MAX(""num_trans"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(""transaction_date"") AS ""num_trans"" FROM ""transactions"" GROUP BY 1,2) AS ""cte1"")), ""cte3"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""num_trans"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte2"" AS ""c2"" LEFT JOIN ""cte3"" AS ""c3"" ON ""c2"".""transactions_count""=""c3"".""num_trans"" GROUP BY 1 ORDER BY 1"
242,"WITH ""tmp"" AS (SELECT CASE WHEN ""amount"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits"" FROM ""Transactions"" AS ""t"" RIGHT JOIN ""Visits"" AS ""v"" ON ""t"".""user_id""=""v"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""t"" AS (SELECT ROW_NUMBER() OVER () AS ""rown"" FROM ""Transactions"" UNION ALL SELECT 0) SELECT ""rown"" AS ""transactions_count"",COALESCE(COUNT(""visits""), 0) AS ""visits_count"" FROM ""tmp"" RIGHT JOIN ""t"" ON ""tmp"".""visits""=""t"".""rown"" WHERE ""t"".""rown""<=(SELECT MAX(""visits"") FROM ""tmp"") GROUP BY ""rown"" ORDER BY ""transactions_count"""
243,"WITH RECURSIVE ""tvc"" AS (SELECT ""tm"",COUNT(1) AS ""ct"" FROM (SELECT ""V"".""user_id"",""V"".""visit_date"",COUNT(""T"".""amount"") AS ""tm"" FROM ""visits"" AS ""V"" LEFT JOIN ""transactions"" AS ""T"" ON ""V"".""user_id""=""T"".""user_id"" AND ""V"".""visit_date""=""T"".""transaction_date"" GROUP BY ""V"".""user_id"",""V"".""visit_date"" ORDER BY ""tm"") AS ""A"" GROUP BY ""tm""), ""t2"" (""id"") AS (SELECT 0 UNION ALL SELECT ""id""+1 FROM ""t2"" WHERE ""id""<(SELECT MAX(""tm"") FROM ""tvc"")) SELECT ""t2"".""id"" AS ""transactions_count"",COALESCE(""B"".""ct"", 0) AS ""visits_count"" FROM ""t2"" LEFT JOIN (SELECT ""tm"",COUNT(1) AS ""ct"" FROM (SELECT ""V"".""user_id"",""V"".""visit_date"",COUNT(""T"".""amount"") AS ""tm"" FROM ""visits"" AS ""V"" LEFT JOIN ""transactions"" AS ""T"" ON ""V"".""user_id""=""T"".""user_id"" AND ""V"".""visit_date""=""T"".""transaction_date"" GROUP BY ""V"".""user_id"",""V"".""visit_date"" ORDER BY ""tm"") AS ""A"" GROUP BY ""tm"") AS ""B"" ON ""t2"".""id""=""B"".""tm"""
244,"WITH ""cnt"" AS (SELECT COUNT(""t"".""user_id"") AS ""transactions_count"",1 AS ""visits_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""t"".""user_id""=""v"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""row_num"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION ALL SELECT 0 AS ""rn"") SELECT ""row_num"".""rn"" AS ""transactions_count"",CASE WHEN SUM(""visits_count"") IS NULL THEN 0 ELSE SUM(""visits_count"") END AS ""visits_count"" FROM ""cnt"" RIGHT JOIN ""row_num"" ON ""row_num"".""rn""=""cnt"".""transactions_count"" WHERE ""rn""<=(SELECT MAX(""cnt"".""transactions_count"") FROM ""cnt"") GROUP BY ""row_num"".""rn"" ORDER BY ""transactions_count"""
245,"WITH ""a"" AS (SELECT ""transition_count"",COUNT(""transition_count"") AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",SUM(CASE WHEN ""t2"".""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transition_count"" FROM ""Visits"" AS ""t1"" LEFT JOIN (SELECT * FROM ""Transactions"") AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" AND ""t1"".""visit_date""=""t2"".""transaction_date"" GROUP BY ""t1"".""user_id"",""t1"".""visit_date"") AS ""t3"" GROUP BY ""t3"".""transition_count""), ""T"" AS (SELECT 0 AS ""num_range"" UNION SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"") SELECT ""num_range"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""T"" LEFT JOIN ""a"" ON ""T"".""num_range""=""a"".""transition_count"" WHERE ""num_range""<=(SELECT MAX(""transition_count"") FROM ""a"")"
246,"WITH RECURSIVE ""t2"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""vCnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""t1"" AS (SELECT MAX(""vCnt"") AS ""maxT"" FROM ""t2""), ""tranCnt"" AS (SELECT 0 AS ""n"" UNION SELECT ""n""+1 FROM ""tranCnt"" WHERE ""n""<(SELECT ""maxT"" FROM ""t1"")) SELECT ""tranCnt"".""n"" AS ""transactions_count"",COUNT(""t2"".""user_id"") AS ""visits_count"" FROM ""tranCnt"" LEFT JOIN ""t2"" ON ""tranCnt"".""n""=""t2"".""vCnt"" GROUP BY ""tranCnt"".""n"""
247,"WITH RECURSIVE ""t"" AS (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END AS ""trans"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""u"" AS (SELECT DISTINCT ""user_id"",""visit_date"",SUM(""trans"") OVER (PARTITION BY ""user_id"", ""visit_date"") AS ""transperdayperuser"" FROM ""t""), ""w"" AS (SELECT ""transperdayperuser"",COUNT(""visit_date"") AS ""visits_count"" FROM ""u"" GROUP BY 1), ""seq"" AS (SELECT 0 AS ""value"" UNION ALL SELECT ""value""+1 FROM ""seq"" WHERE ""value""<(SELECT MAX(""transperdayperuser"") FROM ""w"")) SELECT ""seq"".""value"" AS ""transactions_count"",COALESCE(""w"".""visits_count"", 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""w"" ON ""seq"".""value""=""w"".""transperdayperuser"""
248,"WITH RECURSIVE ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""v"".""visit_date"" AS ""visit_date"",COUNT(""t"".""user_id"") AS ""tran"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""c"" AS (SELECT 0 AS ""tran"" UNION SELECT ""tran""+1 AS ""tran"" FROM ""c"" WHERE ""tran""<(SELECT MAX(""tran"") FROM ""t"")) SELECT ""c"".""tran"" AS ""transactions_count"",COUNT(""t"".""tran"") AS ""visits_count"" FROM ""c"" LEFT JOIN ""t"" ON ""c"".""tran""=""t"".""tran"" GROUP BY ""c"".""tran"" ORDER BY ""c"".""tran"""
249,"WITH RECURSIVE ""transac_Per_Visit"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""user_id""), 0) AS ""transacPerVisit"" FROM ""Visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""his"" AS (SELECT ""transacPerVisit"",COUNT(""user_id"") AS ""vc"" FROM ""transac_per_visit"" GROUP BY ""transacPerVisit""), ""min_max"" AS (SELECT 0 AS ""num"",MAX(""transacPerVisit"") AS ""max"" FROM ""transac_per_visit"" AS ""tpv"" UNION SELECT ""num""+1,""max"" FROM ""min_max"" WHERE ""num""<""max"") SELECT ""mm"".""num"" AS ""transactions_count"",COALESCE(""his"".""vc"", 0) AS ""visits_count"" FROM ""min_max"" AS ""mm"" LEFT JOIN ""his"" ON ""mm"".""num""=""his"".""transacPerVisit"" ORDER BY 1"
250,"WITH ""t1"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0), ""t2"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""t1"".""rn"" AS ""transactions_count"",COUNT(""t2"".""transactions_count"") AS ""visits_count"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""rn""=""t2"".""transactions_count"" GROUP BY ""t1"".""rn"" HAVING ""t1"".""rn""<=(SELECT MAX(""t2"".""transactions_count"") FROM ""t2"") ORDER BY ""t1"".""rn"""
251,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
252,"WITH ""records"" AS (SELECT ""Visits"".""user_id"",""Visits"".""visit_date"",COUNT(""Transactions"".""amount"") AS ""transactions_count"" FROM ""Visits"" LEFT JOIN ""Transactions"" ON ""Visits"".""user_id""=""Transactions"".""user_id"" AND ""Visits"".""visit_date""=""Transactions"".""transaction_date"" GROUP BY ""user_id"",""visit_date""), ""cte"" AS (SELECT 0 AS ""rnb"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""rnb"" FROM ""Transactions"") SELECT ""rnb"" AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte"" LEFT JOIN ""records"" ON ""cte"".""rnb""=""records"".""transactions_count"" WHERE ""rnb""<=(SELECT MAX(""transactions_count"") FROM ""records"") GROUP BY ""rnb"" ORDER BY ""rnb"""
253,"WITH ""CTE"" AS (SELECT ""num_tranc"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""num_tranc"" FROM ""Visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" AND ""t1"".""visit_date""=""t2"".""transaction_date"" GROUP BY ""t1"".""user_id"",""t1"".""visit_date"") AS ""temp"" GROUP BY ""num_tranc""), ""CTE2"" AS (SELECT ""row_num"" FROM (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"") AS ""temp"" WHERE ""row_num""<=(SELECT MAX(""transactions_count"") FROM ""CTE"") UNION SELECT 0) SELECT ""row_num"" AS ""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""CTE2"" AS ""t1"" LEFT JOIN ""CTE"" AS ""t2"" ON ""t1"".""row_num""=""t2"".""transactions_count"" ORDER BY ""row_num"""
254,"WITH RECURSIVE ""t1"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""t1"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM (SELECT COUNT(1) AS ""cnt"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""a"")), ""t2"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""a"" GROUP BY 1 UNION ALL SELECT 0 AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""visits"" WHERE ROW(""user_id"",""visit_date"") NOT IN (SELECT ""user_id"",""transaction_date"" FROM ""transactions"")) SELECT ""t1"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""transactions_count""=""t2"".""transactions_count"""
255,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cte"" WHERE ""cnt""<(SELECT COUNT(1) FROM ""Transactions"")), ""temp"" AS (SELECT ""v"".""user_id"",""visit_date"",CASE WHEN ""counts"" IS NULL THEN 0 ELSE ""counts"" END AS ""counts"" FROM ""Visits"" AS ""v"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""counts"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"") SELECT ""cte"".""cnt"" AS ""transactions_count"",CASE WHEN ""vcnt"" IS NULL THEN 0 ELSE ""vcnt"" END AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""counts"",COUNT(1) AS ""vcnt"" FROM ""temp"" GROUP BY ""counts"") AS ""t"" ON ""cte"".""cnt""=""t"".""counts"" WHERE ""cnt""<=(SELECT MAX(""counts"") FROM ""temp"") ORDER BY ""transactions_count"""
256,"WITH RECURSIVE ""a"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""b"" AS (SELECT 0 AS ""transactions_count"",MAX(""transactions_count"") AS ""m"" FROM ""a"" UNION ALL SELECT ""transactions_count""+1,""m"" FROM ""b"" WHERE ""transactions_count""<""m"") SELECT ""b"".""transactions_count"",COALESCE(COUNT(""a"".""transactions_count""), 0) AS ""visits_count"" FROM ""b"" LEFT JOIN ""a"" ON ""b"".""transactions_count""=""a"".""transactions_count"" GROUP BY ""b"".""transactions_count"" ORDER BY ""b"".""transactions_count"""
257,"WITH RECURSIVE ""a"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""b"" AS (SELECT 0 AS ""transactions_count"",MAX(""transactions_count"") AS ""m"" FROM ""a"" UNION ALL SELECT ""transactions_count""+1,""m"" FROM ""b"" WHERE ""transactions_count""<""m"") SELECT ""b"".""transactions_count"",COALESCE(COUNT(""a"".""transactions_count""), 0) AS ""visits_count"" FROM ""b"" LEFT JOIN ""a"" ON ""b"".""transactions_count""=""a"".""transactions_count"" GROUP BY ""b"".""transactions_count"" ORDER BY ""b"".""transactions_count"""
258,"WITH ""cte1"" AS (SELECT ""user_id"",""transaction_date"",""amount"" FROM ""transactions"" GROUP BY 1,2,3), ""cte2"" AS (SELECT ""t_count"" AS ""transactions_count"",COUNT(1) AS ""v_count"" FROM (SELECT ""visit_date"",""v"".""user_id"",SUM(CASE WHEN ""t"".""user_id"" IS NULL THEN 0 ELSE 1 END) AS ""t_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""t"".""user_id""=""v"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""visit_date"",""v"".""user_id"") AS ""a"" GROUP BY ""t_count""), ""possible_transactions"" AS (WITH RECURSIVE ""sub"" AS (SELECT 0 AS ""possible_transactions_per_user"" UNION ALL SELECT ""possible_transactions_per_user""+1 AS ""possible_transactions_per_user"" FROM ""sub"" WHERE ""possible_transactions_per_user""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT * FROM ""sub"") SELECT ""possible_transactions_per_user"" AS ""transactions_count"",CASE WHEN ""transactions_count"" IS NULL THEN 0 ELSE ""v_count"" END AS ""visits_count"" FROM ""possible_transactions"" AS ""p"" LEFT JOIN ""cte2"" AS ""c"" ON ""c"".""transactions_count""=""p"".""possible_transactions_per_user"""
259,"SELECT ""t"".""COUNTS"" AS ""TRANSACTIONS_COUNT"",COALESCE(""c"".""COUNT_NUM"", 0) AS ""VISITS_COUNT"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION SELECT 0) AS ""t"" LEFT JOIN (SELECT COALESCE(""NUM_TRANSACTIONS"", 0) AS ""NUM_TRANSACTIONS"",COUNT(1) AS ""COUNT_NUM"" FROM (SELECT ""a"".""NUM_TRANSACTIONS"" FROM ""VISITS"" AS ""v"" LEFT JOIN (SELECT ""USER_ID"",""TRANSACTION_DATE"" AS ""VISIT_DATE"",COUNT(""AMOUNT"") AS ""NUM_TRANSACTIONS"" FROM ""TRANSACTIONS"" GROUP BY ""USER_ID"",""TRANSACTION_DATE"") AS ""a"" ON ""v"".""USER_ID""=""a"".""USER_ID"" AND ""v"".""VISIT_DATE""=""a"".""VISIT_DATE"") AS ""b"" GROUP BY ""NUM_TRANSACTIONS"") AS ""c"" ON ""t"".""counts""=""c"".""NUM_TRANSACTIONS"" ORDER BY ""t"".""COUNTS"""
260,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY 1,2), ""cte1"" AS (SELECT 0 AS ""rownum"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""rownum"" FROM ""transactions"") SELECT ""rownum"" AS ""transactions_count"",COUNT(""transactions_count"") AS ""visits_count"" FROM ""cte"" RIGHT JOIN ""cte1"" ON ""transactions_count""=""rownum"" WHERE ""rownum""<=(SELECT MAX(""transactions_count"") FROM ""cte"") GROUP BY 1 ORDER BY 1"
261,"WITH RECURSIVE ""CTE"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""CTE"" WHERE ""transactions_count""<100), ""CTE1"" AS (SELECT ""d1"".""user_id"",""d1"".""visit_date"",""d2"".""transaction_date"",""d2"".""amount"" FROM ""Visits"" AS ""d1"" LEFT JOIN ""Transactions"" AS ""d2"" ON ""d1"".""user_id""=""d2"".""user_id"" AND ""d1"".""visit_date""=""d2"".""transaction_date""), ""CTE2"" AS (SELECT ""ct"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM (SELECT ""user_id"",""visit_date"",SUM(""flag"") AS ""ct"" FROM (SELECT ""user_id"",""visit_date"",(CASE WHEN ""amount"" IS NULL THEN 0 ELSE 1 END) AS ""flag"" FROM ""CTE1"") AS ""sub1"" GROUP BY ""user_id"",""visit_date"") AS ""sub2"" GROUP BY ""ct"") SELECT ""CTE"".""transactions_count"",COALESCE(""CTE2"".""visits_count"", 0) AS ""visits_count"" FROM ""CTE"" LEFT JOIN ""CTE2"" ON ""CTE"".""transactions_count""=""CTE2"".""transactions_count"" WHERE ""CTE"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""CTE2"")"
262,"WITH RECURSIVE ""VisitSummary"" AS (SELECT ""Visits"".""user_id"",""Visits"".""visit_date"",COUNT(""Transactions"".""user_id"") AS ""visit_transactions"" FROM ""Visits"" LEFT JOIN ""Transactions"" ON ""Transactions"".""user_id""=""Visits"".""user_id"" AND ""Transactions"".""transaction_date""=""Visits"".""visit_date"" GROUP BY ""Visits"".""user_id"",""Visits"".""visit_date""), ""TransactionMaster"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""TransactionMaster"" WHERE ""transactions_count""<(SELECT MAX(""visit_transactions"") FROM ""VisitSummary"")) SELECT ""TransactionMaster"".""transactions_count"",COUNT(""VisitSummary"".""user_id"") AS ""visits_count"" FROM ""TransactionMaster"" LEFT JOIN ""VisitSummary"" ON ""VisitSummary"".""visit_transactions""=""TransactionMaster"".""transactions_count"" GROUP BY ""TransactionMaster"".""transactions_count"""
263,"SELECT ""id"" AS ""transactions_count"",(SELECT COUNT(1) FROM (SELECT SUM(CASE WHEN ""amount"" IS NULL THEN 0 ELSE 1 END) FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""visit_date"",""v"".""user_id"" HAVING SUM(CASE WHEN ""amount"" IS NULL THEN 0 ELSE 1 END)=""id"") AS ""temp"") AS ""visits_count"" FROM (SELECT 0 AS ""id"" UNION SELECT ROW_NUMBER() OVER () AS ""id"" FROM ""transactions"") AS ""B"" WHERE ""id""<=(SELECT CASE WHEN COUNT(1)=0 THEN 0 ELSE MAX(""num_t"") END FROM (SELECT COUNT(1) AS ""num_t"" FROM ""transactions"" GROUP BY ""transaction_date"",""user_id"") AS ""temp1"")"
264,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"""
265,"WITH RECURSIVE ""trx_by_user"" AS (SELECT COUNT(""t"".""user_id"") AS ""cnt"" FROM ""Transactions"" AS ""t"" GROUP BY ""t"".""transaction_date"",""t"".""user_id""), ""cnt_template"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cnt_template"" WHERE ""cnt""<(SELECT MAX(""cnt"") FROM ""trx_by_user"")), ""trx_by_visit"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""t_cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""t"".""cnt"" AS ""transactions_count"",COUNT(""v"".""user_id"") AS ""visits_count"" FROM ""cnt_template"" AS ""t"" LEFT JOIN ""trx_by_visit"" AS ""v"" ON ""t"".""cnt""=""v"".""t_cnt"" GROUP BY ""t"".""cnt"""
266,"WITH RECURSIVE ""cte"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""tx"".""user_id"") AS ""tx_count"",COUNT(DISTINCT ""v"".""user_id"") AS ""visit_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""tx"" ON ""tx"".""transaction_date""=""v"".""visit_date"" AND ""tx"".""user_id""=""v"".""user_id"" GROUP BY 1,2), ""seq"" AS (SELECT 0 AS ""seq"" UNION ALL SELECT ""seq""+1 AS ""seq"" FROM ""seq"" WHERE ""seq""<(SELECT MAX(""tx_count"") FROM ""cte"")) SELECT ""seq"".""seq"" AS ""transactions_count"",COALESCE(SUM(""cte"".""visit_count""), 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""cte"" ON ""seq"".""seq""=""cte"".""tx_count"" WHERE ""seq"".""seq""<=(SELECT MAX(""tx_count"") FROM ""cte"") GROUP BY 1"
267,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
268,"SELECT CEIL(""id"") AS ""transactions_count"",COALESCE(""num"", 0) AS ""visits_count"" FROM (SELECT (@""t"":=@""t""+1) AS ""id"" FROM ((""Transactions"" AS ""t0"") CROSS JOIN (SELECT @""t"":=0) AS ""b"") CROSS JOIN (SELECT MAX(""cnt"") AS ""maxi"" FROM ""Visits"" AS ""t11"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t21"" ON ""t11"".""user_id""=""t21"".""user_id"" AND ""visit_date""=""transaction_date"") AS ""t31"" WHERE @""t""<""maxi"" UNION SELECT 0) AS ""t33"" LEFT JOIN (SELECT COALESCE(""cnt"", 0) AS ""cnt"",COUNT(1) AS ""num"" FROM ""Visits"" AS ""t1"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY COALESCE(""cnt"", 0)) AS ""t3"" ON ""t33"".""id""=""t3"".""cnt"" ORDER BY ""id"""
269,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
270,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"""
271,"WITH ""tmp"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""ct"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""user_id"",""visit_date""), ""tmp2"" AS (WITH RECURSIVE ""seq"" AS (SELECT 0 AS ""num"" UNION SELECT ""num""+1 FROM ""seq"" WHERE ""num""<(SELECT MAX(""ct"") FROM ""tmp"")) SELECT * FROM ""seq"") SELECT ""num"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""tmp2"" LEFT JOIN ""tmp"" ON ""num""=""ct"" GROUP BY ""num"" ORDER BY 1"
272,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
273,"WITH RECURSIVE ""recur"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""recur"" WHERE ""transactions_count""<(SELECT MAX(""t_cnt"") FROM (SELECT ""t_cnt"",COUNT(""visit_date"") AS ""v_cnt"" FROM (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""t_cnt"" FROM ""Transactions"" AS ""t"" RIGHT JOIN ""Visits"" AS ""v"" ON ""t"".""user_id""=""v"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""user_id"",""visit_date"") AS ""t2"" GROUP BY ""t_cnt"") AS ""t1"")), ""tran_cnt"" AS (SELECT ""t_cnt"",COUNT(""visit_date"") AS ""v_cnt"" FROM (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""t_cnt"" FROM ""Transactions"" AS ""t"" RIGHT JOIN ""Visits"" AS ""v"" ON ""t"".""user_id""=""v"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""user_id"",""visit_date"") AS ""t2"" GROUP BY ""t_cnt"") SELECT ""transactions_count"",COALESCE(""v_cnt"", 0) AS ""visits_count"" FROM ""recur"" LEFT JOIN ""tran_cnt"" ON ""recur"".""transactions_count""=""tran_cnt"".""t_cnt"" GROUP BY ""transactions_count"""
274,"SELECT ""c"".""counts"" AS ""transactions_count"",COUNT(""a"".""transactions_count"") AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN (SELECT COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""a"" ON ""c"".""counts""=""a"".""transactions_count"" GROUP BY ""c"".""counts"" ORDER BY ""c"".""counts"""
275,"WITH RECURSIVE ""tbl1"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""tbl1"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM (SELECT COUNT(1) AS ""cnt"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""a"")), ""tbl3"" AS (SELECT ""cnt"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM (SELECT ""v"".""visit_date"",""v"".""user_id"",SUM(CASE WHEN ""t"".""user_id"" IS NULL THEN 0 ELSE 1 END) AS ""cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""visit_date"",""v"".""user_id"") AS ""tbl2"" GROUP BY 1) SELECT ""tbl1"".""transactions_count"",COALESCE(""tbl3"".""visits_count"", 0) AS ""visits_count"" FROM ""tbl1"" LEFT JOIN ""tbl3"" ON ""tbl1"".""transactions_count""=""tbl3"".""transactions_count"""
276,"WITH RECURSIVE ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",""t"".""transaction_date"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""cte2"" AS (SELECT ""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""cnt"" FROM ""cte1"" GROUP BY ""user_id"",""visit_date""), ""cte3"" (""transactions_count"") AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cte3"" WHERE ""transactions_count""<(SELECT MAX(""cnt"") FROM ""cte2"")), ""cte4"" AS (SELECT ""cnt"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""cte2"" GROUP BY ""cnt"" ORDER BY ""transactions_count"") SELECT ""cte3"".""transactions_count"",COALESCE(""cte4"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte4"" USING (""transactions_count"")"
277,"WITH ""temp"" AS (SELECT ""v"".""user_id"",""visit_date"",(SELECT COUNT(""transaction_date"") FROM ""transactions"" AS ""t"" WHERE ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""t"".""user_id"",""t"".""transaction_date"") AS ""transactions_count"",RANK() OVER (ORDER BY ""v"".""user_id"",""visit_date"") AS ""id"" FROM ""visits"" AS ""v""), ""va"" AS (SELECT COALESCE(""transactions_count"", 0) AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""temp"" GROUP BY ""transactions_count""), ""idnum"" AS (SELECT ROW_NUMBER() OVER () AS ""transactions_count"",0 FROM ""transactions"" UNION SELECT 0,0) SELECT * FROM ""va"" UNION SELECT * FROM ""idnum"" WHERE ""transactions_count"" NOT IN (SELECT ""transactions_count"" FROM ""va"") AND ""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""va"") ORDER BY ""transactions_count"""
278,"WITH RECURSIVE ""counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",""t2"".""transaction_date"" FROM ""visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON (""t2"".""user_id""=""t1"".""user_id"" AND ""t2"".""transaction_date""=""t1"".""visit_date"")) AS ""t"" GROUP BY ""user_id"",""visit_date"") AS ""t"" GROUP BY ""transactions_count""), ""all_counts"" AS (SELECT 0 AS ""transactions_count"" FROM ""counts"" UNION SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT ""t1"".""transactions_count"",CASE WHEN ""t2"".""visits_count"" IS NULL THEN 0 ELSE ""t2"".""visits_count"" END AS ""visits_count"" FROM ""all_counts"" AS ""t1"" LEFT JOIN ""counts"" AS ""t2"" ON ""t2"".""transactions_count""=""t1"".""transactions_count"" ORDER BY ""t1"".""transactions_count"""
279,"WITH ""counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""t"".""transaction_date"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""a"" GROUP BY 1), ""all_counts_tab"" AS (WITH RECURSIVE ""all_counts"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""all_counts"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""counts"")) SELECT * FROM ""all_counts"") SELECT ""a"".""transactions_count"",COALESCE(""b"".""visits_count"", 0) AS ""visits_count"" FROM ""all_counts_tab"" AS ""a"" LEFT JOIN ""counts"" AS ""b"" ON ""a"".""transactions_count""=""b"".""transactions_count"" ORDER BY 1"
280,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
281,"WITH ""r"" AS (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""amount""), 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""rk"" AS (SELECT 0 AS ""n"" UNION SELECT ROW_NUMBER() OVER () AS ""n"" FROM ""Transactions"") SELECT ""rk"".""n"" AS ""transactions_count"",CASE WHEN ""r"".""transactions_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""rk"" LEFT JOIN ""r"" ON ""rk"".""n""=""r"".""transactions_count"" WHERE ""n""<=(SELECT MAX(""transactions_count"") FROM ""r"") GROUP BY 1 ORDER BY 1"
282,"WITH RECURSIVE ""valid_trans_counts"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""valid_trans_counts"" WHERE (""transactions_count""+1)<=(SELECT MAX(""transactions_count"") FROM (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2) AS ""x"")), ""trs"" AS (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2), ""max_num_tr"" AS (SELECT MAX(""transactions_count"") AS ""max_num_tr"" FROM ""trs""), ""trs_per_visit"" AS (SELECT ""v"".""visit_date"",""v"".""user_id"",COALESCE(""t"".""transactions_count"", 0) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""trs"" AS ""t"" ON ""t"".""transaction_date""=""v"".""visit_date"" AND ""v"".""user_id""=""t"".""user_id""), ""t"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""trs_per_visit"" GROUP BY 1) SELECT ""vtc"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""valid_trans_counts"" AS ""vtc"" LEFT JOIN ""t"" ON ""t"".""transactions_count""=""vtc"".""transactions_count"""
283,"WITH ""t1"" AS (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""transaction_count_per_day_n_user"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""user_id"",""visit_date""), ""t2"" AS (SELECT ""transaction_count_per_day_n_user"",COUNT(1) AS ""visits_count"" FROM ""t1"" GROUP BY ""transaction_count_per_day_n_user""), ""t3"" AS (SELECT MAX(""transaction_count_per_day_n_user"") AS ""max_transaction_count_per_day_n_user"" FROM ""t2""), ""RangeOfTransactionsCount"" AS (SELECT ""transactions_count"" FROM (SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") AS ""transactions_count"" FROM ""Transactions"" UNION SELECT 0) AS ""t5"" WHERE ""transactions_count""<=(SELECT ""max_transaction_count_per_day_n_user"" FROM ""t3"")) SELECT ""RangeOfTransactionsCount"".""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""RangeOfTransactionsCount"" LEFT JOIN ""t2"" ON ""t2"".""transaction_count_per_day_n_user""=""RangeOfTransactionsCount"".""transactions_count"" ORDER BY ""RangeOfTransactionsCount"".""transactions_count"""
284,"WITH RECURSIVE ""valid_trans_counts"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""valid_trans_counts"" WHERE (""transactions_count""+1)<=(SELECT MAX(""transactions_count"") FROM (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2) AS ""x"")), ""trs"" AS (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2), ""trs_per_visit"" AS (SELECT ""v"".""visit_date"",""v"".""user_id"",COALESCE(""t"".""transactions_count"", 0) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""trs"" AS ""t"" ON ""t"".""transaction_date""=""v"".""visit_date"" AND ""v"".""user_id""=""t"".""user_id""), ""t"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""trs_per_visit"" GROUP BY 1) SELECT ""vtc"".""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""valid_trans_counts"" AS ""vtc"" LEFT JOIN ""t"" ON ""t"".""transactions_count""=""vtc"".""transactions_count"""
285,"WITH ""visits_cleaned"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""num_visits"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",COUNT(""num_visits"") AS ""visits_count"" FROM ""visits_cleaned"" RIGHT JOIN ""row_nums"" AS ""b"" ON ""b"".""rn""=""visits_cleaned"".""num_visits"" WHERE ""rn""<=(SELECT MAX(""num_visits"") FROM ""visits_cleaned"") GROUP BY ""rn"" ORDER BY ""rn"""
286,"WITH RECURSIVE ""cte1"" AS (SELECT DISTINCT ""user_id"",""transaction_date"",COUNT(""amount"") OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""user_id"",""transaction_date"") AS ""result1"" FROM ""Transactions""), ""cte2"" AS (SELECT ""result1"" AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM (SELECT DISTINCT ""v"".""user_id"",""visit_date"",CASE WHEN ""result1"" IS NULL THEN 0 ELSE ""result1"" END AS ""result1"" FROM ""Visits"" AS ""v"" LEFT JOIN ""cte1"" AS ""c"" ON ""c"".""user_id""=""v"".""user_id"" AND ""c"".""transaction_date""=""v"".""visit_date"") AS ""x"" GROUP BY ""result1""), ""cte3"" AS (SELECT 0 AS ""t1"" UNION ALL SELECT ""t1""+1 FROM ""cte3"" WHERE ""t1""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""t1"" AS ""transactions_count"",CASE WHEN ""visits_count"" IS NULL THEN 0 ELSE ""visits_count"" END AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""t1""=""cte2"".""transactions_count"""
287,"WITH ""num_trans"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(""amount"") AS ""num_trans"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date""), ""nums"" AS (SELECT ""num"" AS ""num_trans"" FROM (SELECT 0 AS ""num"" UNION SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""Transactions"") AS ""a"" WHERE ""num""<=(SELECT MAX(""num_trans"") FROM ""num_trans"")) SELECT ""a"".""num_trans"" AS ""transactions_count"",COUNT(""b"".""user_id"") AS ""visits_count"" FROM ""nums"" AS ""a"" LEFT JOIN ""num_trans"" AS ""b"" ON ""a"".""num_trans""=""b"".""num_trans"" GROUP BY ""a"".""num_trans"""
288,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cte"" WHERE ""cnt""<(SELECT MAX(""tcnt"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""tcnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""f"")) SELECT ""cnt"" AS ""transactions_count"",COUNT(""tcnt"") AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""amount"") AS ""tcnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""t"".""transaction_date""=""v"".""visit_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""f1"" RIGHT JOIN ""cte"" ON ""cte"".""cnt""=""f1"".""tcnt"" GROUP BY ""cnt"" ORDER BY ""cnt"""
289,"WITH ""CTE"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""cte_recur"" AS (WITH RECURSIVE ""TEMP"" AS (SELECT 0 AS ""trans_cnt"" UNION ALL SELECT ""trans_cnt""+1 AS ""trans_cnt"" FROM ""temp"" WHERE ""trans_cnt""<(SELECT MAX(""transaction_count"") FROM ""cte"")) SELECT * FROM ""TEMP"") SELECT ""trans_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte_recur"" AS ""r"" LEFT JOIN ""cte"" AS ""c"" ON ""r"".""trans_cnt""=""c"".""transaction_count"" GROUP BY 1 ORDER BY 1"
290,"WITH ""cte_1"" AS (SELECT ""V"".""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""counts"" FROM ""Visits"" AS ""V"" LEFT JOIN ""Transactions"" AS ""T"" ON ""V"".""visit_date""=""T"".""transaction_date"" AND ""V"".""user_id""=""T"".""user_id"" GROUP BY ""V"".""user_id"",""visit_date"" UNION SELECT ""V"".""user_id"",""visit_date"",COUNT(""transaction_date"") FROM ""Visits"" AS ""V"" RIGHT JOIN ""Transactions"" AS ""T"" ON ""V"".""visit_date""=""T"".""transaction_date"" AND ""V"".""user_id""=""T"".""user_id"" GROUP BY ""V"".""user_id"",""visit_date""), ""cte_2"" AS (SELECT 0 AS ""num"" UNION ALL SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") FROM ""Transactions"") SELECT ""num"" AS ""transactions_count"",COUNT(""counts"") AS ""visits_count"" FROM ""cte_1"" AS ""A"" RIGHT JOIN ""cte_2"" AS ""B"" ON ""A"".""counts""=""B"".""num"" WHERE ""num""<=(SELECT MAX(""counts"") FROM ""cte_1"") GROUP BY ""num"""
291,"WITH RECURSIVE ""cte"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""transaction_date"") AS ""trancount"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""autolist"" AS (SELECT MAX(""trancount"") AS ""num"" FROM ""cte"" UNION ALL SELECT ""num""-1 FROM ""autolist"" WHERE ""num"">0) SELECT ""autolist"".""num"" AS ""transactions_count"",COUNT(""cte"".""trancount"") AS ""visits_count"" FROM ""autolist"" LEFT JOIN ""cte"" ON ""autolist"".""num""=""cte"".""trancount"" GROUP BY ""autolist"".""num"" ORDER BY 1"
292,"WITH ""cte1"" AS (SELECT ""transactions_count"",COUNT(1) AS ""total_count"" FROM (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""t"" GROUP BY 1), ""cte2"" AS (SELECT ""row_num"" FROM (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""transactions"") AS ""t"" WHERE ""row_num""<=(SELECT MAX(""transactions_count"") FROM ""cte1"") UNION SELECT 0) SELECT ""row_num"" AS ""transactions_count"",COALESCE(""total_count"", 0) AS ""visits_count"" FROM ""cte2"" LEFT JOIN ""cte1"" ON ""cte2"".""row_num""=""cte1"".""transactions_count"" ORDER BY 1"
293,"WITH ""cte"" AS (SELECT ""Visits"".""user_id"",""visit_date"",""transaction_date"" FROM ""Visits"" LEFT JOIN ""Transactions"" ON ""Visits"".""user_id""=""Transactions"".""user_id"" AND ""Transactions"".""transaction_date""=""Visits"".""visit_date""), ""cte1"" AS (SELECT COUNT(""transaction_date"") AS ""transactions_count"",""visit_date"" FROM ""cte"" GROUP BY ""user_id"",""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT ROW_NUMBER() OVER (ORDER BY ""user_id"") AS ""transactions_count"" FROM (SELECT ""user_id"" FROM ""Visits"" UNION ALL SELECT ""user_id"" FROM ""Transactions"") AS ""t"" UNION SELECT 0 AS ""transactions_count"") SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"" WHERE ""cte3"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""cte2"") ORDER BY 1"
294,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_cnt"" UNION SELECT 1+""transactions_cnt"" FROM ""cte"" WHERE ""transactions_cnt""<(SELECT MAX(""transactions_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2 ORDER BY 3) AS ""a"")) SELECT ""cte"".""transactions_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""a"" ON ""cte"".""transactions_cnt""=""a"".""transactions_cnt"" GROUP BY 1 ORDER BY 1"
295,"WITH RECURSIVE ""t0"" AS (SELECT 0 AS ""n"" UNION SELECT ""n""+1 FROM ""t0"" WHERE ""n""<(SELECT MAX(""n"") FROM (SELECT ""ina"".""user_id"",""ina"".""visit_date"",COUNT(""amount"") AS ""n"" FROM ""Visits"" AS ""ina"" LEFT JOIN ""Transactions"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""user_id"" AND ""ina"".""visit_date""=""inb"".""transaction_date"" GROUP BY ""ina"".""user_id"",""ina"".""visit_date"") AS ""inc"")), ""t1"" AS (SELECT ""ina"".""user_id"",""ina"".""visit_date"",COUNT(""amount"") AS ""n"" FROM ""Visits"" AS ""ina"" LEFT JOIN ""Transactions"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""user_id"" AND ""ina"".""visit_date""=""inb"".""transaction_date"" GROUP BY ""ina"".""user_id"",""ina"".""visit_date""), ""t2"" AS (SELECT ""n"",COUNT(1) AS ""visits_count"" FROM ""t1"" GROUP BY ""n"") SELECT ""t0"".""n"" AS ""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""t0"" LEFT JOIN ""t2"" ON ""t0"".""n""=""t2"".""n"""
296,"WITH ""tran_index"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""tran_count"" AS (SELECT COUNT(""transactions"".""transaction_date"") AS ""transaction_count"" FROM ""visits"" LEFT JOIN ""transactions"" ON ""visits"".""user_id""=""transactions"".""user_id"" AND ""visits"".""visit_date""=""transactions"".""transaction_date"" GROUP BY ""visits"".""user_id"",""visits"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""tran_index"" LEFT JOIN ""tran_count"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""tran_count"") ORDER BY ""row_num"""
297,"WITH RECURSIVE ""t1"" AS (SELECT MAX(""cnt"") AS ""maxT"" FROM (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""cnt"" FROM ""transactions"" GROUP BY ""transaction_date"",""user_id"") AS ""tb1""), ""tranCnt"" AS (SELECT 0 AS ""n"" UNION SELECT ""n""+1 FROM ""tranCnt"" WHERE ""n""<(SELECT ""maxT"" FROM ""t1"")), ""t2"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""vCnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""tranCnt"".""n"" AS ""transactions_count"",COUNT(""t2"".""user_id"") AS ""visits_count"" FROM ""tranCnt"" LEFT JOIN ""t2"" ON ""tranCnt"".""n""=""t2"".""vCnt"" GROUP BY ""tranCnt"".""n"""
298,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""cte2"" AS (WITH RECURSIVE ""cte3"" AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 AS ""n"" FROM ""cte3"" WHERE ""n""<(SELECT MAX(""cnt"") FROM ""cte"")) SELECT * FROM ""cte3"") SELECT ""n"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""cte2"" LEFT JOIN (SELECT ""cnt"",COUNT(1) AS ""visits_count"" FROM (SELECT ""visit_date"",""user_id"",COUNT(""amount"") AS ""cnt"" FROM (SELECT ""a"".""user_id"",""a"".""visit_date"",""b"".""transaction_date"",""b"".""amount"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"") AS ""x"" GROUP BY 1,2) AS ""y"" GROUP BY 1) AS ""z"" ON ""cte2"".""n""=""z"".""cnt"""
299,"WITH RECURSIVE ""cte"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""num_trans"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date""), ""cte1"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""cte1"" WHERE ""transactions_count""<(SELECT MAX(""num_trans"") FROM ""cte"")) SELECT * FROM (SELECT ""transactions_count"",COUNT(""V"".""user_id"") AS ""visits_count"" FROM (""visits"" AS ""V"" LEFT JOIN ""cte"" AS ""C"" ON ""V"".""user_id""=""C"".""user_id"" AND ""V"".""visit_date""=""C"".""transaction_date"") RIGHT JOIN ""cte1"" AS ""C1"" ON COALESCE(""C"".""num_trans"", 0)=""C1"".""transactions_count"" GROUP BY ""transactions_count"") AS ""t1"""
300,"WITH RECURSIVE ""trans_count"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" AS ""t"" GROUP BY ""transaction_date"",""user_id""), ""trans_count_1"" AS (SELECT ""v"".""user_id"",""transaction_date"",""visit_date"",COALESCE(""transactions_count"", 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""trans_count"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""final"" AS (SELECT ""transactions_count"",COUNT(""t1"".""user_id"") AS ""visits_count"" FROM ""trans_count_1"" AS ""t1"" GROUP BY ""transactions_count"" ORDER BY ""transactions_count""), ""sub"" AS (SELECT 0 AS ""possible_transactions_per_user"" UNION ALL SELECT ""possible_transactions_per_user""+1 AS ""possible_transactions_per_user"" FROM ""sub"" WHERE ""possible_transactions_per_user""<(SELECT MAX(""transactions_count"") FROM ""final"")) SELECT CASE WHEN ""transactions_count"" IS NULL THEN ""possible_transactions_per_user"" ELSE ""transactions_count"" END AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""final"" RIGHT JOIN (SELECT * FROM ""sub"") AS ""a"" ON ""final"".""transactions_count""=""a"".""possible_transactions_per_user"""
301,"WITH ""temp"" AS (SELECT ""V"".""user_id"",""V"".""visit_date"",COUNT(""T"".""user_id"") AS ""transactions_count"" FROM ""Visits"" AS ""V"" LEFT JOIN ""Transactions"" AS ""T"" ON ""V"".""user_id""=""T"".""user_id"" AND ""V"".""visit_date""=""T"".""transaction_date"" GROUP BY ""V"".""user_id"",""V"".""visit_date""), ""rownumbertable"" AS (SELECT 0 AS ""row_num"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions""), ""transactionscount"" AS (SELECT ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""temp"" GROUP BY ""transactions_count"") SELECT ""row_num"" AS ""transactions_count"",COALESCE(""transactionscount"".""visits_count"", 0) AS ""visits_count"" FROM ""rownumbertable"" LEFT JOIN ""transactionscount"" ON ""rownumbertable"".""row_num""=""transactionscount"".""transactions_count"" WHERE ""row_num""<=(SELECT MAX(""transactions_count"") FROM ""transactionscount"") ORDER BY ""row_num"""
302,"WITH RECURSIVE ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""cte3"" WHERE ""transactions_count""+1<=(SELECT COUNT(1) FROM ""transactions"" AS ""t"" GROUP BY ""user_id"",""transaction_date"" ORDER BY COUNT(1) DESC LIMIT 1)), ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""n_transactions"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""n_transactions"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""cte1"" AS ""c1"" GROUP BY ""n_transactions"") SELECT ""c3"".""transactions_count"",COALESCE(""c2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" AS ""c3"" LEFT JOIN ""cte2"" AS ""c2"" ON ""c2"".""transactions_count""=""c3"".""transactions_count"""
303,"WITH RECURSIVE ""trans"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""trans"" WHERE ""transactions_count""<(SELECT MAX(""visit_count"") FROM (SELECT COUNT(1) AS ""visit_count"" FROM (SELECT ""t"".* FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"") AS ""merged_table"" GROUP BY ""transaction_date"",""user_id"" HAVING ""transaction_date"" IS NOT NULL) AS ""visit_count_no_null"")), ""c"" AS (SELECT *,COUNT(1) AS ""visit_counted"" FROM (SELECT ""v"".""user_id"" AS ""user1"",""v"".""visit_date"",""t"".* FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"") AS ""merged_table"" GROUP BY ""transaction_date"",""user_id""), ""counted"" AS (SELECT 0 AS ""transactions_count"",""visit_counted"" AS ""visit_count"" FROM ""c"" WHERE ""transaction_date"" IS NULL UNION ALL SELECT ""visit_counted"" AS ""transactions_count"",COUNT(1) AS ""visit_count"" FROM ""c"" WHERE ""user_id"" IS NOT NULL GROUP BY 1) SELECT ""t"".""transactions_count"",COALESCE(""c"".""visit_count"", 0) AS ""visits_count"" FROM ""trans"" AS ""t"" LEFT JOIN ""counted"" AS ""c"" ON ""t"".""transactions_count""=""c"".""transactions_count"" ORDER BY 1"
304,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
305,"WITH ""t1"" AS (SELECT ""ina"".""user_id"",""ina"".""visit_date"",COUNT(""amount"") AS ""n"" FROM ""Visits"" AS ""ina"" LEFT JOIN ""Transactions"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""user_id"" AND ""ina"".""visit_date""=""inb"".""transaction_date"" GROUP BY ""ina"".""user_id"",""ina"".""visit_date""), ""t2"" AS (SELECT ""n"",COUNT(1) AS ""visits_count"" FROM ""t1"" GROUP BY ""n""), ""t3"" AS (SELECT ROW_NUMBER() OVER () AS ""n"" FROM ""Transactions"" UNION SELECT 0) SELECT ""t3"".""n"" AS ""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""t3"" LEFT JOIN ""t2"" ON ""t3"".""n""=""t2"".""n"" WHERE ""t3"".""n""<=(SELECT MAX(""n"") FROM ""t2"") ORDER BY ""t3"".""n"""
306,"WITH ""t1"" AS (SELECT ""v"".""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""transaction_count_per_day_n_user"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""user_id"",""visit_date""), ""t2"" AS (SELECT ""transaction_count_per_day_n_user"",COUNT(1) AS ""visits_count"" FROM ""t1"" GROUP BY ""transaction_count_per_day_n_user""), ""t3"" AS (SELECT MAX(""transaction_count_per_day_n_user"") AS ""max_transaction_count_per_day_n_user"" FROM ""t2""), ""RangeOfTransactionsCount"" AS (SELECT ""transactions_count"" FROM (SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") AS ""transactions_count"" FROM ""Transactions"" UNION SELECT 0) AS ""t5"" WHERE ""transactions_count""<=(SELECT ""max_transaction_count_per_day_n_user"" FROM ""t3"")) SELECT ""RangeOfTransactionsCount"".""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""RangeOfTransactionsCount"" LEFT JOIN ""t2"" ON ""t2"".""transaction_count_per_day_n_user""=""RangeOfTransactionsCount"".""transactions_count"" ORDER BY ""RangeOfTransactionsCount"".""transactions_count"""
307,"WITH ""cte_joined"" AS (SELECT ""vsts"".""user_id"",""vsts"".""visit_date"",COALESCE(COUNT(""amount""), 0) AS ""transactions_count"" FROM ""Visits"" AS ""vsts"" LEFT JOIN ""Transactions"" AS ""txns"" ON ""vsts"".""user_id""=""txns"".""user_id"" AND ""vsts"".""visit_date""=""txns"".""transaction_date"" GROUP BY 1,2), ""cte_spine"" AS (WITH RECURSIVE ""counter"" (""n"") AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""counter"" WHERE ""n""<(SELECT MAX(""transactions_count"") FROM ""cte_joined"")) SELECT * FROM ""counter""), ""cte_visit_counts"" AS (SELECT ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""cte_joined"" GROUP BY 1), ""cte_assemble"" AS (SELECT ""cte_spine"".""n"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""cte_spine"" LEFT JOIN ""cte_visit_counts"" ON ""cte_spine"".""n""=""cte_visit_counts"".""transactions_count"") SELECT * FROM ""cte_assemble"" ORDER BY ""transactions_count"""
308,"WITH ""cte_1"" AS (SELECT ""V"".""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""counts"" FROM ""Visits"" AS ""V"" LEFT JOIN ""Transactions"" AS ""T"" ON ""V"".""visit_date""=""T"".""transaction_date"" AND ""V"".""user_id""=""T"".""user_id"" GROUP BY ""V"".""user_id"",""visit_date"" UNION SELECT ""V"".""user_id"",""visit_date"",COUNT(""transaction_date"") FROM ""Visits"" AS ""V"" RIGHT JOIN ""Transactions"" AS ""T"" ON ""V"".""visit_date""=""T"".""transaction_date"" AND ""V"".""user_id""=""T"".""user_id"" GROUP BY ""V"".""user_id"",""visit_date""), ""cte_2"" AS (SELECT 0 AS ""num"" UNION ALL SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") FROM ""Transactions"") SELECT ""num"" AS ""transactions_count"",COUNT(""counts"") AS ""visits_count"" FROM ""cte_1"" AS ""A"" RIGHT JOIN ""cte_2"" AS ""B"" ON ""A"".""counts""=""B"".""num"" WHERE ""num""<=(SELECT MAX(""counts"") FROM ""cte_1"") GROUP BY ""num"""
309,"SELECT * FROM (SELECT CAST(""t4"".""id"" AS INTEGER) AS ""transactions_count"",CASE WHEN ""t1"".""visits_count"" IS NULL THEN 0 ELSE ""t1"".""visits_count"" END AS ""visits_count"" FROM (SELECT ""t"".""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""Visits"" LEFT JOIN ""Transactions"" ON ""Visits"".""user_id""=""Transactions"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY ""Visits"".""user_id"",""Visits"".""visit_date"") AS ""t"" GROUP BY ""t"".""transactions_count"") AS ""t1"" RIGHT JOIN (SELECT (@""cnt1"":=@""cnt1""+1) AS ""id"" FROM ""Transactions"" CROSS JOIN (SELECT @""cnt1"":=-1) AS ""dummy"" UNION SELECT 0) AS ""t4"" ON ""t1"".""transactions_count""=""t4"".""id"") AS ""t5"" WHERE ""t5"".""transactions_count""<=(SELECT 0 AS ""cnt"" UNION SELECT COUNT(1) AS ""cnt"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"" ORDER BY ""cnt"" DESC LIMIT 1)"
310,"WITH RECURSIVE ""trans_count"" AS (SELECT 0 AS ""transaction_count"" UNION ALL SELECT ""transaction_count""+1 AS ""transaction_count"" FROM ""trans_count"" WHERE ""transaction_count""<(SELECT MAX(""transaction_count"") FROM (SELECT COUNT(1) AS ""transaction_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""A"")) SELECT ""tc"".""transaction_count"" AS ""transactions_count"",CASE WHEN ""B"".""visits_count"" IS NULL THEN 0 ELSE ""B"".""visits_count"" END AS ""visits_count"" FROM ""trans_count"" AS ""tc"" LEFT JOIN (SELECT ""transaction_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM (SELECT ""visit"".""user_id"",""visit"".""visit_date"",COUNT(""tran"".""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""visit"" LEFT JOIN ""Transactions"" AS ""tran"" ON ""visit"".""user_id""=""tran"".""user_id"" AND ""visit"".""visit_date""=""tran"".""transaction_date"" GROUP BY ""user_id"",""visit_date"") AS ""A"" GROUP BY ""transaction_count"") AS ""B"" ON ""tc"".""transaction_count""=""B"".""transaction_count"""
311,"WITH RECURSIVE ""CTE"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""CTE2"" AS (SELECT 0 AS ""counts"" UNION SELECT ""counts""+1 AS ""counts"" FROM ""CTE2"" WHERE ""counts""<(SELECT MAX(""transactions_count"") FROM ""CTE"")) SELECT ""counts"" AS ""transactions_count"",COUNT(""CTE"".""transactions_count"") AS ""visits_count"" FROM ""CTE2"" LEFT JOIN ""CTE"" ON ""CTE2"".""counts""=""CTE"".""transactions_count"" GROUP BY 1"
312,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
313,"WITH RECURSIVE ""valid_trans_counts"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""valid_trans_counts"" WHERE (""transactions_count""+1)<=(SELECT MAX(""transactions_count"") FROM (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2) AS ""x"")), ""trs"" AS (SELECT ""transaction_date"",""user_id"",COUNT(1) AS ""transactions_count"" FROM ""transactions"" GROUP BY 1,2), ""trs_per_visit"" AS (SELECT ""v"".""visit_date"",""v"".""user_id"",COALESCE(""t"".""transactions_count"", 0) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""trs"" AS ""t"" ON ""t"".""transaction_date""=""v"".""visit_date"" AND ""v"".""user_id""=""t"".""user_id"") SELECT ""vtc"".""transactions_count"",COALESCE(COUNT(""t"".""visit_date""), 0) AS ""visits_count"" FROM ""valid_trans_counts"" AS ""vtc"" LEFT JOIN ""trs_per_visit"" AS ""t"" ON ""t"".""transactions_count""=""vtc"".""transactions_count"" GROUP BY 1"
314,"WITH RECURSIVE ""CTE"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COALESCE(COUNT(""t"".""transaction_date""), 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""CTE2"" AS (SELECT 0 AS ""counts"" UNION SELECT ""counts""+1 AS ""counts"" FROM ""CTE2"" WHERE ""counts""<(SELECT MAX(""transactions_count"") FROM ""CTE"")) SELECT ""counts"" AS ""transactions_count"",COUNT(""CTE"".""transactions_count"") AS ""visits_count"" FROM ""CTE2"" LEFT JOIN ""CTE"" ON ""CTE2"".""counts""=""CTE"".""transactions_count"" GROUP BY 1"
315,"WITH ""CTE"" AS (SELECT ""num_tranc"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""num_tranc"" FROM ""Visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" AND ""t1"".""visit_date""=""t2"".""transaction_date"" GROUP BY ""t1"".""user_id"",""t1"".""visit_date"") AS ""temp"" GROUP BY ""num_tranc""), ""CTE2"" AS (SELECT ""row_num"" FROM (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"") AS ""temp"" WHERE ""row_num""<=(SELECT MAX(""transactions_count"") FROM ""CTE"") UNION SELECT 0) SELECT ""row_num"" AS ""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""CTE2"" AS ""t1"" LEFT JOIN ""CTE"" AS ""t2"" ON ""t1"".""row_num""=""t2"".""transactions_count"" ORDER BY ""row_num"""
316,"SELECT ""c"".""counts"" AS ""transactions_count"",COUNT(""a"".""transactions_count"") AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN (SELECT COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""a"" ON ""c"".""counts""=""a"".""transactions_count"" GROUP BY ""c"".""counts"" ORDER BY 1"
317,"WITH ""r"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""amount"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""rk"" AS (WITH RECURSIVE ""temp"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""temp"" WHERE ""cnt""<(SELECT MAX(""transactions_count"") FROM ""r"")) SELECT * FROM ""temp"") SELECT ""cnt"" AS ""transactions_count"",COUNT(""r"".""transactions_count"") AS ""visits_count"" FROM ""rk"" LEFT JOIN ""r"" ON ""rk"".""cnt""=""r"".""transactions_count"" GROUP BY 1 ORDER BY 1"
318,"WITH RECURSIVE ""summary"" AS (SELECT COALESCE(""transaction_count"", 0) AS ""transaction_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""a"".""user_id"",""a"".""visit_date"",""b"".""transaction_count"" FROM ""visits"" AS ""a"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transaction_count"" FROM ""transactions"" AS ""a"" GROUP BY 1,2) AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"") AS ""c"" GROUP BY 1), ""cte"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 FROM ""cte"" WHERE ""cnt""<(SELECT MAX(""transaction_count"") FROM ""summary"")) SELECT ""cnt"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""cte"" AS ""a"" LEFT JOIN ""summary"" AS ""b"" ON ""a"".""cnt""=""b"".""transaction_count"""
319,"WITH ""t"" AS (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trxn_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",SUM(CASE WHEN ""trxn_count"" IS NOT NULL THEN 1 ELSE 0 END) AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" AS ""r"" ON ""t"".""trxn_count""=""r"".""rn"" WHERE ""r"".""rn""<=(SELECT MAX(""trxn_count"") FROM ""t"") GROUP BY 1 ORDER BY 1"
320,"WITH RECURSIVE ""transactions_count"" AS (SELECT 0 AS ""transaction_count"",0 AS ""visits_count"" UNION ALL SELECT ""transaction_count""+1 AS ""transaction_count"",0 AS ""visits_count"" FROM ""transactions_count"" WHERE ""transaction_count""<(SELECT MAX(""trans_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(DISTINCT ""v"".""visit_date"") AS ""visit_count"",COUNT(""t"".""transaction_date"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""x"")) SELECT ""transaction_count"" AS ""transactions_count"",SUM(""visits_count"") AS ""visits_count"" FROM (SELECT 0 AS ""transaction_count"",COUNT(""v"".""visit_date"") AS ""visits_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" WHERE ""t"".""transaction_date"" IS NULL GROUP BY ""transaction_count"" UNION ALL SELECT ""nb_transactions"" AS ""transaction_count"",COUNT(0) AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(0) AS ""nb_transactions"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" WHERE ""t"".""transaction_date"" IS NOT NULL GROUP BY ""v"".""visit_date"",""v"".""user_id"") AS ""t"" GROUP BY ""transaction_count"" UNION ALL SELECT * FROM ""transactions_count"") AS ""t"" GROUP BY 1 ORDER BY 1"
321,"WITH ""cte1"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""cte2"" AS (SELECT ROW_NUMBER() OVER () AS ""ranking"" FROM ""Transactions"" UNION SELECT 0) SELECT ""ranking"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""cte1"" RIGHT JOIN ""cte2"" ON ""transaction_count""=""ranking"" WHERE ""ranking""<=(SELECT MAX(""transaction_count"") FROM ""cte1"") GROUP BY ""ranking"" ORDER BY 1"
322,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
323,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
324,"WITH RECURSIVE ""cte"" AS (SELECT ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") AS ""temp"" GROUP BY ""transactions_count""), ""CTE2"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 FROM ""CTE2"" WHERE ""transactions_count""<(SELECT MAX(""transactions_count"") FROM ""cte"")) SELECT ""t1"".""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""CTE2"" AS ""t1"" LEFT JOIN ""CTE"" AS ""t2"" ON ""t1"".""transactions_count""=""t2"".""transactions_count"" ORDER BY ""transactions_count"""
325,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",COUNT(""t"".""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""row_nums"".""rn"" AS ""transactions_count"",COUNT(""t"".""transaction_count"") AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
326,"WITH RECURSIVE ""trans_count"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" AS ""t"" GROUP BY ""transaction_date"",""user_id""), ""trans_count_1"" AS (SELECT ""v"".""user_id"",""transaction_date"",""visit_date"",COALESCE(""transactions_count"", 0) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""trans_count"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""final"" AS (SELECT ""transactions_count"",COUNT(""t1"".""user_id"") AS ""visits_count"" FROM ""trans_count_1"" AS ""t1"" GROUP BY ""transactions_count"" ORDER BY ""transactions_count""), ""sub"" AS (SELECT 0 AS ""possible_transactions_per_user"" UNION ALL SELECT ""possible_transactions_per_user""+1 AS ""possible_transactions_per_user"" FROM ""sub"" WHERE ""possible_transactions_per_user""<(SELECT MAX(""transactions_count"") FROM ""final"")) SELECT CASE WHEN ""transactions_count"" IS NULL THEN ""possible_transactions_per_user"" ELSE ""transactions_count"" END AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""final"" RIGHT JOIN (SELECT * FROM ""sub"") AS ""a"" ON ""final"".""transactions_count""=""a"".""possible_transactions_per_user"""
327,"WITH RECURSIVE ""cte1"" AS (SELECT ""user_id"",""transaction_date"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"",""amount""), ""cte2"" AS (SELECT ""user_id"",COUNT(""transaction_date"") AS ""cnt"" FROM ""cte1"" GROUP BY ""user_id""), ""cte3"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 AS ""cnt"" FROM ""cte3"" WHERE ""cnt""<(SELECT MAX(""cnt"") FROM (SELECT COUNT(1) AS ""cnt"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t"")), ""cte4"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",COUNT(""b"".""transaction_date"") AS ""trans_cnt"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date"") SELECT ""a"".""cnt"" AS ""transactions_count"",COALESCE(COUNT(""b"".""visit_date""), 0) AS ""visits_count"" FROM ""cte3"" AS ""a"" LEFT JOIN ""cte4"" AS ""b"" ON ""a"".""cnt""=""b"".""trans_cnt"" GROUP BY ""a"".""cnt"""
328,"SELECT ""c"".""counts"" AS ""transactions_count"",COUNT(""a"".""transactions_count"") AS ""visits_count"" FROM (SELECT DISTINCT ROW_NUMBER() OVER (PARTITION BY ""user_id"", ""transaction_date"" ORDER BY ""transaction_date"") AS ""counts"" FROM ""transactions"" UNION ALL SELECT 0) AS ""c"" LEFT JOIN (SELECT COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"") AS ""a"" ON ""c"".""counts""=""a"".""transactions_count"" GROUP BY ""c"".""counts"" ORDER BY 1"
329,"WITH RECURSIVE ""temp"" AS (SELECT MAX(""num"") AS ""maxim"" FROM (SELECT COUNT(1) AS ""num"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""temb""), ""cte"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""cte"" WHERE ""cte"".""transactions_count""<(SELECT ""maxim"" FROM ""temp"")), ""count_trans"" AS (SELECT ""v"".""visit_date"",""v"".""user_id"",COUNT(""t"".""transaction_date"") AS ""trans"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""visit_date"",""v"".""user_id"") SELECT ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""trans"",COUNT(""visit_date"") AS ""visits_count"" FROM ""count_trans"" GROUP BY ""trans"") AS ""tab1"" ON ""cte"".""transactions_count""=""tab1"".""trans"" ORDER BY ""transactions_count"""
330,"WITH RECURSIVE ""transaction_count"" AS (SELECT 0 AS ""cnt"" UNION ALL SELECT ""cnt""+1 AS ""cnt"" FROM ""transaction_count"" WHERE ""cnt""<(SELECT MAX(""count_tran"") FROM (SELECT ""user_id"",""transaction_date"",COUNT(""transaction_date"") AS ""count_tran"" FROM ""transactions"" GROUP BY 1,2) AS ""a"")), ""user_visit_tran"" AS (SELECT COALESCE(""b"".""count_tran"", 0) AS ""transaction_count1"",COUNT(""a"".""user_id"") AS ""visits_count"" FROM ""visits"" AS ""a"" LEFT JOIN (SELECT ""user_id"",""transaction_date"",COUNT(""transaction_date"") AS ""count_tran"" FROM ""transactions"" GROUP BY 1,2) AS ""b"" ON ""a"".""visit_date""=""b"".""transaction_date"" AND ""a"".""user_id""=""b"".""user_id"" GROUP BY 1) SELECT ""a"".""cnt"" AS ""transactions_count"",COALESCE(""b"".""visits_count"", 0) AS ""visits_count"" FROM ""transaction_count"" AS ""a"" LEFT JOIN ""user_visit_tran"" AS ""b"" ON ""a"".""cnt""=""b"".""transaction_count1"" ORDER BY 1"
331,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY 1,2), ""cte1"" AS (SELECT 0 AS ""rownum"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""rownum"" FROM ""transactions"") SELECT ""rownum"" AS ""transactions_count"",COUNT(""transactions_count"") AS ""visits_count"" FROM ""cte"" RIGHT JOIN ""cte1"" ON ""transactions_count""=""rownum"" WHERE ""rownum""<=(SELECT MAX(""transactions_count"") FROM ""cte"") GROUP BY 1 ORDER BY 1"
332,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_cnt"" UNION SELECT 1+""transactions_cnt"" FROM ""cte"" WHERE ""transactions_cnt""<(SELECT MAX(""transactions_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2 ORDER BY 3) AS ""a"")) SELECT ""cte"".""transactions_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""a"" ON ""cte"".""transactions_cnt""=""a"".""transactions_cnt"" GROUP BY 1 ORDER BY 1"
333,"WITH ""trans"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM (WITH RECURSIVE ""trans_count"" AS (SELECT 0 AS ""n"" UNION ALL SELECT ""n""+1 FROM ""trans_count"" WHERE ""n""<(SELECT MAX(""transactions_count"") FROM ""trans"")) SELECT ""n"" AS ""transactions_count"" FROM ""trans_count"") AS ""test"" LEFT JOIN ""trans"" USING (""transactions_count"") GROUP BY ""transactions_count"""
334,"WITH ""T"" AS (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"" UNION SELECT 0), ""T1"" AS (SELECT COUNT(""transaction_date"") AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date"") SELECT ""row_num"" AS ""transactions_count"",COUNT(""transaction_count"") AS ""visits_count"" FROM ""T"" LEFT JOIN ""T1"" ON ""row_num""=""transaction_count"" GROUP BY ""row_num"" HAVING ""row_num""<=(SELECT MAX(""transaction_count"") FROM ""T1"") ORDER BY ""row_num"""
335,"WITH RECURSIVE ""t"" AS (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END AS ""trans"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""u"" AS (SELECT DISTINCT ""user_id"",""visit_date"",SUM(""trans"") OVER (PARTITION BY ""user_id"", ""visit_date"") AS ""transperdayperuser"" FROM ""t""), ""w"" AS (SELECT ""transperdayperuser"",COUNT(""visit_date"") AS ""visits_count"" FROM ""u"" GROUP BY 1), ""seq"" AS (SELECT 0 AS ""value"" UNION ALL SELECT ""value""+1 FROM ""seq"" WHERE ""value""<(SELECT MAX(""transperdayperuser"") FROM ""w"")) SELECT ""seq"".""value"" AS ""transactions_count"",COALESCE(""w"".""visits_count"", 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""w"" ON ""seq"".""value""=""w"".""transperdayperuser"""
336,"WITH RECURSIVE ""t"" AS (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END AS ""trans"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""u"" AS (SELECT DISTINCT ""user_id"",""visit_date"",SUM(""trans"") OVER (PARTITION BY ""user_id"", ""visit_date"") AS ""transperdayperuser"" FROM ""t""), ""w"" AS (SELECT ""transperdayperuser"",COUNT(""visit_date"") AS ""visits_count"" FROM ""u"" GROUP BY 1), ""seq"" AS (SELECT 0 AS ""value"" UNION ALL SELECT ""value""+1 FROM ""seq"" WHERE ""value""<(SELECT MAX(""transperdayperuser"") FROM ""w"")) SELECT ""seq"".""value"" AS ""transactions_count"",COALESCE(""w"".""visits_count"", 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""w"" ON ""seq"".""value""=""w"".""transperdayperuser"""
337,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""transaction_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""transaction_count"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""t"" RIGHT JOIN ""row_nums"" ON ""transaction_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transaction_count"") FROM ""t"") GROUP BY ""rn"" ORDER BY 1"
338,"WITH RECURSIVE ""max_trans"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT 1+""transactions_count"" AS ""transactions_count"" FROM ""max_trans"" WHERE ""transactions_count""<(SELECT MAX(""tc"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""tc"" FROM ""transactions"" AS ""t"" RIGHT JOIN ""visits"" AS ""v"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""trans_counter"")), ""total_visits"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""amount"") AS ""trans_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) SELECT ""m"".""transactions_count"",COALESCE(""r"".""visits_count"", 0) AS ""visits_count"" FROM ""max_trans"" AS ""m"" LEFT JOIN (SELECT ""trans_count"",COUNT(1) AS ""visits_count"" FROM ""total_visits"" GROUP BY 1) AS ""r"" ON ""m"".""transactions_count""=""r"".""trans_count"" GROUP BY 1"
339,"WITH RECURSIVE ""cte"" AS (SELECT 0 AS ""transactions_cnt"" UNION SELECT 1+""transactions_cnt"" FROM ""cte"" WHERE ""transactions_cnt""<(SELECT MAX(""transactions_count"") FROM (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""user_id"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2 ORDER BY 3) AS ""a"")) SELECT ""cte"".""transactions_cnt"" AS ""transactions_count"",COALESCE(COUNT(""user_id""), 0) AS ""visits_count"" FROM ""cte"" LEFT JOIN (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_cnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY 1,2) AS ""a"" ON ""cte"".""transactions_cnt""=""a"".""transactions_cnt"" GROUP BY 1 ORDER BY 1"
340,"WITH ""cte_1"" AS (SELECT ""V"".""user_id"",""visit_date"",COALESCE(COUNT(""transaction_date""), 0) AS ""counts"" FROM ""Visits"" AS ""V"" LEFT JOIN ""Transactions"" AS ""T"" ON ""V"".""visit_date""=""T"".""transaction_date"" AND ""V"".""user_id""=""T"".""user_id"" GROUP BY ""V"".""user_id"",""visit_date"" UNION SELECT ""V"".""user_id"",""visit_date"",COUNT(""transaction_date"") FROM ""Visits"" AS ""V"" RIGHT JOIN ""Transactions"" AS ""T"" ON ""V"".""visit_date""=""T"".""transaction_date"" AND ""V"".""user_id""=""T"".""user_id"" GROUP BY ""V"".""user_id"",""visit_date""), ""cte_2"" AS (SELECT 0 AS ""num"" UNION ALL SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") FROM ""Transactions"") SELECT ""num"" AS ""transactions_count"",COUNT(""counts"") AS ""visits_count"" FROM ""cte_1"" AS ""A"" RIGHT JOIN ""cte_2"" AS ""B"" ON ""A"".""counts""=""B"".""num"" WHERE ""num""<=(SELECT MAX(""counts"") FROM ""cte_1"") GROUP BY ""num"""
341,"WITH ""by_visit_date"" AS (SELECT ""v"".""user_id"",""visit_date"",SUM(CASE WHEN ""transaction_date"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date""), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""by_visit_date"" RIGHT JOIN ""row_nums"" ON ""transactions_count""=""rn"" WHERE ""rn""<=(SELECT MAX(""transactions_count"") FROM ""by_visit_date"") GROUP BY ""rn"" ORDER BY ""transactions_count"""
342,"WITH RECURSIVE ""t2"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",COUNT(""t"".""transaction_date"") AS ""vCnt"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""t1"" AS (SELECT MAX(""vCnt"") AS ""maxT"" FROM ""t2""), ""tranCnt"" AS (SELECT 0 AS ""n"" UNION SELECT ""n""+1 FROM ""tranCnt"" WHERE ""n""<(SELECT ""maxT"" FROM ""t1"")) SELECT ""tranCnt"".""n"" AS ""transactions_count"",COUNT(""t2"".""user_id"") AS ""visits_count"" FROM ""tranCnt"" LEFT JOIN ""t2"" ON ""tranCnt"".""n""=""t2"".""vCnt"" GROUP BY ""tranCnt"".""n"""
343,"WITH ""trx"" AS ((SELECT ""v"".""visit_date"",SUM(CASE WHEN ""t"".""transaction_date"" IS NULL THEN 0 ELSE 1 END) AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date"")), ""tcounts"" AS (SELECT ROW_NUMBER() OVER () AS ""transactions_count"" FROM ""Transactions"" UNION SELECT 0 AS ""transactions_count"") SELECT ""s"".""transactions_count"",CASE WHEN ""x"".""visit_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""tcounts"" AS ""s"" LEFT JOIN ""trx"" AS ""x"" ON ""s"".""transactions_count""=""x"".""transactions_count"" WHERE ""s"".""transactions_count""<=(SELECT MAX(""transactions_count"") FROM ""trx"") GROUP BY ""transactions_count"" ORDER BY ""transactions_count"""
344,"WITH ""CTE"" AS (SELECT ""num_tranc"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""num_tranc"" FROM ""Visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" AND ""t1"".""visit_date""=""t2"".""transaction_date"" GROUP BY ""t1"".""user_id"",""t1"".""visit_date"") AS ""temp"" GROUP BY ""num_tranc""), ""CTE2"" AS (SELECT ""row_num"" FROM (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"") AS ""temp"" WHERE ""row_num""<=(SELECT MAX(""transactions_count"") FROM ""CTE"") UNION SELECT 0) SELECT ""row_num"" AS ""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""CTE2"" AS ""t1"" LEFT JOIN ""CTE"" AS ""t2"" ON ""t1"".""row_num""=""t2"".""transactions_count"" ORDER BY ""row_num"""
345,"WITH ""cte"" AS (SELECT ""a"".""user_id"",""a"".""visit_date"",SUM(CASE WHEN ""b"".""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""cnt"" FROM ""Visits"" AS ""a"" LEFT JOIN ""Transactions"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"" AND ""a"".""visit_date""=""b"".""transaction_date"" GROUP BY ""a"".""user_id"",""a"".""visit_date""), ""gaps"" AS (WITH RECURSIVE ""cte_count"" (""n"") AS (SELECT 0 UNION ALL SELECT ""n""+1 FROM ""cte_count"" WHERE ""n""<(SELECT MAX(""cnt"") FROM ""cte"")) SELECT ""n"" AS ""transactions_count"" FROM ""cte_count"") SELECT ""b"".""transactions_count"",COUNT(""a"".""user_id"") AS ""visits_count"" FROM ""gaps"" AS ""b"" LEFT JOIN ""cte"" AS ""a"" ON ""b"".""transactions_count""=""a"".""cnt"" GROUP BY ""b"".""transactions_count"""
346,"WITH ""t"" AS (SELECT ""v"".""user_id"" AS ""user_id"",""visit_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE COUNT(1) END AS ""cnt"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""visit_date""=""t"".""transaction_date"" AND ""v"".""user_id""=""t"".""user_id"" GROUP BY 1,2), ""row_nums"" AS (SELECT ROW_NUMBER() OVER () AS ""rn"" FROM ""Transactions"" UNION SELECT 0) SELECT ""rn"" AS ""transactions_count"",CASE WHEN ""cnt"" IS NULL THEN 0 ELSE COUNT(1) END AS ""visits_count"" FROM ""row_nums"" LEFT JOIN ""t"" ON ""cnt""=""rn"" WHERE ""rn""<=(SELECT MAX(""cnt"") FROM ""t"") GROUP BY 1 ORDER BY 1"
347,"WITH ""cte"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""transaction_date"") AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY 1,2), ""cte1"" AS (SELECT 0 AS ""rownum"" UNION ALL SELECT ROW_NUMBER() OVER () AS ""rownum"" FROM ""transactions"") SELECT ""rownum"" AS ""transactions_count"",COUNT(""transactions_count"") AS ""visits_count"" FROM ""cte"" RIGHT JOIN ""cte1"" ON ""transactions_count""=""rownum"" GROUP BY 1 HAVING ""rownum""<=(SELECT MAX(""transactions_count"") FROM ""cte"") ORDER BY ""transactions_count"""
348,"WITH ""CTE"" AS (SELECT ""num_tranc"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM (SELECT ""t1"".""user_id"",""t1"".""visit_date"",COUNT(""t2"".""transaction_date"") AS ""num_tranc"" FROM ""Visits"" AS ""t1"" LEFT JOIN ""transactions"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" AND ""t1"".""visit_date""=""t2"".""transaction_date"" GROUP BY ""t1"".""user_id"",""t1"".""visit_date"") AS ""temp"" GROUP BY ""num_tranc""), ""CTE2"" AS (SELECT ""row_num"" FROM (SELECT ROW_NUMBER() OVER () AS ""row_num"" FROM ""Transactions"") AS ""temp"" WHERE ""row_num""<=(SELECT MAX(""transactions_count"") FROM ""CTE"") UNION SELECT 0) SELECT ""row_num"" AS ""transactions_count"",COALESCE(""t2"".""visits_count"", 0) AS ""visits_count"" FROM ""CTE2"" AS ""t1"" LEFT JOIN ""CTE"" AS ""t2"" ON ""t1"".""row_num""=""t2"".""transactions_count"" ORDER BY ""row_num"""
349,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""v"".""visit_date"",SUM(CASE WHEN ""amount"" IS NOT NULL THEN 1 ELSE 0 END) AS ""transactions_count"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date"" GROUP BY ""v"".""user_id"",""v"".""visit_date""), ""cte2"" AS (SELECT ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" GROUP BY ""transactions_count""), ""cte3"" AS (SELECT 0 AS ""transactions_count"" UNION SELECT (@""cnt"":=@""cnt""+1) AS ""transactions_count"" FROM ""transactions"" CROSS JOIN (SELECT @""cnt"":=-1) AS ""temp"" WHERE @""cnt""<(SELECT MAX(""transactions_count"") FROM ""cte2"")) SELECT ""cte3"".""transactions_count"",COALESCE(""cte2"".""visits_count"", 0) AS ""visits_count"" FROM ""cte3"" LEFT JOIN ""cte2"" ON ""cte3"".""transactions_count""=""cte2"".""transactions_count"""
350,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""visit_date"",COUNT(""amount"") AS ""transactions_count"" FROM ""Visits"" AS ""v"" LEFT JOIN ""Transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date"" GROUP BY ""v"".""user_id"",""visit_date""), ""cte2"" AS (SELECT ROW_NUMBER() OVER () AS ""num"" FROM ""Transactions"" UNION ALL SELECT 0 AS ""num"") SELECT ""num"" AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""cte1"" RIGHT JOIN ""cte2"" ON ""cte1"".""transactions_count""=""cte2"".""num"" WHERE ""num""<=(SELECT MAX(""transactions_count"") FROM ""cte1"") GROUP BY 1 ORDER BY 1"
351,"WITH ""cte1"" AS (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""visit_date""=""transaction_date""), ""cte2"" AS (SELECT COUNT(""transaction_date"") AS ""transactions_count"",COUNT(""visit_date"") AS ""visits_count"" FROM ""cte1"" WHERE ""transaction_date"" IS NULL), ""cte3"" AS (SELECT ""user_id"",COUNT(""transaction_date"") AS ""visits_count"" FROM ""cte1"" WHERE ""transaction_date"" IS NOT NULL GROUP BY ""user_id"",""visit_date""), ""cte_recur"" AS (WITH RECURSIVE ""tmp"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 AS ""transactions_count"" FROM ""tmp"" WHERE ""transactions_count""<(SELECT MAX(""visits_count"") FROM ""cte3"")) SELECT * FROM ""tmp"") SELECT ""cte_recur"".""transactions_count"",COALESCE(""t"".""visits_count"", 0) AS ""visits_count"" FROM ""cte_recur"" LEFT JOIN (SELECT ""visits_count"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""cte3"" GROUP BY ""visits_count"" UNION SELECT * FROM ""cte2"" ORDER BY ""transactions_count"") AS ""t"" ON ""cte_recur"".""transactions_count""=""t"".""transactions_count"""
352,"WITH RECURSIVE ""tc"" AS (SELECT 0 AS ""transactions_count"" UNION ALL SELECT ""transactions_count""+1 FROM ""tc"" WHERE ""transactions_count""<(SELECT MAX(""n_amount"") FROM (SELECT COUNT(""amount"") AS ""n_amount"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""t1"")), ""ut_a"" AS (SELECT COUNT(""amount"") AS ""n_amount"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date""), ""res_p1"" AS (SELECT ""n_amount"" AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""ut_a"" GROUP BY ""n_amount""), ""res_p3"" AS (SELECT 0 AS ""transactions_count"",COUNT(1) AS ""visits_count"" FROM ""Visits"" WHERE ROW(""user_id"",""visit_date"") NOT IN (SELECT DISTINCT ""user_id"",""transaction_date"" FROM ""Transactions"")), ""res_p2"" AS (SELECT * FROM ""res_p3"" UNION ALL SELECT * FROM ""res_p1"") SELECT ""tc"".""transactions_count"",COALESCE(""res_p2"".""visits_count"", 0) AS ""visits_count"" FROM ""tc"" LEFT JOIN ""res_p2"" ON ""tc"".""transactions_count""=""res_p2"".""transactions_count"""
353,"WITH RECURSIVE ""R"" AS (SELECT 0 AS ""t_count"" UNION ALL SELECT ""t_count""+1 FROM ""R"" WHERE ""t_count""<(SELECT COUNT(1) FROM ""Transactions"")), ""T"" AS (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""transactions_count"" FROM ""Transactions"" GROUP BY ""user_id"",""transaction_date""), ""V"" AS (SELECT ""Visits"".""user_id"" FROM ""Visits"" LEFT JOIN ""T"" ON ""Visits"".""user_id""=""T"".""user_id"" AND ""visit_date""=""transaction_date"" WHERE ""transactions_count"" IS NULL) SELECT ""t_count"" AS ""transactions_count"",(CASE WHEN ""t_count""=0 THEN (SELECT COUNT(1) FROM ""V"") ELSE (SELECT COUNT(CASE WHEN ""transactions_count""=""t_count"" THEN 1 END) FROM ""T"") END) AS ""visits_count"" FROM ""R"" WHERE ""t_count""<=COALESCE((SELECT MAX(""transactions_count"") FROM ""T""), 0)"
354,"WITH ""cte"" AS (SELECT ""tot"" AS ""transactions_count"",COUNT(""tot"") AS ""visits_count"" FROM (SELECT ""user_id"",""transaction_date"",COUNT(1) AS ""tot"" FROM ""transactions"" GROUP BY ""user_id"",""transaction_date"") AS ""a"" GROUP BY ""tot""), ""rwnum"" AS (SELECT ROW_NUMBER() OVER (ORDER BY ""transaction_date"") AS ""rw_count"" FROM ""transactions"") SELECT ""r"".""rw_count"" AS ""transactions_count"",COALESCE(""visits_count"", 0) AS ""visits_count"" FROM ""cte"" RIGHT JOIN ""rwnum"" AS ""r"" ON ""cte"".""transactions_count""=""r"".""rw_count"" WHERE ""rw_count""<=(SELECT MAX(""transactions_count"") FROM ""cte"") UNION SELECT 0 AS ""transactions_count"",COUNT(""user_id"") AS ""visits_count"" FROM ""visits"" WHERE ROW(""user_id"",""visit_date"") NOT IN (SELECT ""user_id"",""transaction_date"" FROM ""transactions"") ORDER BY ""transactions_count"""
355,"WITH RECURSIVE ""t"" AS (SELECT ""v"".""user_id"",""visit_date"",""transaction_date"",CASE WHEN ""transaction_date"" IS NULL THEN 0 ELSE 1 END AS ""trans"" FROM ""visits"" AS ""v"" LEFT JOIN ""transactions"" AS ""t"" ON ""v"".""user_id""=""t"".""user_id"" AND ""v"".""visit_date""=""t"".""transaction_date""), ""u"" AS (SELECT DISTINCT ""user_id"",""visit_date"",SUM(""trans"") OVER (PARTITION BY ""user_id"", ""visit_date"") AS ""transperdayperuser"" FROM ""t""), ""w"" AS (SELECT ""transperdayperuser"",COUNT(""visit_date"") AS ""visits_count"" FROM ""u"" GROUP BY 1), ""seq"" AS (SELECT 0 AS ""value"" UNION ALL SELECT ""value""+1 FROM ""seq"" WHERE ""value""<(SELECT MAX(""transperdayperuser"") FROM ""w"")) SELECT ""seq"".""value"" AS ""transactions_count"",COALESCE(""w"".""visits_count"", 0) AS ""visits_count"" FROM ""seq"" LEFT JOIN ""w"" ON ""seq"".""value""=""w"".""transperdayperuser"""
