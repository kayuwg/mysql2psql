id,original query
1,"SELECT DISTINCT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
2,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN (SELECT ""product_id"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""xrank"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""b"".""xrank""=1 ORDER BY 2 DESC"
3,"WITH ""rc"" AS (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""recent_price_change"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""rank_table"" WHERE ""recent_price_change""=1), ""no_rc"" AS (SELECT ""p"".""product_id"",10 AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""rc"" ON ""p"".""product_id""=""rc"".""product_id"" WHERE ""rc"".""product_id"" IS NULL GROUP BY 1) SELECT ""product_id"",""new_price"" AS ""price"" FROM ""rc"" UNION SELECT ""product_id"",""price"" FROM ""no_rc"""
4,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",""change_date"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""abc"" FROM ""products"" HAVING ""change_date""<='2019-08-16') SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""cte"" WHERE ""abc""=""change_date"""
5,"WITH ""temp"" AS (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",(RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC)) AS ""rnk_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""new_price_table"" WHERE ""rnk_date""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""temp"" ON ""p"".""product_id""=""temp"".""product_id"" ORDER BY 1"
6,"WITH ""temp"" AS (SELECT ""product_id"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""temp"" WHERE ""rnk""=1 UNION SELECT ""product_id"",10 FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16')"
7,"WITH ""t"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""products"".""product_id"",CASE WHEN ""t"".""new_price"" IS NULL THEN 10 ELSE ""t"".""new_price"" END AS ""price"" FROM ""products"" LEFT JOIN ""t"" ON ""products"".""product_id""=""t"".""product_id"" AND ""t"".""rnk""=1"
8,"SELECT ""drv"".""product_id"",(CASE WHEN ""tmp"".""new_price"" IS NULL THEN 10 ELSE ""tmp"".""new_price"" END) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""drv"" LEFT JOIN (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""tmp"" ON ""drv"".""product_id""=""tmp"".""product_id"" AND ""rk""=1"
9,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""latest"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""p"".""product_id"",""new_price"" AS ""price"" FROM ""products"" AS ""p"" JOIN ""cte"" ON ""p"".""product_id""=""cte"".""product_id"" AND ""p"".""change_date""=""cte"".""latest"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16'"
10,"SELECT ""p"".""product_id"",MAX(CASE WHEN ""m"".""product_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""max_date"" FROM ""products"" AS ""p"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""m"" ON ""p"".""product_id""=""m"".""product_id"" AND ""p"".""change_date""=""m"".""max_date"" GROUP BY ""product_id"""
11,"SELECT DISTINCT ""pr"".""product_id"",COALESCE(""a"".""price"", 10) AS ""price"" FROM ""Products"" AS ""pr"" LEFT JOIN (SELECT ""product_id"",COALESCE(""new_price"", 10) AS ""price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""a"" ON ""pr"".""product_id""=""a"".""product_id"" AND ""a"".""rnk""=1"
12,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""p2"".""product_id"",""new_price"" FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
13,"WITH ""temp"" AS (SELECT ""product_id"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""temp"" WHERE ""rnk""=1 UNION SELECT ""product_id"",10 FROM ""Products"" WHERE ""change_date"">'2019-08-16' AND ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16')"
14,"WITH ""change_table"" AS (SELECT ""product_id"",""new_price"" AS ""changed_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""recency"" FROM ""products"" AS ""p"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p1"".""product_id"",COALESCE(""ct"".""changed_price"", 10) AS ""price"" FROM ""products"" AS ""p1"" LEFT JOIN ""change_table"" AS ""ct"" ON ""p1"".""product_id""=""ct"".""product_id"" AND ""ct"".""recency""=1"
15,"SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1)"
16,"SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""latest"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""new"" WHERE ""new"".""latest""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
17,"SELECT ""product_id"",CASE WHEN ""change_date"">'2019-08-16' THEN 10 ELSE ""new_price"" END AS ""price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY (CASE WHEN ""change_date"">'2019-08-16' THEN 0 ELSE ""change_date"" END) DESC) AS ""dt_rank"" FROM ""Products"") AS ""a"" WHERE ""dt_rank""=1"
18,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ((SELECT ""p1"".""product_id"",""p1"".""new_price"",""p1"".""change_date"" FROM ""Products"" AS ""p1"" WHERE ROW(""p1"".""product_id"",""p1"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""max_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id""))) AS ""c"" ON ""c"".""product_id""=""p"".""product_id"""
19,"WITH ""t"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t"" WHERE ""rnk""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""t"".""price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""t"" ON ""p"".""product_id""=""t"".""product_id"""
20,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""p2"".""product_id"",""new_price"" FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
21,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""sub2"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<'2019-08-17') AS ""sub2"" ON ""p"".""product_id""=""sub2"".""product_id"" WHERE ""rnk""=1 OR ""rnk"" IS NULL"
22,"SELECT ""p"".""product_id"",CASE WHEN ""rk"" IS NULL THEN 10 ELSE ""tmp"".""new_price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""tmp"" ON ""p"".""product_id""=""tmp"".""product_id"" AND ""rk""=1"
23,"SELECT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price_rank"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""temp"" ON ""temp"".""product_id""=""p"".""product_id"" AND ""temp"".""price_rank""=1 GROUP BY ""p"".""product_id"""
24,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""k"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1)) AS ""k"" ON ""p"".""product_id""=""k"".""product_id"""
25,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rank"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""cte"" AS ""c"" ON (""p"".""product_id""=""c"".""product_id"" AND ""c"".""rank""=1)"
26,"WITH ""cte1"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""cte2"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""cte1"" WHERE ""rnk""=1) SELECT ""p"".""product_id"",COALESCE(""c"".""price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte2"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY 1,2"
27,"SELECT ""p"".""product_id"",""new_price"" AS ""price"" FROM ""products"" AS ""p"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION (SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16')"
28,"SELECT ""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""t1"" LEFT JOIN (SELECT * FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""t2"" WHERE ""rnk""=1) AS ""t3"" USING (""product_id"")"
29,"WITH ""pre_16"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""date_rank"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') (SELECT DISTINCT ""p"".""product_id"",COALESCE(""pre_16"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""pre_16"" ON ""p"".""product_id""=""pre_16"".""product_id"" WHERE ""date_rank""=1) UNION ALL (SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""pre_16""))"
30,"SELECT ""product_id"",MAX(CASE WHEN ""p_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""p_id"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""final_update"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""latest_update_date"" ON ""product_id""=""p_id"" AND ""final_update""=""change_date"" GROUP BY ""product_id"""
31,"WITH ""table_1"" AS (SELECT ""product_id"" FROM ""products"" GROUP BY ""product_id""), ""table_2"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""t1"".""product_id"",COALESCE(""t2"".""price"", 10) AS ""price"" FROM ""table_1"" AS ""t1"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""table_2"" WHERE ""rk""=1) AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"""
32,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte"" AS ""c"" ON (""p"".""product_id""=""c"".""product_id"" AND ""rn""=1)"
33,"WITH ""a"" AS (SELECT ""product_id"",""new_price"",""change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16'), ""b"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""a""), ""c"" AS (SELECT ""product_id"",""new_price"" FROM ""b"" WHERE ""rnk""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""c"" ON ""c"".""product_id""=""p"".""product_id"""
34,"SELECT ""product_id"",MAX(CASE WHEN ""p_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""p_id"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""final_update"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""latest_update_date"" ON ""product_id""=""p_id"" AND ""final_update""=""change_date"" GROUP BY ""product_id"""
35,"SELECT DISTINCT ""t1"".""product_id"",CASE WHEN ""t4"".""product_id"" IS NULL THEN 10 ELSE ""t4"".""new_price"" END AS ""price"" FROM ""products"" AS ""t1"" LEFT JOIN (SELECT ""t2"".""product_id"",""t2"".""new_price"" FROM (SELECT ""t"".""product_id"",""t"".""new_price"",ROW_NUMBER() OVER (PARTITION BY ""t"".""product_id"" ORDER BY ""t"".""change_date"" DESC) AS ""rk"" FROM ""products"" AS ""t"" WHERE ""t"".""change_date""<='2019-08-16') AS ""t2"" WHERE ""t2"".""rk""=1) AS ""t4"" ON ""t1"".""product_id""=""t4"".""product_id"""
36,"SELECT DISTINCT ""product_id"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price"" FROM ""products"" WHERE ""change_date""<='2019-08-16' UNION ALL SELECT DISTINCT ""product_id"",10 FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
37,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""A"" WHERE ""rk""=1) AS ""B"" ON ""p"".""product_id""=""b"".""product_id"""
38,"WITH ""price_date_rank"" AS (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price_rank"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""p"".""product_id"",COALESCE(""r"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""price_date_rank"" AS ""r"" ON ""p"".""product_id""=""r"".""product_id"" AND ""r"".""price_rank""=1 GROUP BY ""p"".""product_id"""
39,"SELECT DISTINCT ""p1"".""product_id"",COALESCE(""p2"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p1"" LEFT JOIN (SELECT ""product_id"",""new_price"",""change_date"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"""
40,"SELECT ""TL"".""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT (""product_id"") AS ""product_id"" FROM ""Products"") AS ""TL"" LEFT JOIN (SELECT * FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""RNK"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""PT"" WHERE ""RNK""=1) AS ""TR"" ON ""TL"".""product_id""=""TR"".""product_id"" ORDER BY ""product_id"""
41,"WITH ""cte1"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""cte"" WHERE ""rn""=1) SELECT ""product_id"",""price"" FROM ""cte1"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte1"")"
42,"SELECT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t"" ON ""p"".""product_id""=""t"".""product_id"" GROUP BY ""p"".""product_id"""
43,"SELECT ""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""t1"".""product_id"",""t3"".""new_price"" FROM ""Products"" AS ""t1"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rank_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t2"" WHERE ""rank_date""=1) AS ""t3"" USING (""product_id"")) AS ""t4"""
44,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""a"" ON ""p"".""product_id""=""a"".""product_id"""
45,"WITH ""uniq_table"" AS (SELECT DISTINCT (""product_id"") FROM ""Products""), ""temp_table"" AS (SELECT ""p1"".""product_id"",""p1"".""new_price"" AS ""price"",""p1"".""change_date"",DENSE_RANK() OVER (PARTITION BY ""p1"".""product_id"" ORDER BY ""p1"".""change_date"" DESC) AS ""row_rank"" FROM ""Products"" AS ""p1"" WHERE ""p1"".""change_date""<='2019-08-16' ORDER BY ""p1"".""product_id"",""p1"".""change_date"" DESC), ""temp_table_2"" AS (SELECT ""un"".""product_id"",COALESCE(""temp"".""price"", 10) AS ""price"",DENSE_RANK() OVER (PARTITION BY ""temp"".""product_id"" ORDER BY ""temp"".""row_rank"") AS ""new_rank"" FROM ""uniq_table"" AS ""un"" LEFT JOIN ""temp_table"" AS ""temp"" ON ""un"".""product_id""=""temp"".""product_id"" ORDER BY ""temp"".""price"" DESC) SELECT ""product_id"",""price"" FROM ""temp_table_2"" WHERE ""new_rank""=1"
46,"WITH ""tmp"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""a"".""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""a"" LEFT JOIN (SELECT * FROM ""tmp"" WHERE ""rnk""=1) AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
47,"SELECT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t"" ON ""p"".""product_id""=""t"".""product_id"" GROUP BY ""p"".""product_id"""
48,"WITH ""prod_ids"" AS (SELECT ""product_id"" FROM ""Products"" GROUP BY ""product_id""), ""t1"" AS (SELECT * FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""prod_rank"" FROM ""products"" WHERE ""change_date""<20190817) AS ""temp"" WHERE ""prod_rank""=1) SELECT ""p"".""product_id"",CASE WHEN ""t"".""new_price"" IS NOT NULL THEN ""t"".""new_price"" ELSE 10 END AS ""price"" FROM ""prod_ids"" AS ""p"" LEFT JOIN ""t1"" AS ""t"" ON ""p"".""product_id""=""t"".""product_id"""
49,"WITH ""t0"" AS (SELECT ""product_id"",""new_price"",EXTRACT(EPOCH FROM ""change_date"") AS ""change_date"",EXTRACT(EPOCH FROM COALESCE(LEAD(""change_date"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date""), CASE WHEN ""change_date""<=DATE('2019-08-16') THEN DATE('2019-08-17') ELSE ""change_date"" END))-1 AS ""next_change_date"" FROM ""Products""), ""t1"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""t0"" WHERE EXTRACT(EPOCH FROM CAST('2019-08-16' AS DATE)) BETWEEN ""change_date"" AND ""next_change_date"" OR EXTRACT(EPOCH FROM CAST('2019-08-16' AS DATE))=""change_date"") SELECT ""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""t1"" RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""tmp"" USING (""product_id"")"
50,"SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""rnk""=1 UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16')"
51,"SELECT ""product_id"",MAX(CASE WHEN ""p_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""p_id"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""final_update"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""latest_update_date"" ON ""product_id""=""p_id"" AND ""final_update""=""change_date"" GROUP BY ""product_id"""
52,"WITH ""s"" AS (SELECT DISTINCT ""product_id"" FROM ""Products""), ""t"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rw"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""s"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""s"" LEFT JOIN ""t"" ON ""s"".""product_id""=""t"".""product_id"" AND ""t"".""rw""=1 ORDER BY ""price"" DESC"
53,"WITH ""temp"" AS (SELECT * FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""t1"" WHERE ""rn""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""temp"" AS ""t"" ON ""p"".""product_id""=""t"".""product_id"""
54,"SELECT ""p2"".""product_id"",COALESCE(""p1"".""price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""p2"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" AS ""p"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""p1"" ON ""p2"".""product_id""=""p1"".""product_id"""
55,"SELECT ""product_id"",MAX(CASE WHEN ""p_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""p_id"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""final_update"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""latest_update_date"" ON ""product_id""=""p_id"" AND ""final_update""=""change_date"" GROUP BY ""product_id"""
56,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",10 AS ""new_price"",'2019-01-01' AS ""change_date"" FROM ""Products"" UNION SELECT * FROM ""Products"") SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""cte"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""rnk""=1"
57,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"" AND ""rnk""=1"
58,"SELECT ""d"".""product_id"",(CASE WHEN ""d"".""new_price"" IS NOT NULL THEN ""d"".""new_price"" ELSE 10 END) AS ""price"" FROM (SELECT DISTINCT ""c"".""product_id"",""b"".""new_price"",""b"".""change_date"" FROM ""products"" AS ""c"" LEFT JOIN ((SELECT ""a"".""product_id"",""a"".""new_price"",""a"".""change_date"" FROM (SELECT *,MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""max_dt"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""products"" WHERE ""change_date""='2019-08-16') AND ""change_date""<'2019-08-16') AS ""a"" WHERE ""a"".""change_date""=""a"".""max_dt"") UNION ALL (SELECT * FROM ""products"" WHERE ""change_date""='2019-08-16')) AS ""b"" ON ""c"".""product_id""=""b"".""product_id"") AS ""d"" ORDER BY ""d"".""product_id"""
59,"SELECT ""T1"".""product_id"",COALESCE(""T2"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""T1"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""T2"" ON ""T1"".""product_id""=""T2"".""product_id"""
60,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""a"".""price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""a"" ON ""p"".""product_id""=""a"".""product_id"""
61,"SELECT ""p"".""product_id"",CASE WHEN ""rk"" IS NULL THEN 10 ELSE ""tmp"".""new_price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""tmp"" ON ""p"".""product_id""=""tmp"".""product_id"" AND ""rk""=1"
62,"WITH ""r"" AS (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<'2019-08-17'), ""t"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""s"" AS (SELECT * FROM ""r"" WHERE ""rnk""=1) SELECT ""t"".""product_id"",COALESCE(""s"".""price"", 10) AS ""price"" FROM ""t"" LEFT JOIN ""s"" ON ""t"".""product_id""=""s"".""product_id"""
63,"SELECT ""t1"".""product_id"",""new_price"" AS ""price"" FROM ""Products"" AS ""t1"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"" AND ""change_date""=""last_date"" UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16')"
64,"WITH ""r"" AS (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<'2019-08-17'), ""t"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""s"" AS (SELECT * FROM ""r"" WHERE ""rnk""=1) SELECT ""t"".""product_id"",COALESCE(""s"".""price"", 10) AS ""price"" FROM ""t"" LEFT JOIN ""s"" ON ""t"".""product_id""=""s"".""product_id"""
65,"WITH ""t"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""t"" ON ""p"".""product_id""=""t"".""product_id"" AND ""rn""=1 GROUP BY 1,2"
66,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN (SELECT ""product_id"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""xrank"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""b"".""xrank""=1 ORDER BY 2 DESC"
67,"SELECT ""product_id"",CASE WHEN ""change_date"">'2019-08-16' THEN 10 ELSE ""new_price"" END AS ""price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY (CASE WHEN ""change_date"">'2019-08-16' THEN 0 ELSE ""change_date"" END) DESC) AS ""dt_rank"" FROM ""Products"") AS ""a"" WHERE ""dt_rank""=1"
68,"WITH ""CTE"" AS (SELECT DISTINCT ""product_id"",LAST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS ""price"" FROM (SELECT * FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""list"") SELECT ""P"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""P"" LEFT JOIN ""CTE"" AS ""C"" USING (""product_id"")"
69,"WITH ""tmp"" AS (SELECT * FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""diff"") AS ""m"" FROM (SELECT ""product_id"",""change_date"",""new_price"",CAST('2019-08-16' AS DATE) - ""change_date"" AS ""diff"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""t"") AS ""t1"" WHERE ""m""=1) SELECT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""p"" LEFT JOIN ""tmp"" AS ""t"" ON ""p"".""product_id""=""t"".""product_id"""
70,"WITH ""CTE"" AS (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""CTE"" WHERE ""rk""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""CTE"")"
71,"WITH ""cte1"" AS (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16'), ""cte2"" AS (SELECT DISTINCT ""p"".""product_id"",COALESCE(""c1"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",""rk"" FROM ""cte1"" WHERE ""rk""=1) AS ""c1"" ON ""c1"".""product_id""=""p"".""product_id"") SELECT * FROM ""cte2"""
72,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date""))>'2019-08-16' ORDER BY ""product_id"""
73,"SELECT ""product_id"",MAX(CASE WHEN ""p_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""p_id"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""final_update"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""latest_update_date"" ON ""product_id""=""p_id"" AND ""final_update""=""change_date"" GROUP BY ""product_id"""
74,"WITH ""combined"" AS (SELECT DISTINCT ""product_id"",10 AS ""price"",'1900-01-01' AS ""dt"" FROM ""products"" UNION ALL SELECT ""product_id"",""new_price"" AS ""price"",""change_date"" AS ""dt"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""temp"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""dt"" DESC) AS ""rk"" FROM ""combined"") SELECT ""product_id"",""price"" FROM ""temp"" WHERE ""rk""=1"
75,"SELECT ""product_id"",MAX(CASE WHEN ""p_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""p_id"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""final_update"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""latest_update_date"" ON ""product_id""=""p_id"" AND ""final_update""=""change_date"" GROUP BY ""product_id"""
76,"WITH ""Table_1"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Table_1"" WHERE ""rnk""=1 UNION SELECT ""product_id"",10 FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""Table_1"")"
77,"SELECT ""c"".""product_id"",10 AS ""price"" FROM ""products"" AS ""c"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""b"".""product_id"",""b"".""new_price"" FROM ""products"" AS ""b"" WHERE ROW(""b"".""product_id"",""b"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""max_d"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
78,"SELECT ""p1"".""product_id"",""p1"".""new_price"" AS ""price"" FROM ""Products"" AS ""p1"" WHERE ""p1"".""change_date""<='2019-08-16' AND ROW(""product_id"",CAST('2019-08-16' AS DATE) - ""p1"".""change_date"") IN (SELECT ""product_id"",MIN(CAST('2019-08-16' AS DATE) - ""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' ORDER BY ""price"" DESC"
79,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""fin"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""fin"" ON ""p"".""product_id""=""fin"".""product_id"" AND ""fin"".""rnk""=1"
80,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""PRODUCT_ID"" HAVING MIN(""CHANGE_DATE"")>'2019-08-16'"
81,"SELECT DISTINCT ""P2"".""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM (SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""P1"" RIGHT JOIN (SELECT ""product_id"" FROM ""Products"") AS ""P2"" ON ""P1"".""product_id""=""P2"".""product_id"""
82,"WITH ""temp"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""temp"" WHERE ""rnk""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')"
83,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"" AND ""rnk""=1"
84,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
85,"SELECT ""pid"".""product_id"",(CASE WHEN ""xyz"".""product_id"" IS NULL THEN 10 ELSE ""xyz"".""new_price"" END) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""pid"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""abc"" WHERE ""rnk""=1) AS ""xyz"" ON ""pid"".""product_id""=""xyz"".""product_id"" ORDER BY 2 DESC"
86,"WITH ""b"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""a"" AS (SELECT ""product_id"",""new_price"",""change_date"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019_08-16') SELECT ""product_id"",(CASE WHEN ""new_price"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM (SELECT ""b"".""product_id"",""new_price"" FROM ""b"" LEFT JOIN ""a"" ON ""b"".""product_id""=""a"".""product_id"" AND ""rnk""=1) AS ""c"""
87,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""product_id"",COALESCE(""new_price"", 10) FROM ""Products"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t1"" USING (""product_id"",""change_date"")"
88,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""p2"".""product_id"",""new_price"" FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
89,"WITH ""cte"" AS (SELECT ""a"".""product_id"",""a"".""new_price"" AS ""latest_price"" FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""lat_price"" FROM ""Products"" AS ""p"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""a"".""lat_price""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""a"".""latest_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""cte"" AS ""a"" ON ""p"".""product_id""=""a"".""product_id"""
90,"ERROR: mysql parse error: line 1 column 224 near "") SELECT product_id, FINAL_PRICE AS price FROM LAST_VALUE_TABLE UNION ALL SELECT DISTINCT(product_id) , 10 AS price FROM Products WHERE product_id NOT IN (SELECT product_id FROM LAST_VALUE_TABLE) "" "
91,"SELECT DISTINCT ""p"".""product_id"",CASE WHEN ""b"".""rnk""=1 THEN ""b"".""nprice"" ELSE 10 END AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""nprice"",""rnk"" FROM (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""b"" WHERE ""rnk""=1) AS ""b"" ON ""p"".""product_id""=""b"".""product_id"""
92,"SELECT DISTINCT ""t1"".""product_id"",COALESCE(""t3"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""t1"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rank_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t2"" WHERE ""rank_date""=1) AS ""t3"" USING (""product_id"")"
93,"WITH ""temp"" AS (SELECT * FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM (SELECT * FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""p"") AS ""m"" WHERE ""m"".""rnk""=1), ""cte"" AS (SELECT ""product_id"" FROM ""Products"" GROUP BY ""product_id"") SELECT ""c"".""product_id"" AS ""product_id"",CASE WHEN ""t"".""new_price"" IS NULL THEN 10 ELSE ""t"".""new_price"" END AS ""price"" FROM ""cte"" AS ""c"" LEFT JOIN ""temp"" AS ""t"" ON ""t"".""product_id""=""c"".""product_id"""
94,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""p"".""change_date"") AS ""change_date"" FROM ""Products"" AS ""p"" WHERE ""p"".""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT DISTINCT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",""change_date"" FROM ""cte"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE (""product_id"") NOT IN (SELECT ""product_id"" FROM ""cte"")"
95,"SELECT DISTINCT ""T1"".""product_id"",COALESCE(""t2"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""t1"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""T2"" ON ""t1"".""product_id""=""t2"".""product_id"""
96,"SELECT ""product_id"",MAX(CASE WHEN ""p_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""p_id"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""final_update"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""latest_update_date"" ON ""product_id""=""p_id"" AND ""final_update""=""change_date"" GROUP BY ""product_id"""
97,"WITH ""cte"" AS (SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""rk""=1) SELECT ""p"".""product_id"",COALESCE(""pr"".""price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""p"" LEFT JOIN ""cte"" AS ""pr"" ON ""p"".""product_id""=""pr"".""product_id"""
98,"SELECT ""p"".""product_id"",CASE WHEN ""t"".""lastday"" THEN ""t"".""new_price"" ELSE 10 END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",""change_date"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""lastday"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t"" ON ""p"".""product_id""=""t"".""product_id"" WHERE ""t"".""lastday""=1 OR ""t"".""lastday"" IS NULL"
99,"WITH ""rc"" AS (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""recent_price_change"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""rank_table"" WHERE ""recent_price_change""=1), ""uni_rc"" AS (SELECT ""p"".""product_id"" FROM ""Products"" AS ""p"" GROUP BY 1) SELECT ""uni_rc"".""product_id"",CASE WHEN ""rc"".""product_id""=""uni_rc"".""product_id"" THEN ""rc"".""new_price"" ELSE 10 END AS ""Price"" FROM ""uni_rc"" LEFT JOIN ""rc"" ON ""rc"".""product_id""=""uni_rc"".""product_id"""
100,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date""))>'2019-08-16' ORDER BY ""product_id"""
101,"SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
102,"SELECT DISTINCT ""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""Products"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") GROUP BY ""product_id"") AS ""t"" USING (""product_id"")"
103,"(SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16') UNION ALL (SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""changerank"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""changerank""=1)"
104,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' AND ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) ORDER BY 1) SELECT * FROM ""cte"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"")"
105,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",""change_date"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""finalprice"" FROM ""Products"" WHERE ""change_date""<='20190816') SELECT DISTINCT ""product_id"",CASE WHEN (""finalprice"" IS NULL OR ""finalprice""=10) THEN 10 ELSE ""finalprice"" END AS ""price"" FROM ""cte"" UNION ALL SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""Products"" WHERE ""change_date""<='20190816')"
106,"SELECT ""p1"".""product_id"",10 AS ""price"" FROM ""Products"" AS ""p1"" GROUP BY ""p1"".""product_id"" HAVING MIN(""p1"".""change_date"")>'2019-08-16' UNION SELECT ""p2"".""product_id"",""p2"".""new_price"" AS ""price"" FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
107,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16'"
108,"WITH ""date_change"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""date_change"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT DISTINCT ""p"".""product_id"",(CASE WHEN ""d"".""date_change"" IS NULL THEN 10 ELSE ""p"".""new_price"" END) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""date_change"" AS ""d"" ON ""p"".""product_id""=""d"".""product_id"" WHERE (""p"".""change_date""=""d"".""date_change"" OR ""d"".""date_change"" IS NULL)"
109,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""P"".""product_id"",COALESCE(""cte"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN ""cte"" ON ""P"".""product_id""=""cte"".""product_id"" AND ""rnk""=1"
110,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte"" AS ""c"" ON (""p"".""product_id""=""c"".""product_id"" AND ""rn""=1)"
111,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16'), ""cte2"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""cte"" WHERE ""rk""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""cte2"".""price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""cte2"" ON ""p"".""product_id""=""cte2"".""product_id"" ORDER BY 2 DESC"
112,"WITH ""t"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""recent_chg_dt"",'Y' AS ""chg_bf"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) SELECT ""p"".""product_id"",""p"".""new_price"" AS ""price"" FROM ""Products"" AS ""p"" JOIN ""t"" ON ""p"".""product_id""=""t"".""product_id"" AND ""p"".""change_date""=""t"".""recent_chg_dt"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""t"")"
113,"SELECT ""sub1"".""product_id"",COALESCE(""sub2"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""sub1"" LEFT JOIN (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranked"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""sub2"" ON ""sub1"".""product_id""=""sub2"".""product_id"" WHERE ""sub2"".""ranked""=1 OR ""sub2"".""ranked"" IS NULL"
114,"SELECT ""t1"".""product_id"",""t1"".""new_price"" AS ""price"" FROM ""products"" AS ""t1"" WHERE ROW(""t1"".""product_id"",""t1"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""max_date"" FROM ""products"" WHERE ""change_date""<=DATE('2019-08-16') GROUP BY ""product_id"") UNION SELECT DISTINCT ""t2"".""product_id"",10 AS ""price"" FROM ""products"" AS ""t2"" GROUP BY ""t2"".""product_id"" HAVING MIN(""t2"".""change_date"")>DATE('2019-08-16')"
115,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""b"".""price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""rnk""=1) AS ""b"" ON ""b"".""product_id""=""p"".""product_id"""
116,"SELECT ""a"".""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM (SELECT ""product_id"" FROM ""products"" GROUP BY ""product_id"") AS ""a"" LEFT JOIN (SELECT * FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""b"" WHERE ""rnk""=1) AS ""c"" ON ""a"".""product_id""=""c"".""product_id"""
117,"SELECT ""t1"".""product_id"",COALESCE(""t2"".""price"", 10) AS ""price"" FROM (SELECT ""product_id"" FROM ""products"" GROUP BY ""product_id"") AS ""t1"" LEFT JOIN (SELECT DISTINCT ""product_id"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"""
118,"SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16') UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
119,"WITH ""temp"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""temp"" WHERE ""rk""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16'"
120,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT DISTINCT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT DISTINCT ""product_id"",MAX(""change_date"") AS ""recent_change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
121,"WITH ""prod_rank"" AS (SELECT ""p"".""product_id"",""p"".""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""p"".""product_id"" ORDER BY ""p"".""change_date"" DESC) AS ""prod_rank"" FROM ""Products"" AS ""p"" WHERE ""p"".""change_date""<='2019-08-16'), ""prod_rank_one"" AS (SELECT ""product_id"",""price"" FROM ""prod_rank"" WHERE ""prod_rank""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""pro"".""price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""prod_rank_one"" AS ""pro"" ON ""p"".""product_id""=""pro"".""product_id"""
122,"WITH ""augmented"" AS (SELECT * FROM ""Products"" UNION ALL SELECT ""product_id"",10 AS ""new_price"",DATE('1900-01-01') AS ""change_date"" FROM ""Products"" GROUP BY ""product_id""), ""temp"" AS (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""augmented"" WHERE ""change_date""<='2019=08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""temp"" WHERE ""rk""=1"
123,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""cdt"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"""
124,"SELECT ""c"".""product_id"",""c"".""price"" FROM (SELECT ""a"".""product_id"",(CASE WHEN ""b"".""rn""=1 THEN ""b"".""new_price"" WHEN ""b"".""rn"" IS NULL THEN 10 ELSE NULL END) AS ""price"" FROM (SELECT DISTINCT (""product_id"") FROM ""products"") AS ""a"" LEFT JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""b"" ON ""a"".""product_id""=""b"".""product_id"") AS ""c"" WHERE ""c"".""price"" IS NOT NULL"
125,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",10 AS ""original"" FROM ""products""), ""cte2"" AS (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""change_date"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rw"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""a"".""rw""=1) SELECT DISTINCT ""cte"".""product_id"",COALESCE(""new_price"", ""original"") AS ""price"" FROM ""cte"" LEFT JOIN ""cte2"" ON ""cte"".""product_id""=""cte2"".""product_id"""
126,"SELECT DISTINCT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""max_date_rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t"" WHERE ""max_date_rnk""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')"
127,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
128,"WITH ""rank1"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16'), ""rank2"" AS (SELECT ""product_id"",""new_price"" FROM ""rank1"" WHERE ""rnk""=1) SELECT ""p"".""product_id"",COALESCE(""r"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""rank2"" AS ""r"" ON ""p"".""product_id""=""r"".""product_id"" GROUP BY 1,2"
129,"WITH ""date_window"" AS (SELECT * FROM (SELECT ""change_date"",""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""PRODUCTS"" WHERE ""change_date""<='2019-08-16') AS ""tt"" WHERE ""rk""=1), ""full_view"" AS (SELECT DISTINCT ""product_id"" AS ""product_listing"",10 AS ""default_price"" FROM ""Products"") SELECT CASE WHEN ""product_id"" IS NULL THEN ""product_listing"" ELSE ""product_id"" END AS ""product_id"",CASE WHEN ""new_price"" IS NULL THEN ""default_price"" ELSE ""new_price"" END AS ""price"" FROM ""date_window"" AS ""dw"" RIGHT JOIN ""full_view"" AS ""fv"" ON ""dw"".""product_id""=""fv"".""product_listing"""
130,"WITH ""temp"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price_rank"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""t1"".""product_id"",(CASE WHEN ""t2"".""product_id"" IS NULL THEN 10 ELSE ""t2"".""new_price"" END) AS ""price"" FROM ""Products"" AS ""t1"" LEFT JOIN (SELECT * FROM ""temp"" WHERE ""price_rank""=1) AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"""
131,"WITH ""a"" AS (SELECT DISTINCT ""product_id"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT * FROM ""a"" UNION ALL SELECT DISTINCT ""product_id"",10 FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""a"")"
132,"SELECT DISTINCT ""Products"".""product_id"",COALESCE(""t1"".""new_price"", 10) AS ""price"" FROM ""Products"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t1"" ON ""Products"".""product_id""=""t1"".""product_id"""
133,"WITH ""updated_price"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""r"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""tmp"" WHERE ""r""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""updated_price"" AS ""u"" ON ""p"".""product_id""=""u"".""product_id"""
134,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
135,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""cte"") UNION SELECT ""product_id"",""price"" FROM ""cte"""
136,"SELECT ""m"".""product_id"",COALESCE(""q"".""new_price"", 10) AS ""price"" FROM ((SELECT * FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""q"" LEFT JOIN (SELECT * FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""qq"" ON ""q"".""product_id""=""qq"".""product_id"" AND ""q"".""change_date""<""qq"".""change_date"") RIGHT JOIN (SELECT DISTINCT (""product_id"") AS ""product_id"" FROM ""products"") AS ""m"" ON ""q"".""product_id""=""m"".""product_id"" WHERE ""qq"".""change_date"" IS NULL"
137,"SELECT ""product_id"",MAX(CASE WHEN ""p_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""p_id"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""final_update"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""latest_update_date"" ON ""product_id""=""p_id"" AND ""final_update""=""change_date"" GROUP BY ""product_id"""
138,"SELECT ""p2"".""product_id"",COALESCE(""p1"".""price"", 10) AS ""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranks"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t"" WHERE ""ranks""=1) AS ""p1"" RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"""
139,"SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION ALL SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") ORDER BY ""product_id"""
140,"WITH ""product_list"" AS (SELECT ""product_id"" FROM ""Products"" GROUP BY ""product_id""), ""latest_price"" AS (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnum"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""latest_price"" WHERE ""rnum""=1 UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""latest_price"") ORDER BY ""product_id"",""price"""
141,"WITH ""a"" AS (SELECT DISTINCT ""product_id"" FROM ""Products""), ""b"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rank_no"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""a"".""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM ""a"" LEFT JOIN ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""rank_no""=1"
142,"SELECT ""t1"".""product_id"",""new_price"" AS ""price"" FROM ""Products"" AS ""t1"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"" AND ""change_date""=""last_date"" UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16')"
143,"WITH ""cte1"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""cte2"" AS (SELECT ""product_id"",""new_price"" FROM ""cte1"" WHERE ""rnk""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""cte2"".""new_price"", 10) AS ""price"" FROM ""cte2"" RIGHT JOIN ""products"" AS ""p"" ON ""cte2"".""product_id""=""p"".""product_id"""
144,"SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""latest"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""new"" WHERE ""new"".""latest""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
145,"WITH ""t"" AS (SELECT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""t1"" AS (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""latest_change"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""t1"" WHERE ""latest_change""=1 UNION SELECT ""product_id"",10 AS ""new_price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""t1"")"
146,"WITH ""a"" AS (SELECT ""product_id"",""new_price"" FROM ""products"" WHERE ""change_date""='2019-08-16'), ""b"" AS (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""pos"" FROM ""products"" WHERE ""change_date""<'2019-08-16' AND ""product_id"" NOT IN (SELECT ""product_id"" FROM ""a"")), ""c"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""b"") AND ""product_id"" NOT IN (SELECT ""product_id"" FROM ""a"")) SELECT ""product_id"",""new_price"" AS ""price"" FROM ""b"" WHERE ""pos""=1 UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""a"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""c"""
147,"WITH ""a"" AS (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""row_num"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""ab"" WHERE ""row_num""=1) SELECT DISTINCT ""b"".""product_id"",COALESCE(""a"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""b"" LEFT JOIN ""a"" ON ""b"".""product_id""=""a"".""product_id"""
148,"WITH ""temp"" (""product_id"", ""price"", ""rk"") AS (SELECT ""product_id"",""new_price"" AS ""price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" AS ""p"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""product_id"",""price"" FROM ""temp"" WHERE ""rk""=1 UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""temp"")"
149,"WITH ""pricechange_id"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT DISTINCT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT * FROM ""pricechange_id"") UNION SELECT ""product_id"",10 FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""pricechange_id"")"
150,"WITH ""temp"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" AS ""p"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""temp"" AS ""t"" ON ""p"".""product_id""=""t"".""product_id"" AND ""t"".""rn""=1"
151,"SELECT ""t1"".""product_id"",COALESCE(""t2"".""price"", 10) AS ""price"" FROM (SELECT ""product_id"" FROM ""products"" GROUP BY ""product_id"") AS ""t1"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""tmp"" WHERE ""rk""=1) AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"""
152,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT * FROM ""Products"" AS ""ps"" WHERE ROW(""ps"".""product_id"",""ps"".""change_date"") IN (SELECT ""pss"".""product_id"",MAX(""pss"".""change_date"") FROM ""Products"" AS ""pss"" WHERE ""pss"".""change_date""<='2019-08-16' GROUP BY ""pss"".""product_id"")) AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"""
153,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
154,"SELECT ""p"".""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranking"" FROM (SELECT * FROM ""products"" WHERE ""change_Date""<='2019-08-16') AS ""A"") AS ""B"" WHERE ""ranking""=1) AS ""C"" ON ""p"".""product_id""=""C"".""product_id"""
155,"WITH ""PRODUCT_PRICE"" AS (SELECT ""PRODUCT_ID"",""NEW_PRICE"" AS ""PRICE"",RANK() OVER (PARTITION BY ""PRODUCT_ID"" ORDER BY ""CHANGE_DATE"" DESC) AS ""RN"" FROM ""PRODUCTS"" WHERE ""CHANGE_DATE""<='2019-08-16'), ""PROD"" AS (SELECT DISTINCT ""PRODUCT_ID"" FROM ""PRODUCTS"") SELECT ""P"".""PRODUCT_ID"",COALESCE(""PC"".""PRICE"", 10) AS ""PRICE"" FROM ""PROD"" AS ""P"" LEFT JOIN ""PRODUCT_PRICE"" AS ""PC"" ON ""P"".""PRODUCT_ID""=""PC"".""PRODUCT_ID"" AND ""RN""=1"
156,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" AND ""rnk""=1"
157,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (WITH ""resultcte"" AS (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""drank"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" FROM ""resultcte"" WHERE ""drank""=1) AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
158,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"" FROM ""Products""), ""cte2"" AS (SELECT ""product_id"",""change_date"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) SELECT ""cte"".""product_id"",(CASE WHEN ""cte2"".""change_date"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""cte"" LEFT JOIN ""cte2"" ON ""cte"".""product_id""=""cte2"".""product_id"""
159,"(SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranks"" FROM ""Products"" WHERE ""change_date""='2019-08-16' OR ""change_date""<'2019-08-16') AS ""t"" WHERE ""ranks""=1) UNION (SELECT ""product_id"",CASE WHEN ""change_date"">'2019-08-16' THEN 10 ELSE ""new_price"" END FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16')"
160,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""p2"".""product_id"",""new_price"" AS ""price"" FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
161,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""cte"") UNION SELECT ""product_id"",""price"" FROM ""cte"""
162,"SELECT DISTINCT ""P"".""product_id"",COALESCE(""tbl"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rank_date"" FROM ""Products"" WHERE CAST('2019-08-16' AS DATE) - ""change_date"">=0) AS ""tbl"" ON ""P"".""product_id""=""tbl"".""product_id"" WHERE ""tbl"".""rank_date""=1 OR ""tbl"".""rank_date"" IS NULL ORDER BY 1"
163,"SELECT ""Products"".""product_id"",COALESCE(""p"".""price"", 10) AS ""price"" FROM ""Products"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""r"" WHERE ""rnk""=1) AS ""p"" ON ""Products"".""product_id""=""p"".""product_id"" GROUP BY ""Products"".""product_id"",""price"""
164,"WITH ""CTE"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranking"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""sub"" WHERE ""ranking""=1) SELECT ""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""CTE"" RIGHT JOIN ""Products"" USING (""product_id"") GROUP BY ""product_id"" ORDER BY ""product_id"""
165,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""a"".""product_id"",CASE WHEN ""b"".""new_price"" IS NULL THEN 10 ELSE ""b"".""new_price"" END AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""rnk""=1"
166,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""p2"".""product_id"",""new_price"" FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
167,"SELECT ""p1"".""product_id"",""p1"".""new_price"" AS ""price"" FROM ""Products"" AS ""p1"" WHERE ""p1"".""change_date""<='2019-08-16' AND ROW(""product_id"",CAST('2019-08-16' AS DATE) - ""p1"".""change_date"") IN (SELECT ""product_id"",MIN(CAST('2019-08-16' AS DATE) - ""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' ORDER BY ""price"" DESC"
168,"ERROR: mysql parse error: line 1 column 4 near ""CASE WHEN rk IS NULL THEN 10 ELSE tmp.new_price END AS price FROM ( SELECT DISTINCT product_id FROM Products) p LEFT JOIN ( SELECT product_id, new_price, ROW_NUMBER() OVER(PARTITION BY product_id ORDER BY change_date DESC) rk FROM Products WHERE change_date <= '2019-08-16' ) tmp ON p.product_id = tmp.product_id AND rk = 1 "" "
169,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""latest"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""p"".""product_id"",""new_price"" AS ""price"" FROM ""products"" AS ""p"" JOIN ""cte"" ON ""p"".""product_id""=""cte"".""product_id"" AND ""p"".""change_date""=""cte"".""latest"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16'"
170,"WITH ""CTE"" AS (SELECT ""product_id"",""new_price"",""change_Date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_Date"" DESC) AS ""prod_rank"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""P"".""product_id"",COALESCE(""C"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN ""CTE"" AS ""C"" ON ""P"".""product_id""=""c"".""product_id"" AND ""prod_rank""=1"
171,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"" AS ""price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranks"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""p"".""product_id"",CASE WHEN ""c"".""price"" IS NULL THEN 10 ELSE ""c"".""price"" END AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""cte"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" WHERE ""c"".""ranks""=1 OR ""c"".""ranks"" IS NULL GROUP BY ""p"".""product_id"",""price"" ORDER BY ""c"".""price"" DESC"
172,"SELECT ""pro"".""product_id"",COALESCE(""pri"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""pro"" LEFT JOIN (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price_rank"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""pri"" ON ""pro"".""product_id""=""pri"".""product_id"" AND ""price_rank""=1"
173,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""tt"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT * FROM ""cte"" WHERE ""rn""=1) AS ""tt"" ON ""p"".""product_id""=""tt"".""product_id"""
174,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" RIGHT JOIN ""Products"" AS ""p"" USING (""Product_id"")"
175,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",""change_date"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""max_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""product_id"",COALESCE(""T"".""new_price"", 10) AS ""price"" FROM ""Products"" LEFT JOIN (SELECT * FROM ""cte"" WHERE ""change_date""=""max_date"") AS ""T"" USING (""product_id"")"
176,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN (SELECT ""product_id"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""xrank"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""b"".""xrank""=1 ORDER BY 2 DESC"
177,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t"" ON ""p"".""product_id""=""t"".""product_id"" AND ""rk""=1"
178,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""max_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')"
179,"SELECT ""t1"".""product_id"" AS ""product_id"",CASE WHEN ""t2"".""price"" IS NULL THEN 10 ELSE ""t2"".""price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""t1"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"""
180,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"""
181,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""r"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""cte2"" AS (SELECT ""product_id"",""new_price"" FROM ""cte"" WHERE ""r""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""cte2"".""new_price"", 10) AS ""price"" FROM ""cte2"" RIGHT JOIN ""products"" AS ""p"" ON ""cte2"".""product_id""=""p"".""product_id"""
182,"SELECT ""PRODUCT_ID"",""NEW_PRICE"" AS ""PRICE"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""PRODUCT_ID"" ORDER BY ""CHANGE_DATE"" DESC) AS ""LATEST"" FROM ""PRODUCTS"" WHERE ""CHANGE_DATE""<='2019-08-16') AS ""A"" WHERE ""A"".""LATEST""=1 UNION SELECT ""PRODUCT_ID"",10 AS ""PRICE"" FROM ""PRODUCTS"" GROUP BY ""PRODUCT_ID"" HAVING MIN(""CHANGE_DATE"")>'2019-08-16'"
183,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""a"" LEFT JOIN (SELECT * FROM ""cte"" WHERE ""rnk""=1) AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
184,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
185,"SELECT DISTINCT ""P"".""product_id"",COALESCE(""T1"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT ""product_id"",""change_date"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""T1"" ON ""P"".""product_id""=""T1"".""product_id"" AND ""T1"".""rnk""=1 ORDER BY COALESCE(""T1"".""new_price"", 10) DESC"
186,"SELECT ""p1"".""product_id"",""p1"".""new_price"" AS ""price"" FROM ""Products"" AS ""p1"" JOIN (SELECT ""p2"".""product_id"" AS ""prod"",MAX(""p2"".""change_date"") AS ""latest"" FROM ""Products"" AS ""p2"" WHERE ""change_date""<=DATE('2019-08-16') GROUP BY ""product_id"") AS ""tbl1"" ON ""p1"".""product_id""=""tbl1"".""prod"" AND ""p1"".""change_date""=""tbl1"".""latest"" UNION ALL SELECT ""p3"".""product_id"",10 FROM ""Products"" AS ""p3"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>DATE('2019-08-16')"
187,"WITH ""CTE"" AS (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranking"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""a"".""product_id"",CASE WHEN ""CTE"".""product_id"" IS NULL THEN 10 ELSE ""CTE"".""new_price"" END AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN ""CTE"" ON ""a"".""product_id""=""CTE"".""product_id"" AND ""ranking""=1 GROUP BY ""a"".""product_id"""
188,"WITH ""main"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""main"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""main"" ON ""p"".""product_id""=""main"".""product_id"" AND ""rnk""=1"
189,"SELECT ""p"".""product_id"",CASE WHEN ""n"".""product_id"" IS NULL THEN 10 ELSE ""n"".""new_price"" END AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""n"" ON ""p"".""product_id""=""n"".""product_id"" AND ""n"".""rnk""=1 GROUP BY 1,2 ORDER BY 2 DESC"
190,"SELECT DISTINCT ""p1"".""product_id"",COALESCE(""p2"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p1"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"""
191,"SELECT ""TL"".""product_id"",COALESCE(""new_price"", 10) AS ""Price"" FROM (SELECT DISTINCT (""product_id"") AS ""product_id"" FROM ""Products"") AS ""TL"" LEFT JOIN (SELECT * FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranking"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t"" WHERE ""ranking""=1) AS ""TR"" ON ""TL"".""product_id""=""TR"".""product_id"""
192,"SELECT * FROM (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')) AS ""tmp"""
193,"WITH ""maxed"" AS (SELECT DISTINCT ""product_id"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""m"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""Products"".""product_id"",COALESCE(""m"", 10) AS ""price"" FROM ""Products"" LEFT JOIN ""maxed"" ON ""Products"".""product_id""=""maxed"".""product_id"""
194,"WITH ""r"" AS (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<'2019-08-17'), ""t"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""s"" AS (SELECT * FROM ""r"" WHERE ""rnk""=1) SELECT ""t"".""product_id"",COALESCE(""s"".""price"", 10) AS ""price"" FROM ""t"" LEFT JOIN ""s"" ON ""t"".""product_id""=""s"".""product_id"""
195,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""max_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16')"
196,"WITH ""temp"" AS (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",(RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC)) AS ""rnk_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""new_price_table"" WHERE ""rnk_date""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""temp"" ON ""p"".""product_id""=""temp"".""product_id"" ORDER BY 1"
197,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16'"
198,"SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""latest"" FROM ""Products"" WHERE ""change_date""<'2019-08-17') AS ""new"" WHERE ""new"".""latest""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
199,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t"" ON ""p"".""product_id""=""t"".""product_id"""
200,"WITH ""CTE"" AS (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""pricing_order"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""CTE2"" AS (SELECT DISTINCT ""product_id"" FROM ""products"") SELECT ""cte2"".""product_id"",COALESCE(""cte"".""new_price"", 10) AS ""price"" FROM ""cte2"" LEFT JOIN ""cte"" ON ""cte"".""product_id""=""cte2"".""product_id"" AND ""pricing_order""=1"
201,"SELECT ""Product_ID"",""price"" FROM (SELECT ""Product_ID"",""new_price"" AS ""Price"",RANK() OVER (PARTITION BY ""product_ID"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""rnk""=1 UNION SELECT ""Product_ID"",10 FROM ""Products"" WHERE ""product_ID"" NOT IN (SELECT ""Product_ID"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')"
202,"WITH ""cte"" AS (SELECT ""product_id"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""price"" FROM ""cte"" UNION SELECT ""product_id"",10 FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"")"
203,"SELECT DISTINCT ""p"".""product_id"",(CASE WHEN ""temp"".""recent_price"" IS NULL THEN 10 ELSE ""recent_price"" END) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT *,FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""recent_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"""
204,"WITH ""id"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""newest_date"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""i"".""product_id"",COALESCE(""n"".""new_price"", 10) AS ""price"" FROM ""id"" AS ""i"" LEFT JOIN ""newest_date"" AS ""n"" ON ""i"".""product_id""=""n"".""product_id"" AND ""rnk""=1"
205,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT DISTINCT ""product_id"",10 FROM ""Products"" GROUP BY ""Product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
206,"SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"">'2019-08-16') UNION ALL SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") GROUP BY ""product_id"" HAVING MAX(""change_date"")<='2019-08-16'"
207,"WITH ""a"" AS (SELECT ""product_id"",""new_price"",""change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16'), ""b"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""a""), ""c"" AS (SELECT ""product_id"",""new_price"" FROM ""b"" WHERE ""rnk""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""c"" ON ""c"".""product_id""=""p"".""product_id"""
208,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte"" AS ""c"" ON (""p"".""product_id""=""c"".""product_id"" AND ""rn""=1)"
209,"SELECT DISTINCT ""c"".""product_id"",COALESCE(""d"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""c"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""max_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""d"" ON ""c"".""product_id""=""d"".""product_id"""
210,"WITH ""t1"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""date_rank"" FROM ""Products"" WHERE ""change_date"" - CAST('2019-08-16' AS DATE)<=0) SELECT ""t2"".""product_id"",CASE WHEN ""t1"".""date_rank""=1 THEN ""t1"".""new_price"" ELSE 10 END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""t2"" LEFT JOIN ""t1"" ON ""t2"".""product_id""=""t1"".""product_id"" WHERE ""t1"".""date_rank""=1 OR ""t1"".""date_rank"" IS NULL"
211,"SELECT ""E"".""product_id"",COALESCE(""D"".""new_price"", 10) AS ""Price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""E"" LEFT JOIN (SELECT ""B"".""product_id"",""B"".""change_date"",""C"".""new_price"" FROM (SELECT ""A"".""product_id"",MAX(""A"".""change_date"") AS ""change_date"" FROM (SELECT * FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""A"" GROUP BY ""A"".""Product_id"") AS ""B"" LEFT JOIN ""Products"" AS ""C"" ON ""B"".""product_id""=""C"".""product_id"" AND ""B"".""Change_date""=""C"".""change_date"") AS ""D"" ON ""E"".""product_id""=""D"".""product_id"""
212,"WITH ""cte"" AS (SELECT * FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""temp"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""cte"" GROUP BY ""product_id""), ""sub"" AS (SELECT ""temp"".""product_id"",""p"".""new_price"" FROM ""temp"" JOIN ""products"" AS ""p"" ON ""temp"".""product_id""=""p"".""product_id"" AND ""temp"".""change_date""=""p"".""change_date""), ""demo"" AS (SELECT DISTINCT ""product_id"" FROM ""products"") SELECT ""demo"".""product_id"",COALESCE(""sub"".""new_price"", 10) AS ""price"" FROM ""demo"" LEFT JOIN ""sub"" ON ""demo"".""product_id""=""sub"".""product_id"""
213,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM (SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""t"" WHERE ""rn""=1) AS ""t"" RIGHT JOIN ""products"" AS ""p"" ON ""t"".""product_id""=""p"".""product_id"" ORDER BY ""price"" DESC"
214,"WITH ""ranked_data"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price_rank"" FROM ""Products"" WHERE ""change_date""<'2019-08-17'), ""product_unique"" AS (SELECT DISTINCT ""product_id"" FROM ""Products"") SELECT ""product_unique"".""product_id"",COALESCE(""ranked_data"".""new_price"", 10) AS ""price"" FROM ""product_unique"" LEFT JOIN (SELECT * FROM ""ranked_data"" WHERE ""price_rank""=1) AS ""ranked_data"" ON ""ranked_data"".""product_id""=""product_unique"".""product_id"""
215,"SELECT DISTINCT ""p1"".""product_id"",COALESCE(""p2"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p1"" LEFT JOIN (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"" AND ""p2"".""rnk""=1"
216,"SELECT ""t2"".""product_id"",COALESCE(""p"".""new_price"", 10) AS ""price"" FROM (""products"" AS ""p"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t1"" ON ""p"".""product_id""=""t1"".""product_id"" AND ""p"".""change_date""=""t1"".""last_date"") RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""t2"" ON ""p"".""product_id""=""t2"".""product_id"""
217,"WITH ""consolidated"" AS (WITH ""final"" AS (WITH ""ordered"" AS (SELECT *,MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""latest_occurence"",MIN(""change_date"") OVER (PARTITION BY ""product_id"") AS ""first_occurence"",COUNT(""product_id"") OVER (PARTITION BY ""product_id"") AS ""cnt"" FROM ""Products"" ORDER BY ""product_id"",""change_date"") SELECT ""product_id"",MAX(""change_date"") AS ""dum_date"" FROM ""ordered"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""f"".""product_id"",""p"".""new_price"" AS ""price"" FROM ""final"" AS ""f"" JOIN ""products"" AS ""p"" ON ""f"".""product_id""=""p"".""product_id"" AND ""f"".""dum_date""=""p"".""change_date"" UNION SELECT ""a"".""product_id"",""a"".""price"" FROM (WITH ""ordered"" AS (SELECT *,MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""latest_occurence"",MIN(""change_date"") OVER (PARTITION BY ""product_id"") AS ""first_occurence"",COUNT(""product_id"") OVER (PARTITION BY ""product_id"") AS ""cnt"" FROM ""Products"" ORDER BY ""product_id"",""change_date"") SELECT ""product_id"",10 AS ""price"" FROM ""ordered"" WHERE ""first_occurence"">'2019-08-16') AS ""a"") SELECT * FROM ""consolidated"" ORDER BY ""product_id"""
218,"(SELECT ""l"".""product_id"",""r"".""new_price"" AS ""price"" FROM (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""l"" JOIN ""products"" AS ""r"" ON ""l"".""product_id""=""r"".""product_id"" AND ""l"".""recent_date""=""r"".""change_date"") UNION ALL (SELECT ""product_id"",10 AS ""price"" FROM (SELECT ""product_id"",MIN(""change_date"") AS ""mini"" FROM ""products"" GROUP BY ""product_id"") AS ""t"" WHERE ""mini"">'2019-08-16')"
219,"SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16') UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
220,"SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""t"".""product_id"",""t"".""new_price"" AS ""price"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t"" WHERE ""t"".""rnk""=1"
221,"WITH ""most_recent_change_dates"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""most_recent_change"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""z1"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""z1"" LEFT JOIN (SELECT ""p"".""product_id"",""new_price"" AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""most_recent_change_dates"" AS ""m"" ON ""p"".""product_id""=""m"".""product_id"" WHERE ""change_date""=""most_recent_change"") AS ""z2"" ON ""z1"".""product_id""=""z2"".""product_id"""
222,"SELECT ""t1"".""product_id"",COALESCE(""t2"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""t1"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"""
223,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
224,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
225,"SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""change_rank"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""sub"" WHERE ""change_rank""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM (SELECT ""product_id"",MIN(""change_date"") AS ""min_date"" FROM ""products"" GROUP BY ""product_id"") AS ""sub_2"" WHERE ""min_date"">'2019-08-16'"
226,"SELECT ""t2"".""product_id"",COALESCE(""p"".""new_price"", 10) AS ""price"" FROM (""products"" AS ""p"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t1"" ON ""p"".""product_id""=""t1"".""product_id"" AND ""p"".""change_date""=""t1"".""last_date"") RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""t2"" ON ""p"".""product_id""=""t2"".""product_id"""
227,"SELECT DISTINCT ""yy"".""product_id"",COALESCE(""aa"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""yy"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""Products"" WHERE ""change_date""<'2019-08-17') AS ""xx"" WHERE ""xx"".""rn""=1) AS ""aa"" ON ""yy"".""product_id""=""aa"".""product_id"""
228,"WITH ""a"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""r"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""a"") UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""a"" WHERE ""r""=1 ORDER BY ""product_id"""
229,"SELECT ""p1"".""product_id"",CASE WHEN ""p2"".""new_price"" IS NULL THEN 10 ELSE ""p2"".""new_price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""p1"" LEFT JOIN (SELECT ""p3"".""product_id"",""p3"".""new_price"" FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranks"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""p3"" WHERE ""p3"".""ranks""=1) AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"""
230,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
231,"WITH ""temp"" AS (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""myrank"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""price"" FROM ""temp"" WHERE ""myrank""=1 GROUP BY ""product_id"" UNION ALL SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""temp"" GROUP BY ""product_id"") GROUP BY ""product_id"""
232,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
233,"SELECT DISTINCT ""P0"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""P0"" LEFT JOIN (SELECT * FROM ""Products"" AS ""P1"" WHERE ROW(""P1"".""product_id"",""P1"".""change_date"") IN (SELECT ""P2"".""product_id"",MAX(""P2"".""change_date"") FROM ""Products"" AS ""P2"" WHERE ""P2"".""change_date""<='2019-08-16' GROUP BY ""P2"".""product_id"")) AS ""temp"" ON ""P0"".""product_id""=""temp"".""product_id"""
234,"(SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16') UNION (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date1"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id""))"
235,"WITH ""cte1"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""cte2"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""cte1"" WHERE ""rnk""=1) SELECT ""p"".""product_id"",COALESCE(""c"".""price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte2"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" GROUP BY 1,2"
236,"SELECT ""t1"".""product_id"" AS ""product_id"",CASE WHEN ""t2"".""price"" IS NULL THEN 10 ELSE ""t2"".""price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""t1"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"""
237,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",CASE WHEN ""cte"".""new_price"" IS NULL THEN 10 ELSE ""cte"".""new_price"" END AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte"" ON ""p"".""product_id""=""cte"".""product_id"" AND ""cte"".""rnk""=1"
238,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte"" AS ""c"" ON (""p"".""product_id""=""c"".""product_id"" AND ""rn""=1)"
239,"SELECT ""product_id"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')"
240,"SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""product_id"",""new_price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1)"
241,"WITH ""t1"" AS (SELECT ""p"".""product_id"" AS ""product_id"",""p"".""new_price"" AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""latest"" FROM ""Products"" WHERE ""change_date""<=DATE('2019-08-16') GROUP BY ""product_id"") AS ""t"" ON ""p"".""product_id""=""t"".""product_id"" AND ""p"".""change_date""=""t"".""latest"" WHERE ""t"".""product_id"" IS NOT NULL), ""t2"" AS (SELECT ""product_id"" FROM ""Products"" GROUP BY ""product_id"") SELECT ""t2"".""product_id"",COALESCE(""t1"".""price"", 10) AS ""price"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t2"".""product_id""=""t1"".""product_id"" ORDER BY ""t2"".""product_id"""
242,"SELECT ""p1"".""product_id"",CASE WHEN ""p2"".""new_price"" IS NULL THEN 10 ELSE ""p2"".""new_price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""p1"" LEFT JOIN (SELECT ""p4"".""product_id"",""p3"".""new_price"" FROM (SELECT ""p"".""product_id"",MAX(""p"".""change_date"") AS ""change_date"" FROM ""Products"" AS ""p"" WHERE ""p"".""change_date""<='2019-08-16' GROUP BY ""p"".""product_id"") AS ""p4"" JOIN ""Products"" AS ""p3"" ON ""p3"".""product_id""=""p4"".""product_id"" AND ""p3"".""change_date""=""p4"".""change_date"") AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"""
243,"SELECT ""tmp"".""product_id"",COALESCE(""tmp1"".""price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""tmp"" LEFT JOIN (SELECT ""P"".""product_id"",""P"".""new_price"" AS ""price"" FROM ""Products"" AS ""P"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""maxd"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""new"" ON ""p"".""product_id""=""new"".""product_id"" AND ""p"".""change_date""=""new"".""maxd"") AS ""tmp1"" ON ""tmp"".""product_id""=""tmp1"".""product_id"""
244,"WITH ""temp"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",(CASE WHEN ""t"".""new_price"" IS NULL THEN 10 ELSE ""t"".""new_price"" END) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""temp"" AS ""t"" ON ""p"".""product_id""=""t"".""product_id"" AND ""rk""=1"
245,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT ""product_id"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""xrank"",""new_price"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""b"".""xrank""=1 ORDER BY 2 DESC"
246,"WITH ""cte1"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16'), ""cte2"" AS (SELECT DISTINCT ""product_id"",""new_price"" FROM ""cte1"" WHERE ""rk""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""cte2"".""new_price"", 10) AS ""price"" FROM ""cte2"" RIGHT JOIN ""Products"" AS ""p"" USING (""product_id"") ORDER BY ""price"" DESC"
247,"WITH ""norm_prod"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""max_date"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""Products"" AS ""p"" WHERE ""p"".""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""n"".""product_id"",COALESCE(""p"".""new_price"", 10) AS ""price"" FROM (""norm_prod"" AS ""n"" LEFT JOIN ""max_date"" AS ""m"" ON ""n"".""product_id""=""m"".""product_id"") LEFT JOIN ""products"" AS ""p"" ON ""n"".""product_id""=""p"".""product_id"" AND ""m"".""change_date""=""p"".""change_date"""
248,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranks"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""P"".""product_id"",CASE WHEN ""c"".""price"" IS NULL THEN 10 ELSE ""c"".""price"" END AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" AND ""ranks""=1 GROUP BY 1"
249,"SELECT DISTINCT ""p0"".""product_id"",CASE WHEN ""p3"".""new_price"" IS NOT NULL THEN ""p3"".""new_price"" ELSE 10 END AS ""price"" FROM ""products"" AS ""p0"" LEFT JOIN (SELECT ""p1"".""product_id"",""p1"".""new_price"",""p1"".""change_date"" FROM ""products"" AS ""p1"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""Products"" WHERE ""change_date""<'2019-08-17' GROUP BY ""product_id"")) AS ""p3"" ON ""p0"".""product_id""=""p3"".""product_id"""
250,"WITH ""temp"" AS (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",(RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC)) AS ""rank_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""new_price_table"" WHERE ""rank_date""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""temp"" ON ""p"".""product_id""=""temp"".""product_id"" ORDER BY 1"
251,"WITH ""new_price"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""Products"".""product_id"",CASE WHEN ""new_price"".""new_price"" IS NULL THEN 10 ELSE ""new_price"".""new_price"" END AS ""price"" FROM ""Products"" LEFT JOIN ""new_price"" ON ""Products"".""product_id""=""new_price"".""product_id"" AND ""rk""=1"
252,"WITH ""a"" AS (SELECT ""t1"".""product_id"",""new_price"" FROM ""Products"" AS ""t1"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"" AND ""change_date""=""last_date"") SELECT ""b"".""product_id"",CASE WHEN ""new_price"" IS NULL THEN 10 ELSE ""new_price"" END AS ""price"" FROM ""a"" RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
253,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"" AS ""price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""a"".""product_id"",CASE WHEN ""b"".""price"" IS NULL THEN 10 ELSE ""b"".""price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""a"" LEFT JOIN (SELECT * FROM ""cte"" WHERE ""rnk""=1) AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
254,"SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1)"
255,"WITH ""a"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM (SELECT *,COUNT(""product_id"") OVER (PARTITION BY ""product_id"") AS ""num_changes"" FROM ""products"") AS ""temp"" WHERE ""change_date""<=DATE '2019-08-16' OR ""num_changes""=1), ""b"" AS (SELECT ""product_id"",10 FROM (SELECT *,CASE WHEN ""change_date""<=DATE '2019-08-16' THEN 1 ELSE 0 END AS ""in_range"" FROM ""products"") AS ""temp"" GROUP BY ""product_id"" HAVING SUM(""in_range"")=0) SELECT ""product_id"",CASE WHEN ""change_date""<=DATE '2019-08-16' THEN ""new_price"" ELSE 10 END AS ""price"" FROM ""a"" WHERE ""rk""=1 UNION SELECT * FROM ""b"""
256,"WITH ""G"" AS (SELECT ""P"".""product_id"" AS ""product_id"",MAX(""P"".""change_date"") AS ""MD"" FROM ""Products"" AS ""P"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""F"".""product_id"",MAX(""F"".""Price"") AS ""Price"" FROM (SELECT ""P2"".""product_id"",CASE WHEN (""P2"".""change_date""=""G"".""MD"" AND ""P2"".""product_id""=""G"".""product_id"") THEN ""P2"".""new_price"" ELSE 10 END AS ""Price"" FROM (""Products"" AS ""P2"") CROSS JOIN ""G"") AS ""F"" GROUP BY ""F"".""product_id"""
257,"SELECT DISTINCT ""p1"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p1"" LEFT JOIN (SELECT ""p"".*,CASE WHEN ""change_date""=MAX(""change_date"") OVER (PARTITION BY ""product_id"") THEN NULL ELSE 'no' END AS ""marker"" FROM ""products"" AS ""p"" WHERE ""change_date""<='2019-08-16') AS ""temp"" ON ""p1"".""product_id""=""temp"".""product_id"" WHERE ""temp"".""marker"" IS NULL"
258,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
259,"SELECT ""d"".""product_id"",CASE WHEN ""c"".""new_price"" IS NULL THEN 10 ELSE ""c"".""new_price"" END AS ""price"" FROM ((SELECT ""product_id"",""new_price"",MAX(""change_date"") AS ""latest_change"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""b"" JOIN (SELECT ""product_id"",""new_price"",""change_date"" FROM ""Products"") AS ""c"" ON ""c"".""change_date""=""b"".""latest_change"" AND ""c"".""product_id""=""b"".""product_id"") RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""d"" ON ""c"".""product_id""=""d"".""product_id"""
260,"SELECT ""p"".""product_id"",""p"".""new_price"" AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""last_changed_prices"" ON ""p"".""product_id""=""last_changed_prices"".""product_id"" WHERE ""p"".""change_date""=""last_changed_prices"".""last_change_date"" UNION ALL SELECT ""p"".""product_id"",10 AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_change_date"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16') AS ""last_changed_prices"" ON ""p"".""product_id""=""last_changed_prices"".""product_id"" WHERE ""p"".""change_date""=""last_changed_prices"".""last_change_date"""
261,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""price"" FROM ""cte"" WHERE ""rk""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16'"
262,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN (SELECT ""product_id"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""xrank"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""b"".""xrank""=1 ORDER BY 2 DESC"
263,"SELECT ""temp"".""product_id"",""temp"".""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""Change_date"" DESC) AS ""daterank"" FROM ""Products"" WHERE ""change_date"" - CAST('2019-08-16' AS DATE)<=0) AS ""temp"" WHERE ""temp"".""daterank""=1 UNION ALL SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""change_date"" - CAST('2019-08-16' AS DATE)>0 AND ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""Products"" WHERE ""change_date"" - CAST('2019-08-16' AS DATE)<=0)"
264,"SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""r"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""r""=1 UNION ALL SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
265,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""cte2"" AS (SELECT ""product_id"",10 FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"" WHERE ""rn""=1)) SELECT ""product_id"",""new_price"" AS ""price"" FROM ""cte"" WHERE ""rn""=1 UNION SELECT ""product_id"",10 FROM ""cte2"""
266,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""max_change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""a"" LEFT JOIN ""products"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ROW(""b"".""product_id"",""b"".""change_date"") IN (SELECT ""product_id"",""max_change_date"" FROM ""cte"")"
267,"WITH ""sub"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",CASE WHEN ""sub"".""new_price"" IS NULL THEN 10 ELSE ""sub"".""new_price"" END AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""sub"" ON ""p"".""product_id""=""sub"".""product_id"" AND ""sub"".""rnk""=1"
268,"WITH ""t"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price_rank"" FROM ""products"" WHERE ""change_date""<=DATE('2019-08-16')) SELECT ""a"".""product_id"",CASE WHEN ""t"".""new_price"" IS NULL THEN 10 ELSE ""t"".""new_price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""a"" LEFT JOIN ""t"" ON ""a"".""product_id""=""t"".""product_id"" AND ""t"".""price_rank""=1"
269,"SELECT ""def"".""product_id"",COALESCE(""p1"".""new_price"", 10) AS ""price"" FROM ((SELECT ""product_id"",MAX(""change_date"") AS ""m_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) AS ""p2"" JOIN ""Products"" AS ""p1"" ON ""p1"".""product_id""=""p2"".""product_id"" AND ""p1"".""change_date""=""p2"".""m_date"") RIGHT JOIN (SELECT DISTINCT ""product_id"",10 AS ""def_price"" FROM ""Products"") AS ""def"" ON ""def"".""product_id""=""p2"".""product_id"""
270,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT * FROM ""Products"" AS ""p"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"""
271,"WITH ""cte1"" AS (SELECT DISTINCT ""pd"".""product_id"" FROM ""products"" AS ""pd""), ""cte2"" AS (SELECT ""sub1"".""product_id"",""sub1"".""new_price"" FROM (SELECT ""pd1"".""product_id"",""pd1"".""new_price"",""pd1"".""change_date"",RANK() OVER (PARTITION BY ""pd1"".""product_id"" ORDER BY ""pd1"".""change_date"" DESC) AS ""changedaterank"" FROM ""Products"" AS ""pd1"" WHERE ""pd1"".""change_date""<='2019-08-16') AS ""sub1"" WHERE ""sub1"".""changedaterank""=1) SELECT ""ct1"".""product_id"" AS ""product_id"",COALESCE(""ct2"".""new_price"", 10) AS ""price"" FROM ""cte1"" AS ""ct1"" LEFT JOIN ""cte2"" AS ""ct2"" ON ""ct1"".""product_id""=""ct2"".""product_id"""
272,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""p2"".""product_id"",""new_price"" FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
273,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""b"".""price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""a"".""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY (CAST('2019-08-16' AS DATE) - ""change_date"")) AS ""num"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""a"".""num""=1) AS ""b"" ON ""p"".""product_id""=""b"".""product_id"""
274,"SELECT DISTINCT ""p2"".""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM (SELECT ""product_id"",""new_price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""p1"" RIGHT JOIN (SELECT ""product_id"" FROM ""products"") AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"""
275,"SELECT ""t2"".""product_id"",COALESCE(""p"".""new_price"", 10) AS ""price"" FROM (""products"" AS ""p"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t1"" ON ""p"".""product_id""=""t1"".""product_id"" AND ""p"".""change_date""=""t1"".""last_date"") RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""t2"" ON ""p"".""product_id""=""t2"".""product_id"""
276,"SELECT ""b"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""b"" LEFT JOIN (SELECT ""a"".""product_id"",""a"".""new_price"" FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price_rank"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""a"".""price_rank""=1) AS ""c"" ON ""b"".""product_id""=""c"".""product_id"""
277,"SELECT ""Product_ID"",""price"" FROM (SELECT ""Product_ID"",""new_price"" AS ""Price"",RANK() OVER (PARTITION BY ""product_ID"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""rnk""=1 UNION SELECT ""Product_ID"",10 FROM ""Products"" WHERE ""product_ID"" NOT IN (SELECT ""Product_ID"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')"
278,"WITH ""t1"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""latest"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1), ""t2"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT * FROM ""t1"")) SELECT ""a"".""product_id"",COALESCE(""t2"".""price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""a"" LEFT JOIN ""t2"" ON ""a"".""product_id""=""t2"".""product_id"""
279,"SELECT ""p1"".""product_id"",CASE WHEN ""a"".""new_price"" IS NULL THEN 10 ELSE ""a"".""new_price"" END AS ""price"" FROM ""products"" AS ""p1"" LEFT JOIN (SELECT ""p"".""product_id"",""p"".""new_price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""p"" WHERE ""p"".""rnk""=1) AS ""a"" ON ""p1"".""product_id""=""a"".""product_id"" GROUP BY ""p1"".""product_id"""
280,"SELECT ""t2"".""product_id"",COALESCE(""p"".""new_price"", 10) AS ""price"" FROM ((SELECT ""product_id"",MAX(""change_date"") AS ""max_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t1"" JOIN ""products"" AS ""p"" ON ""t1"".""product_id""=""p"".""product_id"" AND ""t1"".""max_date""=""p"".""change_date"") RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""t2"" ON ""p"".""product_id""=""t2"".""product_id"""
281,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""product_id"",""new_price"" FROM ""Products"" AS ""p2"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
282,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') (SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"")) UNION (SELECT ""product_id"",""new_price"" FROM ""cte"" WHERE ""rnk""=1)"
283,"SELECT DISTINCT ""p1"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p1"" LEFT JOIN (SELECT * FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1)) AS ""temp"" ON ""p1"".""product_id""=""temp"".""product_id"""
284,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""temp"" RIGHT JOIN ""Products"" AS ""p"" ON ""p"".""product_id""=""temp"".""product_id"" AND ""rnk""=1"
285,"WITH ""c"" AS (SELECT ""product_id"",""new_price"",LAST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS ""lprice"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' ORDER BY ""change_date"") SELECT DISTINCT ""p"".""product_id"",COALESCE(""lprice"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""p"" LEFT JOIN ""c"" ON ""p"".""product_id""=""c"".""product_id"""
286,"SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t1"" WHERE ""rn""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')"
287,"WITH ""c"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""b"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""date_"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1), ""a"" AS (SELECT ""p"".""product_id"",""p"".""new_price"" FROM ""products"" AS ""p"" JOIN ""b"" ON ""p"".""product_id""=""b"".""product_id"" AND ""p"".""change_date""=""b"".""date_"") SELECT ""c"".""product_id"",COALESCE(""a"".""new_price"", 10) AS ""price"" FROM ""c"" LEFT JOIN ""a"" ON ""c"".""product_id""=""a"".""product_id"""
288,"WITH ""cte"" AS (SELECT *,DATE('2019-08-16') - ""change_date"" AS ""dd"" FROM ""Products"") (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,MIN(""dd"") OVER (PARTITION BY ""product_id"") AS ""dd_min"" FROM (SELECT ""product_id"",""new_price"",""change_date"",(CASE WHEN ""dd""<0 THEN 999 ELSE ""dd"" END) AS ""dd"" FROM ""cte"") AS ""p1"") AS ""p2"" WHERE ""dd""=""dd_min"" AND ""change_date""<=DATE('2019-08-16')) UNION ALL (SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""cte"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"" WHERE ""change_date""<=DATE('2019-08-16')))"
289,"WITH ""last_change"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""max_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id""), ""last_price"" AS (SELECT ""last_change"".""product_id"",""last_change"".""max_date"",""products"".""new_price"" AS ""price"" FROM ""last_change"" JOIN ""products"" ON ""last_change"".""product_id""=""products"".""product_id"" AND ""last_change"".""max_date""=""products"".""change_date""), ""distinct_product"" AS (SELECT DISTINCT (""product_id"") FROM ""products"") SELECT ""distinct_product"".""product_id"",COALESCE(""LP"".""price"", 10) AS ""price"" FROM ""distinct_product"" LEFT JOIN ""last_price"" AS ""LP"" ON ""distinct_product"".""product_id""=""LP"".""product_id"""
290,"WITH ""t"" AS (SELECT ""product_id"",CASE WHEN ""change_date"">'2019-08-16' THEN 10 ELSE ""new_price"" END AS ""new_price"",CASE WHEN ""change_date"">'2019-08-16' THEN '0' ELSE ""change_date"" END AS ""change_date"" FROM ""products"") SELECT DISTINCT ""t1"".""product_id"",""t1"".""new_price"" AS ""price"" FROM ""t"" AS ""t1"" LEFT JOIN ""t"" AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"" AND ""t1"".""change_date""<""t2"".""change_date"" WHERE ""t2"".""change_date"" IS NULL"
291,"WITH ""cte"" AS (SELECT ""product_id"",LAST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY DATE(""change_date"") ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS ""final_price"" FROM ""Products"" WHERE DATE(""change_date"")<='2019-08-16') SELECT DISTINCT ""P"".""product_id"",CASE WHEN ""cte"".""final_price"" IS NULL THEN 10 ELSE ""cte"".""final_price"" END AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN ""cte"" ON ""cte"".""product_id""=""P"".""product_id"""
292,"WITH ""Dates"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""Products"" WHERE CAST('2019-08-16' AS DATE) - ""change_date"">=0 GROUP BY ""product_id""), ""Prices"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT * FROM ""Dates"")), ""Ids"" AS (SELECT DISTINCT ""product_id"" FROM ""Products"") SELECT ""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""Ids"" LEFT JOIN ""Prices"" USING (""product_id"")"
293,"SELECT ""p1"".""product_id"",""p1"".""new_price"" AS ""price"" FROM ""Products"" AS ""p1"" WHERE ""p1"".""change_date""<='2019-08-16' AND ROW(""product_id"",CAST('2019-08-16' AS DATE) - ""p1"".""change_date"") IN (SELECT ""product_id"",MIN(CAST('2019-08-16' AS DATE) - ""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' ORDER BY ""price"" DESC"
294,"WITH ""a"" AS (SELECT ""t1"".""product_id"",""new_price"" FROM ""Products"" AS ""t1"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"" AND ""change_date""=""last_date"") SELECT ""b"".""product_id"",CASE WHEN ""new_price"" IS NULL THEN 10 ELSE ""new_price"" END AS ""price"" FROM ""a"" RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
295,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",""change_date"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16'), ""cte1"" AS (SELECT ""product_id"",10 AS ""new_price"",""change_date"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date"">'2019-08-16' AND ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"")) SELECT ""product_id"",""price"" FROM (SELECT DISTINCT ""cte"".""product_id"",""cte"".""new_price"" AS ""price"" FROM ""cte"" WHERE ""cte"".""rnk""=1 UNION SELECT DISTINCT ""cte1"".""product_id"",""cte1"".""new_price"" AS ""price"" FROM ""cte1"" WHERE ""cte1"".""rnk""=1) AS ""a"" ORDER BY 1"
296,"WITH ""S0"" AS (SELECT DISTINCT (""product_id"") AS ""product_id"",10 AS ""price"" FROM ""Products""), ""S1"" AS (SELECT ""product_id"",""new_price"",""change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16'), ""S2"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""latest_change_date"" FROM ""S1"" GROUP BY ""product_id""), ""S3"" AS (SELECT ""S2"".""product_id"",""new_price"" AS ""price"" FROM ""S2"" JOIN ""Products"" ON ""S2"".""product_id""=""Products"".""product_id"" AND ""S2"".""latest_change_date""=""Products"".""change_date"") SELECT ""S0"".""product_id"",COALESCE(""S3"".""price"", ""S0"".""price"") AS ""price"" FROM ""S0"" LEFT JOIN ""S3"" ON ""S0"".""product_id""=""S3"".""product_id"""
297,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
298,"WITH ""TEMP"" AS (SELECT ""PRODUCT_ID"",""NEW_PRICE"" AS ""PRICE"",RANK() OVER (PARTITION BY ""PRODUCT_ID"" ORDER BY ""CHANGE_DATE"" DESC) AS ""RNK"" FROM ""PRODUCTS"" WHERE ""CHANGE_DATE""<='2019-08-16') SELECT ""P"".""PRODUCT_ID"",COALESCE(""T"".""PRICE"", 10) AS ""PRICE"" FROM (SELECT DISTINCT ""PRODUCT_ID"" FROM ""PRODUCTS"") AS ""P"" LEFT JOIN ""TEMP"" AS ""T"" ON ""P"".""PRODUCT_ID""=""T"".""PRODUCT_ID"" AND ""T"".""RNK""=1 ORDER BY 1"
299,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"""
300,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""product_id"",""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""a"".""product_id"",CASE WHEN ""cte"".""new_price"" IS NULL THEN 10 ELSE ""cte"".""new_price"" END AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN ""cte"" USING (""product_id"") WHERE ""rk""=1 OR ""rk"" IS NULL"
301,"WITH ""changed_product"" AS (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<'2019-08-17') AS ""t"" WHERE ""t"".""rk""=1), ""product_list"" AS (SELECT DISTINCT ""product_id"" FROM ""Products"") SELECT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""product_list"" AS ""p"" LEFT JOIN ""changed_product"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"""
302,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""r1"" FROM ""products"" WHERE ""change_date""<=' 2019-08-16'), ""cte2"" AS (SELECT DISTINCT ""product_id"",""new_price"" FROM ""cte"" WHERE ""r1""=1) SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte2"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" ORDER BY ""price"" DESC"
303,"WITH ""product_rows"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""p"".""product_id"",COALESCE(MAX(CASE WHEN ""pr"".""rn""=1 THEN ""p"".""new_price"" END), 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""product_rows"" AS ""pr"" ON ""p"".""product_id""=""pr"".""product_id"" AND ""p"".""change_date""=""pr"".""change_date"" GROUP BY ""p"".""product_id"""
304,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""t1"".""product_id"" FROM (""Products"" AS ""t1"") CROSS JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""ms"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t2"" WHERE ROW(""t1"".""product_id"",""t1"".""change_date"")=ROW(""t2"".""product_id"",""t2"".""ms"")) UNION (SELECT DISTINCT ""t1"".""product_id"",""t1"".""new_price"" AS ""price"" FROM (""Products"" AS ""t1"") CROSS JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""ms"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t2"" WHERE ROW(""t1"".""product_id"",""t1"".""change_date"")=ROW(""t2"".""product_id"",""t2"".""ms""))"
305,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
306,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT * FROM (SELECT *,MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""max_date"" FROM ""products"" WHERE ""change_Date""<='2019-08-16') AS ""m"" WHERE ""max_date""=""change_Date"") AS ""c"" ON ""p"".""product_id""=""c"".""product_id"""
307,"WITH ""product_with_base"" AS (SELECT * FROM ""products"" WHERE ""change_date""<='2019-08-16' UNION SELECT DISTINCT ""product_id"",10,'2000-01-01' FROM ""products"") SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""product_with_base"") AS ""tbl"" WHERE ""rnk""=1"
308,"SELECT ""t2"".""product_id"",COALESCE(""t1"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"" AS ""p"") AS ""t2"" LEFT JOIN (SELECT ""p"".""product_id"",""p"".""new_price"" FROM ""Products"" AS ""p"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""newest_date"" FROM ""Products"" AS ""p"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) AS ""t"" ON ""p"".""change_date""=""t"".""newest_date"" AND ""p"".""product_id""=""t"".""product_id"") AS ""t1"" ON ""t2"".""product_id""=""t1"".""product_id"""
309,"WITH ""cte_prod"" AS (SELECT DISTINCT (""product_id"") AS ""product_id"" FROM ""products"") SELECT ""p"".""product_id"",CASE WHEN ""new_price"" IS NULL THEN 10 ELSE ""new_price"" END AS ""price"" FROM ""cte_prod"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""x"" ON ""p"".""product_id""=""x"".""product_id"" WHERE ""rnk""=1 OR ""rnk"" IS NULL"
310,"SELECT ""T1"".""product_id"",COALESCE(""T2"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""T1"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""T2"" ON ""T1"".""product_id""=""T2"".""product_id"" ORDER BY ""price"""
311,"SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT DISTINCT ""t"".""product_id"",""t"".""new_price"" FROM ""Products"" AS ""t"" WHERE ROW(""t"".""product_id"",""t"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
312,"WITH ""temp"" AS (SELECT ""product_id"",COALESCE(""new_price"", 10) AS ""new_price"",COALESCE(""change_date"", '2019-08-16') AS ""change_date"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""p1"" LEFT JOIN (SELECT * FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""p2"" USING (""product_id"")) SELECT ""product_id"",""new_price"" AS ""price"" FROM ""temp"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""temp"" GROUP BY ""product_id"")"
313,"SELECT ""def"".""product_id"",COALESCE(""p1"".""new_price"", 10) AS ""price"" FROM ((SELECT ""product_id"",MAX(""change_date"") AS ""m_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) AS ""p2"" JOIN ""Products"" AS ""p1"" ON ""p1"".""product_id""=""p2"".""product_id"" AND ""p1"".""change_date""=""p2"".""m_date"") RIGHT JOIN (SELECT DISTINCT ""product_id"",10 AS ""def_price"" FROM ""Products"") AS ""def"" ON ""def"".""product_id""=""p2"".""product_id"""
314,"WITH ""t1"" AS (SELECT ""product_id"",MIN(""change_date"") AS ""first_date"" FROM ""Products"" GROUP BY 1) SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""t1"".""product_id"",""t2"".""new_price"",RANK() OVER (PARTITION BY ""t2"".""product_id"" ORDER BY ""t2"".""change_date"" DESC) AS ""date_rank"" FROM ""t1"" JOIN ""Products"" AS ""t2"" ON ""t1"".""first_date""<='2019-08-16' AND ""t1"".""product_id""=""t2"".""product_id"" AND ""t2"".""change_date""<='2019-08-16') AS ""t3"" WHERE ""date_rank""=1 UNION SELECT ""product_id"",""price"" FROM (SELECT ""t1"".""product_id"",10 AS ""price"",RANK() OVER (PARTITION BY ""t2"".""product_id"" ORDER BY ""t2"".""change_date"") AS ""date_rank"" FROM ""t1"" JOIN ""Products"" AS ""t2"" ON ""t1"".""first_date"">'2019-08-16' AND ""t1"".""product_id""=""t2"".""product_id"") AS ""t4"" WHERE ""date_rank""=1 ORDER BY ""product_id"""
315,"WITH ""f"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE CAST('2019-08-16' AS DATE) - ""change_date"">=0), ""f2"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""f"" WHERE ""rnk""=1) SELECT DISTINCT ""a"".""product_id"",COALESCE(""f2"".""price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN ""f2"" ON ""a"".""product_id""=""f2"".""product_id"""
316,"WITH ""temp"" AS (SELECT ""product_id"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""temp"" WHERE ""rnk""=1 UNION SELECT ""product_id"",10 FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16')"
317,"WITH ""all_products"" AS (SELECT DISTINCT ""product_id"" AS ""product_id"" FROM ""Products""), ""product_info"" AS (SELECT ""ap"".""product_id"",COALESCE(""new_price"", 10) AS ""price"",COALESCE(""change_date"", '2019-01-01') AS ""change_date"" FROM ""all_products"" AS ""ap"" LEFT JOIN ""Products"" AS ""p"" ON ""ap"".""product_id""=""p"".""product_id"" AND ""change_date""<='2019-08-16'), ""product_rank"" AS (SELECT ""product_id"",""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""product_info"") SELECT ""product_id"",""price"" FROM ""product_rank"" WHERE ""rnk""=1"
318,"WITH ""cte1"" AS (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""req"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""cte2"" AS (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""cte1"" WHERE ""cte1"".""req""=1), ""cte3"" AS (SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""cte2"")) SELECT ""product_id"",""price"" FROM ""cte2"" UNION SELECT ""product_id"",""price"" FROM ""cte3"""
319,"SELECT ""product_id"",""new_price"" AS ""Price"" FROM (SELECT ""a"".""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""DenseRank"" FROM ""Products"" AS ""a"" WHERE 1=1 AND ""a"".""change_date""<='2019-08-16') AS ""t"" WHERE 1=1 AND ""DenseRank""=1 UNION SELECT ""product_id"",10 AS ""Price"" FROM ""Products"" AS ""a"" WHERE 1=1 AND ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')"
320,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",""change_Date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""cte"" WHERE ""rnk""=1 GROUP BY 1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""change_date"">'2019-08-16' AND ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"")"
321,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",""change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' ORDER BY ""change_date"" DESC), ""cte2"" AS (SELECT DISTINCT ""product_id"" FROM ""Products""), ""cte3"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""cte2"" AS ""a"" LEFT JOIN ""cte3"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""b"".""rnk""=1 GROUP BY ""a"".""product_id"""
322,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""change_date2"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1), ""cte2"" AS (SELECT ""p"".""product_id"",""p"".""new_price"" FROM ""Products"" AS ""p"" JOIN ""cte"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" AND ""p"".""change_date""=""c"".""change_date2""), ""cte3"" AS (SELECT DISTINCT ""product_id"" FROM ""Products"") SELECT ""c3"".""product_id"",COALESCE(""c2"".""new_price"", 10) AS ""price"" FROM ""cte3"" AS ""c3"" LEFT JOIN ""cte2"" AS ""c2"" ON ""c3"".""product_id""=""c2"".""product_id"""
323,"SELECT DISTINCT (""p"".""product_id""),COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"""
324,"SELECT DISTINCT ""p1"".""product_id"",COALESCE(""p2"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p1"" LEFT JOIN (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"" AND ""rnk""=1"
325,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranked"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"" AND ""ranked""=1"
326,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""myrank"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" AND ""c"".""myrank""=1 GROUP BY 1"
327,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""md"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT DISTINCT ""a"".""product_id"",CASE WHEN ""b"".""md"" IS NULL THEN 10 ELSE COALESCE(""new_price"", 10) END AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" WHERE ""a"".""change_date""=""b"".""md"" OR ""b"".""md"" IS NULL"
328,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""tt1"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""ddate"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""tt1"" ON ""p"".""product_id""=""tt1"".""product_id"""
329,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""p2"".""product_id"",""new_price"" FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
330,"SELECT ""t1"".""product_id"",COALESCE(""t2"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""t1"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"""
331,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
332,"WITH ""G"" AS (SELECT ""P"".""product_id"" AS ""product_id"",MAX(""P"".""change_date"") AS ""MD"" FROM ""Products"" AS ""P"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""F"".""product_id"",MAX(""F"".""Price"") AS ""Price"" FROM (SELECT ""P2"".""product_id"",CASE WHEN (""P2"".""change_date""=""G"".""MD"" AND ""P2"".""product_id""=""G"".""product_id"") THEN ""P2"".""new_price"" ELSE 10 END AS ""Price"" FROM (""Products"" AS ""P2"") CROSS JOIN ""G"") AS ""F"" GROUP BY ""F"".""product_id"""
333,"WITH ""Table_1"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""Products"".""product_id"",CASE WHEN ""Table_1"".""new_price"" IS NULL THEN 10 ELSE ""Table_1"".""new_price"" END AS ""price"" FROM ""Products"" LEFT JOIN ""Table_1"" ON ""Products"".""product_id""=""Table_1"".""product_id"" AND ""rnk""=1"
334,"SELECT ""a"".""product_id"",COALESCE(""b"".""price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""a"" LEFT JOIN (SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""t"" WHERE ""rn""=1) AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
335,"WITH ""a"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""product_id"",""new_price"" AS ""price"" FROM ""a"" WHERE ""rk""=1 UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""a"")"
336,"WITH ""last_change"" AS (SELECT DISTINCT ""p"".""product_id"",MAX(""p"".""change_date"") OVER (PARTITION BY ""p"".""product_id"") AS ""last_change_date"" FROM ""products"" AS ""p"" WHERE ""p"".""change_date""<='2019-08-16'), ""all_products"" AS (SELECT DISTINCT ""p3"".""product_id"",10 AS ""price"" FROM ""products"" AS ""p3"") SELECT DISTINCT ""ap"".""product_id"",COALESCE(""p2"".""new_price"", ""ap"".""price"") AS ""price"" FROM (""last_change"" AS ""l"" LEFT JOIN ""products"" AS ""p2"" ON ""p2"".""product_id""=""l"".""product_id"" AND ""p2"".""change_date""=""l"".""last_change_date"") RIGHT JOIN ""all_products"" AS ""ap"" ON ""ap"".""product_id""=""p2"".""product_id"""
337,"WITH ""filtered"" (""product_id"", ""new_price"", ""change_date"") AS (SELECT * FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""ranked"" (""product_id"", ""new_price"", ""change_date"", ""date_rank"") AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""date_rank"" FROM ""filtered""), ""def"" (""product_id"", ""price"") AS (SELECT DISTINCT ""product_id"",10 FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""ranked"")) SELECT ""product_id"",""new_price"" AS ""price"" FROM ""ranked"" WHERE ""date_rank""=1 UNION SELECT * FROM ""def"""
338,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""ranked"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranks"" FROM ""products"" WHERE ""change_date""<'2019-08-17') AS ""ranked"" ON ""p"".""product_id""=""ranked"".""product_id"" AND ""ranks""=1 GROUP BY 1"
339,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""p2"".""product_id"",""new_price"" FROM ""Products"" AS ""p2"" WHERE ROW(""p2"".""product_id"",""p2"".""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
340,"WITH ""a"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""p"".""product_id"",""new_price"" AS ""price"" FROM ""Products"" AS ""p"" JOIN ""a"" ON ""p"".""product_id""=""a"".""product_id"" AND ""p"".""change_date""=""a"".""change_date"" UNION SELECT ""p"".""product_id"",10 AS ""price"" FROM ""Products"" AS ""p"" WHERE ""p"".""product_id"" NOT IN (SELECT ""product_id"" FROM ""a"")"
341,"WITH ""date_change"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""date_change"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT DISTINCT ""p"".""product_id"",(CASE WHEN ""d"".""date_change"" IS NULL THEN 10 ELSE ""p"".""new_price"" END) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""date_change"" AS ""d"" ON ""p"".""product_id""=""d"".""product_id"" WHERE (""p"".""change_date""=""d"".""date_change"" OR ""d"".""date_change"" IS NULL)"
342,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT DISTINCT ""product_id"",10 FROM ""Products"" GROUP BY ""Product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
343,"SELECT DISTINCT ""p1"".""product_id"",CASE WHEN ""p2"".""max_date"" IS NULL THEN 10 ELSE ""p1"".""new_price"" END AS ""price"" FROM ""Products"" AS ""p1"" LEFT JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""max_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"" WHERE ""p1"".""change_date""=""p2"".""max_date"" OR ""p2"".""max_date"" IS NULL"
344,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""c1"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN ""cte"" AS ""c1"" ON ""c1"".""product_id""=""p"".""product_id"" AND ""c1"".""rn""=1"
345,"SELECT ""p1"".""product_id"",CASE WHEN ""p3"".""new_price"" IS NULL THEN 10 ELSE ""p3"".""new_price"" END AS ""price"" FROM ""Products"" AS ""p1"" LEFT JOIN (SELECT * FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""p2"" WHERE ""p2"".""rnk""=1) AS ""p3"" ON ""p1"".""product_id""=""p3"".""product_id"" GROUP BY 1,2 ORDER BY 2"
346,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
347,"WITH ""t"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id""), ""tt"" AS (SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products""), ""tbl"" AS (SELECT ""p"".""product_id"",""new_price"" AS ""price"" FROM ""Products"" AS ""p"" JOIN ""t"" ON ""p"".""product_id""=""t"".""product_id"" AND ""p"".""change_date""=""t"".""change_date"") SELECT ""tt"".""product_id"",COALESCE(""tbl"".""price"", ""tt"".""price"") AS ""price"" FROM ""tt"" LEFT JOIN ""tbl"" ON ""tt"".""product_id""=""tbl"".""product_id"""
348,"WITH ""tmp"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""tmp"" WHERE ""rn""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
349,"SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""latest"" FROM ""Products"" WHERE ""change_date""<'2019-08-17') AS ""new"" WHERE ""new"".""latest""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
350,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1)) AS ""t"" ON ""a"".""product_id""=""t"".""product_id"""
351,"WITH ""cte"" AS (SELECT ""product_id"",LAST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY DATE(""change_date"") ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS ""final_price"" FROM ""Products"" WHERE DATE(""change_date"")<='2019-08-16') SELECT DISTINCT ""P"".""product_id"",CASE WHEN ""cte"".""final_price"" IS NULL THEN 10 ELSE ""cte"".""final_price"" END AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN ""cte"" ON ""cte"".""product_id""=""P"".""product_id"""
352,"WITH ""tb1"" AS (SELECT DISTINCT ""product_id"" FROM ""Products""), ""tb2"" AS (SELECT ""p1"".""product_id"",MAX(""p1"".""change_date"") AS ""maxDate"" FROM ""Products"" AS ""p1"" WHERE ""p1"".""change_date""<=20190816 GROUP BY ""p1"".""product_id""), ""tb3"" AS (SELECT ""tb2"".""product_id"",""tb2"".""maxDate"",""p2"".""new_price"" FROM ""Products"" AS ""p2"" JOIN ""tb2"" ON ""p2"".""change_date""=""tb2"".""maxDate"" AND ""p2"".""product_id""=""tb2"".""product_id"") SELECT ""tb1"".""product_id"",CASE WHEN ""tb3"".""maxDate"" IS NULL THEN 10 ELSE ""tb3"".""new_price"" END AS ""price"" FROM ""tb1"" LEFT JOIN ""tb3"" ON ""tb1"".""product_id""=""tb3"".""product_id"""
353,"WITH ""cte1"" AS (SELECT CAST(MIN(""change_date"")-1 AS DATE) AS ""earliest_change_date"" FROM ""products""), ""cte2"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""cte3"" AS (SELECT ""product_id"",10 AS ""new_price"",""earliest_change_date"" AS ""change_date"" FROM ""cte1"" CROSS JOIN ""cte2""), ""cte4"" AS (SELECT * FROM ""products"" UNION SELECT * FROM ""cte3"" ORDER BY ""product_id"",""change_date""), ""cte5"" AS (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranking"" FROM ""cte4"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""cte5"" WHERE ""ranking""=1 ORDER BY ""product_id"""
354,"WITH ""temp"" AS (SELECT ""n"".""product_id"",""n"".""new_price"" AS ""price"" FROM (SELECT ""new"".""product_id"",""new"".""new_price"",RANK() OVER (PARTITION BY ""new"".""product_id"" ORDER BY ""new"".""days"") AS ""r"" FROM (SELECT *,@""temp"":='2019-08-16' AS ""d"",@""temp"" - ""change_date"" AS ""days"" FROM ""products"") AS ""new"" WHERE ""new"".""days"">=0) AS ""n"" WHERE ""r""=1) SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""temp"") UNION SELECT * FROM ""temp"" ORDER BY ""product_id"""
355,"(SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')) UNION (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""rk""=1)"
356,"SELECT DISTINCT ""p"".""product_id"",CASE WHEN ""t"".""latest"" IS NULL THEN 10 ELSE ""new_price"" END AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""latest"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) AS ""t"" ON ""p"".""product_id""=""t"".""product_id"" WHERE ""p"".""change_date""=""t"".""latest"" OR ""t"".""latest"" IS NULL"
357,"SELECT DISTINCT ""products"".""product_id"",COALESCE(""a"".""new_price"", 10) AS ""price"" FROM ""Products"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""a"" ON ""products"".""product_id""=""a"".""product_id"""
358,"WITH ""t"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM (SELECT * FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""k"" GROUP BY ""product_id""), ""s"" AS (SELECT DISTINCT ""product_id"" FROM ""Products"") SELECT ""s"".""product_id"",CASE WHEN ""a"".""new_price"" IS NOT NULL THEN ""a"".""new_price"" ELSE 10 END AS ""price"" FROM (""s"" LEFT JOIN ""t"" ON ""s"".""product_id""=""t"".""product_id"") LEFT JOIN ""Products"" AS ""a"" ON ""t"".""product_id""=""a"".""product_id"" AND ""t"".""change_date""=""a"".""change_date"""
359,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""b"".""price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""a"".""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY (CAST('2019-08-16' AS DATE) - ""change_date"")) AS ""num"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""a"".""num""=1) AS ""b"" ON ""p"".""product_id""=""b"".""product_id"""
360,"SELECT ""c"".""product_id"",COALESCE(""a"".""new_price"", 10) AS ""price"" FROM (""products"" AS ""a"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""max_change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""a"".""change_date""=""b"".""max_change_date"") RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""c"" ON ""a"".""product_id""=""c"".""product_id"""
361,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"",""change_date"",DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" AS ""p"" WHERE ""change_date""<='2019-08-16'), ""unique_prd"" AS (SELECT DISTINCT ""product_id"" FROM ""Products"") SELECT ""p"".""product_id"",COALESCE(""c"".""new_price"", 10) AS ""price"" FROM ""unique_prd"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"",""change_date"" FROM ""cte"" WHERE ""rnk""=1) AS ""c"" ON (""p"".""product_id""=""c"".""product_id"")"
362,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN (SELECT ""product_id"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""xrank"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""b"".""xrank""=1"
363,"SELECT ""product_id"",""price"" FROM (SELECT * FROM (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""date_rank"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""date_rank""=1) AS ""b"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT DISTINCT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16')"
364,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"" AS ""price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""price"" FROM ""cte"" WHERE ""rnk""=1 UNION SELECT ""product_id"",10 FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"")"
365,"SELECT ""c"".""product_id"",COALESCE(""d"".""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"" GROUP BY 1) AS ""c"" LEFT JOIN (SELECT ""a"".""product_id"",""a"".""new_price"" FROM ""products"" AS ""a"" RIGHT JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""a"".""change_date""=""b"".""change_date"") AS ""d"" ON ""c"".""product_id""=""d"".""product_id"""
366,"WITH ""tem"" AS (SELECT * FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rank_n"" FROM ""tem"") AS ""a"" WHERE ""rank_n""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM (SELECT ""product_id"",MIN(""change_date"") AS ""min_date"" FROM ""products"" GROUP BY ""product_id"") AS ""a"" WHERE ""min_date"">'2019-08-16'"
367,"SELECT ""c"".""product_id"",COALESCE(""d"".""price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""c"" LEFT JOIN (SELECT ""a"".""product_id"",""a"".""new_price"" AS ""price"" FROM ""Products"" AS ""a"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""latest_change_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""a"".""change_date""=""b"".""latest_change_date"") AS ""d"" ON ""c"".""product_id""=""d"".""product_id"""
368,"WITH ""cte"" AS (SELECT DISTINCT ""product_id"",FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""change_date"">'2019-08-16' AND ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"") GROUP BY ""product_id"" UNION ALL SELECT * FROM ""cte"" ORDER BY ""product_id"""
369,"WITH ""t"" AS (SELECT ""product_id"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""t1"" AS (SELECT ""product_id"",""new_price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""latest_change"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""new_price"" AS ""price"" FROM ""t1"" WHERE ""latest_change""=1 UNION SELECT ""product_id"",10 AS ""new_price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT * FROM ""t"")"
370,"WITH ""new_price"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""Products"".""product_id"",CASE WHEN ""new_price"".""new_price"" IS NULL THEN 10 ELSE ""new_price"".""new_price"" END AS ""price"" FROM ""Products"" LEFT JOIN ""new_price"" ON ""Products"".""product_id""=""new_price"".""product_id"" AND ""rk""=1"
371,"SELECT ""p1"".""product_id"",CASE WHEN ""p2"".""new_price"" IS NULL THEN 10 ELSE ""p2"".""new_price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""p1"" LEFT JOIN (SELECT ""p4"".""product_id"",""p3"".""new_price"" FROM (SELECT ""p"".""product_id"",MAX(""p"".""change_date"") AS ""change_date"" FROM ""Products"" AS ""p"" WHERE ""p"".""change_date""<='2019-08-16' GROUP BY ""p"".""product_id"") AS ""p4"" JOIN ""Products"" AS ""p3"" ON ""p3"".""product_id""=""p4"".""product_id"" AND ""p3"".""change_date""=""p4"".""change_date"") AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"""
372,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""temp"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT * FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""temp"" ON ""a"".""product_id""=""temp"".""product_id"""
373,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""latest"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""p"".""product_id"",""new_price"" AS ""price"" FROM ""products"" AS ""p"" JOIN ""cte"" ON ""p"".""product_id""=""cte"".""product_id"" AND ""p"".""change_date""=""cte"".""latest"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16'"
374,"SELECT ""a"".""product_id"",""b"".""new_price"" AS ""price"" FROM (SELECT ""product_id"",MAX(""change_date"") AS ""max_changedate"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""a"" LEFT JOIN ""Products"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""a"".""max_changedate""=""b"".""change_date"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM (SELECT ""product_id"",MAX(""change_date"") AS ""max_changedate"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""a"")"
375,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' AND ROW(""product_id"",CAST('2019-08-16' AS DATE) - ""change_date"") IN (SELECT ""product_id"",MIN(CAST('2019-08-16' AS DATE) - ""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' ORDER BY ""price"" DESC"
376,"SELECT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""r"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t"" WHERE ""r""=1) AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" GROUP BY ""a"".""product_id"""
377,"WITH ""temp"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",CASE WHEN ""t"".""new_price"" IS NULL THEN 10 ELSE ""t"".""new_price"" END AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""temp"" AS ""t"" ON ""p"".""product_id""=""t"".""product_id"" AND ""rnk""=1"
378,"SELECT ""def"".""product_id"",COALESCE(""p1"".""new_price"", 10) AS ""price"" FROM ((SELECT ""product_id"",MAX(""change_date"") AS ""m_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1) AS ""p2"" JOIN ""Products"" AS ""p1"" ON ""p1"".""product_id""=""p2"".""product_id"" AND ""p1"".""change_date""=""p2"".""m_date"") RIGHT JOIN (SELECT DISTINCT ""product_id"",10 AS ""def_price"" FROM ""Products"") AS ""def"" ON ""def"".""product_id""=""p2"".""product_id"""
379,"WITH ""products_before"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""date"" FROM (SELECT * FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""t"" GROUP BY 1), ""price_before"" AS (SELECT ""a"".""product_id"",""b"".""new_price"" FROM ""products_before"" AS ""a"" LEFT JOIN ""Products"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""a"".""date""=""b"".""change_date"") SELECT ""a"".""product_id"",CASE WHEN ""new_price"" IS NULL THEN 10 ELSE ""new_price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""a"" LEFT JOIN ""price_before"" AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
380,"WITH ""t"" AS (SELECT *,FIRST_VALUE(""new_price"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""P"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""t"" RIGHT JOIN ""Products"" AS ""P"" ON ""t"".""product_id""=""P"".""product_id"" ORDER BY 2"
381,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""a"" LEFT JOIN (SELECT ""product_id"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""xrank"",""new_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""b"".""xrank""=1 ORDER BY 2 DESC"
382,"WITH ""t"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""d"" FROM ""products"" WHERE ""change_date""<='2019-8-16' GROUP BY ""product_id"") SELECT ""p"".""product_id"",""new_price"" AS ""price"" FROM ""products"" AS ""p"" JOIN ""t"" ON ""p"".""product_id""=""t"".""product_id"" AND ""p"".""change_date""=""t"".""d"" UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""t"")"
383,"WITH ""CTE"" AS (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""r"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""price"" FROM ""CTE"" WHERE ""r""=1 UNION ALL SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""CTE"")"
384,"WITH ""t"" AS (SELECT ""product_id"",MAX(CASE WHEN ""change_date""<='2019-08-16' THEN ""change_date"" ELSE NULL END) AS ""closest_date"" FROM ""products"" GROUP BY ""product_id"") SELECT ""p"".""product_id"" AS ""product_id"",AVG(CASE WHEN ""t"".""closest_date"" IS NULL THEN 10 ELSE ""p"".""new_price"" END) AS ""price"" FROM ""products"" AS ""p"" JOIN ""t"" ON ""p"".""product_id""=""t"".""product_id"" WHERE ""t"".""closest_date""=""p"".""change_date"" OR ""t"".""closest_date"" IS NULL GROUP BY ""p"".""product_id"""
385,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT DISTINCT ""product_id"",10 FROM ""Products"" GROUP BY ""Product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
386,"SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>DATE('2019-08-16') UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<=DATE('2019-08-16') GROUP BY ""product_id"")"
387,"WITH ""last_change"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""last_change"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id""), ""soln"" AS (SELECT ""ids"".""product_id"",COALESCE(""p"".""new_price"", 10) AS ""price"" FROM ((SELECT DISTINCT ""product_id"" FROM ""products"") AS ""ids"" LEFT JOIN ""last_change"" AS ""lc"" ON ""ids"".""product_id""=""lc"".""product_id"") LEFT JOIN ""Products"" AS ""p"" ON ""lc"".""product_id""=""p"".""product_id"" AND ""lc"".""last_change""=""p"".""change_date"") SELECT * FROM ""soln"""
388,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""b"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""a"".""product_id"",""a"".""new_price"" FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""num"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""a"".""num""=1) AS ""b"" ON ""p"".""product_id""=""b"".""product_id"""
389,"SELECT ""c"".""product_id"",COALESCE(""a"".""new_price"", 10) AS ""price"" FROM (""products"" AS ""a"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""max_change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""b"" ON ""a"".""product_id""=""b"".""product_id"" AND ""a"".""change_date""=""b"".""max_change_date"") RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""c"" ON ""a"".""product_id""=""c"".""product_id"""
390,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""ranked"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""temp"" ON ""p"".""product_id""=""temp"".""product_id"" AND ""ranked""=1"
391,"SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" AS ""p"" WHERE ""change_date""<='2019-08-16' AND ""change_date"">=ALL (SELECT ""change_date"" FROM ""products"" WHERE ""change_date""<='2019-08-16' AND ""product_id""=""p"".""product_id"") UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
392,"SELECT DISTINCT ""p2"".""product_id"",COALESCE(""t"".""price"", 10) AS ""price"" FROM ""products"" AS ""p2"" LEFT JOIN (SELECT ""p1"".""product_id"" AS ""product_id"",""p1"".""new_price"" AS ""price"",DENSE_RANK() OVER (PARTITION BY ""p1"".""product_id"" ORDER BY ""p1"".""change_date"" DESC) AS ""cnt"" FROM ""products"" AS ""p1"" WHERE ""p1"".""change_date""<='2019-08-16') AS ""t"" ON ""p2"".""product_id""=""t"".""product_id"" AND ""t"".""cnt""=1"
393,"WITH ""t"" AS (SELECT ""product_id"",10 AS ""price"",'1970-01-01' AS ""begin_date"",MIN(""change_date"") AS ""end_date"" FROM ""products"" GROUP BY 1 UNION ALL SELECT ""product_id"",""new_price"" AS ""price"",""change_date"" AS ""begin_date"",LEAD(""change_date"") OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"") AS ""end_date"" FROM ""products"") SELECT ""product_id"",""price"" FROM ""t"" WHERE '2019-08-16'>=""begin_date"" AND (""end_date"" IS NULL OR '2019-08-16'<""end_date"") ORDER BY 1"
394,"SELECT DISTINCT ""p1"".""product_id"",COALESCE(""p2"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p1"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"""
395,"WITH ""r"" AS (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<'2019-08-17'), ""t"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""s"" AS (SELECT * FROM ""r"" WHERE ""rnk""=1) SELECT ""t"".""product_id"",COALESCE(""s"".""price"", 10) AS ""price"" FROM ""t"" LEFT JOIN ""s"" ON ""t"".""product_id""=""s"".""product_id"""
396,"SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY 1 HAVING MIN(""change_date"")>'2019-08-16' UNION ALL SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY 1)"
397,"WITH ""C"" AS (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) SELECT DISTINCT ""a"".""product_id"",COALESCE(""C"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN ""C"" ON ""a"".""product_id""=""C"".""product_id"""
398,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""d"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") SELECT ""p"".""product_id"",""p"".""new_price"" AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN ""cte"" ON ""p"".""change_date""=""cte"".""d"" AND ""p"".""product_id""=""cte"".""product_id"" WHERE ""cte"".""d"" IS NOT NULL UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"") GROUP BY ""product_id"""
399,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""latest"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id""), ""cte2"" AS (SELECT ""p"".""product_id"",""p"".""new_price"" FROM ""products"" AS ""p"" JOIN ""cte"" ON ""p"".""product_id""=""cte"".""product_id"" AND ""p"".""change_date""=""cte"".""latest"") SELECT ""p"".""product_id"",CASE WHEN ""cte2"".""product_id"" IS NULL THEN 10 ELSE ""cte2"".""new_price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""p"" LEFT JOIN ""cte2"" ON ""p"".""product_id""=""cte2"".""product_id"""
400,"SELECT DISTINCT ""product_id"",""new_price"" AS ""price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""max_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""TMP"" WHERE ""change_date""=""max_date"" UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM (SELECT ""product_id"",""new_price"",""change_date"",MIN(""change_date"") OVER (PARTITION BY ""product_id"") AS ""min_date"" FROM ""Products"") AS ""TMP"" WHERE ""min_date"">'2019-08-16'"
401,"SELECT DISTINCT ""p1"".""product_id"",COALESCE(""p2"".""price"", 10) AS ""price"" FROM ""products"" AS ""p1"" LEFT JOIN (SELECT ""product_id"",""new_price"" AS ""price"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""DatesRank"" FROM ""Products"" WHERE ""change_date""<=DATE('2019-08-16')) AS ""tmp"" WHERE ""tmp"".""DatesRank""=1) AS ""p2"" ON ""p1"".""product_id""=""p2"".""product_id"""
402,"WITH ""p1"" AS (SELECT *,RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""lrank"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",CASE WHEN ""change_date""<='2019-08-16' THEN ""new_price"" ELSE 10 END AS ""price"" FROM (SELECT ""product_id"",""change_date"",""new_price"" FROM ""p1"" WHERE ""lrank""=1 UNION SELECT ""product_id"",MIN(""change_date"") AS ""change_date"",NULL AS ""new_price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"">'2019-08-16')) AS ""p2"""
403,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""new_price"") AS ""price"" FROM (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""b"" WHERE ""rnk""=1 GROUP BY ""product_id"") SELECT ""product_id"",10 AS ""price"" FROM ""products"" WHERE ""change_date"">'2019-08-16' AND ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"") GROUP BY ""product_id"" UNION ALL SELECT * FROM ""cte"" ORDER BY ""product_id"""
404,"WITH ""a"" AS (SELECT ""t1"".""product_id"",""new_price"" FROM ""Products"" AS ""t1"" JOIN (SELECT ""product_id"",MAX(""change_date"") AS ""last_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"" AND ""change_date""=""last_date"") SELECT ""b"".""product_id"",CASE WHEN ""new_price"" IS NULL THEN 10 ELSE ""new_price"" END AS ""price"" FROM ""a"" RIGHT JOIN (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
405,"SELECT DISTINCT ""t1"".""product_id"",CASE WHEN ""t2"".""new_price"" IS NOT NULL THEN ""t2"".""new_price"" ELSE 10 END AS ""price"" FROM ""products"" AS ""t1"" LEFT JOIN (SELECT * FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""date_rank"" FROM ""products"" WHERE ""change_date""<=DATE('2019-08-16')) AS ""inner_t"" WHERE ""inner_t"".""date_rank""=1) AS ""t2"" ON ""t2"".""product_id""=""t1"".""product_id"""
406,"WITH ""new_price"" AS (SELECT ""product_id"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""Products"".""product_id"",CASE WHEN ""new_price"".""new_price"" IS NULL THEN 10 ELSE ""new_price"".""new_price"" END AS ""price"" FROM ""Products"" LEFT JOIN ""new_price"" ON ""Products"".""product_id""=""new_price"".""product_id"" AND ""rk""=1"
407,"WITH ""cte"" AS (SELECT ""product_id"",""new_price"" AS ""price"",""change_date"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT ""product_id"",""price"" FROM ""cte"" WHERE ""rnk""=1 UNION SELECT ""product_id"",10 FROM ""products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""cte"")"
408,"SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""rnked"" WHERE ""rnk_price""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16')"
409,"SELECT DISTINCT ""a"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM ""products"" AS ""a"" LEFT JOIN (SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""date_rank"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""a"" WHERE ""date_rank""=1) AS ""b"" ON ""a"".""product_id""=""b"".""product_id"""
410,"SELECT ""product_id"",""Price"" FROM (SELECT ""Product_ID"",""new_price"" AS ""Price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""temp"" WHERE ""rnk""=1 UNION SELECT ""Product_id"",10 FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')"
411,"SELECT ""product_id"",MAX(CASE WHEN ""p_id"" IS NULL THEN 10 ELSE ""new_price"" END) AS ""price"" FROM ""Products"" AS ""P"" LEFT JOIN (SELECT DISTINCT ""product_id"" AS ""p_id"",MAX(""change_date"") OVER (PARTITION BY ""product_id"") AS ""final_update"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""latest_update_date"" ON ""product_id""=""p_id"" AND ""final_update""=""change_date"" GROUP BY ""product_id"""
412,"SELECT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
413,"SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16' UNION SELECT ""product_id"",""new_price"" AS ""price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""Product_id"",MAX(""change_date"") FROM ""products"" WHERE ""change_date""<'2019-08-17' GROUP BY ""product_id"")"
414,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""a"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""lst"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""a"" ON ""a"".""product_id""=""p"".""product_id"""
415,"SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" GROUP BY ""product_id"" HAVING (MIN(""change_date"")>'2019-08-16') UNION SELECT ""product_id"",""new_price"" FROM ""Products"" AS ""p2"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")"
416,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""change_date"" FROM ""Products"" WHERE ""change_date""<=DATE('2019-08-16') GROUP BY ""product_id""), ""cte1"" AS (SELECT ""p"".""product_id"",""p"".""new_price"" AS ""price"" FROM ""products"" AS ""p"" JOIN ""cte"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" AND ""p"".""change_date""=""c"".""change_date"") SELECT DISTINCT ""p"".""product_id"",COALESCE(""c"".""price"", ""p"".""price"") AS ""price"" FROM (SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""products"") AS ""p"" LEFT JOIN ""cte1"" AS ""c"" ON ""p"".""product_id""=""c"".""product_id"" ORDER BY 2 DESC"
417,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""a"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM (SELECT ""product_id"",""new_price"",ROW_NUMBER() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rn"" FROM ""Products"" WHERE ""change_date""<'2019-08-17') AS ""xx"" WHERE ""xx"".""rn""=1) AS ""a"" ON ""p"".""product_id""=""a"".""product_id"""
418,"SELECT * FROM (SELECT ""product_id"",""new_price"" AS ""price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"") UNION SELECT DISTINCT ""product_id"",10 AS ""price"" FROM ""Products"" WHERE ""product_id"" NOT IN (SELECT ""product_id"" FROM ""Products"" WHERE ""change_date""<='2019-08-16')) AS ""union_results"""
419,"WITH ""t1"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""recent_change"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id""), ""t2"" AS (SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT * FROM ""t1"")), ""t3"" AS (SELECT DISTINCT ""product_id"" FROM ""Products"") SELECT ""t3"".""product_id"",COALESCE(""t2"".""new_price"", 10) AS ""price"" FROM ""t3"" LEFT JOIN ""t2"" ON ""t3"".""product_id""=""t2"".""product_id"""
420,"SELECT DISTINCT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""Products"" AS ""p"" LEFT JOIN (SELECT ""product_id"",""new_price"" FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") AS ""most_recent_date"" FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t"" ON ""p"".""product_id""=""t"".""product_id"""
421,"WITH ""before_cutoff"" AS (SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rnk_price"" FROM ""Products"" WHERE ""change_date""<='2019-08-16') AS ""rnked"" WHERE ""rnk_price""=1) SELECT ""all_id"".""product_id"",COALESCE(""price"", 10) AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""Products"") AS ""all_id"" LEFT JOIN ""before_cutoff"" AS ""bc"" ON ""all_id"".""product_id""=""bc"".""product_id"""
422,"SELECT ""product_id"",""price"" FROM (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') AS ""f"" WHERE ""f"".""rk""=1 UNION SELECT ""product_id"",10 AS ""price"" FROM ""products"" GROUP BY ""product_id"" HAVING MIN(""change_date"")>'2019-08-16'"
423,"WITH ""cte"" AS (SELECT ""product_id"",""change_date"",""new_price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rk"" FROM ""products"" WHERE ""change_date""<='2019-08-16') SELECT DISTINCT ""p"".""product_id"",COALESCE(""t"".""new_price"", 10) AS ""price"" FROM ""products"" AS ""p"" LEFT JOIN (SELECT ""product_id"" AS ""pid"",""new_price"" FROM ""cte"" WHERE ""rk""=1) AS ""t"" ON ""p"".""product_id""=""t"".""pid"""
424,"SELECT ""product_id"",COALESCE(""new_price"", 10) AS ""price"" FROM (SELECT DISTINCT ""t1"".""product_id"",""t2"".""new_price"" FROM ""Products"" AS ""t1"" LEFT JOIN (SELECT * FROM ""Products"" WHERE ROW(""product_id"",""change_date"") IN (SELECT ""product_id"",MAX(""change_date"") FROM ""Products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id"")) AS ""t2"" ON ""t1"".""product_id""=""t2"".""product_id"") AS ""t"" ORDER BY ""price"" DESC"
425,"WITH ""x"" AS (SELECT DISTINCT ""product_id"" FROM ""products""), ""y"" AS (SELECT ""product_id"",""new_price"" AS ""price"",RANK() OVER (PARTITION BY ""product_id"" ORDER BY ""change_date"" DESC) AS ""rank1"" FROM ""products"" WHERE ""change_date""<='2019-08-16'), ""z"" AS (SELECT ""product_id"",""price"" FROM ""y"" WHERE ""rank1""=1) SELECT ""x"".""product_id"",COALESCE(""z"".""price"", 10) AS ""price"" FROM ""x"" LEFT JOIN ""z"" ON ""x"".""product_id""=""z"".""product_id"""
426,"WITH ""cte"" AS (SELECT ""product_id"",MAX(""change_date"") AS ""latest"" FROM ""products"" WHERE ""change_date""<='2019-08-16' GROUP BY ""product_id""), ""cte2"" AS (SELECT ""p"".""product_id"",""p"".""new_price"" FROM ""products"" AS ""p"" JOIN ""cte"" ON ""p"".""product_id""=""cte"".""product_id"" AND ""p"".""change_date""=""cte"".""latest"") SELECT ""p"".""product_id"",CASE WHEN ""cte2"".""product_id"" IS NULL THEN 10 ELSE ""cte2"".""new_price"" END AS ""price"" FROM (SELECT DISTINCT ""product_id"" FROM ""products"") AS ""p"" LEFT JOIN ""cte2"" ON ""p"".""product_id""=""cte2"".""product_id"""
