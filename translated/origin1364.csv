id,original query
1,"WITH ""cte_customer_invoice"" AS (SELECT ""i"".""invoice_id"",""c"".""customer_id"",""c"".""customer_name"",""i"".""price"" FROM ""Invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id""), ""cte_total_contacts"" AS (SELECT ""user_id"" AS ""customer_id"",COUNT(1) AS ""tot_contacts"" FROM ""contacts"" GROUP BY ""user_id""), ""cte_trusted_contacts"" AS (SELECT ""user_id"" AS ""customer_id"",COUNT(1) AS ""trusted_contacts"" FROM ""contacts"" AS ""c"" JOIN ""customers"" AS ""cc"" ON ""c"".""contact_name""=""cc"".""customer_name"" AND ""c"".""contact_email""=""cc"".""email"" GROUP BY ""user_id""), ""cte_contacts_merged"" AS (SELECT ""c"".""customer_id"",""tot_contacts"" AS ""contacts_cnt"",COALESCE(""trusted_contacts"", 0) AS ""trusted_contacts_cnt"" FROM ""cte_total_contacts"" AS ""c"" LEFT JOIN ""cte_trusted_contacts"" AS ""cc"" ON ""c"".""customer_id""=""cc"".""customer_id"") SELECT ""i"".""invoice_id"",""i"".""customer_name"",""i"".""price"",COALESCE(""c"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""c"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte_customer_invoice"" AS ""i"" LEFT JOIN ""cte_contacts_merged"" AS ""c"" ON ""i"".""customer_id""=""c"".""customer_id"" ORDER BY ""invoice_id"""
2,"WITH ""cc"" AS (SELECT ""customer_id"",""customer_name"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY ""customer_id""), ""tcc"" AS (SELECT ""customer_id"",COUNT(DISTINCT ""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""customer_id"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""a"" LEFT JOIN ""cc"" ON ""a"".""user_id""=""cc"".""customer_id"") LEFT JOIN ""tcc"" ON ""a"".""user_id""=""tcc"".""customer_id"" ORDER BY ""invoice_id"""
3,"SELECT ""c"".""invoice_id"",""a"".""customer_name"",""c"".""price"",""a"".""contacts_cnt"",""b"".""trusted_contacts_cnt"" FROM ((SELECT ""a"".""customer_id"",""a"".""customer_name"",COALESCE(COUNT(DISTINCT ""b"".""contact_email""), 0) AS ""contacts_cnt"" FROM ""customers"" AS ""a"" LEFT JOIN ""contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY ""a"".""customer_id"") AS ""a"" JOIN (SELECT ""c"".""customer_name"",COALESCE(COUNT(DISTINCT ""b"".""contact_email""), 0) AS ""trusted_contacts_cnt"" FROM (""customers"" AS ""a"" JOIN ""contacts"" AS ""b"" ON ""a"".""customer_name""=""b"".""contact_name"" AND ""a"".""email""=""b"".""contact_email"") RIGHT JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""b"".""user_id"" GROUP BY ""c"".""customer_id"") AS ""b"" ON ""a"".""customer_name""=""b"".""customer_name"") JOIN ""invoices"" AS ""c"" ON ""a"".""customer_id""=""c"".""user_id"" ORDER BY 1"
4,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(""c"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""d"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""c"" ON ""a"".""user_id""=""c"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""contact_name""=""b"".""customer_name"" GROUP BY ""user_id"") AS ""d"" ON ""a"".""user_id""=""d"".""user_id"" ORDER BY ""a"".""invoice_id"""
5,"WITH ""contacts_cnt"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id""), ""trusted_contacts_cnt"" AS (SELECT ""user_id"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") GROUP BY ""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""cc"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""tcc"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts_cnt"" AS ""cc"" ON ""cc"".""user_id""=""i"".""user_id"") LEFT JOIN ""trusted_contacts_cnt"" AS ""tcc"" ON ""tcc"".""user_id""=""i"".""user_id"" ORDER BY ""i"".""invoice_id"""
6,"SELECT ""invoice_id"",""Cu"".""customer_name"",""I"".""price"",COALESCE(""CC"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""TCC"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I"" LEFT JOIN ""Customers"" AS ""Cu"" ON ""I"".""user_id""=""Cu"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""CC"" ON ""I"".""user_id""=""CC"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") GROUP BY ""user_id"") AS ""TCC"" ON ""I"".""user_id""=""TCC"".""user_id"" ORDER BY ""invoice_id"""
7,"WITH ""cte"" AS (SELECT ""Customers"".""customer_id"" AS ""id"",""Customers"".""customer_name"" AS ""name"",""Contacts"".""contact_name"" AS ""contact_name"" FROM ""Customers"" LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id""), ""cte2"" AS (SELECT ""id"",""name"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""cte"" GROUP BY ""id"",""name"") SELECT ""Invoices"".""invoice_id"",""cte2"".""name"" AS ""customer_name"",""Invoices"".""price"",""cte2"".""contacts_cnt"",""cte2"".""trusted_contacts_cnt"" FROM ""Invoices"" LEFT JOIN ""cte2"" ON ""Invoices"".""user_id""=""cte2"".""id"" ORDER BY ""Invoices"".""invoice_id"""
8,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""t"".""ncont"", 0) AS ""contacts_cnt"",COALESCE(""t"".""ntrust"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""ncont"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""ntrust"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""t"" USING (""user_id"")) LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""i"".""invoice_id"""
9,"WITH ""t1"" AS (SELECT ""user_id"",COUNT(""user_id"") AS ""f1"" FROM ""Contacts"" GROUP BY ""user_id""), ""t2"" AS (SELECT ""user_id"",COUNT(""user_id"") AS ""f2"" FROM ""contacts"" AS ""con"" JOIN ""Customers"" AS ""cus"" ON ""cus"".""customer_name""=""con"".""contact_name"" AND ""con"".""contact_email""=""cus"".""email"" GROUP BY ""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""t1"".""f1"", 0) AS ""contacts_cnt"",COALESCE(""t2"".""f2"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""t1"" ON ""t1"".""user_id""=""i"".""user_id"") LEFT JOIN ""t2"" ON ""t2"".""user_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
10,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" LEFT JOIN ""customers"" ON ""invoices"".""user_id""=""customers"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""sub"" ON ""invoices"".""user_id""=""sub"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""sub2"" ON ""invoices"".""user_id""=""sub2"".""user_id"" ORDER BY ""invoice_id"""
11,"WITH ""cte_contacts"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id""), ""cte_invoice"" AS (SELECT ""invoice_id"",""price"",""i"".""user_id"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"" FROM ""invoices"" AS ""i"" LEFT JOIN ""cte_contacts"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id""), ""cte_trusted"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""c"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY ""user_id"") SELECT ""invoice_id"",""c"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""cte_invoice"" AS ""ci"" LEFT JOIN ""customers"" AS ""c"" ON ""ci"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte_trusted"" AS ""ct"" ON ""ct"".""user_id""=""ci"".""user_id"" ORDER BY ""invoice_id"""
12,"WITH ""trust"" AS (SELECT ""co"".*,CASE WHEN ""cu"".""email"" IS NOT NULL THEN 1 ELSE 0 END AS ""trust_ind"" FROM ""contacts"" AS ""co"" LEFT JOIN ""customers"" AS ""cu"" ON ""co"".""contact_email""=""cu"".""email""), ""cte"" AS (SELECT ""cu"".""customer_id"",""cu"".""customer_name"",COUNT(""contact_email"") AS ""contacts_cnt"",COALESCE(SUM(""t"".""trust_ind""), 0) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""cu"" LEFT JOIN ""trust"" AS ""t"" ON ""cu"".""customer_id""=""t"".""user_id"" GROUP BY 1,2) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""customer_id"" ORDER BY ""invoice_id"""
13,"WITH ""contacts_lkp"" AS (SELECT ""ct"".*,CASE WHEN ""cust_emails"".""email"" IS NOT NULL THEN 1 ELSE 0 END AS ""is_trusted"" FROM ""contacts"" AS ""ct"" LEFT JOIN (SELECT ""email"" FROM ""customers"" GROUP BY ""email"") AS ""cust_emails"" ON ""ct"".""contact_email""=""cust_emails"".""email""), ""contact_info"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(""is_trusted"") AS ""trusted_contacts_cnt"" FROM ""contacts_lkp"" GROUP BY ""user_id"") SELECT ""i"".""invoice_id"",""ct"".""customer_name"",""i"".""price"",COALESCE(""ci"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""ci"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""ct"" ON ""i"".""user_id""=""ct"".""customer_id"") LEFT JOIN ""contact_info"" AS ""ci"" ON ""i"".""user_id""=""ci"".""user_id"" ORDER BY ""invoice_id"""
14,"WITH ""t"" AS (SELECT ""cu"".""customer_id"",""cu"".""customer_name"",""cu"".""email"",COALESCE(COUNT(DISTINCT ""c"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(COUNT(DISTINCT ""trust"".""email""), 0) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""cu"" LEFT JOIN ""Contacts"" AS ""c"" ON ""cu"".""customer_id""=""c"".""user_id"") LEFT JOIN ""Customers"" AS ""trust"" ON ""c"".""contact_name""=""trust"".""customer_name"" AND ""c"".""contact_email""=""trust"".""email"" GROUP BY 1,2,3) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""Invoices"" JOIN ""t"" ON ""t"".""customer_id""=""Invoices"".""user_id"" ORDER BY 1"
15,"WITH ""temp"" AS (SELECT ""C1"".""customer_id"",""C1"".""customer_name"",COUNT(""C2"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""C2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"" AS ""C1"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""C1"" LEFT JOIN ""Contacts"" AS ""C2"" ON ""C1"".""customer_id""=""C2"".""user_id"" GROUP BY ""C1"".""customer_id"") SELECT ""I"".""Invoice_id"",""temp"".""customer_name"",""I"".""price"",""temp"".""contacts_cnt"",""temp"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""I"" JOIN ""temp"" ON ""I"".""user_id""=""temp"".""customer_id"" ORDER BY ""invoice_id"""
16,"WITH ""t1"" AS (SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""customer_id"" FROM ""Invoices"" AS ""i"" RIGHT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id""), ""t2"" AS (SELECT ""c"".""customer_id"",COUNT(""d"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""d"".""contact_email"" IN (SELECT ""c1"".""email"" FROM ""Customers"" AS ""c1"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""c"" JOIN ""Contacts"" AS ""d"" ON ""d"".""user_id""=""c"".""customer_id"" GROUP BY 1) SELECT ""t1"".""invoice_id"",""t1"".""customer_name"",""t1"".""price"",COALESCE(""t2"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t2"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""customer_id""=""t2"".""customer_id"" WHERE ""t1"".""invoice_id"" IS NOT NULL ORDER BY 1"
17,"WITH ""cte"" AS (SELECT * FROM ""Contacts"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""contact_name""=""b"".""customer_name"") SELECT ""a"".""invoice_id"",""m"".""customer_name"",""a"".""price"",COALESCE(""b"".""cnt"", 0) AS ""contacts_cnt"",COALESCE(""c"".""cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""m"" ON ""a"".""user_id""=""m"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""cnt"" FROM ""cte"" GROUP BY ""user_id"") AS ""b"" ON ""a"".""user_id""=""b"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""cnt"" FROM ""cte"" WHERE ""customer_id"" IS NOT NULL GROUP BY ""user_id"") AS ""c"" ON ""b"".""user_id""=""c"".""user_id"" ORDER BY ""invoice_id"""
18,"SELECT ""t1"".""invoice_id"",""t2"".""customer_name"",""t1"".""price"",COALESCE(SUM(""t3"".""contacts_cnt""), 0) AS ""contacts_cnt"",COALESCE(SUM(""t4"".""trusted_contacts_cnt""), 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""t1"" JOIN ""customers"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY 1) AS ""t3"" ON ""t1"".""user_id""=""t3"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""customers"") GROUP BY 1) AS ""t4"" ON ""t1"".""user_id""=""t4"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
19,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""a"" ON ""Invoices"".""user_id""=""a"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""user_id"") AS ""b"" ON ""Invoices"".""user_id""=""b"".""user_id"") JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"" ORDER BY ""invoice_id"""
20,"WITH ""cnt"" AS (SELECT ""c"".""customer_name"",""c"".""customer_id"",COUNT(""cn"".""user_id"") AS ""contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""cn"" ON ""c"".""customer_id""=""cn"".""user_id"" GROUP BY ""c"".""customer_id""), ""trust"" AS (SELECT ""c"".""customer_name"",""c"".""customer_id"",COUNT(""cn"".""contact_name"") AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""cn"" ON ""c"".""customer_id""=""cn"".""user_id"" WHERE ""cn"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY ""c"".""customer_id"") SELECT ""i"".""invoice_id"",""cnt"".""customer_name"",""i"".""price"",COALESCE(""cnt"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trust"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""cnt"" ON ""i"".""user_id""=""cnt"".""customer_id"") LEFT JOIN ""trust"" ON ""i"".""user_id""=""trust"".""customer_id"" ORDER BY ""invoice_id"""
21,"WITH ""trusted_con"" AS (SELECT ""co"".""user_id"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""co"" JOIN ""customers"" AS ""cu"" ON ""co"".""contact_email""=""cu"".""email"" GROUP BY 1), ""con"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"" FROM ""contacts"" GROUP BY 1) SELECT ""invoice_id"",""c"".""customer_name"",""price"",COALESCE(""con"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_con"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""con"" ON ""i"".""user_id""=""con"".""user_id"") LEFT JOIN ""trusted_con"" ON ""i"".""user_id""=""trusted_con"".""user_id"" ORDER BY 1"
22,"WITH ""trusted_contacts"" AS (SELECT ""ct"".""user_id"",COUNT(""ct"".""contact_email"") AS ""contacts_cnt"",COUNT(""c"".""email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""ct"" LEFT JOIN ""customers"" AS ""c"" ON ""ct"".""contact_email""=""c"".""email"" GROUP BY 1) SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""t"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""trusted_contacts"" AS ""t"" ON ""i"".""user_id""=""t"".""user_id"") JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""i"".""invoice_id"""
23,"WITH ""CTE_CONT"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id""), ""CTE_Trusted_contacts"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""user_id"") SELECT ""invoice_id"",""CC"".""customer_name"",""price"",COALESCE(""CO"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""TCO"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I"" JOIN ""Customers"" AS ""CC"" ON ""I"".""user_id""=""CC"".""customer_id"") LEFT JOIN ""CTE_CONT"" AS ""CO"" ON ""I"".""user_id""=""CO"".""user_id"") LEFT JOIN ""CTE_Trusted_contacts"" AS ""TCO"" ON ""I"".""user_id""=""TCO"".""user_id"" ORDER BY 1"
24,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""user_id"") AS ""contacts_cnt"",COUNT(""cu"".""email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""c"" LEFT JOIN ""customers"" AS ""cu"" ON ""c"".""contact_email""=""cu"".""email"" GROUP BY ""user_id"") SELECT ""invoice_id"",""cu"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""cte"" ON ""cte"".""user_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
25,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""t"".""cnt"", 0) AS ""contacts_cnt"",COALESCE(""t2"".""cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""t"" ON ""i"".""user_id""=""t"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""cnt"" FROM ""Contacts"" WHERE ROW(""contact_name"",""contact_email"") IN (SELECT ""customer_name"",""email"" FROM ""Customers"") GROUP BY ""user_id"") AS ""t2"" ON ""i"".""user_id""=""t2"".""user_id"" ORDER BY ""invoice_id"""
26,"WITH ""cte"" AS (SELECT ""cust1"".""customer_id"",""cust1"".""customer_name"",""cust1"".""contact_name"",""cust1"".""contact_email"" FROM (SELECT ""cust"".""customer_id"",""cust"".""customer_name"",""c"".""contact_name"",""c"".""contact_email"" FROM ""customers"" AS ""cust"" LEFT JOIN ""contacts"" AS ""c"" ON ""cust"".""customer_id""=""c"".""user_id"") AS ""cust1"") SELECT ""I"".""invoice_id"",""c"".""customer_name"",""I"".""price"",""temp"".""contacts_cnt"",""temp"".""trusted_contacts_cnt"" FROM (""invoices"" AS ""I"" JOIN (SELECT ""A"".""customer_id"",COUNT(""A"".""contact_name"") AS ""contacts_cnt"",COUNT(""B"".""customer_id"") AS ""trusted_contacts_cnt"" FROM ""cte"" AS ""A"" LEFT JOIN ""customers"" AS ""B"" ON ""A"".""contact_email""=""B"".""email"" GROUP BY ""A"".""customer_id"") AS ""temp"" ON ""I"".""user_id""=""temp"".""customer_id"") JOIN ""Customers"" AS ""c"" ON ""I"".""user_id""=""c"".""customer_id"" ORDER BY ""I"".""invoice_id"""
27,"WITH ""cte"" AS (SELECT ""c1"".""customer_id"",MAX(""c1"".""customer_name"") AS ""customer_name"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""c"" RIGHT JOIN ""customers"" AS ""c1"" ON ""c"".""user_id""=""c1"".""customer_id"" GROUP BY ""c1"".""customer_id"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" JOIN ""cte"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY 1"
28,"WITH ""cte"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""ct"" ON ""c"".""customer_id""=""ct"".""user_id"" GROUP BY 1,2) SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""customer_id"" ORDER BY 1"
29,"WITH ""conts"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(CASE WHEN ""customer_name"" IS NULL THEN 0 ELSE 1 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""con"" LEFT JOIN ""customers"" AS ""cus"" ON ""con"".""contact_email""=""cus"".""email"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""i"".""price"",CASE WHEN ""contacts_cnt"" IS NULL THEN 0 ELSE ""contacts_cnt"" END AS ""contacts_cnt"",CASE WHEN ""trusted_contacts_cnt"" IS NULL THEN 0 ELSE ""trusted_contacts_cnt"" END AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""conts"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id"") JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"" ORDER BY ""invoice_id"""
30,"WITH ""cte1"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""ct"" FROM ""contacts"" GROUP BY ""user_id""), ""cte2"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""trusted_ct"" FROM ""contacts"" JOIN ""customers"" ON ""email""=""contact_email"" GROUP BY ""user_id""), ""cte3"" AS (SELECT ""m"".""customer_id"",""customer_name"",COALESCE(""c1"".""ct"", 0) AS ""ct"",COALESCE(""c2"".""trusted_ct"", 0) AS ""trusted_ct"" FROM (""customers"" AS ""m"" LEFT JOIN ""cte1"" AS ""c1"" ON ""m"".""customer_id""=""c1"".""user_id"") LEFT JOIN ""cte2"" AS ""c2"" ON ""m"".""customer_id""=""c2"".""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",""ct"" AS ""contacts_cnt"",""trusted_ct"" AS ""trusted_contacts_cnt"" FROM ""invoices"" JOIN ""cte3"" ON ""user_id""=""customer_id"" ORDER BY 1"
31,"SELECT ""A"".""invoice_id"",""A"".""customer_name"",""A"".""price"",COALESCE(""B"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""B"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (SELECT ""i"".""invoice_id"",""i"".""user_id"",""c"".""customer_name"",""i"".""price"" FROM ""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") AS ""A"" LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY 1) AS ""B"" ON ""A"".""user_id""=""B"".""user_id"" ORDER BY 1"
32,"WITH ""temp"" AS (SELECT ""C1"".""customer_id"",""C1"".""customer_name"",COUNT(""C2"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""C2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"" AS ""C1"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""C1"" LEFT JOIN ""Contacts"" AS ""C2"" ON ""C1"".""customer_id""=""C2"".""user_id"" GROUP BY ""C1"".""customer_id"") SELECT ""I"".""Invoice_id"",""temp"".""customer_name"",""I"".""price"",""temp"".""contacts_cnt"",""temp"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""I"" JOIN ""temp"" ON ""I"".""user_id""=""temp"".""customer_id"" ORDER BY ""invoice_id"""
33,"WITH ""customer_contacts"" AS (SELECT ""user_id"",COUNT(1) AS ""cc_count"" FROM ""Contacts"" GROUP BY ""user_id""), ""trusted_contacts"" AS (SELECT ""user_id"",COUNT(1) AS ""tc_count"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""cc"".""cc_count"", 0) AS ""contacts_cnt"",COALESCE(""tc"".""tc_count"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customer_contacts"" AS ""cc"" ON ""i"".""user_id""=""cc"".""user_id"") LEFT JOIN ""trusted_contacts"" AS ""tc"" ON ""i"".""user_id""=""tc"".""user_id"" ORDER BY ""invoice_id"""
34,"WITH ""trusted_contacts"" AS (SELECT ""user_id"",COUNT(""customer_id"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""c"" LEFT JOIN ""customers"" AS ""cust"" ON ""c"".""contact_name""=""cust"".""customer_name"" GROUP BY ""user_id""), ""knowns"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" AS ""c"" GROUP BY ""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""knowns"" AS ""k"" ON ""i"".""user_id""=""k"".""user_id"") LEFT JOIN ""trusted_contacts"" AS ""t"" ON ""i"".""user_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
35,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (SELECT ""invoice_id"",""customer_name"",""price"",""user_id"" FROM ""Invoices"" AS ""a"" JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") AS ""t1"" LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" ORDER BY ""invoice_id"""
36,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_email"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c1"" ON ""c1"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""co"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""Customers"" AS ""c2"" ON ""c2"".""email""=""co"".""contact_email"" GROUP BY 1,2,3 ORDER BY 1"
37,"WITH ""bb"" AS (SELECT ""a"".""user_id"" AS ""id"",COUNT(""b"".""customer_id"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""contact_email""=""b"".""email"" GROUP BY ""a"".""user_id""), ""aa"" AS (SELECT ""a"".""customer_id"" AS ""id"",""a"".""customer_name"",COUNT(""b"".""contact_name"") AS ""contacts_cnt"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY ""a"".""customer_id"") SELECT ""a"".""invoice_id"",""aa"".""customer_name"",""a"".""price"",COALESCE(""aa"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""bb"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""a"" LEFT JOIN ""aa"" ON ""a"".""user_id""=""aa"".""id"") LEFT JOIN ""bb"" ON ""a"".""user_id""=""bb"".""id"" ORDER BY ""a"".""invoice_id"""
38,"SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM (SELECT ""invoice_id"",""Invoices"".""user_id"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" LEFT JOIN (SELECT ""user_id"",COUNT(""user_id"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""a"" ON ""Invoices"".""user_id""=""a"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""user_id"") AS ""trusted_contacts_cnt"" FROM (""Contacts"") JOIN ""Customers"" WHERE ""Customers"".""email""=""Contacts"".""contact_email"" GROUP BY ""user_id"") AS ""b"" ON ""Invoices"".""user_id""=""b"".""user_id"" ORDER BY ""invoice_id"") AS ""combine"" LEFT JOIN ""Customers"" ON ""combine"".""user_id""=""Customers"".""customer_id"" ORDER BY ""invoice_id"""
39,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"",COUNT(""cu"".""email"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""c"" LEFT JOIN ""Customers"" AS ""cu"" ON ""c"".""contact_email""=""cu"".""email"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""cte"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id"" ORDER BY ""invoice_id"""
40,"WITH ""abc"" AS (SELECT ""a"".""customer_id"",COUNT(""b"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""b"".""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""a"" LEFT JOIN ""contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY 1), ""xyz"" AS (SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""user_id"",""a"".""price"" FROM ""invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") SELECT ""a"".""invoice_id"",""a"".""customer_name"",""a"".""price"",""b"".""contacts_cnt"",""b"".""trusted_contacts_cnt"" FROM ""xyz"" AS ""a"" JOIN ""abc"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"" ORDER BY ""invoice_id"""
41,"SELECT ""i"".""invoice_id"",""t"".""customer_name"",""i"".""price"",""t"".""contacts_cnt"",""t"".""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" JOIN (SELECT ""c1"".""customer_id"",""c1"".""customer_name"",COUNT(DISTINCT ""c"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c1"" LEFT JOIN ""contacts"" AS ""c"" ON ""c1"".""customer_id""=""c"".""user_id"" GROUP BY ""c1"".""customer_id"") AS ""t"" ON ""i"".""user_id""=""t"".""customer_id"" ORDER BY ""i"".""invoice_id"""
42,"WITH ""t1"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contact_cnt"" FROM ""Contacts"" AS ""c"" GROUP BY 1), ""t2"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""trusted_contact_cnt"" FROM ""Contacts"" AS ""c"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") GROUP BY 1) SELECT DISTINCT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""t1"".""contact_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t2"".""trusted_contact_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""t1"" ON ""i"".""user_id""=""t1"".""user_id"") LEFT JOIN ""t2"" ON ""i"".""user_id""=""t2"".""user_id"" ORDER BY ""invoice_id"""
43,"WITH ""cte1"" AS (SELECT ""user_id"",COUNT(""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""c"" JOIN ""Customers"" AS ""o"" ON ""c"".""contact_name""=""o"".""customer_name"" AND ""c"".""contact_email""=""o"".""email"" GROUP BY ""user_id""), ""cte2"" AS (SELECT ""invoice_id"",COUNT(""c"".""user_id"") AS ""contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""Contacts"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id"" GROUP BY ""invoice_id"") SELECT ""i"".""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte2"" ON ""i"".""invoice_id""=""cte2"".""invoice_id"") LEFT JOIN ""cte1"" ON ""cte1"".""user_id""=""i"".""user_id"" ORDER BY ""i"".""invoice_id"""
44,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""contacts_cnt"",""c"".""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" LEFT JOIN (SELECT ""c"".""customer_id"",""c"".""customer_name"",COALESCE(COUNT(""t"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(SUM(""t"".""contact_email"" IN (SELECT ""email"" FROM ""customers"")), 0) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""t"" ON ""t"".""user_id""=""c"".""customer_id"" GROUP BY ""c"".""customer_id"") AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""i"".""invoice_id"""
45,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY 1) SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""user_id"" ORDER BY 1"
46,"WITH ""contacts_by_user"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",COUNT(""cu"".""email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""c"" LEFT JOIN ""customers"" AS ""cu"" ON ""c"".""contact_email""=""cu"".""email"" GROUP BY 1) SELECT ""invoice_id"",""cu"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""contacts_by_user"" AS ""u"" ON ""u"".""user_id""=""i"".""user_id"" ORDER BY 1"
47,"WITH ""t1"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(""trusted_flag"") AS ""trusted_contacts_cnt"" FROM (SELECT ""a"".*,CASE WHEN ""b"".""customer_name"" IS NOT NULL THEN 1 ELSE 0 END AS ""trusted_flag"" FROM ""Contacts"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""contact_name""=""b"".""customer_name"" AND ""a"".""contact_email""=""b"".""email"") AS ""c"" GROUP BY ""user_id"") SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(""c"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""c"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""t1"" AS ""c"" ON ""a"".""user_id""=""c"".""user_id"" ORDER BY ""a"".""invoice_id"""
48,"WITH ""tmp"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(CASE WHEN ""email"" IS NULL THEN 0 ELSE 1 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" LEFT JOIN ""Customers"" ON ""email""=""contact_email"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""tmp"" ON ""i"".""user_id""=""tmp"".""user_id"" ORDER BY ""invoice_id"""
49,"WITH ""CTE_CONT"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id""), ""CTE_Trusted_contacts"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""user_id"") SELECT ""invoice_id"",""CC"".""customer_name"",""price"",COALESCE(""CO"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""TCO"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I"" JOIN ""Customers"" AS ""CC"" ON ""I"".""user_id""=""CC"".""customer_id"") LEFT JOIN ""CTE_CONT"" AS ""CO"" ON ""I"".""user_id""=""CO"".""user_id"") LEFT JOIN ""CTE_Trusted_contacts"" AS ""TCO"" ON ""I"".""user_id""=""TCO"".""user_id"" ORDER BY 1"
50,"WITH ""cte"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""b"".""user_id"") AS ""contacts_cnt"",COALESCE(SUM(""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"")), 0) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY ""customer_id"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""Invoices"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"" ORDER BY 1"
51,"WITH ""cte1"" AS (SELECT ""ct"".""user_id"",COUNT(1) AS ""contact_cnt"",SUM(CASE WHEN ""c"".""customer_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""ct"" LEFT JOIN ""customers"" AS ""c"" ON ""ct"".""contact_name""=""c"".""customer_name"" AND ""ct"".""contact_email""=""c"".""email"" GROUP BY ""ct"".""user_id"") SELECT ""i"".""invoice_id"" AS ""invoice_id"",""c"".""customer_name"" AS ""customer_name"",""i"".""price"" AS ""price"",COALESCE(""cte1"".""contact_cnt"", 0) AS ""contacts_cnt"",COALESCE(""cte1"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte1"" ON ""c"".""customer_id""=""cte1"".""user_id"" ORDER BY ""invoice_id"""
52,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" LEFT JOIN ""customers"" ON ""invoices"".""user_id""=""customers"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""sub"" ON ""invoices"".""user_id""=""sub"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""sub2"" ON ""invoices"".""user_id""=""sub2"".""user_id"" ORDER BY ""invoice_id"""
53,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""ct"".""user_id"") AS ""contacts_cnt"",COUNT(""c1"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Contacts"" AS ""ct"" ON ""i"".""user_id""=""ct"".""user_id"") LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Customers"" AS ""c1"" ON ""ct"".""contact_email""=""c1"".""email"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
54,"WITH ""t1"" AS (SELECT ""invoice_id"",""b"".""user_id"",""customer_name"",""price"",""customer_id"" FROM ""customers"" AS ""a"" JOIN ""invoices"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id""), ""t2"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""relates"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusts"" FROM ""contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""t1"".""customer_name"",""price"",COALESCE(""relates"", 0) AS ""contacts_cnt"",COALESCE(""trusts"", 0) AS ""trusted_contacts_cnt"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""customer_id""=""t2"".""user_id"" ORDER BY ""invoice_id"""
55,"SELECT ""invoice_id"",""customer_name"",""price"",CASE WHEN ""contacts_cnt"" IS NULL THEN 0 ELSE ""contacts_cnt"" END AS ""contacts_cnt"",CASE WHEN ""trusted_contacts_cnt"" IS NULL THEN 0 ELSE ""trusted_contacts_cnt"" END AS ""trusted_contacts_cnt"" FROM (""Invoices"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(""is_trusted"") AS ""trusted_contacts_cnt"" FROM (SELECT *,CASE WHEN ""email"" IS NULL THEN 0 ELSE 1 END AS ""is_trusted"" FROM ""Contacts"" AS ""CO"" LEFT JOIN ""Customers"" AS ""CU"" ON ""CO"".""contact_email""=""CU"".""email"") AS ""CO"" GROUP BY ""user_id"") AS ""tampa"" ON ""tampa"".""user_id""=""invoices"".""user_id"") JOIN ""Customers"" ON ""Invoices"".""user_id""=""customer_id"" ORDER BY ""invoices"".""invoice_id"""
56,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (SELECT ""invoice_id"",""customer_name"",""price"",""user_id"" FROM ""Invoices"" AS ""a"" JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") AS ""t1"" LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"" ORDER BY ""invoice_id"""
57,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contacts"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""cte"".""user_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
58,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"" ORDER BY ""i"".""invoice_id"""
59,"WITH ""CTE"" AS (SELECT ""customer_id"",""customer_name"",""email"",COUNT(""c"".""user_id"") AS ""contacts_cnt"" FROM ""customers"" LEFT JOIN ""Contacts"" AS ""c"" ON ""c"".""user_id""=""customer_id"" GROUP BY ""customer_id"",""customer_name"",""email""), ""cte2"" AS (SELECT ""customer_id"",""customer_name"",""email"",""contacts_cnt"",COUNT(""tc"".""user_id"") AS ""trusted_contacts_cnt"" FROM ""cte"" LEFT JOIN ""Contacts"" AS ""tc"" ON ""tc"".""user_id""=""cte"".""customer_id"" AND ""tc"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY ""customer_id"",""customer_name"",""email"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""invoices"" JOIN ""cte2"" ON ""customer_id""=""user_id"" ORDER BY ""invoice_id"""
60,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(""trusted_contact"") AS ""trusted_contacts_cnt"" FROM (SELECT ""user_id"",CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END AS ""trusted_contact"" FROM ""Contacts"") AS ""a"" GROUP BY 1) SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""user_id"" ORDER BY 1"
61,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(""c"".""contact_cnt"", 0) AS ""contacts_cnt"",COALESCE(""d"".""trusted_contact_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""contact_cnt"" FROM ""contacts"" GROUP BY 1) AS ""c"" ON ""a"".""user_id""=""c"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""trusted_contact_cnt"" FROM ""contacts"" AS ""e"" JOIN ""customers"" AS ""f"" ON ""e"".""contact_name""=""f"".""customer_name"" GROUP BY 1) AS ""d"" ON ""a"".""user_id""=""d"".""user_id"" ORDER BY 1"
62,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
63,"SELECT ""invoice_id"",""C1"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I1"" JOIN ""Customers"" AS ""C1"" ON ""I1"".""user_id""=""C1"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""T1"" ON ""C1"".""customer_id""=""T1"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""user_id"") AS ""T2"" ON ""C1"".""customer_id""=""T2"".""user_id"" ORDER BY ""invoice_id"""
64,"WITH ""t"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id""), ""t2"" AS (SELECT ""co"".""user_id"",COUNT(""c"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""co"" LEFT JOIN ""Customers"" AS ""c"" ON ""c"".""customer_name""=""co"".""contact_name"" AND ""c"".""email""=""co"".""contact_email"" GROUP BY ""co"".""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""t"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t2"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""t"" ON ""t"".""user_id""=""i"".""user_id"") LEFT JOIN ""t2"" ON ""t2"".""user_id""=""i"".""user_id"" ORDER BY ""i"".""invoice_id"""
65,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
66,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""c"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""contacts"" AS ""c"" USING (""user_id"")) LEFT JOIN ""customers"" AS ""cu"" ON ""cu"".""customer_id""=""i"".""user_id"" GROUP BY 1 ORDER BY 1"
67,"SELECT ""i"".""invoice_id"" AS ""invoice_id"",""sub2"".""customer_name"" AS ""customer_name"",""i"".""price"" AS ""price"",""sub2"".""contact_cnt"" AS ""contacts_cnt"",""sub2"".""trusted_contacts_cnt"" AS ""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" LEFT JOIN (SELECT ""sub1"".""customer_id"" AS ""customer_id"",""sub1"".""customer_name"" AS ""customer_name"",COUNT(""sub1"".""contact_name"") AS ""contact_cnt"",COUNT(""trusted_contact"") AS ""trusted_contacts_cnt"" FROM (SELECT ""t2"".""customer_id"" AS ""customer_id"",""t2"".""customer_name"" AS ""customer_name"",""t1"".""contact_name"" AS ""contact_name"",CASE WHEN ""t1"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 'Y' ELSE NULL END AS ""trusted_contact"" FROM ""Contacts"" AS ""t1"" RIGHT JOIN ""Customers"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""customer_id"") AS ""sub1"" GROUP BY ""sub1"".""customer_id"",""sub1"".""customer_name"") AS ""sub2"" ON ""i"".""user_id""=""sub2"".""customer_id"" ORDER BY 1"
68,"SELECT ""invoice_id"",""customer_name"",""price"",CASE WHEN ""contacts_cnt"" IS NULL THEN 0 ELSE ""contacts_cnt"" END AS ""contacts_cnt"",CASE WHEN ""trusted_contacts_cnt"" IS NULL THEN 0 ELSE ""trusted_contacts_cnt"" END AS ""trusted_contacts_cnt"" FROM (""Customers"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(""is_trusted"") AS ""trusted_contacts_cnt"" FROM (SELECT *,CASE WHEN ""email"" IS NULL THEN 0 ELSE 1 END AS ""is_trusted"" FROM ""Contacts"" AS ""CO"" LEFT JOIN ""Customers"" AS ""CU"" ON ""CO"".""contact_email""=""CU"".""email"") AS ""CO"" GROUP BY ""user_id"") AS ""tampa"" ON ""user_id""=""customer_id"") JOIN ""Invoices"" ON ""Invoices"".""user_id""=""customer_id"" ORDER BY ""invoices"".""invoice_id"""
69,"WITH ""cte"" AS (SELECT ""C"".""customer_id"",""C"".""customer_name"",COUNT(""Cn"".""contact_email"") AS ""contacts_cnt"",COALESCE(SUM(""Cn"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"")), 0) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""C"" LEFT JOIN ""Contacts"" AS ""Cn"" ON ""C"".""customer_id""=""Cn"".""user_id"" GROUP BY ""C"".""customer_id"") SELECT ""I"".""invoice_id"",""cte"".""customer_name"",""I"".""price"",""cte"".""contacts_cnt"",""cte"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""I"" LEFT JOIN ""cte"" ON ""I"".""user_id""=""cte"".""customer_id"" GROUP BY ""I"".""invoice_id"" ORDER BY ""I"".""invoice_id"""
70,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(1) AS ""ct"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted"" FROM ""Contacts"" GROUP BY ""user_id"") SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COALESCE(""cte"".""ct"", 0) AS ""contacts_cnt"",COALESCE(""cte"".""trusted"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""user_id"" ORDER BY 1"
71,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COALESCE(""c2"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""c2"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN (SELECT ""Contacts"".""user_id"",COUNT(""Contacts"".""contact_email"") AS ""contacts_cnt"",COUNT(""Customers"".""email"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" LEFT JOIN ""Customers"" ON ""Contacts"".""contact_email""=""Customers"".""email"" GROUP BY ""Contacts"".""user_id"") AS ""c2"" ON ""i"".""user_id""=""c2"".""user_id"" ORDER BY ""i"".""invoice_id"""
72,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""ct"".""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""c"".""customer_id""=""ct"".""user_id"" GROUP BY 1 ORDER BY 1"
73,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COALESCE(COUNT(DISTINCT ""c2"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(COUNT(DISTINCT ""c_trust"".""customer_id""), 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""contacts"" AS ""c2"" ON ""c2"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""customers"" AS ""c_trust"" ON ""c_trust"".""email""=""c2"".""contact_email"" GROUP BY 1,2,3"
74,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY 1), ""cte2"" AS (SELECT ""customer_id"",COUNT(""b"".""contact_email"") AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" AND ""b"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""x"" LEFT JOIN ""Customers"" AS ""y"" ON ""x"".""user_id""=""y"".""customer_id"") LEFT JOIN ""cte"" AS ""i"" ON ""x"".""user_id""=""i"".""user_id"") LEFT JOIN ""cte2"" AS ""k"" ON ""x"".""user_id""=""k"".""customer_id"" ORDER BY ""invoice_id"""
75,"WITH ""cust_contacts"" AS (SELECT ""customer_id"",""customer_name"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""co"" ON ""co"".""user_id""=""c"".""customer_id"" GROUP BY 1,2), ""trusted_cust_contacts"" AS (SELECT ""customer_id"",""customer_name"",COUNT(DISTINCT ""contact_name"") AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""co"" ON ""co"".""user_id""=""c"".""customer_id"" WHERE EXISTS (SELECT * FROM ""customers"" AS ""c1"" WHERE ""c1"".""customer_name""=""co"".""contact_name"" AND ""c1"".""email""=""co"".""contact_email"") GROUP BY 1,2) SELECT DISTINCT ""invoice_id"",""cc"".""customer_name"",""i"".""price"",""cc"".""contacts_cnt"",COALESCE(""tcc"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""cust_contacts"" AS ""cc"" ON ""cc"".""customer_id""=""i"".""user_id"") LEFT JOIN ""trusted_cust_contacts"" AS ""tcc"" ON ""tcc"".""customer_id""=""i"".""user_id"" ORDER BY 1"
76,"WITH ""tmp"" AS (SELECT ""user_id"",COUNT(""b"".""customer_name"") AS ""trusted_contacts_cnt"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""contact_email""=""b"".""email"" GROUP BY ""user_id""), ""tmp1"" AS (SELECT ""customer_id"",""customer_name"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"" FROM ""customers"" AS ""a"" LEFT JOIN ""tmp"" AS ""b"" ON ""customer_id""=""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""invoices"" AS ""a"" LEFT JOIN ""tmp1"" AS ""b"" ON ""user_id""=""customer_id"" ORDER BY ""invoice_id"""
77,"WITH ""contacts_by_user"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",COUNT(""cu"".""email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""c"" LEFT JOIN ""customers"" AS ""cu"" ON ""c"".""contact_email""=""cu"".""email"" GROUP BY 1) SELECT ""i"".""invoice_id"",""x"".""customer_name"",""i"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""contacts_by_user"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id"") LEFT JOIN ""Customers"" AS ""x"" ON ""i"".""user_id""=""x"".""customer_id"" ORDER BY ""i"".""invoice_id"""
78,"WITH ""u"" AS (SELECT ""t"".""customer_id"",""t"".""customer_name"",COUNT(""t"".""contact_name"") AS ""contacts_cnt"",COALESCE(SUM(CASE WHEN ""t"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END)) AS ""trusted_contacts_cnt"" FROM (SELECT ""c"".""customer_id"",""c"".""customer_name"",""c"".""email"",""c1"".""contact_name"",""c1"".""contact_email"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""c1"" ON ""c"".""customer_id""=""c1"".""user_id"") AS ""t"" GROUP BY ""t"".""customer_id"",""t"".""customer_name"") SELECT ""i"".""invoice_id"",""u"".""customer_name"",""i"".""price"",""u"".""contacts_cnt"",""u"".""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" JOIN ""u"" ON ""i"".""user_id""=""u"".""customer_id"" ORDER BY ""invoice_id"""
79,"WITH ""temp1"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"" FROM ""contacts"" GROUP BY 1), ""temp2"" AS (SELECT ""user_id"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY 1), ""temp3"" AS (SELECT ""t1"".""user_id"",COALESCE(""t1"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t2"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""temp1"" AS ""t1"" LEFT JOIN ""temp2"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""user_id"") SELECT ""invoice_id"",""c"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""temp3"" AS ""t"" ON ""i"".""user_id""=""t"".""user_id"") JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY 1"
80,"WITH ""shop_customers"" AS (SELECT DISTINCT ""x"".""contact_name"",""x"".""contact_email"" FROM ""Customers"" AS ""c"" JOIN ""Contacts"" AS ""x"" ON ""c"".""customer_name""=""x"".""contact_name"" AND ""c"".""email""=""x"".""contact_email"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""x"".""contact_name"") AS ""contacts_cnt"",COUNT(""s"".""contact_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""x"" ON ""c"".""customer_id""=""x"".""user_id"") LEFT JOIN ""shop_customers"" AS ""s"" ON ""x"".""contact_name""=""s"".""contact_name"" AND ""x"".""contact_email""=""s"".""contact_email"" GROUP BY 1,2,3 ORDER BY 1"
81,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""price"",COALESCE(""c3"".""cnt1"", 0) AS ""contacts_cnt"",COALESCE(""c3"".""cnt2"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN (SELECT ""c1"".""user_id"",""c1"".""cnt1"",""c2"".""cnt2"" FROM (SELECT ""user_id"",COUNT(""user_id"") AS ""cnt1"" FROM ""contacts"" GROUP BY ""user_id"") AS ""c1"" LEFT JOIN (SELECT ""user_id"",COUNT(""user_id"") AS ""cnt2"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""c2"" ON ""c1"".""user_id""=""c2"".""user_id"") AS ""c3"" ON ""i"".""user_id""=""c3"".""user_id"" ORDER BY ""invoice_id"""
82,"WITH ""cte1"" AS (SELECT ""customer_id"",COUNT(""user_id"") AS ""contacts_cnt"" FROM ""customers"" AS ""a"" JOIN ""contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY ""customer_id""), ""cte2"" AS (SELECT ""user_id"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""contact_name""=""b"".""customer_name"" GROUP BY ""user_id"") SELECT ""inv"".""invoice_id"",""cust"".""customer_name"",""inv"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""inv"" JOIN ""customers"" AS ""cust"" ON ""inv"".""user_id""=""cust"".""customer_id"") LEFT JOIN ""cte1"" ON ""cust"".""customer_id""=""cte1"".""customer_id"") LEFT JOIN ""cte2"" ON ""cte1"".""customer_id""=""cte2"".""user_id"" ORDER BY ""inv"".""invoice_id"""
83,"WITH ""contacts_by_user"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",COUNT(""cu"".""email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""c"" LEFT JOIN ""customers"" AS ""cu"" ON ""c"".""contact_email""=""cu"".""email"" GROUP BY 1) SELECT ""invoice_id"",""cu"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""contacts_by_user"" AS ""u"" ON ""u"".""user_id""=""i"".""user_id"" ORDER BY 1"
84,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""co"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
85,"WITH ""tmp"" AS (SELECT ""a"".""user_id"",COUNT(DISTINCT ""a"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""b"".""email"" IS NULL THEN 0 ELSE 1 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""contact_email""=""b"".""email"" GROUP BY ""a"".""user_id"") SELECT ""a"".""invoice_id"",""c"".""customer_name"",""a"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""a"" LEFT JOIN ""tmp"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"") JOIN ""Customers"" AS ""c"" ON ""a"".""user_id""=""c"".""customer_id"" ORDER BY ""invoice_id"""
86,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
87,"WITH ""contact_count"" AS (SELECT ""cu"".""customer_id"",COUNT(1) AS ""contacts_cnt"" FROM ""Customers"" AS ""cu"" JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" GROUP BY ""cu"".""customer_id""), ""trusted_contact"" AS (SELECT ""cu"".""customer_id"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""cu"" JOIN (SELECT * FROM ""Contacts"" WHERE ""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"")) AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" GROUP BY ""cu"".""customer_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""cc"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""tc"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contact_count"" AS ""cc"" ON ""i"".""user_id""=""cc"".""customer_id"") LEFT JOIN ""trusted_contact"" AS ""tc"" ON ""i"".""user_id""=""tc"".""customer_id"" ORDER BY ""i"".""invoice_id"""
88,"SELECT ""inv"".""invoice_id"" AS ""invoice_id"",""cus"".""customer_name"" AS ""customer_name"",""inv"".""price"" AS ""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""cus1"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""inv"" LEFT JOIN ""Customers"" AS ""cus"" ON ""inv"".""user_id""=""cus"".""customer_id"") LEFT JOIN ""Contacts"" AS ""con"" ON ""con"".""user_id""=""cus"".""customer_id"") LEFT JOIN ""Customers"" AS ""cus1"" ON ""cus1"".""customer_name""=""con"".""contact_name"" AND ""cus1"".""email""=""con"".""contact_email"" GROUP BY 1 ORDER BY 1"
89,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""CUSTOMERS"" AS ""C"" LEFT JOIN ""CONTACTS"" AS ""CO"" ON ""c"".""customer_id""=""co"".""user_id"") JOIN ""invoices"" AS ""i"" ON ""c"".""customer_id""=""i"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
90,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
91,"SELECT ""invoices"".""invoice_id"",""customers"".""customer_name"",""invoices"".""price"",COUNT(""trusted_contacts"".""user_id"") AS ""contacts_cnt"",SUM(COALESCE(""trusted_contacts"".""can_trust"", 0)) AS ""trusted_contacts_cnt"" FROM (""invoices"" JOIN ""customers"" ON ""invoices"".""user_id""=""customers"".""customer_id"") LEFT JOIN (SELECT ""user_id"",CASE WHEN ""customers"".""customer_id"" IS NOT NULL THEN 1 ELSE 0 END AS ""can_trust"" FROM ""contacts"" LEFT JOIN ""customers"" ON ""contacts"".""contact_name""=""customers"".""customer_name"" AND ""contacts"".""contact_email""=""customers"".""email"") AS ""trusted_contacts"" ON ""customers"".""customer_id""=""trusted_contacts"".""user_id"" GROUP BY ""invoices"".""invoice_id"",""invoices"".""user_id"" ORDER BY ""invoices"".""invoice_id"""
92,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""co"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Contacts"" AS ""co"" ON ""i"".""user_id""=""co"".""user_id"") LEFT JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"" GROUP BY ""invoice_id"" ORDER BY ""invoice_id"""
93,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""a"" ON ""a"".""user_id""=""c"".""customer_id"" ORDER BY ""invoice_id"""
94,"WITH ""cte"" AS (SELECT ""user_id"",1 AS ""contact_cnt"",CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END AS ""trusted_contacts_cnt"" FROM ""Contacts"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" LEFT JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN (SELECT ""user_id"",SUM(""contact_cnt"") AS ""contacts_cnt"",SUM(""trusted_contacts_cnt"") AS ""trusted_contacts_cnt"" FROM ""cte"" GROUP BY ""user_id"") AS ""t"" ON ""Invoices"".""user_id""=""t"".""user_id"" ORDER BY ""invoice_id"""
95,"WITH ""cte"" AS (SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""customer_id"" AS ""user_id"" FROM ""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id""), ""cte2"" AS (SELECT ""user_id"",COUNT(""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""cte2"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""cte2"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte"" LEFT JOIN ""cte2"" USING (""user_id"") ORDER BY ""invoice_id"""
96,"WITH ""temp1"" AS (SELECT *,(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts"" FROM ""Contacts""), ""temp2"" AS (SELECT * FROM ""Invoices"" LEFT JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id""), ""temp3"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(""trusted_contacts"") AS ""trusted_contacts_cnt"" FROM ""temp1"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""temp2"" LEFT JOIN ""temp3"" ON ""temp2"".""user_id""=""temp3"".""user_id"" ORDER BY ""invoice_id"""
97,"WITH ""temp"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""c1"" LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY ""c1"".""customer_id"") SELECT ""i"".""invoice_id"",""t"".""customer_name"",""i"".""price"",""t"".""contacts_cnt"",""t"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""temp"" AS ""t"" ON ""i"".""user_id""=""t"".""customer_id"" ORDER BY ""i"".""invoice_id"""
98,"WITH ""a"" AS (SELECT ""user_id"",COUNT(""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""co"" LEFT JOIN ""Customers"" AS ""cu"" ON ""co"".""contact_name""=""cu"".""customer_name"" AND ""co"".""contact_email""=""cu"".""email"" GROUP BY ""user_id""), ""b"" AS (SELECT ""user_id"",COUNT(""user_id"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""cu"".""customer_id""=""i"".""user_id"") LEFT JOIN ""a"" ON ""a"".""user_id""=""i"".""user_id"") LEFT JOIN ""b"" ON ""b"".""user_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
99,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
100,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COALESCE(""b"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""a"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""cu"".""customer_id""=""i"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""a"" ON ""i"".""user_id""=""a"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""b"" ON ""b"".""user_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
101,"SELECT ""i"".""invoice_id"",""t1"".""customer_name"",""i"".""price"",""t1"".""contacts_cnt"",""t1"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN (SELECT ""cu"".""customer_id"",""cu"".""customer_name"",COUNT(""co"".""contact_name"") AS ""contacts_cnt"",COUNT(CASE WHEN ""co"".""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE NULL END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""cu"" LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" GROUP BY ""cu"".""customer_id"",""cu"".""customer_name"") AS ""t1"" ON ""i"".""user_id""=""t1"".""customer_id"" ORDER BY ""i"".""invoice_id"""
102,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""c"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""cu"".""customer_id""=""c"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
103,"SELECT ""i"".""invoice_id"",MIN(""cu"".""customer_name"") AS ""customer_name"",MIN(""i"".""price"") AS ""price"",COUNT(""c"".""contact_name"") AS ""contacts_cnt"",COUNT(""cu2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id"") LEFT JOIN ""customers"" AS ""cu2"" ON ""c"".""contact_name""=""cu2"".""customer_name"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
104,"WITH ""cte1"" AS (SELECT ""customer_id"",COUNT(DISTINCT ""contact_name"") AS ""num1"" FROM ""Customers"" JOIN ""Contacts"" ON ""Contacts"".""user_id""=""Customers"".""customer_id"" GROUP BY ""customer_id""), ""cte2"" AS (SELECT ""customer_id"",COUNT(DISTINCT ""contact_name"") AS ""num2"" FROM ""Customers"" JOIN ""Contacts"" ON ""Contacts"".""user_id""=""Customers"".""customer_id"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""customer_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""cte1"".""num1"", 0) AS ""contacts_cnt"",COALESCE(""cte2"".""num2"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" LEFT JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN ""cte1"" ON ""Invoices"".""user_id""=""cte1"".""customer_id"") LEFT JOIN ""cte2"" ON ""Invoices"".""user_id""=""cte2"".""customer_id"" ORDER BY 1"
105,"WITH ""cte1"" AS (SELECT ""a"".*,""b"".* FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id""), ""customer_email"" AS (SELECT DISTINCT ""email"" FROM ""Customers""), ""cte3"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""customer_email"") THEN 1 ELSE 0 END) AS ""trusted"" FROM ""cte1"" GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted"" AS ""trusted_contacts_cnt"" FROM ""cte3"" AS ""c"" RIGHT JOIN ""Invoices"" AS ""i"" ON ""c"".""customer_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
106,"WITH ""cte"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""c1"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c2"" LEFT JOIN ""contacts"" AS ""c1"" ON ""c1"".""user_id""=""c2"".""customer_id"" GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" JOIN ""cte"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY 1"
107,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
108,"WITH ""t"" AS (SELECT ""customers"".""customer_id"",""customers"".""customer_name"",""customers"".""email"",COALESCE(COUNT(DISTINCT ""contacts"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(COUNT(DISTINCT ""trust"".""email""), 0) AS ""trusted_contacts_cnt"" FROM (""customers"" LEFT JOIN ""contacts"" ON ""customers"".""customer_id""=""contacts"".""user_id"") LEFT JOIN ""customers"" AS ""trust"" ON ""contacts"".""contact_name""=""trust"".""customer_name"" AND ""contacts"".""contact_email""=""trust"".""email"" GROUP BY 1,2,3) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""Invoices"" JOIN ""t"" ON ""Invoices"".""user_id""=""t"".""customer_id"" ORDER BY 1"
109,"WITH ""cte"" AS (SELECT ""con"".""user_id"",COUNT(""con"".""contact_name"") AS ""contacts_cnt"",COUNT(""cus"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""con"" LEFT JOIN ""Customers"" AS ""cus"" ON ""con"".""contact_name""=""cus"".""customer_name"" GROUP BY ""con"".""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""cte"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""cte"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""user_id"" ORDER BY ""invoice_id"""
110,"WITH ""t1"" AS (SELECT ""user_id"",COUNT(DISTINCT (""contact_email"")) AS ""contacts_cnt"" FROM ""contacts"" GROUP BY 1), ""t2"" AS (SELECT ""user_id"",COUNT(DISTINCT (""contact_email"")) AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""t1"" ON ""a"".""user_id""=""t1"".""user_id"") LEFT JOIN ""t2"" ON ""a"".""user_id""=""t2"".""user_id"" ORDER BY 1"
111,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""con"".""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""i"".""user_id""=""con"".""user_id"" GROUP BY 1,2,3 ORDER BY ""i"".""invoice_id"""
112,"WITH ""cte_join_contacts"" AS (SELECT ""invoice_id"",""cu"".""customer_name"",""price"",""contact_name"",""contact_email"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""i"".""user_id""=""cont"".""user_id""), ""cte_contacts_agg"" AS (SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""cte_join_contacts"" GROUP BY 1,2,3), ""cte_trusted_contacts_agg"" AS (SELECT ""invoice_id"",""c1"".""customer_name"",""price"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""cte_join_contacts"" AS ""c1"" JOIN ""Customers"" AS ""c2"" ON ""c1"".""contact_email""=""c2"".""email"" GROUP BY 1,2,3), ""cte_assemble"" AS (SELECT ""c"".""invoice_id"",""c"".""customer_name"",""c"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte_contacts_agg"" AS ""c"" LEFT JOIN ""cte_trusted_contacts_agg"" AS ""tc"" ON ""c"".""invoice_id""=""tc"".""invoice_id"" AND ""c"".""customer_name""=""tc"".""customer_name"" ORDER BY 1) SELECT * FROM ""cte_assemble"""
113,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(""c2"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c1"" ON ""c1"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""c2"" ON ""c2"".""user_id""=""i"".""user_id"" GROUP BY 1 ORDER BY 1"
114,"WITH ""related_customers_cte"" AS (SELECT ""user_id"" AS ""customer_id"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""contacts"" JOIN ""customers"" ON ""contacts"".""contact_email""=""customers"".""email"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contacts"".""user_id"") AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" JOIN ""customers"" ON ""invoices"".""user_id""=""customers"".""customer_id"") LEFT JOIN ""contacts"" USING (""user_id"")) LEFT JOIN ""related_customers_cte"" USING (""customer_id"") GROUP BY ""invoice_id"" ORDER BY ""invoice_id"""
115,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""cont"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""cont"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""cont"".""user_id""=""c"".""customer_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
116,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON (""c"".""customer_id""=""i"".""user_id"")) LEFT JOIN ""Contacts"" AS ""con"" ON (""con"".""user_id""=""c"".""customer_id"")) LEFT JOIN ""Customers"" AS ""c2"" ON (""c2"".""email""=""con"".""contact_email"") GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
117,"SELECT ""a"".""invoice_id"",""c"".""customer_name"",""a"".""price"",COUNT(""b"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""b"".""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" LEFT JOIN ""contacts"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"") LEFT JOIN ""customers"" AS ""c"" ON ""a"".""user_id""=""c"".""customer_id"" GROUP BY 1,2,3 ORDER BY 1"
118,"WITH ""tmp"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""customers"" LEFT JOIN ""contacts"" ON ""customer_id""=""user_id"" GROUP BY ""customer_id"",""customer_name"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""invoices"" JOIN ""tmp"" ON ""user_id""=""customer_id"" ORDER BY 1"
119,"SELECT ""i"".""invoice_id"",""a"".""customer_name"",""i"".""price"",COALESCE(COUNT(DISTINCT ""b"".""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""b"".""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""a"" ON ""i"".""user_id""=""a"".""customer_id"") LEFT JOIN ""contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY 1,2 ORDER BY 1"
120,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""co"".""user_id""=""c"".""customer_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
121,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(""c"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""d"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""c"" ON ""a"".""user_id""=""c"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""d"" ON ""a"".""user_id""=""d"".""user_id"" ORDER BY ""a"".""invoice_id"""
122,"WITH ""x"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY 1), ""y"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",CASE WHEN ""contacts_cnt"" IS NULL THEN 0 ELSE ""contacts_cnt"" END AS ""contacts_cnt"",CASE WHEN ""trusted_contacts_cnt"" IS NULL THEN 0 ELSE ""trusted_contacts_cnt"" END AS ""trusted_contacts_cnt"" FROM ((""invoices"" LEFT JOIN ""customers"" ON ""invoices"".""user_id""=""customers"".""customer_id"") LEFT JOIN ""x"" ON ""invoices"".""user_id""=""x"".""user_id"") LEFT JOIN ""y"" ON ""invoices"".""user_id""=""y"".""user_id"" ORDER BY 1"
123,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""user_id"") LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""invoice_id"""
124,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
125,"SELECT ""i"".""invoice_id"",MAX(""c"".""customer_name"") AS ""customer_name"",MAX(""i"".""price"") AS ""price"",COUNT(DISTINCT ""d"".""contact_name"") AS ""contacts_cnt"",COALESCE(COUNT(CASE WHEN ""d"".""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN ""c"".""customer_name"" END), 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""d"" ON ""c"".""customer_id""=""d"".""user_id"" GROUP BY 1 ORDER BY 1"
126,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""co"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"" GROUP BY ""c"".""customer_id"",""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
127,"WITH ""trusted"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""trust"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id""), ""contact"" AS (SELECT DISTINCT ""c"".""user_id"",COUNT(DISTINCT ""c"".""contact_name"") AS ""contacts_cnt"",""cus"".""customer_name"" FROM ""contacts"" AS ""c"" RIGHT JOIN ""customers"" AS ""cus"" ON ""c"".""user_id""=""cus"".""customer_id"" GROUP BY ""c"".""user_id"") SELECT ""invoice_id"",""customers"".""customer_name"",""price"",COALESCE(""contact"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trust"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""inv"" LEFT JOIN ""contact"" ON ""inv"".""user_id""=""contact"".""user_id"") LEFT JOIN ""trusted"" ON ""inv"".""user_id""=""trusted"".""user_id"") LEFT JOIN ""customers"" ON ""inv"".""user_id""=""customers"".""customer_id"" ORDER BY ""invoice_id"""
128,"WITH ""contacts_new"" AS (SELECT *,CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END AS ""trusted"" FROM ""Contacts""), ""contact_agg"" AS (SELECT ""U"".""customer_name"",COUNT(""C"".""contact_email"") AS ""contacts_cnt"",SUM(""C"".""trusted"") AS ""trusted_contacts_cnt"" FROM ""contacts_new"" AS ""C"" LEFT JOIN ""Customers"" AS ""U"" ON ""C"".""user_id""=""U"".""customer_id"" GROUP BY ""U"".""customer_name"") SELECT ""I"".""invoice_id"",""U"".""customer_name"",""I"".""price"",COALESCE(""C"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""C"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""I"" LEFT JOIN ""Customers"" AS ""U"" ON ""I"".""user_id""=""U"".""customer_id"") LEFT JOIN ""contact_agg"" AS ""C"" ON ""C"".""customer_name""=""U"".""customer_name"" ORDER BY 1"
129,"SELECT ""c"".""invoice_id"",""a"".""customer_name"",""c"".""price"",COUNT(""b"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"") JOIN ""Invoices"" AS ""c"" ON ""c"".""user_id""=""a"".""customer_id"" GROUP BY 1 ORDER BY 1"
130,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN (SELECT ""user_id"" AS ""ci"",COUNT(DISTINCT ""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY ""ci"") AS ""t"" ON ""Invoices"".""user_id""=""t"".""ci"" ORDER BY ""invoice_id"""
131,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(""m"".""contact_email"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""m"" ON ""c1"".""customer_id""=""m"".""user_id"") LEFT JOIN ""Customers"" AS ""c2"" ON ""m"".""contact_name""=""c2"".""customer_name"" AND ""m"".""contact_email""=""c2"".""email"" GROUP BY ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
132,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(""cont"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""c1"".""customer_id""=""cont"".""user_id"") LEFT JOIN ""Customers"" AS ""c2"" ON ""cont"".""contact_email""=""c2"".""email"" GROUP BY ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
133,"SELECT ""i"".""invoice_id"",""cm"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""ct"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cm"" ON ""i"".""user_id""=""cm"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""i"".""user_id""=""ct"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY 1"
134,"SELECT ""I"".""invoice_id"",""Cu"".""customer_name"",""I"".""price"",COUNT(""Co"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""Co"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""I"" LEFT JOIN ""Customers"" AS ""Cu"" ON ""I"".""user_id""=""Cu"".""customer_Id"") LEFT JOIN ""Contacts"" AS ""Co"" ON ""Cu"".""customer_id""=""Co"".""user_id"" GROUP BY ""I"".""invoice_id"",""Cu"".""customer_name"",""Co"".""user_id"" ORDER BY ""I"".""invoice_id"""
135,"WITH ""contacts_cnt"" AS (SELECT DISTINCT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id""), ""trusted_contacts_cnt"" AS (SELECT DISTINCT ""co"".""user_id"",COUNT(""cu"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""co"" JOIN ""customers"" AS ""cu"" ON ""co"".""contact_name""=""cu"".""customer_name"" GROUP BY ""co"".""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""co"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts_cnt"" AS ""co"" ON ""i"".""user_id""=""co"".""user_id"") LEFT JOIN ""trusted_contacts_cnt"" AS ""t"" ON ""i"".""user_id""=""t"".""user_id"" ORDER BY ""i"".""invoice_id"""
136,"WITH ""cte"" AS (SELECT ""i"".""invoice_id"",""c"".""customer_name"",""user_id"",""i"".""price"" FROM ""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id""), ""cte2"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""c"" LEFT JOIN ""Customers"" AS ""cu"" ON ""c"".""contact_name""=""cu"".""customer_name"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte"" LEFT JOIN ""cte2"" USING (""user_id"") ORDER BY ""invoice_id"""
137,"WITH ""info"" AS (SELECT ""c"".""customer_id"",""c"".""customer_name"",SUM(CASE WHEN ""con"".""contact_email"" IS NOT NULL THEN 1 ELSE 0 END) AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""customer_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""c"" LEFT JOIN ""Contacts"" AS ""con"" ON ""c"".""customer_id""=""con"".""user_id"") LEFT JOIN ""Customers"" AS ""c2"" ON ""con"".""contact_email""=""c2"".""email"" GROUP BY 1) SELECT ""i"".""invoice_id"",""b"".""customer_name"",""i"".""price"",""b"".""contacts_cnt"",""b"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""info"" AS ""b"" ON ""i"".""user_id""=""b"".""customer_id"" ORDER BY 1"
138,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""c"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""cu"".""customer_id""=""c"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
139,"SELECT ""T"".""INVOICE_ID"",""T"".""CUSTOMER_NAME"",""T"".""PRICE"",COUNT(""CO"".""CONTACT_EMAIL"") AS ""CONTACTS_CNT"",COUNT(""C2"".""CUSTOMER_ID"") AS ""TRUSTED_CONTACTS_CNT"" FROM ((SELECT ""I"".""INVOICE_ID"",""C"".""CUSTOMER_NAME"",""C"".""CUSTOMER_ID"",""I"".""PRICE"" FROM (""INVOICES"" AS ""I"") JOIN ""CUSTOMERS"" AS ""C"" WHERE ""I"".""USER_ID""=""C"".""CUSTOMER_ID"") AS ""T"" LEFT JOIN ""CONTACTS"" AS ""CO"" ON ""T"".""CUSTOMER_ID""=""CO"".""USER_ID"") LEFT JOIN ""CUSTOMERS"" AS ""C2"" ON ""CO"".""CONTACT_EMAIL""=""C2"".""EMAIL"" GROUP BY ""T"".""INVOICE_ID"",""T"".""CUSTOMER_NAME"",""T"".""PRICE"" ORDER BY 1"
140,"WITH ""u"" AS (SELECT ""t"".""customer_id"",""t"".""customer_name"",COUNT(""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""t"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (SELECT ""c"".""customer_id"",""c"".""customer_name"",""c"".""email"",""c1"".""contact_name"",""c1"".""contact_email"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""c1"" ON ""c"".""customer_id""=""c1"".""user_id"") AS ""t"" GROUP BY ""t"".""customer_id"",""t"".""customer_name"") SELECT ""i"".""invoice_id"",""u"".""customer_name"",""i"".""price"",""u"".""contacts_cnt"",""u"".""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" JOIN ""u"" ON ""i"".""user_id""=""u"".""customer_id"" ORDER BY ""invoice_id"""
141,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""co"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""i"".""user_id""=""co"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY 1"
142,"WITH ""temp"" AS (SELECT ""customer_id"",""customer_name"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""c2"" ON ""c"".""customer_id""=""c2"".""user_id"" GROUP BY ""customer_id"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""temp"" JOIN ""invoices"" AS ""i"" ON ""temp"".""customer_id""=""i"".""user_id"" ORDER BY 1"
143,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",SUM(""i"".""price"") AS ""price"",COALESCE(""fcnt"", 0) AS ""contacts_cnt"",COALESCE(""cfcnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""customers"" AS ""c"" JOIN ""invoices"" AS ""i"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""fcnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""co"" ON ""i"".""user_id""=""co"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""cfcnt"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY ""user_id"") AS ""sq"" ON ""sq"".""user_id""=""i"".""user_id"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"" ORDER BY ""i"".""invoice_id"""
144,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"",COALESCE(SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END), 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""co"" USING (""user_id"") GROUP BY 1,2,3 ORDER BY 1"
145,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(COUNT(""c"".""contact_email""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""a"".""user_id""=""c"".""user_id"" GROUP BY ""a"".""invoice_id"" ORDER BY ""a"".""invoice_id"""
146,"SELECT ""invoice_id"",""c"".""customer_name"",""price"",COUNT(""o"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""o"" ON ""c"".""customer_id""=""o"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
147,"WITH ""cte_join_contacts"" AS (SELECT ""invoice_id"",""cu"".""customer_name"",""price"",""contact_name"",""contact_email"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""i"".""user_id""=""cont"".""user_id""), ""cte_contacts_agg"" AS (SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""cte_join_contacts"" GROUP BY 1,2,3), ""cte_trusted_contacts_agg"" AS (SELECT ""invoice_id"",""c1"".""customer_name"",""price"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""cte_join_contacts"" AS ""c1"" JOIN ""Customers"" AS ""c2"" ON ""c1"".""contact_email""=""c2"".""email"" GROUP BY 1,2,3), ""cte_assemble"" AS (SELECT ""c"".""invoice_id"",""c"".""customer_name"",""c"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte_contacts_agg"" AS ""c"" LEFT JOIN ""cte_trusted_contacts_agg"" AS ""tc"" ON ""c"".""invoice_id""=""tc"".""invoice_id"" AND ""c"".""customer_name""=""tc"".""customer_name"" ORDER BY 1) SELECT * FROM ""cte_assemble"""
148,"WITH ""temp"" AS (SELECT ""c"".""customer_name"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" ON ""c"".""customer_id""=""contacts"".""user_id"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""c"".""customer_id""), ""temp2"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"" FROM ""customers"" AS ""c"" JOIN ""contacts"" ON ""c"".""customer_id""=""contacts"".""user_id"" GROUP BY ""user_id"") SELECT DISTINCT ""invoice_id"",""c"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" ON ""contacts"".""user_id""=""c"".""customer_id"") LEFT JOIN ""temp"" ON ""c"".""customer_name""=""temp"".""customer_name"") LEFT JOIN ""temp2"" ON ""c"".""customer_id""=""temp2"".""user_id"" ORDER BY ""invoice_id"""
149,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_name"") AS ""contacts_cnt"",COALESCE(""tco"".""trusted_count"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_count"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""tco"" ON ""tco"".""user_id""=""cu"".""customer_id"" GROUP BY 1,2,3 ORDER BY ""i"".""invoice_id"""
150,"SELECT ""invoice_id"",""Customers"".""customer_name"",""price"",COALESCE(COUNT(""contact_email""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""customer_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"") LEFT JOIN ""Customers"" AS ""c"" ON ""Contacts"".""contact_email""=""c"".""email"" GROUP BY ""invoice_id"",""Customers"".""customer_id"" ORDER BY 1"
151,"WITH ""cte_join_contacts"" AS (SELECT ""invoice_id"",""cu"".""customer_name"",""price"",""contact_name"",""contact_email"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""i"".""user_id""=""cont"".""user_id""), ""cte_contacts_agg"" AS (SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""cte_join_contacts"" GROUP BY 1,2,3), ""cte_trusted_contacts_agg"" AS (SELECT ""invoice_id"",""c1"".""customer_name"",""price"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""cte_join_contacts"" AS ""c1"" JOIN ""Customers"" AS ""c2"" ON ""c1"".""contact_email""=""c2"".""email"" GROUP BY 1,2,3), ""cte_assemble"" AS (SELECT ""c"".""invoice_id"",""c"".""customer_name"",""c"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte_contacts_agg"" AS ""c"" LEFT JOIN ""cte_trusted_contacts_agg"" AS ""tc"" ON ""c"".""invoice_id""=""tc"".""invoice_id"" AND ""c"".""customer_name""=""tc"".""customer_name"" ORDER BY 1) SELECT * FROM ""cte_assemble"""
152,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""i"".""user_id""=""con"".""user_id"" GROUP BY ""invoice_id"",""customer_name"",""price"" ORDER BY ""invoice_id"""
153,"SELECT ""T2"".""invoice_id"",""T2"".""customer_name"",""T2"".""price"",COALESCE(COUNT(""T2"".""user_id""), 0) AS ""contacts_cnt"",COALESCE(SUM(""T2"".""trusted""), 0) AS ""trusted_contacts_cnt"" FROM (SELECT ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"",""T1"".""trusted"",""T1"".""user_id"" FROM (""Invoices"" AS ""I"" LEFT JOIN ""Customers"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"") LEFT JOIN (SELECT ""user_id"",""contact_name"",CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END AS ""trusted"" FROM ""Contacts"") AS ""T1"" ON ""C"".""customer_id""=""T1"".""user_id"") AS ""T2"" GROUP BY ""T2"".""invoice_id"",""T2"".""customer_name"",""T2"".""price"" ORDER BY ""T2"".""invoice_id"""
154,"WITH ""cte"" AS (SELECT ""c"".""user_id"",COUNT(DISTINCT ""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""c1"".""email"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""c"" LEFT JOIN ""customers"" AS ""c1"" ON ""c"".""contact_email""=""c1"".""email"" GROUP BY ""c"".""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""c1"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""c1"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""cte"" AS ""c1"" ON ""c1"".""user_id""=""i"".""user_id"" ORDER BY ""i"".""invoice_id"""
155,"SELECT ""I"".""invoice_id"",""M"".""customer_name"",""I"".""price"",COALESCE(""T1"".""ct1"", 0) AS ""contacts_cnt"",COALESCE(""T2"".""ct2"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I"" LEFT JOIN ""Customers"" AS ""M"" ON ""I"".""user_id""=""M"".""customer_id"") LEFT JOIN (SELECT ""user_id"",""contact_email"",COUNT(1) AS ""ct1"" FROM ""Contacts"" GROUP BY 1) AS ""T1"" ON ""I"".""user_id""=""T1"".""user_id"") LEFT JOIN (SELECT ""ct"".""user_id"",COUNT(""ct"".""user_id"") AS ""ct2"" FROM (""Customers"" AS ""cm"") JOIN ""Contacts"" AS ""ct"" WHERE ""ct"".""contact_email""=""cm"".""email"" GROUP BY 1) AS ""T2"" ON ""I"".""user_id""=""T2"".""user_id"" ORDER BY 1"
156,"WITH ""contactCnt"" AS (SELECT ""cust"".""customer_id"" AS ""customer_id"",COALESCE(COUNT(""contact"".""contact_email""), 0) AS ""contacts_cnt"" FROM ""Customers"" AS ""cust"" LEFT JOIN ""Contacts"" AS ""contact"" ON ""cust"".""customer_id""=""contact"".""user_id"" GROUP BY ""customer_id""), ""trustContactCnt"" AS (SELECT ""cust"".""customer_id"" AS ""customer_id"",COALESCE(COUNT(""contact"".""contact_email""), 0) AS ""contacts_cnt"" FROM ""Customers"" AS ""cust"" LEFT JOIN ""Contacts"" AS ""contact"" ON ""cust"".""customer_id""=""contact"".""user_id"" AND ""contact"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") GROUP BY ""customer_id"") SELECT ""invo"".""invoice_id"" AS ""invoice_id"",""cust"".""customer_name"" AS ""customer_name"",COALESCE(SUM(""invo"".""price""), 0) AS ""price"",SUM(""contactcnt"".""contacts_cnt"") AS ""contacts_cnt"",SUM(""trustcontactcnt"".""contacts_cnt"") AS ""trusted_contacts_cnt"" FROM ((""Customers"" AS ""cust"" JOIN ""Invoices"" AS ""invo"" ON ""invo"".""user_id""=""cust"".""customer_id"") JOIN ""contactCnt"" AS ""contactcnt"" ON ""contactcnt"".""customer_id""=""cust"".""customer_id"") JOIN ""trustContactCnt"" AS ""trustcontactcnt"" ON ""trustcontactcnt"".""customer_id""=""cust"".""customer_id"" GROUP BY ""cust"".""customer_id"",""invoice_id"" ORDER BY ""invoice_id"""
157,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(COUNT(""c"".""contact_email""), 0) AS ""contacts_cnt"",COALESCE(""d"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""a"".""user_id""=""c"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY ""user_id"") AS ""d"" ON ""a"".""user_id""=""d"".""user_id"" GROUP BY ""a"".""invoice_id"" ORDER BY ""a"".""invoice_id"""
158,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""list"".""c_email"") AS ""contacts_cnt"",COUNT(""list"".""trusted_email"") AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN (SELECT ""co"".""user_id"" AS ""contact_id"",""co"".""contact_email"" AS ""c_email"",""cu"".""email"" AS ""trusted_email"" FROM ""contacts"" AS ""co"" LEFT JOIN ""customers"" AS ""cu"" ON ""cu"".""email""=""co"".""contact_email"") AS ""list"" ON ""i"".""user_id""=""list"".""contact_id"") LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
159,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""co"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(COUNT(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE NULL END), 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""co"".""user_id""=""i"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
160,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(DISTINCT (""co"".""contact_name"")) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT (""customer_name"") FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""co"".""user_id""=""c"".""customer_id"" GROUP BY ""invoice_id"",""customer_name"",""price"" ORDER BY ""invoice_id"""
161,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
162,"SELECT ""invoice_id"",""c"".""customer_name"",""price"",COUNT(""o"".""contact_name"") AS ""contacts_cnt"",COUNT(""a"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""o"" ON ""c"".""customer_id""=""o"".""user_id"") LEFT JOIN ""customers"" AS ""a"" ON ""a"".""email""=""o"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
163,"WITH ""cte"" AS (SELECT ""invoice_id"",""customer_name"",""customer_id"",""price"",""contact_email"" FROM (""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"") SELECT ""a"".""invoice_id"",""a"".""customer_name"",""a"".""price"",COALESCE(COUNT(""contact_email""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""b"".""customer_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""cte"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""contact_email""=""b"".""email"" GROUP BY 1,""a"".""customer_id"" ORDER BY 1"
164,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"""
165,"SELECT ""invoice_id"",""c"".""customer_name"",""price"",COALESCE(COUNT(DISTINCT ""co"".""contact_email""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""c"" LEFT JOIN ""Contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"") JOIN ""Invoices"" AS ""i"" ON ""c"".""customer_id""=""i"".""user_id"" GROUP BY 1,2 ORDER BY 1,2"
166,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cus"" ON ""i"".""user_id""=""cus"".""customer_id"") LEFT JOIN ""Contacts"" AS ""con"" ON ""cus"".""customer_id""=""con"".""user_id"" GROUP BY ""invoice_id"""
167,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""ct"".""user_id"") AS ""contacts_cnt"",COUNT(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE NULL END) AS ""trusted_contacts_cnt"" FROM (""customers"" AS ""C"" LEFT JOIN ""Contacts"" AS ""ct"" ON ""C"".""customer_id""=""ct"".""user_id"") JOIN ""Invoices"" AS ""I"" ON ""C"".""customer_id""=""I"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""invoice_id"""
168,"SELECT ""i1"".""invoice_id"",""c1"".""customer_name"" AS ""customer_name"",""i1"".""price"",CASE WHEN ""b"".""contacts_cnt"" IS NULL THEN 0 ELSE ""b"".""contacts_cnt"" END AS ""contacts_cnt"",CASE WHEN ""b"".""trusted_contacts_cnt"" IS NULL THEN 0 ELSE ""b"".""trusted_contacts_cnt"" END AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i1"" LEFT JOIN ""Customers"" AS ""c1"" ON ""i1"".""user_id""=""c1"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(CASE WHEN ""customer_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (SELECT ""c2"".""user_id"",""c3"".""customer_id"" FROM ""Contacts"" AS ""c2"" LEFT JOIN ""Customers"" AS ""c3"" ON ""c2"".""contact_name""=""c3"".""customer_name"" AND ""c2"".""contact_email""=""c3"".""email"") AS ""a"" GROUP BY ""user_id"") AS ""b"" ON ""i1"".""user_id""=""b"".""user_id"" ORDER BY ""i1"".""invoice_id"""
169,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""ct"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""cc"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""ct"" ON ""ct"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""cc"" ON ""cc"".""email""=""ct"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
170,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY 1) AS ""T1"" USING (""user_id"")) LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""customers"") GROUP BY 1) AS ""T2"" USING (""user_id"")) JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
171,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""contacts_cnt"",""c"".""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" LEFT JOIN (SELECT ""c"".""customer_id"",""c"".""customer_name"",COALESCE(COUNT(""t"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(SUM(CASE WHEN ""t"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END), 0) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""t"" ON ""t"".""user_id""=""c"".""customer_id"" GROUP BY ""c"".""customer_id"") AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""i"".""invoice_id"""
172,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"" ORDER BY ""i"".""invoice_id"""
173,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""agg"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""agg"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN (SELECT ""ct"".""user_id"",COUNT(DISTINCT ""contact_email"") AS ""contacts_cnt"",COALESCE(COUNT(DISTINCT ""cu"".""customer_id""), 0) AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""ct"" LEFT JOIN ""customers"" AS ""cu"" ON ""ct"".""contact_email""=""cu"".""email"" GROUP BY ""ct"".""user_id"") AS ""agg"" ON ""i"".""user_id""=""agg"".""user_id"") LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""invoice_id"""
174,"SELECT ""I"".""invoice_id"",""C1"".""customer_name"",""I"".""price"",COUNT(""C2"".""contact_email"") AS ""contacts_cnt"",COUNT(""C3"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I"" LEFT JOIN ""Customers"" AS ""C1"" ON ""I"".""user_id""=""C1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""C2"" ON ""C2"".""user_id""=""C1"".""customer_id"") LEFT JOIN ""Customers"" AS ""C3"" ON ""C3"".""customer_name""=""C2"".""contact_name"" GROUP BY ""I"".""invoice_id"" ORDER BY ""I"".""invoice_id"""
175,"SELECT ""i"".""invoice_id"",""cm"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""ct"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cm"" ON ""i"".""user_id""=""cm"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""i"".""user_id""=""ct"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY 1"
176,"WITH ""t1"" AS (SELECT ""c1"".""customer_id"",""c1"".""customer_name"",COUNT(""c2"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""c1"".""email"" FROM ""Customers"" AS ""c1"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""c1"" LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY 1) SELECT ""i"".""invoice_id"",""t1"".""customer_name"",""i"".""price"",""t1"".""contacts_cnt"",""t1"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""t1"" ON ""i"".""user_id""=""t1"".""customer_id"" ORDER BY 1"
177,"WITH ""contact_stats"" AS (SELECT ""x"".""user_id"",COUNT(DISTINCT ""x"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""b"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""x"" LEFT JOIN ""Customers"" AS ""b"" ON ""x"".""contact_name""=""b"".""customer_name"" GROUP BY 1) SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(""c"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""c"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""a"" JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contact_stats"" AS ""c"" ON ""a"".""user_id""=""c"".""user_id"" ORDER BY 1"
178,"WITH ""customer_contact"" AS (SELECT ""c"".""customer_id"",""c"".""customer_name"",COALESCE(COUNT(""t"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(SUM(""t"".""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"")), 0) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""c"".""customer_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""contacts_cnt"",""c"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" LEFT JOIN ""customer_contact"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""i"".""invoice_id"""
179,"WITH ""cte"" AS (SELECT ""user_id"",""customer_name"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"",SUM(""trusted_contact"") AS ""trusted_contacts_cnt"" FROM (SELECT ""user_id"",""c2"".""customer_name"",""contact_name"",CASE WHEN ""c3"".""email"" IS NULL THEN 0 ELSE 1 END AS ""trusted_contact"" FROM (""contacts"" AS ""c1"" JOIN ""customers"" AS ""c2"" ON ""c1"".""user_id""=""c2"".""customer_id"") LEFT JOIN ""customers"" AS ""c3"" ON ""c1"".""contact_email""=""c3"".""email"") AS ""sub"" GROUP BY ""user_id"",""customer_name"") SELECT ""invoice_id"",""c"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""user_id"" ORDER BY 1"
180,"SELECT ""Inv"".""invoice_id"",""c"".""customer_name"",""Inv"".""price"",COALESCE(""ct"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""tct"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""Inv"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""ct"" ON ""Inv"".""user_id""=""ct"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""tct"" ON ""Inv"".""user_id""=""tct"".""user_id"") LEFT JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""Inv"".""user_id"" ORDER BY ""Inv"".""Invoice_id"""
181,"SELECT ""invoice_id"",""C1"".""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""I1"" JOIN ""Customers"" AS ""C1"" ON ""I1"".""user_id""=""C1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""Con1"" ON ""C1"".""customer_id""=""Con1"".""user_id"" GROUP BY ""invoice_id"",""C1"".""customer_name"",""price"" ORDER BY ""invoice_id"""
182,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COUNT(""c"".""contact_name"") AS ""contacts_cnt"",COUNT(""d"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""a"" JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"") LEFT JOIN ""Customers"" AS ""d"" ON ""c"".""contact_name""=""d"".""customer_name"" AND ""c"".""contact_email""=""d"".""email"" GROUP BY 1,2,3 ORDER BY 1"
183,"SELECT ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"",SUM(CASE WHEN ""CT"".""contact_name"" IS NOT NULL THEN 1 ELSE 0 END) AS ""contacts_cnt"",SUM(CASE WHEN ""CT"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""C"" LEFT JOIN ""Contacts"" AS ""CT"" ON ""C"".""customer_id""=""CT"".""user_id"") JOIN ""Invoices"" AS ""I"" ON ""C"".""customer_id""=""I"".""user_id"" GROUP BY ""I"".""invoice_id"",""C"".""customer_name"" ORDER BY ""I"".""invoice_id"""
184,"WITH ""trusted_contacts"" AS (SELECT ""t1"".""customer_id"",COUNT(""t2"".""user_id"") AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""t1"" LEFT JOIN (SELECT ""user_id"",""contact_name"",""contact_email"" FROM ""contacts"" WHERE ROW(""contact_name"",""contact_email"") IN (SELECT ""customer_name"",""email"" FROM ""customers"")) AS ""t2"" ON ""t1"".""customer_id""=""t2"".""user_id"" GROUP BY ""t1"".""customer_id""), ""customer_contacts"" AS (SELECT ""t1"".""customer_id"",""t1"".""customer_name"",COUNT(""t2"".""user_id"") AS ""contacts_cnt"" FROM ""customers"" AS ""t1"" LEFT JOIN ""contacts"" AS ""t2"" ON ""t1"".""customer_id""=""t2"".""user_id"" GROUP BY ""t1"".""customer_id"") SELECT ""t1"".""invoice_id"",""t2"".""customer_name"",""t1"".""price"",""t2"".""contacts_cnt"",""t3"".""trusted_contacts_cnt"" FROM (""invoices"" AS ""t1"" LEFT JOIN ""customer_contacts"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""customer_id"") LEFT JOIN ""trusted_contacts"" AS ""t3"" ON ""t1"".""user_id""=""t3"".""customer_id"" ORDER BY 1"
185,"WITH ""contacts_by_user"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",COUNT(""cu"".""email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""c"" LEFT JOIN ""customers"" AS ""cu"" ON ""c"".""contact_email""=""cu"".""email"" GROUP BY 1) SELECT ""invoice_id"",""cu"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""contacts_by_user"" AS ""u"" ON ""u"".""user_id""=""i"".""user_id"" ORDER BY 1"
186,"SELECT ""i"".""invoice_id"",""a"".""customer_name"",""i"".""price"",""a"".""contacts_cnt"",""a"".""trusted_contacts_cnt"" FROM (SELECT ""c1"".""customer_id"",""c1"".""customer_name"",SUM(CASE WHEN ""c2"".""contact_email"" IS NULL THEN 0 ELSE 1 END) AS ""contacts_cnt"",COALESCE(SUM(""trusted_contacts""), 0) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""c1"" LEFT JOIN (SELECT *,CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END AS ""trusted_contacts"" FROM ""Contacts"") AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY 1,2) AS ""a"" JOIN ""Invoices"" AS ""i"" ON ""i"".""user_id""=""a"".""customer_id"" ORDER BY 1"
187,"WITH ""cte"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""c"" LEFT JOIN ""Contacts"" AS ""c2"" ON ""c"".""customer_id""=""c2"".""user_id"" GROUP BY ""customer_id"") SELECT ""i"".""invoice_id"",""cte"".""customer_name"",""i"".""price"",""cte"".""contacts_cnt"",""cte"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" LEFT JOIN ""cte"" ON ""cte"".""customer_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
188,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"""
189,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""Contacts"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""Contacts"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"" GROUP BY ""Invoices"".""invoice_id"",""customer_name"" ORDER BY ""Invoices"".""invoice_id"""
190,"SELECT ""A"".""invoice_id"",""A"".""customer_name"",""A"".""price"",""A"".""contacts_cnt"",COALESCE(""B"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (SELECT ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"",COUNT(""Co"".""contact_name"") AS ""contacts_cnt"" FROM (""Invoices"" AS ""I"" LEFT JOIN ""Customers"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"") LEFT JOIN ""Contacts"" AS ""Co"" ON ""I"".""user_id""=""Co"".""user_id"" GROUP BY ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"") AS ""A"" LEFT JOIN (SELECT ""I"".""invoice_id"",COUNT(""C"".""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Invoices"" AS ""I"" LEFT JOIN ""Contacts"" AS ""C"" ON ""I"".""user_id""=""C"".""user_id"" WHERE ""C"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""I"".""invoice_id"") AS ""B"" ON ""A"".""invoice_id""=""B"".""invoice_id"" ORDER BY ""A"".""invoice_id"""
191,"WITH ""temp"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""co"" LEFT JOIN ""Customers"" AS ""cu"" ON ""co"".""contact_name""=""cu"".""customer_name"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""temp"" AS ""t"" ON ""i"".""user_id""=""t"".""user_id"") JOIN ""customers"" AS ""cu"" ON ""cu"".""customer_id""=""i"".""user_id"" ORDER BY 1"
192,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COALESCE(COUNT(""c2"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE((SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END)), 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
193,"WITH ""cte_assemble"" AS (SELECT ""invoice_id"",""cu"".""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""i"".""user_id""=""cont"".""user_id"" GROUP BY 1,2,3 ORDER BY 1) SELECT * FROM ""cte_assemble"""
194,"WITH ""cte"" AS (SELECT ""invoice_id"",""customer_name"",""customer_id"",""price"",""contact_email"" FROM (""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"") SELECT ""a"".""invoice_id"",""a"".""customer_name"",""a"".""price"",COALESCE(COUNT(""contact_email""), 0) AS ""contacts_cnt"",COUNT(""b"".""customer_id"") AS ""trusted_contacts_cnt"" FROM ""cte"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""contact_email""=""b"".""email"" GROUP BY 1,""a"".""customer_id"" ORDER BY 1"
195,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",MIN(""price"") AS ""price"",COUNT(""c"".""user_id"") AS ""contacts_cnt"",COUNT(""d"".""customer_id"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"") LEFT JOIN ""customers"" AS ""d"" ON ""c"".""contact_name""=""d"".""customer_name"" GROUP BY ""a"".""invoice_id"",""b"".""customer_name"" ORDER BY 1"
196,"WITH ""contact_stats"" AS (SELECT ""x"".""user_id"",COUNT(DISTINCT ""x"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""b"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""x"" LEFT JOIN ""Customers"" AS ""b"" ON ""x"".""contact_name""=""b"".""customer_name"" GROUP BY 1) SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(""c"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""c"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""a"" JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contact_stats"" AS ""c"" ON ""a"".""user_id""=""c"".""user_id"" ORDER BY 1"
197,"SELECT ""i"".""invoice_id"",""con"".""customer_name"",""i"".""price"",""con"".""contacts_cnt"",""con"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN (SELECT ""c"".""customer_id"",""c"".""customer_name"",COUNT(""b"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""b"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""b"" ON ""c"".""customer_id""=""b"".""user_id"" GROUP BY ""c"".""customer_id"") AS ""con"" ON ""i"".""user_id""=""con"".""customer_id"" ORDER BY ""i"".""invoice_id"""
198,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""cn"".""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""cn"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""cn"" ON ""c"".""customer_id""=""cn"".""user_id"" GROUP BY 1 ORDER BY 1"
199,"WITH ""t"" AS (SELECT ""c"".""user_id"",COUNT(1) AS ""contacts_cnt"",COUNT(""cm"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""c"" LEFT JOIN ""Customers"" AS ""cm"" ON ""c"".""contact_name""=""cm"".""customer_name"" AND ""c"".""contact_email""=""cm"".""email"" GROUP BY ""c"".""user_id"") SELECT ""invoice_id"",""c"".""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""t"" ON ""i"".""user_id""=""t"".""user_id"") JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
200,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""customers"" AS ""c2"" LEFT JOIN ""contacts"" AS ""c1"" ON ""c1"".""user_id""=""c2"".""customer_id"") JOIN ""invoices"" AS ""i"" ON ""i"".""user_id""=""c2"".""customer_id"" GROUP BY ""invoice_id"" ORDER BY ""invoice_id"""
201,"SELECT ""c"".""invoice_id"",""a"".""customer_name"",""c"".""price"",COUNT(""b"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""d"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""c"" LEFT JOIN ""Customers"" AS ""a"" ON ""a"".""customer_id""=""c"".""user_id"") LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"") LEFT JOIN ""Customers"" AS ""d"" ON ""b"".""contact_name""=""d"".""customer_name"" GROUP BY ""c"".""invoice_id"""
202,"WITH ""C"" AS (SELECT ""user_id"",COUNT(1) AS ""cnt"" FROM ""Contacts"" GROUP BY 1), ""D"" AS (SELECT ""user_id"",COUNT(1) AS ""cnt"" FROM ""Contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""C"".""cnt"", 0) AS ""contacts_cnt"",COALESCE(""D"".""cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""A"" LEFT JOIN ""Customers"" AS ""B"" ON ""A"".""user_id""=""B"".""customer_id"") LEFT JOIN ""C"" ON ""B"".""customer_id""=""C"".""user_id"") LEFT JOIN ""D"" ON ""B"".""customer_id""=""D"".""user_id"" ORDER BY 1"
203,"WITH ""summary"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""customer_name"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" LEFT JOIN ""customers"" ON ""contacts"".""contact_name""=""customers"".""customer_name"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" LEFT JOIN ""customers"" ON ""invoices"".""user_id""=""customers"".""customer_id"") LEFT JOIN ""summary"" ON ""invoices"".""user_id""=""summary"".""user_id"" ORDER BY ""invoice_id"""
204,"SELECT ""i"".""invoice_id"",""cust"".""customer_name"",""i"".""price"",SUM(CASE WHEN ""c"".""user_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""contacts_cnt"",SUM(CASE WHEN ""cont_cust"".""customer_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cust"" ON ""i"".""user_id""=""cust"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id"") LEFT JOIN ""Customers"" AS ""cont_cust"" ON ""c"".""contact_email""=""cont_cust"".""email"" GROUP BY ""i"".""invoice_id"",""cust"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
205,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COALESCE(""abc"".""ct"", 0) AS ""contacts_cnt"",COALESCE(""abc"".""tct"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""ct"",SUM(""trust"") AS ""tct"" FROM (SELECT ""user_id"",(""contact_name""),CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END AS ""trust"" FROM ""customers"" AS ""c"" JOIN ""contacts"" AS ""ct"" ON ""c"".""customer_id""=""ct"".""user_id"") AS ""a"" GROUP BY 1) AS ""abc"" ON ""i"".""user_id""=""abc"".""user_id"") JOIN ""customers"" AS ""c1"" ON ""c1"".""customer_id""=""i"".""user_id"" ORDER BY 1"
206,"SELECT ""i"".""invoice_id"",""cm"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""ct"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cm"" ON ""i"".""user_id""=""cm"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""i"".""user_id""=""ct"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY 1"
207,"SELECT ""invoice_id"",""b"".""customer_name"",""price"",COUNT(CASE WHEN ""c"".""contact_email"" IS NOT NULL THEN ""c"".""contact_email"" ELSE NULL END) AS ""contacts_cnt"",COUNT(CASE WHEN ""c"".""contact_email"" IS NOT NULL AND ""c"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""customers"") THEN ""c"".""contact_email"" ELSE NULL END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""a"".""user_id""=""c"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
208,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""contacts_cnt"",""c"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN (SELECT ""cus"".""customer_id"",""cus"".""customer_name"",COUNT(""cont"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""cont"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""cus"" LEFT JOIN ""Contacts"" AS ""cont"" ON ""cus"".""customer_id""=""cont"".""user_id"" GROUP BY ""cus"".""customer_id"") AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""i"".""invoice_id"""
209,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
210,"WITH ""cte"" AS (SELECT ""i1"".*,""o"".""contact_name"" FROM (SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(""c"".""user_id"") AS ""contacts_cnt"",""i"".""user_id"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Contacts"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id"") JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"" GROUP BY ""i"".""invoice_id"") AS ""i1"" LEFT JOIN ""Contacts"" AS ""o"" ON ""i1"".""user_id""=""o"".""user_id"") SELECT ""cte"".""invoice_id"",""cte"".""customer_name"",""cte"".""price"",""cte"".""contacts_cnt"",COUNT(""c2"".""customer_id"") AS ""trusted_contacts_cnt"" FROM ""cte"" LEFT JOIN ""customers"" AS ""c2"" ON ""cte"".""contact_name""=""c2"".""customer_name"" GROUP BY ""cte"".""invoice_id"" ORDER BY ""cte"".""invoice_id"""
211,"WITH ""cte"" AS (SELECT ""c1"".""customer_id"",""c1"".""customer_name"",COALESCE(COUNT(""c2"".""user_id""), 0) AS ""contacts_cnt"",COALESCE(COUNT(""c3"".""email""), 0) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""c1"" LEFT JOIN ""Contacts"" AS ""c2"" ON (""c1"".""customer_id""=""c2"".""user_id"")) LEFT JOIN ""Customers"" AS ""c3"" ON (""c3"".""email""=""c2"".""contact_email"") GROUP BY 1,2) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""cte"" ON (""i"".""user_id""=""cte"".""customer_id"") ORDER BY 1"
212,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contact_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trust_contact_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""contact_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""t"" ON ""i"".""user_id""=""t"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""trust_contact_cnt"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY ""user_id"") AS ""t2"" ON ""i"".""user_id""=""t2"".""user_id"" ORDER BY 1"
213,"SELECT ""i"".""invoice_id"",""cus"".""customer_name"",""i"".""price"",COUNT(""con"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""con"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") AND ""con"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cus"" ON ""i"".""user_id""=""cus"".""customer_id"") LEFT JOIN ""Contacts"" AS ""con"" ON ""i"".""user_id""=""con"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
214,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""c1"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON (""i"".""user_id""=""c"".""customer_id"")) LEFT JOIN ""Contacts"" AS ""c1"" ON (""c"".""customer_id""=""c1"".""user_id"")) LEFT JOIN ""Customers"" AS ""c2"" ON (""c2"".""email""=""c1"".""contact_email"") GROUP BY 1,2 ORDER BY 1"
215,"WITH ""t"" AS (SELECT ""customers"".""customer_id"",""customers"".""customer_name"",""customers"".""email"",COALESCE(COUNT(DISTINCT ""contacts"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(COUNT(DISTINCT ""trust"".""email""), 0) AS ""trusted_contacts_cnt"" FROM (""customers"" LEFT JOIN ""contacts"" ON ""customers"".""customer_id""=""contacts"".""user_id"") LEFT JOIN ""customers"" AS ""trust"" ON ""contacts"".""contact_name""=""trust"".""customer_name"" AND ""contacts"".""contact_email""=""trust"".""email"" GROUP BY 1,2,3) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""Invoices"" JOIN ""t"" ON ""Invoices"".""user_id""=""t"".""customer_id"" ORDER BY 1"
216,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
217,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_name"") AS ""contacts_cnt"",COALESCE(""tco"".""trusted_count"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_count"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""tco"" ON ""tco"".""user_id""=""cu"".""customer_id"" GROUP BY 1,2,3 ORDER BY ""i"".""invoice_id"""
218,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""Contacts"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""Contacts"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Customers"" JOIN ""Invoices"" ON ""Customers"".""customer_id""=""Invoices"".""user_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"" GROUP BY ""invoice_id"" ORDER BY ""invoice_id"""
219,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""ct"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""ct"" ON ""ct"".""user_id""=""c"".""customer_id"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
220,"SELECT ""invoices"".""invoice_id"",""customers"".""customer_name"",""invoices"".""price"",COUNT(""contact_name"") AS ""contacts_cnt"",COUNT(""emails"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""invoices"" LEFT JOIN ""Customers"" AS ""customers"" ON ""invoices"".""user_id""=""customers"".""customer_id"") LEFT JOIN ""Contacts"" AS ""contacts"" ON ""invoices"".""user_id""=""contacts"".""user_id"") LEFT JOIN ""Customers"" AS ""emails"" ON ""emails"".""email""=""contacts"".""contact_email"" GROUP BY ""invoices"".""invoice_id"",""invoices"".""price"",""customers"".""customer_name"" ORDER BY ""invoice_id"""
221,"WITH ""cte"" AS (SELECT ""c"".""user_id"",COUNT(""c"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""cust"".""customer_name"" IS NULL THEN 0 ELSE 1 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""c"" LEFT JOIN ""Customers"" AS ""cust"" ON ""c"".""contact_name""=""cust"".""customer_name"" GROUP BY 1) SELECT ""i"".""invoice_id"",""cust"".""customer_name"",""i"".""price"",COALESCE(""cte"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""cte"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cust"" ON ""i"".""user_id""=""cust"".""customer_id"") LEFT JOIN ""cte"" ON ""cte"".""user_id""=""i"".""user_id"" ORDER BY 1"
222,"WITH ""contact_info"" AS (SELECT ""i"".""invoice_id"",""i"".""price"",""i"".""user_id"" AS ""user_id1"",""co"".""user_id"" AS ""user_id2"",""co"".""contact_name"" FROM ""Invoices"" AS ""i"" LEFT JOIN ""Contacts"" AS ""co"" ON ""i"".""user_id""=""co"".""user_id""), ""trust_contact_info"" AS (SELECT ""c"".""invoice_id"",""c"".""price"",""c"".""user_id1"",""c"".""user_id2"",""c"".""contact_name"",""cu"".""customer_name"" FROM ""contact_info"" AS ""c"" LEFT JOIN ""Customers"" AS ""cu"" ON ""c"".""contact_name""=""cu"".""customer_name""), ""group_table"" AS (SELECT ""invoice_id"",""user_id1"",""price"",SUM(CASE WHEN ""user_id2"" IS NOT NULL THEN 1 ELSE 0 END) AS ""contacts_cnt"",SUM(CASE WHEN ""customer_name"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""trust_contact_info"" GROUP BY 1,2) SELECT ""g"".""invoice_id"",""c"".""customer_name"",""g"".""price"",""g"".""contacts_cnt"",""g"".""trusted_contacts_cnt"" FROM ""group_table"" AS ""g"" JOIN ""Customers"" AS ""c"" ON ""g"".""user_id1""=""c"".""customer_id"" ORDER BY ""g"".""invoice_id"""
223,"WITH ""customergroup"" AS (SELECT ""a"".""customer_id"",""a"".""customer_name"",COUNT(""b"".""user_id"") AS ""contacts_cnt"",COALESCE(""c"".""countuser_id"", 0) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"") LEFT JOIN (SELECT ""user_id"" AS ""verifieduser"",COUNT(""user_id"") AS ""countuser_id"" FROM ""Contacts"" AS ""a"" JOIN ""Customers"" AS ""b"" ON ""a"".""contact_email""=""b"".""email"" GROUP BY ""user_id"") AS ""c"" ON ""a"".""customer_id""=""c"".""verifieduser"" GROUP BY ""a"".""customer_id"",""a"".""customer_name"") SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",""b"".""contacts_cnt"",""b"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""a"" LEFT JOIN ""customergroup"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"" ORDER BY ""a"".""invoice_id"""
224,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Customers"" LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"") JOIN ""Invoices"" ON ""Customers"".""customer_id""=""Invoices"".""user_id"" GROUP BY ""invoice_id"" ORDER BY ""invoice_id"""
225,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COUNT(""c"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"" GROUP BY ""a"".""invoice_id"" ORDER BY ""a"".""invoice_id"""
226,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"",COALESCE(SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END), 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" LEFT JOIN ""Customers"" ON ""Customers"".""customer_id""=""Invoices"".""user_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"" GROUP BY 1 ORDER BY 1"
227,"WITH ""trust"" AS (SELECT ""Con"".""user_id"",COUNT(""Con"".""contact_email"") AS ""contacts_cnt"",COUNT(""Cus"".""email"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""Con"" LEFT JOIN ""Customers"" AS ""Cus"" ON ""Cus"".""email""=""Con"".""contact_email"" GROUP BY ""Con"".""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""T"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""T"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""I"" JOIN ""Customers"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"") LEFT JOIN ""trust"" AS ""T"" ON ""I"".""user_id""=""T"".""user_id"" ORDER BY ""invoice_id"""
228,"WITH ""cnts"" AS (SELECT ""user_id"",COUNT(1) AS ""num"" FROM ""contacts"" GROUP BY 1), ""trusted_cnts"" AS (SELECT ""c"".""user_id"",COUNT(""cust"".""email"") AS ""trusted_count"" FROM ""contacts"" AS ""c"" LEFT JOIN ""customers"" AS ""cust"" ON ""cust"".""email""=""c"".""contact_email"" GROUP BY 1) SELECT ""i"".""invoice_id"",""con"".""customer_name"",""i"".""price"",COALESCE(""c"".""num"", 0) AS ""contacts_cnt"",COALESCE(""t"".""trusted_count"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""con"" ON ""con"".""customer_id""=""i"".""user_id"") LEFT JOIN ""cnts"" AS ""c"" ON ""c"".""user_id""=""i"".""user_id"") LEFT JOIN ""trusted_cnts"" AS ""t"" ON ""t"".""user_id""=""i"".""user_id"" ORDER BY 1"
229,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COUNT(DISTINCT ""c"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""a"".""user_id""=""c"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
230,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""ct"".""contact_email"") AS ""contacts_cnt"",COUNT(DISTINCT ""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""ct"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Customers"" AS ""c2"" ON ""ct"".""contact_email""=""c2"".""email"" GROUP BY 1,2,3 ORDER BY 1"
231,"SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (SELECT ""cte1"".""invoice_id"",""cte1"".""customer_id"",""cte1"".""customer_name"",""cte1"".""price"",""cte2"".""contacts_cnt"" FROM (SELECT ""cu"".""customer_id"",""cu"".""customer_name"",COUNT(""co"".""user_id"") AS ""contacts_cnt"" FROM ""Customers"" AS ""cu"" LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" GROUP BY 1,2) AS ""cte2"" LEFT JOIN (SELECT ""i"".""invoice_id"",""cu"".""customer_id"",""cu"".""customer_name"",""i"".""price"" FROM ""Customers"" AS ""cu"" LEFT JOIN ""Invoices"" AS ""i"" ON ""cu"".""customer_id""=""i"".""user_id"") AS ""cte1"" ON ""cte1"".""customer_id""=""cte2"".""customer_id"") AS ""cte3"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY 1) AS ""cte4"" ON ""cte3"".""customer_id""=""cte4"".""user_id"" WHERE ""invoice_id"" IS NOT NULL ORDER BY ""invoice_id"""
232,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""ct"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""i"".""user_id""=""ct"".""user_id"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
233,"WITH ""cte"" AS (SELECT DISTINCT ""email"" FROM ""Customers"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""co"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT * FROM ""cte"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
234,"WITH ""temp1"" AS (SELECT *,(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts"" FROM ""Contacts""), ""temp2"" AS (SELECT * FROM ""Invoices"" LEFT JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id""), ""temp3"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(""trusted_contacts"") AS ""trusted_contacts_cnt"" FROM ""temp1"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""temp2"" LEFT JOIN ""temp3"" ON ""temp2"".""user_id""=""temp3"".""user_id"" ORDER BY ""invoice_id"""
235,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""t"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"""
236,"WITH ""cte_join_contacts"" AS (SELECT ""invoice_id"",""cu"".""customer_name"",""price"",""contact_name"",""contact_email"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""i"".""user_id""=""cont"".""user_id""), ""cte_contacts_agg"" AS (SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""cte_join_contacts"" GROUP BY 1,2,3), ""cte_trusted_contacts_agg"" AS (SELECT ""invoice_id"",""c1"".""customer_name"",""price"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""cte_join_contacts"" AS ""c1"" JOIN ""Customers"" AS ""c2"" ON ""c1"".""contact_email""=""c2"".""email"" GROUP BY 1,2,3), ""cte_assemble"" AS (SELECT ""c"".""invoice_id"",""c"".""customer_name"",""c"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte_contacts_agg"" AS ""c"" LEFT JOIN ""cte_trusted_contacts_agg"" AS ""tc"" ON ""c"".""invoice_id""=""tc"".""invoice_id"" AND ""c"".""customer_name""=""tc"".""customer_name"" ORDER BY 1) SELECT * FROM ""cte_assemble"""
237,"WITH ""customer_contacts"" AS (SELECT ""a"".""customer_id"",""a"".""customer_name"",COUNT(""b"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""b"".""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY 1,2) SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""contacts_cnt"",""c"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""customer_contacts"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY 1"
238,"SELECT ""t1"".""invoice_id"",""t2"".""customer_name"",""t1"".""price"",COUNT(""t3"".""user_id"") AS ""contacts_cnt"",COUNT(""t4"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""t1"" JOIN ""customers"" AS ""t2"" ON ""t2"".""customer_id""=""t1"".""user_id"") LEFT JOIN ""contacts"" AS ""t3"" ON ""t3"".""user_id""=""t2"".""customer_id"") LEFT JOIN ""customers"" AS ""t4"" ON ""t4"".""email""=""t3"".""contact_email"" GROUP BY ""t1"".""invoice_id"",""t2"".""customer_name"",""t1"".""price"" ORDER BY ""t1"".""invoice_id"""
239,"WITH ""cte_join_contacts"" AS (SELECT ""invoice_id"",""cu"".""customer_name"",""price"",""contact_name"",""contact_email"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""i"".""user_id""=""cont"".""user_id""), ""cte_contacts_agg"" AS (SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""cte_join_contacts"" GROUP BY 1,2,3), ""cte_trusted_contacts_agg"" AS (SELECT ""invoice_id"",""c1"".""customer_name"",""price"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""cte_join_contacts"" AS ""c1"" JOIN ""Customers"" AS ""c2"" ON ""c1"".""contact_email""=""c2"".""email"" GROUP BY 1,2,3), ""cte_assemble"" AS (SELECT ""c"".""invoice_id"",""c"".""customer_name"",""c"".""price"",""contacts_cnt"" AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte_contacts_agg"" AS ""c"" LEFT JOIN ""cte_trusted_contacts_agg"" AS ""tc"" ON ""c"".""invoice_id""=""tc"".""invoice_id"" AND ""c"".""customer_name""=""tc"".""customer_name"" ORDER BY 1) SELECT * FROM ""cte_assemble"""
240,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"""
241,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""C2"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""C2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""I1"" JOIN ""Customers"" AS ""C1"" ON ""I1"".""user_id""=""C1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""C2"" ON ""I1"".""user_id""=""C2"".""user_id"" GROUP BY ""invoice_id"" ORDER BY 1,2,3"
242,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
243,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""co"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
244,"SELECT ""invoice_id"",""c"".""customer_name"",""price"",COUNT(""co"".""user_id"") AS ""contacts_cnt"",COUNT(""e"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"") LEFT JOIN ""Customers"" AS ""e"" ON ""e"".""email""=""co"".""contact_email"" GROUP BY 1,2,3 ORDER BY 1"
245,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
246,"WITH ""trust"" AS (SELECT ""user_id"",COUNT(1) AS ""trust"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") GROUP BY ""user_id""), ""contact_cnt"" AS (SELECT ""c"".""customer_id"",""c"".""customer_name"",COUNT(""ct"".""user_id"") AS ""contacts_cnt"" FROM ""customers"" AS ""c"" RIGHT JOIN ""contacts"" AS ""ct"" ON ""c"".""customer_id""=""ct"".""user_id"" GROUP BY ""c"".""customer_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""cc"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t"".""trust"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contact_cnt"" AS ""cc"" ON ""i"".""user_id""=""cc"".""customer_id"") LEFT JOIN ""trust"" AS ""t"" ON ""i"".""user_id""=""t"".""user_id"" ORDER BY ""i"".""invoice_id"""
247,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""price"",COUNT(""t"".""user_id"") AS ""contacts_cnt"",COUNT(DISTINCT ""e"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""t"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Customers"" AS ""e"" ON ""e"".""email""=""t"".""contact_email"" GROUP BY 1,2,3 ORDER BY 1"
248,"SELECT ""I"".""invoice_id"" AS ""invoice_id"",""C"".""customer_name"" AS ""customer_name"",""I"".""price"" AS ""price"",COUNT(""T1"".""contact_name"") AS ""contacts_cnt"",COUNT(""C2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Customers"" AS ""C"" JOIN ""Invoices"" AS ""I"" ON ""I"".""user_id""=""C"".""customer_id"") LEFT JOIN ""Contacts"" AS ""T1"" ON ""I"".""user_id""=""T1"".""user_id"") LEFT JOIN ""Customers"" AS ""C2"" ON ""C2"".""email""=""T1"".""contact_email"" GROUP BY 1,2,3 ORDER BY 1"
249,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""con"".""user_id""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""cus"".""email"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""con"" ON ""c"".""customer_id""=""con"".""user_id"") LEFT JOIN ""Customers"" AS ""cus"" ON ""con"".""contact_email""=""cus"".""email"" GROUP BY ""c"".""customer_name"",""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
250,"WITH ""cte"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""co"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"" GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""cte"" AS ""c"" RIGHT JOIN ""invoices"" AS ""i"" ON ""c"".""customer_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
251,"SELECT ""c"".""invoice_id"",""a"".""customer_name"",""c"".""price"",COUNT(""b"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""d"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""c"" LEFT JOIN ""Customers"" AS ""a"" ON ""a"".""customer_id""=""c"".""user_id"") LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"") LEFT JOIN ""Customers"" AS ""d"" ON ""b"".""contact_name""=""d"".""customer_name"" GROUP BY ""c"".""invoice_id"""
252,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"",COALESCE(SUM(""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"")), 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
253,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contact_cnt"",COUNT(""customer_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""ct"" LEFT JOIN ""customers"" AS ""cm"" ON ""contact_name""=""customer_name"" AND ""contact_email""=""email"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contact_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""user_id"" ORDER BY ""invoice_id"""
254,"WITH ""CTE2"" AS (SELECT ""User_ID"",CASE WHEN ""Contact_Email"" IN (SELECT ""Email"" FROM ""Customers"") THEN 'Y' ELSE 'N' END AS ""CN_Exists"" FROM ""Contacts""), ""CTE3"" AS (SELECT ""User_ID"",COUNT(""User_ID"") AS ""Count1"",SUM(CASE WHEN ""CN_Exists""='Y' THEN 1 ELSE 0 END) AS ""Count2"" FROM ""CTE2"" GROUP BY ""User_ID"") SELECT ""Invoice_ID"",""Customer_Name"",""Price"",COALESCE(""Count1"", 0) AS ""contacts_cnt"",COALESCE(""Count2"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""I"" JOIN ""Customers"" AS ""C"" ON ""I"".""User_ID""=""C"".""Customer_ID"") LEFT JOIN ""CTE3"" AS ""C1"" ON ""I"".""User_ID""=""C1"".""User_ID"" ORDER BY ""I"".""Invoice_ID"""
255,"SELECT ""tmp"".""invoice_id"",""Customers"".""customer_name"",""tmp"".""price"",""tmp"".""contacts_cnt"",""tmp"".""trusted_contacts_cnt"" FROM (SELECT ""invoice_id"",""price"",""user_id"",COALESCE(COUNT(DISTINCT ""contact_email""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Invoices"" LEFT JOIN ""Contacts"" USING (""user_id"") GROUP BY ""invoice_id"") AS ""tmp"" JOIN ""Customers"" ON ""tmp"".""user_id""=""Customers"".""customer_id"" ORDER BY ""invoice_id"""
256,"SELECT ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"",COALESCE(""tab1"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""tab1"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""C"" JOIN ""Invoices"" AS ""I"" ON ""C"".""customer_id""=""I"".""user_id"") LEFT JOIN (SELECT ""Co"".""user_id"" AS ""user_id"",COUNT(""Cu"".""customer_name"") AS ""trusted_contacts_cnt"",COUNT(""Co"".""contact_name"") AS ""contacts_cnt"" FROM ""Contacts"" AS ""Co"" LEFT JOIN ""Customers"" AS ""Cu"" ON ""Co"".""contact_name""=""Cu"".""customer_name"" GROUP BY ""Co"".""user_id"") AS ""tab1"" ON ""I"".""user_id""=""tab1"".""user_id"" ORDER BY ""invoice_id"""
257,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""contacts"".""contact_name"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" ON ""contacts"".""user_id""=""i"".""user_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""contacts"".""contact_email"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
258,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""co"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(COUNT(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE NULL END), 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""co"".""user_id""=""i"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
259,"SELECT ""c"".""invoice_id"",""a"".""customer_name"",""c"".""price"",COUNT(""b"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""b"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""a"" JOIN ""Invoices"" AS ""c"" ON ""a"".""customer_id""=""c"".""user_id"") LEFT JOIN ""Contacts"" AS ""b"" ON ""b"".""user_id""=""c"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
260,"WITH ""c1"" AS (SELECT ""a"".""customer_id"",""a"".""customer_name"",COUNT(""b"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""b"".""contact_email"" IN (SELECT ""a"".""email"" FROM ""Customers"" AS ""a"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY 1) SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",""c1"".""contacts_cnt"",""c1"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"" ORDER BY 1"
261,"WITH ""a"" AS (SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""i"".""user_id"" FROM ""Customers"" AS ""c"" JOIN ""Invoices"" AS ""i"" ON ""c"".""customer_id""=""i"".""user_id""), ""b"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id""), ""c"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""user_id"") SELECT ""a"".""invoice_id"",""a"".""customer_name"",""a"".""price"",COALESCE(""b"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""c"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""a"" LEFT JOIN ""b"" ON ""a"".""user_id""=""b"".""user_id"") LEFT JOIN ""c"" ON ""a"".""user_id""=""c"".""user_id"" ORDER BY ""a"".""invoice_id"""
262,"WITH ""cte"" AS (SELECT ""c"".""customer_id"",""c"".""customer_name"",SUM(CASE WHEN ""t"".""user_id"" IS NULL THEN 0 ELSE 1 END) AS ""contacts_cnt"",SUM(CASE WHEN ""t"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""c"".""customer_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""contacts_cnt"",""c"".""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" JOIN ""cte"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""i"".""invoice_id"""
263,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" LEFT JOIN ""customers"" ON ""invoices"".""user_id""=""customers"".""customer_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""sub"" ON ""invoices"".""user_id""=""sub"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""sub2"" ON ""invoices"".""user_id""=""sub2"".""user_id"" ORDER BY ""invoice_id"""
264,"SELECT ""invoice_id"",""b"".""customer_name"",""price"",COUNT(""c"".""user_id"") AS ""contacts_cnt"",COUNT(""b2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"") LEFT JOIN ""customers"" AS ""b2"" ON ""b2"".""email""=""c"".""contact_email"" GROUP BY 1 ORDER BY 1"
265,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
266,"SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" LEFT JOIN (SELECT ""customer_name"",""customer_id"",COUNT(""user_id"") AS ""contacts_cnt"",SUM(COALESCE((""contact_email"" IN (SELECT ""email"" FROM ""customers""))=1, 0)) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""o"" ON ""c"".""customer_id""=""o"".""user_id"" GROUP BY ""customer_name"",""customer_id"") AS ""t"" ON ""i"".""user_id""=""t"".""customer_id"" ORDER BY ""invoice_id"""
267,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(DISTINCT ""c1"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT (""customer_name"") FROM ""customers"") THEN 1 ELSE 0 END), 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""c1"" ON ""c"".""customer_id""=""c1"".""user_id"" GROUP BY ""i"".""invoice_id"""
268,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contacts"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""cte"".""user_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
269,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY 1), ""cte2"" AS (SELECT ""user_id"",COALESCE(COUNT(""contact_name""), 0) AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") GROUP BY 1) SELECT ""i"".""invoice_id"",""cx"".""customer_name"",""i"".""price"",COALESCE(""cte"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""cte2"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cx"" ON ""i"".""user_id""=""cx"".""customer_id"") LEFT JOIN ""cte"" ON ""cx"".""customer_id""=""cte"".""user_id"") LEFT JOIN ""cte2"" ON ""cx"".""customer_id""=""cte2"".""user_id"" ORDER BY 1"
270,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""ct"".""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""c"".""customer_id""=""ct"".""user_id"" GROUP BY 1 ORDER BY 1"
271,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_name"") AS ""contacts_cnt"",COUNT(""cu2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""co"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Customers"" AS ""cu2"" ON ""co"".""contact_email""=""cu2"".""email"" GROUP BY 1,2,3 ORDER BY 1"
272,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
273,"WITH ""cte"" AS (SELECT ""invoice_id"",""customer_name"",""price"",""customer_id"" FROM ""invoices"" AS ""a"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""a"".""user_id""), ""cte1"" AS (SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",""user_id"" FROM ""cte"" LEFT JOIN (SELECT ""user_id"",COUNT(""user_id"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""b"" ON ""cte"".""customer_id""=""b"".""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trust"", 0) AS ""trusted_contacts_cnt"" FROM ""cte1"" AS ""d"" LEFT JOIN (SELECT ""user_id"",COUNT(""user_id"") AS ""trust"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""b"" ON ""d"".""user_id""=""b"".""user_id"" ORDER BY ""invoice_id"""
274,"WITH ""Contact_ct"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""c1"".""customer_name"",""i"".""price"",COALESCE(""c2"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""Contact_ct"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" ORDER BY ""invoice_id"""
275,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contacts"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""cte"".""user_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
276,"SELECT ""invoice_id"",""Customers"".""customer_name"",""price"",COALESCE(COUNT(""contact_email""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""customer_id"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"") LEFT JOIN ""Customers"" AS ""c"" ON ""Contacts"".""contact_email""=""c"".""email"" GROUP BY ""invoice_id"",""Customers"".""customer_id"" ORDER BY 1"
277,"SELECT ""i"".""invoice_id"" AS ""invoice_id"",""c"".""customer_name"" AS ""customer_name"",""i"".""price"" AS ""price"",COUNT(DISTINCT ""co"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""i"".""user_id""=""co"".""user_id"" GROUP BY ""i"".""invoice_id"""
278,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON (""c"".""customer_id""=""i"".""user_id"")) LEFT JOIN ""Contacts"" AS ""con"" ON (""con"".""user_id""=""c"".""customer_id"")) LEFT JOIN ""Customers"" AS ""c2"" ON (""c2"".""email""=""con"".""contact_email"") GROUP BY ""i"".""invoice_id"",""c"".""customer_name"" ORDER BY ""i"".""invoice_id"""
279,"WITH ""T1"" AS (SELECT ""customer_id"",COUNT(""C1"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""C1"" JOIN ""Customers"" AS ""C2"" ON ""C1"".""user_id""=""C2"".""customer_id"" GROUP BY ""customer_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""I"" LEFT JOIN ""T1"" ON ""I"".""user_id""=""T1"".""customer_id"") JOIN ""Customers"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"" ORDER BY ""invoice_id"""
280,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""o"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""o"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""o"" ON ""c"".""customer_id""=""o"".""user_id"" GROUP BY 1 ORDER BY 1"
281,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""ct"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""cc"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""ct"" ON ""ct"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""cc"" ON ""cc"".""email""=""ct"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
282,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""ct"".""contact_name"") AS ""contacts_cnt"",COUNT(""cc"".""email"") AS ""trusted_contacts_cnt"" FROM ((""customers"" AS ""c"" JOIN ""invoices"" AS ""i"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""ct"" ON ""c"".""customer_id""=""ct"".""user_id"") LEFT JOIN ""customers"" AS ""cc"" ON ""cc"".""email""=""ct"".""contact_email"" GROUP BY 1,2,3 ORDER BY 1"
283,"WITH ""customer_contact"" AS (SELECT ""customer_id"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"",COALESCE(SUM(""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"")), 0) AS ""trusted_contacts_cnt"" FROM ""customers"" LEFT JOIN ""contacts"" ON ""customer_id""=""user_id"" GROUP BY ""customer_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""cc"".""contacts_cnt"",""cc"".""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customer_contact"" AS ""cc"" ON ""i"".""user_id""=""cc"".""customer_id"" ORDER BY ""i"".""invoice_id"""
284,"WITH ""cte"" AS (SELECT ""i"".""invoice_id"",""i"".""user_id"",""i"".""price"",""c"".""customer_id"",""c"".""customer_name"" FROM ""Customers"" AS ""c"" JOIN ""Invoices"" AS ""i"" ON ""i"".""user_id""=""c"".""customer_id""), ""cte2"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""cn"" LEFT JOIN ""Customers"" AS ""c"" ON ""c"".""customer_name""=""cn"".""contact_name"" GROUP BY ""cn"".""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte"" LEFT JOIN ""cte2"" USING (""user_id"") ORDER BY ""invoice_id"""
285,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""price"",COUNT(""t"".""user_id"") AS ""contacts_cnt"",COUNT(DISTINCT ""e"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""t"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Customers"" AS ""e"" ON ""e"".""email""=""t"".""contact_email"" GROUP BY 1,2,3 ORDER BY 1"
286,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COALESCE(""b"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""a"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""cu"".""customer_id""=""i"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") AS ""a"" ON ""i"".""user_id""=""a"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") AS ""b"" ON ""b"".""user_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
287,"SELECT ""c"".""invoice_id"",""a"".""customer_name"",""c"".""price"",COUNT(""b"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""d"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""c"" LEFT JOIN ""Customers"" AS ""a"" ON ""a"".""customer_id""=""c"".""user_id"") LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"") LEFT JOIN ""Customers"" AS ""d"" ON ""b"".""contact_name""=""d"".""customer_name"" GROUP BY 1,2,3"
288,"SELECT ""i"".""invoice_id"",""t"".""customer_name"",""i"".""price"",""t"".""contacts_cnt"",""t"".""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" JOIN (SELECT ""c1"".""customer_id"",""c1"".""customer_name"",COUNT(DISTINCT ""c"".""contact_email"") AS ""contacts_cnt"",COUNT(DISTINCT ""c2"".""customer_id"") AS ""trusted_contacts_cnt"" FROM (""customers"" AS ""c1"" LEFT JOIN ""contacts"" AS ""c"" ON ""c1"".""customer_id""=""c"".""user_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c"".""contact_email""=""c2"".""email"" GROUP BY ""c1"".""customer_id"") AS ""t"" ON ""i"".""user_id""=""t"".""customer_id"" ORDER BY ""i"".""invoice_id"""
289,"WITH ""e"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"",COUNT(""email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" LEFT JOIN ""Customers"" ON ""Customers"".""email""=""contacts"".""contact_email"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" LEFT JOIN ""customers"" ON ""customers"".""customer_id""=""invoices"".""user_id"") LEFT JOIN ""e"" ON ""e"".""user_id""=""invoices"".""user_id"" ORDER BY ""invoice_id"""
290,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"""
291,"SELECT ""Invoices"".""invoice_id"",""Customers"".""customer_name"",""Invoices"".""price"",COUNT(""Contacts"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""Contacts"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" JOIN ""Customers"" ON ""Customers"".""customer_id""=""Invoices"".""user_id"") LEFT JOIN ""Contacts"" ON ""Contacts"".""user_id""=""Invoices"".""user_id"" GROUP BY ""invoice_id"",""Invoices"".""user_id"" ORDER BY ""Invoices"".""invoice_id"""
292,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
293,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COUNT(""c"".""user_id"") AS ""contacts_cnt"",COUNT(""d"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"") LEFT JOIN ""Customers"" AS ""d"" ON ""d"".""customer_name""=""c"".""contact_name"" GROUP BY ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"" ORDER BY ""a"".""invoice_id"""
294,"SELECT ""t1"".""invoice_id"",""t2"".""customer_name"",""t1"".""price"",COUNT(""t3"".""user_id"") AS ""contacts_cnt"",COUNT(""t4"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""t1"" JOIN ""customers"" AS ""t2"" ON ""t2"".""customer_id""=""t1"".""user_id"") LEFT JOIN ""contacts"" AS ""t3"" ON ""t3"".""user_id""=""t2"".""customer_id"") LEFT JOIN ""customers"" AS ""t4"" ON ""t4"".""email""=""t3"".""contact_email"" GROUP BY ""t1"".""invoice_id"",""t2"".""customer_name"",""t1"".""price"" ORDER BY ""t1"".""invoice_id"""
295,"WITH ""CTE"" AS (SELECT ""customer_id"",""customer_name"",""email"",COALESCE(""contact_count"", 0) AS ""contacts_cnt"",COALESCE(""trusted"", 0) AS ""trusted_contacts_cnt"" FROM ""customers"" LEFT JOIN (SELECT ""user_id"",SUM(CASE WHEN ""email"" IS NULL THEN 0 ELSE 1 END) AS ""trusted"",COUNT(""user_id"") AS ""contact_count"" FROM ""contacts"" LEFT JOIN ""customers"" ON ""email""=""contact_email"" GROUP BY ""user_id"") AS ""a"" ON ""customer_id""=""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""CTE"" JOIN ""invoices"" ON ""customer_id""=""user_id"" ORDER BY ""invoice_id"""
296,"WITH ""tmp_table1"" AS (SELECT ""email"" FROM ""Customers"") SELECT ""invoice_id"",MAX(""customer_name"") AS ""customer_name"",MAX(""price"") AS ""price"",COUNT(DISTINCT (""contact_email"")) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT * FROM ""tmp_table1"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",""c"".""contact_email"" FROM (""Invoices"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"") AS ""d"" GROUP BY ""invoice_id"" ORDER BY ""invoice_id"""
297,"WITH ""cte"" AS (SELECT ""invoice_id"",""a"".""user_id"" AS ""customer_id"",""customer_name"",""price"" FROM ""Invoices"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id""), ""cte1"" AS (SELECT ""a"".""customer_id"",COUNT(""b"".""contact_name"") AS ""contacts_cnt"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY 1), ""cte2"" AS (SELECT ""a"".""customer_id"",COUNT(""b"".""contact_email"") AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" WHERE ""b"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""cte"" AS ""a"" LEFT JOIN ""cte1"" AS ""b"" ON ""a"".""customer_id""=""b"".""customer_id"") LEFT JOIN ""cte2"" AS ""c"" ON ""a"".""customer_id""=""c"".""customer_id"" ORDER BY ""invoice_id"""
298,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""co"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(COUNT(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE NULL END), 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""co"".""user_id""=""c"".""customer_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
299,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""contacts_cnt"",""c"".""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" LEFT JOIN (SELECT ""c"".""customer_id"",""c"".""customer_name"",COALESCE(COUNT(""t"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(SUM(""t"".""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"")), 0) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""t"" ON ""t"".""user_id""=""c"".""customer_id"" GROUP BY ""c"".""customer_id"") AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""i"".""invoice_id"""
300,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""c2"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY 1"
301,"WITH ""cte"" AS (SELECT ""customer_id"",""customer_name"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""trusted""='yes' THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (SELECT ""cu"".""customer_id"",""cu"".""customer_name"",""co"".""contact_name"",(CASE WHEN ""co"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 'yes' ELSE 'no' END) AS ""trusted"" FROM ""Customers"" AS ""cu"" LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"") AS ""t"" GROUP BY ""customer_name"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""customer_id"" ORDER BY ""invoice_id"""
302,"SELECT ""i"".""invoice_id"",""customer_name"",""i"".""price"",COUNT(""cs"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""cs"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""cs"" ON ""c"".""customer_id""=""cs"".""user_id"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
303,"WITH ""CustContacts"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id""), ""TrustedContacts"" AS (SELECT ""user_id"",COUNT(""cust"".""email"") AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""cust"" LEFT JOIN ""Contacts"" AS ""con"" ON ""cust"".""email""=""con"".""contact_email"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cust"" ON ""i"".""user_id""=""cust"".""customer_id"") LEFT JOIN ""CustContacts"" AS ""cc"" ON ""i"".""user_id""=""cc"".""user_id"") LEFT JOIN ""TrustedContacts"" AS ""tc"" ON ""i"".""user_id""=""tc"".""user_id"" ORDER BY ""invoice_id"""
304,"WITH ""cte"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""c1"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""c2"" LEFT JOIN ""contacts"" AS ""c1"" ON ""c1"".""user_id""=""c2"".""customer_id"" GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" JOIN ""cte"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY 1"
305,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""cn"".""user_id"") AS ""contacts_cnt"",COUNT(""t"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cn"" ON ""cn"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Customers"" AS ""t"" ON ""cn"".""contact_name""=""t"".""customer_name"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
306,"WITH ""base"" AS (SELECT ""i"".""invoice_id"",""i"".""price"",""c"".""customer_name"",""ct"".""contact_name"",CASE WHEN ""ct"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END AS ""trusted"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""c"".""customer_id""=""ct"".""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(""trusted"") AS ""trusted_contacts_cnt"" FROM ""base"" GROUP BY 1,2,3 ORDER BY 1"
307,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""a"" ON ""Invoices"".""user_id""=""a"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""user_id"") AS ""b"" ON ""Invoices"".""user_id""=""b"".""user_id"") JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"" ORDER BY ""invoice_id"""
308,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(""trusted"") AS ""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" LEFT JOIN (SELECT ""c"".""customer_id"",""customer_name"",""contact_name"",CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END AS ""trusted"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""con"" ON ""c"".""customer_id""=""con"".""user_id"") AS ""temp"" ON ""i"".""user_id""=""temp"".""customer_id"" GROUP BY ""invoice_id"" ORDER BY ""invoice_id"""
309,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(""m"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""customer_name"" IS NOT NULL THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""m"" ON ""c1"".""customer_id""=""m"".""user_id"") LEFT JOIN ""Customers"" AS ""c2"" ON ""m"".""contact_name""=""c2"".""customer_name"" AND ""m"".""contact_email""=""c2"".""email"" GROUP BY ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
310,"WITH ""temp"" AS (SELECT ""Invoices"".""user_id"" AS ""user_id"",""invoice_id"",""customer_name"",""price"",(SELECT COUNT(""contact_email"") FROM ""Contacts"" WHERE ""Contacts"".""user_id""=""Invoices"".""user_id"") AS ""contacts_cnt"" FROM ""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"" ORDER BY 1), ""temp2"" AS (SELECT ""user_id"",COUNT(DISTINCT ""email"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" JOIN ""Customers"" ON ""Contacts"".""contact_name""=""Customers"".""customer_name"" AND ""Contacts"".""contact_email""=""Customers"".""email"" GROUP BY 1) SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""temp"" LEFT JOIN ""temp2"" ON ""temp"".""user_id""=""temp2"".""user_id"" ORDER BY 1"
311,"WITH ""a"" AS (SELECT ""user_id"",COALESCE(COUNT(1), 0) AS ""contacts_"" FROM ""contacts"" GROUP BY ""user_id""), ""b"" AS (SELECT ""user_id"",COALESCE(COUNT(""user_id""), 0) AS ""trusted"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_"", 0) AS ""contacts_cnt"",COALESCE(""trusted"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""a"" ON ""a"".""user_id""=""c"".""customer_id"") LEFT JOIN ""b"" ON ""b"".""user_id""=""c"".""customer_id"" ORDER BY 1"
312,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
313,"SELECT ""invoice_id"",""table1"".""customer_name"",""price"",COALESCE(""table2"".""count"", 0) AS ""contacts_cnt"",COALESCE(""table3"".""count"", 0) AS ""trusted_contacts_cnt"" FROM ((SELECT ""invoice_id"",""customer_name"",""price"" FROM ""Invoices"" LEFT JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") AS ""table1"" LEFT JOIN (SELECT ""Customer_name"",COUNT(""contact_name"") AS ""count"" FROM ""Contacts"" LEFT JOIN ""Customers"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"" GROUP BY ""Customer_name"") AS ""table2"" ON ""table1"".""customer_name""=""table2"".""Customer_name"") LEFT JOIN (SELECT ""Customer_name"",COUNT(""contact_name"") AS ""count"" FROM ""Contacts"" LEFT JOIN ""Customers"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"" WHERE ""Contacts"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""Customer_name"") AS ""table3"" ON ""table1"".""customer_name""=""table3"".""Customer_name"" ORDER BY ""table1"".""invoice_id"""
314,"SELECT ""invoice_id"",""c"".""customer_name"",""i"".""price"",""a"".""contacts_cnt"",COALESCE(""b"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN (SELECT ""customer_name"",COUNT(""user_id"") AS ""contacts_cnt"" FROM ""customers"" AS ""cu"" LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" GROUP BY ""customer_name"") AS ""a"" ON ""c"".""customer_name""=""a"".""customer_name"") LEFT JOIN (SELECT ""customer_name"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""cu"" LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""customer_name"") AS ""b"" ON ""a"".""customer_name""=""b"".""customer_name"" ORDER BY ""invoice_id"""
315,"SELECT ""invoices"".""invoice_id"",""customers"".""customer_name"",""invoices"".""price"",COUNT(""contacts"".""contact_name"") AS ""contacts_cnt"",COALESCE(SUM(""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"")), 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" LEFT JOIN ""customers"" ON ""invoices"".""user_id""=""customers"".""customer_id"") LEFT JOIN ""contacts"" ON ""customers"".""customer_id""=""contacts"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
316,"WITH ""t1"" AS (SELECT ""c1"".""customer_id"",""c1"".""customer_name"",COUNT(""c2"".""contact_email"") AS ""contacts_cnt"" FROM ""Customers"" AS ""c1"" LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY 1), ""t2"" AS (SELECT ""user_id"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY 1) SELECT ""i"".""invoice_id"",""t1"".""customer_name"",""i"".""price"",COALESCE(""t1"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t2"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""t1"" ON ""i"".""user_id""=""t1"".""customer_id"") LEFT JOIN ""t2"" ON ""i"".""user_id""=""t2"".""user_id"" ORDER BY 1"
317,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COUNT(""c"".""contact_name"") AS ""contacts_cnt"",COUNT(""d"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""b"".""customer_id""=""a"".""user_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"") LEFT JOIN ""customers"" AS ""d"" ON ""d"".""email""=""c"".""contact_email"" GROUP BY ""a"".""invoice_id"" ORDER BY ""a"".""invoice_id"""
318,"WITH ""temp"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""c1"" LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY ""c1"".""customer_id"") SELECT ""i"".""invoice_id"",""t"".""customer_name"",""i"".""price"",""t"".""contacts_cnt"",""t"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""temp"" AS ""t"" ON ""i"".""user_id""=""t"".""customer_id"" ORDER BY ""i"".""invoice_id"""
319,"WITH ""t"" AS (SELECT ""user_id"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") SELECT ""i"".""invoice_id"",""cus"".""customer_name"",""i"".""price"",COALESCE(""t"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cus"" ON ""i"".""user_id""=""cus"".""customer_id"") LEFT JOIN ""t"" ON ""i"".""user_id""=""t"".""user_id"" ORDER BY 1"
320,"SELECT ""i"".""invoice_id"" AS ""invoice_id"",""cu"".""customer_name"" AS ""customer_name"",""i"".""price"" AS ""price"",COUNT(""con"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""cu"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""cu"".""customer_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
321,"WITH ""price"" AS (SELECT ""invoice_id"",""customer_name"",""price"",""user_id"" FROM ""customers"" AS ""c"" RIGHT JOIN ""invoices"" AS ""i"" ON ""c"".""customer_id""=""i"".""user_id"" GROUP BY ""invoice_id"" ORDER BY ""invoice_id""), ""contact_cnt"" AS (SELECT ""c"".""customer_id"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"" FROM ""customers"" AS ""c"" LEFT JOIN ""contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"" GROUP BY ""user_id""), ""trusted"" AS (SELECT ""user_id"",""contact_name"",COALESCE(COUNT(""contact_name""), 0) AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""price"" AS ""p"" LEFT JOIN ""contact_cnt"" AS ""cc"" ON ""p"".""user_id""=""cc"".""customer_id"") LEFT JOIN ""trusted"" AS ""t"" ON ""p"".""user_id""=""t"".""user_id"""
322,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"" ORDER BY ""i"".""invoice_id"""
323,"SELECT ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"",COALESCE(COUNT(""C2"".""user_id""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""C2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""I"" LEFT JOIN ""Customers"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"") LEFT JOIN ""Contacts"" AS ""C2"" ON ""I"".""user_id""=""C2"".""user_id"" GROUP BY 1 ORDER BY 1"
324,"SELECT ""invoice_id"",""c"".""customer_name"",""i"".""price"",""a"".""contacts_cnt"",COALESCE(""b"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN (SELECT ""customer_name"",COUNT(""user_id"") AS ""contacts_cnt"" FROM ""customers"" AS ""cu"" LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" GROUP BY ""customer_name"") AS ""a"" ON ""c"".""customer_name""=""a"".""customer_name"") LEFT JOIN (SELECT ""customer_name"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""cu"" LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") GROUP BY ""customer_name"") AS ""b"" ON ""a"".""customer_name""=""b"".""customer_name"" ORDER BY ""invoice_id"""
325,"SELECT ""i"".""invoice_id"",""cust"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""contacts"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""trusted_cust"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""cust"" ON ""i"".""user_id""=""cust"".""customer_id"") LEFT JOIN ""contacts"" ON ""i"".""user_id""=""contacts"".""user_id"") LEFT JOIN ""customers"" AS ""trusted_cust"" ON ""contacts"".""contact_email""=""trusted_cust"".""email"" GROUP BY 1,2,3"
326,"WITH ""temp"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""c1"" LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY ""c1"".""customer_id"") SELECT ""i"".""invoice_id"",""t"".""customer_name"",""i"".""price"",""t"".""contacts_cnt"",""t"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""temp"" AS ""t"" ON ""i"".""user_id""=""t"".""customer_id"" ORDER BY ""i"".""invoice_id"""
327,"WITH ""tem"" AS (SELECT ""user_id"",""contact_name"",""contact_email"",CASE WHEN ""contact_email"" IN (SELECT ""email"" AS ""contact_email"" FROM ""customers"") THEN 1 ELSE 0 END AS ""trusted_contact"" FROM ""contacts""), ""tem1"" AS (SELECT ""a"".*,""b"".* FROM ""customers"" AS ""a"" LEFT JOIN ""tem"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id""), ""tem2"" AS (SELECT ""user_id"",""customer_id"",""customer_name"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(""trusted_contact"") AS ""trusted_contacts_cnt"" FROM ""tem1"" GROUP BY ""customer_name"") SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(""b"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""b"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""invoices"" AS ""a"" LEFT JOIN ""tem2"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"" ORDER BY ""invoice_id"""
328,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(CASE WHEN ""c"".""contact_email"" IS NOT NULL THEN ""contact_email"" ELSE NULL END) AS ""contacts_cnt"",COUNT(CASE WHEN ""c"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN ""contact_email"" ELSE NULL END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""a"".""user_id""=""c"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
329,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""ct"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""ct"" ON ""i"".""user_id""=""ct"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
330,"SELECT ""inv"".""invoice_id"",""cus1"".""customer_name"",""inv"".""price"",COUNT(DISTINCT ""con"".""contact_email"") AS ""contacts_cnt"",COUNT(DISTINCT CASE WHEN ""cus2"".""email"" IS NOT NULL THEN ""con"".""contact_email"" END) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""inv"" LEFT JOIN ""Customers"" AS ""cus1"" ON ""inv"".""user_id""=""cus1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""con"" ON ""inv"".""user_id""=""con"".""user_id"") LEFT JOIN ""Customers"" AS ""cus2"" ON ""con"".""contact_email""=""cus2"".""email"" GROUP BY 1,2,3 ORDER BY 1"
331,"WITH ""cte"" AS (SELECT ""co"".""user_id"",COUNT(""co"".""user_id"") AS ""cnt"",COUNT(""cu"".""customer_name"") AS ""trusted_cnt"" FROM ""contacts"" AS ""co"" LEFT JOIN ""customers"" AS ""cu"" ON ""co"".""contact_name""=""cu"".""customer_name"" GROUP BY 1) SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""cte"".""cnt"", 0) AS ""contacts_cnt"",COALESCE(""cte"".""trusted_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""user_id"" ORDER BY 1"
332,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cs"" ON ""cs"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""cn"" ON ""cs"".""customer_id""=""cn"".""user_id"" GROUP BY 1"
333,"SELECT ""a"".""invoice_id"",""a"".""customer_name"",""a"".""price"",(CASE WHEN ""a"".""contacts_cnt"" IS NULL THEN 0 ELSE ""a"".""contacts_cnt"" END) AS ""contacts_cnt"",(CASE WHEN ""b"".""trusted_contacts_cnt"" IS NULL THEN 0 ELSE ""b"".""trusted_contacts_cnt"" END) AS ""trusted_contacts_cnt"" FROM (SELECT ""invoice_id"",""customer_id"",""customer_name"",""price"",COUNT(DISTINCT ""Contacts"".""contact_email"") AS ""contacts_cnt"" FROM (""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_Id""=""Customers"".""customer_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"" GROUP BY ""invoice_id"",""customer_id"",""customer_name"",""price"") AS ""a"" LEFT JOIN (SELECT ""invoice_id"",""customer_id"",""customer_name"",""price"",COUNT(DISTINCT ""Contacts"".""contact_email"") AS ""trusted_contacts_cnt"" FROM (""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_Id""=""Customers"".""customer_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"" WHERE ""Contacts"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") GROUP BY ""invoice_id"",""customer_id"",""customer_name"",""price"") AS ""b"" ON ""a"".""invoice_id""=""b"".""invoice_id"" AND ""a"".""customer_Id""=""b"".""customer_Id"" ORDER BY ""a"".""invoice_id"""
334,"SELECT ""i"".""invoice_id"",""cx"".""customer_name"",""i"".""price"",COALESCE(COUNT(""c"".""contact_email""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cx"" ON ""i"".""user_id""=""cx"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""cx"".""customer_id""=""c"".""user_id"" GROUP BY 1,2 ORDER BY 1"
335,"SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""invoices"" JOIN (SELECT ""customers"".""customer_id"",""customers"".""customer_name"",""customers"".""email"",COALESCE(COUNT(DISTINCT ""con"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(COUNT(DISTINCT ""trust"".""email""), 0) AS ""trusted_contacts_cnt"" FROM (""customers"" LEFT JOIN ""contacts"" AS ""con"" ON ""customers"".""customer_id""=""con"".""user_id"") LEFT JOIN ""customers"" AS ""trust"" ON ""con"".""contact_name""=""trust"".""customer_name"" AND ""con"".""contact_email""=""trust"".""email"" GROUP BY 1,2,3) AS ""x"" ON ""invoices"".""user_id""=""x"".""customer_id"" ORDER BY 1"
336,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""co"".""contact_name""), 0) AS ""contacts_cnt"",COALESCE(COUNT(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE NULL END), 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""co"".""user_id""=""c"".""customer_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
337,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(DISTINCT (""co"".""contact_name"")) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT (""customer_name"") FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""co"".""user_id""=""c"".""customer_id"" GROUP BY ""invoice_id"",""customer_name"",""price"" ORDER BY ""invoice_id"""
338,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""customers"" LEFT JOIN ""contacts"" ON ""customers"".""customer_id""=""user_id"") JOIN ""invoices"" ON ""invoices"".""user_id""=""customers"".""customer_id"" GROUP BY ""invoice_id"",""customer_name"" ORDER BY ""invoice_id"""
339,"SELECT DISTINCT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN (""t"".""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"")) THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""t"".""user_id""=""c"".""customer_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
340,"WITH ""AllContacts"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id""), ""TrustedContacts"" AS (SELECT ""C"".""user_id"",COALESCE(COUNT(""Cus"".""customer_id""), 0) AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""C"" LEFT JOIN ""Customers"" AS ""Cus"" ON ""C"".""contact_name""=""Cus"".""customer_name"" GROUP BY ""C"".""user_id"") SELECT ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"",COALESCE(""AC"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""TC"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I"" JOIN ""Customers"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"") LEFT JOIN ""AllContacts"" AS ""AC"" ON ""AC"".""user_id""=""I"".""user_id"") LEFT JOIN ""TrustedContacts"" AS ""TC"" ON ""TC"".""user_id""=""I"".""user_id"" ORDER BY 1"
341,"WITH ""contact_info"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contact_count"",SUM(""contact_email"" IN (SELECT ""email"" FROM ""customers"")) AS ""trusted_count"" FROM ""contacts"" GROUP BY ""user_id"") SELECT ""i"".""invoice_id"",""c2"".""customer_name"",""i"".""price"",COALESCE(""c1"".""contact_count"", 0) AS ""contacts_cnt"",COALESCE(""c1"".""trusted_count"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""contact_info"" AS ""c1"" ON ""i"".""user_id""=""c1"".""user_id"") LEFT JOIN ""Customers"" AS ""c2"" ON ""c2"".""customer_id""=""i"".""user_id"" ORDER BY ""i"".""invoice_id"""
342,"WITH ""cont_count"" AS (SELECT ""user_id"",COUNT(1) AS ""ct_count"" FROM ""contacts"" GROUP BY ""user_id""), ""trust_cont_count"" AS (SELECT ""ct"".""user_id"",COUNT(1) AS ""trust_ct_count"" FROM ""contacts"" AS ""ct"" JOIN ""customers"" AS ""cm"" ON ""ct"".""contact_name""=""cm"".""customer_name"" AND ""ct"".""contact_email""=""cm"".""email"" GROUP BY ""ct"".""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""c_ct"".""ct_count"", 0) AS ""contacts_cnt"",COALESCE(""t_ct"".""trust_ct_count"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cont_count"" AS ""c_ct"" ON ""i"".""user_id""=""c_ct"".""user_id"") LEFT JOIN ""trust_cont_count"" AS ""t_ct"" ON ""i"".""user_id""=""t_ct"".""user_id"" ORDER BY ""i"".""invoice_id"""
343,"SELECT ""i"".""invoice_id"",""cm"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""ct"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cm"" ON ""i"".""user_id""=""cm"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""i"".""user_id""=""ct"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY 1"
344,"WITH ""cte1"" AS (SELECT ""con"".""user_id"",""con"".""contact_name"",CASE WHEN ""cus"".""customer_name"" IS NULL THEN 0 ELSE 1 END AS ""trusted"" FROM ""Contacts"" AS ""con"" LEFT JOIN ""Customers"" AS ""cus"" ON ""con"".""contact_name""=""cus"".""customer_name"") SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_name"") AS ""contacts_cnt"",COALESCE(SUM(""trusted""), 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""cte1"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"" GROUP BY ""invoice_id"",""customer_name"",""price"" ORDER BY ""invoice_id"""
345,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COUNT(""c"".""contact_name"") AS ""contacts_cnt"",COUNT(CASE WHEN ""d"".""customer_name"" IS NOT NULL THEN ""c"".""contact_name"" ELSE NULL END) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""a"" JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"") LEFT JOIN ""Customers"" AS ""d"" ON ""c"".""contact_name""=""d"".""customer_name"" AND ""c"".""contact_email""=""d"".""email"" GROUP BY ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"" ORDER BY ""a"".""invoice_id"""
346,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_name"") AS ""contacts_cnt"",COALESCE(""tco"".""trusted_count"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"") LEFT JOIN (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_count"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""customers"") GROUP BY ""user_id"") AS ""tco"" ON ""tco"".""user_id""=""cu"".""customer_id"" GROUP BY 1,2,3 ORDER BY ""i"".""invoice_id"""
347,"SELECT ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"",COUNT(""Con"".""user_id"") AS ""contacts_cnt"",COUNT(""C1"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I"" JOIN ""Customers"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"") LEFT JOIN ""Contacts"" AS ""Con"" ON ""C"".""customer_id""=""Con"".""user_id"") LEFT JOIN ""Customers"" AS ""C1"" ON ""C1"".""email""=""Con"".""contact_email"" GROUP BY ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"" ORDER BY ""I"".""invoice_id"""
348,"WITH ""tmp"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" JOIN ""customers"" ON ""user_id""=""customer_id"") LEFT JOIN ""tmp"" ON ""customer_id""=""tmp"".""user_id"" ORDER BY 1"
349,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
350,"SELECT ""i"".""invoice_id"",MAX(""c"".""customer_name"") AS ""customer_name"",MAX(""i"".""price"") AS ""price"",COUNT(DISTINCT ""a"".""contact_name"") AS ""contacts_cnt"",COALESCE(COUNT(CASE WHEN ""a"".""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN ""c"".""customer_name"" END), 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""a"" ON ""c"".""customer_id""=""a"".""user_id"" GROUP BY 1 ORDER BY 1"
351,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COUNT(DISTINCT ""c"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"" GROUP BY ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"""
352,"SELECT ""t1"".""invoice_id"",""t2"".""customer_name"",""t1"".""price"",COUNT(""t3"".""user_id"") AS ""contacts_cnt"",COUNT(""t4"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""t1"" JOIN ""customers"" AS ""t2"" ON ""t2"".""customer_id""=""t1"".""user_id"") LEFT JOIN ""contacts"" AS ""t3"" ON ""t3"".""user_id""=""t2"".""customer_id"") LEFT JOIN ""customers"" AS ""t4"" ON ""t4"".""email""=""t3"".""contact_email"" GROUP BY ""t1"".""invoice_id"",""t2"".""customer_name"",""t1"".""price"" ORDER BY ""t1"".""invoice_id"""
353,"WITH ""t1"" AS (SELECT ""invoice_id"",""customer_id"",""customer_name"",""price"" FROM ""invoices"" AS ""a"" LEFT JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id""), ""t2"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""relates"",COUNT(CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") THEN 1 END) AS ""trusts"" FROM ""contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""t1"".""customer_name"",""price"",COALESCE(""relates"", 0) AS ""contacts_cnt"",COALESCE(""trusts"", 0) AS ""trusted_contacts_cnt"" FROM ""t1"" LEFT JOIN ""t2"" ON ""t1"".""customer_id""=""t2"".""user_id"" ORDER BY ""invoice_id"""
354,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""ct"".""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""c"".""customer_id""=""ct"".""user_id"" GROUP BY ""c"".""customer_name"",""i"".""invoice_id"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
355,"WITH ""ncontacts"" AS (SELECT ""customer_id"",COUNT(""contact_email"") AS ""countact_cnt"" FROM ""customers"" AS ""cus"" JOIN ""contacts"" AS ""con"" ON ""cus"".""customer_id""=""con"".""user_id"" GROUP BY ""customer_id""), ""t"" AS (SELECT ""customer_id"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""customers"" AS ""cus"" JOIN ""contacts"" AS ""con"" ON ""cus"".""customer_id""=""con"".""user_id"" AND ""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY ""customer_id"") SELECT ""invoice_id"",""cus"".""customer_name"",""price"",COALESCE(""countact_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""cus"" ON ""i"".""user_id""=""cus"".""customer_id"") LEFT JOIN ""ncontacts"" ON ""i"".""user_id""=""ncontacts"".""customer_id"") LEFT JOIN ""t"" ON ""i"".""user_id""=""t"".""customer_id"" ORDER BY ""invoice_id"""
356,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""Contacts"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""Contacts"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN ""Contacts"" ON ""Customers"".""customer_id""=""Contacts"".""user_id"" GROUP BY ""Invoices"".""invoice_id"",""customer_name"" ORDER BY ""Invoices"".""invoice_id"""
357,"WITH ""TC"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""user_id""), ""CC"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") SELECT ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"",COALESCE(""CC"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""TC"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I"" LEFT JOIN ""Customers"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"") LEFT JOIN ""CC"" ON ""I"".""user_id""=""CC"".""user_id"") LEFT JOIN ""TC"" ON ""I"".""user_id""=""TC"".""user_id"" ORDER BY ""I"".""invoice_id"""
358,"WITH ""temp"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""c1"" LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY ""c1"".""customer_id"") SELECT ""i"".""invoice_id"",""t"".""customer_name"",""i"".""price"",""t"".""contacts_cnt"",""t"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" JOIN ""temp"" AS ""t"" ON ""i"".""user_id""=""t"".""customer_id"" ORDER BY ""i"".""invoice_id"""
359,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"""
360,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(DISTINCT ""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" LEFT JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN ""Contacts"" USING (""user_id"") GROUP BY ""invoice_id"",""customer_name"",""price"" ORDER BY ""invoice_id"""
361,"WITH ""contact_count"" AS (SELECT ""user_id"" AS ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") SELECT ""a"".""invoice_id"" AS ""invoice_id"",""b"".""customer_name"" AS ""customer_name"",""a"".""price"" AS ""price"",COALESCE(""c"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""c"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""contact_count"" AS ""c"" ON ""a"".""user_id""=""c"".""user_id"" ORDER BY ""invoice_id"""
362,"WITH ""t1"" AS (SELECT ""ct"".""user_id"",COUNT(""ct"".""contact_name"") AS ""contacts_cnt"",COUNT(""c"".""email"") AS ""trusted_contacts_cnt"" FROM ""contacts"" AS ""ct"" LEFT JOIN ""customers"" AS ""c"" ON ""ct"".""contact_email""=""c"".""email"" GROUP BY 1), ""t2"" AS (SELECT ""c"".""customer_id"",""c"".""customer_name"",""i"".""invoice_id"",""i"".""price"" FROM ""customers"" AS ""c"" JOIN ""invoices"" AS ""i"" ON ""i"".""user_id""=""c"".""customer_id"") SELECT ""t2"".""invoice_id"",""t2"".""customer_name"",""t2"".""price"",COALESCE(""t1"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t1"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""t2"" LEFT JOIN ""t1"" ON ""t2"".""customer_id""=""t1"".""user_id"" ORDER BY 1"
363,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(""c"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""d"".""contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""a"" LEFT JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN (SELECT DISTINCT ""user_id"",COUNT(""user_id"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id"") AS ""c"" ON ""a"".""user_id""=""c"".""user_id"") LEFT JOIN (SELECT DISTINCT ""user_id"",COUNT(""user_id"") AS ""contacts_cnt"" FROM ""Contacts"" WHERE ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") GROUP BY ""user_id"") AS ""d"" ON ""a"".""user_id""=""d"".""user_id"" ORDER BY ""a"".""invoice_id"""
364,"SELECT ""c"".""invoice_id"",""a"".""customer_name"",""c"".""price"",COUNT(""b"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""d"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""c"" LEFT JOIN ""Customers"" AS ""a"" ON ""a"".""customer_id""=""c"".""user_id"") LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"") LEFT JOIN ""Customers"" AS ""d"" ON ""b"".""contact_name""=""d"".""customer_name"" GROUP BY 1,2,3"
365,"SELECT ""i"".""invoice_id"",""us"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_name"") AS ""contacts_cnt"",COUNT(""cu"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Contacts"" AS ""co"" ON ""i"".""user_id""=""co"".""user_id"") LEFT JOIN ""Customers"" AS ""cu"" ON ""co"".""contact_name""=""cu"".""customer_name"") LEFT JOIN ""Customers"" AS ""us"" ON ""us"".""customer_id""=""i"".""user_id"" GROUP BY 1,2,3 ORDER BY ""i"".""invoice_id"""
366,"WITH ""cte_join_contacts"" AS (SELECT ""invoice_id"",""cu"".""customer_name"",""price"",""contact_name"",""contact_email"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""i"".""user_id""=""cont"".""user_id""), ""cte_contacts_agg"" AS (SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_email"") AS ""contacts_cnt"" FROM ""cte_join_contacts"" GROUP BY 1,2,3), ""cte_trusted_contacts_agg"" AS (SELECT ""invoice_id"",""c1"".""customer_name"",""price"",COUNT(""contact_email"") AS ""trusted_contacts_cnt"" FROM ""cte_join_contacts"" AS ""c1"" JOIN ""Customers"" AS ""c2"" ON ""c1"".""contact_email""=""c2"".""email"" GROUP BY 1,2,3), ""cte_assemble"" AS (SELECT ""c"".""invoice_id"",""c"".""customer_name"",""c"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte_contacts_agg"" AS ""c"" LEFT JOIN ""cte_trusted_contacts_agg"" AS ""tc"" ON ""c"".""invoice_id""=""tc"".""invoice_id"" AND ""c"".""customer_name""=""tc"".""customer_name"" ORDER BY 1) SELECT * FROM ""cte_assemble"""
367,"SELECT DISTINCT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_name"") OVER (PARTITION BY ""i"".""invoice_id"") AS ""contacts_cnt"",COUNT(CASE WHEN ""co"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE NULL END) OVER (PARTITION BY ""i"".""invoice_id"") AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""cu"" JOIN ""Invoices"" AS ""i"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""i"".""user_id""=""co"".""user_id"" ORDER BY ""i"".""invoice_id"""
368,"SELECT ""a"".""invoice_id"",""customer_name"",""price"",""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (SELECT ""invoice_id"",""customer_name"",""price"",COUNT(DISTINCT (""co"".""contact_name"")) AS ""contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""co"".""user_id""=""c"".""customer_id"" GROUP BY ""invoice_id"",""customer_name"",""price"" ORDER BY ""invoice_id"") AS ""a"" LEFT JOIN (SELECT ""invoice_id"",COUNT(DISTINCT (""c"".""contact_name"")) AS ""trusted_contacts_cnt"" FROM ""invoices"" AS ""i"" LEFT JOIN ""contacts"" AS ""c"" ON ""c"".""user_id""=""i"".""user_id"" WHERE ""c"".""contact_name"" IN (SELECT DISTINCT (""customer_name"") FROM ""customers"") GROUP BY ""invoice_id"") AS ""b"" ON ""a"".""invoice_id""=""b"".""invoice_id"""
369,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"""
370,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""c2"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY 1 ORDER BY 1"
371,"WITH ""cte"" AS (SELECT ""i"".""invoice_id"",""c"".""customer_name"",""user_id"",""i"".""price"" FROM ""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id""), ""cte2"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""c"" LEFT JOIN ""Customers"" AS ""cu"" ON ""c"".""contact_name""=""cu"".""customer_name"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte"" LEFT JOIN ""cte2"" USING (""user_id"") ORDER BY ""invoice_id"""
372,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
373,"WITH ""cte"" AS (SELECT ""user_id"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contacts"".""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""contacts"" GROUP BY ""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cte"" ON ""cte"".""user_id""=""i"".""user_id"" ORDER BY ""invoice_id"""
374,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(COUNT(""c"".""user_id""), 0) AS ""contacts_cnt"",COALESCE(SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END), 0) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""ct"" JOIN ""Invoices"" AS ""i"" ON ""i"".""user_id""=""ct"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""ct"".""customer_id""=""c"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
375,"SELECT ""i"".""invoice_id"",""cust"".""customer_name"",""i"".""price"",COUNT(""cont"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""cont"".""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cust"" ON ""i"".""user_id""=""cust"".""customer_id"") LEFT JOIN ""Contacts"" AS ""cont"" ON ""i"".""user_id""=""cont"".""user_id"" GROUP BY 1,2,3 ORDER BY ""i"".""invoice_id"""
376,"SELECT ""invoice_id"",""cs"".""customer_name"",""price"",COUNT(""c"".""contact_name"") AS ""contacts_cnt"",COUNT(""c2"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" JOIN ""customers"" AS ""cs"" ON ""invoices"".""user_id""=""cs"".""customer_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""cs"".""customer_id""=""c"".""user_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""customer_name""=""c"".""contact_name"" GROUP BY 1 ORDER BY 1"
377,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""co"".""user_id""), 0) AS ""contacts_cnt"",COALESCE(SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END), 0) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""c"" JOIN ""Invoices"" AS ""i"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
378,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""price"",COUNT(""t"".""user_id"") AS ""contacts_cnt"",COUNT(DISTINCT ""e"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""t"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Customers"" AS ""e"" ON ""e"".""email""=""t"".""contact_email"" GROUP BY 1,2,3 ORDER BY 1"
379,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contacts"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contacts"".""contact_email"" IN (SELECT ""customers"".""email"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" LEFT JOIN ""customers"" ON ""customers"".""customer_id""=""invoices"".""user_id"") LEFT JOIN ""contacts"" ON ""contacts"".""user_id""=""customers"".""customer_id"" GROUP BY 1 ORDER BY 1"
380,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""co"".""user_id"") AS ""contacts_cnt"",SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
381,"WITH ""cnt"" AS (SELECT ""t"".""user_id"",COUNT(1) AS ""contacts_cnt"",SUM(""trusted"") AS ""trusted_contacts_cnt"" FROM (SELECT ""ct"".*,CASE WHEN ""cm"".""email"" IS NULL THEN 0 ELSE 1 END AS ""trusted"" FROM ""contacts"" AS ""ct"" LEFT JOIN ""customers"" AS ""cm"" ON ""ct"".""contact_email""=""cm"".""email"") AS ""t"" GROUP BY ""t"".""user_id"") SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""cnt"" ON ""i"".""user_id""=""cnt"".""user_id"" ORDER BY ""i"".""invoice_id"""
382,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
383,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""t"".""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""t"" ON ""i"".""user_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
384,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
385,"SELECT ""invoice_id"",""c"".""customer_name"",""price"",SUM(CASE WHEN ""contact_name"" IS NULL THEN 0 ELSE 1 END) AS ""contacts_cnt"",SUM(CASE WHEN ""trusted""='Y' THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM ""Invoices"" AS ""d"" LEFT JOIN (SELECT ""customer_id"",""customer_name"",""contact_name"",(SELECT 'Y' FROM ""Customers"" WHERE ""customer_name""=""b"".""contact_name"") AS ""trusted"" FROM ""Customers"" AS ""a"" LEFT JOIN ""Contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"") AS ""c"" ON ""d"".""user_id""=""c"".""customer_id"" GROUP BY ""invoice_id"",""c"".""customer_name"" ORDER BY ""invoice_id"""
386,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"""
387,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
388,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" GROUP BY ""invoice_id"",""customer_name"" ORDER BY ""invoice_id"""
389,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COALESCE(COUNT(""co"".""user_id""), 0) AS ""contacts_cnt"",COALESCE(SUM(CASE WHEN ""co"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END), 0) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""c"" JOIN ""Invoices"" AS ""i"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
390,"WITH ""cte"" AS (SELECT ""cu"".""customer_id"",""cu"".""customer_name"",""i"".""invoice_id"",""i"".""price"",""i"".""user_id"" FROM ""Customers"" AS ""cu"" JOIN ""Invoices"" AS ""i"" ON ""cu"".""customer_id""=""i"".""user_id""), ""cte2"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""customer_name"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""co"" LEFT JOIN ""Customers"" AS ""cu"" ON ""cu"".""customer_name""=""co"".""contact_name"" GROUP BY ""co"".""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ""cte"" LEFT JOIN ""cte2"" USING (""user_id"") ORDER BY ""invoice_id"""
391,"SELECT ""i"".""invoice_id"",""us"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_name"") AS ""contacts_cnt"",COUNT(""cu"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Contacts"" AS ""co"" ON ""i"".""user_id""=""co"".""user_id"") LEFT JOIN ""Customers"" AS ""cu"" ON ""co"".""contact_name""=""cu"".""customer_name"") LEFT JOIN ""Customers"" AS ""us"" ON ""us"".""customer_id""=""i"".""user_id"" GROUP BY 1,2,3 ORDER BY ""i"".""invoice_id"""
392,"SELECT ""invoice_id"",""customer_name"",""price"",COUNT(DISTINCT (""co"".""contact_name"")) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT (""customer_name"") FROM ""customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""co"".""user_id""=""c"".""customer_id"" GROUP BY ""invoice_id"",""customer_name"",""price"" ORDER BY ""invoice_id"""
393,"WITH ""cte1"" AS (SELECT ""customer_id"",COUNT(DISTINCT ""contact_name"") AS ""num1"" FROM ""Customers"" JOIN ""Contacts"" ON ""Contacts"".""user_id""=""Customers"".""customer_id"" GROUP BY ""customer_id""), ""cte2"" AS (SELECT ""customer_id"",COUNT(DISTINCT ""contact_name"") AS ""num2"" FROM ""Customers"" JOIN ""Contacts"" ON ""Contacts"".""user_id""=""Customers"".""customer_id"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""customer_id"") SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(""cte1"".""num1"", 0) AS ""contacts_cnt"",COALESCE(""cte2"".""num2"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" LEFT JOIN ""Customers"" ON ""Invoices"".""user_id""=""Customers"".""customer_id"") LEFT JOIN ""cte1"" ON ""Invoices"".""user_id""=""cte1"".""customer_id"") LEFT JOIN ""cte2"" ON ""Invoices"".""user_id""=""cte2"".""customer_id"" ORDER BY 1"
394,"SELECT ""invoice_id"",""customer_name"",""price"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"" GROUP BY 1,""cu"".""customer_id"" ORDER BY 1"
395,"WITH ""t1"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"" FROM ""contacts"" GROUP BY 1), ""t2"" AS (SELECT ""user_id"",COUNT(1) AS ""trusted_contacts_cnt"" FROM ""contacts"" WHERE ""contact_email"" IN (SELECT ""email"" FROM ""customers"") GROUP BY 1) SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COALESCE(""t1"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""t2"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""t1"" ON ""a"".""user_id""=""t1"".""user_id"") LEFT JOIN ""t2"" ON ""a"".""user_id""=""t2"".""user_id"" ORDER BY 1"
396,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(""c"".""contact_name"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c1"" ON ""c1"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c"".""contact_name""=""c2"".""customer_name"" GROUP BY 1,2,3 ORDER BY 1"
397,"WITH ""tb1"" AS (SELECT ""user_id"",""contact_name"",""contact_email"",CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END AS ""trustContactFlag"" FROM ""Contacts""), ""tb2"" AS (SELECT ""C2"".""customer_id"",""C2"".""customer_name"",COUNT(""C1"".""contact_email"") AS ""contacts_cnt"",COALESCE(SUM(""C1"".""trustContactFlag""), 0) AS ""trusted_contacts_cnt"" FROM ""tb1"" AS ""C1"" RIGHT JOIN ""Customers"" AS ""C2"" ON ""C1"".""user_id""=""C2"".""customer_id"" GROUP BY ""C2"".""customer_id"") SELECT ""invoice_id"",""C"".""customer_name"",""price"",""C"".""contacts_cnt"",""C"".""trusted_contacts_cnt"" FROM ""Invoices"" AS ""I"" LEFT JOIN ""tb2"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"" ORDER BY ""invoice_id"""
398,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
399,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",""c"".""contacts_cnt"",""c"".""trusted_contacts_cnt"" FROM (SELECT ""a"".*,COALESCE(""b"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM (SELECT ""cus"".""customer_id"",""cus"".""customer_name"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"" FROM ""Customers"" AS ""cus"" LEFT JOIN ""Contacts"" AS ""con"" ON ""cus"".""customer_id""=""con"".""user_id"" GROUP BY ""cus"".""customer_id"") AS ""a"" LEFT JOIN (SELECT ""customer_id"",""customer_name"",COALESCE(COUNT(""contact_name""), 0) AS ""trusted_contacts_cnt"" FROM ""Customers"" AS ""cus"" LEFT JOIN ""Contacts"" AS ""con"" ON ""cus"".""customer_id""=""con"".""user_id"" WHERE ""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") GROUP BY ""customer_id"") AS ""b"" ON ""a"".""customer_id""=""b"".""customer_id"") AS ""c"" RIGHT JOIN ""Invoices"" AS ""i"" ON ""i"".""user_id""=""c"".""customer_id"" ORDER BY ""invoice_id"""
400,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(""co"".""contact_email"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""c1"".""customer_id""=""co"".""user_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""co"".""contact_email""=""c2"".""email"" GROUP BY 1,2,3 ORDER BY 1"
401,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""c"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""cu"".""customer_id""=""c"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
402,"WITH ""contacts_cnt"" AS (SELECT ""user_id"",COUNT(1) AS ""contacts_cnt"" FROM ""contacts"" GROUP BY 1), ""trusted_contacts_cnt"" AS (SELECT ""user_id"",SUM((CASE WHEN ""customer_name"" IS NULL THEN 0 ELSE 1 END)) AS ""trusted_contacts_cnt"" FROM ""contacts"" LEFT JOIN ""customers"" ON ""contacts"".""contact_name""=""customers"".""customer_name"" AND ""contacts"".""contact_email""=""customers"".""email"" GROUP BY 1) SELECT ""I"".""invoice_id"",""C"".""customer_name"",""I"".""price"",COALESCE(""CC"".""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""TCC"".""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""I"" JOIN ""customers"" AS ""C"" ON ""I"".""user_id""=""C"".""customer_id"") LEFT JOIN ""contacts_cnt"" AS ""CC"" ON ""C"".""customer_id""=""CC"".""user_id"") LEFT JOIN ""trusted_contacts_cnt"" AS ""TCC"" ON ""C"".""customer_id""=""TCC"".""user_id"" ORDER BY ""I"".""invoice_id"""
403,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""t"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_name"" IN (SELECT DISTINCT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""c"".""customer_id""=""t"".""user_id"" GROUP BY ""i"".""invoice_id"""
404,"WITH ""cte_contacts_cnt"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_email"") AS ""contacts_cnt"" FROM ""Contacts"" GROUP BY ""user_id""), ""cte_trusted_contacts_cnt"" AS (SELECT ""user_id"",COUNT(DISTINCT ""contact_email"") AS ""trusted_contacts_cnt"" FROM ""Contacts"" AS ""c1"" WHERE ""c1"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") GROUP BY ""user_id"") SELECT ""i"".""invoice_id"",""customer_name"",""price"",COALESCE(""contacts_cnt"", 0) AS ""contacts_cnt"",COALESCE(""trusted_contacts_cnt"", 0) AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" ON ""i"".""user_id""=""customer_id"") LEFT JOIN ""cte_contacts_cnt"" AS ""cte1"" ON ""i"".""user_id""=""cte1"".""user_id"") LEFT JOIN ""cte_trusted_contacts_cnt"" AS ""cte2"" ON ""i"".""user_id""=""cte2"".""user_id"" ORDER BY ""invoice_id"""
405,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""co"".""contact_email"") AS ""contacts_cnt"",COUNT(DISTINCT ""c2"".""customer_id"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""Contacts"" AS ""co"" ON ""c"".""customer_id""=""co"".""user_id"") LEFT JOIN ""Customers"" AS ""c2"" ON ""co"".""contact_name""=""c2"".""customer_name"" AND ""co"".""contact_email""=""c2"".""email"" GROUP BY 1,2,3 ORDER BY 1"
406,"SELECT DISTINCT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""t"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN (""t"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"")) THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""t"".""user_id""=""c"".""customer_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
407,"WITH ""t1"" AS (SELECT ""customer_id"",""customer_name"",COUNT(""contact_email"") AS ""cnt1"" FROM ""customers"" AS ""a"" LEFT JOIN ""contacts"" AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"" GROUP BY 1), ""t2"" AS (SELECT ""customer_id"",COALESCE(""cnt2"", 0) AS ""cnt2"" FROM ""customers"" AS ""a"" LEFT JOIN (SELECT ""user_id"",COUNT(""contact_email"") AS ""cnt2"" FROM ""contacts"" WHERE ROW(""contact_name"",""contact_email"") IN (SELECT ""customer_name"",""email"" FROM ""customers"") GROUP BY 1) AS ""b"" ON ""a"".""customer_id""=""b"".""user_id"") SELECT ""invoice_id"",""customer_name"",""price"",""cnt1"" AS ""contacts_cnt"",""cnt2"" AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""a"" JOIN ""t1"" ON ""a"".""user_id""=""t1"".""customer_id"") JOIN ""t2"" ON ""a"".""user_id""=""t2"".""customer_id"" ORDER BY 1"
408,"WITH ""CTE1"" AS (SELECT ""Contacts"".*,(CASE WHEN ""Contacts"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""cust_count"" FROM ""Contacts""), ""CTE1a"" AS (SELECT ""user_id"",SUM(""cust_count"") AS ""cc_count"" FROM ""CTE1"" GROUP BY ""user_id""), ""CTE2"" AS (SELECT ""user_id"" AS ""customer_id"",COUNT(""user_id"") AS ""num_of_contacts"" FROM ""Contacts"" GROUP BY 1 ORDER BY 1) SELECT DISTINCT ""i"".""invoice_id"" AS ""invoice_id"",""c"".""customer_name"" AS ""customer_name"",""i"".""price"" AS ""price"",COALESCE(""CTE2"".""num_of_contacts"", 0) AS ""contacts_cnt"",COALESCE(""CTE1a"".""cc_count"", 0) AS ""trusted_contacts_cnt"" FROM (((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" ON ""c"".""customer_id""=""Contacts"".""user_id"") LEFT JOIN ""CTE2"" ON ""Contacts"".""user_id""=""CTE2"".""customer_id"") LEFT JOIN ""CTE1a"" ON ""Contacts"".""user_id""=""CTE1a"".""user_id"" ORDER BY 1"
409,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COUNT(""c"".""contact_name"") AS ""contacts_cnt"",COUNT(""d"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""a"" JOIN ""customers"" AS ""b"" ON ""b"".""customer_id""=""a"".""user_id"") LEFT JOIN ""contacts"" AS ""c"" ON ""b"".""customer_id""=""c"".""user_id"") LEFT JOIN ""customers"" AS ""d"" ON ""d"".""email""=""c"".""contact_email"" GROUP BY ""a"".""invoice_id"" ORDER BY ""a"".""invoice_id"""
410,"WITH ""cte"" AS (SELECT *,CASE WHEN ""contact_name"" IN (SELECT ""customer_name"" FROM ""customers"") AND ""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN 1 ELSE 0 END AS ""ref"" FROM ""contacts""), ""cte1"" AS (SELECT ""i"".""invoice_id"",""i"".""price"",""i"".""user_id"",""c"".""ref"" AS ""ref"" FROM ""invoices"" AS ""i"" LEFT JOIN ""cte"" AS ""c"" ON ""i"".""user_id""=""c"".""user_id"") SELECT ""cte1"".""invoice_id"",""c"".""customer_name"",""cte1"".""price"",COUNT(""ref"") AS ""contacts_cnt"",COALESCE(SUM(""ref""), 0) AS ""trusted_contacts_cnt"" FROM ""cte1"" JOIN ""customers"" AS ""c"" ON ""cte1"".""user_id""=""c"".""customer_id"" GROUP BY 1,2,3 ORDER BY ""invoice_id"""
411,"SELECT ""i"".""invoice_id"",""cu"".""customer_name"",""i"".""price"",COUNT(""c"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""c"".""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" ON ""cu"".""customer_id""=""c"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
412,"SELECT ""i"".""invoice_id"",""cm"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""ct"".""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""ct"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""cm"" ON ""i"".""user_id""=""cm"".""customer_id"") LEFT JOIN ""Contacts"" AS ""ct"" ON ""i"".""user_id""=""ct"".""user_id"" GROUP BY ""i"".""invoice_id"" ORDER BY 1"
413,"SELECT ""t2"".""invoice_id"",""t1"".""customer_name"",""t2"".""price"",COALESCE(COUNT(""t3"".""user_id""), 0) AS ""contacts_cnt"",COALESCE(SUM(CASE WHEN ""t3"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END), 0) AS ""trusted_contacts_cnt"" FROM (""Customers"" AS ""t1"" JOIN ""Invoices"" AS ""t2"" ON ""t1"".""customer_id""=""t2"".""user_id"") LEFT JOIN ""Contacts"" AS ""t3"" ON ""t1"".""customer_id""=""t3"".""user_id"" GROUP BY ""t2"".""invoice_id"",""t1"".""customer_name"",""t2"".""price"" ORDER BY ""t2"".""invoice_id"""
414,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""con"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""tc"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" LEFT JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""con"" ON ""c"".""customer_id""=""con"".""user_id"") LEFT JOIN ""Customers"" AS ""tc"" ON ""con"".""contact_name""=""tc"".""customer_name"" GROUP BY ""i"".""invoice_id"" ORDER BY ""i"".""invoice_id"""
415,"SELECT ""a"".""invoice_id"",""b"".""customer_name"",""a"".""price"",COUNT(""contact_email"") AS ""contacts_cnt"",SUM(CASE WHEN ""contact_email"" IN (SELECT DISTINCT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""a"" JOIN ""Customers"" AS ""b"" ON ""a"".""user_id""=""b"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c"" USING (""user_id"") GROUP BY 1,2,3 ORDER BY 1"
416,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
417,"SELECT ""i"".""invoice_id"",""customer_name"",""i"".""price"",COUNT(""co"".""user_id"") AS ""contacts_cnt"",COUNT(CASE WHEN ""contact_email"" IN (SELECT ""email"" FROM ""customers"") THEN ""contact_email"" END) AS ""trusted_contacts_cnt"" FROM (""invoices"" AS ""i"" LEFT JOIN ""customers"" AS ""cu"" ON ""i"".""user_id""=""cu"".""customer_id"") LEFT JOIN ""contacts"" AS ""co"" ON ""i"".""user_id""=""co"".""user_id"" GROUP BY 1,2,3 ORDER BY 1"
418,"SELECT ""invoice_id"",""t2"".""customer_name"",""price"",COUNT(DISTINCT ""t3"".""contact_name"") AS ""contacts_cnt"",COUNT(DISTINCT ""t4"".""customer_name"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""t1"" LEFT JOIN ""Customers"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""customer_id"") LEFT JOIN ""Contacts"" AS ""t3"" ON ""t1"".""user_id""=""t3"".""user_id"") LEFT JOIN ""Customers"" AS ""t4"" ON ""t3"".""contact_name""=""t4"".""customer_name"" GROUP BY 1,2,3"
419,"SELECT ""i"".""invoice_id"",""c1"".""customer_name"",""i"".""price"",COUNT(DISTINCT ""c2"".""contact_name"") AS ""contacts_cnt"",SUM(CASE WHEN ""c2"".""contact_email"" IN (SELECT ""email"" FROM ""Customers"") THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c1"" ON ""i"".""user_id""=""c1"".""customer_id"") LEFT JOIN ""Contacts"" AS ""c2"" ON ""c1"".""customer_id""=""c2"".""user_id"" GROUP BY 1 ORDER BY 1"
420,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"",COUNT(""con"".""user_id"") AS ""contacts_cnt"",COUNT(""c2"".""email"") AS ""trusted_contacts_cnt"" FROM ((""invoices"" AS ""i"" JOIN ""customers"" AS ""c"" ON ""c"".""customer_id""=""i"".""user_id"") LEFT JOIN ""contacts"" AS ""con"" ON ""con"".""user_id""=""c"".""customer_id"") LEFT JOIN ""customers"" AS ""c2"" ON ""c2"".""email""=""con"".""contact_email"" GROUP BY ""i"".""invoice_id"",""c"".""customer_name"",""i"".""price"" ORDER BY ""i"".""invoice_id"""
421,"WITH ""cte"" AS (SELECT ""customer_id"",""customer_name"",COALESCE(COUNT(""contact_name""), 0) AS ""contacts_cnt"",SUM(CASE WHEN ""trusted""='yes' THEN 1 ELSE 0 END) AS ""trusted_contacts_cnt"" FROM (SELECT ""cu"".""customer_id"",""cu"".""customer_name"",""co"".""contact_name"",(CASE WHEN ""co"".""contact_name"" IN (SELECT ""customer_name"" FROM ""Customers"") THEN 'yes' ELSE 'no' END) AS ""trusted"" FROM ""Customers"" AS ""cu"" LEFT JOIN ""Contacts"" AS ""co"" ON ""cu"".""customer_id""=""co"".""user_id"") AS ""t"" GROUP BY ""customer_name"") SELECT ""invoice_id"",""customer_name"",""price"",""contacts_cnt"",""trusted_contacts_cnt"" FROM ""Invoices"" AS ""i"" LEFT JOIN ""cte"" ON ""i"".""user_id""=""cte"".""customer_id"" ORDER BY ""invoice_id"""
422,"SELECT ""i"".""invoice_id"",""c"".""customer_name"",""price"",COUNT(""t"".""user_id"") AS ""contacts_cnt"",COUNT(DISTINCT ""e"".""email"") AS ""trusted_contacts_cnt"" FROM ((""Invoices"" AS ""i"" JOIN ""Customers"" AS ""c"" ON ""i"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Contacts"" AS ""t"" ON ""t"".""user_id""=""c"".""customer_id"") LEFT JOIN ""Customers"" AS ""e"" ON ""e"".""email""=""t"".""contact_email"" GROUP BY 1,2,3 ORDER BY 1"
