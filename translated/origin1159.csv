id,original query
1,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""t2"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""t1"".""seller_id"",""t1"".""item_brand"" FROM (SELECT ""o"".""seller_id"",""o"".""item_id"",""o"".""order_date"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""num"",""i"".""item_brand"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t1"" WHERE ""t1"".""num""=2) AS ""t2"" ON ""u"".""user_id""=""t2"".""seller_id"""
2,"WITH ""cte"" AS (SELECT ""u"".""user_id"",""favorite_brand"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""order_date"") AS ""rk"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""yes_id"" AS (SELECT ""user_id"" FROM ""cte"" WHERE ""rk""=2 AND ""favorite_brand""=""item_brand"") SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""user_id"" IN (SELECT * FROM ""yes_id"") THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"""
3,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT *,DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sale_rnk"" FROM ""Orders"") AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"" AND ""o"".""sale_rnk""=2) LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" ORDER BY 1"
4,"WITH ""cte"" AS (SELECT ""seller_id"",""o"".""item_id"",""i"".""item_brand"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""dr"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_id"" IS NULL OR ""t"".""item_brand""!=""favorite_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT * FROM ""cte"" WHERE ""dr""=2) AS ""t"" ON ""t"".""seller_id""=""u"".""user_id"""
5,"WITH ""sell_rank"" AS (SELECT ""orders"".""seller_id"",""orders"".""item_id"",""items"".""item_brand"",RANK() OVER (PARTITION BY ""orders"".""seller_id"" ORDER BY ""orders"".""order_date"") AS ""rk"" FROM ""orders"" JOIN ""items"" ON ""orders"".""item_id""=""items"".""item_id""), ""second_rk"" AS (SELECT ""seller_id"",""item_brand"" FROM ""sell_rank"" WHERE ""rk""=2) SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN (""users"".""favorite_brand""=""second_rk"".""item_brand"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""second_rk"" ON ""users"".""user_id""=""second_rk"".""seller_id"""
6,"WITH ""two_items_sold"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""orders"".*,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"") AS ""A"" WHERE ""A"".""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""two_items_sold"" AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""t"".""item_id"""
7,"WITH ""rank_orders"" AS (SELECT ""seller_id"",""order_date"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank"" FROM ""orders"") SELECT ""t1"".""user_id"" AS ""seller_id"",CASE WHEN ""t3"".""item_brand"" IS NULL THEN 'no' WHEN ""t1"".""favorite_brand""!=""item_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""t1"" LEFT JOIN (SELECT * FROM ""rank_orders"" WHERE ""rank""=2) AS ""t2"" ON ""t2"".""seller_id""=""t1"".""user_id"") LEFT JOIN ""items"" AS ""t3"" ON ""t3"".""item_id""=""t2"".""item_id"""
8,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""i"".""item_brand"",""o"".""item_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" WHERE ""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""u"".""favorite_brand""=""cte"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""seller_id"""
9,"SELECT ""user_id"" AS ""seller_id"",COALESCE((CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END), 'no') AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sell_order"" FROM ""Orders"") AS ""temp"" WHERE ""sell_order""=2) AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" ORDER BY ""seller_id"""
10,"WITH ""df"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""c"".""seller_id"",""c"".""item_id"",""d"".""item_brand"",RANK() OVER (PARTITION BY ""c"".""seller_id"" ORDER BY ""c"".""order_date"") AS ""ranks"" FROM ""orders"" AS ""c"" JOIN ""items"" AS ""d"" ON ""c"".""item_id""=""d"".""item_id"") AS ""e"" WHERE ""ranks""=2) SELECT ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""x"".""user_id"" AS ""seller_id"",""x"".""favorite_brand"",COALESCE(""y"".""item_brand"", 0) AS ""item_brand"" FROM ""users"" AS ""x"" LEFT JOIN ""df"" AS ""y"" ON ""x"".""user_id""=""y"".""seller_id"") AS ""z"""
11,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""2nd_item_fav_brand"" IS NULL THEN 'no' ELSE ""2nd_item_fav_brand"" END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN (SELECT ""a"".""seller_id"",""a"".""order_date"",CASE WHEN ""b"".""item_brand""=""e"".""favorite_brand"" THEN 'yes' WHEN ""b"".""item_brand""!=""e"".""favorite_brand"" THEN 'no' END AS ""2nd_item_fav_brand"",ROW_NUMBER() OVER (PARTITION BY ""a"".""seller_id"" ORDER BY ""a"".""order_date"") AS ""rn"" FROM (""Orders"" AS ""a"" LEFT JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") LEFT JOIN ""Users"" AS ""e"" ON ""a"".""seller_id""=""e"".""user_id"") AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" AND ""b"".""rn""=2"
12,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_rank"" FROM ""orders"") AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""t"".""sold_rank""=2) LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
13,"WITH ""second_o"" AS (SELECT ""o"".""seller_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM (""orders"" AS ""o"") CROSS JOIN ""items"" AS ""i"" WHERE ""o"".""item_id""=""i"".""item_id"") SELECT ""u1"".""user_id"" AS ""seller_id"",CASE WHEN ""u1"".""favorite_brand""=""so"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""second_o"" AS ""so"" RIGHT JOIN ""users"" AS ""u1"" ON ""u1"".""user_id""=""so"".""seller_id"" AND ""so"".""rk""=2"
14,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""o"".""seller_id"",""favorite_brand"",""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""order_date"") AS ""ra"" FROM (""orders"" AS ""o"" LEFT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" RIGHT JOIN ""users"" AS ""u"" ON ""a"".""seller_id""=""u"".""user_id"" AND ""a"".""ra""=2"
15,"WITH ""t1"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""RK"",""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" USING (""item_id"")) AS ""t0"" WHERE ""RK""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""t1"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""t1"" ON ""u"".""user_id""=""t1"".""seller_id"" ORDER BY 1"
16,"WITH ""two_items_sold"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""orders"".*,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"") AS ""A"" WHERE ""A"".""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""two_items_sold"" AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""t"".""item_id"""
17,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""o"".""seller_id"",""favorite_brand"",""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""order_date"") AS ""ra"" FROM (""orders"" AS ""o"" JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" RIGHT JOIN ""users"" AS ""u"" ON ""a"".""seller_id""=""u"".""user_id"" AND ""a"".""ra""=2"
18,"WITH ""temp"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"" FROM ""Orders"") SELECT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""I"".""item_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""U"" LEFT JOIN ""temp"" ON ""U"".""user_id""=""temp"".""seller_id"" AND ""temp"".""ranks""=2) LEFT JOIN ""Items"" AS ""I"" ON ""U"".""favorite_brand""=""I"".""item_brand"" AND ""temp"".""item_id""=""I"".""item_id"" ORDER BY ""U"".""user_id"""
19,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""2nd_item_fav_brand"" IS NULL THEN 'no' ELSE ""2nd_item_fav_brand"" END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN (SELECT ""seller_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' WHEN ""item_brand""!=""favorite_brand"" THEN 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""a"".""seller_id"",""a"".""order_date"",""b"".""item_brand"",""e"".""favorite_brand"",ROW_NUMBER() OVER (PARTITION BY ""a"".""seller_id"" ORDER BY ""a"".""order_date"") AS ""rn"" FROM (""Orders"" AS ""a"" LEFT JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") LEFT JOIN ""Users"" AS ""e"" ON ""a"".""seller_id""=""e"".""user_id"") AS ""a"" WHERE ""rn""=2) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
20,"WITH ""t1"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""order_id"",""order_date"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM (""Orders"" AS ""o"" LEFT JOIN ""Users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""t"" WHERE ""rk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""t1"" RIGHT JOIN ""Users"" AS ""u2"" ON ""t1"".""seller_id""=""u2"".""user_id"""
21,"SELECT ""u2"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""2nd_item_fav_brand"" IS NULL THEN 'no' ELSE ""b"".""2nd_item_fav_brand"" END AS ""2nd_item_fav_brand"" FROM (SELECT ""a"".""seller_id"",CASE WHEN ""a"".""rn""=2 AND ""a"".""item_brand""=""a"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""favorite_brand"",""o"".""item_id"",""i"".""item_brand"",""o"".""seller_id"",""o"".""order_date"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rn"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""a"" WHERE ""a"".""rn""=2) AS ""b"" RIGHT JOIN ""Users"" AS ""u2"" ON ""b"".""seller_id""=""u2"".""user_id"""
22,"WITH ""ct"" AS (SELECT ""o"".""seller_id"",""o"".""order_date"",""o"".""item_id"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""r"",""u"".""favorite_brand"",""i"".""item_brand"" FROM (""orders"" AS ""o"" LEFT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" ORDER BY ""o"".""seller_id"",""o"".""order_date"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""ct"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" AND ""b"".""r""=2"
23,"SELECT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""U"".""favorite_brand""=""Second"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""U"" LEFT JOIN (SELECT * FROM (SELECT ""O"".""item_id"",""O"".""seller_id"",RANK() OVER (PARTITION BY ""O"".""seller_id"" ORDER BY DATE(""O"".""order_date"")) AS ""rank_sold_items"",""I"".""item_brand"" FROM ""Orders"" AS ""O"" LEFT JOIN ""Items"" AS ""I"" ON ""O"".""item_id""=""I"".""item_id"") AS ""Sub"" WHERE ""Sub"".""rank_sold_items""=2) AS ""Second"" ON ""U"".""user_id""=""Second"".""seller_id"""
24,"WITH ""cte"" AS (SELECT * FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank0"" FROM ""orders"") AS ""sub"" WHERE ""rank0""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"",""favorite_brand"",""i"".""item_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""c"".""item_id""=""i"".""item_id"") AS ""sub1"""
25,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""s"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT * FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rownum"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""temp"" WHERE ""rownum""=2) AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
26,"WITH ""tmp"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"",""b"".""item_brand"" FROM ""Orders"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id""), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""ranks""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""tmp2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
27,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""o1"".""seller_id"",""o1"".""order_date"",""i"".""item_brand"" FROM (""orders"" AS ""o1"" JOIN ""orders"" AS ""o2"" ON ""o1"".""seller_id""=""o2"".""seller_id"" AND ""o1"".""order_date"">""o2"".""order_date"") JOIN ""items"" AS ""i"" ON ""o1"".""item_id""=""i"".""item_id"" GROUP BY ""o1"".""seller_id"",""o1"".""order_date"",""i"".""item_brand"" HAVING COUNT(""o2"".""order_date"")=1) AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"""
28,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""x"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""o"".""seller_id"",""o"".""item_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""x"" ON ""x"".""r""=2 AND ""x"".""seller_id""=""u"".""user_id"""
29,"WITH ""CTE"" AS (SELECT * FROM (SELECT ""a"".""user_id"",""item_brand"",""favorite_brand"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""Fav_brand"",ROW_NUMBER() OVER (PARTITION BY ""B"".""Seller_Id"" ORDER BY ""order_date"") AS ""Order_Seq"" FROM (""Users"" AS ""A"" LEFT JOIN ""Orders"" AS ""B"" ON ""A"".""user_id""=""B"".""Seller_Id"") LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"") AS ""Data_set"" WHERE ""Order_Seq""=2) SELECT ""Users"".""User_id"" AS ""seller_id"",COALESCE(CASE WHEN (""item_brand""=""CTE"".""favorite_brand"") AND ""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""CTE"" ON ""Users"".""user_id""=""CTE"".""user_id"""
30,"SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"" FROM (SELECT ""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_num"" FROM ""orders"") AS ""o"" WHERE ""row_num""=2) AS ""t"" RIGHT JOIN ""Users"" AS ""u"" ON ""t"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" ORDER BY 1"
31,"WITH ""t1"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"" FROM ""Orders"") AS ""t"" WHERE ""ranks""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""t1"".*,""u"".""user_id"",""i"".""item_brand"",""u"".""favorite_brand"" FROM (""t1"" JOIN ""Items"" AS ""i"" ON ""t1"".""item_id""=""i"".""item_id"") RIGHT JOIN ""Users"" AS ""u"" ON ""t1"".""seller_id""=""u"".""user_id"") AS ""t"""
32,"WITH ""orders2"" AS (SELECT ""seller_id"",""item_id"",""favorite_brand"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_id"" FROM (""orders"" JOIN ""items"" USING (""item_id"")) JOIN ""users"" ON ""seller_id""=""user_id"") SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"" AS ""user_id"",'yes' AS ""2nd_item_fav_brand"" FROM ""orders2"" WHERE ""row_id""=2 AND ""favorite_brand""=""item_brand"") AS ""tmp"" USING (""user_id"")"
33,"WITH ""CTE"" AS (SELECT ""A"".""seller_id"",'yes' AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""A"" JOIN ""Items"" ON ""Items"".""item_id""=""A"".""item_id"") JOIN ""Users"" ON ""Users"".""user_id""=""A"".""seller_id"" WHERE ""Users"".""favorite_brand""=""Items"".""item_brand"" AND ""rk""=2) SELECT * FROM ""CTE"" UNION ALL SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""Users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""CTE"")"
34,"WITH ""two_items_sold"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""orders"".*,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"") AS ""A"" WHERE ""A"".""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""two_items_sold"" AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""t"".""item_id"""
35,"WITH ""cte"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders"") AS ""t1"" WHERE ""t1"".""rn""=2), ""cte1"" AS (SELECT ""seller_id"",""items"".""item_brand"" AS ""itb"",""favorite_brand"" AS ""fb"" FROM (""cte"" CROSS JOIN ""Users"") JOIN ""Items"" ON ""cte"".""item_id""=""Items"".""item_id"" AND ""cte"".""seller_id""=""Users"".""user_id"") SELECT ""seller_id"",CASE WHEN ""itb""=""fb"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""cte1"" UNION ALL SELECT ""User_id"",'no' FROM ""Users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""cte1"") ORDER BY ""seller_id"""
36,"WITH ""half"" AS (SELECT ""new"".""seller_id"",CASE WHEN ""new"".""favorite_brand""=""new"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""o"".""seller_id"",""o"".""order_date"",""i"".""item_brand"",""u"".""favorite_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""r"" FROM (""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") LEFT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""o"".""seller_id"") AS ""new"" WHERE ""r""=2) SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""half"") UNION SELECT * FROM ""half"""
37,"SELECT ""seller_id"",CASE WHEN ""2nd_item_fav_brand""=0 THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"" AS ""seller_id"",SUM(CASE WHEN (""rn""=2 AND ""favorite_brand""=""item_brand"") THEN 1 ELSE 0 END) AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"",""favorite_brand"",""order_date"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rn"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""T"" GROUP BY ""seller_id"") AS ""T1"""
38,"WITH ""tmp"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"",""b"".""item_brand"" FROM ""Orders"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id""), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""ranks""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""tmp2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
39,"WITH ""cte"" AS (SELECT ""seller_id"",""order_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"",""item_id"" FROM ""orders"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""cte"" ON ""cte"".""seller_id""=""u"".""user_id"" AND ""cte"".""rk""=2) LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""cte"".""item_id"""
40,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""!=""favorite_brand"" OR ""item_brand"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""num"" FROM ""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" ON ""u"".""user_id""=""a"".""seller_id"" AND ""a"".""num""=2 ORDER BY ""u"".""user_id"""
41,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""cte0"" AS (SELECT * FROM ""cte"" WHERE ""rnk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte0"" ON ""cte0"".""seller_id""=""u"".""user_id"" GROUP BY ""u"".""user_id"""
42,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""o1"".""seller_id"",""o1"".""item_id"" FROM ""orders"" AS ""o1"" JOIN ""orders"" AS ""o2"" ON ""o2"".""order_date""<""o1"".""order_date"" AND ""o1"".""seller_id""=""o2"".""seller_id"" GROUP BY ""o1"".""order_id"" HAVING COUNT(DISTINCT ""o2"".""order_id"")<=1) AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" ORDER BY 1"
43,"WITH ""sold_check"" AS (SELECT ""item_brand"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""sold_check"" ON ""Users"".""user_id""=""sold_check"".""seller_id"" AND ""rk""=2"
44,"WITH ""T"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_no"" FROM ""Orders"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN (SELECT ""c"".*,""d"".""item_brand"" FROM ""T"" AS ""c"" LEFT JOIN ""Items"" AS ""d"" ON ""c"".""item_id""=""d"".""item_id"" WHERE ""c"".""order_no""=2) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
45,"WITH ""second_order"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""Orders"".*,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""temp_rnk"" WHERE ""temp_rnk"".""rnk""=2), ""second_brand"" AS (SELECT ""so"".""seller_id"",""so"".""item_id"",""i"".""item_brand"" FROM ""second_order"" AS ""so"" LEFT JOIN ""Items"" AS ""i"" ON ""so"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN (""sb"".""item_brand""=""u"".""favorite_brand"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""second_brand"" AS ""sb"" ON ""sb"".""seller_id""=""u"".""user_id"""
46,"WITH ""T"" AS (SELECT ""order_id"",""order_date"",""item_id"",""buyer_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranking"" FROM ""Orders"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT ""seller_id"" FROM (""T"" JOIN ""Users"" ON ""T"".""seller_id""=""Users"".""user_id"") JOIN ""Items"" USING (""item_id"") WHERE ""ranking""=2 AND ""favorite_brand""=""item_brand"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"""
47,"SELECT ""us"".""user_id"" AS ""seller_id"",(CASE WHEN ""sub2"".""item_brand""=""sub2"".""favorite_brand"" AND ""sub2"".""order_rank""=2 THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (SELECT * FROM (SELECT ""u"".""user_id"",RANK() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""o"".""order_date"") AS ""order_rank"",""i"".""item_brand"",""u"".""favorite_brand"" FROM (""Users"" AS ""u"" JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""sub"" WHERE ""sub"".""order_rank""=2) AS ""sub2"" RIGHT JOIN ""Users"" AS ""us"" ON ""us"".""user_id""=""sub2"".""user_id"""
48,"WITH ""ranked"" AS (SELECT ""order_id"",""order_date"",""a"".""item_id"",""a"".""seller_id"",""b"".""favorite_brand"",""c"".""item_brand"",CASE WHEN ""b"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM (""orders"" AS ""a"" JOIN ""users"" AS ""b"" ON ""a"".""seller_id""=""b"".""user_id"") JOIN ""items"" AS ""c"" ON ""a"".""item_id""=""c"".""item_id"" ORDER BY ""seller_id"") SELECT ""a"".""user_id"" AS ""seller_id"",COALESCE(""b"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT ""seller_id"",""2nd_item_fav_brand"",""rk"" FROM ""ranked"" WHERE (""rk""=2 AND ""2nd_item_fav_brand""='yes')) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
49,"SELECT ""f1"".""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"",""favorite_brand"" FROM ""users"") AS ""f1"" LEFT JOIN (SELECT ""seller_id"" AS ""user_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""orders"") AS ""f2"" WHERE ""rk""=2) AS ""f3"" JOIN ""items"" ON ""f3"".""item_id""=""items"".""item_id"") AS ""f4"" ON ""f1"".""user_id""=""f4"".""user_id"""
50,"WITH ""2nd_item_fav_sold"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""f"" WHERE ""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""2nd_item_fav_sold"" AS ""f"" ON ""f"".""seller_id""=""u"".""user_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""f"".""item_id"""
51,"WITH ""cte"" (""seller_id"", ""item_id"") AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnm"" FROM ""Orders"") AS ""inr"" WHERE ""rnm""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand"" IS NULL OR ""i"".""item_brand""!=""u"".""favorite_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""c"".""item_id""=""i"".""item_id"""
52,"WITH ""CTE"" AS (SELECT * FROM (SELECT ""B"".""Seller_Id"" AS ""user_id"",""C"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""B"".""Seller_Id"" ORDER BY ""B"".""order_date"") AS ""Order_Seq"" FROM ""Orders"" AS ""B"" LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"") AS ""Data_set"" WHERE ""Order_Seq""=2) SELECT ""Users"".""User_id"" AS ""seller_id"",COALESCE(CASE WHEN (""CTE"".""item_brand""=""Users"".""favorite_brand"") AND ""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""CTE"" ON ""Users"".""user_id""=""CTE"".""user_id"""
53,"WITH ""cte"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"",""c"".""favorite_brand"" FROM (""orders"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") LEFT JOIN ""users"" AS ""c"" ON ""a"".""seller_id""=""c"".""user_id"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NOT NULL THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT ""seller_id"" FROM ""cte"" WHERE ""rnk""=2 AND ""favorite_brand""=""item_brand"") AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
54,"WITH ""CTE"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""T"" WHERE ""rnk""=2) SELECT DISTINCT ""seller_id"",CASE WHEN ""favorite_brand""=""brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"" AS ""seller_id"",""favorite_brand"",COALESCE(""CTE"".""item_brand"", 0) AS ""brand"" FROM ""users"" AS ""u"" LEFT JOIN ""CTE"" ON ""u"".""user_id""=""CTE"".""seller_id"") AS ""D"""
55,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""a"".*,""b"".""item_brand"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sell_seq"" FROM ""Orders"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") AS ""temp"" WHERE ""sell_seq""=2) SELECT ""a"".""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
56,"SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN ""items"".""item_brand""=""users"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""users"" LEFT JOIN (SELECT ""item_id"",""seller_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""num"" FROM ""Orders"") AS ""2ndorder"" ON ""users"".""user_id""=""2ndorder"".""seller_id"" AND ""2ndorder"".""num""=2) LEFT JOIN ""Items"" AS ""items"" ON ""2ndorder"".""item_id""=""items"".""item_id"""
57,"WITH ""sold_rank"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_num"" FROM ""Orders""), ""sold_2nd_join"" AS (SELECT ""Users"".""user_id"" AS ""seller_id"",""Users"".""favorite_brand"",""sold_rank"".""item_id"" FROM ""Users"" LEFT JOIN ""sold_rank"" ON ""Users"".""user_id""=""sold_rank"".""seller_id"" AND ""sold_rank"".""row_num""=2), ""joined_tb"" AS (SELECT ""sold_2nd_join"".""seller_id"",""sold_2nd_join"".""item_id"",""sold_2nd_join"".""favorite_brand"",""Items"".""item_brand"" FROM ""sold_2nd_join"" LEFT JOIN ""Items"" ON ""sold_2nd_join"".""item_id""=""Items"".""item_id"") SELECT ""seller_id"",CASE WHEN ""item_id"" IS NULL THEN 'no' WHEN ""favorite_brand""=""item_brand"" THEN 'yes' WHEN ""favorite_brand""!=""item_brand"" THEN 'no' END AS ""2nd_item_fav_brand"" FROM ""joined_tb"""
58,"WITH ""order_rank"" AS (SELECT ""seller_id"",""I"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""I"" ON ""o"".""item_id""=""I"".""item_Id"") SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""u"".""favorite_brand""=""ro"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM ""order_rank"" WHERE ""rn""=2) AS ""ro"" ON ""ro"".""seller_id""=""u"".""user_id"""
59,"WITH ""orders_items"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"" FROM (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"") AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"" WHERE ""a"".""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""oi"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""orders_items"" AS ""oi"" ON ""u"".""user_id""=""oi"".""seller_id"" AND ""u"".""favorite_brand""=""oi"".""item_brand"" ORDER BY ""u"".""user_id"""
60,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""m"".""item_brand""=""m"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""u"".""user_id"",""o"".""order_date"",""i"".""item_brand"",""u"".""favorite_brand"",DENSE_RANK() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""o"".""order_date"") AS ""orderid"" FROM (""users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""m"" ON ""u"".""user_id""=""m"".""user_id"" AND ""m"".""orderid""=2"
61,"SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""item_brand""=""a"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT ""a"".""seller_id"",""b"".""item_brand"",RANK() OVER (PARTITION BY ""a"".""seller_id"" ORDER BY ""a"".""order_date"") AS ""Order_num"" FROM ""orders"" AS ""a"" JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" AND ""b"".""order_num""=2"
62,"SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_rank"" FROM ""orders"") AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""row_rank""=2) LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
63,"WITH ""main"" AS (SELECT ""user_id"",""favorite_brand"",RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""ranking"",""item_brand"",COUNT(""order_id"") OVER (PARTITION BY ""user_id"") AS ""total"" FROM (""Users"" AS ""U"" LEFT JOIN ""Orders"" AS ""O"" ON ""user_id""=""seller_id"") LEFT JOIN ""Items"" AS ""I"" ON ""O"".""item_id""=""I"".""item_id"") SELECT DISTINCT ""user_id"" AS ""seller_id"",(CASE WHEN ""total""<2 THEN 'no' WHEN ""total"">1 AND ""ranking""=2 AND ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""main"" WHERE ""total""<2 OR ""ranking""=2"
64,"SELECT ""seller_id"",CASE WHEN ""items"".""item_brand""=""users"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Items"" AS ""items"" JOIN (SELECT ""item_id"",""seller_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""num"" FROM ""Orders"") AS ""2ndorder"" ON ""2ndorder"".""item_id""=""items"".""item_id"") JOIN ""Users"" AS ""users"" ON ""users"".""user_id""=""2ndorder"".""seller_id"" WHERE ""2ndorder"".""num""=2 UNION SELECT ""users"".""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""Orders"" AS ""orders"" RIGHT JOIN ""Users"" AS ""users"" ON ""orders"".""seller_id""=""users"".""user_id"" WHERE ""users"".""user_id"" NOT IN (SELECT ""seller_id"" FROM ""Orders"" GROUP BY ""seller_id"" HAVING COUNT(""item_id"")>1)"
65,"WITH ""cte2"" AS (SELECT ""seller_id"",""i"".""item_brand"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk1"" FROM ""orders"") AS ""cte"" LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""cte"".""item_id"" WHERE ""rk1""=2) SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' WHEN ""item_brand"" IS NULL THEN 'no' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"",""favorite_brand"",""cte2"".""item_brand"" FROM ""users"" LEFT JOIN ""cte2"" ON ""users"".""user_id""=""cte2"".""seller_id"") AS ""cte3"""
66,"WITH ""tmp"" AS (SELECT ""a"".""seller_id"",(CASE WHEN ""a"".""item_brand""=""a"".""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""o"".""item_id"",""i"".""item_brand"",""u"".""favorite_brand"",""o"".""seller_id"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rn"" FROM (""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") LEFT JOIN ""Users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") AS ""a"" WHERE ""a"".""rn""=2) SELECT DISTINCT ""u"".""user_id"" AS ""seller_id"",COALESCE(""t"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""tmp"" AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"""
67,"WITH ""OrderRanking"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""Rk"" FROM ""Orders""), ""SecondOrderBrand"" AS (SELECT ""seller_id"",""item_brand"" FROM ""OrderRanking"" AS ""OdR"" JOIN ""Items"" AS ""I"" ON ""I"".""item_id""=""OdR"".""item_id"" WHERE ""Rk""=2) SELECT ""U"".""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""U"".""favorite_brand""=""SOB"".""item_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""U"" LEFT JOIN ""SecondOrderBrand"" AS ""SOB"" ON ""SOB"".""seller_id""=""U"".""user_id"" ORDER BY 1"
68,"WITH ""cte"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""s"" WHERE ""rk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""c"".""item_id""=""i"".""item_id"" ORDER BY 1"
69,"WITH ""cte"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"",""item_id"" FROM ""orders"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""cte"" ON ""cte"".""seller_id""=""u"".""user_id"" AND ""cte"".""rk""=2) LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""cte"".""item_id"""
70,"WITH ""CTE"" AS (SELECT ""A"".""seller_id"",'yes' AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""A"" JOIN ""Items"" ON ""Items"".""item_id""=""A"".""item_id"") JOIN ""Users"" ON ""Users"".""user_id""=""A"".""seller_id"" WHERE ""Users"".""favorite_brand""=""Items"".""item_brand"" AND ""rk""=2) SELECT * FROM ""CTE"" UNION ALL SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""Users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""CTE"")"
71,"WITH ""CTE"" AS (SELECT ""U"".""USER_ID"",ROW_NUMBER() OVER (PARTITION BY ""U"".""USER_ID"" ORDER BY ""O"".""ORDER_DATE"") AS ""RN"",""I"".""ITEM_BRAND"" FROM (""ORDERS"" AS ""O"" LEFT JOIN ""USERS"" AS ""U"" ON ""O"".""SELLER_ID""=""U"".""USER_ID"") LEFT JOIN ""ITEMS"" AS ""I"" ON ""O"".""ITEM_ID""=""I"".""ITEM_ID"") SELECT ""U2"".""USER_ID"" AS ""SELLER_ID"",(CASE WHEN ""ITEM_BRAND""=""FAVORITE_BRAND"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""CTE"" RIGHT JOIN ""USERS"" AS ""U2"" ON ""U2"".""USER_ID""=""CTE"".""USER_ID"" AND ""RN""=2"
72,"WITH ""CTE"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""T"" WHERE ""rnk""=2) SELECT DISTINCT ""seller_id"",CASE WHEN ""favorite_brand""=""brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"" AS ""seller_id"",""favorite_brand"",COALESCE(""CTE"".""item_brand"", 0) AS ""brand"" FROM ""users"" AS ""u"" LEFT JOIN ""CTE"" ON ""u"".""user_id""=""CTE"".""seller_id"") AS ""D"""
73,"WITH ""tmp"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"",""Items"".""item_brand"" FROM ""Orders"" JOIN ""Items"" ON ""Items"".""item_id""=""Orders"".""item_id""), ""tmp2"" AS (SELECT ""seller_id"",""item_brand"" FROM ""tmp"" WHERE ""rk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""tmp2"" ON ""Users"".""user_id""=""tmp2"".""seller_id"""
74,"WITH ""t1"" AS (SELECT ""o"".*,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_rank"",""item_brand"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""b"" ON ""o"".""item_id""=""b"".""item_id"") SELECT DISTINCT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""t1"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""t1"" ON ""u"".""user_id""=""t1"".""seller_id"" AND ""order_rank""=2"
75,"WITH ""temp"" AS (SELECT ""seller_id"",""items"".""item_brand"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank"" FROM ""orders"" LEFT JOIN ""items"" ON ""orders"".""item_id""=""items"".""item_id"") SELECT ""users"".""user_id"" AS ""seller_id"",(CASE WHEN ""item_brand""=""users"".""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN (SELECT * FROM ""temp"" WHERE ""temp"".""rank""=2) AS ""temp2"" ON ""users"".""user_id""=""temp2"".""seller_id"""
76,"WITH ""sale_data"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders""), ""2nd_sold_brand"" AS (SELECT * FROM ""sale_data"" WHERE ""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""sb"".""seller_id"" IS NULL THEN 'no' WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""2nd_sold_brand"" AS ""sb"" ON ""u"".""user_id""=""sb"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""sb"".""item_id"""
77,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""o1"".""seller_id"",""o1"".""item_id"" FROM ""orders"" AS ""o1"" JOIN ""orders"" AS ""o2"" ON ""o2"".""order_date""<""o1"".""order_date"" AND ""o1"".""seller_id""=""o2"".""seller_id"" GROUP BY ""o1"".""order_id"" HAVING COUNT(DISTINCT ""o2"".""order_id"")<=1) AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" ORDER BY 1"
78,"WITH ""temp"" AS (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranking"" FROM ""orders"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""a"" LEFT JOIN ""temp"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" AND ""b"".""ranking""=2) LEFT JOIN ""items"" AS ""c"" ON ""b"".""item_id""=""c"".""item_id"" ORDER BY 1,2"
79,"WITH ""prep"" AS (SELECT ""o"".*,""u"".""user_id"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rn"",CASE WHEN LEAD(""i"".""item_brand"", 1) OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"")=""u"".""favorite_brand"" THEN 1 ELSE 0 END AS ""IsNextFavorite"" FROM (""orders"" AS ""o"" LEFT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id""), ""prep2"" AS (SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""IsNextFavorite""=1 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""prep"" WHERE ""rn""=1) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""prep2"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""prep2"" ON ""u"".""user_id""=""prep2"".""seller_id"" ORDER BY 1"
80,"WITH ""OrderRanking"" AS (SELECT ""O"".""seller_id"",""I"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""Rk"" FROM ""Orders"" AS ""O"" JOIN ""Items"" AS ""I"" ON ""I"".""item_id""=""O"".""item_id"") SELECT ""U"".""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""OOR"".""item_brand""=""U"".""favorite_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""U"" LEFT JOIN ""OrderRanking"" AS ""OOR"" ON ""U"".""user_id""=""OOR"".""seller_id"" AND ""Rk""=2"
81,"WITH ""rankedTable"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranked"",""i1"".""item_brand"" FROM ""Orders"" AS ""o1"" LEFT JOIN ""Items"" AS ""i1"" ON ""i1"".""item_id""=""o1"".""item_id""), ""rankedTable2"" AS (SELECT * FROM ""rankedTable"" WHERE ""ranked""=2) SELECT ""u1"".""user_id"" AS ""seller_id"",CASE WHEN ""r1"".""item_brand""=""u1"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u1"" LEFT JOIN ""rankedTable2"" AS ""r1"" ON ""u1"".""user_id""=""r1"".""seller_id"""
82,"SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" WHERE ""r""=2) AS ""b"" ON ""u"".""user_id""=""b"".""seller_id"""
83,"WITH ""a"" AS (SELECT ""o"".""seller_id"",""o"".""order_date"" AS ""sell_date"",""o"".""item_id"",""i"".""item_brand"" FROM ""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" ORDER BY 1), ""b"" AS (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""sell_date"") AS ""rnk"" FROM ""a""), ""c"" AS (SELECT * FROM ""b"" WHERE ""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""c"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""c"" RIGHT JOIN ""users"" AS ""u"" ON ""c"".""seller_id""=""u"".""user_id"""
84,"SELECT ""x"".""user_id"" AS ""seller_id"",CASE WHEN ""x"".""favorite_brand""=""y"".""item_brand"" THEN 'yes' WHEN ""y"".""item_brand"" IS NULL THEN 'no' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""x"" LEFT JOIN (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""x"" JOIN ""Items"" AS ""y"" ON ""x"".""item_id""=""y"".""item_id"") AS ""y"" ON ""x"".""user_id""=""y"".""seller_id"" AND ""y"".""rnk""=2"
85,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""tmp"".""seller_id"" IS NULL THEN 'no' WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""tmp"" RIGHT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""tmp"".""seller_id"" AND ""tmp"".""rnk""=2) LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""tmp"".""item_id"""
86,"WITH ""res"" AS (SELECT ""o1"".""seller_id"",""o1"".""order_date"",""o1"".""item_id"" FROM ""orders"" AS ""o1"" JOIN ""orders"" AS ""o2"" ON ""o1"".""seller_id""=""o2"".""seller_id"" WHERE ""o1"".""order_date"">""o2"".""order_date"" GROUP BY ""o1"".""seller_id"",""o1"".""order_date"" HAVING COUNT(""o1"".""order_id"")=1) SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""res"" ON ""u"".""user_id""=""res"".""seller_id"") LEFT JOIN ""items"" ON ""items"".""item_id""=""res"".""item_id"""
87,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_rank"" FROM ""orders"") AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""t"".""sold_rank""=2) LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
88,"WITH ""sells"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"" AS ""o"") AS ""a"" WHERE ""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""s"".""seller_id"" IS NULL THEN 'no' ELSE CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""sells"" AS ""s"" ON (""u"".""user_id""=""s"".""seller_id"")) LEFT JOIN ""items"" AS ""i"" ON (""s"".""item_id""=""i"".""item_id"")"
89,"WITH ""temp"" AS (SELECT ""o"".""seller_id"",""i"".""item_brand"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""o"" JOIN ""items"" AS ""i"" USING (""item_id"") WHERE ""o"".""rnk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""temp"" ON ""temp"".""seller_id""=""users"".""user_id"""
90,"WITH ""have2nd"" AS (SELECT ""order_id"",""item_id"",""seller_id"" FROM (SELECT ""order_id"",""item_id"",""seller_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""tmp"" WHERE ""rnk""=2) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""a"" LEFT JOIN ""have2nd"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"") LEFT JOIN ""items"" AS ""c"" ON ""b"".""item_id""=""c"".""item_id"""
91,"WITH ""sit"" AS (SELECT ""o"".""seller_id"",""o"".""item_id"",""i"".""item_brand"",DENSE_RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""dr"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""s"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""sit"".""seller_id"",""sit"".""item_id"",""sit"".""item_brand"" FROM ""sit"" WHERE ""sit"".""dr""=2) AS ""s"" RIGHT JOIN ""users"" AS ""u"" ON ""s"".""seller_id""=""u"".""user_id"""
92,"WITH ""cte"" AS (SELECT ""a"".""order_date"",""a"".""seller_id"",""b"".""favorite_brand"" AS ""brand"",""c"".""item_brand"" FROM (""Orders"" AS ""a"" LEFT JOIN ""Users"" AS ""b"" ON ""a"".""seller_id""=""b"".""user_id"") LEFT JOIN ""Items"" AS ""c"" ON ""a"".""item_id""=""c"".""item_id""), ""cte2"" AS (SELECT ""seller_id"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""cte"") AS ""t"" WHERE ""t"".""rk""=2 AND ""t"".""brand""=""t"".""item_brand"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT * FROM ""cte2"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"""
93,"WITH ""CTE"" AS (SELECT ""T1"".""user_id"",""T1"".""favorite_brand"",""T2"".""order_date"",""T2"".""item_id"",""T2"".""buyer_id"",""T2"".""seller_id"",""T3"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""RNK"" FROM (""Users"" AS ""T1"" LEFT JOIN ""Orders"" AS ""T2"" ON ""T1"".""user_id""=""T2"".""seller_id"") LEFT JOIN ""Items"" AS ""T3"" ON ""T2"".""item_id""=""T3"".""item_id""), ""yes_table"" AS (SELECT ""seller_id"" FROM ""CTE"" WHERE ""RNK""=2 AND ""favorite_brand""=""item_brand"") SELECT DISTINCT ""user_id"" AS ""seller_id"",(CASE WHEN ""user_id"" IN (SELECT * FROM ""yes_table"") THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""CTE"""
94,"WITH ""SellerItems"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_rank"" FROM ""Orders"") SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN ""Users"".""favorite_brand""=""Items"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" LEFT JOIN ""SellerItems"" ON ""SellerItems"".""seller_id""=""Users"".""user_id"" AND ""SellerItems"".""order_rank""=2) LEFT JOIN ""Items"" ON ""Items"".""item_id""=""SellerItems"".""item_id"" WHERE COALESCE(""SellerItems"".""order_rank"", 2)=2"
95,"WITH ""cte1"" AS (SELECT ""user_id"",""favorite_brand"",""item_brand"",RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""user_id"") AS ""cnt"" FROM (""users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON (""o"".""seller_id""=""u"".""user_id"")) LEFT JOIN ""items"" AS ""i"" USING (""item_id"")) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" AND ""rnk""=2 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""cte1"" WHERE ""rnk""=2 OR ""cnt""<2"
96,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_brand"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t"" WHERE ""t"".""rk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""u"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"""
97,"WITH ""t"" AS (SELECT ""seller_id"",COALESCE(""item_brand"", '') AS ""2nd_item"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t0"" WHERE ""rnk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""2nd_item""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".*,COALESCE(""t"".""2nd_item"", '') AS ""2nd_item"" FROM ""Users"" AS ""u"" LEFT JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"") AS ""t0"""
98,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""t"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""o"".""seller_id"",""i"".""item_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""row_count"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""t"".""row_count""=2 ORDER BY ""u"".""user_id"""
99,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_rank"" FROM ""orders"") AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""t"".""sold_rank""=2) LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
100,"WITH ""second_item"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_brand"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""temp"" WHERE ""rnk""=2) SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""second_item"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
101,"SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN ""items"".""item_brand""=""users"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""users"" LEFT JOIN (SELECT ""item_id"",""seller_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""num"" FROM ""Orders"") AS ""2ndorder"" ON ""users"".""user_id""=""2ndorder"".""seller_id"" AND ""2ndorder"".""num""=2) LEFT JOIN ""Items"" AS ""items"" ON ""2ndorder"".""item_id""=""items"".""item_id"""
102,"WITH ""cte2"" AS (SELECT ""seller_id"",""i"".""item_brand"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk1"" FROM ""orders"") AS ""cte"" LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""cte"".""item_id"" WHERE ""rk1""=2) SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' WHEN ""item_brand"" IS NULL THEN 'no' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"",""favorite_brand"",""cte2"".""item_brand"" FROM ""users"" LEFT JOIN ""cte2"" ON ""users"".""user_id""=""cte2"".""seller_id"") AS ""cte3"""
103,"SELECT ""u1"".""user_id"" AS ""seller_id"",CASE WHEN ""t"".""item_brand""=""u1"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u1"" LEFT JOIN (SELECT ""u"".""user_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""order_date"") AS ""row_id"" FROM (""users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t"" ON ""u1"".""user_id""=""t"".""user_id"" AND ""row_id""=2"
104,"WITH ""cte"" AS (SELECT ""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""r"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""cte2"" AS (SELECT * FROM ""cte"" WHERE ""r""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""cte2"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte2"" ON ""u"".""user_id""=""cte2"".""seller_id"""
105,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""cte0"" AS (SELECT * FROM ""cte"" WHERE ""rnk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte0"" ON ""cte0"".""seller_id""=""u"".""user_id"" GROUP BY ""u"".""user_id"""
106,"WITH ""mega"" AS (SELECT * FROM (SELECT ""u"".""user_id"",""o"".""order_date"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t"" WHERE ""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""m"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""mega"" AS ""m"" ON ""u"".""user_id""=""m"".""user_id"""
107,"SELECT ""seller_id"",(CASE WHEN ""favorite_brand""=""sold_item"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""a1"".""user_id"" AS ""seller_id"",""a1"".""favorite_brand"",""a3"".""item_brand"" AS ""sold_item"" FROM (""users"" AS ""a1"" LEFT JOIN (SELECT ""item_id"",""seller_id"" FROM (SELECT ""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""buy_rank"" FROM ""Orders"") AS ""a"" WHERE ""a"".""buy_rank""=2) AS ""a2"" ON ""a1"".""user_id""=""a2"".""seller_id"") LEFT JOIN ""Items"" AS ""a3"" ON ""a2"".""item_id""=""a3"".""item_id"") AS ""a4"""
108,"WITH ""2nd_item_fav_sold"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""f"" WHERE ""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""2nd_item_fav_sold"" AS ""f"" ON ""f"".""seller_id""=""u"".""user_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""f"".""item_id"""
109,"WITH ""CTE"" AS (SELECT * FROM (SELECT ""B"".""Seller_Id"" AS ""user_id"",""C"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""B"".""Seller_Id"" ORDER BY ""order_date"") AS ""Order_Seq"" FROM ""Orders"" AS ""B"" LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"") AS ""Data_set"" WHERE ""Order_Seq""=2) SELECT ""Users"".""User_id"" AS ""seller_id"",COALESCE(CASE WHEN (""CTE"".""item_brand""=""Users"".""favorite_brand"") AND ""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""CTE"" ON ""Users"".""user_id""=""CTE"".""user_id"""
110,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranking"" FROM ""orders""), ""second"" AS (SELECT * FROM ""cte"" WHERE ""ranking""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""second"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""s"".""item_id""=""i"".""item_id"""
111,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""o1"".""seller_id"",""o1"".""item_id"",""o1"".""order_date"" FROM ""Orders"" AS ""o1"" JOIN ""Orders"" AS ""o2"" ON ""o1"".""seller_id""=""o2"".""seller_id"" AND ""o1"".""order_date"">""o2"".""order_date"" GROUP BY ""o1"".""seller_id"",""o1"".""order_date"" HAVING COUNT(""o1"".""order_id"")=1) AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" ORDER BY ""u"".""user_id"""
112,"WITH ""Fav"" AS (SELECT ""o"".""Seller_id"",""o"".""order_date"",""o"".""item_id"",""I"".""item_brand"",RANK() OVER (PARTITION BY ""o"".""Seller_id"" ORDER BY ""o"".""Order_date"") AS ""R"" FROM (""Orders"" AS ""O"") CROSS JOIN ""Items"" AS ""I"" WHERE ""o"".""Item_id""=""I"".""Item_id"") SELECT DISTINCT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""F"".""item_brand""=""U"".""Favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""U"" LEFT JOIN (SELECT ""Seller_id"",""Item_brand"" FROM ""Fav"" AS ""F"" WHERE ""R""=2) AS ""F"" ON ""U"".""user_id""=""F"".""seller_id"""
113,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" AND ""ra""=2 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""order_date"",""o"".""item_id"",""item_brand"",""user_id"",""favorite_brand"",RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""ra"",COUNT(""user_id"") OVER (PARTITION BY ""user_id"") AS ""co"" FROM (""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") RIGHT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") AS ""temp"" WHERE (""ra""=2 AND ""co"">=2) OR (""ra""=1 AND ""co""<2)"
114,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""tmp"" ON ""user_id""=""seller_id"" AND ""rk""=2"
115,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT *,DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"" AND ""o"".""rnk""=2) LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" GROUP BY ""u"".""user_id"""
116,"SELECT ""user_id"" AS ""seller_id"",COALESCE(""fv"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""fv"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM (""orders"" AS ""o"" JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""b"" ON ""u"".""user_id""=""b"".""seller_id"" AND ""rk""=2 ORDER BY 1"
117,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sell_order"" FROM ""Orders"") AS ""temp"" WHERE ""sell_order""=2) AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" ORDER BY ""seller_id"""
118,"WITH ""second_sold_items"" AS (SELECT * FROM (SELECT ""seller_id"",""item_id"",""order_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_rank"" FROM ""Orders"") AS ""ranked_orders"" WHERE ""sold_rank""=2) SELECT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""U"".""favorite_brand""=""I"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""U"" LEFT JOIN ""second_sold_items"" AS ""S"" ON ""U"".""user_id""=""S"".""seller_id"") LEFT JOIN ""Items"" AS ""I"" ON ""S"".""item_id""=""I"".""item_id"""
119,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""c"".""seller_id"" IS NOT NULL THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""a"".""seller_id"",""i"".""item_brand"" FROM (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""a"" JOIN ""items"" AS ""i"" ON ""a"".""item_id""=""i"".""item_id"" WHERE ""a"".""rnk""=2) AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"" AND ""u"".""favorite_brand""=""c"".""item_brand"""
120,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rnk"",""i"".""item_brand"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" WHERE ""rnk""=2) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""item_brand""=""a"".""favorite_brand"" THEN 'yes' WHEN ""b"".""item_brand""!=""a"".""favorite_brand"" OR ""b"".""item_brand"" IS NULL THEN 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""cte"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" ORDER BY 1"
121,"WITH ""second_order"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""Orders"".*,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""temp_rnk"" WHERE ""temp_rnk"".""rnk""=2), ""second_brand"" AS (SELECT ""so"".""seller_id"",""so"".""item_id"",""i"".""item_brand"" FROM ""second_order"" AS ""so"" LEFT JOIN ""Items"" AS ""i"" ON ""so"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN (""sb"".""item_brand""=""u"".""favorite_brand"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""second_brand"" AS ""sb"" ON ""sb"".""seller_id""=""u"".""user_id"""
122,"WITH ""OrderRanking"" AS (SELECT ""seller_id"" AS ""user_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""Rk"" FROM ""Orders""), ""UserSecondOrderBrand"" AS (SELECT ""ORD"".""user_id"",""I"".""item_brand"" FROM ""OrderRanking"" AS ""ORD"" JOIN ""Items"" AS ""I"" ON ""I"".""item_id""=""ORD"".""item_id"" WHERE ""Rk""=2) SELECT ""U"".""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""U"".""favorite_brand""=""USOB"".""item_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""U"" LEFT JOIN ""UserSecondOrderBrand"" AS ""USOB"" ON ""USOB"".""user_id""=""U"".""user_id"" ORDER BY 1"
123,"WITH ""TEMP"" AS (SELECT ""a"".""seller_id"",""a"".""item_id"",""b"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank"" FROM ""Orders"" AS ""a"" LEFT JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT * FROM ""TEMP"" WHERE ""TEMP"".""rank""=2) AS ""b"" ON ""u"".""user_id""=""b"".""seller_id"" ORDER BY 1"
124,"WITH ""ranked"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders""), ""joined_items"" AS (SELECT ""a"".""seller_id"",""a"".""item_id"",""a"".""rk"",""b"".""item_brand"" FROM ""ranked"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"" WHERE ""rk""=2) SELECT ""tb1"".""user_id"" AS ""seller_id"",CASE WHEN ""tb1"".""favorite_brand""=""tb2"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""tb1"" LEFT JOIN ""joined_items"" AS ""tb2"" ON ""tb1"".""user_id""=""tb2"".""seller_id"""
125,"WITH ""orders2"" AS (SELECT ""seller_id"",""item_id"",""favorite_brand"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_id"" FROM (""orders"" JOIN ""items"" USING (""item_id"")) JOIN ""users"" ON ""seller_id""=""user_id"") SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"" AS ""user_id"",'yes' AS ""2nd_item_fav_brand"" FROM ""orders2"" WHERE ""row_id""=2 AND ""favorite_brand""=""item_brand"") AS ""tmp"" USING (""user_id"")"
126,"WITH ""t1"" AS (SELECT * FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_rnk"" FROM ""Orders"") AS ""tmp"" WHERE ""order_rnk""=2), ""t2"" AS (SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""t1"" ON ""t1"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t1"".""item_id""=""i"".""item_id"") SELECT * FROM ""t2"""
127,"WITH ""CTE_second_item"" AS (SELECT ""order_id"",""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_rank"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""item_brand"" IS NULL THEN 'no' WHEN ""item_brand""!=""favorite_brand"" THEN 'no' ELSE 'yes' END) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""CTE_second_item"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"" AND ""c"".""order_rank""=2"
128,"WITH ""sells"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"" AS ""o"") AS ""a"" WHERE ""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""s"".""seller_id"" IS NULL THEN 'no' ELSE CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""sells"" AS ""s"" ON (""u"".""user_id""=""s"".""seller_id"")) LEFT JOIN ""items"" AS ""i"" ON (""s"".""item_id""=""i"".""item_id"")"
129,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""o"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""o"".""seller_id"",""i"".""item_id"",""i"".""item_brand"",DENSE_RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""sellrank"",COUNT(""o"".""order_id"") OVER (PARTITION BY ""o"".""seller_id"") AS ""cnt"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" USING (""item_id"")) AS ""o"" ON ""o"".""seller_id""=""u"".""user_id"" AND (""o"".""sellrank""=2)"
130,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""a"".""item_id"",""r"",""item_brand"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders"") AS ""a"" JOIN ""items"" AS ""i"" ON ""a"".""item_id""=""i"".""item_id"" WHERE ""r""=2) AS ""b"" ON ""u"".""user_id""=""b"".""seller_id"""
131,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""ranking"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""t"" WHERE ""ranking""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"" ORDER BY 1"
132,"WITH ""users_sale_rank"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sale_rank"" FROM ""orders"") SELECT ""t1"".""user_id"" AS ""seller_id"",CASE WHEN ""t3"".""item_brand"" IS NULL THEN 'no' ELSE CASE WHEN ""t1"".""favorite_brand""=""t3"".""item_brand"" THEN 'yes' ELSE 'no' END END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""t1"" LEFT JOIN (SELECT * FROM ""users_sale_rank"" WHERE ""sale_rank""=2) AS ""t2"" ON ""t2"".""seller_id""=""t1"".""user_id"") LEFT JOIN ""items"" AS ""t3"" ON ""t3"".""item_id""=""t2"".""item_id"" ORDER BY ""t1"".""user_id"""
133,"WITH ""CTE"" AS (SELECT ""A"".""seller_id"",'yes' AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""A"" JOIN ""Items"" ON ""Items"".""item_id""=""A"".""item_id"") JOIN ""Users"" ON ""Users"".""user_id""=""A"".""seller_id"" WHERE ""Users"".""favorite_brand""=""Items"".""item_brand"" AND ""rk""=2) SELECT * FROM ""CTE"" UNION ALL SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""Users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""CTE"")"
134,"WITH ""T"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_no"" FROM ""Orders"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN (SELECT ""c"".*,""d"".""item_brand"" FROM ""T"" AS ""c"" LEFT JOIN ""Items"" AS ""d"" ON ""c"".""item_id""=""d"".""item_id"" WHERE ""c"".""order_no""=2) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
135,"WITH ""second_item"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders""), ""all_details"" AS (SELECT ""sec"".""seller_id"",""i"".""item_brand"" AS ""second_item"" FROM ""second_item"" AS ""sec"" LEFT JOIN ""items"" AS ""i"" ON ""sec"".""item_id""=""i"".""item_id"" WHERE ""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""second_item""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""all_Details"" AS ""a"" ON ""u"".""user_id""=""a"".""seller_id"""
136,"WITH ""joined"" AS (SELECT ""a"".*,""b"".""favorite_brand"",""c"".""item_brand"",RANK() OVER (PARTITION BY ""a"".""seller_id"" ORDER BY ""a"".""order_date"") AS ""rank_num"" FROM (""Orders"" AS ""a"" LEFT JOIN ""Users"" AS ""b"" ON ""a"".""seller_id""=""b"".""user_id"") LEFT JOIN ""Items"" AS ""c"" ON ""a"".""item_id""=""c"".""item_id"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""favorite_brand"" IS NOT NULL AND ""b"".""item_brand"" IS NOT NULL AND ""b"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT DISTINCT ""user_id"" FROM ""Users"") AS ""a"" LEFT JOIN ""joined"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" AND ""b"".""rank_num""=2"
137,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" AND ""sales"">=2 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"",""favorite_brand"",COALESCE(""item_id"", 0) AS ""item_id"",COALESCE(RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date""), 1) AS ""rk"",COUNT(""user_id"") OVER (PARTITION BY ""user_id"") AS ""sales"" FROM ""Users"" AS ""a"" LEFT JOIN ""Orders"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"") AS ""x"" LEFT JOIN ""Items"" AS ""y"" ON ""x"".""item_id""=""y"".""item_id"" WHERE ""rk""=2 OR (""rk""=1 AND ""sales""<2)"
138,"SELECT ""seller_id"",CASE WHEN SUM(""2nd"")=1 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""seller_id"",CASE WHEN ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"")=2 AND ""favorite_brand""=""item_brand"" THEN 1 ELSE 0 END AS ""2nd"" FROM (""Orders"" AS ""o"" JOIN ""Users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""sub"" GROUP BY ""seller_id"" UNION ALL SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""Users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""Orders"")"
139,"SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" LEFT JOIN (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranking"" FROM ""Orders"") AS ""A"" ON ""A"".""seller_id""=""Users"".""user_id"" AND ""A"".""ranking""=2) LEFT JOIN ""Items"" ON ""A"".""item_id""=""Items"".""item_id"""
140,"WITH ""CTE"" AS (SELECT * FROM (SELECT ""B"".""Seller_Id"" AS ""user_id"",""C"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""B"".""Seller_Id"" ORDER BY ""B"".""order_date"") AS ""Order_Seq"" FROM ""Orders"" AS ""B"" LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"") AS ""Data_set"" WHERE ""Order_Seq""=2) SELECT ""Users"".""User_id"" AS ""seller_id"",COALESCE(CASE WHEN (""CTE"".""item_brand""=""Users"".""favorite_brand"") AND ""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""CTE"" ON ""Users"".""user_id""=""CTE"".""user_id"""
141,"WITH ""t1"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""t2"" AS (SELECT * FROM ""t1"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""t2"" ON ""u"".""user_id""=""t2"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""t2"".""item_id""=""i"".""item_id"""
142,"WITH ""cte"" AS (SELECT ""seller_id"",""item_id"" AS ""good_sold"" FROM (SELECT ""seller_id"",""item_id"",""i"".""item_brand"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""o"" JOIN ""Items"" AS ""i"" USING (""item_id"")) AS ""a"" WHERE ""rnk""=2), ""temp1"" AS (SELECT ""user_id"",""i"".""item_id"" AS ""user_fav_item"" FROM ""users"" AS ""u"" JOIN ""items"" AS ""i"" ON ""u"".""favorite_brand""=""i"".""item_brand""), ""temp2"" AS (SELECT ""seller_id"" FROM (""cte"") CROSS JOIN ""temp1"" WHERE ""seller_id""=""user_id"" AND ""good_sold""=""user_fav_item"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""temp2"" ON ""users"".""user_id""=""temp2"".""seller_id"""
143,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""u"".""favorite_brand""=""temp"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (SELECT * FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""dateRank"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t"" WHERE ""dateRank""=2) AS ""temp"" RIGHT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""temp"".""seller_id"""
144,"WITH ""t1"" AS (SELECT DISTINCT ""o"".""seller_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rank"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""t1"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""t1"" ON ""u"".""user_id""=""t1"".""seller_id"" AND ""t1"".""rank""=2"
145,"WITH ""temp"" AS (SELECT * FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""a"" WHERE ""a"".""rnk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""temp"" JOIN ""items"" ON ""temp"".""item_id""=""items"".""item_id"") RIGHT JOIN ""users"" ON ""temp"".""seller_id""=""users"".""user_id"""
146,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""o"".""seller_id"",""favorite_brand"",""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""order_date"") AS ""ra"" FROM (""orders"" AS ""o"" JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" RIGHT JOIN ""users"" AS ""u"" ON ""a"".""seller_id""=""u"".""user_id"" AND ""a"".""ra""=2"
147,"WITH ""ranks"" AS (SELECT ""order_id"",""item_id"",""order_date"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranking"" FROM ""Orders""), ""summ"" AS (SELECT ""u"".""user_id"",COALESCE(""r"".""ranking"", 0) AS ""r"",""i"".""item_brand"" AS ""ib"",""u"".""favorite_brand"" AS ""fb"" FROM (""Users"" AS ""u"" LEFT JOIN ""ranks"" AS ""r"" ON ""u"".""user_id""=""r"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""r"".""item_id"") SELECT ""s"".""user_id"" AS ""seller_id"",CASE WHEN (""s"".""ib""=""s"".""fb"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""summ"" AS ""s"" WHERE ""s"".""r""=2 UNION SELECT ""s"".""user_id"" AS ""seller_id"",'no' FROM ""summ"" AS ""s"" WHERE ""s"".""user_id"" IN (SELECT ""summ"".""user_id"" FROM ""summ"" GROUP BY ""summ"".""user_id"" HAVING COUNT(""summ"".""user_id"")<=1)"
148,"WITH ""CTE"" AS (SELECT ""u"".""user_id"",""u"".""favorite_brand"",""o"".""order_id"",""o"".""order_date"",""o"".""item_id"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""order_sold"" FROM ""Users"" AS ""u"" LEFT JOIN ""ORDERS"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"" UNION SELECT ""u"".""user_id"",""u"".""favorite_brand"",""o"".""order_id"",""o"".""order_date"",""o"".""item_id"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""order_sold"" FROM ""Users"" AS ""u"" RIGHT JOIN ""ORDERS"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id""), ""CTE2"" AS (SELECT ""CTE"".""user_id"",""CTE"".""favorite_brand"",""CTE"".""order_id"",""CTE"".""order_date"",""CTE"".""item_id"",""CTE"".""order_sold"",""i"".""item_brand"" FROM ""CTE"" LEFT JOIN ""Items"" AS ""i"" ON ""CTE"".""item_id""=""i"".""item_id""), ""CTE3"" AS (SELECT ""a"".""user_id"" AS ""seller_id"",(CASE WHEN ""a"".""order_id"" IS NOT NULL AND ""a"".""favorite_brand""=""a"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""CTE2"" AS ""a"" WHERE ""a"".""order_sold""=2) SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""b"".""2nd_item_fav_brand"" IS NULL THEN 'no' ELSE ""b"".""2nd_item_fav_brand"" END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""CTE3"" AS ""b"" ON ""u"".""user_id""=""b"".""seller_id"" ORDER BY ""u"".""user_id"""
149,"SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT ""x"".""seller_id"",""x"".""item_id"",""y"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""x"".""seller_id"" ORDER BY ""x"".""order_date"") AS ""row_cnt"" FROM ""orders"" AS ""x"" JOIN ""items"" AS ""y"" ON ""x"".""item_id""=""y"".""item_id"") AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" AND ""b"".""row_cnt""=2"
150,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""t"".""item_id"" IS NULL THEN 'no' ELSE CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""t"" WHERE ""rnk""=2) AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
151,"WITH ""prep"" AS (SELECT ""o"".*,""u"".""user_id"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rn"",CASE WHEN LEAD(""i"".""item_brand"", 1) OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"")=""u"".""favorite_brand"" THEN 1 ELSE 0 END AS ""IsNextFavorite"" FROM (""orders"" AS ""o"" LEFT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id""), ""prep2"" AS (SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""IsNextFavorite""=1 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""prep"" WHERE ""rn""=1) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""prep2"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""prep2"" ON ""u"".""user_id""=""prep2"".""seller_id"" ORDER BY 1"
152,"WITH ""order_fliter"" AS (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank_date"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""second_item"" AS (SELECT ""seller_id"",""item_brand"" FROM ""order_fliter"" WHERE ""rank_date""=2) SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""second_item"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
153,"WITH ""tmp"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r_number"" FROM ""Orders"") AS ""ina"" WHERE ""r_number""=2) SELECT ""ina"".""user_id"" AS ""seller_id"",CASE WHEN ""ina"".""favorite_brand""=""inc"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""ina"" LEFT JOIN ""tmp"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""seller_id"") LEFT JOIN ""Items"" AS ""inc"" ON ""inb"".""item_id""=""inc"".""item_id"""
154,"WITH ""CTE"" AS (SELECT * FROM (SELECT ""B"".""Seller_Id"" AS ""user_id"",""C"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""B"".""Seller_Id"" ORDER BY ""order_date"") AS ""Order_Seq"" FROM ""Orders"" AS ""B"" LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"") AS ""Data_set"" WHERE ""Order_Seq""=2) SELECT ""Users"".""User_id"" AS ""seller_id"",COALESCE(CASE WHEN (""CTE"".""item_brand""=""Users"".""favorite_brand"") AND ""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""CTE"" ON ""Users"".""user_id""=""CTE"".""user_id"""
155,"SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN (SELECT * FROM (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""Sell_Idx"",""item_brand"" FROM ""Orders"" LEFT JOIN ""Items"" ON ""Orders"".""item_id""=""Items"".""item_id"") AS ""Orders_1"" WHERE ""Sell_Idx""=2) AS ""Orders_2"" ON ""Users"".""user_id""=""Orders_2"".""seller_id"""
156,"WITH ""cts"" AS (SELECT ""seller_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_num"",""item_brand"" FROM ""Orders"" JOIN ""Items"" ON ""Orders"".""item_id""=""Items"".""item_id"") SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN COALESCE(COUNT(""cts"".""seller_id""), 0)=0 THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""cts"" ON ""Users"".""user_id""=""cts"".""seller_id"" AND ""cts"".""row_num""=2 AND ""Users"".""favorite_brand""=""cts"".""item_brand"" GROUP BY ""Users"".""user_id"""
157,"WITH ""TEMP"" AS (SELECT ""a"".""seller_id"",""a"".""item_id"",""b"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank"" FROM ""Orders"" AS ""a"" LEFT JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' WHEN ""u"".""favorite_brand""!=""b"".""item_brand"" THEN 'no' WHEN ""b"".""item_brand"" IS NULL THEN 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT * FROM ""TEMP"" WHERE ""TEMP"".""rank""=2) AS ""b"" ON ""u"".""user_id""=""b"".""seller_id"" ORDER BY 1"
158,"WITH ""rankedTable"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranked"",""i1"".""item_brand"" FROM ""Orders"" AS ""o1"" LEFT JOIN ""Items"" AS ""i1"" ON ""i1"".""item_id""=""o1"".""item_id""), ""rankedTable2"" AS (SELECT * FROM ""rankedTable"" WHERE ""ranked""=2) SELECT ""u1"".""user_id"" AS ""seller_id"",CASE WHEN ""r1"".""item_brand""=""u1"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u1"" LEFT JOIN ""rankedTable2"" AS ""r1"" ON ""u1"".""user_id""=""r1"".""seller_id"""
159,"WITH ""cte"" AS (SELECT ""o"".""seller_id"" AS ""user_id"",""i"".""item_brand"" AS ""brand"",DENSE_RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""itemSaleRank"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN MAX(""c"".""itemSaleRank"")<2 THEN 'no' WHEN ""u"".""favorite_brand""=""c"".""brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""user_id"",""brand"",""itemSaleRank"" FROM ""cte"" WHERE ""itemSaleRank""=2) AS ""c"" ON ""u"".""user_id""=""c"".""user_id"" GROUP BY 1"
160,"WITH ""a"" AS (SELECT ""item_id"",""seller_id"" FROM (SELECT ""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sellrank"" FROM ""orders"") AS ""sub"" WHERE ""sellrank""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" LEFT JOIN ""a"" ON ""users"".""user_id""=""a"".""seller_id"") LEFT JOIN ""items"" ON ""a"".""item_id""=""items"".""item_id"""
161,"WITH ""A"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""Ranking"" FROM ""Orders""), ""B"" AS (SELECT ""seller_id"",""item_brand"" FROM ""A"" JOIN ""Items"" AS ""I"" ON ""A"".""item_id""=""I"".""item_id"" WHERE ""Ranking""=2) SELECT ""Users"".""user_id"" AS ""seller_id"",(CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""B"" RIGHT JOIN ""Users"" ON ""B"".""seller_id""=""Users"".""user_id"" ORDER BY ""user_id"""
162,"WITH ""M"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders"") AS ""S"" WHERE ""rn""=2) SELECT DISTINCT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""I"".""item_brand""=""U"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""M"" RIGHT JOIN ""Users"" AS ""U"" ON ""M"".""seller_id""=""U"".""user_id"") LEFT JOIN ""Items"" AS ""I"" ON ""M"".""item_id""=""I"".""item_id"""
163,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT * FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""a"") AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"" AND ""o"".""rnk""=2) LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"" ORDER BY ""u"".""user_id"""
164,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id""=""seller_id"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"",""seller_id"" FROM ""Users"" LEFT JOIN (SELECT ""seller_id"" FROM (SELECT ""order_date"",""seller_id"",""item_brand"",""favorite_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM (SELECT ""order_id"",""order_date"",""buyer_id"",""seller_id"",""item_brand"" FROM ""Orders"" LEFT JOIN ""Items"" ON ""Items"".""item_id""=""Orders"".""item_id"") AS ""a"" LEFT JOIN ""Users"" ON ""Users"".""user_id""=""a"".""seller_id"") AS ""b"" WHERE ""rk""=2 AND ""item_brand""=""favorite_brand"") AS ""z"" ON ""Users"".""user_id""=""z"".""seller_id"") AS ""aa"""
165,"SELECT DISTINCT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",CASE WHEN ""sale_num""=2 AND ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""o"".""seller_id"",""o"".""order_date"",""i"".""item_brand"",""u"".""favorite_brand"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""sale_num"" FROM (""Orders"" AS ""o"" LEFT JOIN ""Users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"" ORDER BY ""o"".""order_date"") AS ""sub1"" WHERE ""sale_num""=2) AS ""sub2"" ON ""u"".""user_id""=""sub2"".""seller_id"""
166,"SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""a"" LEFT JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"") AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" AND ""rn""=2) LEFT JOIN ""items"" USING (""item_id"")"
167,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""order_rnk"" FROM ""orders"" AS ""o"" JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") AS ""a"" WHERE ""order_rnk""=2) AS ""b"" ON ""u"".""user_id""=""b"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""b"".""item_id"" ORDER BY ""u"".""user_id"""
168,"WITH ""cte"" AS (SELECT ""user_id"",""favorite_brand"",""item_brand"",""order_date"",DENSE_RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""orders"" AS ""o"" RIGHT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") RIGHT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""seller_id"",(CASE WHEN ""favorite_brand"" IS NULL THEN 'no' WHEN ""favorite_brand""!=""item_brand"" THEN 'no' WHEN ""favorite_brand""=""item_brand"" THEN 'yes' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"" AS ""seller_id"",""cte"".""favorite_brand"" AS ""favorite_brand"",""cte"".""item_brand"" AS ""item_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""user_id"" AND ""rnk""=2) AS ""a"""
169,"WITH ""CTE"" AS (SELECT * FROM (SELECT ""B"".""Seller_Id"" AS ""user_id"",""C"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""B"".""Seller_Id"" ORDER BY ""order_date"") AS ""Order_Seq"" FROM ""Orders"" AS ""B"" LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"") AS ""Data_set"" WHERE ""Order_Seq""=2) SELECT ""Users"".""User_id"" AS ""seller_id"",COALESCE(CASE WHEN (""CTE"".""item_brand""=""Users"".""favorite_brand"") AND ""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""CTE"" ON ""Users"".""user_id""=""CTE"".""user_id"""
170,"WITH ""second_item"" AS (SELECT ""seller_id"",""order_id"",""order_date"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_index"" FROM ""Orders""), ""tmp1"" AS (SELECT ""seller_id"",""order_date"",""item_id"" FROM ""second_item"" WHERE ""row_index""=2) SELECT ""t3"".""user_id"" AS ""seller_id"",CASE WHEN ""t2"".""item_brand""=""t3"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""tmp1"" AS ""t1"" LEFT JOIN ""Items"" AS ""t2"" ON ""t1"".""item_id""=""t2"".""item_id"") RIGHT JOIN ""Users"" AS ""t3"" ON ""t1"".""seller_id""=""t3"".""user_id"""
171,"WITH ""has_2nd"" AS (SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""has_2nd"" FROM (SELECT ""a"".""user_id"",""a"".""favorite_brand"",""c"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""a"".""user_id"" ORDER BY ""b"".""order_date"") AS ""row_num"" FROM (""users"" AS ""a"" LEFT JOIN ""orders"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"") LEFT JOIN ""items"" AS ""c"" ON ""b"".""item_id""=""c"".""item_id"") AS ""tmp"" WHERE ""row_num""=2) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NULL THEN 'no' ELSE ""b"".""has_2nd"" END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""has_2nd"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
172,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""Cte0"" AS (SELECT * FROM ""cte"" WHERE ""rnk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte0"" ON ""u"".""user_id""=""cte0"".""seller_id"" GROUP BY ""u"".""user_id"""
173,"SELECT ""Users"".""user_id"" AS ""seller_id"",(CASE WHEN ""a"".""same_or_no""=1 AND ""a"".""n_sale""=2 THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN (SELECT ""seller_id"",""n_sale"",""same_or_no"" FROM (SELECT ""o"".""order_id"",""o"".""order_date"",""o"".""item_id"",""I"".""item_brand"",""sell"".""user_id"" AS ""seller_id"",""sell"".""favorite_brand"" AS ""seller_fav_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""n_sale"",(CASE WHEN ""item_brand""=""sell"".""favorite_brand"" THEN 1 ELSE 0 END) AS ""same_or_no"" FROM (""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""I"" ON ""o"".""item_id""=""I"".""item_id"") JOIN ""Users"" AS ""sell"" ON ""o"".""seller_id""=""sell"".""user_id"") AS ""a"" WHERE ""n_sale""=2) AS ""a"" ON ""Users"".""user_id""=""a"".""seller_id"""
174,"WITH ""second_item"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" WHERE ""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""s"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""second_item"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
175,"WITH ""all_data"" AS (SELECT ""order_id"",""order_date"",""I"".""item_id"",""item_brand"",""buyer_id"",""seller_id"",""favorite_brand"" AS ""seller_favorite_brand"" FROM (""Orders"" AS ""O"" LEFT JOIN ""Users"" AS ""U"" ON ""O"".""seller_id""=""U"".""user_id"") LEFT JOIN ""Items"" AS ""I"" ON ""O"".""item_id""=""I"".""item_id""), ""second_date"" AS (SELECT ""seller_id"",""item_brand"",""seller_favorite_brand"",""order_date"",""date_rnk"" FROM (SELECT ""seller_id"",""item_brand"",""seller_favorite_brand"",""order_date"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""date_rnk"" FROM ""all_data"") AS ""A"" WHERE ""date_rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""date_rnk"" IS NULL THEN 'no' WHEN ""item_brand""=""seller_favorite_brand"" THEN 'yes' WHEN ""item_brand""!=""seller_favorite_brand"" THEN 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""second_date"" AS ""sd"" ON ""u"".""user_id""=""sd"".""seller_id"""
176,"WITH ""ranked_orders"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rrank"" FROM ""orders""), ""second_order"" AS (SELECT ""seller_id"",""item_brand"" FROM ""ranked_orders"" AS ""r"" JOIN ""items"" AS ""i"" ON ""r"".""item_id""=""i"".""item_id"" WHERE ""rrank""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""second_order"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
177,"WITH ""a"" AS (SELECT ""u"".""user_id"",""o"".""order_date"",""o"".""item_id"",""i"".""item_brand"",""u"".""favorite_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rn"" FROM (""Users"" AS ""u"" JOIN ""orders"" AS ""o"" ON ""o"".""seller_id""=""u"".""user_id"") JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT DISTINCT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""user_id"" IS NULL THEN 'no' WHEN ""a"".""item_brand""=""a"".""favorite_brand"" THEN 'yes' WHEN ""a"".""item_brand""!=""a"".""favorite_brand"" THEN 'no' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""a"" RIGHT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""a"".""user_id"" AND ""rn""=2"
178,"WITH ""t1"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""order_id"",""order_date"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM (""Orders"" AS ""o"" LEFT JOIN ""Users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""t"" WHERE ""rk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""t1"" RIGHT JOIN ""Users"" AS ""u2"" ON ""t1"".""seller_id""=""u2"".""user_id"""
179,"WITH ""t"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnum"" FROM ""Orders"" JOIN ""Items"" ON ""Items"".""item_id""=""Orders"".""item_id"") AS ""t"" WHERE ""rnum""=2) SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN COUNT(""Orders"".""order_id"")<2 THEN 'no' ELSE CASE WHEN ""Users"".""favorite_brand""=""t"".""item_brand"" THEN 'yes' ELSE 'no' END END AS ""2nd_item_fav_brand"" FROM (""Users"" LEFT JOIN ""Orders"" ON ""Users"".""user_id""=""Orders"".""seller_id"") LEFT JOIN ""t"" ON ""Orders"".""seller_id""=""t"".""seller_id"" GROUP BY ""Users"".""user_id"""
180,"WITH ""Item2nd"" AS (SELECT * FROM (SELECT ""Orders"".*,""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""Rowed"" FROM ""Orders"" LEFT JOIN ""Items"" ON ""Orders"".""item_id""=""Items"".""item_id"") AS ""O"" WHERE ""Rowed""=2) SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""Item2nd"" ON ""Users"".""user_id""=""Item2nd"".""seller_id"""
181,"WITH ""temp"" AS (SELECT ""seller_id"",""o"".""item_id"",""i"".""item_brand"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranking"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""temp1"" AS (SELECT ""seller_id"",""item_brand"" FROM ""temp"" WHERE ""ranking""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""temp1"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""temp1"" ON ""u"".""user_id""=""temp1"".""seller_id"""
182,"WITH ""CTE"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""T"" WHERE ""rnk""=2) SELECT DISTINCT ""seller_id"",CASE WHEN ""favorite_brand""=""brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"" AS ""seller_id"",""favorite_brand"",COALESCE(""CTE"".""item_brand"", 0) AS ""brand"" FROM ""users"" AS ""u"" LEFT JOIN ""CTE"" ON ""u"".""user_id""=""CTE"".""seller_id"") AS ""D"""
183,"WITH ""t2"" AS (SELECT ""user_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"",""favorite_brand"",""item_brand"",RANK() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""order_date"") AS ""sell_rk"" FROM (""users"" AS ""u"" JOIN ""orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""temp"" WHERE ""sell_rk""=2) SELECT ""users"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""t2"" ON ""t2"".""user_id""=""users"".""user_id"""
184,"WITH ""tmp"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"",""b"".""item_brand"" FROM ""Orders"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id""), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""ranks""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""tmp2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
185,"WITH ""temp"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""idx"" FROM ""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""temp"" WHERE ""idx""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""!=""t"".""item_brand"" OR ""t"".""item_brand"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""temp"" AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"""
186,"WITH ""t2"" AS (SELECT ""seller_id"",COUNT(1) AS ""cnt"",MAX(CASE WHEN ""RNUM""=2 THEN ""item_brand"" ELSE NULL END) AS ""item2"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rnum"" FROM ""Orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t1"" GROUP BY ""seller_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN COALESCE(""cnt"", 0)<2 THEN 'no' WHEN ""favorite_brand""!=""item2"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""t2"" ON ""t2"".""seller_id""=""u"".""user_id"""
187,"SELECT ""t1"".""user_id"" AS ""seller_id"",CASE WHEN ""t2"".""item_brand"" IS NULL THEN 'no' WHEN ""t1"".""favorite_brand""!=""t2"".""item_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""t1"" LEFT JOIN (SELECT ""t"".* FROM (SELECT ""t1"".""seller_id"",""t1"".""order_date"",""t1"".""item_id"",""t2"".""item_brand"",RANK() OVER (PARTITION BY ""t1"".""seller_id"" ORDER BY ""t1"".""order_date"") AS ""rank"" FROM ""orders"" AS ""t1"" JOIN ""items"" AS ""t2"" ON ""t2"".""item_id""=""t1"".""item_id"") AS ""t"" WHERE ""t"".""rank""=2) AS ""t2"" ON ""t2"".""seller_id""=""t1"".""user_id"" ORDER BY ""t1"".""user_id"""
188,"WITH ""A"" AS (SELECT ""seller_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_rank"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""B"" AS (SELECT ""seller_id"",""item_brand"" FROM ""A"" WHERE ""order_rank""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""B"" ON ""u"".""user_id""=""B"".""seller_id"""
189,"SELECT ""b"".""user_id"" AS ""seller_id"",CASE WHEN ""c"".""item_brand""=""b"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""b"" LEFT JOIN (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row1"" FROM ""orders"") AS ""t"" WHERE ""t"".""row1""=2) AS ""t"" ON ""t"".""seller_id""=""b"".""user_id"") LEFT JOIN ""items"" AS ""c"" ON ""t"".""item_id""=""c"".""item_id"""
190,"WITH ""t"" AS (SELECT * FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_rnk"" FROM ""Orders"") AS ""tmp"" WHERE ""order_rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""t"" ON ""t"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
191,"WITH ""second"" AS (SELECT ""seller_id"",""item_id"",""rnk"" FROM (SELECT ""seller_id"",""order_date"",""item_Id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""orderr"" WHERE ""rnk""=2) SELECT ""user_id"" AS ""seller_Id"",CASE WHEN ""s"".""seller_id"" IS NULL OR ""i"".""item_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""second"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_brand""=""u"".""favorite_brand"" AND ""s"".""item_Id""=""i"".""item_Id"""
192,"WITH ""t1"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""t2"" AS (SELECT * FROM ""t1"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""t2"" ON ""u"".""user_id""=""t2"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""t2"".""item_id""=""i"".""item_id"""
193,"ERROR: mysql parse error: line 1 column 109 near ""), cte as ( select u.user_id as seller_id, case when u.favorite_brand = i.item_brand and rr = 2 then 'yes' when u.favorite_brand != i.item_brand and rr = 2 then 'no' when max(rr) OVER(partition by seller_id) < 2 then 'no' when rr is null then 'no' else NULL end as 2nd_item_fav_brand from second s join Items i USING (item_id) right join Users u on s.seller_id = u.user_id ) select * from cte where 2nd_item_fav_brand is not null "" "
194,"WITH ""second_sell"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank_buys"",""item_id"" FROM ""Orders"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""a"" LEFT JOIN (SELECT * FROM ""second_sell"" WHERE ""rank_buys""=2) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"") LEFT JOIN ""Items"" AS ""c"" ON ""b"".""item_id""=""c"".""item_id"" ORDER BY ""a"".""user_id"""
195,"WITH ""cte"" AS (SELECT ""user_id"",""favorite_brand"",""item_brand"",""order_date"",DENSE_RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""orders"" AS ""o"" RIGHT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") RIGHT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"" AS ""seller_id"",""cte"".""favorite_brand"" AS ""favorite_brand"",""cte"".""item_brand"" AS ""item_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""user_id"" AND ""rnk""=2) AS ""a"""
196,"WITH ""cte"" AS (SELECT ""user_id"" FROM ""users"" AS ""u"" JOIN ""orders"" AS ""o"" ON ""o"".""seller_id""=""user_id"" GROUP BY 1 HAVING COUNT(1)>=2), ""cte1"" AS (SELECT ""user_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""cte"" AS ""c"" JOIN ""orders"" AS ""o"" ON ""c"".""user_id""=""o"".""seller_id"") JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT * FROM ""cte1"" WHERE ""rnk""=2) AS ""c1"" ON ""u"".""user_id""=""c1"".""user_id"""
197,"WITH ""t1"" AS (SELECT ""o"".""seller_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""item_brand"" IS NULL OR ""a"".""item_brand""!=""u"".""favorite_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM ""t1"" WHERE ""rnk""=2) AS ""a"" ON ""u"".""user_id""=""a"".""seller_id"""
198,"WITH ""tmp"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"" NATURAL CROSS JOIN ""items""), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""rn""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""seller_id"" IS NULL OR ""favorite_brand""!=""item_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""tmp2"" ON ""user_id""=""seller_id"""
199,"WITH ""cte"" AS (SELECT * FROM (SELECT ""user_id"" AS ""seller_id"",""favorite_brand"",""item_brand"",RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""user_id"") AS ""order_count"" FROM (""users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""t"" WHERE ""rnk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""u"".""favorite_brand"" AND ""order_count"">1 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""seller_id"""
200,"WITH ""second_sold"" AS (SELECT * FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""s"".""item_brand"" IS NULL THEN 'no' WHEN ""s"".""item_brand""!=""favorite_brand"" THEN 'no' WHEN ""s"".""item_brand""=""favorite_brand"" THEN 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""second_sold"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
201,"WITH ""cte"" AS (SELECT ""o"".""seller_id"",(CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM (""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM (SELECT ""seller_id"",""2nd_item_fav_brand"" FROM ""cte"" AS ""c"" WHERE ""r""=2) AS ""t"" RIGHT JOIN ""users"" AS ""u"" ON ""t"".""seller_id""=""u"".""user_id"""
202,"WITH ""t"" AS (SELECT * FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_rnk"" FROM ""Orders"") AS ""tmp"" WHERE ""order_rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""t"" ON ""t"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
203,"WITH ""base"" AS (SELECT ""a"".*,""b"".""item_brand"",""c"".""favorite_brand"",ROW_NUMBER() OVER (PARTITION BY ""a"".""seller_id"" ORDER BY ""a"".""order_date"") AS ""rk"" FROM (""Orders"" AS ""a"" LEFT JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") LEFT JOIN ""Users"" AS ""c"" ON ""a"".""seller_id""=""c"".""user_id"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NULL THEN 'no' WHEN ""b"".""item_brand""=""b"".""favorite_brand"" THEN 'yes' WHEN ""b"".""item_brand""!=""b"".""favorite_brand"" THEN 'no' ELSE NULL END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN (SELECT * FROM ""base"" WHERE ""rk""=2) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
204,"WITH ""b"" AS (SELECT * FROM (SELECT ""seller_id"",""o"".""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank_"",""item_brand"" FROM ""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" WHERE ""rank_""=2 ORDER BY ""seller_id"") SELECT ""c"".""user_id"" AS ""seller_id"",CASE WHEN ""c"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""c"" LEFT JOIN ""b"" ON ""c"".""user_id""=""b"".""seller_id"""
205,"WITH ""tmp"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"",""b"".""item_brand"" FROM ""Orders"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id""), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""ranks""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""tmp2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
206,"WITH ""temp"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""idx"" FROM ""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""temp"" WHERE ""idx""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""!=""t"".""item_brand"" OR ""t"".""item_brand"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""temp"" AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"""
207,"WITH ""second"" AS (SELECT ""t"".""order_id"",""t"".""seller_id"",""t"".""item_brand"" FROM (SELECT ""o"".""order_id"",""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""r"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""t"" WHERE ""t"".""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""s"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""second"" AS ""s"" ON ""s"".""seller_id""=""u"".""user_id"""
208,"SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN ""Items"".""item_brand""=""Users"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"" FROM (SELECT ""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" WHERE ""seller_id"" IN (SELECT ""seller_id"" FROM ""Orders"" GROUP BY ""seller_id"" HAVING COUNT(""order_id"")>1)) AS ""B"" WHERE ""rnk""=2) AS ""A"" LEFT JOIN ""Items"" ON ""A"".""item_id""=""Items"".""item_id"") RIGHT JOIN ""Users"" ON ""A"".""seller_id""=""Users"".""user_id"" ORDER BY ""Users"".""user_id"""
209,"WITH ""data_table"" AS (SELECT ""seller_id"",""u"".""favorite_brand"" AS ""favorite_brand"",""o"".""item_id"",""i"".""item_brand"" AS ""item_brand"",""order_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sale_rank"" FROM (""orders"" AS ""o"" LEFT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id""), ""second_data"" AS (SELECT * FROM ""data_table"" WHERE ""sale_rank""=2) SELECT ""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""dt"".""favorite_brand""=""dt"".""item_brand"" THEN 'yes' WHEN ""dt"".""favorite_brand""!=""dt"".""item_brand"" THEN 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""second_data"" AS ""dt"" ON ""dt"".""seller_id""=""users"".""user_id"""
210,"WITH ""cet1"" AS (SELECT ""seller_id"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""o""), ""cte2"" AS (SELECT ""seller_id"",""i"".""item_brand"" FROM ""cet1"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""u"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte2"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"" ORDER BY ""u"".""user_id"""
211,"WITH ""cte"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"",""c"".""favorite_brand"" FROM (""orders"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") LEFT JOIN ""users"" AS ""c"" ON ""a"".""seller_id""=""c"".""user_id""), ""yes"" AS (SELECT ""seller_id"" FROM ""cte"" WHERE ""rnk""=2 AND ""favorite_brand""=""item_brand"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NOT NULL THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""yes"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
212,"WITH ""second_day"" AS (SELECT ""t3"".*,""t4"".""favorite_brand"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""fav"" FROM (SELECT ""t1"".*,""t2"".""item_brand"" FROM (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""t1"" LEFT JOIN ""Items"" AS ""t2"" ON ""t1"".""item_id""=""t2"".""item_id"" WHERE ""rnk""=2) AS ""t3"" LEFT JOIN ""Users"" AS ""t4"" ON ""t4"".""user_id""=""t3"".""seller_id"") SELECT ""a"".""user_id"" AS ""seller_id"",COALESCE(""b"".""fav"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""second_day"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" ORDER BY ""user_id"""
213,"ERROR: mysql parse error: line 1 column 109 near ""), cte as ( select u.user_id as seller_id, case when u.favorite_brand = i.item_brand and rr = 2 then 'yes' when u.favorite_brand != i.item_brand and rr = 2 then 'no' when max(rr) OVER(partition by seller_id) < 2 then 'no' when rr is null then 'no' else NULL end as 2nd_item_fav_brand from second s join Items i USING (item_id) right join Users u on s.seller_id = u.user_id ) select * from cte where 2nd_item_fav_brand is not null "" "
214,"WITH ""rankng"" AS (SELECT ""user_id"",""favorite_brand"",""item_brand"",""order_date"",DENSE_RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""orders"" AS ""o"" RIGHT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") RIGHT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"" AS ""seller_id"",""rankng"".""favorite_brand"" AS ""favorite_brand"",""rankng"".""item_brand"" AS ""item_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""rankng"" ON ""u"".""user_id""=""rankng"".""user_id"" AND ""rnk""=2) AS ""a"""
215,"WITH ""T1"" AS (SELECT ""t1"".""seller_id"",""b"".""item_brand"" FROM (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row1"" FROM ""orders"") AS ""t"" WHERE ""row1""=2) AS ""t1"" JOIN ""items"" AS ""b"" ON ""b"".""item_id""=""t1"".""item_id"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""T1"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
216,"WITH ""cte"" AS (SELECT ""user_id"" FROM ""users"" AS ""u"" JOIN ""orders"" AS ""o"" ON ""o"".""seller_id""=""user_id"" GROUP BY 1 HAVING COUNT(1)>=2), ""cte1"" AS (SELECT ""user_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""cte"" AS ""c"" JOIN ""orders"" AS ""o"" ON ""c"".""user_id""=""o"".""seller_id"") JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT * FROM ""cte1"" WHERE ""rnk""=2) AS ""c1"" ON ""u"".""user_id""=""c1"".""user_id"""
217,"WITH ""second_sold"" AS (SELECT ""seller_id"",""item_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank_sold"" FROM ""Orders"" ORDER BY ""seller_id""), ""fav_brand"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"",""c"".""favorite_brand"" FROM (""second_sold"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") JOIN ""Users"" AS ""c"" ON ""a"".""seller_id""=""c"".""user_id"" WHERE ""rank_sold""=2) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""item_brand""=""b"".""favorite_brand"" THEN 'yes' WHEN ""item_brand"" IS NULL THEN 'no' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""fav_brand"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
218,"WITH ""second_order"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""order_date"",""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""sub"" WHERE ""rnk""=2), ""brand"" AS (SELECT ""s"".""seller_id"",""u"".""favorite_brand"" AS ""fav_brand"",""i"".""item_brand"" AS ""brand"" FROM (""second_order"" AS ""s"" JOIN ""items"" AS ""i"" ON ""s"".""item_id""=""i"".""item_id"") JOIN ""users"" AS ""u"" ON ""s"".""seller_id""=""u"".""user_id"") (SELECT ""seller_id"",(CASE WHEN ""fav_brand""=""brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""brand"") UNION (SELECT ""user_id"",'no' AS ""2nd_item_fav_brand"" FROM ""users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""second_order""))"
219,"WITH ""t"" AS (SELECT ""user_id"",""favorite_brand"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"",SUM(""order_id"") OVER (PARTITION BY ""seller_id"") AS ""total"" FROM (""Users"" LEFT JOIN ""Orders"" ON ""Users"".""user_id""=""Orders"".""seller_id"") LEFT JOIN ""Items"" ON ""Orders"".""item_id""=""Items"".""item_id""), ""t1"" AS (SELECT ""user_id"" AS ""seller_id"" FROM ""t"" WHERE ""rk""=2 AND ""item_brand""=""favorite_brand"" AND ""total"">2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT ""seller_id"" FROM ""t1"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" ORDER BY ""seller_id"""
220,"WITH ""c1"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders""), ""c2"" AS (SELECT ""c1"".""seller_id"",""c1"".""item_id"",""i"".""item_brand"",""u"".""favorite_brand"" FROM (""c1"" LEFT JOIN ""Items"" AS ""i"" USING (""item_id"")) LEFT JOIN ""Users"" AS ""u"" ON ""c1"".""seller_id""=""u"".""user_id"" WHERE ""rk""=2), ""c3"" AS (SELECT ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""c2"") SELECT ""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""c3"" ON ""Users"".""user_id""=""c3"".""seller_id"""
221,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN (SELECT ""item_brand"" FROM ""Items"" WHERE ""item_id""=""tmp"".""item_id"")=""Users"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN (SELECT * FROM (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""position"" FROM ""Orders"") AS ""tmp2"" WHERE ""position""=2) AS ""tmp"" ON ""Users"".""user_id""=""tmp"".""seller_id"""
222,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",""o"".""order_date"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""ranking"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"" ORDER BY 1,3) AS ""t"" WHERE ""ranking""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"" ORDER BY 1"
223,"WITH ""tem"" AS (SELECT ""a"".*,""b"".""item_brand"" FROM ""orders"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id""), ""tem2"" AS (SELECT ""seller_id"",""item_brand"" AS ""second_item_brand"" FROM (SELECT ""seller_id"",""order_date"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank_n"" FROM ""tem"") AS ""a"" WHERE ""rank_n""=2), ""tem3"" AS (SELECT ""a"".""seller_id"",CASE WHEN ""a"".""second_item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""tem2"" AS ""a"" JOIN ""users"" AS ""b"" ON ""a"".""seller_id""=""b"".""user_id"") SELECT DISTINCT ""a"".""user_id"" AS ""seller_id"",COALESCE(""b"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""tem3"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
224,"WITH ""cte"" AS (SELECT ""seller_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"",""item_id"" FROM ""orders"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""cte"" ON ""cte"".""seller_id""=""u"".""user_id"" AND ""cte"".""rk""=2) LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""cte"".""item_id"""
225,"WITH RECURSIVE ""seller_id"" AS (SELECT 1 AS ""seller_id"" UNION ALL SELECT ""seller_id""+1 FROM ""seller_id"" WHERE (""seller_id""<(SELECT MAX(""seller_id"") FROM ""Orders""))), ""CTE"" AS (SELECT * FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"" FROM ""Orders"" JOIN ""Items"" ON ""Orders"".""item_id""=""Items"".""item_id"" ORDER BY ""seller_id"") AS ""A"" WHERE ""A"".""ranks""=2), ""FAV"" AS (SELECT ""c"".""seller_id"",(SELECT CASE WHEN ""c"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""CTE"" AS ""c"" JOIN ""Users"" AS ""u"" ON ""c"".""seller_id""=""u"".""user_id"") SELECT ""ss"".""seller_id"",COALESCE(""f"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""seller_id"" AS ""ss"" LEFT JOIN ""FAV"" AS ""f"" ON ""f"".""seller_id""=""ss"".""seller_id"""
226,"WITH ""b"" AS (SELECT * FROM (SELECT ""b"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""favorite_brand""=""c"".""item_brand"" THEN 1 ELSE 0 END AS ""Fav_Item_Sold"",ROW_NUMBER() OVER (PARTITION BY ""a"".""seller_id"" ORDER BY ""a"".""order_date"") AS ""Order_Number"" FROM (""users"" AS ""b"" JOIN ""orders"" AS ""a"" ON ""a"".""seller_id""=""b"".""user_id"") JOIN ""items"" AS ""c"" ON ""c"".""item_id""=""a"".""item_id"") AS ""a"" WHERE ""Fav_Item_Sold""=1 AND ""Order_Number""=2) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
227,"WITH ""base"" AS (SELECT ""seller_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""seq"" FROM ""Orders"" AS ""a"" LEFT JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN ""base"".""item_brand""=""users"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""base"" ON ""base"".""seller_id""=""users"".""user_id"" AND ""base"".""seq""=2"
228,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' WHEN ""u"".""favorite_brand""!=""i"".""item_brand"" AND ""i"".""item_brand"" IS NOT NULL THEN 'no' WHEN ""i"".""item_brand"" IS NULL THEN 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_rank"" FROM ""orders"") AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""t"".""sold_rank""=2) LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
229,"WITH ""t"" AS (SELECT ""orders"".""seller_id"",""users"".""favorite_brand"",""items"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"" FROM ((""orders"") CROSS JOIN ""users"") CROSS JOIN ""items"" WHERE ""orders"".""seller_id""=""users"".""user_id"" AND ""orders"".""item_id""=""items"".""item_id"" ORDER BY ""seller_id"") SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN ""t"".""favorite_brand"" IS NULL THEN 'no' WHEN ""t"".""favorite_brand""=""t"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""t"" ON ""users"".""user_id""=""t"".""seller_id"" AND ""t"".""ranks""=2"
230,"WITH ""cte"" AS (SELECT ""o"".""seller_id"",""o"".""item_id"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""o"" WHERE ""o"".""rk""=2), ""brand"" AS (SELECT ""user_id"" FROM ""Items"" AS ""i"" JOIN ""Users"" AS ""u"" ON ""u"".""favorite_brand""=""i"".""item_brand"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""cte"" AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""t"".""item_id"""
231,"SELECT ""b"".""user_id"" AS ""seller_id"",CASE WHEN ""t2"".""item_brand""=""B"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""seller_id"",""item_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""Orders"") AS ""t1"" LEFT JOIN ""Items"" AS ""t2"" ON ""t1"".""item_id""=""t2"".""item_id"") RIGHT JOIN ""Users"" AS ""B"" ON ""t1"".""seller_id""=""B"".""user_id"" AND ""t1"".""r""=2"
232,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_rank"" FROM ""orders"") AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""t"".""sold_rank""=2) LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
233,"WITH ""t"" AS (SELECT ""user_id"",""favorite_brand"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"",SUM(""order_id"") OVER (PARTITION BY ""seller_id"") AS ""total"" FROM (""Users"" LEFT JOIN ""Orders"" ON ""Users"".""user_id""=""Orders"".""seller_id"") LEFT JOIN ""Items"" ON ""Orders"".""item_id""=""Items"".""item_id""), ""t1"" AS (SELECT ""user_id"" AS ""seller_id"" FROM ""t"" WHERE ""rk""=2 AND ""item_brand""=""favorite_brand"" AND ""total"">2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT ""seller_id"" FROM ""t1"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" ORDER BY ""seller_id"""
234,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""t2"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""ranking"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t1"" WHERE ""ranking""=2) AS ""t2"" ON ""u"".""user_id""=""t2"".""seller_id"""
235,"WITH ""tmp"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"",""b"".""item_brand"" FROM ""Orders"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id""), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""ranks""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""tmp2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
236,"WITH ""T"" AS (SELECT * FROM (SELECT ""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""t_stamp"" FROM ""Orders"" AS ""O"") AS ""tmp"" WHERE ""tmp"".""t_stamp""=2) SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""U"" LEFT JOIN ""T"" ON ""U"".""user_id""=""T"".""seller_id"") LEFT JOIN ""Items"" AS ""I"" ON ""I"".""item_id""=""T"".""item_id"" ORDER BY ""seller_id"""
237,"WITH ""temp"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank_num"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""item_brand"" FROM (""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") LEFT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""o"".""seller_id"") AS ""cte"" WHERE ""rank_num""=2) SELECT ""user_id"" AS ""seller_id"",COALESCE(""item_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""temp"" AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"""
238,"WITH ""tmp"" AS (SELECT ""seller_id"",""o"".""item_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank_num"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""tmp2"" AS (SELECT ""tmp"".""seller_id"" FROM ""tmp"" JOIN ""Users"" AS ""u"" ON ""tmp"".""seller_id""=""u"".""user_id"" WHERE ""tmp"".""rank_num""=2 AND ""u"".""favorite_brand""=""tmp"".""item_brand"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""t"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""tmp2"" AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"""
239,"WITH ""second_item_sold"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_DATE"") AS ""row_num"" FROM ""orders"") AS ""orders_ranked"" WHERE ""row_num""=2), ""second_item_brand"" AS (SELECT ""seller_id"",""second_item_sold"".""item_id"",""item_brand"" FROM ""second_item_sold"" JOIN ""items"" ON ""second_item_sold"".""item_id""=""items"".""item_id""), ""compare_brands"" AS (SELECT ""users"".""user_id"",""users"".""favorite_brand"",""second_item_brand"".""item_brand"" FROM ""users"" LEFT JOIN ""second_item_brand"" ON ""users"".""user_id""=""second_item_brand"".""seller_id"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""compare_brands"""
240,"WITH ""cte"" AS (SELECT ""seller_id"" FROM (SELECT ""o"".""seller_id"",""o"".""item_id"",""u"".""favorite_brand"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM (""orders"" AS ""o"" JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""a"" WHERE ""rk""=2 AND ""favorite_brand""=""item_brand"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT DISTINCT ""seller_id"" FROM ""cte"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"""
241,"WITH ""cte"" AS (SELECT ""seller_id"",""favorite_brand"",""item_brand"" FROM ((SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""orders"") AS ""r1"" JOIN ""users"" ON ""user_id""=""seller_id"") NATURAL CROSS JOIN ""items"" WHERE ""rk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""c"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"""
242,"WITH ""second"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rr"" FROM ""Orders""), ""cte"" AS (SELECT ""s"".""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""second"" AS ""s"" JOIN ""Items"" AS ""i"" USING (""item_id"")) JOIN ""Users"" AS ""u"" ON ""s"".""seller_id""=""u"".""user_id"" WHERE ""rr""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""seller_id"""
243,"WITH ""tmp"" AS (SELECT ""seller_id"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""orders""), ""tmp1"" AS (SELECT ""seller_id"",""item_brand"",""rk"" FROM ""tmp"" AS ""a"" JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"" AND ""rk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""c"" LEFT JOIN ""tmp1"" AS ""d"" ON ""user_id""=""seller_id"" AND ""favorite_brand""=""item_brand"""
244,"WITH ""tmp"" AS (SELECT ""a"".*,""b"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""a"" JOIN ""items"" AS ""b"" USING (""item_id"")) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""c"".""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM ""tmp"" WHERE ""rnk""=2) AS ""c"" ON ""a"".""user_id""=""c"".""seller_id"" AND ""a"".""favorite_brand""=""c"".""item_brand"" ORDER BY 1"
245,"WITH ""cte"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnkitems"" FROM ""orders"") AS ""a"" WHERE ""rnkitems""=2 GROUP BY ""seller_id"") SELECT ""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""c"".""item_id""=""i"".""item_id"""
246,"WITH ""second_sold"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""order_date"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""t"" WHERE ""rk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""second_sold"" AS ""ss"" ON ""ss"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""ss"".""item_id""=""i"".""item_id"""
247,"WITH ""a"" AS (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""item_num"" FROM ""orders""), ""b"" AS (SELECT ""seller_id"",(CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (""a"" JOIN ""items"" AS ""i"" ON ""a"".""item_id""=""i"".""item_id"") JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""a"".""seller_id"" WHERE ""item_num""=2) SELECT ""user_id"" AS ""seller_id"",(COALESCE(""2nd_item_fav_brand"", 'no')) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""b"" ON ""u"".""user_id""=""b"".""seller_id"""
248,"SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN (SELECT ""o"".""seller_id"",""o"".""item_id"",""i"".""item_brand"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""Orders"") AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""r""=2) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" AND ""a"".""favorite_brand""=""b"".""item_brand"" ORDER BY ""a"".""user_id"""
249,"WITH ""tmp"" AS (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""a"" JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT * FROM ""tmp"" WHERE ""rnk""=2) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" ORDER BY 1"
250,"SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""flag"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT * FROM (SELECT ""user_id"",ROW_NUMBER() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""num"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""flag"" FROM (""users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""A"" WHERE ""num""=2) AS ""B"" ON ""u"".""user_id""=""B"".""user_id"""
251,"WITH ""rk"" AS (SELECT ""o"".""item_id"" AS ""item_id"",""i"".""item_brand"" AS ""item_brand"",""o"".""seller_id"" AS ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk_sold"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""y_fav"" AS (SELECT ""u"".""user_id"" AS ""seller_id"",'yes' AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" CROSS JOIN ""rk"" WHERE ""u"".""user_id""=""rk"".""seller_id"" AND ""u"".""favorite_brand""=""rk"".""item_brand"" AND ""rk"".""rk_sold""=2) SELECT ""seller_id"",""2nd_item_fav_brand"" FROM ""y_fav"" UNION SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""y_fav"")"
252,"WITH ""cte"" AS (SELECT ""u"".""user_id"",""o"".""order_id"",""o"".""order_date"",""o"".""item_id"",""i"".""item_id"" AS ""fav_brand_id"",DENSE_RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""ORDER_DATE"") AS ""Order_Rank"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") JOIN ""Items"" AS ""i"" ON ""u"".""favorite_brand""=""i"".""item_brand"") SELECT DISTINCT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""c"".""Order_Rank""=2 AND ""item_id""=""fav_brand_id"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""c"".""user_id""=""u"".""user_id"" AND ""c"".""Order_Rank""=2 AND ""item_id""=""fav_brand_id"""
253,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_brand"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" ON ""a"".""seller_id""=""u"".""user_id"" AND ""rnk""=2"
254,"WITH ""cte"" AS (SELECT ""seller_id"",""o"".""item_id"",""item_brand"",""order_date"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""num"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""t"" AS (SELECT ""seller_id"",""item_brand"" FROM ""cte"" WHERE ""num""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"""
255,"WITH ""cte"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sell_rank"" FROM ""orders""), ""cte2"" AS (SELECT ""a"".""seller_id"",""a"".""item_id"",CASE WHEN ""b"".""item_brand""=""c"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""cte"" AS ""a"" JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") JOIN ""users"" AS ""c"" ON ""a"".""seller_id""=""c"".""user_id"" WHERE ""sell_rank""=2) SELECT ""e"".""user_id"" AS ""seller_id"",COALESCE(""f"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""e"" LEFT JOIN ""cte2"" AS ""f"" ON ""e"".""user_id""=""f"".""seller_id"""
256,"WITH ""t1"" AS (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sell_order"" FROM ""Orders""), ""t2"" AS (SELECT DISTINCT ""t1"".""seller_id"" FROM (""t1"" LEFT JOIN ""Users"" AS ""u"" ON ""t1"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" USING (""item_id"") WHERE ""sell_order""=2 AND ""favorite_brand""=""item_brand"") SELECT DISTINCT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT ""seller_id"" FROM ""t2"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"""
257,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""d"".""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN (SELECT ""seller_id"",""favorite_brand"",""item_brand"" FROM (SELECT ""seller_id"",""item_id"",""favorite_brand"" FROM (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""order_id"",""item_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders"") AS ""t"" WHERE ""r""=2) AS ""t1"" CROSS JOIN ""users"" AS ""t2"" WHERE ""t1"".""seller_id""=""t2"".""user_id"") AS ""a"" JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") AS ""d"" ON ""user_id""=""seller_id"""
258,"WITH ""t"" AS (WITH ""t"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders"") SELECT ""t"".""seller_id"",CASE WHEN ""u"".""favorite_brand""=""it"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""lb"" FROM (""t"" JOIN ""items"" AS ""it"" ON ""t"".""item_id""=""it"".""item_id"") JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""t"".""seller_id"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""t"".""lb"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"" ORDER BY ""u"".""user_id"""
259,"WITH ""cte"" AS (SELECT ""item_id"",""seller_id"",""order_date"" FROM (SELECT ""item_id"",""seller_id"",""order_date"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""temp"" WHERE ""rnk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' WHEN ""item_brand"" IS NULL THEN 'no' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" LEFT JOIN ""cte"" ON ""user_id""=""seller_id"") LEFT JOIN ""Items"" ON ""cte"".""item_id""=""Items"".""item_id"""
260,"WITH ""x"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders""), ""y"" AS (SELECT ""x"".""seller_id"",""x"".""item_id"",""items"".""item_brand"",""users"".""favorite_brand"" FROM (""x"" JOIN ""items"" ON ""x"".""item_id""=""items"".""item_id"") JOIN ""users"" ON ""x"".""seller_id""=""users"".""user_id"" WHERE ""rnk""=2 AND ""items"".""item_brand""=""users"".""favorite_brand"") SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN ""y"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""y"" ON ""users"".""user_id""=""y"".""seller_id"""
261,"WITH ""second"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rr"" FROM ""Orders""), ""cte"" AS (SELECT ""s"".""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""second"" AS ""s"" JOIN ""Items"" AS ""i"" USING (""item_id"")) JOIN ""Users"" AS ""u"" ON ""s"".""seller_id""=""u"".""user_id"" WHERE ""rr""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""seller_id"""
262,"SELECT ""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""second_sold""=""favorite_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM (SELECT DISTINCT ""seller_id"",NTH_VALUE(""item_brand"", 2) OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS ""second_sold"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""a"" RIGHT JOIN ""Users"" AS ""u"" ON ""seller_id""=""user_id"""
263,"SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""u"".""favorite_brand""=""tbl"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""o1"".""seller_id"",""o1"".""order_date"",""i"".""item_brand"" FROM (""orders"" AS ""o1"" LEFT JOIN ""orders"" AS ""o2"" ON ""o1"".""order_date"">=""o2"".""order_date"" AND ""o1"".""seller_id""=""o2"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""o1"".""item_id""=""i"".""item_id"" GROUP BY ""o1"".""seller_id"",""o1"".""order_date"" HAVING COUNT(1)=2) AS ""tbl"" ON ""u"".""user_id""=""tbl"".""seller_id"" ORDER BY ""seller_id"""
264,"WITH ""cte"" AS (SELECT ""u"".""user_id"",""o"".""order_id"",""o"".""order_date"",""o"".""item_id"",""i"".""item_id"" AS ""fav_brand_id"",DENSE_RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""ORDER_DATE"") AS ""Order_Rank"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") JOIN ""Items"" AS ""i"" ON ""u"".""favorite_brand""=""i"".""item_brand"") SELECT DISTINCT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""c"".""Order_Rank""=2 AND ""item_id""=""fav_brand_id"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""c"".""user_id""=""u"".""user_id"" AND ""c"".""Order_Rank""=2 AND ""item_id""=""fav_brand_id"""
265,"SELECT ""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u0"" LEFT JOIN (SELECT ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""days"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" USING (""item_id"") WHERE ""order_date"">""join_date"") AS ""t"" WHERE ""t"".""days""=2) AS ""t1"" ON ""u0"".""user_id""=""t1"".""seller_id"""
266,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""s"".""brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""o"".""seller_id"",""i"".""item_brand"" AS ""brand"",DENSE_RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""order_date"") AS ""saleid"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"" AND ""s"".""saleid""=2"
267,"WITH ""cte"" AS (SELECT ""o"".""seller_id"",""o"".""item_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id""), ""cte2"" AS (SELECT * FROM ""cte"" WHERE ""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte2"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"""
268,"WITH ""rnk"" AS (SELECT ""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders""), ""seller_list"" AS (SELECT DISTINCT (""user_id"") AS ""user_id"" FROM ""users"") SELECT ""seller_list"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""seller_list"" LEFT JOIN (SELECT ""seller_id"",""favorite_brand"",""item_brand"" FROM (""rnk"" LEFT JOIN ""users"" ON ""rnk"".""seller_id""=""users"".""user_id"") LEFT JOIN ""items"" ON ""rnk"".""item_id""=""items"".""item_id"" WHERE ""rnk"".""rnk""=2) AS ""a"" ON ""seller_list"".""user_id""=""a"".""seller_id"" GROUP BY 1"
269,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""item_id"",""seller_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""tmp"" JOIN ""Items"" USING (""item_id"") WHERE ""rk""=2) AS ""tmp2"" ON ""Users"".""user_id""=""tmp2"".""seller_id"""
270,"WITH ""t"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""n"" AS (SELECT ""u"".""user_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""n"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""n"" ON ""u"".""user_id""=""n"".""user_id"""
271,"WITH ""second"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rr"" FROM ""Orders""), ""cte"" AS (SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" AND ""rr""=2 THEN 'yes' WHEN ""u"".""favorite_brand""!=""i"".""item_brand"" AND ""rr""=2 THEN 'no' WHEN MAX(""rr"") OVER (PARTITION BY ""seller_id"")<2 THEN 'no' WHEN ""rr"" IS NULL THEN 'no' ELSE NULL END AS ""2nd_item_fav_brand"" FROM (""second"" AS ""s"" JOIN ""Items"" AS ""i"" USING (""item_id"")) RIGHT JOIN ""Users"" AS ""u"" ON ""s"".""seller_id""=""u"".""user_id"") SELECT * FROM ""cte"" WHERE ""2nd_item_fav_brand"" IS NOT NULL"
272,"WITH ""CTE"" AS (SELECT ""u"".""user_id"",""u"".""favorite_brand"",""o"".""order_id"",""o"".""order_date"",""o"".""item_id"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""order_sold"" FROM ""Users"" AS ""u"" LEFT JOIN ""ORDERS"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"" UNION SELECT ""u"".""user_id"",""u"".""favorite_brand"",""o"".""order_id"",""o"".""order_date"",""o"".""item_id"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""order_sold"" FROM ""Users"" AS ""u"" RIGHT JOIN ""ORDERS"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id""), ""CTE2"" AS (SELECT ""CTE"".""user_id"",""CTE"".""favorite_brand"",""CTE"".""order_id"",""CTE"".""order_date"",""CTE"".""item_id"",""CTE"".""order_sold"",""i"".""item_brand"" FROM ""CTE"" LEFT JOIN ""Items"" AS ""i"" ON ""CTE"".""item_id""=""i"".""item_id""), ""CTE3"" AS (SELECT ""a"".""user_id"" AS ""seller_id"",(CASE WHEN ""a"".""order_id"" IS NOT NULL AND ""a"".""favorite_brand""=""a"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""CTE2"" AS ""a"" WHERE ""a"".""order_sold""=2) SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""b"".""2nd_item_fav_brand"" IS NULL THEN 'no' ELSE ""b"".""2nd_item_fav_brand"" END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""CTE3"" AS ""b"" ON ""u"".""user_id""=""b"".""seller_id"" ORDER BY ""u"".""user_id"""
273,"SELECT DISTINCT ""usr"".""user_id"" AS ""seller_id"",CASE WHEN ""drv"".""seller_id"" IS NULL THEN 'no' ELSE ""drv"".""ind"" END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""usr"" LEFT JOIN (SELECT ""a"".*,CASE WHEN ""b"".""item_brand""=""c"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""ind"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""orders"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") LEFT JOIN ""users"" AS ""c"" ON ""a"".""seller_id""=""c"".""user_id"") AS ""drv"" ON ""usr"".""user_id""=""drv"".""seller_id"" AND ""drv"".""rnk""=2 ORDER BY 1"
274,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders"") AS ""o"" ON ""seller_id""=""user_id"" AND ""rn""=2) LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"""
275,"WITH ""t1"" AS (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sell_order"" FROM ""Orders""), ""t2"" AS (SELECT DISTINCT ""t1"".""seller_id"" FROM (""t1"" LEFT JOIN ""Users"" AS ""u"" ON ""t1"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t1"".""item_id""=""i"".""item_id"" WHERE ""sell_order""=2 AND ""favorite_brand""=""item_brand"") SELECT DISTINCT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT ""seller_id"" FROM ""t2"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"""
276,"WITH ""seller_order"" AS (SELECT ""O"".""seller_id"",""O"".""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_num"" FROM ""Orders"" AS ""O""), ""second_order_item_brand"" AS (SELECT ""SO"".""seller_id"",""SO"".""item_id"",""I"".""item_brand"" FROM ""seller_order"" AS ""SO"" JOIN ""Items"" AS ""I"" ON ""SO"".""item_id""=""I"".""item_id"" WHERE ""row_num""=2) SELECT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""U"".""favorite_brand""=""SOIB"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""U"" LEFT JOIN ""second_order_item_brand"" AS ""SOIB"" ON ""U"".""user_id""=""SOIB"".""seller_id"""
277,"WITH ""CTE"" AS (SELECT * FROM (SELECT ""b"".""Seller_Id"" AS ""user_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""B"".""Seller_Id"" ORDER BY ""order_date"") AS ""Order_Seq"" FROM ""Orders"" AS ""B"" LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"") AS ""Data_set"" WHERE ""Order_Seq""=2) SELECT ""Users"".""User_id"" AS ""seller_id"",COALESCE(CASE WHEN (""CTE"".""item_brand""=""Users"".""favorite_brand"") AND ""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""CTE"" ON ""Users"".""user_id""=""CTE"".""user_id"""
278,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_rank"" FROM ""orders"") AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""t"".""sold_rank""=2) LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
279,"WITH ""cte1"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders""), ""cte2"" AS (SELECT ""c"".""seller_id"",""i"".""item_brand"" FROM ""items"" AS ""i"" JOIN ""cte1"" AS ""c"" ON ""i"".""item_id""=""c"".""item_id"" WHERE ""c"".""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""c"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte2"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"""
280,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""o"".""seller_id"",""favorite_brand"",""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""order_date"") AS ""ra"" FROM (""orders"" AS ""o"" JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" RIGHT JOIN ""users"" AS ""u"" ON ""a"".""seller_id""=""u"".""user_id"" AND ""a"".""ra""=2"
281,"WITH ""CTE"" AS (SELECT ""o"".""seller_id"",""o"".""item_id"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""order_rank"",""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""CTE"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"" AND ""order_rank""=2"
282,"WITH ""t"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""n"" AS (SELECT ""u"".""user_id"",""t"".""item_id"",""i"".""item_brand"",""t"".""r"",""u"".""favorite_brand"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""n"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""n"" ON ""u"".""user_id""=""n"".""user_id"""
283,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""orders"" LEFT JOIN ""items"" ON ""orders"".""item_id""=""items"".""item_id"") AS ""tb1"" WHERE ""rk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""cte"" ON ""users"".""user_id""=""cte"".""seller_id"""
284,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""tmpt"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""o"".*,""i"".""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""ranking"" FROM ""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""tmpt"" ON ""u"".""user_id""=""tmpt"".""seller_id"" AND ""ranking""=2"
285,"WITH ""temp"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"" FROM ""Orders"") SELECT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""I"".""item_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""U"" LEFT JOIN ""temp"" ON ""U"".""user_id""=""temp"".""seller_id"" AND ""temp"".""ranks""=2) LEFT JOIN ""Items"" AS ""I"" ON ""U"".""favorite_brand""=""I"".""item_brand"" AND ""temp"".""item_id""=""I"".""item_id"" ORDER BY ""U"".""user_id"""
286,"SELECT ""seller_id"",""2nd_item_fav_brand"" FROM (SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"" GROUP BY ""user_id"" HAVING COUNT(""order_id"")<=1 UNION SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"",""favorite_brand"",""item_brand"",DENSE_RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rank"" FROM ((""users"" AS ""u"") CROSS JOIN ""orders"" AS ""o"") CROSS JOIN ""items"" AS ""i"" WHERE ""u"".""user_id""=""o"".""seller_id"" AND ""o"".""item_id""=""i"".""item_id"") AS ""a"" WHERE ""a"".""rank""=2) AS ""b"" ORDER BY ""seller_id"""
287,"WITH ""second_day_item"" AS (SELECT ""t0"".""item_id"",""t0"".""seller_id"",""t0"".""item_brand"" FROM (SELECT ""o"".""item_id"",""o"".""seller_id"",""i"".""item_brand"",DENSE_RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t0"" WHERE ""t0"".""rnk""=2) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NULL OR ""a"".""favorite_brand""!=""b"".""item_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""second_day_item"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" ORDER BY ""seller_id"""
288,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders"") AS ""o"" ON ""o"".""seller_id""=""u"".""user_id"" AND ""o"".""rn""=2) LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"""
289,"WITH ""cte1"" AS (SELECT ""user_id"",""favorite_brand"",""item_brand"",""order_date"" FROM (""orders"" AS ""o"" RIGHT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") RIGHT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""cte2"" AS (SELECT *,DENSE_RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""cte1"") SELECT ""seller_id"",(CASE WHEN ""favorite_brand"" IS NULL THEN 'no' WHEN ""favorite_brand""!=""item_brand"" THEN 'no' WHEN ""favorite_brand""=""item_brand"" THEN 'yes' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"" AS ""seller_id"",""cte2"".""favorite_brand"" AS ""favorite_brand"",""cte2"".""item_brand"" AS ""item_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte2"" ON ""u"".""user_id""=""cte2"".""user_id"" AND ""rnk""=2) AS ""a"""
290,"SELECT ""UR"".""user_id"" AS ""seller_id"",COALESCE(""S"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""UR"" LEFT JOIN (SELECT ""O"".""seller_id"",CASE WHEN ""I"".""item_brand""!=""U"".""favorite_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""seller_id"",""order_date"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_sequence"" FROM ""Orders"") AS ""O"" JOIN ""Users"" AS ""U"" ON ""U"".""user_id""=""O"".""seller_id"") JOIN ""Items"" AS ""I"" ON ""O"".""item_id""=""I"".""item_id"" WHERE ""O"".""sold_sequence""=2) AS ""S"" ON ""UR"".""user_id""=""S"".""seller_id"""
291,"SELECT ""UR"".""user_id"" AS ""seller_id"",CASE WHEN ""S"".""2nd_item_fav_brand"" IS NULL OR ""S"".""2nd_item_fav_brand""=0 THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""UR"" LEFT JOIN (SELECT ""O"".""seller_id"",CASE WHEN ""I"".""item_brand""!=""U"".""favorite_brand"" THEN 0 ELSE 1 END AS ""2nd_item_fav_brand"" FROM ((SELECT ""seller_id"",""order_date"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_sequence"" FROM ""Orders"") AS ""O"" JOIN ""Users"" AS ""U"" ON ""U"".""user_id""=""O"".""seller_id"") JOIN ""Items"" AS ""I"" ON ""O"".""item_id""=""I"".""item_id"" WHERE ""O"".""sold_sequence""=2) AS ""S"" ON ""UR"".""user_id""=""S"".""seller_id"""
292,"WITH ""sub1"" AS (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""selling_order"" FROM (""orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" USING (""item_id"")) LEFT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id""), ""sub2"" AS (SELECT ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""sub1"" WHERE ""selling_order""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""sub2"" ON ""sub2"".""seller_id""=""u"".""user_id"""
293,"WITH ""cte"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"",""c"".""favorite_brand"" FROM (""orders"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") LEFT JOIN ""users"" AS ""c"" ON ""a"".""seller_id""=""c"".""user_id""), ""yes"" AS (SELECT ""seller_id"" FROM ""cte"" WHERE ""rnk""=2 AND ""favorite_brand""=""item_brand"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT * FROM ""yes"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"""
294,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN MAX(CASE WHEN ""t"".""seller_id"" IS NOT NULL AND ""u"".""favorite_brand""=""i"".""item_brand"" THEN 1 ELSE 0 END)=1 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""o1"".""seller_id"",""o1"".""item_id"" FROM (""Orders"" AS ""o1"") CROSS JOIN ""Orders"" AS ""o2"" WHERE ""o1"".""seller_id""=""o2"".""seller_id"" AND ""o1"".""order_date"">=""o2"".""order_date"" GROUP BY ""o1"".""seller_id"",""o1"".""order_date"",""o1"".""item_id"" HAVING COUNT(""o2"".""order_date"")=2) AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" GROUP BY ""u"".""user_id"""
295,"WITH ""cte"" AS (SELECT ""user_id"",""favorite_brand"",""item_brand"",""order_date"",DENSE_RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""orders"" AS ""o"" RIGHT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") RIGHT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""seller_id"",(CASE WHEN ""favorite_brand"" IS NULL THEN 'no' WHEN ""favorite_brand""!=""item_brand"" THEN 'no' WHEN ""favorite_brand""=""item_brand"" THEN 'yes' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"" AS ""seller_id"",""cte"".""favorite_brand"" AS ""favorite_brand"",""cte"".""item_brand"" AS ""item_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""user_id"" AND ""rnk""=2) AS ""a"""
296,"SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""C"".""favorite_brand"" IS NULL THEN 'no' ELSE 'yes' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT * FROM (SELECT ""U"".""user_id"",""U"".""favorite_brand"",""A"".""order_date"",""A"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""U"".""user_id"" ORDER BY ""A"".""order_date"") AS ""R"" FROM ""Users"" AS ""U"" LEFT JOIN (SELECT ""O"".""seller_id"",""O"".""order_date"",""I"".""item_brand"" FROM ""Orders"" AS ""O"" LEFT JOIN ""Items"" AS ""I"" ON ""O"".""item_id""=""I"".""item_id"") AS ""A"" ON ""U"".""user_id""=""A"".""seller_id"") AS ""B"" WHERE ""B"".""favorite_brand""=""B"".""item_brand"" AND ""B"".""R""=2) AS ""C"" ON ""u"".""user_id""=""C"".""user_id"""
297,"SELECT ""UR"".""user_id"" AS ""seller_id"",CASE WHEN ""S"".""2nd_item_fav_brand"" IS NULL OR ""S"".""2nd_item_fav_brand""=0 THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""UR"" LEFT JOIN (SELECT ""O"".""seller_id"",CASE WHEN ""I"".""item_brand""!=""U"".""favorite_brand"" THEN 0 ELSE 1 END AS ""2nd_item_fav_brand"" FROM ((SELECT ""seller_id"",""order_date"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_sequence"" FROM ""Orders"") AS ""O"" JOIN ""Users"" AS ""U"" ON ""U"".""user_id""=""O"".""seller_id"") JOIN ""Items"" AS ""I"" ON ""O"".""item_id""=""I"".""item_id"" WHERE ""O"".""sold_sequence""=2) AS ""S"" ON ""UR"".""user_id""=""S"".""seller_id"""
298,"WITH ""CTE"" AS (SELECT ""A"".""seller_id"",'yes' AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""A"" JOIN ""Items"" ON ""Items"".""item_id""=""A"".""item_id"") JOIN ""Users"" ON ""Users"".""user_id""=""A"".""seller_id"" WHERE ""Users"".""favorite_brand""=""Items"".""item_brand"" AND ""rk""=2) SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN ""CTE"".""2nd_item_fav_brand"" IS NULL THEN 'no' ELSE ""CTE"".""2nd_item_fav_brand"" END AS ""2nd_item_fav_brand"" FROM ""CTE"" RIGHT JOIN ""Users"" ON ""CTE"".""seller_id""=""Users"".""user_id"""
299,"WITH ""t1"" AS (SELECT ""user_id"",""item_id"" FROM (SELECT ""seller_id"" AS ""user_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rw"" FROM ""orders"") AS ""a"" WHERE ""rw""=2), ""t2"" AS (SELECT ""t1"".""user_id"",""i"".""item_brand"" FROM ""t1"" LEFT JOIN ""items"" AS ""i"" ON ""t1"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""t2"".""user_id"" IS NOT NULL AND ""u"".""favorite_brand""=""t2"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""t2"" ON ""u"".""user_id""=""t2"".""user_id"" ORDER BY ""seller_id"""
300,"WITH ""cte"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sell_rank"" FROM ""orders""), ""cte2"" AS (SELECT ""a"".""seller_id"",""a"".""item_id"",CASE WHEN ""b"".""item_brand""=""c"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""cte"" AS ""a"" JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") JOIN ""users"" AS ""c"" ON ""a"".""seller_id""=""c"".""user_id"" WHERE ""sell_rank""=2) SELECT ""e"".""user_id"" AS ""seller_id"",COALESCE(""f"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""e"" LEFT JOIN ""cte2"" AS ""f"" ON ""e"".""user_id""=""f"".""seller_id"""
301,"SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN ""B"".""favorite_brand""=""B"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""A"".""order_date"",RANK() OVER (PARTITION BY ""A"".""user_id"" ORDER BY ""A"".""order_date"") AS ""rk"",""A"".""user_id"" AS ""seller_id"",""A"".""favorite_brand"",""A"".""item_brand"" FROM (SELECT ""Orders"".*,""Users"".""user_id"",""Users"".""favorite_brand"",""Items"".""item_brand"" FROM (""Orders"" RIGHT JOIN ""Users"" ON ""Orders"".""seller_id""=""Users"".""user_id"") LEFT JOIN ""Items"" ON ""Items"".""item_id""=""Orders"".""item_id"") AS ""A"") AS ""B"" RIGHT JOIN ""Users"" ON ""Users"".""user_id""=""B"".""seller_id"" AND ""B"".""rk""=2"
302,"WITH ""CTE"" AS (SELECT ""a"".* FROM (SELECT ""o"".*,""u"".""favorite_brand"",""item_brand"",CASE WHEN ""u"".""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_num"" FROM (""Orders"" AS ""o"" LEFT JOIN ""Users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" WHERE ""a"".""row_num""=2) SELECT DISTINCT ""user"".""user_id"" AS ""seller_id"",CASE WHEN ""CTE"".""2nd_item_fav_brand"" IS NULL THEN 'no' ELSE ""CTE"".""2nd_item_fav_brand"" END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""user"" LEFT JOIN ""CTE"" ON ""user"".""user_id""=""CTE"".""seller_id"""
303,"WITH ""cte"" AS (SELECT ""u"".""user_id"",""u"".""favorite_brand"",""o"".""item_id"",""i"".""item_brand"",""o"".""order_date"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rnk_order"" FROM (""Users"" AS ""u"" JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""t"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""t"" ON ""u"".""user_id""=""t"".""user_id"" AND ""rnk_order""=2"
304,"WITH ""CTE"" AS (SELECT ""A"".""seller_id"",'yes' AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""A"" JOIN ""Items"" ON ""Items"".""item_id""=""A"".""item_id"") JOIN ""Users"" ON ""Users"".""user_id""=""A"".""seller_id"" WHERE ""Users"".""favorite_brand""=""Items"".""item_brand"" AND ""rk""=2) SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN ""CTE"".""2nd_item_fav_brand"" IS NULL THEN 'no' ELSE ""CTE"".""2nd_item_fav_brand"" END AS ""2nd_item_fav_brand"" FROM ""CTE"" RIGHT JOIN ""Users"" ON ""CTE"".""seller_id""=""Users"".""user_id"""
305,"WITH ""CTE"" AS (SELECT ""A"".""seller_id"",'yes' AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""A"" JOIN ""Items"" ON ""Items"".""item_id""=""A"".""item_id"") JOIN ""Users"" ON ""Users"".""user_id""=""A"".""seller_id"" WHERE ""Users"".""favorite_brand""=""Items"".""item_brand"" AND ""rk""=2) SELECT * FROM ""CTE"" UNION ALL SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""Users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""CTE"")"
306,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NULL THEN 'no' ELSE CASE WHEN ""u"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_date"",""item_brand"" FROM ""orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""A"" WHERE ""order_date""=2) AS ""B"" ON ""B"".""seller_id""=""u"".""user_id"""
307,"WITH ""CTE"" AS (SELECT ""A"".""seller_id"",'yes' AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""A"" JOIN ""Items"" ON ""Items"".""item_id""=""A"".""item_id"") JOIN ""Users"" ON ""Users"".""user_id""=""A"".""seller_id"" WHERE ""Users"".""favorite_brand""=""Items"".""item_brand"" AND ""rk""=2) SELECT * FROM ""CTE"" UNION ALL SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""Users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""CTE"")"
308,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""t2"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""t1"".""seller_id"",""t1"".""item_brand"" FROM (SELECT ""o"".""seller_id"",""o"".""item_id"",""o"".""order_date"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""num"",""i"".""item_brand"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t1"" WHERE ""t1"".""num""=2) AS ""t2"" ON ""u"".""user_id""=""t2"".""seller_id"""
309,"WITH ""second"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rr"" FROM ""Orders""), ""cte"" AS (SELECT ""s"".""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""second"" AS ""s"" JOIN ""Items"" AS ""i"" USING (""item_id"")) JOIN ""Users"" AS ""u"" ON ""s"".""seller_id""=""u"".""user_id"" WHERE ""rr""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""seller_id"""
310,"WITH ""tab_2nd_item"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""orders"") AS ""a"" WHERE ""a"".""rk""=2), ""tab_prep"" AS (SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN ""users"".""favorite_brand""=""items"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""tab_2nd_item"" RIGHT JOIN ""users"" ON ""tab_2nd_item"".""seller_id""=""users"".""user_id"") JOIN ""items"" ON ""tab_2nd_item"".""item_id""=""items"".""item_id"") SELECT ""users"".""user_id"" AS ""seller_id"",COALESCE(""tab_prep"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""tab_prep"" ON ""users"".""user_id""=""tab_prep"".""seller_id"""
311,"SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT ""x"".""seller_id"",""x"".""item_id"",""y"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""x"".""seller_id"" ORDER BY ""x"".""order_date"") AS ""row_cnt"" FROM ""Orders"" AS ""x"" JOIN ""Items"" AS ""y"" ON ""x"".""item_id""=""y"".""item_id"") AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" AND ""b"".""row_cnt""=2"
312,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""sec""=2 AND ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""user_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sec"",COUNT(1) OVER (PARTITION BY ""seller_id"") AS ""num"",""item_brand"",""favorite_brand"" FROM (""Orders"" JOIN ""Items"" ON ""orders"".""item_id""=""Items"".""item_id"") RIGHT JOIN ""Users"" ON ""Users"".""user_id""=""Orders"".""seller_id"") AS ""l"" WHERE ""sec""=2 UNION SELECT ""user_id"",'no' FROM ""users"" WHERE ""user_id"" NOT IN (SELECT (""seller_id"") FROM ""orders"" GROUP BY ""seller_id"" HAVING COUNT(1)>1) ORDER BY ""seller_id"""
313,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""item_pos"" FROM ""Orders"") AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""t"".""item_pos""=2) LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""t"".""item_id"""
314,"WITH ""ranked"" AS (SELECT ""o"".""item_id"",""o"".""seller_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""secondsell"" AS (SELECT ""seller_id"",""item_brand"" FROM ""ranked"" WHERE ""rk""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""secondsell"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
315,"WITH ""ranks"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rr"" FROM ""Orders""), ""seconds"" AS (SELECT ""s"".""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""ranks"" AS ""s"" JOIN ""Items"" AS ""i"" USING (""item_id"")) JOIN ""Users"" AS ""u"" ON ""s"".""seller_id""=""u"".""user_id"" WHERE ""rr""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""seconds"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
316,"WITH ""CTE"" AS (SELECT ""A"".""seller_id"",'yes' AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""A"" JOIN ""Items"" ON ""Items"".""item_id""=""A"".""item_id"") JOIN ""Users"" ON ""Users"".""user_id""=""A"".""seller_id"" WHERE ""Users"".""favorite_brand""=""Items"".""item_brand"" AND ""rk""=2) SELECT ""Users"".""user_id"" AS ""seller_id"",CASE WHEN ""CTE"".""2nd_item_fav_brand"" IS NULL THEN 'no' ELSE ""CTE"".""2nd_item_fav_brand"" END AS ""2nd_item_fav_brand"" FROM ""CTE"" RIGHT JOIN ""Users"" ON ""CTE"".""seller_id""=""Users"".""user_id"""
317,"WITH ""sells"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"" AS ""o"") AS ""a"" WHERE ""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""s"".""seller_id"" IS NULL THEN 'no' ELSE CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""sells"" AS ""s"" ON (""u"".""user_id""=""s"".""seller_id"")) LEFT JOIN ""items"" AS ""i"" ON (""s"".""item_id""=""i"".""item_id"")"
318,"WITH ""CTE"" AS (SELECT * FROM (SELECT ""T2"".""order_date"",""T2"".""item_id"",""T2"".""buyer_id"",""T2"".""seller_id"",""T3"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""RNK"" FROM ""Orders"" AS ""T2"" LEFT JOIN ""Items"" AS ""T3"" ON ""T2"".""item_id""=""T3"".""item_id"") AS ""TEMP"" WHERE ""RNK""=2) SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""U"" LEFT JOIN ""CTE"" ON ""U"".""user_id""=""CTE"".""seller_id"""
319,"WITH ""sorted_orders"" AS (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""Orders"") SELECT ""seller_id"",CASE WHEN MAX(""2nd_item_fav_brand"")=1 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT DISTINCT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""s"".""seller_id"" IS NOT NULL AND ""s"".""item_id""=""i"".""item_id"" THEN 1 ELSE 0 END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" JOIN ""Items"" AS ""i"" ON ""u"".""favorite_brand""=""i"".""item_brand"") LEFT JOIN (SELECT ""seller_id"",""item_id"" FROM ""sorted_orders"" WHERE ""r""=2) AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"") AS ""b"" GROUP BY 1"
320,"WITH ""cte"" AS (SELECT * FROM (SELECT ""seller_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t"" WHERE ""rnk""=2) SELECT ""u"".""user_id"" AS ""Seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""cte"" RIGHT JOIN ""Users"" AS ""u"" ON ""Seller_id""=""user_id"""
321,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN MAX(CASE WHEN ""t"".""order_date"" IS NOT NULL AND ""u"".""favorite_brand""=""i"".""item_brand"" THEN 1 ELSE 0 END)=1 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") LEFT JOIN (SELECT ""o1"".""seller_id"",""o1"".""order_date"" FROM (""Orders"" AS ""o1"") CROSS JOIN ""Orders"" AS ""o2"" WHERE ""o1"".""seller_id""=""o2"".""seller_id"" AND ""o1"".""order_date"">=""o2"".""order_date"" GROUP BY ""o1"".""seller_id"",""o1"".""order_date"" HAVING COUNT(""o2"".""order_date"")=2) AS ""t"" ON ""o"".""seller_id""=""t"".""seller_id"" AND ""o"".""order_date""=""t"".""order_date"" GROUP BY ""u"".""user_id"""
322,"WITH ""cte"" AS (SELECT ""o"".""seller_id"",""o"".""order_date"",""u"".""favorite_brand"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""daterank"" FROM (""Orders"" AS ""o"" LEFT JOIN ""Users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""cte2"" AS (SELECT ""seller_id"" FROM ""cte"" WHERE ""daterank""=2 AND ""favorite_brand""=""item_brand"" GROUP BY 1) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""cte2"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte2"" ON ""u"".""user_id""=""cte2"".""seller_id"""
323,"SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"" FROM (SELECT ""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""t1"" WHERE ""rnk""=2) AS ""t2"" RIGHT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""t2"".""seller_id"") LEFT JOIN ""items"" AS ""i"" USING (""item_id"")"
324,"WITH ""second_order"" AS (SELECT ""agg"".""seller_id"",""agg"".""item_id"",""i"".""item_brand"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""req_rank"" FROM ""orders"") AS ""AGG"" JOIN ""items"" AS ""I"" ON ""i"".""item_id""=""agg"".""item_id"" WHERE ""agg"".""req_rank""=2) SELECT DISTINCT ""agg"".""user_id"" AS ""seller_id"",CASE WHEN (""agg"".""no_orders"">1) AND (""agg"".""favorite_brand""=""agg"".""second_order_brand"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"",""u"".""favorite_brand"",""so"".""item_brand"" AS ""second_order_brand"",COALESCE(""ns"".""no_orders"", 0) AS ""no_orders"" FROM (""users"" AS ""U"" LEFT JOIN ""second_order"" AS ""SO"" ON ""u"".""user_id""=""so"".""seller_id"") LEFT JOIN (SELECT ""seller_id"",COALESCE(COUNT(""order_id""), 0) AS ""no_orders"" FROM ""orders"" GROUP BY 1) AS ""NS"" ON ""u"".""user_id""=""NS"".""seller_id"") AS ""AGG"""
325,"WITH ""UserSales"" AS (SELECT ""U"".""user_id"",(""I"".""item_brand""=""U"".""favorite_brand"") AS ""isFavorite"",ROW_NUMBER() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""SaleOrder"" FROM (""Users"" AS ""U"" JOIN ""Orders"" AS ""O"" ON ""U"".""user_id""=""O"".""seller_id"") JOIN ""Items"" AS ""I"" ON ""I"".""item_id""=""O"".""item_id""), ""SecondSale"" AS (SELECT ""user_id"",""isFavorite"",""SaleOrder"" FROM ""UserSales"" WHERE ""SaleOrder""=2) SELECT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""S"".""isFavorite""=1 THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""U"" LEFT JOIN ""SecondSale"" AS ""S"" ON ""U"".""user_id""=""S"".""user_id"""
326,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
327,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""t"".""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""t"" JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" WHERE ""rnk""=2) AS ""t2"" ON ""u"".""user_id""=""t2"".""seller_id"""
328,"WITH ""tmp"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"",""b"".""item_brand"" FROM ""Orders"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id""), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""ranks""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""tmp2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
329,"WITH ""cte1"" AS (SELECT ""user_id"",""favorite_brand"",""item_id"" FROM (SELECT ""item_id"",""seller_id"" FROM (SELECT ""item_id"",""seller_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rw"" FROM ""orders"") AS ""t"" WHERE ""rw""=2) AS ""t"" RIGHT JOIN ""users"" AS ""u"" ON ""user_id""=""seller_id"") SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""cte1"" LEFT JOIN ""items"" AS ""i"" USING (""item_id"")"
330,"WITH ""cte"" AS (SELECT ""o"".""seller_id"",""item_brand"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""o"".""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id""), ""cnt"" AS (SELECT ""seller_id"",COUNT(DISTINCT ""item_id"") AS ""ordr_cnt"" FROM ""orders"" AS ""o"" GROUP BY ""seller_id"") SELECT ""user_id"" AS ""seller_id"",MAX(COALESCE(CASE WHEN ""rnk""=2 AND ""item_brand""=""u"".""favorite_brand"" THEN 'yes' WHEN ""ordr_cnt""<2 OR ""ct"".""seller_id"" IS NULL THEN 'no' END, 'no')) AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""c"".""seller_id""=""u"".""user_id"") LEFT JOIN ""cnt"" AS ""ct"" ON ""ct"".""seller_id""=""u"".""user_id"" GROUP BY ""user_id"""
331,"SELECT ""user_id"" AS ""seller_id"",COALESCE((CASE WHEN ""favorite_brand""=""tmp"".""item_brand"" THEN 'yes' ELSE 'no' END), 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT * FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""tmp2"" WHERE ""rnk""=2) AS ""tmp"" ON ""u"".""user_id""=""tmp"".""seller_id"""
332,"WITH ""cte"" AS (SELECT ""u"".""user_id"",""o"".""order_id"",""o"".""order_date"",""o"".""item_id"",""i"".""item_id"" AS ""fav_brand_id"",DENSE_RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""ORDER_DATE"") AS ""Order_Rank"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") JOIN ""Items"" AS ""i"" ON ""u"".""favorite_brand""=""i"".""item_brand"") SELECT DISTINCT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""c"".""Order_Rank""=2 AND ""item_id""=""fav_brand_id"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" AS ""c"" ON ""c"".""user_id""=""u"".""user_id"" AND ""c"".""Order_Rank""=2 AND ""item_id""=""fav_brand_id"""
333,"WITH ""b"" AS (SELECT * FROM (SELECT ""b"".""user_id"" AS ""seller_id"",""a"".""order_date"",CASE WHEN ""b"".""favorite_brand""=""c"".""item_brand"" THEN 1 ELSE 0 END AS ""Fav_Item_Sold"",ROW_NUMBER() OVER (PARTITION BY ""a"".""seller_id"" ORDER BY ""a"".""order_date"") AS ""Order_Number"" FROM (""users"" AS ""b"" JOIN ""orders"" AS ""a"" ON ""a"".""seller_id""=""b"".""user_id"") JOIN ""items"" AS ""c"" ON ""c"".""item_id""=""a"".""item_id"") AS ""a"" WHERE ""Fav_Item_Sold""=1 AND ""Order_Number""=2) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
334,"SELECT ""t1"".""user_id"" AS ""seller_id"",CASE WHEN ""t2"".""item_brand"" IS NULL THEN 'no' WHEN ""t1"".""favorite_brand""!=""t2"".""item_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""t1"" LEFT JOIN (SELECT ""t"".* FROM (SELECT ""t1"".""seller_id"",""t1"".""order_date"",""t1"".""item_id"",""t2"".""item_brand"",RANK() OVER (PARTITION BY ""t1"".""seller_id"" ORDER BY ""t1"".""order_date"") AS ""rank"" FROM ""orders"" AS ""t1"" JOIN ""items"" AS ""t2"" ON ""t2"".""item_id""=""t1"".""item_id"") AS ""t"" WHERE ""t"".""rank""=2) AS ""t2"" ON ""t2"".""seller_id""=""t1"".""user_id"" ORDER BY ""t1"".""user_id"""
335,"WITH ""t"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""n"" AS (SELECT ""u"".""user_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""n"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""n"" ON ""u"".""user_id""=""n"".""user_id"""
336,"WITH ""reOrders"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rowNum"" FROM ""Orders"") AS ""a"" WHERE ""rowNum""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN (SELECT ""seller_id"" FROM (""Users"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""favorite_brand""=""b"".""item_brand"") JOIN ""reOrders"" AS ""c"" ON ""b"".""item_id""=""c"".""item_id"" AND ""a"".""user_id""=""c"".""seller_id"") AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"" ORDER BY 1"
337,"WITH ""tmp"" AS (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""Orders""), ""ranked"" AS (SELECT * FROM ""tmp"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""items"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""ranked"" ON ""u"".""user_id""=""ranked"".""seller_id"") LEFT JOIN ""items"" ON ""ranked"".""item_id""=""items"".""item_id"""
338,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
339,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""item_id"",""seller_id"" FROM (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"" FROM ""orders"") AS ""temp"" WHERE ""ranks""=2) AS ""o"" ON ""user_id""=""o"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"""
340,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""rn""=2 AND ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""t1"".""user_id"",""t1"".""favorite_brand"",""t3"".""item_brand"",DENSE_RANK() OVER (PARTITION BY ""t1"".""user_id"" ORDER BY ""t2"".""order_date"") AS ""rn"",COUNT(""t2"".""order_date"") OVER (PARTITION BY ""t1"".""user_id"") AS ""cnt"" FROM (""users"" AS ""t1"" LEFT JOIN ""orders"" AS ""t2"" ON ""t1"".""user_id""=""t2"".""seller_id"") LEFT JOIN ""items"" AS ""t3"" ON ""t2"".""item_id""=""t3"".""item_id"") AS ""sub"" WHERE ""rn""=2 OR ""cnt"" IN (0,1)"
341,"SELECT ""b"".""user_id"" AS ""seller_id"",CASE WHEN ""t2"".""item_brand""=""B"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""seller_id"",""item_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""Orders"") AS ""t1"" LEFT JOIN ""Items"" AS ""t2"" ON ""t1"".""item_id""=""t2"".""item_id"") RIGHT JOIN ""Users"" AS ""B"" ON ""t1"".""seller_id""=""B"".""user_id"" AND ""t1"".""r""=2"
342,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT * FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""t"" WHERE ""rnk""=2) AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" GROUP BY ""u"".""user_id"""
343,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
344,"WITH ""sec_item"" AS (SELECT ""r"".""seller_id"",""i"".""item_brand"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""date_rnk"" FROM ""orders"") AS ""r"" LEFT JOIN ""items"" AS ""i"" ON ""r"".""item_id""=""i"".""item_id"" WHERE ""r"".""date_rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""s"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""sec_item"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
345,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ((SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_rank"" FROM ""orders"") AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" AND ""order_rank""=2) ON ""u"".""user_id""=""o"".""seller_id"" ORDER BY ""user_id"""
346,"WITH ""cte"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM ""cte"" WHERE ""rnk""=2) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
347,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
348,"SELECT ""t1"".""user_id"" AS ""seller_id"",CASE WHEN ""t1"".""favorite_brand""=""t2"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT DISTINCT ""user_id"",""favorite_brand"" FROM ""users"") AS ""t1"" LEFT JOIN (SELECT * FROM (SELECT ""o"".""seller_id"",""o"".""order_date"",""o"".""item_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rk"" FROM (""Users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" WHERE ""a"".""rk""=2) AS ""t2"" ON ""t1"".""user_id""=""t2"".""seller_id"""
349,"WITH ""seller_info"" AS (SELECT ""ts"".""seller_id"",""item_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",""o"".""item_id"",""i"".""item_brand"",""order_date"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""ts"" WHERE ""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""s"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""seller_info"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
350,"SELECT ""seller_id"",CASE WHEN ""items"".""item_brand""=""users"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Items"" AS ""items"" JOIN (SELECT ""item_id"",""seller_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""num"" FROM ""Orders"") AS ""2ndorder"" ON ""2ndorder"".""item_id""=""items"".""item_id"") JOIN ""Users"" AS ""users"" ON ""users"".""user_id""=""2ndorder"".""seller_id"" WHERE ""2ndorder"".""num""=2 UNION SELECT ""users"".""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""Orders"" AS ""orders"" RIGHT JOIN ""Users"" AS ""users"" ON ""orders"".""seller_id""=""users"".""user_id"" WHERE ""users"".""user_id"" NOT IN (SELECT ""seller_id"" FROM ""Orders"" GROUP BY ""seller_id"" HAVING COUNT(""item_id"")>1)"
351,"SELECT ""UR"".""user_id"" AS ""seller_id"",COALESCE(""S"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""UR"" LEFT JOIN (SELECT ""O"".""seller_id"",CASE WHEN ""I"".""item_brand""!=""U"".""favorite_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""seller_id"",""order_date"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_sequence"" FROM ""Orders"") AS ""O"" JOIN ""Users"" AS ""U"" ON ""U"".""user_id""=""O"".""seller_id"") JOIN ""Items"" AS ""I"" ON ""O"".""item_id""=""I"".""item_id"" WHERE ""O"".""sold_sequence""=2) AS ""S"" ON ""UR"".""user_id""=""S"".""seller_id"""
352,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
353,"WITH ""t2"" AS (SELECT ""seller_id"",COUNT(1) AS ""cnt"",MAX(CASE WHEN ""RNUM""=2 THEN ""item_brand"" ELSE NULL END) AS ""item2"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rnum"" FROM ""Orders"" AS ""o"" LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t1"" GROUP BY ""seller_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN COALESCE(""cnt"", 0)<2 THEN 'no' WHEN ""favorite_brand""!=""item2"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""t2"" ON ""t2"".""seller_id""=""u"".""user_id"""
354,"WITH ""a"" AS (SELECT ""o"".""order_date"",""o"".""seller_id"",""u"".""favorite_brand"",""i"".""item_brand"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank"" FROM (""orders"" AS ""o"" LEFT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" USING (""item_id"")), ""b"" AS (SELECT ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""a"" WHERE ""a"".""rank""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""b"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""b"" ON ""u"".""user_id""=""b"".""seller_id"""
355,"WITH ""tbl2"" AS (WITH ""tbl1"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""salenum"" FROM ""orders"") SELECT ""users"".""user_id"",""tbl1"".""item_id"",""users"".""favorite_brand"",""items"".""item_brand"" FROM (""tbl1"" RIGHT JOIN ""users"" ON ""users"".""user_id""=""tbl1"".""seller_id"") LEFT JOIN ""items"" ON ""tbl1"".""item_id""=""items"".""item_id"" WHERE ""tbl1"".""salenum""=2) SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN ""tbl2"".""item_brand"" IS NULL THEN 'no' WHEN ""tbl2"".""favorite_brand""=""tbl2"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""tbl2"" RIGHT JOIN ""users"" ON ""tbl2"".""user_id""=""users"".""user_id"""
356,"WITH ""cte"" AS (SELECT ""user_id"",""favorite_brand"",""item_brand"",""order_date"",DENSE_RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""orders"" AS ""o"" RIGHT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") RIGHT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""seller_id"",(CASE WHEN ""favorite_brand"" IS NULL THEN 'no' WHEN ""favorite_brand""!=""item_brand"" THEN 'no' WHEN ""favorite_brand""=""item_brand"" THEN 'yes' END) AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"" AS ""seller_id"",""cte"".""favorite_brand"" AS ""favorite_brand"",""cte"".""item_brand"" AS ""item_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""user_id"" AND ""rnk""=2) AS ""a"""
357,"WITH ""rank_orders"" AS (SELECT ""seller_id"",""order_date"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank"" FROM ""orders"") SELECT ""t1"".""user_id"" AS ""seller_id"",CASE WHEN ""t3"".""item_brand"" IS NULL THEN 'no' WHEN ""t1"".""favorite_brand""!=""item_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""t1"" LEFT JOIN (SELECT * FROM ""rank_orders"" WHERE ""rank""=2) AS ""t2"" ON ""t2"".""seller_id""=""t1"".""user_id"") LEFT JOIN ""items"" AS ""t3"" ON ""t3"".""item_id""=""t2"".""item_id"""
358,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
359,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"" FROM ""Orders"" AS ""o"") AS ""a"" ON ""a"".""ranks""=2 AND ""u"".""user_id""=""a"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""a"".""item_id""=""i"".""item_id"" ORDER BY 1"
360,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""t2"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""item_brand"",""seller_id"" FROM (SELECT ""i"".""item_brand"",""o"".""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""o"".""order_date"") AS ""dt_rk"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t"" WHERE ""dt_rk""=2) AS ""t2"" ON ""u"".""user_id""=""t2"".""seller_id"""
361,"WITH ""sorting"" AS (SELECT ""seller_id"",CASE WHEN ""i"".""item_brand""=""u1"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranking"" FROM ""Orders"") AS ""o"" LEFT JOIN ""Users"" AS ""u1"" ON ""o"".""seller_id""=""u1"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"" WHERE ""ranking""=2) SELECT ""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""sorting"" AS ""s"" RIGHT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""s"".""seller_id"""
362,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
363,"WITH ""CET"" AS (SELECT ""p1"".""item_id"",""seller_id"",""item_brand"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranking"" FROM ""Orders"") AS ""p1"" LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""p1"".""item_id"" WHERE ""ranking""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""CET"" AS ""c"" RIGHT JOIN ""Users"" AS ""u"" ON ""c"".""seller_id""=""u"".""user_id"""
364,"WITH ""have_2nd"" AS (SELECT ""a"".""user_id"",CASE WHEN ""a"".""favorite_brand""=""c"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""a"" JOIN (SELECT ""item_id"",""seller_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row_num"" FROM ""orders"") AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"") JOIN ""items"" AS ""c"" ON ""b"".""item_id""=""c"".""item_id"" WHERE ""b"".""row_num""=2) SELECT ""a"".""user_id"" AS ""seller_id"",COALESCE(""b"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""have_2nd"" AS ""b"" ON ""a"".""user_id""=""b"".""user_id"""
365,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""o1"".""seller_id"",""o1"".""item_id"",""o1"".""order_date"" FROM ""Orders"" AS ""o1"" JOIN ""Orders"" AS ""o2"" ON ""o1"".""seller_id""=""o2"".""seller_id"" AND ""o1"".""order_date"">""o2"".""order_date"" GROUP BY ""o1"".""seller_id"",""o1"".""order_date"" HAVING COUNT(""o1"".""order_id"")=1) AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" ORDER BY ""u"".""user_id"""
366,"WITH ""tmp"" AS (SELECT ""o"".""order_id"",""order_date"",""o"".""item_id"",""buyer_id"",""u"".""user_id"" AS ""seller_id"",RANK() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""order_date"") AS ""item_order"",COUNT(1) OVER (PARTITION BY ""u"".""user_id"") AS ""item_count"",""u"".""favorite_brand"",""i"".""item_brand"" FROM (""Orders"" AS ""o"" RIGHT JOIN ""Users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") (SELECT DISTINCT ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""tmp"" WHERE ""item_count""<2) UNION ALL (SELECT DISTINCT ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""tmp"" WHERE ""item_count"">=2 AND ""item_order""=2) ORDER BY ""seller_id"""
367,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
368,"WITH ""cte"" AS (SELECT COALESCE(""order_date"", '2020/01/01') AS ""order_date"",COALESCE(""o"".""item_id"", 0),""seller_id"",""favorite_brand"",COALESCE(""item_brand"", NULL) AS ""soldItem"" FROM (""Orders"" AS ""o"" LEFT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" ORDER BY ""order_date"" DESC), ""ct2"" AS (SELECT ""order_date"",""seller_id"",""soldItem"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rowN"",""favorite_brand"" AS ""fb"" FROM ""cte"") SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",(CASE WHEN ""soldItem""=""fb"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""ct2"" WHERE ""rowN""=2) AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"" ORDER BY ""u"".""user_id"""
369,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""t"".""favorite_brand""=""t"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN (SELECT ""u"".""user_id"",""u"".""favorite_brand"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""o"".""order_date"") AS ""date_rank"" FROM (""users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""t"" ON ""u"".""user_id""=""t"".""user_id"" AND ""t"".""date_rank""=2"
370,"WITH ""t1"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""t2"" AS (SELECT * FROM ""t1"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""t2"" ON ""u"".""user_id""=""t2"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""t2"".""item_id""=""i"".""item_id"""
371,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""s"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT * FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"") AS ""rownum"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""temp"" WHERE ""rownum""=2) AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
372,"SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' WHEN ""i"".""item_brand"" IS NULL THEN 'no' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT * FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders"") AS ""tmp"" WHERE ""rn""=2) AS ""o"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"""
373,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
374,"WITH ""CTE"" AS (SELECT ""a"".""user_id"",""a"".""item_brand"" FROM (SELECT ""user_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM (""Users"" AS ""u"" JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""a"" WHERE ""a"".""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""cte"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""CTE"" ON ""u"".""user_id""=""CTE"".""user_id"""
375,"WITH ""cte"" AS (SELECT ""item_id"",""seller_id"" FROM (SELECT ""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders"") AS ""f"" WHERE ""r""=2), ""cte1"" AS (SELECT ""cte"".""item_id"",""cte"".""seller_id"",""i"".""item_brand"",""u"".""favorite_brand"" FROM (""cte"" JOIN ""items"" AS ""i"" ON ""cte"".""item_id""=""i"".""item_id"") JOIN ""users"" AS ""u"" ON ""cte"".""seller_id""=""u"".""user_id"") SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""cte1"".""item_brand""=""cte1"".""favorite_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""cte1"" ON ""u"".""user_id""=""cte1"".""seller_id"""
376,"WITH ""tmp"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""rn"" FROM (""users"" JOIN ""orders"" ON ""user_id""=""seller_id"") NATURAL CROSS JOIN ""items""), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""favorite_brand""=""item_brand"" AND ""rn""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT ""user_id"" FROM ""tmp2"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"""
377,"WITH ""sec_fav_brand"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""o"".""seller_id"",""i"".""item_brand"",RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""order_date"") AS ""rank_brand"" FROM ""Orders"" AS ""o"" JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") AS ""temp1"" WHERE ""rank_brand""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""u"".""favorite_brand""=""s"".""item_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""sec_fav_brand"" AS ""s"" ON ""u"".""user_id""=""s"".""seller_id"""
378,"SELECT ""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u0"" LEFT JOIN (SELECT ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""days"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""o"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" USING (""item_id"") WHERE ""order_date"">""join_date"") AS ""t"" WHERE ""t"".""days""=2) AS ""t1"" ON ""u0"".""user_id""=""t1"".""seller_id"""
379,"WITH ""CTE"" AS (SELECT DISTINCT ""O"".""seller_id"",NTH_VALUE(""O"".""item_id"", 2) OVER (PARTITION BY ""O"".""seller_id"" ORDER BY ""O"".""order_date"") AS ""2nd_item"" FROM ""Orders"" AS ""O"") SELECT DISTINCT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""Items"".""item_brand""=""U"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT * FROM ""CTE"" WHERE ""CTE"".""2nd_item"" IS NOT NULL) AS ""CTE"" LEFT JOIN ""Items"" ON ""CTE"".""2nd_item""=""Items"".""Item_id"") RIGHT JOIN ""Users"" AS ""U"" ON ""CTE"".""seller_id""=""U"".""user_id"" ORDER BY ""CTE"".""seller_id"""
380,"WITH ""CTE1"" AS (SELECT ""SELLER_ID"",""ITEM_ID"",RANK() OVER (PARTITION BY ""SELLER_ID"" ORDER BY ""ORDER_DATE"") AS ""RNK"" FROM ""ORDERS""), ""CTE2"" AS (SELECT ""USER_ID"",""CTE1"".""ITEM_ID"",""ITEM_BRAND"",""FAVORITE_BRAND"" FROM (""CTE1"" RIGHT JOIN ""USERS"" AS ""U"" ON ""CTE1"".""SELLER_ID""=""U"".""USER_ID"" AND ""RNK""=2) LEFT JOIN ""ITEMS"" AS ""I"" ON ""CTE1"".""ITEM_ID""=""I"".""ITEM_ID"") SELECT ""USER_ID"" AS ""SELLER_ID"",CASE WHEN ""ITEM_BRAND""=""FAVORITE_BRAND"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""CTE2"""
381,"WITH ""t1"" AS (SELECT ""u"".""user_id"",""i"".""item_brand"",""u"".""favorite_brand"",RANK() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""o"".""order_date"") AS ""rk"" FROM ""Users"" AS ""u"" LEFT JOIN (""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") ON ""u"".""user_id""=""o"".""seller_id"") SELECT ""user_id"" AS ""seller_id"",MAX(CASE WHEN ""item_brand""=""favorite_brand"" AND ""rk""=2 THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""t1"" GROUP BY ""user_id"""
382,"WITH ""a"" AS (SELECT RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"",""item_id"",""seller_id"" FROM ""Orders""), ""b"" AS (SELECT ""seller_id"" FROM (""a"" JOIN ""Users"" AS ""u"" ON ""a"".""seller_id""=""u"".""user_id"") JOIN ""Items"" AS ""i"" ON ""a"".""item_id""=""i"".""item_id"" WHERE ""r""=2 AND ""u"".""favorite_brand""=""i"".""item_brand"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NOT NULL THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""b"" RIGHT JOIN ""Users"" AS ""u"" ON ""b"".""seller_id""=""u"".""user_id"""
383,"WITH ""cte"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM ""cte"" WHERE ""rnk""=2) AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
384,"WITH ""O1"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders""), ""OI"" AS (SELECT ""O1"".""seller_id"",""I"".""item_brand"" FROM ""O1"" JOIN ""Items"" AS ""I"" ON ""O1"".""item_id""=""I"".""item_id"" WHERE ""O1"".""rn""=2) SELECT ""U"".""user_id"" AS ""seller_id"",CASE WHEN ""U"".""favorite_brand""=""OI"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""U"" LEFT JOIN ""OI"" ON ""U"".""user_id""=""OI"".""seller_id"""
385,"WITH ""sell_rank"" AS (SELECT ""orders"".""seller_id"",""orders"".""item_id"",""items"".""item_brand"",RANK() OVER (PARTITION BY ""orders"".""seller_id"" ORDER BY ""orders"".""order_date"") AS ""rk"" FROM ""orders"" JOIN ""items"" ON ""orders"".""item_id""=""items"".""item_id""), ""second_rk"" AS (SELECT ""seller_id"",""item_brand"" FROM ""sell_rank"" WHERE ""rk""=2) SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN (""users"".""favorite_brand""=""second_rk"".""item_brand"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""second_rk"" ON ""users"".""user_id""=""second_rk"".""seller_id"""
386,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".*,""c"".""item_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""b"".*,""i"".""item_brand"" FROM (SELECT ""seller_id"",""item_id"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"") AS ""a"" WHERE ""rk""=2) AS ""b"" LEFT JOIN ""Items"" AS ""i"" ON ""b"".""item_id""=""i"".""item_id"") AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"") AS ""d"""
387,"SELECT ""t1"".""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""favorite_brand""=COALESCE(""item_brand"", '') THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""t1"" LEFT JOIN (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""t2"" ON ""t1"".""user_id""=""t2"".""seller_id"" AND ""t2"".""rnk""=2) LEFT JOIN ""Items"" AS ""t3"" ON ""t2"".""Item_Id""=""t3"".""Item_id"" ORDER BY 1"
388,"WITH ""sorting"" AS (SELECT ""seller_id"",CASE WHEN ""i"".""item_brand""=""u1"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranking"" FROM ""Orders"") AS ""o"" LEFT JOIN ""Users"" AS ""u1"" ON ""o"".""seller_id""=""u1"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"" WHERE ""ranking""=2) SELECT ""user_id"" AS ""seller_id"",COALESCE(""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""sorting"" AS ""s"" RIGHT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""s"".""seller_id"""
389,"SELECT ""users"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT * FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders"") AS ""a"" WHERE ""rn""=2) AS ""b"" JOIN ""items"" ON ""b"".""item_id""=""items"".""item_id"") RIGHT JOIN ""Users"" ON ""b"".""seller_id""=""users"".""user_id"""
390,"WITH ""temp"" AS (SELECT ""a"".""user_id"",""b"".""item_id"" AS ""fav_item"",""c"".""second_item"" FROM (""users"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""favorite_brand""=""b"".""item_brand"") LEFT JOIN (SELECT DISTINCT ""seller_id"",NTH_VALUE(""item_id"", 2) OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"" ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS ""second_item"" FROM ""orders"") AS ""c"" ON ""a"".""user_id""=""c"".""seller_id"" ORDER BY ""a"".""user_id""), ""temp2"" AS (SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""fav_item""=""second_item"" THEN 'yes' ELSE 'no' END AS ""item_fav_brand"" FROM ""temp""), ""temp3"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""item_fav_brand"" DESC) AS ""rn"" FROM ""temp2"") SELECT ""seller_id"",""item_fav_brand"" AS ""2nd_item_fav_brand"" FROM ""temp3"" WHERE ""rn""=1"
391,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""o1"".""seller_id"",""o1"".""item_id"",""o1"".""order_date"" FROM ""Orders"" AS ""o1"" JOIN ""Orders"" AS ""o2"" ON ""o1"".""seller_id""=""o2"".""seller_id"" AND ""o1"".""order_date"">""o2"".""order_date"" GROUP BY ""o1"".""seller_id"",""o1"".""order_date"" HAVING COUNT(""o1"".""order_id"")=1) AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" ORDER BY ""u"".""user_id"""
392,"WITH ""cte1"" AS (SELECT ""u"".""user_id"" AS ""seller_id"",""u"".""favorite_brand"",""i"".""item_id"" FROM ""Users"" AS ""u"" JOIN ""Items"" AS ""i"" ON ""u"".""favorite_brand""=""i"".""item_brand""), ""cte2"" AS (SELECT * FROM (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""line"" FROM ""Orders"") AS ""t"" WHERE ""t"".""line""=2), ""cte3"" AS (SELECT DISTINCT ""c1"".""seller_id"",(CASE WHEN ""c1"".""item_id""=""c2"".""item_id"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""cte1"" AS ""c1"" LEFT JOIN ""cte2"" AS ""c2"" ON ""c1"".""seller_id""=""c2"".""seller_id""), ""cte4"" AS (SELECT ""o"".""seller_id"",""o"".""order_date"",""o"".""item_id"",""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" ORDER BY ""order_date"" LIMIT 1 OFFSET 1), ""cte5"" AS (SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"") SELECT * FROM ""cte5"""
393,"WITH ""cte"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""temp"" LEFT JOIN ""items"" USING (""item_id"") WHERE ""rnk""=2), ""cte2"" AS (SELECT ""seller_id"",""item_brand"" FROM ""cte"" WHERE ROW(""seller_id"",""item_brand"") IN (SELECT ""user_id"",""favorite_brand"" FROM ""users"")) SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""cte2"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END) AS ""2nd_item_fav_brand"" FROM ""users"" LEFT JOIN ""cte2"" ON ""users"".""user_id""=""cte2"".""seller_id"""
394,"WITH ""sec_sold_cte"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""t"" WHERE ""t"".""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""sec_sold_cte"" AS ""c"" ON ""u"".""user_id""=""c"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""c"".""item_id"""
395,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
396,"WITH ""t"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""n"" AS (SELECT ""t"".""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""t"" JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" AND ""t"".""r""=2) JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""t"".""seller_id"") SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""n"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""n"" ON ""u"".""user_id""=""n"".""seller_id"""
397,"WITH ""A"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rks"" FROM ""ORDERS""), ""B"" AS (SELECT ""seller_id"",""item_id"" FROM ""A"" WHERE ""rks""=2), ""C"" AS (SELECT ""B"".""seller_id"",""item_brand"" FROM ""B"" JOIN ""Items"" ON ""B"".""item_id""=""Items"".""item_id"") SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""C"" ON ""Users"".""user_id""=""C"".""seller_id"""
398,"WITH ""A"" AS (SELECT ""seller_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_rank"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id""), ""B"" AS (SELECT ""user_id"",'2' AS ""2nd_order"" FROM ""users""), ""C"" AS (SELECT ""user_id"",""item_brand"" FROM ""A"" RIGHT JOIN ""B"" ON ""A"".""seller_id""=""B"".""user_id"" AND ""A"".""order_rank""=""B"".""2nd_order""), ""D"" AS (SELECT ""user_id"",""favorite_brand"" FROM ""users"" AS ""u"" JOIN ""items"" AS ""i"" ON ""u"".""favorite_brand""=""i"".""item_brand"") SELECT DISTINCT ""C"".""user_id"" AS ""seller_id"",CASE WHEN ""C"".""item_brand""=""D"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""C"" LEFT JOIN ""D"" ON ""C"".""user_id""=""D"".""user_id"" ORDER BY 1"
399,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""u"".""user_id"",""o"".""item_id"",ROW_NUMBER() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""order_date"") AS ""date_rank"",""i"".""item_brand"",""u"".""favorite_brand"" FROM (""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") RIGHT JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") AS ""t"" WHERE ""date_rank""=2 UNION SELECT ""u"".""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"" GROUP BY ""u"".""user_id"" HAVING COUNT(1)<2 ORDER BY 1"
400,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank_order"" FROM ""Orders"") AS ""o"" WHERE ""rank_order""=2) AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"""
401,"WITH ""temp"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranked"" FROM ""Orders"") AS ""t1"" WHERE ""ranked""=2) SELECT DISTINCT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""temp"" ON ""temp"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" ON ""temp"".""item_id""=""i"".""item_id"""
402,"SELECT ""UR"".""user_id"" AS ""seller_id"",CASE WHEN ""S"".""2nd_item_fav_brand""='yes' THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""UR"" LEFT JOIN (SELECT ""O"".""seller_id"",CASE WHEN ""I"".""item_brand""!=""U"".""favorite_brand"" THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""seller_id"",""order_date"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sold_sequence"" FROM ""Orders"") AS ""O"" JOIN ""Users"" AS ""U"" ON ""U"".""user_id""=""O"".""seller_id"") JOIN ""Items"" AS ""I"" ON ""O"".""item_id""=""I"".""item_id"" WHERE ""O"".""sold_sequence""=2) AS ""S"" ON ""UR"".""user_id""=""S"".""seller_id"""
403,"WITH ""second_order"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""order_date"",""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""sub"" WHERE ""rnk""=2), ""brand"" AS (SELECT ""s"".""seller_id"",""u"".""favorite_brand"" AS ""fav_brand"",""i"".""item_brand"" AS ""brand"" FROM (""second_order"" AS ""s"" JOIN ""items"" AS ""i"" ON ""s"".""item_id""=""i"".""item_id"") JOIN ""users"" AS ""u"" ON ""s"".""seller_id""=""u"".""user_id"") (SELECT ""seller_id"",(CASE WHEN ""fav_brand""=""brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""brand"") UNION (SELECT ""user_id"",'no' AS ""2nd_item_fav_brand"" FROM ""users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""second_order""))"
404,"WITH ""RankNCount"" AS (SELECT ""u"".""user_id"",""u"".""favorite_brand"",RANK() OVER (PARTITION BY ""u"".""user_id"" ORDER BY ""o"".""order_date"") AS ""item_sold_rank"",COUNT(""o"".""order_id"") OVER (PARTITION BY ""u"".""user_id"") AS ""item_sold_count"",""i"".""item_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""Orders"" AS ""o"" ON ""u"".""user_id""=""o"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""RankNCount"" WHERE ""item_sold_rank""=2 UNION SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""RankNCount"" WHERE ""item_sold_count""<=1"
405,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""ct""=1 THEN 'no' WHEN ""t1"".""seller_id"" IS NULL THEN 'no' WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""order_id"",""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"",COUNT(1) OVER (PARTITION BY ""seller_id"") AS ""ct"" FROM ""orders"") AS ""t1"" JOIN ""items"" AS ""i"" ON ""t1"".""item_id""=""i"".""item_id"") RIGHT JOIN ""users"" AS ""u"" ON ""t1"".""seller_id""=""u"".""user_id"" WHERE ""t1"".""rk""=2 OR ""t1"".""ct""=1 OR ""t1"".""seller_id"" IS NULL"
406,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN (SELECT ""item_brand"",""seller_id"" FROM (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rank_num"" FROM ""Orders"") AS ""o"" JOIN ""Items"" ON ""Items"".""item_id""=""o"".""item_id"" WHERE ""rank_num""=2) AS ""temp"" ON ""Users"".""user_id""=""temp"".""seller_id"" ORDER BY ""user_id"""
407,"WITH ""2nd_sales"" AS (SELECT ""t"".""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""order_id"",""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rk"" FROM ""Orders"" AS ""o"") AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""seller_id""=""u"".""user_id"") JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""t"".""item_id"" WHERE ""rk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""s"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""2nd_sales"" AS ""s"" ON ""s"".""seller_id""=""u"".""user_id"""
408,"WITH ""a"" AS (SELECT RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"",""item_id"",""seller_id"" FROM ""Orders""), ""b"" AS (SELECT ""seller_id"" FROM (""a"" JOIN ""Users"" AS ""u"" ON ""a"".""seller_id""=""u"".""user_id"") JOIN ""Items"" AS ""i"" ON ""a"".""item_id""=""i"".""item_id"" WHERE ""r""=2 AND ""u"".""favorite_brand""=""i"".""item_brand"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NOT NULL THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""b"" RIGHT JOIN ""Users"" AS ""u"" ON ""b"".""seller_id""=""u"".""user_id"""
409,"WITH ""tmp"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT ""seller_id"",""item_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r_number"" FROM ""Orders"") AS ""ina"" WHERE ""r_number""=2) SELECT ""ina"".""user_id"" AS ""seller_id"",CASE WHEN ""ina"".""favorite_brand""=""inc"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""ina"" LEFT JOIN ""tmp"" AS ""inb"" ON ""ina"".""user_id""=""inb"".""seller_id"") LEFT JOIN ""Items"" AS ""inc"" ON ""inb"".""item_id""=""inc"".""item_id"""
410,"WITH ""SortedOrder"" AS (SELECT ""u"".""user_id"",""o"".""item_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_num"",""u"".""favorite_brand"" FROM (""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") RIGHT JOIN ""Users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") SELECT ""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""item_brand""=""favorite_brand"" AND ""order_num""=2 THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""SortedOrder"" WHERE ""order_num""=2 OR ""user_id"" IN (SELECT ""user_id"" FROM ""SortedOrder"" GROUP BY ""user_id"" HAVING COUNT(1)<2)"
411,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""user_id"" ORDER BY ""order_date"") AS ""order_rnk"" FROM ""orders"" AS ""o"" JOIN ""users"" AS ""u"" ON ""o"".""seller_id""=""u"".""user_id"") AS ""a"" WHERE ""order_rnk""=2) AS ""b"" ON ""u"".""user_id""=""b"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""b"".""item_id"" ORDER BY ""u"".""user_id"""
412,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
413,"SELECT ""u1"".""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""item_brand"" FROM ""Orders"" AS ""o1"" LEFT JOIN ""items"" ON ""items"".""item_id""=""o1"".""item_id"" WHERE ""u1"".""user_id""=""o1"".""seller_id"" ORDER BY ""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u1"""
414,"SELECT ""A"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""A"" LEFT JOIN (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""B"".*,""C"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rw_num"" FROM ""Orders"" AS ""B"" LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"") AS ""Y"" WHERE ""Y"".""rw_num""=2) AS ""X"" ON ""A"".""user_id""=""X"".""seller_id"""
415,"WITH ""cte"" AS (SELECT DISTINCT ""a"".""seller_id"",""a"".""item_id"",""i"".""item_brand"" FROM (SELECT ""seller_id"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"") AS ""a"" JOIN ""Items"" AS ""i"" ON ""a"".""item_id""=""i"".""item_id"" WHERE ""a"".""rnk""=2) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""cte"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""cte"" ON ""u"".""user_id""=""cte"".""seller_id"""
416,"WITH ""new"" AS (SELECT ""seller_id"",""item_id"",""item_brand"" FROM (SELECT ""seller_id"",""o"".""item_id"",""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""num"" FROM ""orders"" AS ""o"" JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""o"".""item_id"") AS ""a"" WHERE ""num""=2), ""new2"" AS (SELECT ""user_id"",""item_id"",""favorite_brand"",""item_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""new"" ON ""u"".""user_id""=""new"".""seller_id"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""new2"""
417,"WITH ""sellers"" AS (SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(COUNT(""o"".""order_id""), 0) AS ""order_count"" FROM ""users"" AS ""u"" LEFT JOIN ""orders"" AS ""o"" ON ""o"".""seller_id""=""u"".""user_id"" GROUP BY 1), ""second_item"" AS (SELECT ""o2"".""seller_id"",""o2"".""item_brand"" FROM ""orders"" AS ""o1"" JOIN (SELECT ""seller_id"",""order_id"",""i"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""order_row"" FROM ""orders"" AS ""ox"" JOIN ""items"" AS ""i"" ON ""i"".""item_id""=""ox"".""item_id"") AS ""o2"" ON ""o2"".""seller_id""=""o1"".""seller_id"" AND ""o2"".""order_id""=""o1"".""order_id"" AND ""order_row""=2) SELECT ""s"".""seller_id"",CASE WHEN ""si"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" LEFT JOIN ""sellers"" AS ""s"" ON ""s"".""seller_id""=""u"".""user_id"") LEFT JOIN ""second_item"" AS ""si"" ON ""si"".""seller_id""=""s"".""seller_id"""
418,"WITH ""tmp"" AS (SELECT *,RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"" FROM ""Orders"" JOIN ""Items"" USING (""item_id"")), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""ranks""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""tmp2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
419,"WITH ""table1"" AS (SELECT ""order_id"",""item_id"",""seller_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""table2"" AS (SELECT DISTINCT ""a"".""seller_id"" AS ""seller_id"" FROM (""table1"" AS ""a"" JOIN ""users"" AS ""b"" ON ""a"".""seller_id""=""b"".""user_id"") JOIN ""items"" AS ""c"" ON ""a"".""item_id""=""c"".""item_id"" WHERE ""r""=2 AND ""b"".""favorite_brand""=""c"".""item_brand"") SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""table2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
420,"WITH ""b"" AS (SELECT ""seller_id"",""i"".""item_brand"" AS ""second_item_brand"" FROM (SELECT ""seller_id"",""item_id"" AS ""second_item_id"" FROM (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""sell_rank"" FROM ""orders"") AS ""t"" WHERE ""sell_rank""=2) AS ""a"" LEFT JOIN ""items"" AS ""i"" ON ""a"".""second_item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""u"".""favorite_brand""=""b"".""second_item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""b"" ON ""u"".""user_id""=""b"".""seller_id"""
421,"WITH ""t"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""n"" AS (SELECT ""u"".""user_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""n"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""n"" ON ""u"".""user_id""=""n"".""user_id"""
422,"WITH ""t"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""n"" AS (SELECT ""u"".""user_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"" AND ""r""=2) LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""n"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""n"" ON ""u"".""user_id""=""n"".""user_id"""
423,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
424,"SELECT ""A"".""user_id"" AS ""seller_id"",CASE WHEN ""A"".""favorite_brand""=(SELECT ""C"".""item_brand"" FROM ""Orders"" AS ""B"" LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"" WHERE ""A"".""user_id""=""B"".""seller_id"" ORDER BY ""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""A"""
425,"WITH ""2nd_sales"" AS (SELECT ""t"".""seller_id"",CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""order_id"",""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""Orders"" AS ""o"") AS ""t"" JOIN ""Users"" AS ""u"" ON ""t"".""seller_id""=""u"".""user_id"") JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""t"".""item_id"" WHERE ""rn""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""s"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN ""2nd_sales"" AS ""s"" ON ""s"".""seller_id""=""u"".""user_id"""
426,"WITH ""a"" AS (SELECT RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"",""item_id"",""seller_id"" FROM ""Orders""), ""b"" AS (SELECT ""seller_id"" FROM (""a"" JOIN ""Users"" AS ""u"" ON ""a"".""seller_id""=""u"".""user_id"") JOIN ""Items"" AS ""i"" ON ""a"".""item_id""=""i"".""item_id"" WHERE ""r""=2 AND ""u"".""favorite_brand""=""i"".""item_brand"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NOT NULL THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""b"" RIGHT JOIN ""Users"" AS ""u"" ON ""b"".""seller_id""=""u"".""user_id"""
427,"WITH ""items_2nd"" AS (SELECT ""seller_id"",""item_brand"" FROM (SELECT ""seller_id"",""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"" AS ""a"" LEFT JOIN ""items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id"") AS ""a"" WHERE ""rnk""=2) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""items_2nd"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
428,"WITH ""t"" AS (SELECT ""seller_id"",""order_date"",""item_id"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""r"" FROM ""orders""), ""n"" AS (SELECT ""u"".""user_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""users"" AS ""u"" JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"" WHERE ""r""=2) SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(""n"".""2nd_item_fav_brand"", 'no') AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""n"" ON ""u"".""user_id""=""n"".""user_id"""
429,"SELECT ""T1"".""user_id"" AS ""seller_id"",CASE WHEN ""T3"".""item_brand""=""T1"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""T1"" LEFT JOIN (SELECT ""A"".""order_id"",""A"".""item_id"",""A"".""seller_id"" FROM ""Orders"" AS ""A"" LEFT JOIN ""Orders"" AS ""B"" ON ""A"".""seller_id""=""B"".""seller_id"" AND ""A"".""order_date"">=""B"".""order_date"" GROUP BY ""A"".""order_id"" HAVING COUNT(DISTINCT ""B"".""order_date"")=2) AS ""T2"" ON ""T1"".""user_id""=""T2"".""seller_id"") LEFT JOIN ""Items"" AS ""T3"" ON ""T2"".""item_id""=""T3"".""item_id"" ORDER BY ""T1"".""user_id"""
430,"WITH ""cte"" AS (SELECT *,LEAD(""item_id"", 1) OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""second_item"",DENSE_RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""Orders"" AS ""o"" ORDER BY ""seller_id"" DESC) SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""final"".""2nd_item_fav_brand"" IS NULL THEN 'no' WHEN ""final"".""2nd_item_fav_brand""='no' THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT ""m"".""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" AND ""i"".""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ((SELECT ""seller_id"",""second_item"" FROM ""cte"" WHERE ""rnk""=1) AS ""m"" LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""m"".""second_item"") LEFT JOIN ""Users"" AS ""u"" ON ""u"".""user_id""=""m"".""seller_id"") AS ""final"" ON ""u"".""user_id""=""final"".""seller_id"""
431,"SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ((SELECT ""item_id"",""seller_id"" FROM (SELECT ""item_id"",""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rnk"" FROM ""orders"") AS ""t1"" WHERE ""rnk""=2) AS ""t2"" RIGHT JOIN ""users"" AS ""u"" ON ""u"".""user_id""=""t2"".""seller_id"") LEFT JOIN ""items"" AS ""i"" USING (""item_id"")"
432,"WITH ""s"" AS (SELECT ""seller_id"",""i"".""item_brand"" AS ""item_brand"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""dayOfSell"" FROM ""orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""s"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""USERS"" AS ""U"" LEFT JOIN ""s"" ON ""u"".""user_id""=""s"".""seller_id"" WHERE ""s"".""dayOfSell""=2 UNION ALL SELECT ""user_id"" AS ""seller_id"",'no' AS ""2nd_item_fav_brand"" FROM ""users"" WHERE ""user_id"" NOT IN (SELECT ""seller_id"" FROM ""s"" WHERE ""s"".""dayOfSell""=2) ORDER BY ""seller_id"""
433,"WITH ""cte1"" AS (SELECT ""seller_id"",""item_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders""), ""cte2"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"" FROM ""cte1"" AS ""a"" CROSS JOIN ""items"" AS ""b"" WHERE ""a"".""rn""=2 AND ""a"".""item_id""=""b"".""item_id""), ""cte3"" AS (SELECT ""a"".""seller_id"",""b"".""favorite_brand"" FROM ""cte1"" AS ""a"" CROSS JOIN ""users"" AS ""b"" WHERE ""a"".""seller_id""=""b"".""user_id""), ""cte4"" AS (SELECT ""a"".""seller_id"",""a"".""item_brand"",""b"".""favorite_brand"" FROM ""cte2"" AS ""a"" JOIN ""cte3"" AS ""b"" ON ""a"".""seller_id""=""b"".""seller_id"") SELECT DISTINCT ""a"".""user_id"" AS ""seller_id"",(CASE WHEN ""b"".""item_brand""=""b"".""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""cte4"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
434,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
435,"WITH ""T1"" AS (SELECT ""seller_id"",""item_id"",ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""row1"" FROM ""orders""), ""T2"" AS (SELECT ""a"".""seller_id"",""a"".""item_id"" FROM ""T1"" AS ""a"" JOIN (SELECT ""a"".""user_id"",""a"".""favorite_brand"",""b"".""item_id"" FROM ""users"" AS ""a"" JOIN ""items"" AS ""b"" ON ""a"".""favorite_brand""=""b"".""item_brand"") AS ""b"" ON ""a"".""item_id""=""b"".""item_id"" AND ""a"".""seller_id""=""b"".""user_id"" WHERE ""a"".""row1""=2) SELECT ""a"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""seller_id"" IS NULL THEN 'no' ELSE 'yes' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""T2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
436,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
437,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=(SELECT ""item_brand"" FROM ""ORDERs"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
438,"WITH ""y"" AS (SELECT ""seller_id"",""item_id"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""seq"" FROM ""orders"" AS ""o"") AS ""x"" WHERE ""seq""=2), ""z"" AS (SELECT ""seller_id"",""y"".""item_id"",""item_brand"" FROM ""y"" JOIN ""items"" AS ""i"" ON ""y"".""item_id""=""i"".""item_id"") SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""item_brand""=""favorite_brand"" THEN 'yes' WHEN ""z"".""seller_id"" IS NULL OR ""item_brand""!=""favorite_brand"" THEN 'no' END AS ""2nd_item_fav_brand"" FROM ""users"" AS ""u"" LEFT JOIN ""z"" ON ""u"".""user_id""=""z"".""seller_id"""
439,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""b"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (SELECT ""seller_id"",""item_brand"" FROM (SELECT DISTINCT ""seller_id"",NTH_VALUE(""item_id"", 2) OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS ""second_item"" FROM ""Orders"") AS ""a"" JOIN ""Items"" AS ""i"" ON ""a"".""second_item""=""i"".""item_id"") AS ""b"" RIGHT JOIN ""Users"" AS ""u"" ON ""user_id""=""seller_id"""
440,"WITH ""cte1"" AS (SELECT ""seller_id"",""item_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders""), ""cte2"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"" FROM ""cte1"" AS ""a"" CROSS JOIN ""items"" AS ""b"" WHERE ""a"".""rn""=2 AND ""a"".""item_id""=""b"".""item_id""), ""cte3"" AS (SELECT ""a"".""seller_id"",""b"".""favorite_brand"" FROM ""cte1"" AS ""a"" CROSS JOIN ""users"" AS ""b"" WHERE ""a"".""seller_id""=""b"".""user_id""), ""cte4"" AS (SELECT ""a"".""seller_id"",""a"".""item_brand"",""b"".""favorite_brand"" FROM ""cte2"" AS ""a"" JOIN ""cte3"" AS ""b"" ON ""a"".""seller_id""=""b"".""seller_id"") SELECT DISTINCT ""a"".""user_id"" AS ""seller_id"",(CASE WHEN ""b"".""item_brand""=""b"".""favorite_brand"" THEN 'yes' WHEN ""b"".""item_brand""!=""b"".""favorite_brand"" THEN 'no' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""cte4"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
441,"WITH ""t"" AS (SELECT ""seller_id"",""item_id"" FROM ""Orders"" AS ""a"" WHERE (SELECT COUNT(1) FROM ""Orders"" WHERE ""seller_id""=""a"".""seller_id"" AND ""order_date""<""a"".""order_date"")=1) SELECT ""u"".""user_id"" AS ""seller_id"",(CASE WHEN ""u"".""favorite_brand""=""i"".""item_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
442,"SELECT ""user_id"" AS ""seller_id"",(CASE WHEN ""favorite_brand""=(SELECT ""i"".""item_brand"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" ON ""o"".""item_id""=""i"".""item_id"" WHERE ""o"".""seller_id""=""u"".""user_id"" ORDER BY ""o"".""order_date"" LIMIT 1 OFFSET 1) THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"""
443,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""i"".""item_brand""=""u"".""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""seller_id"",""item_id"" FROM ""Orders"" AS ""o1"" WHERE 1=(SELECT COUNT(""order_id"") FROM ""Orders"" AS ""o2"" WHERE ""o1"".""seller_id""=""o2"".""seller_id"" AND ""o1"".""order_date"">""o2"".""order_date"")) AS ""temp"" ON ""u"".""user_id""=""temp"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""i"".""item_id""=""temp"".""item_id"" ORDER BY ""u"".""user_id"""
444,"SELECT ""u"".""user_id"" AS ""seller_id"",CASE WHEN ""favorite_brand""=""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT * FROM ""Orders"" AS ""o1"" WHERE (SELECT COUNT(1) FROM ""Orders"" AS ""o2"" WHERE ""o1"".""seller_id""=""o2"".""seller_id"" AND ""o1"".""order_date"">""o2"".""order_date"")=1) AS ""t"" ON ""u"".""user_id""=""t"".""seller_id"") LEFT JOIN ""Items"" AS ""i"" ON ""t"".""item_id""=""i"".""item_id"""
445,"WITH ""table1"" AS (SELECT ""o"".""order_id"",""o"".""seller_id"",""o"".""item_id"",""i"".""item_brand"",(RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""o"".""order_date"")) AS ""rank_calc"" FROM ""Orders"" AS ""o"" LEFT JOIN ""Items"" AS ""i"" USING (""item_id"") ORDER BY ""o"".""seller_id""), ""table2"" AS (SELECT ""u"".""user_id"" AS ""seller_id"",COALESCE(CASE WHEN ""u"".""favorite_brand""=""t1"".""item_brand"" THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""u"" LEFT JOIN (SELECT * FROM ""table1"" WHERE ""rank_calc""=2) AS ""t1"" ON ""t1"".""seller_id""=""u"".""user_id"" ORDER BY ""u"".""user_id"") SELECT * FROM ""table2"""
446,"WITH ""cte1"" AS (SELECT ""seller_id"",""item_id"",""order_date"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""rn"" FROM ""orders""), ""cte2"" AS (SELECT ""a"".""seller_id"",""b"".""item_brand"" FROM ""cte1"" AS ""a"" CROSS JOIN ""items"" AS ""b"" WHERE ""a"".""rn""=2 AND ""a"".""item_id""=""b"".""item_id""), ""cte3"" AS (SELECT ""a"".""seller_id"",""b"".""favorite_brand"" FROM ""cte1"" AS ""a"" CROSS JOIN ""users"" AS ""b"" WHERE ""a"".""seller_id""=""b"".""user_id""), ""cte4"" AS (SELECT ""a"".""seller_id"",""a"".""item_brand"",""b"".""favorite_brand"" FROM ""cte2"" AS ""a"" JOIN ""cte3"" AS ""b"" ON ""a"".""seller_id""=""b"".""seller_id"") SELECT DISTINCT ""a"".""user_id"" AS ""seller_id"",(CASE WHEN ""b"".""item_brand""=""b"".""favorite_brand"" THEN 'yes' ELSE 'no' END) AS ""2nd_item_fav_brand"" FROM ""users"" AS ""a"" LEFT JOIN ""cte4"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
447,"WITH ""CTE"" AS (SELECT * FROM (SELECT ""B"".""Seller_Id"" AS ""user_id"",""C"".""item_brand"",ROW_NUMBER() OVER (PARTITION BY ""B"".""Seller_Id"" ORDER BY ""order_date"") AS ""Order_Seq"" FROM ""Orders"" AS ""B"" LEFT JOIN ""Items"" AS ""C"" ON ""B"".""item_id""=""C"".""item_id"") AS ""Data_set"" WHERE ""Order_Seq""=2) SELECT ""Users"".""User_id"" AS ""seller_id"",COALESCE(CASE WHEN (""CTE"".""item_brand""=""Users"".""favorite_brand"") AND ""item_brand"" IS NOT NULL THEN 'yes' ELSE 'no' END, 'no') AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""CTE"" ON ""Users"".""user_id""=""CTE"".""user_id"""
448,"WITH ""temp"" AS (SELECT ""seller_id"",""item_id"" FROM ""Orders"" AS ""o"" WHERE 1=(SELECT COUNT(1) FROM ""Orders"" AS ""p"" WHERE ""p"".""seller_id""=""o"".""seller_id"" AND ""p"".""order_date""<""o"".""order_date"")), ""temp1"" AS (SELECT ""seller_id"",""item_brand"" FROM ""temp"" JOIN ""Items"" ON ""temp"".""item_id""=""Items"".""item_id"") SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""item_brand"" IS NOT NULL AND ""item_brand""=""favorite_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" LEFT JOIN ""temp1"" ON ""Users"".""user_id""=""temp1"".""seller_id"" ORDER BY ""user_id"""
449,"WITH ""tmp"" AS (SELECT ""seller_id"",RANK() OVER (PARTITION BY ""seller_id"" ORDER BY ""order_date"") AS ""ranks"",""b"".""item_brand"" FROM ""Orders"" AS ""a"" JOIN ""Items"" AS ""b"" ON ""a"".""item_id""=""b"".""item_id""), ""tmp2"" AS (SELECT * FROM ""tmp"" WHERE ""ranks""=2) SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""a"".""favorite_brand""=""b"".""item_brand"" THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"" AS ""a"" LEFT JOIN ""tmp2"" AS ""b"" ON ""a"".""user_id""=""b"".""seller_id"""
450,"SELECT ""user_id"" AS ""seller_id"",CASE WHEN ""user_id"" IN (SELECT ""u"".""user_id"" FROM (""Users"" AS ""u"" LEFT JOIN (SELECT ""o"".""seller_id"",""o"".""item_id"",""o"".""order_date"",DENSE_RANK() OVER (PARTITION BY ""o"".""seller_id"" ORDER BY ""order_date"") AS ""ranks"" FROM ""Orders"" AS ""o"" GROUP BY 1,2,3) AS ""t"" ON ""t"".""seller_id""=""u"".""user_id"") LEFT JOIN ""Items"" AS ""i"" USING (""item_id"") WHERE ""t"".""ranks""=2 AND ""favorite_brand""=""item_brand"") THEN 'yes' ELSE 'no' END AS ""2nd_item_fav_brand"" FROM ""Users"""
