id,original query
1,"SELECT ""username"",""activity"",""startDate"",""EndDate"" FROM (SELECT ""username"",""activity"",""startDate"",""EndDate"",""activity_rank"",MAX(""activity_rank"") OVER (PARTITION BY ""username"") AS ""latest_rank"" FROM (SELECT ""username"",""activity"",""startDate"",""EndDate"",""activity_rank"" FROM (SELECT ""username"",""activity"",""startDate"",""EndDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""activity_rank"" FROM ""UserActivity"") AS ""sub"" WHERE ""activity_rank""<=2) AS ""sub2"") AS ""sub3"" WHERE ""activity_rank""=""latest_rank"""
2,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
3,"WITH ""T"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranking"" FROM ""UserActivity"") SELECT * FROM ""UserActivity"" WHERE ""username"" IN (SELECT ""username"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1) UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""T"" WHERE ""ranking""=2"
4,"WITH ""cte"" AS (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""r"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ""cnt""=1 OR ""r""=2"
5,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""startDate"") AS ""cnt"" FROM ""UserActivity"" GROUP BY ""username"") AS ""Users_with_one_activity"" WHERE ""cnt""=1 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rn"" FROM ""UserActivity"") AS ""Users_with_row_number"" WHERE ""rn""=2"
6,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""a"".*,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""row_n"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"" AS ""a"") AS ""t"" WHERE ""t"".""row_n""=2 OR ""cnt""<2"
7,"WITH ""detail"" AS (SELECT ""username"",""activity"",""startDate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""ct"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""enddate"" FROM ""detail"" WHERE CASE WHEN ""ct""<2 THEN ""ct""=""rk"" ELSE ""rk""=2 END"
8,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""rank_recent"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""count_activity"" FROM ""UserActivity"") AS ""activity_rank"" WHERE ""rank_recent""=2 OR ""count_activity""=1"
9,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"" FROM ""UserActivity"") AS ""tmp"" WHERE ""rnk""=2 GROUP BY ""username"" UNION SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
10,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
11,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""n"" FROM ""UserActivity"") AS ""tbl"" WHERE ""n""=2 OR ""cnt""<2"
12,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""n"" FROM ""UserActivity"") AS ""tbl"" WHERE ""n""=2 OR ""cnt""<2"
13,"WITH ""tmp"" AS (SELECT ""username"",MAX(""startDate"") AS ""startDate"" FROM ""useractivity"" GROUP BY ""username""), ""tmp2"" AS (SELECT ""u1"".""username"",MAX(""u1"".""startDate"") AS ""startDate"",MAX(""u1"".""endDate"") AS ""endDate"" FROM ""useractivity"" AS ""u1"" JOIN ""tmp"" ON ""tmp"".""username""=""u1"".""username"" AND ""u1"".""startDate""<""tmp"".""startDate"" GROUP BY ""u1"".""username"" UNION (SELECT ""u2"".""username"",MAX(""u2"".""startDate"") AS ""startDate"",MAX(""u2"".""endDate"") AS ""endDate"" FROM ""useractivity"" AS ""u2"" GROUP BY ""u2"".""username"" HAVING COUNT(1)=1)) SELECT ""tmp2"".""username"",""a"".""activity"",""tmp2"".""startDate"",""tmp2"".""endDate"" FROM ""tmp2"" JOIN ""useractivity"" AS ""a"" ON ""a"".""username""=""tmp2"".""username"" AND ""a"".""startDate""=""tmp2"".""startDate"""
14,"WITH ""cte"" AS (SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1) SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""t1"".""username"",""t1"".""activity"",""t1"".""startDate"",""t1"".""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""ranking"" FROM ""UserActivity"") AS ""t1"" WHERE ""ranking""=2) AS ""a"" UNION SELECT * FROM ""cte"""
15,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rowNum"",COUNT(1) OVER (PARTITION BY ""username"") AS ""actCount"" FROM ""UserActivity"") AS ""rnked"" WHERE ""rowNum""=2 OR ""actCount""=1"
16,"WITH ""UARanking"" AS (SELECT ""UA"".*,RANK() OVER (PARTITION BY ""UA"".""username"" ORDER BY ""UA"".""startDate"" DESC) AS ""Rk"",(SELECT COUNT(1) FROM ""UserActivity"" AS ""I"" WHERE ""I"".""username""=""UA"".""username"") AS ""counter"" FROM ""UserActivity"" AS ""UA"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UARanking"" WHERE ""Rk""=CASE WHEN ""Counter""=1 THEN 1 ELSE 2 END"
17,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".* FROM ""UserActivity"" AS ""u1"" LEFT JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""endDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(""u2"".""endDate"")=1"
18,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"" FROM ""useractivity"") AS ""a"" WHERE ""rnk""=2 UNION SELECT * FROM ""useractivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
19,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk_desc"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"") AS ""rnk_asc"" FROM ""UserActivity"") AS ""t"" WHERE ""rnk_desc""=2 OR (""rnk_desc""=1 AND ""rnk_asc""=1)"
20,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""ranks"" FROM ""UserActivity""), ""cte1"" AS (SELECT ""username"",COUNT(1) AS ""counts"" FROM ""UserActivity"" GROUP BY ""username"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""cte"".""username"",""activity"",""startDate"",""endDate"",""ranks"",""counts"" FROM ""cte"" LEFT JOIN ""cte1"" ON ""cte1"".""username""=""cte"".""username"") AS ""a"" WHERE ""ranks""=2 AND ""counts"">=2 UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""cte"".""username"",""activity"",""startDate"",""endDate"",""ranks"",""counts"" FROM ""cte"" LEFT JOIN ""cte1"" ON ""cte1"".""username""=""cte"".""username"") AS ""a"" WHERE ""ranks""=1 AND ""counts""=1"
21,"WITH ""cte"" AS (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ""rk""=2 OR ""cnt""=1"
22,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""n"" FROM ""UserActivity"") AS ""temp"" WHERE ""n""=2 OR ""cnt""<2"
23,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
24,"WITH ""recent"" AS (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""ranking"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""recent"" WHERE ""ranking""=2 OR ""cnt""=1"
25,"WITH ""activities_by_recency"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""recency"" FROM ""UserActivity"" AS ""ua""), ""num_activites_by_user"" AS (SELECT ""username"",COUNT(1) AS ""num_activities"" FROM ""UserActivity"" AS ""ua"" GROUP BY ""username"" HAVING ""num_activities""=1) SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""activities_by_recency"" WHERE ""recency""=2 UNION SELECT ""n"".""username"",""ua"".""activity"",""ua"".""startDate"",""ua"".""endDate"" FROM ""num_activites_by_user"" AS ""n"" JOIN ""UserActivity"" AS ""ua"" ON ""n"".""username""=""ua"".""username"""
26,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".""username"",""u1"".""activity"",""u1"".""startDate"",""u1"".""endDate"" FROM ""UserActivity"" AS ""u1"" JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""startDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(1)=1"
27,"WITH ""activity_order"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""row_num"" FROM ""UserActivity""), ""second"" AS (SELECT * FROM ""activity_order"" WHERE ""row_num""=2) SELECT * FROM ""UserActivity"" WHERE ""username"" NOT IN (SELECT DISTINCT ""username"" FROM ""second"") UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""second"""
28,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") SELECT ""USERNAME"",""ACTIVITY"",""STARTDATE"",""ENDDATE"" FROM ""cte"" WHERE ""rnk""=2 OR ""cnt""=1 ORDER BY ""username"" DESC"
29,"SELECT ""u1"".""username"",""u1"".""activity"",""u1"".""startDate"",""u1"".""endDate"" FROM ""useractivity"" AS ""u1"" JOIN (SELECT ""username"",""startDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""useractivity"") AS ""tmp"" ON ""tmp"".""username""=""u1"".""username"" AND ""tmp"".""startDate""=""u1"".""startDate"" AND ""tmp"".""rk""=2 UNION SELECT ""u2"".""username"",""u2"".""activity"",""u2"".""startdate"",""u2"".""endDate"" FROM ""useractivity"" AS ""u2"" JOIN (SELECT ""username"",COUNT(1) AS ""cnt"" FROM ""useractivity"" GROUP BY ""username"") AS ""tmp2"" ON ""tmp2"".""username""=""u2"".""username"" AND ""tmp2"".""cnt""=1"
30,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
31,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rn"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""cte"" WHERE ""rn""=2 UNION SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""cte"" WHERE ""rn""=1 AND ""cte"".""username"" NOT IN (SELECT ""username"" FROM ""cte"" WHERE ""rn""=2)"
32,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""ranks"" FROM ""UserActivity""), ""cte1"" AS (SELECT ""username"",COUNT(1) AS ""counts"" FROM ""UserActivity"" GROUP BY ""username"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""cte"".""username"",""activity"",""startDate"",""endDate"",""ranks"",""counts"" FROM ""cte"" LEFT JOIN ""cte1"" ON ""cte1"".""username""=""cte"".""username"") AS ""a"" WHERE ""ranks""=2 AND ""counts"">=2 UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""cte"".""username"",""activity"",""startDate"",""endDate"",""ranks"",""counts"" FROM ""cte"" LEFT JOIN ""cte1"" ON ""cte1"".""username""=""cte"".""username"") AS ""a"" WHERE ""counts""=1"
33,"SELECT ""x"".""username"",""x"".""activity"",""x"".""startdate"",""x"".""enddate"" FROM (SELECT ""a"".*,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"",""b"".""rk"" AS ""rk_1"" FROM ""UserActivity"" AS ""a"" LEFT JOIN (SELECT ""username"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"" FROM ""UserActivity"") AS ""b"" ON ""b"".""username""=""a"".""username"" AND ""b"".""rk""=2) AS ""x"" WHERE ""x"".""rk""=2 OR ""x"".""rk_1"" IS NULL"
34,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
35,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity"") AS ""a"" WHERE ""cnt""<2 OR ""rk""=2"
36,"WITH ""table1"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""table1"" WHERE CASE WHEN ""cnt""<2 THEN ""rnk""=1 ELSE ""rnk""=2 END"
37,"SELECT ""u1"".""username"",""u1"".""activity"",""u1"".""startDate"",""u1"".""endDate"" FROM ""useractivity"" AS ""u1"" JOIN (SELECT ""username"",""startDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""useractivity"") AS ""tmp"" ON ""tmp"".""username""=""u1"".""username"" AND ""tmp"".""startDate""=""u1"".""startDate"" AND ""tmp"".""rk""=2 UNION SELECT ""u2"".""username"",""u2"".""activity"",""u2"".""startdate"",""u2"".""endDate"" FROM ""useractivity"" AS ""u2"" GROUP BY ""u2"".""username"" HAVING COUNT(1)=1"
38,"WITH ""second_act"" AS (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""date_rank"" FROM ""useractivity""), ""first_act"" AS (SELECT ""username"" FROM ""useractivity"" GROUP BY 1 HAVING COUNT(1)=1) SELECT ""u"".* FROM ""useractivity"" AS ""u"" JOIN (SELECT * FROM ""second_act"" WHERE ""date_rank""=2) AS ""s"" ON ""s"".""username""=""u"".""username"" AND ""s"".""startdate""=""u"".""startdate"" UNION SELECT * FROM ""useractivity"" WHERE ""username"" IN (SELECT * FROM ""first_act"")"
39,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
40,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""startDate"") AS ""cnt"" FROM ""UserActivity"" GROUP BY ""username"") AS ""Users_with_activity_counts"" WHERE ""cnt""=1 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rn"" FROM ""UserActivity"") AS ""Users_with_row_number"" WHERE ""rn""=2"
41,"WITH ""recent"" AS (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""ranking"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""recent"" WHERE ""ranking""=2 OR ""cnt""<2"
42,"WITH ""rnker"" AS (SELECT ""username"",""startDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"" FROM ""UserActivity""), ""count_act"" AS (SELECT ""username"",COUNT(1) AS ""act_count"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1) SELECT ""ua"".""username"",""ua"".""activity"",""ua"".""startDate"",""ua"".""endDate"" FROM ""UserActivity"" AS ""ua"" JOIN ""rnker"" AS ""r"" ON ""ua"".""username""=""r"".""username"" AND ""ua"".""startDate""=""r"".""startDate"" WHERE ""r"".""rnk""=2 UNION SELECT ""ua"".""username"",""ua"".""activity"",""ua"".""startDate"",""ua"".""endDate"" FROM ""UserActivity"" AS ""ua"" JOIN ""count_act"" AS ""c"" ON ""ua"".""username""=""c"".""username"""
43,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
44,"WITH ""cte"" AS (SELECT DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"",""username"",""activity"",""startDate"",""endDate"" FROM ""userActivity""), ""cte2"" AS (SELECT *,COUNT(""username"") AS ""cnt"" FROM ""useractivity"" GROUP BY ""username"") SELECT ""username"" AS ""USERNAME"",""activity"" AS ""ACTIVITY"",""startdate"" AS ""STARTDATE"",""enddate"" AS ""ENDDATE"" FROM ""cte"" WHERE ""rnk""=2 UNION ALL SELECT ""username"" AS ""USERNAME"",""activity"" AS ""ACTIVITY"",""startdate"" AS ""STARTDATE"",""enddate"" AS ""ENDDATE"" FROM ""cte2"" WHERE ""cnt""=1"
45,"WITH ""a"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"") AS ""rnk"" FROM ""UserActivity""), ""b"" AS (SELECT ""username"",CASE WHEN MAX(""rnk"")=1 THEN 2 ELSE MAX(""rnk"") END AS ""rnk"" FROM ""a"" GROUP BY ""username"") SELECT ""a"".""username"",""a"".""activity"",""a"".""startDate"",""a"".""endDate"" FROM ""a"" JOIN ""b"" ON ""a"".""rnk""=""b"".""rnk""-1 AND ""a"".""username""=""b"".""username"""
46,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
47,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".* FROM ""UserActivity"" AS ""u1"" LEFT JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""endDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(""u2"".""endDate"")=1"
48,"WITH ""win"" AS (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""rk"",MIN(""enddate"") OVER (PARTITION BY ""username"") AS ""final_date"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""win"" WHERE ""rk""=2 OR (""rk""=1 AND ""enddate""=""final_date"")"
49,"WITH ""tmp"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rn"",COUNT(1) OVER (PARTITION BY ""username"") AS ""ct"" FROM ""useractivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""tmp"" WHERE ""rn""=2 OR ""ct""=1"
50,"WITH ""tbl1"" AS (SELECT ""u"".*,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"" FROM ""UserActivity"" AS ""u"" ORDER BY 1), ""tbl2"" AS (SELECT ""tbl1"".*,MAX(""rnk"") OVER (PARTITION BY ""username"") AS ""maxrnk"" FROM ""tbl1""), ""tbl3"" AS (SELECT ""tbl2"".* FROM ""tbl2"" WHERE ""tbl2"".""rnk""=1 OR ""tbl2"".""rnk""=2) SELECT ""tbl3"".""username"",""tbl3"".""activity"",""tbl3"".""startDate"",""tbl3"".""endDate"" FROM ""tbl3"" WHERE ROW(""username"",""rnk"",""maxrnk"") IN (SELECT ""tbl3"".""username"",MAX(""tbl3"".""rnk""),MAX(""tbl3"".""maxrnk"") FROM ""tbl3"" GROUP BY ""tbl3"".""username"")"
51,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".""username"",""u1"".""activity"",""u1"".""startDate"",""u1"".""endDate"" FROM ""UserActivity"" AS ""u1"" JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""startDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(1)=1"
52,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"") AS ""activityOrderASC"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""activityOrderDesc"" FROM ""UserActivity"") AS ""temp"" WHERE ""activityOrderDesc""<=2) AS ""temp2"" WHERE ""activityOrderASC""=1"
53,"WITH ""RankedActivity"" AS (SELECT ""username"",""startDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""activityRank"" FROM ""UserActivity""), ""Results"" AS (SELECT ""username"",MIN(""startDate"") AS ""activityDate"" FROM ""RankedActivity"" WHERE ""activityRank""<=2 GROUP BY ""username"") SELECT ""UserActivity"".""username"",""UserActivity"".""activity"",""UserActivity"".""startDate"",""UserActivity"".""endDate"" FROM ""Results"" JOIN ""UserActivity"" ON ""UserActivity"".""username""=""Results"".""username"" AND ""UserActivity"".""startDate""=""Results"".""activityDate"""
54,"WITH ""a"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rn"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""cn"" FROM ""UserActivity""), ""b"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""a"" WHERE ""rn""=2) SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""b"" UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""a"" WHERE ""cn""=1"
55,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""rnk"" FROM ""useractivity"") AS ""a"" WHERE ""rnk""=2 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""useractivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
56,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"" FROM ""UserActivity""), ""cte1"" AS (SELECT ""username"",CASE WHEN COUNT(1)=1 THEN 1 ELSE 2 END AS ""rnk"" FROM ""UserActivity"" GROUP BY 1) SELECT ""cte"".""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" JOIN ""cte1"" ON ""cte"".""username""=""cte1"".""username"" AND ""cte"".""rnk""=""cte1"".""rnk"""
57,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""n"" FROM ""UserActivity"") AS ""tbl"" WHERE ""n""=2 OR ""cnt""=1"
58,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""recency"" FROM ""UserActivity""), ""inactive_users"" AS (SELECT ""username"",COUNT(""activity"") AS ""num_activities"" FROM ""UserActivity"" GROUP BY ""username"") SELECT ""c"".""username"",""c"".""activity"",""c"".""startDate"",""c"".""endDate"" FROM ""cte"" AS ""c"" LEFT JOIN ""inactive_users"" AS ""i"" ON ""i"".""username""=""c"".""username"" WHERE CASE WHEN ""i"".""num_activities""=1 THEN ""c"".""recency""=1 ELSE ""c"".""recency""=2 END"
59,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") AS ""t"" WHERE ""cnt""=1 OR ""rnk""=2"
60,"WITH ""cte"" AS (SELECT ""a"".*,RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""r"" FROM ""useractivity"" AS ""a""), ""second_highest"" AS (SELECT ""username"",MAX(""r"") AS ""max_r"" FROM ""cte"" WHERE ""r""<=2 GROUP BY ""username"") SELECT ""cte"".""username"",""cte"".""activity"",""cte"".""startDate"",""cte"".""endDate"" FROM ""cte"" JOIN ""second_highest"" AS ""s"" ON ""cte"".""username""=""s"".""username"" AND ""cte"".""r""=""s"".""max_r"""
61,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",COUNT(1) OVER (PARTITION BY ""username"") AS ""ct"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rn"" FROM ""useractivity"") AS ""A"" WHERE ""A"".""rn""=2 OR ""A"".""ct""=1"
62,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",COUNT(1) OVER (PARTITION BY ""username"") AS ""activity_cnt"",RANK() OVER (PARTITION BY ""username"" ORDER BY EXTRACT(YEAR FROM ""startdate"") DESC,EXTRACT(MONTH FROM ""startdate"") DESC,EXTRACT(DAY FROM ""startdate"") DESC) AS ""rnk"" FROM ""useractivity"") AS ""a"" WHERE (""activity_cnt""=1) OR (""activity_cnt"">1 AND ""rnk""=2)"
63,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
64,"WITH ""tmp"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"" FROM ""useractivity""), ""tmp2"" AS (SELECT ""username"",COUNT(""rnk"") AS ""cnt"" FROM ""tmp"" GROUP BY 1) SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""tmp"" WHERE ""rnk""=2 OR ""username"" IN (SELECT ""username"" FROM ""tmp2"" WHERE ""cnt""=1)"
65,"WITH ""prep"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""rn"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""TotalActivityPerUser"" FROM ""useractivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""prep"" WHERE CASE WHEN ""totalactivityperuser"">1 THEN ""rn""=2 ELSE ""rn""=1 END"
66,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity""), ""cte2"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ""rk""=2) SELECT * FROM ""cte2"" UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ""rk""=1 AND ""username"" NOT IN (SELECT ""username"" FROM ""cte2"")"
67,"WITH ""secondmostrecent"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rank"" FROM ""UserActivity"") AS ""temp"" WHERE ""temp"".""rank""=2) SELECT * FROM ""secondmostrecent"" UNION SELECT * FROM ""UserActivity"" WHERE ""username"" NOT IN (SELECT ""username"" FROM ""secondmostrecent"")"
68,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""useractivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""cte"" WHERE ""rk""=2 OR ""cnt""=1"
69,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rowNum"",COUNT(1) OVER (PARTITION BY ""username"") AS ""actCount"" FROM ""UserActivity"") AS ""rnked"" WHERE ""rowNum""=2 OR ""actCount""=1"
70,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ""rk""=2 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ""cnt""=1"
71,"WITH ""recent"" AS (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""ranking"" FROM ""UserActivity""), ""final"" AS (SELECT ""username"",MIN(""startDate"") AS ""startDate"",MIN(""endDate"") AS ""endDate"" FROM ""recent"" WHERE ""ranking""<=2 GROUP BY ""username"") SELECT * FROM ""final"" JOIN ""UserActivity"" USING (""username"",""startDate"",""endDate"")"
72,"WITH ""temp"" AS (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rank_num"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" WHERE ""username"" IN (SELECT ""username"" FROM ""temp"" GROUP BY ""username"" HAVING MAX(""rank_num"")=1) UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""temp"" WHERE ""rank_num""=2"
73,"WITH ""recent"" AS (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""ranking"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""recent"" WHERE ""ranking""=2 OR ""cnt""<2"
74,"SELECT * FROM ""UserActivity"" WHERE ROW(""username"",""startDate"") IN (SELECT ""username"",MIN(""startDate"") AS ""startDate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""nrow"" FROM ""UserActivity"") AS ""sub"" WHERE ""nrow""<=2 GROUP BY ""username"")"
75,"WITH ""cte_2"" AS (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte_2"" WHERE ""rk""=2 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte_2"" WHERE ""rk""=1 AND ""username"" NOT IN (SELECT ""username"" FROM ""cte_2"" GROUP BY 1 HAVING COUNT(""rk"")>1)"
76,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""ranked"" FROM ""UserActivity"") AS ""temp"" WHERE ""ranked""=2 UNION SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
77,"WITH ""cte"" AS (SELECT DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"",""username"",""activity"",""startDate"",""endDate"" FROM ""userActivity""), ""cte2"" AS (SELECT *,COUNT(""username"") AS ""cnt"" FROM ""useractivity"" GROUP BY ""username"") SELECT ""username"" AS ""USERNAME"",""activity"" AS ""ACTIVITY"",""startdate"" AS ""STARTDATE"",""enddate"" AS ""ENDDATE"" FROM ""cte"" WHERE ""rnk""=2 UNION ALL SELECT ""username"" AS ""USERNAME"",""activity"" AS ""ACTIVITY"",""startdate"" AS ""STARTDATE"",""enddate"" AS ""ENDDATE"" FROM ""cte2"" WHERE ""cnt""=1"
78,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ""rnk""=2 OR ""cnt""=1"
79,"WITH ""t"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"" FROM ""UserActivity"") AS ""t"" WHERE ""rnk""=2) SELECT ""username"",""activity"",MIN(""startDate"") AS ""startDate"",MIN(""endDate"") AS ""endDate"" FROM ""UserActivity"" WHERE ""username"" NOT IN (SELECT ""username"" FROM ""t"") GROUP BY ""username"",""activity"" HAVING COUNT(""startDate"")=1 UNION ALL SELECT * FROM ""t"""
80,"WITH ""cte"" AS (SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1) SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""t1"".""username"",""t1"".""activity"",""t1"".""startDate"",""t1"".""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""ranking"" FROM ""UserActivity"") AS ""t1"" WHERE ""ranking""=2) AS ""a"" UNION SELECT * FROM ""cte"""
81,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranks"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""counts"" FROM ""UserActivity"") AS ""t"" WHERE ""counts""=1 OR ""ranks""=2"
82,"WITH ""recent"" AS (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""ranking"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""recent"" WHERE ""ranking""=2 OR ""cnt""<2"
83,"WITH ""temp"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranking"" FROM ""UserActivity""), ""temp1"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""temp"" WHERE ""ranking""=2) SELECT * FROM ""temp1"" UNION SELECT * FROM ""UserActivity"" WHERE ""username"" NOT IN (SELECT ""username"" FROM ""temp1"")"
84,"SELECT ""a"".""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""rnk"" FROM ""UserActivity"") AS ""a"" JOIN (SELECT ""username"",COUNT(1) AS ""cnt"" FROM ""UserActivity"" GROUP BY ""username"") AS ""b"" ON ""a"".""username""=""b"".""username"" WHERE (""cnt"">1 AND ""rnk""=2) OR (""cnt""=1 AND ""rnk""=1)"
85,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") AS ""t"" WHERE ""cnt""=1 OR (""cnt"">1 AND ""rnk""=2)"
86,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rank_Num"" FROM ""useractivity"") AS ""cte"" WHERE ""rank_num""=2 UNION ALL SELECT * FROM ""useractivity"" WHERE ""username"" IN (SELECT ""username"" FROM ""useractivity"" GROUP BY 1 HAVING COUNT(""username"")=1)"
87,"SELECT ""username"" AS ""USERNAME"",""activity"" AS ""ACTIVITY"",""startDate"" AS ""STARTDATE"",""endDate"" AS ""ENDDATE"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""recent_rank"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") AS ""ranked"" WHERE ""recent_rank""=2 OR ""cnt""<2"
88,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranks"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""counts"" FROM ""UserActivity"") AS ""t"" WHERE ""counts""=1 OR ""ranks""=2"
89,"WITH ""cte"" AS (SELECT * FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity"") AS ""tb1"" WHERE ""rk""<=2) SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ROW(""username"",""rk"") IN (SELECT ""username"",MAX(""rk"") FROM ""cte"" GROUP BY 1)"
90,"WITH ""CTE_1"" AS (SELECT ""USERNAME"",COUNT(1) AS ""USER_COUNT"" FROM ""USERACTIVITY"" GROUP BY ""USERNAME""), ""CTE_2"" AS (SELECT ""U"".""USERNAME"",MAX(""U"".""STARTDATE"") AS ""SEC_MOST_REC_DATE"" FROM (""USERACTIVITY"" AS ""U"") JOIN ""CTE_1"" AS ""C"" WHERE ""U"".""USERNAME""=""C"".""USERNAME"" AND ""C"".""USER_COUNT"">1 AND ""U"".""STARTDATE""<(SELECT MAX(""STARTDATE"") FROM ""USERACTIVITY"" AS ""UU"" WHERE ""UU"".""USERNAME""=""U"".""USERNAME"") GROUP BY ""U"".""USERNAME"") SELECT ""U"".* FROM (""USERACTIVITY"" AS ""U"") JOIN ""CTE_2"" AS ""C2"" WHERE ""U"".""USERNAME""=""C2"".""USERNAME"" AND ""U"".""STARTDATE""=""C2"".""SEC_MOST_REC_DATE"" UNION SELECT ""U"".* FROM (""USERACTIVITY"" AS ""U"") JOIN ""CTE_1"" AS ""C1"" WHERE ""U"".""USERNAME""=""C1"".""USERNAME"" AND ""C1"".""USER_COUNT""=1"
91,"WITH ""x"" AS (SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""seq"" FROM ""UserActivity"") AS ""p"" WHERE ""seq""=2 UNION ALL SELECT * FROM ""useractivity"" WHERE ""username"" IN (SELECT ""username"" FROM (SELECT ""username"",COUNT(1) FROM ""UserActivity"" GROUP BY 1 HAVING COUNT(DISTINCT ""activity"")=1) AS ""q"")) SELECT DISTINCT * FROM ""x"""
92,"SELECT * FROM ""UserActivity"" GROUP BY 1 HAVING COUNT(1)=1 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity"") AS ""a"" WHERE ""rk""=2"
93,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""rnk"" FROM ""UserActivity""), ""cte1"" AS (SELECT ""username"" FROM ""UserActivity"" GROUP BY 1 HAVING COUNT(1)=1) SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ""rnk""=2 UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" WHERE ""username"" IN (SELECT * FROM ""cte1"")"
94,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rn"" FROM ""UserActivity"") AS ""sub"" WHERE ""rn""=(SELECT CASE WHEN COUNT(1)>1 THEN 2 ELSE 1 END FROM ""UserActivity"" AS ""u"" WHERE ""u"".""username""=""sub"".""username"")"
95,"WITH ""ranked"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rg"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""ranked"" WHERE (""cnt"">1 AND ""rg""=2) OR ""cnt""=1"
96,"WITH ""Cte"" AS (SELECT ""UserActivity"".*,COUNT(""username"") OVER (PARTITION BY ""username"") AS ""CountUserActivity"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""RankUserActivity"" FROM ""UserActivity"") SELECT ""Cte"".""username"" AS ""USERNAME"",""Cte"".""activity"" AS ""ACTIVITY"",""Cte"".""startDate"" AS ""STARTDATE"",""Cte"".""endDate"" AS ""ENDDATE"" FROM ""Cte"" WHERE ""CountUserActivity""=1 UNION SELECT ""Cte"".""username"" AS ""USERNAME"",""Cte"".""activity"" AS ""ACTIVITY"",""Cte"".""startDate"" AS ""STARTDATE"",""Cte"".""endDate"" AS ""ENDDATE"" FROM ""Cte"" WHERE ""CountUserActivity"">1 AND ""RankUserActivity""=2"
97,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""ranks"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""useractivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""cte"" WHERE ""cnt""=1 OR ""ranks""=2"
98,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".* FROM ""UserActivity"" AS ""u1"" LEFT JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""endDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(""u2"".""endDate"")=1"
99,"WITH ""detail"" AS (SELECT ""username"",""activity"",""startDate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""ct"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""enddate"" FROM ""detail"" WHERE CASE WHEN ""ct""<2 THEN ""ct""=""rk"" ELSE ""rk""=2 END"
100,"WITH ""t1"" AS (SELECT * FROM ""useractivity"" GROUP BY ""username"" HAVING COUNT(1)=1), ""t2"" AS (SELECT ""useractivity"".*,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"" FROM ""useractivity"") SELECT ""t1"".* FROM ""t1"" UNION ALL SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""t2"" WHERE ""rnk""=2"
101,"SELECT * FROM ""userActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".* FROM ""userActivity"" AS ""u1"" JOIN ""userActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""endDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(""u2"".""endDate"")=1"
102,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
103,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"" FROM ""UserActivity"") AS ""T"" WHERE ""rnk""=2 UNION SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(""activity"")=1"
104,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,MAX(""rk"") OVER (PARTITION BY ""username"") AS ""max_rk"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""useractivity"") AS ""t"") AS ""temp"" WHERE ""rk""=2 OR (""rk""=1 AND ""max_rk""=1)"
105,"WITH ""total_activities"" AS (SELECT ""username"",COUNT(1) AS ""cnt"" FROM ""UserActivity"" GROUP BY ""username""), ""figure_max_end_date"" AS (SELECT *,MAX(""endDate"") OVER (PARTITION BY ""username"") AS ""max_end_date"" FROM ""UserActivity""), ""figure_Second_most_recent_prep"" AS (SELECT *,MAX(""endDate"") OVER (PARTITION BY ""username"") AS ""second_max_end_date"" FROM ""figure_max_end_date"" WHERE ""endDate""!=""max_end_date""), ""figure_Second_most_recent"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""figure_Second_most_recent_prep"" WHERE ""endDate""=""second_max_end_date"") SELECT ""U"".* FROM ""UserActivity"" AS ""U"" JOIN ""total_activities"" AS ""T"" ON ""U"".""username""=""T"".""username"" WHERE ""T"".""cnt""=1 UNION ALL SELECT * FROM ""figure_Second_most_recent"""
106,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rn"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""useractivity"" AS ""ua"") AS ""f1"" WHERE CASE WHEN ""cnt""=1 THEN ""rn""=1 ELSE ""rn""=2 END"
107,"WITH ""S0"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(""activity"")=1), ""S1"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" WHERE ""username"" NOT IN (SELECT DISTINCT (""username"") FROM ""S0"")), ""S2"" AS (SELECT DISTINCT ""username"",NTH_VALUE(""startDate"", 2) OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""startDate"" FROM ""S1"") SELECT ""S2"".""username"",""activity"",""S2"".""startDate"",""endDate"" FROM ""S2"" JOIN ""UserActivity"" ON ""S2"".""username""=""UserActivity"".""username"" AND ""s2"".""startDate""=""UserActivity"".""startDate"" UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""S0"""
108,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
109,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""ranked"" FROM ""UserActivity"") AS ""temp"" WHERE ""ranked""=2 UNION SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
110,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(""username"")=1 UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranking"" FROM ""UserActivity"") AS ""a"" WHERE ""ranking""=2"
111,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""n"" FROM ""UserActivity"") AS ""tbl"" WHERE ""n""=2 OR ""cnt""<2"
112,"SELECT * FROM ""UserActivity"" WHERE ROW(""username"",""endDate"") IN (SELECT ""username"",MAX(""endDate"") AS ""endDate"" FROM ""UserActivity"" WHERE ROW(""username"",""endDate"") NOT IN (SELECT ""username"",MAX(""endDate"") AS ""endDate"" FROM ""UserActivity"" GROUP BY ""username"") GROUP BY ""username"") OR ""username"" IN (SELECT ""username"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1)"
113,"SELECT ""username"" AS ""USERNAME"",""activity"" AS ""ACTIVITY"",""startDate"" AS ""STARTDATE"",""endDate"" AS ""ENDDATE"" FROM (SELECT *,MAX(""rn"") OVER (PARTITION BY ""username"") AS ""max_rn"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rn"" FROM ""userActivity"") AS ""a"" WHERE ""rn""<=2) AS ""b"" WHERE ""rn""=""max_rn"""
114,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",""startDate"",""endDate"" FROM ""UserActivity"") AS ""t"" WHERE ""rnk""=2 UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" WHERE ""username"" IN (SELECT ""username"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1)"
115,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startdate"",""enddate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""count"" FROM ""useractivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""cte"" WHERE ""rk""=CASE WHEN ""count""=1 THEN 1 ELSE 2 END"
116,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
117,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""u1"".*,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"") AS ""act_rank"",""user_ct"" FROM ""UserActivity"" AS ""u1"" JOIN (SELECT ""username"",COUNT(1) AS ""user_ct"" FROM ""UserActivity"" GROUP BY ""username"") AS ""u2"" ON ""u1"".""username""=""u2"".""username"") AS ""t"" WHERE ""act_rank""=(""user_ct""-1) OR ""user_ct""=1"
118,"SELECT ""username"",""activity"",""startDate"",""EndDate"" FROM (SELECT ""username"",""activity"",""startDate"",""EndDate"",""activity_rank"",MAX(""activity_rank"") OVER (PARTITION BY ""username"") AS ""latest_rank"" FROM (SELECT ""username"",""activity"",""startDate"",""EndDate"",""activity_rank"" FROM (SELECT ""username"",""activity"",""startDate"",""EndDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""activity_rank"" FROM ""UserActivity"") AS ""sub"" WHERE ""activity_rank""<=2) AS ""sub2"") AS ""sub3"" WHERE ""activity_rank""=""latest_rank"""
119,"WITH ""filter_table"" AS (SELECT * FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""activity_rank"" FROM ""UserActivity"") AS ""a"" WHERE ""activity_rank""<=2) SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""filter_table"" WHERE ROW(""username"",""activity_rank"") IN (SELECT ""username"",MAX(""activity_rank"") FROM ""filter_table"" GROUP BY ""username"")"
120,"WITH ""one_activity"" AS (SELECT ""username"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1), ""Ranked"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""recency"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""Ranked"" WHERE ""recency""=2 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""Ranked"" WHERE ""username"" IN (SELECT ""username"" FROM ""one_activity"")"
121,"WITH ""t"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""r"",COUNT(1) OVER (PARTITION BY ""username"") AS ""c"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""t"" WHERE ""c""=1 OR ""r""=2"
122,"(SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""myrank"" FROM ""useractivity"") AS ""cte"" WHERE ""myrank""=2) UNION (SELECT * FROM ""UserActivity"" GROUP BY 1 HAVING COUNT(""username"")=1)"
123,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".* FROM ""UserActivity"" AS ""u1"" LEFT JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""endDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(""u2"".""endDate"")=1"
124,"SELECT ""Username"",""activity"",""startDate"",""endDate"" FROM (SELECT (SELECT COUNT(DISTINCT ""a"".""startdate"")+1 FROM ""UserActivity"" AS ""a"" WHERE ""a"".""username""=""b"".""username"" AND ""a"".""startdate"">""b"".""startdate"") AS ""rno"",(SELECT COUNT(DISTINCT ""c"".""activity"", ""c"".""startDate"", ""c"".""endDate"") FROM ""UserActivity"" AS ""c"" WHERE ""b"".""username""=""c"".""username"") AS ""useractivitycount"",""Username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" AS ""b"") AS ""t"" WHERE (""rno""=2 AND ""useractivitycount"">=2) OR (""rno""=1 AND ""useractivitycount""=1)"
125,"WITH ""firstTable"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranking"" FROM ""UserActivity""), ""secondTable"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""firstTable"" WHERE ""ranking""=2), ""thirdTable"" AS (SELECT ""UserActivity"".""username"",""UserActivity"".""activity"",""UserActivity"".""startDate"",""UserActivity"".""endDate"" FROM ""UserActivity"" LEFT JOIN ""secondTable"" ON ""UserActivity"".""username""=""secondTable"".""username"" WHERE ""secondTable"".""username"" IS NULL) SELECT * FROM ""secondTable"" UNION SELECT * FROM ""thirdTable"""
126,"WITH ""ActivityRanking"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""Rk"",(SELECT COUNT(1) FROM ""UserActivity"" AS ""I"" WHERE ""I"".""username""=""O"".""username"") AS ""Counter"" FROM ""UserActivity"" AS ""O"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""ActivityRanking"" WHERE ""Rk""=CASE WHEN ""Counter"">1 THEN 2 ELSE 1 END"
127,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"" FROM ""useractivity""), ""cte1"" AS (SELECT ""username"",""activity"",""startdate"",""enddate"",COUNT(1) AS ""cnt"" FROM ""cte"" GROUP BY ""username"") SELECT ""cte"".""username"",""cte"".""activity"",""cte"".""startdate"",""cte"".""enddate"" FROM ""cte"" LEFT JOIN ""cte1"" ON ""cte"".""username""=""cte1"".""username"" WHERE ""cte"".""rk""=2 OR ""cte1"".""cnt""=1"
128,"WITH ""temp"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rankno"" FROM ""UserActivity""), ""temp2"" AS (SELECT *,MAX(""temp"".""rankno"") OVER (PARTITION BY ""temp"".""username"") AS ""maxrankno2"" FROM ""temp"" WHERE ""rankno""<=2) SELECT ""temp2"".""username"",""temp2"".""activity"",""temp2"".""startDate"",""temp2"".""endDate"" FROM ""temp2"" WHERE ""temp2"".""rankno""=""maxrankno2"""
129,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""username"") OVER (PARTITION BY ""username"") AS ""cnt"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""ranked"" FROM ""UserActivity"") AS ""temp"" WHERE ""ranked""=2 OR ""cnt""=1"
130,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""activity_rank"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""counts"" FROM ""UserActivity"") AS ""activity_tmp"" WHERE ""activity_rank""=2 OR ""counts""=1"
131,"SELECT DISTINCT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""dk"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") AS ""sub"" WHERE ""dk""=2 OR ""cnt""=1"
132,"WITH ""cte_latest_activities"" AS (SELECT ""username"",""activity"",MAX(""startDate"") AS ""last_activity_startDate"",MAX(""endDate"") AS ""last_activity_endDate"" FROM ""UserActivity"" GROUP BY 1,2), ""cte_window"" AS (SELECT ""username"",""activity"",""last_activity_startDate"",""last_activity_endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""last_activity_startDate"" DESC) AS ""activity_order"",COUNT(1) OVER (PARTITION BY ""username"") AS ""num_activities"" FROM ""cte_latest_activities""), ""cte_final"" AS (SELECT ""username"",""activity"",""last_activity_startDate"" AS ""startDate"",""last_activity_endDate"" AS ""endDate"" FROM ""cte_window"" WHERE CASE WHEN ""num_activities"">1 THEN ""activity_order""=2 WHEN ""num_activities""=1 THEN ""activity_order""=1 END) SELECT * FROM ""cte_final"""
133,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""r"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""c"" FROM ""useractivity"") AS ""lookup"" WHERE ""r""=2 OR ""c""=1"
134,"WITH ""TEMP"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""TEMP"" WHERE ""rnk""=2 OR ""cnt""=1"
135,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"",COUNT(""startdate"") OVER (PARTITION BY ""username"") AS ""num_a"" FROM ""useractivity"") AS ""temp"" WHERE ""rk""=2 OR (""rk""=1 AND ""num_a""=1)"
136,"SELECT ""a"".""username"",""a"".""activity"",""a"".""startDate"",""a"".""endDate"" FROM ""UserActivity"" AS ""a"" JOIN (SELECT ""a"".""username"",COALESCE(MAX(""b"".""startDate""), ""a"".""startDate"") AS ""startDate"",COALESCE(MAX(""b"".""endDate""), ""a"".""endDate"") AS ""endDate"" FROM ""UserActivity"" AS ""a"" LEFT JOIN ""UserActivity"" AS ""b"" ON ""a"".""username""=""b"".""username"" AND ""a"".""startDate"">""b"".""startDate"" GROUP BY 1) AS ""b"" ON ""a"".""username""=""b"".""username"" AND ""a"".""startDate""=""b"".""startDate"""
137,"WITH ""labeled"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""num"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""labeled"" WHERE ""num""=2 UNION SELECT * FROM ""useractivity"" WHERE ""username"" IN (SELECT ""username"" FROM ""useractivity"" GROUP BY ""username"" HAVING COUNT(""activity"")=1)"
138,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""date_rank"" FROM ""UserActivity"") AS ""sub"" WHERE ""date_rank""=2 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" WHERE ""username"" IN (SELECT ""username"" FROM ""UserActivity"" GROUP BY 1 HAVING COUNT(1)=1)"
139,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION SELECT ""u1"".* FROM ""UserActivity"" AS ""u1"" LEFT JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""endDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(""u2"".""endDate"")=1"
140,"WITH ""abc"" AS (SELECT * FROM ""UserActivity"" AS ""t"" JOIN (SELECT ""t"".""username"",MAX(""t"".""startDate"") AS ""startDate"" FROM ""UserActivity"" AS ""t"" JOIN (SELECT ""username"",MAX(""startDate"") AS ""startDate"" FROM ""UserActivity"" GROUP BY ""username"") AS ""u"" ON ""u"".""username""=""t"".""username"" AND ""u"".""startDate""!=""t"".""startDate"" GROUP BY ""t"".""username"") AS ""u"" USING (""username"",""startDate"")) SELECT * FROM ""abc"" UNION SELECT ""u"".""username"",""u"".""activity"",""u"".""startDate"",""u"".""endDate"" FROM ""UserActivity"" AS ""u"" LEFT JOIN ""abc"" AS ""a"" ON ""a"".""username""=""u"".""username"" WHERE ""a"".""username"" IS NULL"
141,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranking_desc"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"") AS ""ranking_asc"" FROM ""UserActivity"") AS ""sub"" WHERE ""ranking_desc""=2 OR (""ranking_desc""=""ranking_asc"" AND ""ranking_asc""=1) ORDER BY ""username"""
142,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""r"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""c"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",CASE WHEN ""c""=1 AND ""r""=1 THEN 1 WHEN ""c"">=2 AND ""r""=2 THEN 1 ELSE 0 END AS ""test"" FROM ""cte"") AS ""a"" WHERE ""a"".""test""=1"
143,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""n"" FROM ""UserActivity"") AS ""tbl"" WHERE ""n""=2 OR ""cnt""<2"
144,"SELECT ""username"",""activity"",""startDate"",""enddate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""rk"" FROM ""useractivity"") AS ""a"" WHERE ""rk""=2 OR ""username"" IN (SELECT ""username"" FROM ""useractivity"" GROUP BY ""username"" HAVING COUNT(1)=1)"
145,"WITH ""tb1"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""ct"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""rn"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""tb1"" WHERE (""ct"">1 AND ""rn""=2) OR (""ct""=1)"
146,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",""rnk"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"" FROM ""UserActivity"") AS ""t1"" WHERE ""t1"".""rnk""<=2) SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ROW(""username"",""rnk"") IN (SELECT ""username"",MAX(""rnk"") FROM ""cte"" GROUP BY ""username"")"
147,"(SELECT ""sub"".""username"",""sub"".""activity"",""sub"".""startDate"",""sub"".""endDate"" FROM (SELECT ""a"".*,RANK() OVER (PARTITION BY ""a"".""username"" ORDER BY ""a"".""startDate"" DESC) AS ""rank_date"" FROM ""UserActivity"" AS ""a"") AS ""sub"" WHERE ""sub"".""rank_date""=2) UNION ALL (SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(""username"")=1)"
148,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",CASE WHEN ""rnk""=MAX(""rnk"") OVER (PARTITION BY ""username"") THEN TRUE ELSE FALSE END AS ""chk"" FROM (SELECT ""username"",""activity"",""startdate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"",""enddate"" FROM ""useractivity"") AS ""t"" WHERE ""rnk""<=2) AS ""final"" WHERE ""chk""=1"
149,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rowNum"" FROM ""UserActivity"") AS ""a"" WHERE ""rowNum""=2 UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(""username"")=1"
150,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""n"" FROM ""UserActivity"") AS ""tbl"" WHERE ""n""=2 OR ""cnt""<2"
151,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""date_rk"" FROM ""useractivity"") AS ""t1"" WHERE ""date_rk""=2 OR ""username"" IN (SELECT ""username"" FROM ""useractivity"" GROUP BY 1 HAVING COUNT(1)=1)"
152,"WITH ""t1"" AS (SELECT ""useractivity"".*,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"" FROM ""useractivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""t1"" WHERE ""rnk""=2 UNION ALL SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""useractivity"" GROUP BY 1 HAVING COUNT(1)=1"
153,"WITH ""a"" AS (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""rank"" FROM ""useractivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""a"" WHERE ""a"".""rank""=2 UNION SELECT * FROM ""useractivity"" WHERE ""username"" NOT IN (SELECT ""username"" FROM ""a"" WHERE ""a"".""rank""=2)"
154,"SELECT DISTINCT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""u"".*,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""num"" FROM ""UserActivity"" AS ""u"") AS ""t"" WHERE (""num""!=1 AND ""rnk""=2) OR (""num""=1 AND ""rnk""=1)"
155,"WITH ""cte"" AS (SELECT ""u"".*,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""idx"" FROM ""userActivity"" AS ""u""), ""cte2"" AS (SELECT ""c"".*,MAX(""c"".""idx"") OVER (PARTITION BY ""c"".""username"") AS ""midx"" FROM ""cte"" AS ""c"") SELECT ""c"".""username"",""c"".""activity"",""c"".""startDate"",""c"".""endDate"" FROM ""cte2"" AS ""c"" WHERE (""c"".""idx""=2 AND ""c"".""midx"">=2) OR (""c"".""idx""=1 AND ""c"".""midx""<2)"
156,"WITH ""U1"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rn1"" FROM ""UserActivity""), ""U2"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"") AS ""rn2"" FROM ""U1"" WHERE ""rn1""<=2) SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""U2"" WHERE ""rn2""=1"
157,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT * FROM ""cte"" JOIN (SELECT ""username"",MAX(""rnk"") AS ""max_rnk"" FROM ""cte"" GROUP BY 1) AS ""y"" USING (""username"")) AS ""t"" WHERE ""rnk""=(CASE WHEN ""max_rnk""=1 THEN 1 ELSE 2 END)"
158,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""total"" FROM ""UserActivity"") AS ""a"" WHERE ""rnk""=(CASE WHEN ""total""=1 THEN 1 ELSE 2 END)"
159,"SELECT ""a"".""username"",""a"".""activity"",""a"".""startDate"",""a"".""endDate"" FROM ""UserActivity"" AS ""a"" JOIN ""UserActivity"" AS ""b"" ON ""a"".""username""=""b"".""username"" WHERE ""a"".""startDate""<""b"".""startDate"" GROUP BY ""a"".""username"",""a"".""activity"",""a"".""startDate"",""a"".""endDate"" HAVING COUNT(""b"".""activity"")=1 UNION SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
160,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".* FROM ""UserActivity"" AS ""u1"" LEFT JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""endDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(""u2"".""endDate"")=1"
161,"WITH ""agg"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity"") SELECT ""a"".""username"",""b"".""activity"",""b"".""startDate"",""b"".""endDate"" FROM (SELECT ""username"",MAX(""rk"") AS ""selected_rk"" FROM ""agg"" WHERE ""rk""<=2 GROUP BY ""username"") AS ""a"" LEFT JOIN (SELECT ""username"",""activity"",""startDate"",""endDate"",""rk"" FROM ""agg"") AS ""b"" ON ""a"".""username""=""b"".""username"" AND ""a"".""selected_rk""=""b"".""rk"""
162,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rn"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""useractivity"" AS ""ua"") AS ""f1"" WHERE CASE WHEN ""cnt""=1 THEN ""rn""=1 ELSE ""rn""=2 END"
163,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""actrank"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""actcnt"" FROM ""UserActivity"") AS ""a"" WHERE ""actrank""=2 OR ""actcnt""=1"
164,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranks"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""counts"" FROM ""UserActivity"") AS ""t"" WHERE ""counts""=1 OR ""ranks""=2"
165,"WITH ""a"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""activity_rank"" FROM ""useractivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""a"" WHERE ""activity_rank""=2 OR ""username"" IN (SELECT ""username"" FROM ""useractivity"" GROUP BY ""username"" HAVING COUNT(DISTINCT ""activity"")=1)"
166,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""date_rank"" FROM ""UserActivity"") AS ""tb1"" WHERE ""date_rank""=2 UNION ALL SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
167,"WITH ""rnk"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""rk"" FROM ""UserActivity""), ""cnt"" AS (SELECT ""username"",COUNT(""username"") AS ""num"" FROM ""UserActivity"" GROUP BY ""username"") SELECT ""rnk"".""username"",""activity"",""startDate"",""endDate"" FROM ""rnk"" JOIN ""cnt"" AS ""c"" ON ""c"".""username""=""rnk"".""username"" WHERE (""num""=1 AND ""rk""=1) OR (""num"">1 AND ""rk""=2)"
168,"WITH ""a"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity""), ""b"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""a"" WHERE ""rk""=2) SELECT * FROM ""b"" UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""a"" WHERE ""username"" NOT IN (SELECT ""username"" FROM ""b"")"
169,"WITH ""table1"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""table1"" WHERE (""cnt""=1 AND ""rnk""=1) OR (""cnt"">1 AND ""rnk""=2)"
170,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"") AS ""asc_rank"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""desc_rank"" FROM ""UserActivity"") AS ""UA"" WHERE ""UA"".""desc_rank""=2 OR ""UA"".""asc_rank""+""UA"".""desc_rank""=2"
171,"WITH ""t"" AS (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranking"" FROM ""UserActivity"") SELECT ""t"".""username"",""t"".""activity"",""t"".""startDate"",""t"".""endDate"" FROM ""t"" WHERE ""t"".""ranking""=2 UNION SELECT ""t"".""username"",""t"".""activity"",""t"".""startDate"",""t"".""endDate"" FROM ""t"" WHERE ""t"".""ranking""=1 AND ""t"".""username"" NOT IN (SELECT ""t"".""username"" FROM ""t"" GROUP BY 1 HAVING COUNT(""ranking"")>1)"
172,"WITH ""firstTable"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranking"" FROM ""UserActivity""), ""secondTable"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""firstTable"" WHERE ""ranking""=2), ""thirdTable"" AS (SELECT ""UserActivity"".""username"",""UserActivity"".""activity"",""UserActivity"".""startDate"",""UserActivity"".""endDate"" FROM ""UserActivity"" LEFT JOIN ""secondTable"" ON ""UserActivity"".""username""=""secondTable"".""username"" WHERE ""secondTable"".""username"" IS NULL) SELECT * FROM ""secondTable"" UNION SELECT * FROM ""thirdTable"""
173,"WITH ""tem1"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""recent_rk"" FROM ""useractivity""), ""tem2"" AS (SELECT ""username"",COUNT(""activity"") AS ""cnt_act"" FROM ""useractivity"" GROUP BY ""username"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""a"".*,""b"".""cnt_act"" FROM ""tem1"" AS ""a"" JOIN ""tem2"" AS ""b"" ON ""a"".""username""=""b"".""username"") AS ""c"" WHERE ""cnt_act"">=2 AND ""recent_rk""=2 OR ""cnt_act""=1"
174,"WITH ""total_activities"" AS (SELECT ""username"",COUNT(1) AS ""cnt"" FROM ""UserActivity"" GROUP BY ""username""), ""figure_max_end_date"" AS (SELECT *,MAX(""endDate"") OVER (PARTITION BY ""username"") AS ""max_end_date"" FROM ""UserActivity""), ""figure_Second_most_recent_prep"" AS (SELECT *,MAX(""endDate"") OVER (PARTITION BY ""username"") AS ""second_max_end_date"" FROM ""figure_max_end_date"" WHERE ""endDate""!=""max_end_date""), ""figure_Second_most_recent"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""figure_Second_most_recent_prep"" WHERE ""endDate""=""second_max_end_date"") SELECT ""U"".* FROM ""UserActivity"" AS ""U"" JOIN ""total_activities"" AS ""T"" ON ""U"".""username""=""T"".""username"" WHERE ""T"".""cnt""=1 UNION ALL SELECT * FROM ""figure_Second_most_recent"""
175,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""ranked"" FROM ""UserActivity"") AS ""temp"" WHERE ""ranked""=2 UNION SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
176,"WITH ""CTE_1"" AS (SELECT ""USERNAME"",COUNT(1) AS ""USER_COUNT"" FROM ""USERACTIVITY"" GROUP BY ""USERNAME""), ""CTE_2"" AS (SELECT ""U"".""USERNAME"",MAX(""U"".""STARTDATE"") AS ""SEC_MOST_REC_DATE"" FROM (""USERACTIVITY"" AS ""U"") JOIN ""CTE_1"" AS ""C"" WHERE ""U"".""USERNAME""=""C"".""USERNAME"" AND ""C"".""USER_COUNT"">1 AND ""U"".""STARTDATE""<(SELECT MAX(""STARTDATE"") FROM ""USERACTIVITY"" AS ""UU"" WHERE ""UU"".""USERNAME""=""U"".""USERNAME"") GROUP BY ""U"".""USERNAME"") SELECT ""U"".* FROM (""USERACTIVITY"" AS ""U"") JOIN ""CTE_2"" AS ""C2"" WHERE ""U"".""USERNAME""=""C2"".""USERNAME"" AND ""U"".""STARTDATE""=""C2"".""SEC_MOST_REC_DATE"" UNION SELECT ""U"".* FROM (""USERACTIVITY"" AS ""U"") JOIN ""CTE_1"" AS ""C1"" WHERE ""U"".""USERNAME""=""C1"".""USERNAME"" AND ""C1"".""USER_COUNT""=1"
177,"SELECT * FROM ""useractivity"" WHERE ""username"" IN (SELECT ""username"" FROM ""useractivity"" GROUP BY 1 HAVING COUNT(1)=1) UNION SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"" FROM ""useractivity"") AS ""a"" WHERE ""rnk""=2"
178,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rownum"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""UserActivity"") AS ""temp"" WHERE CASE WHEN ""cnt""=1 THEN ""rownum""=1 ELSE ""rownum""=2 END"
179,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""ranked"" FROM ""UserActivity"") AS ""temp"" WHERE ""ranked""=2 UNION SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
180,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""tot"" FROM ""UserActivity"") AS ""sub"" WHERE (""tot"">1 AND ""rk""=2) OR ""tot""=1"
181,"WITH ""cte"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rk"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE ""rk""=CASE WHEN ""cnt"">=2 THEN 2 WHEN ""cnt""<2 THEN 1 END"
182,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rowNum"",COUNT(1) OVER (PARTITION BY ""username"") AS ""actCount"" FROM ""UserActivity"") AS ""rnked"" WHERE (""actCount"">1 AND ""rowNum""=2) OR (""actCount""=1 AND ""rowNum""=1)"
183,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC,""startDate"" DESC) AS ""r_num"",SUM(1) OVER (PARTITION BY ""username"") AS ""s_num"" FROM ""useractivity"") AS ""t"" WHERE (""s_num"">1 AND ""r_num""=2) OR ""s_num""=1"
184,"WITH ""cte1"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rn"" FROM ""useractivity""), ""cte2"" AS (SELECT ""username"",COUNT(""activity"") AS ""activities_count"" FROM ""useractivity"" GROUP BY ""username"") SELECT ""a"".""username"",""a"".""activity"",""a"".""startDate"",""a"".""endDate"" FROM ""cte1"" AS ""a"" JOIN ""cte2"" AS ""b"" ON ""a"".""username""=""b"".""username"" WHERE CASE WHEN ""b"".""activities_count"">1 THEN ""rn""=2 ELSE ""rn""=1 END"
185,"WITH ""UserActivity2"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""RNK"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity2"" WHERE ""RNK""=2 UNION (SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(""username"")=1)"
186,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"") AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""act_freq"" FROM ""useractivity"") AS ""a"" WHERE CASE WHEN ""act_freq"">1 THEN ""rnk""=""act_freq""-1 ELSE ""rnk""=1 END"
187,"WITH ""CTE"" AS (SELECT ""username"",""activity"",""startdate"",""enddate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""ranking_by_date"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""counting"" FROM ""userActivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""CTE"" AS ""cte1"" WHERE ""ranking_by_date""=2 OR ""counting""=1"
188,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(0)=1 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity"") AS ""t"" WHERE ""rk""=2"
189,"WITH ""rnks"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""turns"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""rnks"" WHERE ""turns""=2 UNION SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1"
190,"WITH ""win"" AS (SELECT ""username"",""activity"",""startdate"",""enddate"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""rk"",MIN(""enddate"") OVER (PARTITION BY ""username"") AS ""final_date"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""win"" WHERE ""rk""=2 OR (""rk""=1 AND ""enddate""=""final_date"")"
191,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity"") AS ""temp"" WHERE ""rk""=2 UNION SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" WHERE ""username"" IN (SELECT ""username"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)<2)"
192,"WITH ""t1"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity""), ""t2"" AS (SELECT ""username"",COUNT(1) AS ""n"" FROM ""UserActivity"" GROUP BY 1) SELECT ""t1"".""username"",""t1"".""activity"",""t1"".""startDate"",""t1"".""endDate"" FROM ""t1"" JOIN ""t2"" ON ""t1"".""username""=""t2"".""username"" WHERE ""n""<2 OR ""rk""=2"
193,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC,""endDate"" DESC) AS ""rw_num"" FROM ""UserActivity"" WHERE ""username"" IN (SELECT ""username"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(""username"")>1)) AS ""Mult"" WHERE ""rw_num""=2 UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(""username"")=1"
194,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rnk"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""useractivity"") AS ""tab"" WHERE CASE WHEN ""tab"".""cnt""<2 THEN ""tab"".""rnk""=1 ELSE ""tab"".""rnk""=2 END"
195,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""useractivity"" WHERE ROW(""username"",""startdate"") IN (SELECT ""username"",MIN(""t"".""startdate"") FROM (SELECT ""username"",""activity"",""startdate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"" FROM ""useractivity"") AS ""t"" WHERE ""rnk""<=2 GROUP BY ""username"")"
196,"WITH ""t"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,MAX(""rk"") OVER (PARTITION BY ""username"") AS ""max_rk"" FROM ""t"") AS ""temp"" WHERE ""rk""=2 OR (""rk""=1 AND ""max_rk""=1)"
197,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rank_u"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt_u"" FROM ""UserActivity"") AS ""ua"" WHERE ""rank_u""=CASE WHEN ""cnt_u"">1 THEN 2 ELSE 1 END"
198,"WITH ""cte"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"" FROM ""useractivity""), ""cte2"" AS (SELECT ""username"" AS ""USERNAME"",""activity"" AS ""ACTIVITY"",""startdate"" AS ""STARTDATE"",""enddate"" AS ""ENDDATE"" FROM ""cte"" WHERE ""rnk""=2) SELECT * FROM ""cte2"" UNION SELECT ""username"" AS ""USERNAME"",""activity"" AS ""ACTIVITY"",""startdate"" AS ""STARTDATE"",""enddate"" AS ""ENDDATE"" FROM ""cte"" WHERE ""rnk""<2 AND ""username"" NOT IN (SELECT ""username"" FROM ""cte2"")"
199,"WITH ""t"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rn"",COUNT(""username"") OVER (PARTITION BY ""username"") AS ""num_activity"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""t"" WHERE CASE WHEN ""num_activity""=1 THEN ""rn""=1 ELSE ""rn""=2 END"
200,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".* FROM ""UserActivity"" AS ""u1"" LEFT JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""endDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(""u2"".""endDate"")=1"
201,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT ""a"".*,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rn"" FROM ""useractivity"" AS ""a"") AS ""b"" WHERE ROW(""username"",""rn"") IN (SELECT ""username"",CASE WHEN COUNT(""activity"")>=2 THEN 2 ELSE 1 END AS ""rn"" FROM ""useractivity"" GROUP BY 1)"
202,"WITH ""t"" AS (SELECT ""username"",""activity"",""startDate"",""endDate"",DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity"" GROUP BY 1,2,3,4), ""t2"" AS (SELECT ""t"".""username"" FROM ""t"" GROUP BY 1 HAVING COUNT(1)=1), ""t3"" AS (SELECT ""t"".""username"" FROM ""t"" GROUP BY 1 HAVING COUNT(""t"".""username"")>1) SELECT ""t"".""username"",""t"".""activity"",""t"".""startDate"",""t"".""endDate"" FROM ""t"" WHERE ""t"".""username"" IN (SELECT ""t"".""username"" FROM ""t"" GROUP BY 1 HAVING COUNT(1)=1) OR (""t"".""username"" IN (SELECT ""t"".""username"" FROM ""t"" GROUP BY 1 HAVING COUNT(""t"".""username"")>1) AND ""t"".""rk""=2)"
203,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(""username"")=1 UNION ALL SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,DENSE_RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""ranking"" FROM ""UserActivity"") AS ""a"" WHERE ""ranking""=2"
204,"SELECT * FROM ""useractivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rn"" FROM ""useractivity"") AS ""tab1"" WHERE ""rn""=2 ORDER BY ""username"" DESC"
205,"SELECT * FROM ""UserActivity"" GROUP BY ""username"" HAVING COUNT(1)=1 UNION ALL SELECT ""u1"".* FROM ""UserActivity"" AS ""u1"" LEFT JOIN ""UserActivity"" AS ""u2"" ON ""u1"".""username""=""u2"".""username"" AND ""u1"".""endDate""<""u2"".""endDate"" GROUP BY ""u1"".""username"",""u1"".""endDate"" HAVING COUNT(""u2"".""endDate"")=1"
206,"SELECT ""username"",""activity"",""startdate"",""enddate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""useractivity"") AS ""t"" WHERE ""rnk""=2 OR ""cnt""=1"
207,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"" DESC) AS ""rkt"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""endDate"") AS ""rkt_asc"" FROM ""UserActivity"") AS ""cte"" WHERE ""rkt""=2 OR (""rkt""=1 AND ""rkt_asc""=1)"
208,"SELECT ""username"",""activity"",""startDate"",""endDate"" FROM (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startdate"" DESC) AS ""n"" FROM ""UserActivity"") AS ""tbl"" WHERE ""n""=2 OR ""cnt""<2"
209,"WITH ""CTE"" AS (SELECT *,COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""cnt"",RANK() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""rk"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""CTE"" WHERE ""rk""=2 OR ""cnt""<2"
210,"WITH ""activity_w_rank"" AS (SELECT *,ROW_NUMBER() OVER (PARTITION BY ""username"" ORDER BY ""startDate"" DESC) AS ""order_id"",COUNT(""activity"") OVER (PARTITION BY ""username"") AS ""activity_cnt"" FROM ""UserActivity"") SELECT ""username"",""activity"",""startdate"",""enddate"" FROM ""activity_w_rank"" WHERE ""order_id""=2 OR ""activity_cnt""=1"
211,"SELECT ""a"".""username"",""a"".""activity"",""a"".""startDate"",""a"".""endDate"" FROM ""UserActivity"" AS ""a"" JOIN (SELECT ""a"".""username"",COALESCE(MAX(""b"".""startDate""), ""a"".""startDate"") AS ""startDate"",COALESCE(MAX(""b"".""endDate""), ""a"".""endDate"") AS ""endDate"" FROM ""UserActivity"" AS ""a"" LEFT JOIN ""UserActivity"" AS ""b"" ON ""a"".""username""=""b"".""username"" AND ""a"".""startDate"">""b"".""startDate"" GROUP BY 1) AS ""b"" ON ""a"".""username""=""b"".""username"" AND ""a"".""startDate""=""b"".""startDate"""
212,"WITH ""cte"" AS (SELECT *,RANK() OVER (PARTITION BY ""username"" ORDER BY ""enddate"" DESC) AS ""rnk"",COUNT(1) OVER (PARTITION BY ""username"") AS ""cnt"" FROM ""useractivity"") SELECT ""username"",""activity"",""startDate"",""endDate"" FROM ""cte"" WHERE CASE WHEN ""cnt""=1 THEN ""rnk""=1 ELSE ""rnk""=2 END"
